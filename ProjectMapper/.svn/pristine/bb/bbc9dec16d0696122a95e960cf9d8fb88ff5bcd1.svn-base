{"version":3,"file":"dhtmlxgantt.es.js","sources":["../sources/core/ui/utils/dom_helpers.js","../sources/utils/global.js","../sources/ext/click_drag/eventsManager.ts","../sources/utils/eventable.js","../sources/utils/helpers.js","../sources/ext/click_drag/selectedRegion.ts","../sources/ext/drag_timeline/eventsManager.ts","../sources/ext/keyboard_navigation/modals.js","../sources/ext/quick_info/quickInfo.ts","../sources/utils/utils.js","../sources/core/ui/utils/dom_event_scope.js","../sources/ext/tooltip/tooltip.ts","../sources/ext/tooltip/tooltipManager.ts","../sources/ext/undo/monitor.ts","../sources/ext/undo/undo.ts","../sources/ext/extensions_gpl.ts","../sources/ext/click_drag/index.ts","../sources/ext/drag_timeline/index.ts","../sources/ext/fullscreen/index.ts","../sources/ext/keyboard_navigation.js","../sources/ext/keyboard_navigation/common/keyboard_shortcuts.js","../sources/ext/keyboard_navigation/common/eventhandler.js","../sources/ext/keyboard_navigation/common/trap_modal_focus.js","../sources/ext/keyboard_navigation/elements/gantt_node.js","../sources/ext/keyboard_navigation/elements/nav_node.js","../sources/ext/keyboard_navigation/elements/header_cell.js","../sources/ext/keyboard_navigation/elements/task_row.js","../sources/ext/keyboard_navigation/elements/task_cell.js","../sources/ext/keyboard_navigation/core.js","../sources/ext/quick_info/index.ts","../sources/ext/tooltip/index.ts","../sources/ext/undo/index.ts","../sources/ext/marker.js","../sources/ext/multiselect.js","../sources/ext/export_api/index.ts","../sources/constants/index.js","../sources/ext/extension_manager.ts","../sources/core/common/config.ts","../sources/utils/env.js","../sources/core/common/serialize.ts","../sources/core/common/ajax.js","../sources/core/common/date_parsers/fast_version.ts","../sources/core/common/date_parsers/csp_compliant_version.ts","../sources/core/common/date.js","../node_modules/remote-client/dist/remote.es6.js","../sources/core/remote/remote_events.js","../sources/utils/timeout.js","../sources/core/common/state.js","../sources/utils/promise.js","../sources/core/facades/datastore_tasks.js","../sources/core/datastore/power_array.js","../sources/utils/placeholder_task.js","../sources/core/datastore/datastore.js","../sources/core/datastore/treedatastore.js","../sources/utils/is_headless.js","../sources/core/datastore/datastore_render.js","../sources/core/facades/datastore.js","../sources/core/datastore/select.js","../sources/core/facades/datastore_links.js","../sources/core/ui/timeline/scales.js","../sources/core/gantt_data_range.js","../sources/utils/task_tree_helpers.js","../sources/core/dataprocessor/data_processor_events.ts","../sources/core/dataprocessor/simple_storage.ts","../sources/core/dataprocessor/data_processor.ts","../sources/core/dataprocessor/extend_gantt.ts","../sources/core/dataprocessor/index.js","../sources/core/plugins/batch_update.js","../sources/core/plugins/wbs.js","../sources/core/plugins/resources.js","../sources/core/plugins/resource_assignments.js","../sources/core/plugins/new_task_placeholder.js","../sources/core/plugins/auto_task_types.js","../sources/core/common/duration_formatter_numeric.ts","../sources/core/common/link_formatter_simple.ts","../sources/core/plugins/formatters.js","../sources/core/plugins/empty_state_screen.ts","../sources/core/ui/render/baseline_helper.js","../sources/core/plugins/baselines.js","../sources/core/loading/parsing.js","../sources/core/worktime/calendar_arguments_helper.js","../sources/core/worktime/strategy/work_calendar_merger.js","../sources/core/worktime/strategy/work_unit_cache/workunit_map_cache.ts","../sources/core/worktime/strategy/work_unit_cache/workunit_object_cache.ts","../sources/core/worktime/strategy/work_unit_cache/larger_units_helper.ts","../sources/core/worktime/strategy/work_unit_cache/date_duration_cache.ts","../sources/core/worktime/strategy/calendar_strategy.js","../sources/core/worktime/strategy/work_unit_cache/index.ts","../sources/core/worktime/legacy_resource_config.js","../sources/core/worktime/calendar_manager.js","../sources/core/worktime/dynamic_resource_calendars.js","../sources/core/worktime/strategy/no_work_time.js","../sources/core/worktime/time_calculator.js","../sources/core/facades/worktime_calendars.js","../sources/core/data.js","../sources/core/ui/resize_listener.js","../sources/core/gantt_core.js","../sources/core/common/assert.js","../sources/locale/locale_ar.ts","../sources/locale/locale_be.ts","../sources/locale/locale_ca.ts","../sources/locale/locale_cn.ts","../sources/locale/locale_cs.ts","../sources/locale/locale_da.ts","../sources/locale/locale_de.ts","../sources/locale/locale_el.ts","../sources/locale/locale_en.ts","../sources/locale/locale_es.ts","../sources/locale/locale_fa.ts","../sources/locale/locale_fi.ts","../sources/locale/locale_fr.ts","../sources/locale/locale_he.ts","../sources/locale/locale_hr.ts","../sources/locale/locale_hu.ts","../sources/locale/locale_id.ts","../sources/locale/locale_it.ts","../sources/locale/locale_jp.ts","../sources/locale/locale_kr.ts","../sources/locale/locale_manager.ts","../sources/locale/locale_nb.ts","../sources/locale/locale_nl.ts","../sources/locale/locale_no.ts","../sources/locale/locale_pl.ts","../sources/locale/locale_pt.ts","../sources/locale/locale_ro.ts","../sources/locale/locale_ru.ts","../sources/locale/locale_si.ts","../sources/locale/locale_sk.ts","../sources/locale/locale_sv.ts","../sources/locale/locale_tr.ts","../sources/locale/locale_ua.ts","../sources/factory/make_instance_common.js","../sources/core/common/services.js","../sources/core/common/dnd.js","../sources/core/common/templates.js","../sources/core/datastore/datastore_hooks.js","../sources/core/plugins/index.js","../sources/core/grid_column_api.gpl.js","../sources/core/tasks.js","../sources/core/worktime/work_time.js","../sources/core/data_task_types.gpl.js","../sources/core/cached_functions.js","../sources/core/destructor.js","../sources/locale/index.ts","../sources/core/ui/message.js","../sources/core/ui/configurable.js","../sources/core/ui/ui_factory.js","../sources/core/ui/mouse.js","../sources/core/ui/render/viewport/is_in_viewport.js","../sources/core/ui/render/is_legacy_smart_render.js","../sources/core/ui/render/viewport/get_grid_row_rectangle.js","../sources/core/ui/render/viewport/get_visible_bars_range.js","../sources/core/ui/render/render_factory.js","../sources/core/ui/render/layer_engine.js","../sources/core/ui/render/viewport/get_bar_rectangle.js","../sources/core/ui/render/viewport/factory/get_visible_link_range.js","../sources/core/ui/render/viewport/get_link_rectangle.js","../sources/core/ui/render/viewport/is_link_in_viewport.js","../sources/core/ui/gantt_layers.js","../sources/core/ui/layout/cell.js","../sources/utils/extends.js","../sources/core/ui/layout/layout.js","../sources/core/ui/layout/view_layout.js","../sources/core/ui/layout/view_cell.js","../sources/core/ui/layout/scrollbar_cell.js","../sources/core/ui/row_position_mixin.js","../sources/core/ui/row_position_fixed_height.js","../sources/core/ui/timeline/tasks_canvas_render.gpl.js","../sources/core/ui/timeline/timeline.js","../sources/core/ui/timeline/timeline_layers_gpl.js","../sources/core/ui/plugins/column_grid_dnd/scrollable_grid.ts","../sources/core/ui/plugins/column_grid_dnd/column_grid_dnd.ts","../sources/core/ui/mouse_event_container.js","../sources/core/ui/grid/grid.js","../sources/core/ui/grid/grid_resize.gpl.js","../sources/core/ui/grid/task_grid_row_resize.js","../sources/core/ui/grid/editors/keyboard_mappings/default.js","../sources/core/ui/grid/editors/keyboard_mappings/keyboard_navigation.js","../sources/core/ui/grid/editors/editors/base.js","../sources/core/ui/grid/editors/editors/text.js","../sources/core/ui/grid/editors/editors/number.js","../sources/core/ui/grid/editors/editors/select.js","../sources/core/ui/grid/editors/editors/date.js","../sources/core/ui/grid/editors/editors/predecessor.js","../sources/core/ui/grid/editors/editors/duration.js","../sources/core/ui/grid/editors/linked_properties.js","../sources/core/ui/grid/editors/controller.js","../sources/core/ui/grid/editors/keyboard_mappings.js","../sources/core/ui/render/viewport/is_bar_in_viewport.js","../sources/core/ui/render/task_bar_render.js","../sources/core/ui/render/task_bar_smart_render.js","../sources/core/ui/render/dummy_layer.js","../sources/core/ui/render/viewport/get_bg_row_rectangle.js","../sources/core/ui/render/viewport/get_visible_cells_range.js","../sources/core/ui/render/viewport/is_column_visible.js","../sources/core/ui/render/prerender/task_bg_placeholder.js","../sources/core/ui/render/link_render.js","../sources/core/ui/render/viewport/is_grid_row_in_viewport.js","../sources/core/resource_timetable_builder.js","../sources/core/ui/grid/tasks_grid_dnd.js","../sources/core/ui/grid/tasks_grid_dnd_marker_helpers/drop_target.js","../sources/core/ui/grid/tasks_grid_dnd_marker_helpers/locked_level.js","../sources/core/ui/grid/tasks_grid_dnd_marker_helpers/highlight.js","../sources/core/ui/grid/tasks_grid_dnd_marker.js","../sources/core/ui/grid/tasks_grid_dnd_marker_helpers/multi_level.js","../sources/core/ui/grid/main_grid_initializer.js","../sources/core/ui/timeline/tasks_dnd.js","../sources/core/ui/timeline/links_dnd.js","../sources/core/ui/timeline/main_timeline_initializer.js","../sources/core/ui/main_layout_initializer.js","../sources/core/ui/index.js","../sources/core/ui/layout/resizer_cell.gpl.js","../sources/core/ui/render/task_grid_line_render.js","../sources/core/ui/render/task_bg_render.js","../sources/core/ui/render/task_rollup_render.js","../sources/core/ui/render/resource_matrix_render.js","../sources/core/ui/render/task_grid_row_resize_render.js","../sources/core/ui/skin.js","../sources/core/ui/plugins/autoscroll.js","../sources/core/ui/plugins/jquery_hooks.js","../sources/core/ui/plugins/dhtmlx_hooks.js","../sources/core/ui/plugins/timeline_zoom.ts","../sources/core/ui/touch.js","../sources/core/ui/lightbox/controls/base_control.js","../sources/core/ui/utils/html_helpers.js","../sources/core/ui/lightbox/controls/select_control.js","../sources/core/ui/lightbox/controls/parent_control.js","../sources/core/ui/lightbox/index.js","../sources/core/ui/lightbox/controls/template_control.js","../sources/core/ui/lightbox/controls/textarea_control.js","../sources/core/ui/lightbox/controls/time_control.js","../sources/core/ui/lightbox/controls/checkbox_control.js","../sources/core/ui/lightbox/controls/radio_control.js","../sources/core/ui/lightbox/controls/duration_control.js","../sources/core/ui/lightbox/controls/constraint_control.js","../sources/core/ui/lightbox/controls/typeselect_control.js","../sources/core/ui/lightbox/controls/baseline_control.js","../sources/core/ui_core.js","../sources/core/data_task_layers.gpl.js","../sources/core/facades/layout.js","../sources/css/skins/skyblue.js","../sources/css/skins/dark.js","../sources/css/skins/meadow.js","../sources/css/skins/terrace.js","../sources/css/skins/broadway.js","../sources/css/skins/material.js","../sources/css/skins/contrast_black.js","../sources/css/skins/contrast_white.js","../sources/core/ui/plugins/index.js","../sources/core/ui/lightbox/lightbox_optional_time.js","../sources/core/ui/wai_aria.js","../sources/dhtmlxgantt.gpl.ts","../sources/factory/make_instance_web.js","../sources/core/loading/ajax_loading.js"],"sourcesContent":["//returns position of html element on the page\nfunction getNodePosition(elem) {\n\tvar top=0, left=0, right=0, bottom=0;\n\tif (elem.getBoundingClientRect) { //HTML5 method\n\t\tvar box = elem.getBoundingClientRect();\n\t\tvar body = document.body;\n\t\tvar docElem = (document.documentElement ||\n\t\t\tdocument.body.parentNode ||\n\t\t\tdocument.body);\n\n\t\tvar scrollTop = window.pageYOffset || docElem.scrollTop || body.scrollTop;\n\t\tvar scrollLeft = window.pageXOffset || docElem.scrollLeft || body.scrollLeft;\n\t\tvar clientTop = docElem.clientTop || body.clientTop || 0;\n\t\tvar clientLeft = docElem.clientLeft || body.clientLeft || 0;\n\t\ttop  = box.top +  scrollTop - clientTop;\n\t\tleft = box.left + scrollLeft - clientLeft;\n\n\t\tright = document.body.offsetWidth - box.right;\n\t\tbottom = document.body.offsetHeight - box.bottom;\n\t} else { //fallback to naive approach\n\t\twhile(elem) {\n\t\t\ttop = top + parseInt(elem.offsetTop,10);\n\t\t\tleft = left + parseInt(elem.offsetLeft,10);\n\t\t\telem = elem.offsetParent;\n\t\t}\n\n\t\tright = document.body.offsetWidth - elem.offsetWidth - left;\n\t\tbottom = document.body.offsetHeight - elem.offsetHeight - top;\n\t}\n\treturn { y: Math.round(top), x: Math.round(left), width:elem.offsetWidth, height:elem.offsetHeight, right: Math.round(right), bottom: Math.round(bottom) };\n}\n\nfunction isVisible(node){\n\tvar display = false,\n\t\tvisibility = false;\n\tif(window.getComputedStyle){\n\t\tvar style = window.getComputedStyle(node, null);\n\t\tdisplay = style[\"display\"];\n\t\tvisibility = style[\"visibility\"];\n\t}else if(node.currentStyle){\n\t\tdisplay = node.currentStyle[\"display\"];\n\t\tvisibility = node.currentStyle[\"visibility\"];\n\t}\n\treturn (display != \"none\" && visibility != \"hidden\");\n}\n\nfunction hasNonNegativeTabIndex(node){\n\treturn !isNaN(node.getAttribute(\"tabindex\")) && (node.getAttribute(\"tabindex\")*1 >= 0);\n}\n\nfunction hasHref(node){\n\tvar canHaveHref = {\"a\": true, \"area\": true};\n\tif(canHaveHref[node.nodeName.loLowerCase()]){\n\t\treturn !!node.getAttribute(\"href\");\n\t}\n\treturn true;\n}\n\nfunction isEnabled(node){\n\tvar canDisable = {\"input\":true, \"select\":true, \"textarea\":true, \"button\":true, \"object\":true};\n\tif(canDisable[node.nodeName.toLowerCase()]){\n\t\treturn !node.hasAttribute(\"disabled\");\n\t}\n\n\treturn true;\n}\n\nfunction getFocusableNodes(root){\n\tvar nodes = root.querySelectorAll([\n\t\t\"a[href]\",\n\t\t\"area[href]\",\n\t\t\"input\",\n\t\t\"select\",\n\t\t\"textarea\",\n\t\t\"button\",\n\t\t\"iframe\",\n\t\t\"object\",\n\t\t\"embed\",\n\t\t\"[tabindex]\",\n\t\t\"[contenteditable]\"\n\t].join(\", \"));\n\n\tvar nodesArray = Array.prototype.slice.call(nodes, 0);\n\t\n\tfor(var i = 0; i < nodesArray.length; i++){\n\t\tnodesArray[i].$position = i;\n\t\t// we remember original nodes order, \n\t\t// so when we sort them by tabindex we ensure order of nodes with same tabindex is preserved, \n\t\t// since some browsers do unstable sort\n\t}\n\t\n\t// use tabindex to sort focusable nodes\n\tnodesArray.sort(function(a, b) {\n\t\tif(a.tabIndex === 0 && b.tabIndex !== 0){\n\t\t\treturn 1;\n\t\t}\n\t\tif(a.tabIndex !== 0 && b.tabIndex === 0){\n\t\t\treturn -1;\n\t\t}\n\t\t\n\t\tif (a.tabIndex === b.tabIndex){\n\t\t\t// ensure we do stable sort\n\t\t\treturn a.$position - b.$position;\n\t\t}\n\t\tif (a.tabIndex < b.tabIndex) {\n\t\t\treturn -1;\n\t\t}\n\t\treturn 1;\n\t});\n\t\n\tfor(var i = 0; i < nodesArray.length; i++){\n\t\tvar node = nodesArray[i];\n\t\tvar isValid = (hasNonNegativeTabIndex(node)  || isEnabled(node) || hasHref(node)) && isVisible(node);\n\t\tif(!isValid){\n\t\t\tnodesArray.splice(i, 1);\n\t\t\ti--;\n\t\t}\n\t}\n\treturn nodesArray;\n}\n\nfunction getScrollSize(){\n\tvar div = document.createElement(\"div\");\n\tdiv.style.cssText=\"visibility:hidden;position:absolute;left:-1000px;width:100px;padding:0px;margin:0px;height:110px;min-height:100px;overflow-y:scroll;\";\n\n\tdocument.body.appendChild(div);\n\tvar width = div.offsetWidth-div.clientWidth;\n\tdocument.body.removeChild(div);\n\n\treturn Math.max(width, 15);\n}\n\nfunction getClassName(node){\n\tif(!node) return \"\";\n\n\tvar className = node.className || \"\";\n\tif(className.baseVal)//'className' exist but not a string - IE svg element in DOM\n\t\tclassName = className.baseVal;\n\n\tif(!className.indexOf)\n\t\tclassName = \"\";\n\n\treturn _trimString(className);\n}\n\nfunction addClassName(node, className){\n\tif (className && node.className.indexOf(className) === -1) {\n\t\tnode.className += \" \" + className;\n\t}\n}\n\nfunction removeClassName(node, name) {\n\tname = name.split(\" \");\n\tfor (var i = 0; i < name.length; i++) {\n\t\tvar regEx = new RegExp(\"\\\\s?\\\\b\" + name[i] + \"\\\\b(?![-_.])\", \"\");\n\t\tnode.className = node.className.replace(regEx, \"\");\n\t}\n}\n\nfunction hasClass(element, className){\n\tif ('classList' in element) {\n\t\treturn element.classList.contains(className);\n\t} else { \n\t\treturn new RegExp(\"\\\\b\" + className + \"\\\\b\").test(element.className);\n\t}\n}\n\nfunction toNode(node) {\n\tif (typeof node === \"string\") {\n\t\treturn (document.getElementById(node) || document.querySelector(node) || document.body);\n\t}\n\treturn node || document.body;\n}\n\nvar _slave;\nfunction insertNode(node, newone) {\n\tif(!_slave){\n\t\t_slave = document.createElement(\"div\");\n\t}\n\t_slave.innerHTML = newone;\n\tvar child = _slave.firstChild;\n\tnode.appendChild(child);\n\treturn child;\n}\n\nfunction removeNode(node) {\n\tif (node && node.parentNode) {\n\t\tnode.parentNode.removeChild(node);\n\t}\n}\n\nfunction getChildNodes(node, css) {\n\tvar ch = node.childNodes;\n\tvar len = ch.length;\n\tvar out = [];\n\tfor (var i = 0; i < len; i++) {\n\t\tvar obj = ch[i];\n\t\tif (obj.className && obj.className.indexOf(css) !== -1) {\n\t\t\tout.push(obj);\n\t\t}\n\t}\n\treturn out;\n}\n\nfunction getTargetNode(e) {\n\tvar trg;\n\tif (e.tagName)\n\t\ttrg = e;\n\telse {\n\t\te = e || window.event;\n\t\ttrg = e.target || e.srcElement;\n\t\tif (trg.shadowRoot && e.composedPath) {\n\t\t\ttrg = e.composedPath()[0];\n\t\t}\n\t}\n\treturn trg;\n}\n\nfunction locateAttribute(e, attribute) {\n\tif(!attribute) return;\n\n\tvar trg = getTargetNode(e);\n\n\twhile (trg){\n\t\tif (trg.getAttribute){\t//text nodes has not getAttribute\n\t\t\tvar test = trg.getAttribute(attribute);\n\t\t\tif (test) return trg;\n\t\t}\n\t\ttrg=trg.parentNode;\n\t}\n\treturn null;\n}\n\nfunction _trimString(str){\n\tvar func = String.prototype.trim || function(){ return this.replace(/^\\s+|\\s+$/g, \"\"); };\n\treturn func.apply(str);\n}\n\nfunction locateClassName(e, classname, strict){\n\tvar trg = getTargetNode(e);\n\tvar css = \"\";\n\n\tif(strict === undefined)\n\t\tstrict = true;\n\n\twhile (trg){\n\t\tcss = getClassName(trg);\n\t\tif(css){\n\t\t\tvar ind = css.indexOf(classname);\n\t\t\tif (ind >= 0){\n\t\t\t\tif (!strict)\n\t\t\t\t\treturn trg;\n\n\t\t\t\t//check that we have exact match\n\t\t\t\tvar left = (ind === 0) || (!_trimString(css.charAt(ind - 1)));\n\t\t\t\tvar right = ((ind + classname.length >= css.length)) || (!_trimString(css.charAt(ind + classname.length)));\n\n\t\t\t\tif (left && right)\n\t\t\t\t\treturn trg;\n\t\t\t}\n\t\t}\n\t\ttrg=trg.parentNode;\n\t}\n\treturn null;\n}\n\n/*\nevent position relatively to DOM element\n */\nfunction getRelativeEventPosition(ev, node){\n\tvar d = document.documentElement;\n\tvar box = getNodePosition(node);\n\n\treturn {\n\t\tx: ev.clientX + d.scrollLeft - d.clientLeft - box.x + node.scrollLeft,\n\t\ty: ev.clientY + d.scrollTop - d.clientTop - box.y + node.scrollTop\n\t};\n}\n\nfunction getRelativeNodePosition(child, parent){\n\tconst childPos = getNodePosition(child);\n\tconst parentPos = getNodePosition(parent);\n\treturn {\n\t\tx: childPos.x - parentPos.x,\n\t\ty: childPos.y - parentPos.y\n\t};\n}\n\nfunction isChildOf(child, parent){\n\tif(!child || !parent){\n\t\treturn false;\n\t}\n\n\twhile(child && child != parent) {\n\t\tchild = child.parentNode;\n\t}\n\n\treturn child === parent;\n}\n\nfunction closest(element, selector){\n\tif(element.closest){\n\t\treturn element.closest(selector);\n\t}else if(element.matches || element.msMatchesSelector || element.webkitMatchesSelector){\n\t\tvar el = element;\n\t\tif (!document.documentElement.contains(el)) return null;\n\t\tdo {\n\t\t\tvar method = el.matches || el.msMatchesSelector || el.webkitMatchesSelector;\n\n\t\t\tif (method.call(el, selector)) return el;\n\t\t\tel = el.parentElement || el.parentNode;\n\t\t} while (el !== null && el.nodeType === 1); \n\t\treturn null;\n\t}else{\n\t\t// eslint-disable-next-line no-console\n\t\tconsole.error(\"Your browser is not supported\");\n\t\treturn null;\n\t}\n}\n\nfunction getClosestSizedElement(element) {\n\twhile (element) {\n\t\tif (element.offsetWidth > 0 && element.offsetHeight > 0) {\n\t\t\treturn element;\n\t\t}\n\t\telement = element.parentElement;\n\t}\n\treturn null;\n}\n\nfunction isShadowDomSupported() {\n\treturn document.head.createShadowRoot || document.head.attachShadow;\n}\n\n/**\n * Returns element that has the browser focus, or null if no element has focus.\n * Works with shadow DOM, so it's prefereed to use this function instead of document.activeElement directly.\n * @returns HTMLElement\n */\nfunction getActiveElement(){\n\tvar activeElement = document.activeElement;\n\tif (activeElement.shadowRoot) {\n\t\tactiveElement = activeElement.shadowRoot.activeElement;\n\t}\n\tif (activeElement === document.body && document.getSelection) {\n\t\tactiveElement = document.getSelection().focusNode || document.body;\n\t}\n\n\treturn activeElement;\n}\n\n/**\n * Returns document.body or the host node of the ShadowRoot, if the element is attached to ShadowDom\n * @param {HTMLElement} element \n * @returns HTMLElement\n */\nfunction getRootNode(element) {\n\tif (!element) {\n\t\treturn document.body;\n\t}\n\tif (!isShadowDomSupported()) {\n\t\treturn document.body;\n\t}\n\twhile (element.parentNode && (element = element.parentNode)) {\n\t\tif (element instanceof ShadowRoot) {\n\t\t\treturn element.host;\n\t\t}\n\t}\n\treturn document.body;\n}\n\nfunction hasShadowParent(element) {\n\treturn !!getRootNode(element);\n}\n\nexport {\n\tgetNodePosition,\n\tgetFocusableNodes,\n\tgetScrollSize,\n\tgetClassName,\n\taddClassName,\n\tremoveClassName,\n\tinsertNode,\n\tremoveNode,\n\tgetChildNodes,\n\ttoNode,\n\tlocateClassName,\n\tlocateAttribute,\n\tgetTargetNode,\n\tgetRelativeEventPosition,\n\tisChildOf,\n\thasClass,\n\tclosest,\n\tgetRootNode,\n\thasShadowParent,\n\tisShadowDomSupported,\n\tgetActiveElement,\n\tgetRelativeNodePosition,\n\tgetClosestSizedElement\n};","\n/* eslint-disable no-restricted-globals */\nvar globalScope;\nif(typeof window !== \"undefined\"){\n\tglobalScope = window;\n}else{\n\tglobalScope = global;\n}\n/* eslint-enable no-restricted-globals */\n\nexport default globalScope;","import * as domHelpers from \"../../core/ui/utils/dom_helpers\";\nimport global from \"../../utils/global\";\nimport { SelectedRegion } from \"./selectedRegion\";\n\nexport class EventsManager {\n\tprivate _mouseDown: boolean = false;\n\tprivate _domEvents: any;\n\tprivate _originPosition: string;\n\tprivate _gantt: any;\n\tprivate _restoreOriginPosition: () => void;\n\tconstructor(gantt: any) {\n\t\tthis._gantt = gantt;\n\t\tthis._domEvents = gantt._createDomEventScope();\n\t}\n\n\tattach(selectedRegion: SelectedRegion, useKey?: \"shiftKey\" | \"ctrlKey\" | \"altKey\", ignore?: any): void {\n\t\tconst gantt = this._gantt;\n\t\tconst _target = selectedRegion.getViewPort();\n\t\tthis._originPosition = global.getComputedStyle(_target).display;\n\t\tthis._restoreOriginPosition = () => {\n\t\t\t_target.style.position = this._originPosition;\n\t\t};\n\t\tif (this._originPosition === \"static\") {\n\t\t\t_target.style.position = \"relative\";\n\t\t}\n\t\tconst state = gantt.$services.getService(\"state\");\n\t\tstate.registerProvider(\"clickDrag\", () => {\n\t\t\tconst result = { autoscroll: false };\n\t\t\treturn result;\n\t\t});\n\n\n\t\tlet scheduledDndCoordinates = null;\n\t\tconst startDragAndDrop = () => {\n\t\t\tif (!scheduledDndCoordinates) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis._mouseDown = true;\n\t\t\tselectedRegion.setStart(gantt.copy(scheduledDndCoordinates));\n\t\t\tselectedRegion.setPosition(gantt.copy(scheduledDndCoordinates));\n\t\t\tselectedRegion.setEnd(gantt.copy(scheduledDndCoordinates));\n\t\t\tscheduledDndCoordinates = null;\n\t\t};\n\n\t\tthis._domEvents.attach(_target, \"mousedown\", (event) => {\n\t\t\tscheduledDndCoordinates = null;\n\t\t\tlet filterTargets = \".gantt_task_line, .gantt_task_link\";\n\t\t\tif (ignore !== undefined) {\n\t\t\t\tif (ignore instanceof Array) {\n\t\t\t\t\tfilterTargets = ignore.join(\", \");\n\t\t\t\t} else {\n\t\t\t\t\tfilterTargets = ignore;\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (filterTargets) {\n\t\t\t\tif (gantt.utils.dom.closest(event.target, filterTargets)) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t}\n\t\t\tstate.registerProvider(\"clickDrag\", () => {\n\t\t\t\tconst result = { autoscroll: this._mouseDown };\n\t\t\t\treturn result;\n\t\t\t});\n\n\t\t\tif (useKey && event[useKey] !== true) { return; }\n\t\t\tscheduledDndCoordinates = this._getCoordinates(event, selectedRegion);\n\t\t});\n\t\tconst eventElement = domHelpers.getRootNode(gantt.$root) || document.body;\n\t\tthis._domEvents.attach(eventElement, \"mouseup\", (event) => {\n\t\t\tscheduledDndCoordinates = null;\n\t\t\tif (useKey && event[useKey] !== true) { return; }\n\t\t\tif (this._mouseDown === true) {\n\t\t\t\tthis._mouseDown = false;\n\t\t\t\tconst coordinates = this._getCoordinates(event, selectedRegion);\n\t\t\t\tselectedRegion.dragEnd(coordinates);\n\t\t\t}\n\t\t});\n\t\tthis._domEvents.attach(_target, \"mousemove\", (event) => {\n\t\t\tif (useKey && event[useKey] !== true) { return; }\n\t\t\t// GS-854. If we don't have useKey for the click_drag extension,\n\t\t\t// check the drag_timeline to not simultaneously use both extensions\n\t\t\tconst dragTimeline = this._gantt.ext.clickDrag;\n\t\t\tconst dragTimelineUseKey = (this._gantt.config.drag_timeline || {}).useKey;\n\t\t\tif (dragTimeline && dragTimelineUseKey) {\n\t\t\t\tif (!useKey && event[dragTimelineUseKey]) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t}\n\t\t\tlet coordinates = null;\n\t\t\tif(!this._mouseDown && scheduledDndCoordinates){\n\t\t\t\tcoordinates = this._getCoordinates(event, selectedRegion);\n\t\t\t\tif(Math.abs(scheduledDndCoordinates.relative.left - coordinates.relative.left) > 5){\n\t\t\t\t\t// add small threshold not to start dnd on simple click\n\t\t\t\t\tstartDragAndDrop();\n\t\t\t\t}\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tif (this._mouseDown === true) {\n\t\t\t\tcoordinates = this._getCoordinates(event, selectedRegion);\n\t\t\t\tselectedRegion.setEnd(coordinates);\n\t\t\t\tselectedRegion.render();\n\t\t\t}\n\t\t});\n\t}\n\n\tdetach(): void {\n\t\tconst gantt = this._gantt;\n\t\tthis._domEvents.detachAll();\n\t\tif(this._restoreOriginPosition){\n\t\t\tthis._restoreOriginPosition();\n\t\t}\n\n\t\tconst state = gantt.$services.getService(\"state\");\n\t\tstate.unregisterProvider(\"clickDrag\");\n\t}\n\n\tdestructor(): void {\n\t\tthis.detach();\n\t}\n\n\tprivate _getCoordinates(event: MouseEvent, selectedRegion: SelectedRegion) {\n\t\tconst viewPort = selectedRegion.getViewPort();\n\t\tconst viewPortBounds = viewPort.getBoundingClientRect();\n\t\tconst { clientX, clientY } = event;\n\t\tconst result = {\n\t\t\tabsolute: {\n\t\t\t\tleft: clientX,\n\t\t\t\ttop: clientY\n\t\t\t},\n\t\t\trelative: {\n\t\t\t\tleft: clientX - viewPortBounds.left + viewPort.scrollLeft,\n\t\t\t\ttop: clientY - viewPortBounds.top + viewPort.scrollTop\n\t\t\t}\n\t\t};\n\t\treturn result;\n\t}\n}","var EventHost = function(){\n\tthis._silent_mode = false;\n\tthis.listeners = {};\n};\n\nEventHost.prototype = {\n\t_silentStart: function() {\n\t\tthis._silent_mode = true;\n\t},\n\t_silentEnd: function() {\n\t\tthis._silent_mode = false;\n\t}\n};\n\nvar\tcreateEventStorage = function(obj) {\n\tvar handlers = {};\n\tvar index = 0;\n\tvar eventStorage = function(){\n\t\tvar combinedResult = true;\n\t\tfor(var i in handlers){\n\t\t\tvar handlerResult = handlers[i].apply(obj, arguments);\n\t\t\tcombinedResult=combinedResult && handlerResult;\n\t\t}\n\t\treturn combinedResult;\n\t};\n\teventStorage.addEvent=function(handler, settings){\n\t\tif (typeof (handler) == \"function\"){\n\t\t\tvar handlerId;\n\t\t\tif(settings && settings.id){\n\t\t\t\thandlerId = settings.id;\n\t\t\t}else{\n\t\t\t\thandlerId = index;\n\t\t\t\tindex++;\n\t\t\t}\n\n\t\t\tif(settings && settings.once){\n\t\t\t\tvar originalHandler = handler;\n\t\t\t\thandler = function(){\n\t\t\t\t\toriginalHandler();\n\t\t\t\t\teventStorage.removeEvent(handlerId);\n\t\t\t\t};\n\t\t\t}\n\n\t\t\thandlers[handlerId] = handler;\n\t\t\treturn handlerId;\n\t\t}\n\t\treturn false;\n\t};\n\teventStorage.removeEvent=function(id){\n\t\tdelete handlers[id];\n\t};\n\n\teventStorage.clear = function(){\n\t\thandlers = {};\n\t};\n\n\treturn eventStorage;\n};\n\nfunction makeEventable(obj){\n\n\tvar eventHost = new EventHost();\n\tobj.attachEvent=function(eventName, handler, settings){\n\t\teventName = 'ev_'+eventName.toLowerCase();\n\t\tif (!eventHost.listeners[eventName]){\n\t\t\teventHost.listeners[eventName] = createEventStorage(this);\n\t\t}\n\n\t\tif(settings && settings.thisObject){\n\t\t\thandler = handler.bind(settings.thisObject);\n\t\t}\n\n\t\tvar innerId = eventHost.listeners[eventName].addEvent(handler, settings);\n\n\t\tvar handlerId = (eventName+':'+innerId); //return ID (ev_eventname:1)\n\t\tif(settings && settings.id){\n\t\t\thandlerId = settings.id;\n\t\t}\n\t\treturn handlerId;\n\t};\n\n\tobj.attachAll = function(callback){\n\t\tthis.attachEvent('listen_all', callback);\n\t};\n\n\tobj.callEvent=function(name, eventArguments){\n\t\tif (eventHost._silent_mode) return true;\n\n\t\tvar handlerName = 'ev_'+name.toLowerCase();\n\n\t\tvar listeners = eventHost.listeners;\n\t\tif (listeners['ev_listen_all']){\n\t\t\tlisteners['ev_listen_all'].apply(this, [name].concat(eventArguments));\n\t\t}\n\n\t\tif (listeners[handlerName])\n\t\t\treturn listeners[handlerName].apply(this, eventArguments);\n\t\treturn true;\n\t};\n\n\tobj.checkEvent=function(name){\n\t\tvar listeners = eventHost.listeners;\n\t\treturn (!!listeners['ev_'+name.toLowerCase()]);\n\t};\n\n\tobj.detachEvent=function(id){\n\t\tif (id){\n\t\t\tvar listeners = eventHost.listeners;\n\t\t\tfor(var i in listeners){\n\t\t\t\tlisteners[i].removeEvent(id); //remove event\n\t\t\t}\n\n\t\t\tvar list = id.split(':');//get EventName and ID\n\t\t\tvar listeners = eventHost.listeners;\n\t\t\tif(list.length === 2){\n\t\t\t\tvar eventName = list[0];\n\t\t\t\tvar eventId = list[1];\n\t\t\t\tif(listeners[eventName]){\n\t\t\t\t\tlisteners[eventName].removeEvent(eventId); //remove event\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t};\n\tobj.detachAllEvents = function(){\n\t\tfor (var name in eventHost.listeners) {\n\t\t\teventHost.listeners[name].clear();\n\t\t}\n\t};\n\n}\n\nexport default makeEventable;","var units = {\n\t\"second\": 1,\n\t\"minute\": 60,\n\t\"hour\": 60 * 60,\n\t\"day\": 60 * 60 * 24,\n\t\"week\": 60 * 60 * 24 * 7,\n\t\"month\": 60 * 60 * 24 * 30,\n\t\"quarter\": 60 * 60 * 24 * 30 * 3,\n\t\"year\": 60 * 60 * 24 * 365\n};\nfunction getSecondsInUnit(unit){\n\treturn units[unit] || units.hour;\n}\n\nfunction forEach(arr, callback) {\n\tif (arr.forEach) {\n\t\tarr.forEach(callback);\n\t} else {\n\t\tvar workArray = arr.slice();\n\t\tfor (var i = 0; i < workArray.length; i++) {\n\t\t\tcallback(workArray[i], i);\n\t\t}\n\t}\n}\n\nfunction arrayMap(arr, callback) {\n\tif (arr.map) {\n\t\treturn arr.map(callback);\n\t} else {\n\t\tvar workArray = arr.slice();\n\t\tvar resArray = [];\n\n\t\tfor (var i = 0; i < workArray.length; i++) {\n\t\t\tresArray.push(callback(workArray[i], i));\n\t\t}\n\t\treturn resArray;\n\t}\n}\n\n\nfunction arrayFind(arr, callback) {\n\tif (arr.find) {\n\t\treturn arr.find(callback);\n\t} else {\n\t\tfor (var i = 0; i < arr.length; i++) {\n\t\t\tif (callback(arr[i], i)) {\n\t\t\t\treturn arr[i];\n\t\t\t}\n\t\t}\n\t}\n}\n\nfunction arrayIncludes(arr, item) {\n\tif(arr.includes){\n\t\treturn arr.includes(item);\n\t}else{\n\t\tfor (var i = 0; i < arr.length; i++) {\n\t\t\tif (arr[i] === item) {\n\t\t\t\treturn true;\n\t\t\t}\n\t\t}\n\t\treturn false;\n\t}\n}\n\n// iframe-safe array type check instead of using instanceof\nfunction isArray(obj){\n\tif(Array.isArray){\n\t\treturn Array.isArray(obj);\n\t}else{\n\t\t// close enough\n\t\treturn (obj && obj.length !== undefined && obj.pop && obj.push);\n\t}\n}\n\n// non-primitive string object, e.g. new String(\"abc\")\nfunction isStringObject(obj){\n\treturn obj && typeof obj === \"object\"\n\t\t&& Function.prototype.toString.call(obj.constructor) === \"function String() { [native code] }\";\n}\n\n// non-primitive number object, e.g. new Number(5)\nfunction isNumberObject(obj){\n\treturn obj && typeof obj === \"object\"\n\t\t&& Function.prototype.toString.call(obj.constructor) === \"function Number() { [native code] }\";\n}\n\n// non-primitive number object, e.g. new Boolean(true)\nfunction isBooleanObject(obj){\n\treturn obj && typeof obj === \"object\"\n\t\t&& Function.prototype.toString.call(obj.constructor) === \"function Boolean() { [native code] }\";\n}\n\nfunction isDate(obj) {\n\tif (obj && typeof obj === \"object\") {\n\t\treturn !!(obj.getFullYear && obj.getMonth && obj.getDate);\n\t} else {\n\t\treturn false;\n\t}\n}\n\nfunction isValidDate(obj){\n\treturn isDate(obj) && !isNaN(obj.getTime());\n}\n\nfunction arrayFilter(arr, callback) {\n\tvar result = [];\n\n\tif (arr.filter) {\n\t\treturn arr.filter(callback);\n\t} else {\n\t\tfor (var i = 0; i < arr.length; i++) {\n\t\t\tif (callback(arr[i], i)) {\n\t\t\t\tresult[result.length] = arr[i];\n\t\t\t}\n\t\t}\n\t\treturn result;\n\t}\n}\n\nfunction hashToArray(hash) {\n\tvar result = [];\n\n\tfor (var key in hash) {\n\t\tif (hash.hasOwnProperty(key)) {\n\t\t\tresult.push(hash[key]);\n\t\t}\n\t}\n\n\treturn result;\n}\n\nfunction arraySome(arr, callback) {\n\tif (arr.length === 0) return false;\n\n\tfor (var i = 0; i < arr.length; i++) {\n\t\tif (callback(arr[i], i, arr)) {\n\t\t\treturn true;\n\t\t}\n\t}\n\treturn false;\n}\n\nfunction arrayDifference(arr, callback) {\n\treturn arrayFilter(arr, function(item, i) {\n\t\treturn !callback(item, i);\n\t});\n}\n\nfunction throttle (callback, timeout) {\n\tvar wait = false;\n\n\treturn function () {\n\t\tif (!wait) {\n\t\t\tcallback.apply(null, arguments);\n\t\t\twait = true;\n\t\t\tsetTimeout(function () {\n\t\t\t\twait = false;\n\t\t\t}, timeout);\n\t\t}\n\t};\n}\n\nfunction delay (callback, timeout){\n\tvar timer;\n\n\tvar result = function() {\n\t\tresult.$cancelTimeout();\n\t\tresult.$pending = true;\n\t\tvar args = Array.prototype.slice.call(arguments);\n\t\ttimer = setTimeout(function(){\n\t\t\tcallback.apply(this, args);\n\t\t\tresult.$pending = false;\n\t\t}, timeout);\n\t};\n\n\tresult.$pending = false;\n\tresult.$cancelTimeout = function(){\n\t\tclearTimeout(timer);\n\t\tresult.$pending = false;\n\t};\n\tresult.$execute = function(){\n\t\tvar args = Array.prototype.slice.call(arguments);\n\t\tcallback.apply(this, args);\n\t\tresult.$cancelTimeout();\n\t};\n\n\treturn result;\n}\n\nfunction sortArrayOfHash(arr, field, desc) {\n\tvar compare = function(a, b) {\n\t\treturn a < b;\n\t};\n\n\tarr.sort(function(a, b) {\n\t\tif (a[field] === b[field]) return 0;\n\n\t\treturn desc ? compare(a[field], b[field]) : compare(b[field], a[field]);\n\t});\n}\n\nfunction objectKeys(obj) {\n\tif (Object.keys) {\n\t\treturn Object.keys(obj);\n\t}\n\tvar result = [];\n\tvar key;\n\tfor (key in obj) {\n\t\tif (Object.prototype.hasOwnProperty.call(obj, key)) {\n\t\t\tresult.push(key);\n\t\t}\n\t}\n\treturn result;\n}\n\nfunction isEventable(obj) {\n\treturn obj.attachEvent && obj.detachEvent;\n}\n\n//GS-1090: A task should be able to have the id = 0\nfunction replaceValidZeroId(id, rootId) {\n\tif (checkZeroId(id) && !checkZeroId(rootId)){\n\t\tid = \"0\";\n\t}\n\treturn id;\n}\n\nfunction checkZeroId(id) {\n\tif (id === 0){\n\t\treturn true;\n\t}\n\treturn false;\n}\n\nfunction findBinary(array, target) {\n\t// modified binary search, target value not exactly match array elements, looking for closest one\n\n\tvar low = 0, high = array.length - 1, i, item, prev;\n\twhile (low <= high) {\n\n\t\ti = Math.floor((low + high) / 2);\n\t\titem = +array[i];\n\t\tprev = +array[i - 1];\n\t\tif (item < target) {\n\t\t\tlow = i + 1;\n\t\t\tcontinue;\n\t\t}\n\t\tif (item > target) {\n\t\t\tif (!(!isNaN(prev) && prev < target)) {\n\t\t\t\thigh = i - 1;\n\t\t\t\tcontinue;\n\t\t\t} else {\n\t\t\t\t// if target is between 'i' and 'i-1' return 'i - 1'\n\t\t\t\treturn i - 1;\n\t\t\t}\n\n\t\t}\n\t\twhile (+array[i] == +array[i + 1]) i++;\n\n\t\treturn i;\n\t}\n\treturn array.length - 1;\n}\n\nexport {\n\tgetSecondsInUnit,\n\tforEach,\n\tarrayMap,\n\tarrayIncludes,\n\tarrayFind,\n\tarrayFilter,\n\tarrayDifference,\n\tarraySome,\n\thashToArray,\n\tsortArrayOfHash,\n\tthrottle,\n\tisArray,\n\tisDate,\n\tisValidDate,\n\tisStringObject,\n\tisNumberObject,\n\tisBooleanObject,\n\tdelay,\n\tobjectKeys,\n\tisEventable,\n\treplaceValidZeroId,\n\tcheckZeroId,\n\tfindBinary\n};","import eventable from \"../../utils/eventable\";\nimport { isEventable } from \"../../utils/helpers\";\n\nexport interface ISelectedRegionConfig {\n\tclassName?: string;\n\trender?: (startPoint: IPoint, endPoint: IPoint) => HTMLElement;\n\tviewPort?: HTMLElement;\n\tuseRequestAnimationFrame: boolean;\n\tcallback?: (startPoint: IPoint, endPoint: IPoint, startDate: Date, endDate: Date, tasksByDate: any[], tasksByIndex: any[]) => void;\n\tsingleRow: boolean;\n}\n\ninterface ICoordinates {\n\tleft: number;\n\ttop: number;\n}\n\nexport interface IPoint {\n\tabsolute: ICoordinates;\n\trelative: ICoordinates;\n}\n\nexport class SelectedRegion {\n\trender: () => void;\n\tprivate _viewPort: HTMLElement & eventable;\n\tprivate _el: HTMLElement = document.createElement(\"div\");\n\tprivate _callback: (startPoint: IPoint, endPoint: IPoint, startDate: Date, endDate: Date, tasksByDate: any[], tasksByIndex: any[]) => void;\n\tprivate _startPoint: IPoint;\n\tprivate _endPoint: IPoint;\n\tprivate _positionPoint: IPoint;\n\tprivate _useRequestAnimationFrame: boolean;\n\tprivate _startDate: Date;\n\tprivate _endDate: Date;\n\tprivate _singleRow: boolean;\n\tprivate _gantt: any;\n\tprivate _view: any;\n\n\tconstructor(config: ISelectedRegionConfig, gantt: any, view: any) {\n\t\tthis._gantt = gantt;\n\t\tthis._view = view;\n\t\tthis._viewPort = config.viewPort;\n\t\tthis._el.classList.add(config.className);\n\t\tif (typeof config.callback === \"function\") {\n\t\t\tthis._callback = config.callback;\n\t\t}\n\n\t\tthis.render = () => {\n\t\t\tlet node;\n\t\t\tif(config.render){\n\t\t\t\tnode = config.render(this._startPoint, this._endPoint);\n\t\t\t}else{\n\t\t\t\tnode = this.defaultRender(this._startPoint, this._endPoint);\n\t\t\t}\n\n\t\t\tif(node !== this._el){\n\t\t\t\tif(this._el && this._el.parentNode){\n\t\t\t\t\tthis._el.parentNode.removeChild(this._el);\n\t\t\t\t}\n\t\t\t\tthis._el = node;\n\t\t\t}\n\n\t\t\tif (config.className !== \"\") {\n\t\t\t\tthis._el.classList.add(config.className);\n\t\t\t}\n\t\t\tthis.draw();\n\t\t};\n\n\t\tif (!isEventable(this._viewPort)) {\n\t\t\teventable(this._viewPort);\n\t\t}\n\t\tthis._singleRow = config.singleRow;\n\t\tthis._useRequestAnimationFrame = config.useRequestAnimationFrame;\n\t}\n\n\tdefaultRender = (start: IPoint, end: IPoint) => {\n\t\tif(!this._el){\n\t\t\tthis._el = document.createElement(\"div\");\n\t\t}\n\t\tconst node = this._el;\n\t\t// const gantt = this._gantt;\n\n\t\tconst top = Math.min(start.relative.top, end.relative.top);\n\t\tconst bottom = Math.max(start.relative.top, end.relative.top);\n\t\tconst left = Math.min(start.relative.left, end.relative.left);\n\t\tconst right = Math.max(start.relative.left, end.relative.left);\n\n\t\tif (this._singleRow) {\n\t\t\tconst pos = this._getTaskPositionByTop(this._startPoint.relative.top);\n\t\t\tnode.style.height = pos.height + \"px\";\n\t\t\tnode.style.top = pos.top + \"px\";\n\t\t} else {\n\t\t\tnode.style.height = Math.abs(bottom - top) + \"px\";\n\t\t\tnode.style.top = top + \"px\";\n\t\t}\n\t\tnode.style.width = Math.abs(right - left) + \"px\";\n\t\tnode.style.left = left + \"px\";\n\t\treturn node;\n\t};\n\n\tdraw() {\n\t\tif (this._useRequestAnimationFrame) {\n\t\t\treturn requestAnimationFrame(() => {\n\t\t\t\tthis._viewPort.appendChild(this.getElement());\n\t\t\t});\n\t\t} else {\n\t\t\tthis._viewPort.appendChild(this.getElement());\n\t\t}\n\t}\n\n\tclear() {\n\t\tif (this._useRequestAnimationFrame) {\n\t\t\treturn requestAnimationFrame(() => {\n\t\t\t\tif (!this._el.parentNode) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tthis._viewPort.removeChild(this._el);\n\t\t\t});\n\t\t} else {\n\t\t\tif (!this._el.parentNode) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tthis._viewPort.removeChild(this._el);\n\t\t}\n\t}\n\n\tgetElement() {\n\t\treturn this._el;\n\t}\n\n\tgetViewPort() {\n\t\treturn this._viewPort;\n\t}\n\n\tsetStart(startPoint: IPoint) {\n\t\tconst gantt = this._gantt;\n\t\tthis._startPoint = startPoint;\n\t\tthis._startDate = gantt.dateFromPos(this._startPoint.relative.left);\n\t\tthis._viewPort.callEvent(\"onBeforeDrag\", [this._startPoint]);\n\t}\n\n\tsetEnd(endPoint: IPoint) {\n\t\tconst gantt = this._gantt;\n\t\tthis._endPoint = endPoint;\n\t\tif (this._singleRow) {\n\t\t\tconst pos = this._getTaskPositionByTop(this._startPoint.relative.top);\n\t\t\tthis._endPoint.relative.top = pos.top;\n\t\t}\n\t\tthis._endDate = gantt.dateFromPos(this._endPoint.relative.left);\n\t\tif (this._startPoint.relative.left > this._endPoint.relative.left) {\n\t\t\tthis._positionPoint = {\n\t\t\t\trelative: { left: this._endPoint.relative.left, top: this._positionPoint.relative.top },\n\t\t\t\tabsolute: { left: this._endPoint.absolute.left, top: this._positionPoint.absolute.top }\n\t\t\t};\n\t\t}\n\t\tif (this._startPoint.relative.top > this._endPoint.relative.top) {\n\t\t\tthis._positionPoint = {\n\t\t\t\trelative: { left: this._positionPoint.relative.left, top: this._endPoint.relative.top },\n\t\t\t\tabsolute: { left: this._positionPoint.absolute.left, top: this._endPoint.absolute.top }\n\t\t\t};\n\t\t}\n\n\n\t\tthis._viewPort.callEvent(\"onDrag\", [this._startPoint, this._endPoint]);\n\t}\n\n\tsetPosition(positionPoint: IPoint) {\n\t\tthis._positionPoint = positionPoint;\n\t}\n\n\tdragEnd(endPoint: IPoint) {\n\t\tconst gantt = this._gantt;\n\t\tif(endPoint.relative.left < 0){\n\t\t\tendPoint.relative.left = 0;\n\t\t}\n\t\tthis._viewPort.callEvent(\"onBeforeDragEnd\", [this._startPoint, endPoint]);\n\t\tthis.setEnd(endPoint);\n\t\t// GS-1422. The endDate can be null if we drag the mouse outside the Gantt container\n\t\tthis._endDate = this._endDate || gantt.getState().max_date;\n\n\t\tif (this._startDate.valueOf() > this._endDate.valueOf()) {\n\t\t\t[ this._startDate, this._endDate ] = [ this._endDate, this._startDate ];\n\t\t}\n\t\tthis.clear();\n\t\tconst tasksByTime = gantt.getTaskByTime(this._startDate, this._endDate);\n\t\tconst tasksByIndex = this._getTasksByTop(this._startPoint.relative.top, this._endPoint.relative.top);\n\n\t\tthis._viewPort.callEvent(\"onDragEnd\", [this._startPoint, this._endPoint]);\n\t\tif (this._callback) {\n\t\t\tthis._callback(this._startPoint, this._endPoint, this._startDate, this._endDate, tasksByTime, tasksByIndex);\n\t\t}\n\t}\n\n\tgetInBounds() {\n\t\treturn this._singleRow;\n\t}\n\n\tprivate _getTasksByTop(start: number, end:number) {\n\t\tconst gantt = this._gantt;\n\t\tlet startValue = start;\n\t\tlet endValue = end;\n\t\tif (start > end) {\n\t\t\tstartValue = end;\n\t\t\tendValue = start;\n\t\t}\n\t\tconst startIndex = this._getTaskPositionByTop(startValue).index;\n\t\tconst endIndex = this._getTaskPositionByTop(endValue).index;\n\t\tconst result = [];\n\t\tfor (let i = startIndex; i <= endIndex; i++) {\n\t\t\tconst task = gantt.getTaskByIndex(i);\n\t\t\tif (task) {\n\t\t\t\tresult.push(gantt.getTaskByIndex(i));\n\t\t\t}\n\t\t}\n\t\treturn result;\n\t}\n\n\tprivate _getTaskPositionByTop(top: number){\n\t\tconst gantt = this._gantt;\n\t\tconst view = this._view;\n\t\tconst index = view.getItemIndexByTopPosition(top);\n\t\tconst task = gantt.getTaskByIndex(index);\n\t\tif(task){\n\t\t\tconst height = view.getItemHeight(task.id);\n\t\t\tconst itemTop = view.getItemTop(task.id);\n\t\t\treturn {\n\t\t\t\ttop: itemTop || 0,\n\t\t\t\theight: height || 0,\n\t\t\t\tindex\n\t\t\t};\n\t\t} else {\n\t\t\tconst dataHeight = view.getTotalHeight();\n\t\t\treturn {\n\t\t\t\ttop: top > dataHeight ? dataHeight : 0,\n\t\t\t\theight: gantt.config.row_height,\n\t\t\t\tindex: top > dataHeight ? gantt.getTaskCount() : 0\n\t\t\t};\n\t\t}\n\t}\n}","interface IPoint {\n\tx: number;\n\ty: number;\n}\n\nexport class EventsManager {\n\tstatic create(gantt: any) {\n\t\treturn new EventsManager(gantt);\n\t}\n\tprivate _mouseDown: boolean = false;\n\tprivate _startPoint: IPoint;\n\tprivate _scrollState: IPoint;\n\tprivate _originAutoscroll: boolean;\n\tprivate _domEvents: any;\n\tprivate _timeline: any;\n\tprivate _gantt: any;\n\tprivate _trace: IPoint[];\n\tprivate _originalReadonly: boolean;\n\n\tconstructor(gantt: any) {\n\t\tthis._gantt = gantt;\n\t\tthis._domEvents = gantt._createDomEventScope();\n\t\tthis._trace = [];\n\t}\n\n\tdestructor() {\n\t\tthis._domEvents.detachAll();\n\t}\n\n\tattach(timeline: any): void {\n\t\tthis._timeline = timeline;\n\t\tconst gantt = this._gantt;\n\t\tthis._domEvents.attach(timeline.$task, \"mousedown\", (event) => {\n\t\t\tif (!gantt.config.drag_timeline) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tconst { useKey,ignore, enabled } = gantt.config.drag_timeline;\n\t\t\tif(enabled === false) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tlet filterTargets = \".gantt_task_line, .gantt_task_link\";\n\t\t\tif(ignore !== undefined) {\n\t\t\t\tif(ignore instanceof Array){\n\t\t\t\t\tfilterTargets = ignore.join(\", \");\n\t\t\t\t} else {\n\t\t\t\t\tfilterTargets = ignore;\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (filterTargets) {\n\t\t\t\tif (gantt.utils.dom.closest(event.target, filterTargets)) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (useKey && event[useKey] !== true) { return; }\n\n\t\t\tthis._startDrag(event);\n\t\t});\n\n\t\tthis._domEvents.attach(document, \"keydown\", (event) => {\n\t\t\tif (!gantt.config.drag_timeline) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tconst { useKey } = gantt.config.drag_timeline;\n\t\t\tif (useKey && event[useKey] === true) {\n\t\t\t\tthis._applyDndReadyStyles();\n\t\t\t}\n\t\t});\n\t\tthis._domEvents.attach(document, \"keyup\", (event) => {\n\t\t\tif (!gantt.config.drag_timeline) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tconst { useKey } = gantt.config.drag_timeline;\n\t\t\tif (useKey && event[useKey] === false) {\n\t\t\t\tthis._clearDndReadyStyles();\n\t\t\t\tthis._stopDrag(event);\n\t\t\t}\n\t\t});\n\n\t\tthis._domEvents.attach(document, \"mouseup\", (event) => {\n\t\t\tthis._stopDrag(event);\n\t\t});\n\t\tthis._domEvents.attach(gantt.$root, \"mouseup\", (event) => {\n\t\t\tthis._stopDrag(event);\n\t\t});\n\t\tthis._domEvents.attach(document, \"mouseleave\", (event) => {\n\t\t\tthis._stopDrag(event);\n\t\t});\n\t\tthis._domEvents.attach(gantt.$root, \"mouseleave\", (event) => {\n\t\t\tthis._stopDrag(event);\n\t\t});\n\n\t\tthis._domEvents.attach(gantt.$root, \"mousemove\", (event) => {\n\t\t\tif (!gantt.config.drag_timeline) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tconst { useKey } = gantt.config.drag_timeline;\n\t\t\tif (useKey && event[useKey] !== true) { return; }\n\t\t\t// GS-854. If we don't have useKey for the drag_timeline extension,\n\t\t\t// check the click_drag to not simultaneously use both extensions\n\t\t\tconst clickDrag = this._gantt.ext.clickDrag;\n\t\t\tconst clickDragUseKey = (this._gantt.config.click_drag || {}).useKey;\n\t\t\tif (clickDrag && clickDragUseKey) {\n\t\t\t\tif (!useKey && event[clickDragUseKey]) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (this._mouseDown === true) {\n\t\t\t\tthis._trace.push({ x: event.clientX, y: event.clientY });\n\t\t\t\tconst scrollPosition: IPoint = this._countNewScrollPosition({ x: event.clientX, y: event.clientY });\n\t\t\t\tthis._setScrollPosition(timeline, scrollPosition);\n\t\t\t\tthis._scrollState = scrollPosition;\n\t\t\t\tthis._startPoint = { x: event.clientX, y: event.clientY };\n\t\t\t}\n\t\t});\n\t}\n\n\tprivate _calculateDirectionVector = () => {\n\t\tconst traceSteps = 10;\n\t\tif(this._trace.length >= traceSteps) {\n\t\t\tconst dots = this._trace.slice(this._trace.length - traceSteps);\n\n\t\t\tconst vectors = [];\n\t\t\tfor(let i = 1; i < dots.length; i++) {\n\t\t\t\tvectors.push({\n\t\t\t\t\tx: dots[i].x - dots[i - 1].x,\n\t\t\t\t\ty: dots[i].y - dots[i - 1].y\n\t\t\t\t});\n\t\t\t}\n\t\t\tconst resultVector = {x:0, y:0};\n\n\t\t\tvectors.forEach((vector) => {\n\t\t\t\tresultVector.x += vector.x;\n\t\t\t\tresultVector.y += vector.y;\n\t\t\t});\n\n\t\t\tconst magnitude = Math.sqrt(resultVector.x*resultVector.x + resultVector.y*resultVector.y);\n\t\t\tconst angleDegrees = Math.atan2(Math.abs(resultVector.y), Math.abs(resultVector.x)) * 180 / Math.PI;\n\n\t\t\treturn {\n\t\t\t\tmagnitude,\n\t\t\t\tangleDegrees\n\t\t\t};\n\n\t\t}\n\t\treturn null;\n\t};\n\n\tprivate _applyDndReadyStyles = (): void => {\n\t\tthis._timeline.$task.classList.add(\"gantt_timeline_move_available\");\n\t};\n\n\tprivate _clearDndReadyStyles = (): void => {\n\t\tthis._timeline.$task.classList.remove(\"gantt_timeline_move_available\");\n\t};\n\n\tprivate _getScrollPosition = (timeline: any): IPoint => {\n\t\tconst gantt = this._gantt;\n\t\treturn {\n\t\t\tx: gantt.$ui.getView(timeline.$config.scrollX).getScrollState().position,\n\t\t\ty: gantt.$ui.getView(timeline.$config.scrollY).getScrollState().position\n\t\t};\n\t};\n\tprivate _countNewScrollPosition = (coords: IPoint): IPoint => {\n\t\tconst vector = this._calculateDirectionVector();\n\t\tlet shiftX = this._startPoint.x - coords.x;\n\t\tlet shiftY = this._startPoint.y - coords.y;\n\t\tif(vector){\n\t\t\tif(vector.angleDegrees < 15){\n\t\t\t\tshiftY = 0;\n\t\t\t} else if(vector.angleDegrees > 75){\n\t\t\t\tshiftX = 0;\n\t\t\t}\n\t\t}\n\n\t\tconst result = {\n\t\t\tx: this._scrollState.x + shiftX,\n\t\t\ty: this._scrollState.y + shiftY\n\t\t};\n\t\treturn result;\n\t};\n\tprivate _setScrollPosition = (timeline: any, coords: IPoint): void => {\n\t\tconst gantt = this._gantt;\n\t\trequestAnimationFrame(() => {\n\t\t\tgantt.scrollLayoutCell(timeline.$id, coords.x, coords.y);\n\t\t});\n\t};\n\tprivate _stopDrag = (event: Event): void => {\n\t\tconst gantt = this._gantt;\n\t\tthis._trace = [];\n\t\tgantt.$root.classList.remove(\"gantt_noselect\");\n\n\t\tif(this._originalReadonly !== undefined){\n\t\t\tgantt.config.readonly = this._originalReadonly;\n\t\t\tif(this._mouseDown && gantt.config.drag_timeline && gantt.config.drag_timeline.render){\n\t\t\t\tgantt.render();\n\t\t\t}\n\t\t}\n\n\t\tif(this._originAutoscroll !== undefined){\n\t\t\tgantt.config.autoscroll = this._originAutoscroll;\n\t\t}\n\n\t\tif(gantt.config.drag_timeline){\n\t\t\tconst { useKey } = gantt.config.drag_timeline;\n\t\t\tif (useKey && event[useKey] !== true) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\n\t\tthis._mouseDown = false;\n\t};\n\n\tprivate _startDrag = (event: any) : void => {\n\t\tconst gantt = this._gantt;\n\t\tthis._originAutoscroll = gantt.config.autoscroll;\n\t\tgantt.config.autoscroll = false;\n\n\t\tgantt.$root.classList.add(\"gantt_noselect\");\n\t\tthis._originalReadonly = gantt.config.readonly;\n\t\tgantt.config.readonly = true;\n\n\t\tif(gantt.config.drag_timeline && gantt.config.drag_timeline.render){\n\t\t\tgantt.render();\n\t\t}\n\n\t\tthis._trace = [];\n\t\tthis._mouseDown = true;\n\t\tconst { x, y } = this._getScrollPosition(this._timeline);\n\t\tthis._scrollState = { x, y };\n\t\tthis._startPoint = { x: event.clientX, y: event.clientY };\n\t\tthis._trace.push(this._startPoint);\n\t};\n}","export default function(gantt) {\n\n\t(function () {\n\t\tvar modalsStack = [];\n\n\t\tfunction isModal() {\n\t\t\treturn !!modalsStack.length;\n\t\t}\n\n\t\tfunction afterPopup(box) {\n\t\t\tsetTimeout(function () {\n\t\t\t\tif (!isModal()){\n\t\t\t\t\tif(!gantt.$destroyed){\n\t\t\t\t\t\tgantt.focus();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}, 1);\n\t\t}\n\n\t\tfunction startModal(box) {\n\t\t\tgantt.eventRemove(box, \"keydown\", trapFocus);\n\t\t\tgantt.event(box, \"keydown\", trapFocus);\n\t\t\tmodalsStack.push(box);\n\t\t\t//gantt.$keyboardNavigation.dispatcher.disable();\n\t\t}\n\n\t\tfunction endModal() {\n\t\t\tvar box = modalsStack.pop();\n\t\t\tif (box) {\n\t\t\t\tgantt.eventRemove(box, \"keydown\", trapFocus);\n\t\t\t}\n\t\t\tafterPopup(box);\n\n\t\t}\n\n\n\t\tfunction isTopModal(box) {\n\t\t\treturn box == modalsStack[modalsStack.length - 1];\n\t\t}\n\n\t\tfunction trapFocus(event) {\n\t\t\tvar target = event.currentTarget;\n\t\t\tif (!isTopModal(target)) return;\n\n\t\t\tgantt.$keyboardNavigation.trapFocus(target, event);\n\t\t}\n\n\t\tfunction traceLightbox() {\n\t\t\tstartModal(gantt.getLightbox());\n\t\t}\n\n\t\tgantt.attachEvent(\"onLightbox\", traceLightbox);\n\t\tgantt.attachEvent(\"onAfterLightbox\", endModal);\n\t\tgantt.attachEvent(\"onLightboxChange\", function () {\n\t\t\tendModal();\n\t\t\ttraceLightbox();\n\t\t});\n\n\n\t\tgantt.attachEvent(\"onAfterQuickInfo\", function () {\n\t\t\tafterPopup();\n\t\t});\n\n\t\tgantt.attachEvent(\"onMessagePopup\", function (box) {\n\t\t\tsaveFocus();\n\t\t\tstartModal(box);\n\t\t});\n\t\tgantt.attachEvent(\"onAfterMessagePopup\", function () {\n\t\t\tendModal();\n\t\t\trestoreFocus();\n\t\t});\n\n\t\tvar focusElement = null;\n\n\t\tfunction saveFocus() {\n\t\t\tfocusElement = gantt.utils.dom.getActiveElement();\n\t\t}\n\n\t\tfunction restoreFocus() {\n\t\t\tsetTimeout(function () {\n\t\t\t\tif (focusElement) {\n\t\t\t\t\tfocusElement.focus();\n\t\t\t\t\tfocusElement = null;\n\t\t\t\t}\n\t\t\t}, 1);\n\t\t}\n\n\t\tgantt.$keyboardNavigation.isModal = isModal;\n\n\n\t})();\n\n};","\ninterface IQuickInfoContainer{\n\tparent: HTMLElement;\n\txViewport: HTMLElement;\n\tyViewport: HTMLElement;\n}\n\nexport class QuickInfo {\n\tprivate _quickInfoTask: TaskID;\n\tprivate _quickInfoBoxId: number | string;\n\tprivate _quickInfoBox: HTMLElement;\n\tprivate _quickInfoReadonly: boolean | null;\n\tprivate _container: HTMLElement;\n\tprivate _gantt: any;\n\n\tconstructor(gantt: any) {\n\t\tthis._gantt = gantt;\n\t}\n\n\t// show at coordinates:\n\t// show(x: number, y: number)\n\t// show for a task:\n\t// show(id: TaskID)\n\tshow : {\n\t\t(x: number, y: number) : void;\n\t\t(id: TaskID) : void;\n\t} = (id: TaskID | number, y? : number) : void => {\n\t\tif (y === undefined) {\n\t\t\tthis._showForTask(id);\n\t\t} else {\n\t\t\tthis._showAtCoordinates(id as number, y);\n\t\t}\n\t};\n\n\thide = (forced?: boolean) : any => {\n\t\tconst gantt = this._gantt;\n\t\tconst qi = this._quickInfoBox;\n\t\tthis._quickInfoBoxId = 0;\n\t\tconst taskId = this._quickInfoTask;\n\t\tthis._quickInfoTask = null;\n\n\t\tif (qi && qi.parentNode){\n\n\t\t\tif (gantt.config.quick_info_detached) {\n\t\t\t\tgantt.callEvent(\"onAfterQuickInfo\", [taskId]);\n\t\t\t\treturn qi.parentNode.removeChild(qi);\n\t\t\t}\n\n\t\t\tqi.className += \" gantt_qi_hidden\";\n\t\t\tif (qi.style.right === \"auto\"){\n\t\t\t\tqi.style.left = \"-350px\";\n\t\t\t} else {\n\t\t\t\tqi.style.right = \"-350px\";\n\t\t\t}\n\n\t\t\tif (forced) {\n\t\t\t\tqi.style.left = qi.style.right = \"\";\n\t\t\t\tqi.parentNode.removeChild(qi);\n\t\t\t}\n\t\t\tgantt.callEvent(\"onAfterQuickInfo\", [taskId]);\n\t\t}\n\t};\n\n\tgetNode = (): HTMLElement => {\n\t\tif(this._quickInfoBox) {\n\t\t\treturn this._quickInfoBox;\n\t\t}\n\t\treturn null;\n\t};\n\n\tsetContainer = (container: string|HTMLElement): void => {\n\t\tif(container){\n\t\t\tthis._container = typeof container === \"string\" ? document.getElementById(container) : container;\n\t\t}\n\t};\n\n\tsetContent = (content?: IQuickInfoContent) => {\n\t\tconst gantt = this._gantt;\n\n\t\tconst defaultContent = {\n\t\t\ttaskId: null,\n\t\t\theader: {\n\t\t\t\ttitle: \"\",\n\t\t\t\tdate: \"\"\n\t\t\t},\n\t\t\tcontent: \"\",\n\t\t\tbuttons: gantt.config.quickinfo_buttons\n\t\t};\n\n\t\tif(!content){\n\t\t\tcontent = defaultContent;\n\t\t}\n\n\t\tif(!content.taskId){\n\t\t\tcontent.taskId = defaultContent.taskId;\n\t\t}\n\n\t\tif(!content.header){\n\t\t\tcontent.header = defaultContent.header;\n\t\t}\n\n\t\tif(!content.header.title){\n\t\t\tcontent.header.title = defaultContent.header.title;\n\t\t}\n\t\tif(!content.header.date){\n\t\t\tcontent.header.date = defaultContent.header.date;\n\t\t}\n\t\tif(!content.content){\n\t\t\tcontent.content = defaultContent.content;\n\t\t}\n\t\tif(!content.buttons){\n\t\t\tcontent.buttons = defaultContent.buttons;\n\t\t}\n\n\n\t\tlet qi = this.getNode();\n\t\tif(!qi){\n\t\t\tqi = this._createQuickInfoElement();\n\t\t}\n\n\t\tif(content.taskId){\n\t\t\tthis._quickInfoBoxId = content.taskId;\n\t\t}\n\n\t\tconst titleBox = qi.querySelector(\".gantt_cal_qi_title\") as HTMLElement;\n\t\tconst titleContent = titleBox.querySelector(\".gantt_cal_qi_tcontent\");\n\t\tconst titleDate = titleBox.querySelector(\".gantt_cal_qi_tdate\");\n\t\tconst main = qi.querySelector(\".gantt_cal_qi_content\");\n\t\tconst controls = qi.querySelector(\".gantt_cal_qi_controls\") as HTMLElement;\n\n\t\tgantt._waiAria.quickInfoHeader(qi, [content.header.title, content.header.date].join(\" \"));\n\n\t\ttitleContent.innerHTML = content.header.title;\n\t\ttitleDate.innerHTML = content.header.date;\n\n\t\tif(!content.header.title && !content.header.date){\n\t\t\ttitleBox.style.display = \"none\";\n\t\t}else{\n\t\t\ttitleBox.style.display = \"\";\n\t\t}\n\t\tmain.innerHTML = content.content;\n\n\t\tconst buttons = content.buttons;\n\t\tif(!buttons.length){\n\t\t\tcontrols.style.display = \"none\";\n\t\t}else{\n\t\t\tcontrols.style.display = \"\";\n\t\t}\n\t\tlet html = \"\";\n\t\tfor (let i = 0; i < buttons.length; i++){\n\n\t\t\tconst ariaAttr = gantt._waiAria.quickInfoButtonAttrString(gantt.locale.labels[buttons[i]]);\n\n\t\t\thtml += `<div class=\"gantt_qi_big_icon ${buttons[i]} dhx_gantt_${buttons[i]}\" title=\"${gantt.locale.labels[buttons[i]]}\" ${ariaAttr}>\n            <div class='dhx_menu_icon dhx_gantt_icon ${buttons[i]} gantt_menu_icon dhx_gantt_${buttons[i]}'></div>\n            <div>${gantt.locale.labels[buttons[i]]}</div>\n         </div>`;\n\t\t}\n\t\tcontrols.innerHTML = html;\n\n\t\tgantt.eventRemove(qi, \"click\", this._qiButtonClickHandler);\n\t\tgantt.eventRemove(qi, \"keypress\", this._qiKeyPressHandler);\n\n\t\tgantt.event(qi, \"click\", this._qiButtonClickHandler);\n\t\tgantt.event(qi, \"keypress\", this._qiKeyPressHandler);\n\t};\n\n\tprivate _qiButtonClickHandler = (ev) => {\n\t\tthis._qi_button_click(ev.target);\n\t};\n\n\tprivate _qiKeyPressHandler = (e) => {\n\n\t\tconst code = e.which;\n\t\tif (code === 13 || code === 32){\n\t\t\tsetTimeout(() => {\n\t\t\t\tthis._qi_button_click(e.target);\n\t\t\t},1);\n\t\t}\n\t};\n\n\tprivate _showAtCoordinates(x: number, y: number) : void {\n\t\tthis.hide(true);\n\t\tthis._quickInfoBoxId = 0;\n\t\tthis._quickInfoTask = null;\n\t\tif(!this._quickInfoBox){\n\t\t\tthis._createQuickInfoElement();\n\t\t\tthis.setContent();\n\t\t}\n\n\t\tthis._appendAtCoordinates(x, y);\n\t\tthis._gantt.callEvent(\"onQuickInfo\", [null]);\n\t}\n\n\tprivate _showForTask(id: TaskID) : void {\n\t\tconst gantt = this._gantt;\n\t\tif ((\n\t\t\tid === this._quickInfoBoxId &&\n\t\t\tgantt.utils.dom.isChildOf(this._quickInfoBox, document.body)\n\t\t) || !gantt.config.show_quick_info) {\n\t\t\t// not show if the quick info is already displayed for this task, or if it shouldn't be displayed\n\t\t\treturn;\n\t\t}\n\t\tthis.hide(true);\n\t\tconst offset = 6; // offset TASK <> QI-BOX in 'px'\n\t\tconst container = this._getContainer();\n\t\tconst pos = this._get_event_counter_part(id, offset, container.xViewport, container.yViewport);\n\n\t\tif (pos){\n\t\t\tthis._quickInfoBox = this._init_quick_info(id);\n\t\t\tthis._quickInfoTask = id;\n\t\t\tthis._quickInfoBox.className = this._prepare_quick_info_classname(id);\n\n\t\t\tthis._fill_quick_data(id);\n\t\t\tthis._show_quick_info(pos, offset);\n\t\t\tgantt.callEvent(\"onQuickInfo\", [id]);\n\t\t}\n\t}\n\n\tprivate _get_event_counter_part(id: TaskID, offset: number, xViewport: HTMLElement, yViewport: HTMLElement) : any {\n\t\tconst gantt = this._gantt;\n\t\tlet domEv = gantt.getTaskNode(id);\n\t\tif (!domEv) {\n\t\t\tdomEv = gantt.getTaskRowNode(id);\n\t\t\tif (!domEv) {\n\t\t\t\treturn null;\n\t\t\t}\n\t\t}\n\t\tlet left = 0;\n\t\tconst top = offset + domEv.offsetTop + domEv.offsetHeight;\n\n\t\tlet node = domEv;\n\n\t\tif (gantt.utils.dom.isChildOf(node, xViewport)) {\n\t\t\twhile (node && node !== xViewport){\n\t\t\t\tleft += node.offsetLeft;\n\t\t\t\tnode = node.offsetParent;\n\t\t\t}\n\t\t}\n\n\t\tconst scroll = gantt.getScrollState();\n\n\t\tif(node){\n\t\t\tconst dx = (left + domEv.offsetWidth/2) - scroll.x > (xViewport.offsetWidth/2) ? 1 : 0;\n\t\t\tconst dy = (top + domEv.offsetHeight/2) - scroll.y > (yViewport.offsetHeight/2) ? 1 : 0;\n\n\t\t\treturn { left, top, dx, dy, width:domEv.offsetWidth, height:domEv.offsetHeight };\n\t\t}\n\t\treturn null;\n\t}\n\n\tprivate _createQuickInfoElement() : HTMLElement {\n\t\tconst gantt = this._gantt;\n\t\tconst qi = document.createElement(\"div\");\n\t\tqi.className += \"gantt_cal_quick_info\";\n\t\tgantt._waiAria.quickInfoAttr(qi);\n\n\t\t// title\n\t\tconst ariaAttr = gantt._waiAria.quickInfoHeaderAttrString();\n\t\tvar html = `\n\t\t<div class=\"gantt_cal_qi_tcontrols\">\n\t\t\t<a class=\"gantt_cal_qi_close_btn dhx_gantt_icon dhx_gantt_icon_close\"></a>\n\t\t</div>\n\t\t<div class=\"gantt_cal_qi_title\" ${ariaAttr}>\n\t\t\t\t\n\t\t\t\t<div class=\"gantt_cal_qi_tcontent\"></div>\n\t\t\t\t<div class=\"gantt_cal_qi_tdate\"></div>\n\t\t\t</div>\n\t\t\t<div class=\"gantt_cal_qi_content\"></div>`;\n\n\t\t//buttons\n\t\thtml += \"<div class=\\\"gantt_cal_qi_controls\\\">\";\n\n\t\thtml += \"</div>\";\n\n\t\tqi.innerHTML = html;\n\n\n\t\tif (gantt.config.quick_info_detached) {\n\t\t\tconst container = this._getContainer();\n\t\t\tgantt.event(container.parent, \"scroll\", () => { this.hide(); });\n\t\t}\n\n\t\tthis._quickInfoBox = qi;\n\t\treturn qi;\n\t}\n\n\tprivate _init_quick_info(id: TaskID) : HTMLElement {\n\t\tconst gantt = this._gantt;\n\t\tconst task = gantt.getTask(id);\n\t\t\n\n\t\tif(typeof this._quickInfoReadonly === \"boolean\"){\n\t\t\tif(gantt.isReadonly(task) !== this._quickInfoReadonly){\n\t\t\t\tthis.hide(true);\n\t\t\t\tthis._quickInfoBox = null;\n\t\t\t}\n\t\t}\n\n\t\tthis._quickInfoReadonly = gantt.isReadonly(task);\n\n\t\tif (!this._quickInfoBox){\n\t\t\tthis._quickInfoBox = this._createQuickInfoElement();\n\t\t}\n\n\t\treturn this._quickInfoBox;\n\t}\n\n\tprivate _prepare_quick_info_classname(id: TaskID) : string {\n\t\tconst gantt = this._gantt;\n\t\tconst task = gantt.getTask(id);\n\t\tconst taskType = gantt.getTaskType(task);\n\n\t\tlet css = `gantt_cal_quick_info gantt_${taskType}`;\n\t\tconst template = gantt.templates.quick_info_class(task.start_date, task.end_date, task);\n\n\t\tif(template){\n\t\t\tcss += \" \" + template;\n\t\t}\n\t\treturn css;\n\t}\n\n\tprivate _fill_quick_data(id: TaskID) : void {\n\t\tconst gantt = this._gantt;\n\t\tconst ev = gantt.getTask(id);\n\n\t\tthis._quickInfoBoxId = id;\n\n\t\tlet allowedButtons = [];\n\t\tif (this._quickInfoReadonly){\n\t\t\tconst buttons = gantt.config.quickinfo_buttons;\n\t\t\tconst isEditor = {icon_delete: true, icon_edit: true};\n\t\t\tfor (let i = 0; i < buttons.length; i++){\n\t\t\t\tif(this._quickInfoReadonly && isEditor[buttons[i]]){\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\t\t\t\tallowedButtons.push(buttons[i]);\n\t\t\t}\n\t\t} else {\n\t\t\tallowedButtons = gantt.config.quickinfo_buttons;\n\t\t}\n\n\t\tthis.setContent({\n\t\t\theader: {\n\t\t\t\ttitle: gantt.templates.quick_info_title(ev.start_date, ev.end_date, ev),\n\t\t\t\tdate: gantt.templates.quick_info_date(ev.start_date, ev.end_date, ev)\n\t\t\t},\n\t\t\tcontent: gantt.templates.quick_info_content(ev.start_date, ev.end_date, ev),\n\t\t\tbuttons: allowedButtons\n\t\t});\n\t}\n\n\tprivate _appendAtCoordinates(x: number, y: number): void {\n\t\tconst qi = this._quickInfoBox;\n\t\tconst container = this._getContainer();\n\t\tif (!qi.parentNode ||\n\t\t\tqi.parentNode.nodeName.toLowerCase() === \"#document-fragment\"){ // IE8\n\t\t\tcontainer.parent.appendChild(qi);\n\t\t}\n\n\t\tqi.style.left = x + \"px\";\n\t\tqi.style.top = y + \"px\";\n\t}\n\n\tprivate _show_quick_info(pos: any, offset: number) : void {\n\t\tconst gantt = this._gantt;\n\t\tconst qi = this._quickInfoBox;\n\t\tif (gantt.config.quick_info_detached) {\n\t\t\tconst container = this._getContainer();\n\t\t\tif (!qi.parentNode ||\n\t\t\t\tqi.parentNode.nodeName.toLowerCase() === \"#document-fragment\"){ // IE8\n\t\t\t\tcontainer.parent.appendChild(qi);\n\t\t\t}\n\t\t\tconst width = qi.offsetWidth;\n\t\t\tconst popupHeight = qi.offsetHeight;\n\n\t\t\tconst scrolls = gantt.getScrollState();\n\t\t\tconst xViewport = container.xViewport;\n\t\t\tconst yViewport = container.yViewport;\n\t\t\tconst screenWidth = xViewport.offsetWidth + scrolls.x - width;\n\n\t\t\tconst relativePopupTop = pos.top - scrolls.y;\n\t\t\tconst relativePopupBottom = relativePopupTop + popupHeight;\n\n\t\t\tlet top = pos.top;\n\t\t\tif(relativePopupBottom > yViewport.offsetHeight / 2){\n\t\t\t\ttop = pos.top - (popupHeight + pos.height + 2*offset);\n\t\t\t\tif(top < scrolls.y && relativePopupBottom <= yViewport.offsetHeight){\n\t\t\t\t\ttop = pos.top;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (top < scrolls.y) {\n\t\t\t\ttop = scrolls.y;\n\t\t\t}\n\n\t\t\tconst x = Math.min(Math.max(scrolls.x, pos.left - pos.dx*(width - pos.width)), screenWidth);\n\t\t\tconst y = top;\n\n\t\t\tthis._appendAtCoordinates(x, y);\n\t\t} else {\n\t\t\tqi.style.top = 20 + \"px\";\n\t\t\tif (pos.dx === 1){\n\t\t\t\tqi.style.right = \"auto\";\n\t\t\t\tqi.style.left = \"-300px\";\n\n\t\t\t\tsetTimeout(() => {\n\t\t\t\t\tqi.style.left = \"10px\";\n\t\t\t\t},1);\n\t\t\t} else {\n\t\t\t\tqi.style.left = \"auto\";\n\t\t\t\tqi.style.right = \"-300px\";\n\n\t\t\t\tsetTimeout(() => {\n\t\t\t\t\tqi.style.right = \"10px\";\n\t\t\t\t},1);\n\t\t\t}\n\t\t\tqi.className += \" gantt_qi_\"+(pos.dx === 1 ? \"left\" : \"right\");\n\t\t\tgantt.$root.appendChild(qi);\n\t\t}\n\t}\n\n\tprivate _qi_button_click(node: any) : void {\n\t\tconst gantt = this._gantt;\n\t\tconst box = this._quickInfoBox;\n\t\tif (!node || node === box){\n\t\t\treturn;\n\t\t}\n\t\tif(node.closest(\".gantt_cal_qi_close_btn\")){\n\t\t\tthis.hide();\n\t\t\treturn;\n\t\t}\n\n\t\tconst mask = node.className;\n\t\tif (mask.indexOf(\"_icon\") !== -1){\n\t\t\tconst id = this._quickInfoBoxId;\n\t\t\tgantt.$click.buttons[mask.split(\" \")[1].replace(\"icon_\",\"\")](id);\n\t\t} else {\n\t\t\tthis._qi_button_click(node.parentNode);\n\t\t}\n\t}\n\n\tprivate _getContainer(): IQuickInfoContainer{\n\t\tconst gantt = this._gantt;\n\t\tlet container = this._container ? this._container : gantt.$task_data;\n\t\tif (container && container.offsetHeight && container.offsetWidth) {\n\t\t\treturn {\n\t\t\t\tparent: container,\n\t\t\t\txViewport: gantt.$task,\n\t\t\t\tyViewport: gantt.$task_data\n\t\t\t};\n\t\t}\n\t\tcontainer = this._container ? this._container : gantt.$grid_data;\n\t\tif (container && container.offsetHeight && container.offsetWidth) {\n\t\t\treturn {\n\t\t\t\tparent: container,\n\t\t\t\txViewport: gantt.$grid,\n\t\t\t\tyViewport: gantt.$grid_data\n\t\t\t};\n\t\t}\n\n\t\treturn {\n\t\t\tparent: this._container ? this._container : gantt.$layout,\n\t\t\txViewport: gantt.$layout,\n\t\t\tyViewport: gantt.$layout\n\t\t};\n\t}\n}\n","import * as helpers from \"./helpers\";\n\nvar plainObjectConstructor = ({}).constructor.toString();\nfunction isCustomType(object){\n\tvar constructorString = object.constructor.toString();\n\n\treturn constructorString !== plainObjectConstructor;\n}\n\nfunction copy(object) {\n\tvar i, result; // iterator, types array, result\n\n\tif (object && typeof object == \"object\") {\n\n\t\tswitch (true){\n\t\t\tcase (helpers.isDate(object)):\n\t\t\t\tresult = new Date(object);\n\t\t\t\tbreak;\n\t\t\tcase (helpers.isArray(object)):\n\t\t\t\tresult = new Array(object.length);\n\t\t\t\tfor(i = 0; i < object.length; i++){\n\t\t\t\t\tresult[i] = copy(object[i]);\n\t\t\t\t}\n\t\t\t\tbreak;\n\t/*\t\tcase (helpers.isStringObject(object)):\n\t\t\t\tresult = new String(object);\n\t\t\t\tbreak;\n\t\t\tcase (helpers.isNumberObject(object)):\n\t\t\t\tresult = new Number(object);\n\t\t\t\tbreak;\n\t\t\tcase (helpers.isBooleanObject(object)):\n\t\t\t\tresult = new Boolean(object);\n\t\t\t\tbreak;*/\n\t\t\tdefault:\n\t\t\t\tif(isCustomType(object)){\n\t\t\t\t\tresult = Object.create(object);\n\t\t\t\t}else{\n\t\t\t\t\tresult = {};\n\t\t\t\t}\n\n\t\t\t\tfor (i in object) {\n\t\t\t\t\tif (Object.prototype.hasOwnProperty.apply(object, [i]))\n\t\t\t\t\t\tresult[i] = copy(object[i]);\n\t\t\t\t}\n\t\t\tbreak;\n\t\t}\n\t}\n\treturn result || object;\n}\n\nfunction mixin (target, source, force){\n\tfor (var f in source)\n\t\tif (((target[f] === undefined) || force)) target[f]=source[f];\n\treturn target;\n}\n\nfunction defined(obj) {\n\treturn typeof(obj) != \"undefined\";\n}\n\nvar seed;\nfunction uid() {\n\tif (!seed)\n\t\tseed = (new Date()).valueOf();\n\n\tseed++;\n\treturn seed;\n}\n\n//creates function with specified \"this\" pointer\nfunction bind(functor, object){\n\tif(functor.bind)\n\t\treturn functor.bind(object);\n\telse\n\t\treturn function(){ return functor.apply(object,arguments); };\n}\n\nfunction event(el, event, handler, capture){\n\tif (el.addEventListener)\n\t\tel.addEventListener(event, handler, capture === undefined ? false : capture);\n\n\telse if (el.attachEvent)\n\t\tel.attachEvent(\"on\"+event, handler);\n}\n\nfunction eventRemove(el, event, handler, capture){\n\tif (el.removeEventListener)\n\t\tel.removeEventListener(event, handler, capture === undefined ? false : capture);\n\n\telse if (el.detachEvent)\n\t\tel.detachEvent(\"on\"+event, handler);\n}\n\nexport {\n\tcopy,\n\tdefined,\n\tmixin,\n\tuid,\n\tbind,\n\tevent,\n\teventRemove\n};","import * as utils from \"../../../utils/utils\";\n\nfunction createScope(addEvent, removeEvent) {\n\taddEvent = addEvent || utils.event;\n\tremoveEvent = removeEvent || utils.eventRemove;\n\n\tvar handlers = [];\n\n\tvar eventScope = {\n\t\tattach: function(el, event, callback, capture){\n\t\t\thandlers.push({element: el, event:event, callback: callback, capture: capture});\n\t\t\taddEvent(el, event, callback, capture);\n\t\t},\n\t\tdetach: function(el, event, callback, capture){\n\t\t\tremoveEvent(el, event, callback, capture);\n\t\t\tfor(var i = 0; i < handlers.length; i++){\n\t\t\t\tvar handler = handlers[i];\n\t\t\t\tif (handler.element === el && handler.event === event && handler.callback === callback && handler.capture === capture) {\n\t\t\t\t\thandlers.splice(i, 1);\n\t\t\t\t\ti--;\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t\tdetachAll: function () {\n\t\t\tvar staticArray = handlers.slice();\n\t\t\t// original handlers array can be spliced on every iteration\n\t\t\tfor (var i = 0; i < staticArray.length; i++){\n\t\t\t\tvar handler = staticArray[i];\n\t\t\t\teventScope.detach(handler.element, handler.event, handler.callback, handler.capture);\n\t\t\t\teventScope.detach(handler.element, handler.event, handler.callback, undefined);\n\t\t\t\teventScope.detach(handler.element, handler.event, handler.callback, false);\n\t\t\t\teventScope.detach(handler.element, handler.event, handler.callback, true);\n\t\t\t}\n\t\t\thandlers.splice(0, handlers.length);\n\t\t},\n\t\textend: function(){\n\t\t\treturn createScope(this.event, this.eventRemove);\n\t\t}\n\t};\n\n\treturn eventScope;\n}\n\nexport default createScope;","import * as domHelpers from \"../../core/ui/utils/dom_helpers\";\n\n/* eslint-disable no-restricted-globals */\n\ninterface IViewPosition{\n\ttop: number;\n\tleft: number;\n}\n\ninterface IViewBox extends IViewPosition{\n\twidth: number;\n\theight: number;\n\tbottom: number;\n\tright: number;\n}\n\nexport class Tooltip {\n\tprivate _root: HTMLElement;\n\tprivate _tooltipNode: HTMLElement;\n\tprivate _gantt: any;\n\n\tconstructor(gantt: any){\n\t\tthis._gantt = gantt;\n\t}\n\n\tgetNode() : HTMLElement {\n\t\tconst gantt = this._gantt;\n\t\tif (!this._tooltipNode){\n\t\t\tthis._tooltipNode = document.createElement(\"div\");\n\t\t\tthis._tooltipNode.className = \"gantt_tooltip\";\n\t\t\tgantt._waiAria.tooltipAttr(this._tooltipNode);\n\t\t}\n\t\treturn this._tooltipNode;\n\t}\n\n\tsetViewport(node: HTMLElement):Tooltip{\n\t\tthis._root = node;\n\t\treturn this;\n\t}\n\n\tshow(left: number, top: number): Tooltip;\n\tshow(event: MouseEvent): Tooltip;\n\tshow(left: number | MouseEvent, top?: number): Tooltip {\n\t\tconst gantt = this._gantt;\n\t\tconst container = document.body;\n\t\tconst node = this.getNode();\n\n\t\tif(!domHelpers.isChildOf(node, container)){\n\t\t\tthis.hide();\n\t\t\t// GS-2463. Don't put the node beyond the body coordinates\n\t\t\t// as it may trigger the resize event\n\t\t\tnode.style.top = node.style.top || \"0px\";\n\t\t\tnode.style.left = node.style.left || \"0px\";\n\t\t\tcontainer.appendChild(node);\n\t\t}\n\n\t\tif (this._isLikeMouseEvent(left)) {\n\t\t\tconst position = this._calculateTooltipPosition(left as MouseEvent);\n\t\t\ttop = position.top;\n\t\t\tleft = position.left;\n\t\t}\n\n\t\tnode.style.top = top + \"px\";\n\t\tnode.style.left = left + \"px\";\n\n\t\tgantt._waiAria.tooltipVisibleAttr(node);\n\t\treturn this;\n\t}\n\thide() : Tooltip{\n\t\tconst gantt = this._gantt;\n\t\tconst node = this.getNode();\n\t\tif(node && node.parentNode){\n\t\t\tnode.parentNode.removeChild(node);\n\t\t}\n\t\tgantt._waiAria.tooltipHiddenAttr(node);\n\t\treturn this;\n\t}\n\n\tsetContent(html: string) : Tooltip{\n\t\tconst node = this.getNode();\n\t\tnode.innerHTML = html;\n\t\treturn this;\n\t}\n\n\t// it is for salesforce, because it proxies event to it own events\n\tprivate _isLikeMouseEvent(event: any): boolean {\n\t\tif (!event || typeof event !== \"object\") {\n\t\t\treturn false;\n\t\t}\n\t\treturn \"clientX\" in event && \"clientY\" in event;\n\t}\n\n\tprivate _getViewPort() : HTMLElement {\n\t\treturn this._root || document.body;\n\t}\n\n\n\tprivate _calculateTooltipPosition(event: MouseEvent): IViewPosition{\n\t\tconst gantt = this._gantt;\n\t\t// top/left coordinates inside the viewport by mouse position\n\t\tconst viewport =  this._getViewPortSize();\n\t\tconst tooltipNode = this.getNode();\n\t\tconst tooltip: IViewBox = {\n\t\t\ttop:0,\n\t\t\tleft: 0,\n\t\t\twidth: tooltipNode.offsetWidth,\n\t\t\theight: tooltipNode.offsetHeight,\n\t\t\tbottom: 0,\n\t\t\tright: 0\n\t\t};\n\n\t\tconst offsetX = gantt.config.tooltip_offset_x;\n\t\tconst offsetY = gantt.config.tooltip_offset_y;\n\n\t\tconst container = document.body;\n\t\tconst mouse = domHelpers.getRelativeEventPosition(event, container);\n\t\tconst containerPos = domHelpers.getNodePosition(container);\n\t\tmouse.y += containerPos.y; // to fix margin collapsing\n\n\t\ttooltip.top = mouse.y;\n\t\ttooltip.left = mouse.x;\n\t\ttooltip.top += offsetY;\n\t\ttooltip.left += offsetX;\n\t\ttooltip.bottom = tooltip.top + tooltip.height;\n\t\ttooltip.right = tooltip.left + tooltip.width;\n\n\t\tconst scrollTop = window.scrollY + container.scrollTop; // to fix margin collapsing\n\t\t// edge cases when the tooltip element can be partially hidden by edges of the viewport\n\t\tif(tooltip.top < viewport.top - scrollTop){\n\t\t\ttooltip.top = viewport.top;\n\t\t\ttooltip.bottom = tooltip.top + tooltip.height;\n\t\t}else if(tooltip.bottom > viewport.bottom){\n\t\t\ttooltip.bottom = viewport.bottom;\n\t\t\ttooltip.top = tooltip.bottom - tooltip.height;\n\t\t}\n\n\t\tif(tooltip.left < viewport.left){\n\t\t\ttooltip.left = viewport.left;\n\t\t\ttooltip.right = viewport.left + tooltip.width;\n\t\t}else if(tooltip.right > viewport.right){\n\t\t\ttooltip.right = viewport.right;\n\t\t\ttooltip.left = tooltip.right - tooltip.width;\n\t\t}\n\n\t\tif(mouse.x >= tooltip.left && mouse.x <= tooltip.right) {\n\t\t\ttooltip.left = mouse.x - tooltip.width - offsetX;\n\t\t\ttooltip.right = tooltip.left + tooltip.width;\n\t\t}\n\n\t\tif(mouse.y >= tooltip.top && mouse.y <= tooltip.bottom) {\n\t\t\ttooltip.top = mouse.y - tooltip.height - offsetY;\n\t\t\ttooltip.bottom = tooltip.top + tooltip.height;\n\t\t}\n\n\t\treturn tooltip;\n\t}\n\n\tprivate _getViewPortSize() : IViewBox {\n\t\tconst gantt = this._gantt;\n\t\tconst container = this._getViewPort();\n\t\tlet viewport = container;\n\t\tlet scrollTop = window.scrollY + document.body.scrollTop;\n\t\tlet scrollLeft = window.scrollX + document.body.scrollLeft;\n\t\tlet pos;\n\t\t// support for the initial tooltip mode where the tooltip element was attached to the data area of gantt\n\t\tif(container === gantt.$task_data){\n\t\t\tviewport = gantt.$task;\n\t\t\tscrollTop = 0;\n\t\t\tscrollLeft = 0;\n\t\t\tpos = domHelpers.getNodePosition(gantt.$task);\n\t\t}else{\n\t\t\tpos = domHelpers.getNodePosition(viewport);\n\t\t}\n\t\treturn {\n\t\t\tleft:pos.x + scrollLeft,\n\t\t\ttop: pos.y + scrollTop,\n\t\t\twidth: pos.width,\n\t\t\theight: pos.height,\n\t\t\tbottom: pos.y + pos.height + scrollTop,\n\t\t\tright: pos.x + pos.width + scrollLeft\n\t\t};\n\t}\n}\n","import domEventsScope from \"../../core/ui/utils/dom_event_scope\";\nimport * as domHelpers from \"../../core/ui/utils/dom_helpers\";\nimport * as helpers from \"../../utils/helpers\";\nimport { Tooltip } from \"./tooltip\";\n\ninterface ITrackerTarget {\n\tselector: string;\n\tonmouseenter: (event: MouseEvent, node: HTMLElement) => void;\n\tonmousemove: (event: MouseEvent, node: HTMLElement) => void;\n\tonmouseleave: (event: MouseEvent, node: HTMLElement) => void;\n\tglobal: boolean;\n}\n\ninterface ITooltipConfig {\n\tselector: string;\n\thtml: (event: MouseEvent, node: HTMLElement) => string;\n\tglobal: boolean;\n}\n\nexport class TooltipManager{\n\ttooltip: Tooltip;\n\tprotected _domEvents: any;\n\tprivate _listeners: object = {};\n\tprivate _gantt: any;\n\tprivate delayShow: any;\n\tprivate delayHide: any;\n\n\tconstructor(gantt: any) {\n\t\tthis.tooltip = new Tooltip(gantt);\n\t\tthis._gantt = gantt;\n\t\tthis._domEvents = domEventsScope();\n\t\tthis._initDelayedFunctions();\n\t}\n\n\tdestructor(): void{\n\t\tthis.tooltip.hide();\n\t\tthis._domEvents.detachAll();\n\t}\n\thideTooltip(): void{\n\t\tthis.delayHide();\n\t}\n\tattach(config: ITrackerTarget): void {\n\t\tlet root = document.body;\n\t\tconst gantt = this._gantt;\n\t\tif(!config.global){\n\t\t\troot = gantt.$root;\n\t\t}\n\n\t\tlet watchableTarget = null;\n\t\tconst handler = (event) => {\n\t\t\tconst eventTarget = domHelpers.getTargetNode(event);\n\t\t\tconst targetNode = domHelpers.closest(eventTarget, config.selector);\n\t\t\tif(domHelpers.isChildOf(eventTarget, this.tooltip.getNode())){\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst doOnMouseEnter = () => {\n\t\t\t\twatchableTarget = targetNode;\n\t\t\t\tconfig.onmouseenter(event, targetNode);\n\t\t\t};\n\n\t\t\tif(watchableTarget){\n\t\t\t\tif(targetNode && targetNode === watchableTarget){\n\t\t\t\t\tconfig.onmousemove(event, targetNode);\n\t\t\t\t}else{\n\t\t\t\t\tconfig.onmouseleave(event, watchableTarget);\n\t\t\t\t\twatchableTarget = null;\n\n\t\t\t\t\tif(targetNode && targetNode !== watchableTarget){\n\t\t\t\t\t\tdoOnMouseEnter();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}else{\n\t\t\t\tif(targetNode){\n\t\t\t\t\tdoOnMouseEnter();\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\n\t\tthis.detach(config.selector);\n\t\tthis._domEvents.attach(root, \"mousemove\", handler);\n\t\tthis._listeners[config.selector] = {\n\t\t\tnode: root,\n\t\t\thandler\n\t\t};\n\t}\n\n\tdetach(selector: string): void {\n\t\tconst listener = this._listeners[selector];\n\t\tif(listener){\n\t\t\tthis._domEvents.detach(listener.node, \"mousemove\", listener.handler);\n\t\t}\n\t}\n\n\ttooltipFor(config: ITooltipConfig): void {\n\t\tconst cloneDomEvent = (event: MouseEvent) => {\n\t\t\tlet clone = event;\n\t\t\t// making events survive timeout in ie\n\t\t\t// tslint:disable-next-line no-string-literal\n\t\t\tif(document[\"createEventObject\"] && !document.createEvent){\n\t\t\t\t// tslint:disable-next-line no-string-literal\n\t\t\t\tclone = document[\"createEventObject\"](event);\n\t\t\t}\n\t\t\treturn clone;\n\t\t};\n\t\tthis._initDelayedFunctions();\n\t\tthis.attach({\n\t\t\tselector: config.selector,\n\t\t\tglobal: config.global,\n\t\t\tonmouseenter:(event: MouseEvent, node: HTMLElement) => {\n\t\t\t\tconst html = config.html(event, node);\n\t\t\t\tif(html){\n\t\t\t\t\tthis.delayShow(cloneDomEvent(event), html);\n\t\t\t\t}\n\t\t\t},\n\t\t\tonmousemove:(event: MouseEvent, node: HTMLElement) => {\n\t\t\t\tconst html = config.html(event, node);\n\t\t\t\tif(html){\n\t\t\t\t\tthis.delayShow(cloneDomEvent(event), html);\n\t\t\t\t}else{\n\t\t\t\t\tthis.delayShow.$cancelTimeout();\n\t\t\t\t\tthis.delayHide();\n\t\t\t\t}\n\t\t\t},\n\t\t\tonmouseleave:() => {\n\t\t\t\tthis.delayShow.$cancelTimeout();\n\t\t\t\tthis.delayHide();\n\t\t\t}\n\t\t});\n\t}\n\n\tprivate _initDelayedFunctions(){\n\t\tconst gantt = this._gantt;\n\t\t// reset delayed functions in order to apply current values of tooltip_timeout\n\t\tif(this.delayShow){\n\t\t\tthis.delayShow.$cancelTimeout();\n\t\t}\n\t\tif(this.delayHide){\n\t\t\tthis.delayHide.$cancelTimeout();\n\t\t}\n\t\tthis.tooltip.hide();\n\n\t\tthis.delayShow = helpers.delay((event: MouseEvent, html: string) => {\n\t\t\tif(gantt.callEvent(\"onBeforeTooltip\", [event]) === false) {\n\t\t\t\tthis.tooltip.hide();\n\t\t\t} else {\n\t\t\t\tthis.tooltip.setContent(html);\n\t\t\t\tthis.tooltip.show(event);\n\t\t\t}\n\t\t}, gantt.config.tooltip_timeout || 1);\n\n\t\tthis.delayHide = helpers.delay(() => {\n\t\t\tthis.delayShow.$cancelTimeout();\n\t\t\tthis.tooltip.hide();\n\t\t}, gantt.config.tooltip_hide_timeout || 1);\n\t}\n\n}","import { IInlineEditState, IMonitor, IUndo, IUndoCommand, TActionType, TEntityType, TUndoValue } from \"./types\";\n\nconst noTrack = {\n\tonBeforeUndo: \"onAfterUndo\",\n\tonBeforeRedo: \"onAfterRedo\"\n};\n\nconst batchActions = [\n\t\"onTaskDragStart\",\n\t\"onAfterTaskUpdate\",\n\t\"onAfterParentExpand\",\n\t\"onAfterTaskDelete\",\n\t\"onBeforeBatchUpdate\"\n];\n\nexport class Monitor implements IMonitor {\n\tprivate _batchAction = null;\n\tprivate _batchMode = false;\n\tprivate _ignore = false;\n\tprivate _ignoreMoveEvents = false;\n\tprivate _initialTasks = {};\n\tprivate _initialLinks = {};\n\tprivate _nestedTasks =  {};\n\tprivate _nestedLinks = {};\n\tprivate _timeout;\n\tprivate _gantt: any;\n\tprivate _undo: IUndo;\n\n\tconstructor(undo: IUndo, gantt: any) {\n\t\tthis._undo = undo;\n\t\tthis._gantt = gantt;\n\t\tthis._attachEvents();\n\t}\n\n\tstore(id: TaskID | LinkID, type: TEntityType, overwrite: boolean = false) {\n\t\tif (type === this._gantt.config.undo_types.task) {\n\t\t\treturn this._storeTask(id, overwrite);\n\t\t}\n\t\tif (type === this._gantt.config.undo_types.link) {\n\t\t\treturn this._storeLink(id, overwrite);\n\t\t}\n\t\treturn false;\n\t}\n\tisMoveEventsIgnored() {\n\t\treturn this._ignoreMoveEvents;\n\t}\n\ttoggleIgnoreMoveEvents(newValue?: boolean) {\n\t\tthis._ignoreMoveEvents = newValue || false;\n\t}\n\tstartIgnore() {\n\t\tthis._ignore = true;\n\t}\n\tstopIgnore() {\n\t\tthis._ignore = false;\n\t}\n\tstartBatchAction() {\n\t\t// try catching updates made from event handlers using timeout\n\t\tif (!this._timeout){\n\t\t\tthis._timeout = setTimeout(() => {\n\t\t\t\tthis.stopBatchAction();\n\t\t\t\tthis._timeout = null;\n\t\t\t}, 10);\n\t\t}\n\n\n\t\tif (this._ignore || this._batchMode) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis._batchMode = true;\n\t\tthis._batchAction = this._undo.action.create();\n\t}\n\tstopBatchAction() {\n\t\tif (this._ignore) {\n\t\t\treturn;\n\t\t}\n\t\tconst undo = this._undo;\n\t\tif (this._batchAction) {\n\t\t\tundo.logAction(this._batchAction);\n\t\t}\n\t\tthis._batchMode = false;\n\t\tthis._batchAction = null;\n\t}\n\tonTaskAdded(task: ITask) {\n\t\tif (!this._ignore) {\n\t\t\tthis._storeTaskCommand(task, this._undo.command.type.add);\n\t\t}\n\t}\n\tonTaskUpdated(task: ITask) {\n\t\tif (!this._ignore) {\n\t\t\tthis._storeTaskCommand(task, this._undo.command.type.update);\n\t\t}\n\t}\n\tonTaskMoved(task: ITask) {\n\t\tif (!this._ignore) {\n\t\t\t(task as any).$local_index = this._gantt.getTaskIndex(task.id);\n\t\t\tconst oldValue = this.getInitialTask(task.id);\n\t\t\tif((task as any).$local_index === oldValue.$local_index &&\n\t\t\t\tthis._gantt.getParent(task) === this._gantt.getParent(oldValue)){\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\tthis._storeEntityCommand(\n\t\t\t\ttask,\n\t\t\t\tthis.getInitialTask(task.id),\n\t\t\t\tthis._undo.command.type.move,\n\t\t\t\tthis._undo.command.entity.task\n\t\t\t);\n\t\t}\n\t}\n\tonTaskDeleted(task: ITask) {\n\t\tif (!this._ignore) {\n\t\t\tthis._storeTaskCommand(task, this._undo.command.type.remove);\n\t\t\tif (this._nestedTasks[task.id]) {\n\t\t\t\tconst children = this._nestedTasks[task.id];\n\t\t\t\tfor (let i = 0; i < children.length; i++) {\n\t\t\t\t\tthis._storeTaskCommand(children[i], this._undo.command.type.remove);\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (this._nestedLinks[task.id]) {\n\t\t\t\tconst childrenLinks = this._nestedLinks[task.id];\n\t\t\t\tfor (let i = 0; i < childrenLinks.length; i++) {\n\t\t\t\t\tthis._storeLinkCommand(childrenLinks[i], this._undo.command.type.remove);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\tonLinkAdded(link: ILink) {\n\t\tif (!this._ignore) {\n\t\t\tthis._storeLinkCommand(link, this._undo.command.type.add);\n\t\t}\n\t}\n\tonLinkUpdated(link: ILink) {\n\t\tif (!this._ignore) {\n\t\t\tthis._storeLinkCommand(link, this._undo.command.type.update);\n\t\t}\n\t}\n\tonLinkDeleted(link: ILink) {\n\t\tif (!this._ignore) {\n\t\t\tthis._storeLinkCommand(link, this._undo.command.type.remove);\n\t\t}\n\t}\n\tsetNestedTasks(id: TaskID, taskIds: TaskID[]) {\n\t\tconst gantt = this._gantt;\n\t\tlet task = null;\n\t\tconst tasks = [];\n\t\tlet\tlinkIds = this._getLinks(gantt.getTask(id));\n\n\t\tfor (let i = 0; i < taskIds.length; i++) {\n\t\t\ttask = this.setInitialTask(taskIds[i]);\n\t\t\tlinkIds = linkIds.concat(this._getLinks(task));\n\t\t\ttasks.push(task);\n\t\t}\n\n\t\tconst uniqueLinks = {};\n\t\tfor (let i = 0; i < linkIds.length; i++) {\n\t\t\tuniqueLinks[linkIds[i]] = true;\n\t\t}\n\t\tconst links = [];\n\t\tfor (const i in uniqueLinks) {\n\t\t\tlinks.push(this.setInitialLink(i));\n\t\t}\n\t\tthis._nestedTasks[id] = tasks;\n\t\tthis._nestedLinks[id] = links;\n\t}\n\tsetInitialTask(id: TaskID, overwrite?: boolean) {\n\t\tconst gantt = this._gantt;\n\t\tif (overwrite || (!this._initialTasks[id] || !this._batchMode)) {\n\t\t\tconst task = gantt.copy(gantt.getTask(id));\n\t\t\ttask.$index = gantt.getGlobalTaskIndex(id);\n\t\t\ttask.$local_index = gantt.getTaskIndex(id);\n\t\t\tthis.setInitialTaskObject(id, task);\n\t\t}\n\t\treturn this._initialTasks[id];\n\t}\n\tgetInitialTask(id: TaskID) {\n\t\treturn this._initialTasks[id];\n\t}\n\tclearInitialTasks() {\n\t\tthis._initialTasks = {};\n\t}\n\tsetInitialTaskObject(id: TaskID, object: ITask) {\n\t\tthis._initialTasks[id] = object;\n\t}\n\tsetInitialLink(id: LinkID, overwrite?: boolean) {\n\t\tif (!this._initialLinks[id] || !this._batchMode) {\n\t\t\tthis._initialLinks[id] = this._gantt.copy(this._gantt.getLink(id));\n\t\t}\n\t\treturn this._initialLinks[id];\n\t}\n\tgetInitialLink(id: LinkID) {\n\t\treturn this._initialLinks[id];\n\t}\n\tclearInitialLinks() {\n\t\tthis._initialLinks = {};\n\t}\n\tprivate _attachEvents() {\n\t\tlet deleteCacheCooldown = null;\n\t\tconst gantt = this._gantt;\n\n\t\tconst saveInitialAll = () => {\n\t\t\tif (!deleteCacheCooldown) {\n\t\t\t\tdeleteCacheCooldown = setTimeout(() => {\n\t\t\t\t\tdeleteCacheCooldown = null;\n\t\t\t\t});\n\n\t\t\t\tthis.clearInitialTasks();\n\t\t\t\tgantt.eachTask((task: ITask) => {\n\t\t\t\t\tthis.setInitialTask(task.id);\n\t\t\t\t});\n\n\t\t\t\tthis.clearInitialLinks();\n\t\t\t\tgantt.getLinks().forEach((link: ILink) => {\n\t\t\t\t\tthis.setInitialLink(link.id);\n\t\t\t\t});\n\t\t\t}\n\t\t};\n\t\tconst getMoveObjectByTaskId = (id: TaskID) => {\n\t\t\treturn gantt.copy(gantt.getTask(id));\n\t\t};\n\n\t\tfor (const i in noTrack) {\n\t\t\tgantt.attachEvent(i, () => {\n\t\t\t\tthis.startIgnore();\n\t\t\t\treturn true;\n\t\t\t});\n\t\t\tgantt.attachEvent(noTrack[i], () => {\n\t\t\t\tthis.stopIgnore();\n\t\t\t\treturn true;\n\t\t\t});\n\t\t}\n\n\t\tfor (let i  = 0; i < batchActions.length; i++) {\n\t\t\tgantt.attachEvent(batchActions[i], () => {\n\t\t\t\tthis.startBatchAction();\n\t\t\t\treturn true;\n\t\t\t});\n\t\t}\n\n\t\tgantt.attachEvent(\"onParse\", () => {\n\t\t\tthis._undo.clearUndoStack();\n\t\t\tthis._undo.clearRedoStack();\n\t\t\tsaveInitialAll();\n\t\t});\n\t\tgantt.attachEvent(\"onAfterTaskAdd\", (id: TaskID, task: ITask) => {\n\t\t\tthis.setInitialTask(id, true);\n\t\t\tthis.onTaskAdded(task);\n\t\t});\n\t\tgantt.attachEvent(\"onAfterTaskUpdate\", (id: TaskID, task: ITask) => {\n\t\t\tthis.onTaskUpdated(task);\n\t\t});\n\t\tgantt.attachEvent(\"onAfterParentExpand\", (id: TaskID, task: ITask) => {\n\t\t\tthis.onTaskUpdated(task);\n\t\t});\n\t\tgantt.attachEvent(\"onAfterTaskDelete\", (id: TaskID, task: ITask) => {\n\t\t\tthis.onTaskDeleted(task);\n\t\t});\n\t\tgantt.attachEvent(\"onAfterLinkAdd\", (id: LinkID, link: ILink) => {\n\t\t\tthis.setInitialLink(id, true);\n\t\t\tthis.onLinkAdded(link);\n\t\t});\n\t\tgantt.attachEvent(\"onAfterLinkUpdate\", (id: LinkID, link: ILink) => {\n\t\t\tthis.onLinkUpdated(link);\n\t\t});\n\t\tgantt.attachEvent(\"onAfterLinkDelete\", (id: LinkID, link: ILink) => {\n\t\t\tthis.onLinkDeleted(link);\n\t\t});\n\t\tgantt.attachEvent(\"onRowDragEnd\", (id: TaskID, target: TaskID) => {\n\t\t\tthis.onTaskMoved(getMoveObjectByTaskId(id));\n\t\t\tthis.toggleIgnoreMoveEvents();\n\t\t\treturn true;\n\t\t});\n\t\tgantt.attachEvent(\"onBeforeTaskDelete\", (id: TaskID) => {\n\t\t\tthis.store(id, gantt.config.undo_types.task);\n\t\t\tconst nested = [];\n\n\t\t\t// remember task indexes in case their being deleted in a loop, so they could be restored in the correct order\n\t\t\tsaveInitialAll();\n\n\t\t\tgantt.eachTask((task: ITask) => {\n\t\t\t\tnested.push(task.id);\n\t\t\t}, id);\n\t\t\tthis.setNestedTasks(id, nested);\n\t\t\treturn true;\n\t\t});\n\t\tconst datastore = gantt.getDatastore(\"task\");\n\n\t\tdatastore.attachEvent(\"onBeforeItemMove\", (id: TaskID, parent: TaskID, tindex: number) => {\n\t\t\tif (!this.isMoveEventsIgnored()) {\n\t\t\t\tsaveInitialAll();\n\t\t\t}\n\t\t\treturn true;\n\t\t});\n\n\t\tdatastore.attachEvent(\"onAfterItemMove\", (id: TaskID, parent: TaskID, tindex: number) => {\n\t\t\tif (!this.isMoveEventsIgnored()) {\n\t\t\t\tthis.onTaskMoved(getMoveObjectByTaskId(id));\n\t\t\t}\n\t\t\treturn true;\n\t\t});\n\n\t\tgantt.attachEvent(\"onRowDragStart\", (id: TaskID, target: TaskID, e: Event) => {\n\t\t\tthis.toggleIgnoreMoveEvents(true);\n\t\t\tsaveInitialAll();\n\t\t\treturn true;\n\t\t});\n\n\t\tlet dragId = null;\n\t\tlet projectDrag = false;\n\t\tgantt.attachEvent(\"onBeforeTaskDrag\", (taskId: TaskID) => {\n\t\t\tdragId = gantt.getState().drag_id;\n\t\t\tif (dragId === taskId){\n\t\t\t\tconst task = gantt.getTask(taskId);\n\t\t\t\tif (gantt.isSummaryTask(task) && gantt.config.drag_project){\n\t\t\t\t\tprojectDrag = true;\n\t\t\t\t}\n\t\t\t}\n\t\t\t// GS-99. Store the initial task dates before multiple drag\n\t\t\tif (gantt.plugins().multiselect){\n\t\t\t\tconst selectedIds = gantt.getSelectedTasks();\n\t\t\t\tif (selectedIds.length > 1){\n\t\t\t\t\tselectedIds.forEach((id)=>{\n\t\t\t\t\t\tthis.store(id, gantt.config.undo_types.task, true);\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn this.store(taskId, gantt.config.undo_types.task);\n\t\t});\n\n\t\tgantt.attachEvent(\"onAfterTaskDrag\", (taskId: TaskID) => {\n\t\t\t// if we drag multiple tasks and other tasks move to another date after that,\n\t\t\t// auto-scheduling/correct work time should occur in anoher command.\n\t\t\t// otherwise, when we undo the changes, the task constraint is not restored correctly\n\t\t\tconst multipleDrag = projectDrag || (gantt.plugins().multiselect && gantt.getSelectedTasks().length > 1);\n\t\t\tif (multipleDrag && dragId === taskId){\n\t\t\t\tprojectDrag = false;\n\t\t\t\tdragId = null;\n\t\t\t\tthis.stopBatchAction();\n\t\t\t}\n\t\t\t// GS-99. When dragging multiple tasks, we need to store the initial tasks\n\t\t\tthis.store(taskId, gantt.config.undo_types.task, true);\n\t\t});\n\n\t\tgantt.attachEvent(\"onLightbox\", (taskId: TaskID) => this.store(taskId, gantt.config.undo_types.task));\n\n\t\tgantt.attachEvent(\"onBeforeTaskAutoSchedule\", (task: ITask) => {\n\t\t\tthis.store(task.id, gantt.config.undo_types.task, true);\n\t\t\treturn true;\n\t\t});\n\n\t\tif (gantt.ext.inlineEditors) {\n\t\t\t// remove the onGanttLayoutReady wrapper when GS-1288 is merged\n\t\t\tlet onBeforeEditStartId = null;\n\t\t\tlet onEditStart = null;\n\t\t\tgantt.attachEvent(\"onGanttLayoutReady\", () => {\n\t\t\t\tif (onBeforeEditStartId) {\n\t\t\t\t\tgantt.ext.inlineEditors.detachEvent(onBeforeEditStartId);\n\t\t\t\t}\n\t\t\t\tif (onEditStart) {\n\t\t\t\t\tgantt.ext.inlineEditors.detachEvent(onEditStart);\n\t\t\t\t}\n\n\t\t\t\tonEditStart = gantt.ext.inlineEditors.attachEvent(\"onEditStart\", (state: IInlineEditState) => {\n\t\t\t\t\tthis.store(state.id, gantt.config.undo_types.task);\n\t\t\t\t});\n\n\t\t\t\t// GS-99. If another inline editor is opened and we open a new inline editor,\n\t\t\t\t// we shouldn't use the batchAction\n\t\t\t\tonBeforeEditStartId = gantt.ext.inlineEditors.attachEvent(\"onBeforeEditStart\", (state: IInlineEditState) => {\n\t\t\t\t\tthis.stopBatchAction();\n\t\t\t\t\treturn true;\n\t\t\t\t});\n\t\t\t});\n\t\t}\n\t}\n\n\tprivate _storeCommand(command: IUndoCommand) {\n\t\tconst undo = this._undo;\n\t\tundo.updateConfigs();\n\n\t\tif (!undo.undoEnabled) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (this._batchMode) {\n\t\t\tthis._batchAction.commands.push(command);\n\t\t} else {\n\t\t\tconst action = undo.action.create([command]);\n\t\t\tundo.logAction(action);\n\t\t}\n\t}\n\tprivate _storeEntityCommand(obj: TUndoValue, old: TUndoValue, actionType: TActionType, entityType: TEntityType) {\n\t\tconst undo = this._undo;\n\t\tconst command = undo.command.create(obj, old, actionType, entityType);\n\t\tthis._storeCommand(command);\n\t}\n\tprivate _storeTaskCommand(obj: ITask, type: TActionType) {\n\t\tif(this._gantt.isTaskExists(obj.id)){\n\t\t\t(obj as any).$local_index = this._gantt.getTaskIndex(obj.id);\n\t\t}\n\n\t\tthis._storeEntityCommand(obj, this.getInitialTask(obj.id), type, this._undo.command.entity.task);\n\t}\n\tprivate _storeLinkCommand(obj: ILink, type: TActionType) {\n\t\tthis._storeEntityCommand(obj, this.getInitialLink(obj.id), type, this._undo.command.entity.link);\n\t}\n\tprivate _getLinks(task: ITask) {\n\t\treturn task.$source.concat(task.$target);\n\t}\n\tprivate _storeTask(taskId: TaskID, overwrite: boolean = false) {\n\t\tconst gantt = this._gantt;\n\t\tthis.setInitialTask(taskId, overwrite);\n\t\tgantt.eachTask((child: ITask) => {\n\t\t\tthis.setInitialTask(child.id);\n\t\t}, taskId);\n\t\treturn true;\n\t}\n\tprivate _storeLink(linkId: LinkID, overwrite: boolean = false) {\n\t\tthis.setInitialLink(linkId, overwrite);\n\t\treturn true;\n\t}\n}","import { IUndo, IUndoCommand, IUndoCommands, IUndoPropAction, IUndoPropCommand, TActionType, TEntityType, TUndoStack, TUndoValue } from \"./types\";\n\nconst MAX_UNDO_STEPS = 100;\n\nexport class Undo implements IUndo {\n\n\tmaxSteps = MAX_UNDO_STEPS;\n\tundoEnabled = true;\n\tredoEnabled = true;\n\taction: IUndoPropAction = {\n\t\tcreate: (commands?: IUndoCommand[]): IUndoCommands => {\n\t\t\treturn { commands: (commands ? commands.slice() : []) };\n\t\t},\n\t\tinvert: (action: IUndoCommands): IUndoCommands => {\n\t\t\tconst gantt = this._gantt;\n\t\t\tconst revert = gantt.copy(action);\n\t\t\tconst commands = this.command;\n\t\t\tfor (let i = 0; i < action.commands.length; i++) {\n\t\t\t\tconst command = revert.commands[i] = commands.invert(revert.commands[i]);\n\t\t\t\tif (command.type === commands.type.update || command.type === commands.type.move) {\n\t\t\t\t\t[command.value, command.oldValue] = [command.oldValue, command.value];\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn revert as IUndoCommands;\n\t\t}\n\t};\n\tcommand: IUndoPropCommand = {\n\t\t// entities that require different processing for undoing-redoing changes (gantt.config.undo_types)\n\t\tentity: null,\n\n\t\t// types of traced actions (gantt.config.undo_actions)\n\t\ttype: null,\n\n\t\tcreate: (value: TUndoValue, oldValue: TUndoValue, type: TActionType, entity: TEntityType): IUndoCommand => {\n\t\t\tconst gantt = this._gantt;\n\t\t\treturn {\n\t\t\t\tentity,\n\t\t\t\ttype,\n\t\t\t\tvalue: gantt.copy(value),\n\t\t\t\toldValue: gantt.copy(oldValue || value)\n\t\t\t};\n\t\t},\n\t\tinvert: (command: IUndoCommand): IUndoCommand => {\n\t\t\tconst gantt = this._gantt;\n\t\t\tconst revert = gantt.copy(command);\n\t\t\trevert.type = this.command.inverseCommands(command.type);\n\t\t\treturn revert;\n\t\t},\n\t\tinverseCommands: (command: TActionType): TActionType => {\n\t\t\tconst gantt = this._gantt;\n\t\t\tconst types = this.command.type;\n\t\t\tswitch (command) {\n\t\t\t\tcase types.update:\n\t\t\t\t\treturn types.update;\n\t\t\t\tcase types.remove:\n\t\t\t\t\treturn types.add;\n\t\t\t\tcase types.add:\n\t\t\t\t\treturn types.remove;\n\t\t\t\tcase types.move:\n\t\t\t\t\treturn types.move;\n\t\t\t\tdefault:\n\t\t\t\t\tgantt.assert(false, \"Invalid command \"+ command);\n\t\t\t\t\treturn null;\n\t\t\t}\n\t\t}\n\t};\n\n\tprivate _undoStack = [];\n\tprivate _redoStack = [];\n\tprivate _gantt: any;\n\n\tconstructor(gantt: any){\n\t\tthis._gantt = gantt;\n\t}\n\tgetUndoStack() {\n\t\treturn this._undoStack;\n\t}\n\tsetUndoStack(stack: []) {\n\t\tthis._undoStack = stack;\n\t}\n\n\tgetRedoStack() {\n\t\treturn this._redoStack;\n\t}\n\tsetRedoStack(stack: []) {\n\t\tthis._redoStack = stack;\n\t}\n\n\tclearUndoStack() {\n\t\tthis._undoStack = [];\n\t}\n\n\tclearRedoStack() {\n\t\tthis._redoStack = [];\n\t}\n\n\tupdateConfigs() {\n\t\tconst gantt = this._gantt;\n\t\tthis.maxSteps = gantt.config.undo_steps || MAX_UNDO_STEPS;\n\t\tthis.command.entity = gantt.config.undo_types;\n\t\tthis.command.type = gantt.config.undo_actions;\n\t\tthis.undoEnabled = !!gantt.config.undo;\n\t\tthis.redoEnabled = !!gantt.config.redo; // GS-873, Redo should work even when the `gantt.config.undo` is disabled.\n\t}\n\n\tundo() {\n\t\tconst gantt = this._gantt;\n\t\tthis.updateConfigs();\n\t\tif (!this.undoEnabled) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst action = this._pop(this._undoStack);\n\t\tif (action) {\n\t\t\tthis._reorderCommands(action);\n\t\t}\n\t\tif (gantt.callEvent(\"onBeforeUndo\", [action]) !== false) {\n\t\t\tif (action) {\n\t\t\t\tthis._applyAction(this.action.invert(action));\n\t\t\t\tthis._push(this._redoStack, gantt.copy(action));\n\t\t\t\tgantt.callEvent(\"onAfterUndo\", [action]);\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\t\tgantt.callEvent(\"onAfterUndo\", [null]);\n\t}\n\n\tredo() {\n\t\tconst gantt = this._gantt;\n\t\tthis.updateConfigs();\n\t\tif (!this.redoEnabled) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst action = this._pop(this._redoStack);\n\t\tif (action) {\n\t\t\tthis._reorderCommands(action);\n\t\t}\n\n\t\tif (gantt.callEvent(\"onBeforeRedo\", [action]) !== false) {\n\t\t\tif (action) {\n\t\t\t\tthis._applyAction(action);\n\t\t\t\tthis._push(this._undoStack, gantt.copy(action));\n\t\t\t\tgantt.callEvent(\"onAfterRedo\", [action]);\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\t\tgantt.callEvent(\"onAfterRedo\", [null]);\n\t}\n\n\t// storeUndo:\n\tlogAction(action: IUndoCommands) {\n\t\tthis._push(this._undoStack, action);\n\t\tthis._redoStack = [];\n\t}\n\n\tprivate _push(stack: TUndoStack, action: IUndoCommands): IUndoCommands {\n\t\tconst gantt = this._gantt;\n\t\tif (!action.commands.length) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst event = stack === this._undoStack ? \"onBeforeUndoStack\" : \"onBeforeRedoStack\";\n\t\tif (gantt.callEvent(event, [action]) === false){\n\t\t\treturn;\n\t\t}\n\t\t// commands can be removed from event handler\n\t\tif (!action.commands.length) {\n\t\t\treturn;\n\t\t}\n\n\t\tstack.push(action);\n\t\twhile (stack.length > this.maxSteps) {\n\t\t\tstack.shift();\n\t\t}\n\t\treturn action;\n\t}\n\n\tprivate _pop(stack: TUndoStack): IUndoCommands {\n\t\treturn stack.pop();\n\t}\n\n\tprivate _reorderCommands(action) {\n\t\t// firstly process tasks and only then links\n\t\t// in order to ensure links are added not earlier than their tasks\n\t\t// firstly to 'move' actions and only then updates\n\t\tconst weights = { any: 0, link:1, task:2 };\n\t\tconst actionWeights = { move: 1, any:0 };\n\t\taction.commands.sort(function(a, b) {\n\t\t\tif (a.entity === \"task\" && b.entity === \"task\") {\n\t\t\t\tif (a.type !== b.type) {\n\t\t\t\t\treturn (actionWeights[b.type] || 0) - (actionWeights[a.type] || 0);\n\t\t\t\t} else if (a.type === \"move\" && a.oldValue && b.oldValue && b.oldValue.parent === a.oldValue.parent) {\n\t\t\t\t\treturn a.oldValue.$index - b.oldValue.$index;\n\t\t\t\t} else {\n\t\t\t\t\treturn 0;\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tconst weightA = weights[a.entity] || weights.any;\n\t\t\t\tconst weightB = weights[b.entity] || weights.any;\n\t\t\t\treturn weightB - weightA;\n\t\t\t}\n\n\t\t});\n\t}\n\n\tprivate _applyAction(action: IUndoCommands) {\n\t\tlet command = null;\n\t\tconst entities = this.command.entity;\n\t\tconst actions = this.command.type;\n\t\tconst gantt = this._gantt;\n\t\tconst methods = {};\n\t\tmethods[entities.task] = {\n\t\t\tadd: \"addTask\",\n\t\t\tget: \"getTask\",\n\t\t\tupdate: \"updateTask\",\n\t\t\tremove: \"deleteTask\",\n\t\t\tmove: \"moveTask\",\n\t\t\tisExists: \"isTaskExists\"\n\t\t};\n\t\tmethods[entities.link] = {\n\t\t\tadd: \"addLink\",\n\t\t\tget: \"getLink\",\n\t\t\tupdate: \"updateLink\",\n\t\t\tremove: \"deleteLink\",\n\t\t\tisExists: \"isLinkExists\"\n\t\t};\n\n\t\tgantt.batchUpdate(function() {\n\t\t\t// it is logical to undo actions from the last one to the first one\n\t\t\t// but we have to do it from the first one because the order\n\t\t\t// of tasks ($index and $local_index) depends on the existing tasks\n\t\t\tfor (let i = 0; i < action.commands.length; i++) {\n\t\t\t\tcommand = action.commands[i];\n\t\t\t\tconst method = methods[command.entity][command.type];\n\t\t\t\tconst getMethod = methods[command.entity].get;\n\t\t\t\tconst check = methods[command.entity].isExists;\n\n\t\t\t\tif (command.type === actions.add) {\n\t\t\t\t\tgantt[method](command.oldValue, command.oldValue.parent, command.oldValue.$local_index);\n\t\t\t\t} else if (command.type === actions.remove) {\n\t\t\t\t\tif (gantt[check](command.value.id)) {\n\t\t\t\t\t\tgantt[method](command.value.id);\n\t\t\t\t\t}\n\t\t\t\t} else if (command.type === actions.update) {\n\t\t\t\t\tconst item = gantt[getMethod](command.value.id);\n\t\t\t\t\tfor(const prop in command.value){\n\t\t\t\t\t\tconst internalProperty = prop.startsWith(\"$\") || prop.startsWith(\"_\");\n\t\t\t\t\t\tconst whitelist = [\"$open\"];\n\t\t\t\t\t\tlet copyProperty = !internalProperty;\n\t\t\t\t\t\tif (whitelist.indexOf(prop) > -1){\n\t\t\t\t\t\t\tcopyProperty = true;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif(copyProperty){\n\t\t\t\t\t\t\titem[prop] = command.value[prop];\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tgantt[method](command.value.id);\n\t\t\t\t} else if (command.type === actions.move) {\n\t\t\t\t\tgantt[method](command.value.id, command.value.$local_index, command.value.parent);\n\t\t\t\t\t// GS-680: We should send the changes to the server after we undo vertical reorder\n\t\t\t\t\tgantt.callEvent(\"onRowDragEnd\", [command.value.id]);\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t}\n}","\nimport click_drag from \"./click_drag\";\nimport drag_timeline from \"./drag_timeline\";\nimport export_api from \"./export_api\";\nimport fullscreen from \"./fullscreen\";\nimport keyboard_navigation from \"./keyboard_navigation\";\nimport marker from \"./marker\";\nimport multiselect from \"./multiselect\";\nimport quick_info from \"./quick_info\";\nimport tooltip from \"./tooltip\";\nimport undo from \"./undo\";\n\nexport default {\n\tclick_drag,\n\tdrag_timeline,\n\tfullscreen,\n\tkeyboard_navigation,\n\tquick_info,\n\ttooltip,\n\tundo,\n\tmarker,\n\tmultiselect,\n\texport_api\n};","import { EventsManager } from \"./eventsManager\";\nimport { ISelectedRegionConfig, SelectedRegion } from \"./selectedRegion\";\n\nexport default function(gantt: any){\n\tif (!gantt.ext) {\n\t\tgantt.ext = {};\n\t}\n\n\tconst defaultConfig: ISelectedRegionConfig = {\n\t\tclassName: \"gantt_click_drag_rect\",\n\t\tuseRequestAnimationFrame: true,\n\t\tcallback: undefined,\n\t\tsingleRow: false\n\t};\n\n\tconst eventsManager = new EventsManager(gantt);\n\n\tgantt.ext.clickDrag = eventsManager;\n\n\tgantt.attachEvent(\"onGanttReady\", () => {\n\t\tconst config: ISelectedRegionConfig = { viewPort: gantt.$task_data, ...defaultConfig };\n\t\tif (gantt.config.click_drag){\n\t\t\tconst clickDrag = gantt.config.click_drag;\n\t\t\tconfig.render = clickDrag.render || defaultConfig.render;\n\t\t\tconfig.className = clickDrag.className || defaultConfig.className;\n\t\t\tconfig.callback = clickDrag.callback || defaultConfig.callback;\n\t\t\tconfig.viewPort = clickDrag.viewPort || gantt.$task_data;\n\t\t\tconfig.useRequestAnimationFrame = clickDrag.useRequestAnimationFrame === undefined ?\n\t\t\t\tdefaultConfig.useRequestAnimationFrame : clickDrag.useRequestAnimationFrame;\n\n\t\t\tconfig.singleRow = clickDrag.singleRow === undefined ? defaultConfig.singleRow : clickDrag.singleRow;\n\t\t\tconst timeline = gantt.$ui.getView(\"timeline\");\n\t\t\tconst selectedRegion = new SelectedRegion(config, gantt, timeline);\n\t\t\tgantt.ext.clickDrag.attach(selectedRegion, clickDrag.useKey, clickDrag.ignore);\n\t\t}\n\t});\n\n\tgantt.attachEvent(\"onDestroy\", () => {\n\t\teventsManager.destructor();\n\t});\n\n}","import { EventsManager } from \"./eventsManager\";\nexport default function(gantt: any){\n\tif (!gantt.ext){\n\t\tgantt.ext = {};\n\t}\n\n\tgantt.ext.dragTimeline = {\n\t\tcreate: () => EventsManager.create(gantt)\n\t};\n\n\tgantt.config.drag_timeline = {\n\t\tenabled: true,\n\t\trender: false\n\t};\n}","export default function(gantt: any){\n\ninterface IBody extends HTMLElement {\n\tmsRequestFullscreen?: () => void;\n\tmozRequestFullScreen?: () => void;\n\twebkitRequestFullscreen?: (ALLOW_KEYBOARD_INPUT: any) => void;\n}\n\n\ninterface IConsole extends Console {\n\twarning?: (str: string) => void;\n}\n\ninterface IDocument extends Document {\n\tfullscreenElement: Element;\n\tmozFullScreenElement?: Element;\n\twebkitFullscreenElement?: Element;\n\tmsFullscreenElement?: Element;\n\twebkitFullscreenEnabled?: boolean;\n\tmozFullScreenEnabled?: boolean;\n\tmsFullscreenEnabled?: boolean;\n\tmsExitFullscreen?: () => void;\n\tmozCancelFullScreen?: () => void;\n\twebkitExitFullscreen?: () => void;\n}\n\ninterface IElement extends Element {\n\tALLOW_KEYBOARD_INPUT?: boolean;\n}\n\ninterface IElementSizes extends ISizes {\n\tmodified: boolean;\n}\n\ninterface ISizes {\n\twidth: null | string;\n\theight: null | string;\n\ttop: null | string;\n\tleft: null | string;\n\tposition: null | string;\n\tzIndex: null | number;\n}\n\nfunction isExpanded() {\n\tconst element = ((document as IDocument).fullscreenElement ||\n\t\t(document as IDocument).mozFullScreenElement ||\n\t\t(document as IDocument).webkitFullscreenElement ||\n\t\t(document as IDocument).msFullscreenElement);\n\treturn !!(element && element === document.body);\n}\n\nfunction isFullscreenAvailable() {\n\ttry {\n\t\treturn (document as IDocument).fullscreenEnabled ||\n\t\t\t(document as IDocument).webkitFullscreenEnabled ||\n\t\t\t(document as IDocument).mozFullScreenEnabled ||\n\t\t\t(document as IDocument).msFullscreenEnabled;\n\t} catch (e) {\n\t\t// eslint-disable-next-line no-console\n\t\tconsole.error(\"Fullscreen is not available:\", e); \n\t}\n}\n\nconst state = gantt.$services.getService(\"state\");\nstate.registerProvider(\"fullscreen\", () => {\n\tif (isFullscreenAvailable()){\n\t\treturn { fullscreen: isExpanded() };\n\t} else {\n\t\treturn undefined;\n\t}\n});\n\nlet backupBodyPadding = {\n\toverflow: null,\n\tpadding: null,\n\tpaddingTop: null,\n\tpaddingRight: null,\n\tpaddingBottom: null,\n\tpaddingLeft: null\n};\n\nconst backupElementSizes: IElementSizes = {\n\twidth: null,\n\theight: null,\n\ttop: null,\n\tleft: null,\n\tposition: null,\n\tzIndex: null,\n\tmodified: false\n};\n\nlet backupPositioning = null;\nfunction resetParentPositioning(root){\n\tlet parent = root.parentNode;\n\tconst positions = [];\n\twhile(parent && parent.style){\n\t\tpositions.push({\n\t\t\telement: parent,\n\t\t\toriginalPositioning: parent.style.position\n\t\t});\n\t\tparent.style.position = \"static\";\n\t\tparent = parent.parentNode;\n\t}\n\treturn positions;\n}\n\nfunction restoreParentPositioning(positions: any[]){\n\tpositions.forEach(record => {\n\t\trecord.element.style.position = record.originalPositioning;\n\t});\n}\n\n// expand gantt root element to fullscreen automatically\nfunction setFullScreenSizes() {\n\tconst root = gantt.ext.fullscreen.getFullscreenElement();\n\tconst body = document.body;\n\tupdateSizes(root.style, backupElementSizes);\n\tbackupBodyPadding = {\n\t\toverflow: body.style.overflow,\n\t\tpadding: body.style.padding ? body.style.padding : null,\n\t\tpaddingTop: body.style.paddingTop ? body.style.paddingTop : null,\n\t\tpaddingRight: body.style.paddingRight ? body.style.paddingRight : null,\n\t\tpaddingBottom: body.style.paddingBottom ? body.style.paddingBottom : null,\n\t\tpaddingLeft: body.style.paddingLeft ? body.style.paddingLeft : null\n\t};\n\n\tif (body.style.padding) {\n\t\tbody.style.padding = \"0\";\n\t}\n\tif (body.style.paddingTop) {\n\t\tbody.style.paddingTop = \"0\";\n\t}\n\tif (body.style.paddingRight) {\n\t\tbody.style.paddingRight = \"0\";\n\t}\n\tif (body.style.paddingBottom) {\n\t\tbody.style.paddingBottom = \"0\";\n\t}\n\tif (body.style.paddingLeft) {\n\t\tbody.style.paddingLeft = \"0\";\n\t}\n\n\tbody.style.overflow = \"hidden\";\n\n\troot.style.width = \"100vw\";\n\troot.style.height = \"100vh\";\n\troot.style.top = \"0px\";\n\troot.style.left = \"0px\";\n\troot.style.position = \"absolute\";\n\troot.style.zIndex = 1;\n\tbackupElementSizes.modified = true;\n\tbackupPositioning = resetParentPositioning(root);\n}\n\nfunction restoreSizes() {\n\tconst root = gantt.ext.fullscreen.getFullscreenElement();\n\tconst body = document.body;\n\tif (backupElementSizes.modified) {\n\t\tif (backupBodyPadding.padding) {\n\t\t\tbody.style.padding = backupBodyPadding.padding;\n\t\t}\n\t\tif (backupBodyPadding.paddingTop) {\n\t\t\tbody.style.paddingTop = backupBodyPadding.paddingTop;\n\t\t}\n\t\tif (backupBodyPadding.paddingRight) {\n\t\t\tbody.style.paddingRight = backupBodyPadding.paddingRight;\n\t\t}\n\t\tif (backupBodyPadding.paddingBottom) {\n\t\t\tbody.style.paddingBottom = backupBodyPadding.paddingBottom;\n\t\t}\n\t\tif (backupBodyPadding.paddingLeft) {\n\t\t\tbody.style.paddingLeft = backupBodyPadding.paddingLeft;\n\t\t}\n\n\t\tbody.style.overflow = backupBodyPadding.overflow;\n\t\tbackupBodyPadding = {\n\t\t\toverflow: null,\n\t\t\tpadding: null,\n\t\t\tpaddingTop: null,\n\t\t\tpaddingRight: null,\n\t\t\tpaddingBottom: null,\n\t\t\tpaddingLeft: null\n\t\t};\n\t\tupdateSizes(backupElementSizes, root.style);\n\t\tbackupElementSizes.modified = false;\n\t}\n\trestoreParentPositioning(backupPositioning);\n\tbackupPositioning = null;\n}\n\nfunction updateSizes(source: ISizes, target: ISizes) {\n\ttarget.width = source.width;\n\ttarget.height = source.height;\n\ttarget.top = source.top;\n\ttarget.left = source.left;\n\ttarget.position = source.position;\n\ttarget.zIndex = source.zIndex;\n}\n\nfunction addDOMEvents() {\n\tgantt.event(document, \"webkitfullscreenchange\", onFullScreenChange);\n\tgantt.event(document, \"mozfullscreenchange\", onFullScreenChange);\n\tgantt.event(document, \"MSFullscreenChange\", onFullScreenChange);\n\t// For IE on Win 10\n\tgantt.event(document, \"fullscreenChange\", onFullScreenChange);\n\tgantt.event(document, \"fullscreenchange\", onFullScreenChange);\n}\n\nlet expandGantt = false;\nfunction onFullScreenChange() {\n\tif (!gantt.$container) {\n\t\t// do nothing if gantt is not yet initialized\n\t\treturn;\n\t}\n\tlet event: \"onExpand\" | \"onCollapse\";\n\tconst isBodyExpanded = isExpanded();\n\n\tif (isBodyExpanded) {\n\t\tif (expandGantt) {\n\t\t\tevent = \"onExpand\";\n\t\t\tsetFullScreenSizes();\n\t\t}\n\t} else if (expandGantt) {\n\t\texpandGantt = false;\n\t\tevent = \"onCollapse\";\n\t\trestoreSizes();\n\t}\n\tsetTimeout(() => {\n\t\tgantt.render();\n\t});\n\tsetTimeout(() => {\n\t\tgantt.callEvent(event, [gantt.ext.fullscreen.getFullscreenElement()]);\n\t});\n}\n\nfunction cantFullscreen() {\n\tif (!gantt.$container) { // check is gantt initialized or not\n\t\treturn true;\n\t}\n\tif (!gantt.ext.fullscreen.getFullscreenElement()) {\n\t\treturn true;\n\t}\n\tif (!isFullscreenAvailable()) {\n\t\t// eslint-disable-next-line no-console\n\t\tconst method = (console as IConsole).warning || console.log;\n\t\tmethod(\"The `fullscreen` feature not being allowed, or full-screen mode not being supported\");\n\t\treturn true;\n\t}\n\treturn false;\n}\n\ngantt.ext.fullscreen = {\n\texpand(): void {\n\t\tif (cantFullscreen()) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (isExpanded()) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (!gantt.callEvent(\"onBeforeExpand\", [this.getFullscreenElement()])) {\n\t\t\treturn;\n\t\t}\n\t\texpandGantt = true;\n\n\t\t// we switch body to fullscreen and then expand fullscreen element to viewport\n\t\t// we do it to correct display common elements: lightboxes, tooltip etc.\n\t\tconst element = document.body as IBody;\n\t\tconst requestArguments = element.webkitRequestFullscreen ?\n\t\t\t[(Element as unknown as IElement).ALLOW_KEYBOARD_INPUT] : [];\n\n\t\tconst requestFullscreen = element.msRequestFullscreen ||\n\t\t\telement.mozRequestFullScreen ||\n\t\t\telement.webkitRequestFullscreen ||\n\t\t\telement.requestFullscreen;\n\n\t\tif (requestFullscreen) {\n\t\t\trequestFullscreen.apply(element, requestArguments);\n\t\t}\n\t},\n\tcollapse(): void {\n\t\tif (cantFullscreen()) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (!isExpanded()) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (!gantt.callEvent(\"onBeforeCollapse\", [this.getFullscreenElement()])) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst requestExitFullscreen = (document as IDocument).msExitFullscreen ||\n\t\t\t(document as IDocument).mozCancelFullScreen ||\n\t\t\t(document as IDocument).webkitExitFullscreen ||\n\t\t\t(document as IDocument).exitFullscreen;\n\n\t\tif (requestExitFullscreen) {\n\t\t\trequestExitFullscreen.apply(document);\n\t\t}\n\t},\n\ttoggle(): void {\n\t\tif (cantFullscreen()) {\n\t\t\treturn;\n\t\t}\n\t\tif (!isExpanded()) {\n\t\t\tthis.expand();\n\t\t} else {\n\t\t\tthis.collapse();\n\t\t}\n\n\t},\n\tgetFullscreenElement(): HTMLElement {\n\t\treturn gantt.$root;\n\t}\n};\n\ngantt.expand = function() {\n\tgantt.ext.fullscreen.expand();\n};\n\ngantt.collapse = function(){\n\tgantt.ext.fullscreen.collapse();\n};\n\ngantt.attachEvent(\"onGanttReady\", addDOMEvents);\n\n}","import eventable from \"../utils/eventable\";\nimport * as domHelpers from \"../core/ui/utils/dom_helpers\";\n\nimport keyboard_shortcuts from \"./keyboard_navigation/common/keyboard_shortcuts\";\nimport eventhandler from \"./keyboard_navigation/common/eventhandler\";\nimport trap_modal_focus from \"./keyboard_navigation/common/trap_modal_focus\";\nimport gantt_node from \"./keyboard_navigation/elements/gantt_node\";\nimport nav_node from \"./keyboard_navigation/elements/nav_node\";\nimport header_cell from \"./keyboard_navigation/elements/header_cell\";\nimport task_row from \"./keyboard_navigation/elements/task_row\";\nimport task_cell from \"./keyboard_navigation/elements/task_cell\";\nimport modals from \"./keyboard_navigation/modals\";\nimport core from \"./keyboard_navigation/core\";\n\n\n\nexport default function(gantt){\n\tfunction setupKeyNav(gantt){\n\t\tgantt.config.keyboard_navigation = true;\n\t\tgantt.config.keyboard_navigation_cells = false;\n\n\t\tgantt.$keyboardNavigation = {};\n\n\t\tgantt._compose = function(){\n\t\t\tvar parts = Array.prototype.slice.call(arguments, 0);\n\t\t\tvar res = {};\n\t\t\tfor(var i = 0; i < parts.length; i++){\n\t\t\t\tvar obj = parts[i];\n\t\t\t\tif(typeof obj == \"function\"){\n\t\t\t\t\tobj = new obj();\n\t\t\t\t}\n\n\t\t\t\tfor(var p in obj){\n\t\t\t\t\tres[p] = obj[p];\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn res;\n\t\t};\n\n\t\tkeyboard_shortcuts(gantt);\n\t\teventhandler(gantt);\n\t\ttrap_modal_focus(gantt);\n\t\tgantt_node(gantt);\n\t\tnav_node(gantt);\n\t\theader_cell(gantt);\n\t\ttask_row(gantt);\n\t\ttask_cell(gantt);\n\t\tmodals(gantt);\n\t\tcore(gantt);\n\n\n\t\t(function(){\n\t\t\tvar dispatcher = gantt.$keyboardNavigation.dispatcher;\n\n\t\t\tdispatcher.isTaskFocused = function(id){\n\t\t\t\tvar node = dispatcher.activeNode;\n\t\t\t\tif(node instanceof gantt.$keyboardNavigation.TaskRow || node instanceof gantt.$keyboardNavigation.TaskCell) {\n\t\t\t\t\tif (node.taskId == id) {\n\t\t\t\t\t\treturn true;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\treturn false;\n\t\t\t};\n\n\t\t\tvar keyDownHandler = function(e){\n\t\t\t\tif(!gantt.config.keyboard_navigation) return;\n\t\t\t\t// GS-734 & GS-1078: we don't need keyboard navigation inside inline editors\n\t\t\t\tif(!gantt.config.keyboard_navigation_cells && isInlineEditorCell(e)) return;\n\n\t\t\t\tif (isNoKeyboardNavigationElement(e) || isLightboxElement(e)){\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\treturn dispatcher.keyDownHandler(e);\n\t\t\t};\n\n\t\t\tvar focusHandler = function(e){\n\t\t\t\tif(dispatcher.$preventDefault){\n\t\t\t\t\te.preventDefault();\n\t\t\t\t\tgantt.$container.blur();\n\t\t\t\t\treturn false;\n\t\t\t\t// do nothing if key-nav focus is already planned\n\t\t\t\t} else if (!dispatcher.awaitsFocus()) {\n\t\t\t\t\t// otherwise - re-focus key-nav element on gantt focus\n\t\t\t\t\tdispatcher.focusGlobalNode();\n\t\t\t\t}\n\n\t\t\t};\n\n\t\t\tvar reFocusActiveNode = function(){\n\t\t\t\tif(!dispatcher.isEnabled())\n\t\t\t\t\treturn;\n\n\t\t\t\tconst outsideGantt = !domHelpers.isChildOf(document.activeElement, gantt.$container) && document.activeElement.localName != \"body\";\n\t\t\t\tvar activeNode = dispatcher.getActiveNode();\n\t\t\t\tif(!activeNode || outsideGantt)\n\t\t\t\t\treturn;\n\n\t\t\t\tvar domElement = activeNode.getNode();\n\t\t\t\tvar top, left;\n\t\t\t\tif(domElement && domElement.parentNode){\n\t\t\t\t\ttop = domElement.parentNode.scrollTop;\n\t\t\t\t\tleft = domElement.parentNode.scrollLeft;\n\n\t\t\t\t}\n\n\t\t\t\tactiveNode.focus(true);\n\n\t\t\t\tif(domElement && domElement.parentNode){\n\t\t\t\t\tdomElement.parentNode.scrollTop = top;\n\t\t\t\t\tdomElement.parentNode.scrollLeft = left;\n\t\t\t\t}\n\t\t\t};\n\n\n\t\t\tgantt.attachEvent(\"onDataRender\", function(){\n\t\t\t\tif(!gantt.config.keyboard_navigation) return;\n\t\t\t\treFocusActiveNode();\n\t\t\t});\n\n\t\t\tgantt.attachEvent(\"onGanttRender\", function(){\n\t\t\t\t//GS-2230: in case if `getGanttInstance` created without container\n\t\t\t\tif(!gantt.$root) return;\n\t\t\t\tgantt.eventRemove(gantt.$root, \"keydown\", keyDownHandler);\n\t\t\t\tgantt.eventRemove(gantt.$container, \"focus\", focusHandler);\n\t\t\t\tgantt.eventRemove(gantt.$container, \"mousedown\", mousedownHandler);\n\n\t\t\t\tif(gantt.config.keyboard_navigation){\n\n\t\t\t\t\tgantt.event(gantt.$root, \"keydown\", keyDownHandler);\n\t\t\t\t\tgantt.event(gantt.$container, \"focus\", focusHandler);\n\t\t\t\t\tgantt.event(gantt.$container, \"mousedown\", mousedownHandler);\n\t\t\t\t\tgantt.$container.setAttribute(\"tabindex\", \"0\");\n\n\t\t\t\t}else{\n\t\t\t\t\tgantt.$container.removeAttribute(\"tabindex\");\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tfunction getTaskNodeConstructor(){\n\t\t\t\tif (gantt.config.keyboard_navigation_cells) {\n\t\t\t\t\treturn gantt.$keyboardNavigation.TaskCell;\n\t\t\t\t} else {\n\t\t\t\t\treturn gantt.$keyboardNavigation.TaskRow;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tfunction isInlineEditorCell(e){\n\t\t\t\treturn !!domHelpers.closest(e.target, \".gantt_grid_editor_placeholder\");\n\t\t\t}\n\t\t\t// GS-1445. Cancel keyboard navigation within custom elements\n\t\t\tfunction isNoKeyboardNavigationElement(e){\n\t\t\t\treturn !!domHelpers.closest(e.target, \".no_keyboard_navigation\");\n\t\t\t}\n\t\t\tfunction isLightboxElement(e){\n\t\t\t\treturn !!domHelpers.closest(e.target, \".gantt_cal_light\");\n\t\t\t}\n\n\t\t\tfunction mousedownHandler(e){\n\t\t\t\tif(!gantt.config.keyboard_navigation) return true;\n\t\t\t\t// GS-734 & GS-1078: we don't need keyboard navigation inside inline editors\n\t\t\t\tif(!gantt.config.keyboard_navigation_cells && isInlineEditorCell(e)) return true;\n\n\t\t\t\tif (isNoKeyboardNavigationElement(e)){\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tvar focusNode;\n\t\t\t\tvar locateTask = dispatcher.fromDomElement(e);\n\t\t\t\tif(locateTask){\n\t\t\t\t\t//var node = getTaskNodeConstructor();\n\t\t\t\t\tif(dispatcher.activeNode instanceof gantt.$keyboardNavigation.TaskCell && domHelpers.isChildOf(e.target, gantt.$task)){\n\t\t\t\t\t\tlocateTask = new gantt.$keyboardNavigation.TaskCell(locateTask.taskId, dispatcher.activeNode.columnIndex);\n\t\t\t\t\t}\n\t\t\t\t\tfocusNode = locateTask;\n\t\t\t\t}\n\t\t\t\tif (focusNode) {\n\t\t\t\t\tif (!dispatcher.isEnabled()) {\n\t\t\t\t\t\tdispatcher.activeNode = focusNode;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tdispatcher.delay(function () {\n\t\t\t\t\t\t\tdispatcher.setActiveNode(focusNode);\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\t// empty click should drop focus from gantt, insert of reselecting default node\n\t\t\t\t\tdispatcher.$preventDefault = true;\n\t\t\t\t\tsetTimeout(function(){\n\t\t\t\t\t\tdispatcher.$preventDefault = false;\n\t\t\t\t\t}, 300);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tvar onReady = gantt.attachEvent(\"onGanttReady\", function(){\n\t\t\t\t// restore focus on repainted tasks\n\t\t\t\tgantt.detachEvent(onReady);\n\n\t\t\t\tgantt.$data.tasksStore.attachEvent(\"onStoreUpdated\", function(id){\n\t\t\t\t\tif (gantt.config.keyboard_navigation && dispatcher.isEnabled()) {\n\t\t\t\t\t\tconst currentNode = dispatcher.getActiveNode();\n\t\t\t\t\t\tconst grid = gantt.$ui.getView(\"grid\");\n\t\t\t\t\t\tconst top = grid.getItemTop(id);\n\t\t\t\t\t\tconst gridDataTopScroll = grid.$grid_data.scrollTop;\n\t\t\t\t\t\tconst gridDataBottomScroll = gridDataTopScroll + grid.$grid_data.getBoundingClientRect().height;\n\t\t\t\t\t\tif(currentNode && currentNode.taskId == id){\n\t\t\t\t\t\t\t// GS-2539:  Don't refocus the node if it is selected and outside the visible range in the grid\n\t\t\t\t\t\t\tif(gridDataTopScroll <= top && gridDataBottomScroll >= top){\n\t\t\t\t\t\t\t\treFocusActiveNode();\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t\tif(gantt._smart_render){\n\t\t\t\t\tvar updateRender = gantt._smart_render._redrawTasks;\n\t\t\t\t\tgantt._smart_render._redrawTasks = function(renderers, items){\n\t\t\t\t\t\tif(gantt.config.keyboard_navigation && dispatcher.isEnabled()){\n\t\t\t\t\t\t\tvar currentNode = dispatcher.getActiveNode();\n\t\t\t\t\t\t\tif(currentNode && currentNode.taskId !== undefined){\n\t\t\t\t\t\t\t\tvar focusedItemVisible = false;\n\t\t\t\t\t\t\t\tfor(var i = 0; i < items.length; i++){\n\t\t\t\t\t\t\t\t\tif(items[i].id == currentNode.taskId && items[i].start_date){\n\t\t\t\t\t\t\t\t\t\tfocusedItemVisible = true;\n\t\t\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tif(!focusedItemVisible){\n\t\t\t\t\t\t\t\t\titems.push(gantt.getTask(currentNode.taskId));\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t\tvar res = updateRender.apply(this, arguments);\n\n\t\t\t\t\t\treturn res;\n\t\t\t\t\t};\n\t\t\t\t}\n\t\t\t});\n\n\n\t\t\tlet createdTaskId = null;\n\t\t\tlet keepFocusOnNewTask = false;\n\t\t\tgantt.attachEvent(\"onTaskCreated\", function (task) {\n\t\t\t\tcreatedTaskId = task.id;\n\t\t\t\treturn true;\n\t\t\t});\n\n\t\t\tgantt.attachEvent(\"onAfterTaskAdd\", function(id,item){\n\t\t\t\tif(!gantt.config.keyboard_navigation) return true;\n\t\t\t\tif(dispatcher.isEnabled()){\n\n\t\t\t\t\t// GS-1394. After adding a new task, the focus shouldn't change to the placeholder task\n\t\t\t\t\tif (id == createdTaskId) {\n\t\t\t\t\t\tkeepFocusOnNewTask = true;\n\t\t\t\t\t\tsetTimeout(() => {\n\t\t\t\t\t\t\tkeepFocusOnNewTask = false;\n\t\t\t\t\t\t\tcreatedTaskId = null;\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t\tif (keepFocusOnNewTask && item.type == gantt.config.types.placeholder) {\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tvar columnIndex = 0;\n\t\t\t\t\tvar node = dispatcher.activeNode;\n\t\t\t\t\tif(node instanceof gantt.$keyboardNavigation.TaskCell){\n\t\t\t\t\t\tcolumnIndex = node.columnIndex;\n\t\t\t\t\t}\n\t\t\t\t\tvar nodeConstructor = getTaskNodeConstructor();\n\n\t\t\t\t\tif (item.type == gantt.config.types.placeholder && gantt.config.placeholder_task.focusOnCreate === false) {\n\t\t\t\t\t\t// do not focus on the placeholder task\n\t\t\t\t\t} else {\n\t\t\t\t\t\tdispatcher.setActiveNode(new nodeConstructor(id, columnIndex));\n\t\t\t\t\t}\n\n\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tgantt.attachEvent(\"onTaskIdChange\", function(oldId, newId){\n\t\t\t\tif(!gantt.config.keyboard_navigation) return true;\n\n\t\t\t\tvar node = dispatcher.activeNode;\n\t\t\t\tif(dispatcher.isTaskFocused(oldId)){\n\t\t\t\t\tnode.taskId = newId;\n\t\t\t\t}\n\n\t\t\t\treturn true;\n\t\t\t});\n\n\t\t\tvar interval = setInterval(function(){\n\t\t\t\tif(!gantt.config.keyboard_navigation) return;\n\t\t\t\tif(!dispatcher.isEnabled()){\n\t\t\t\t\tdispatcher.enable();\n\t\t\t\t}\n\t\t\t\treturn;\n\t\t\t}, 500);\n\n\t\t\tgantt.attachEvent(\"onDestroy\", function(){\n\t\t\t\tclearInterval(interval);\n\t\t\t});\n\n\t\t\tfunction getScopeName(obj){\n\t\t\t\tif(obj instanceof gantt.$keyboardNavigation.GanttNode){\n\t\t\t\t\treturn \"gantt\";\n\t\t\t\t}else if(obj instanceof gantt.$keyboardNavigation.HeaderCell){\n\t\t\t\t\treturn \"headerCell\";\n\t\t\t\t}else if(obj instanceof gantt.$keyboardNavigation.TaskRow){\n\t\t\t\t\treturn \"taskRow\";\n\t\t\t\t}else if(obj instanceof gantt.$keyboardNavigation.TaskCell){\n\t\t\t\t\treturn \"taskCell\";\n\t\t\t\t}\n\t\t\t\treturn null;\n\t\t\t}\n\n\t\t\tfunction getScope(mode){\n\t\t\t\tvar scopes = {\n\t\t\t\t\t\"gantt\":gantt.$keyboardNavigation.GanttNode,\n\t\t\t\t\t\"headerCell\": gantt.$keyboardNavigation.HeaderCell,\n\t\t\t\t\t\"taskRow\": gantt.$keyboardNavigation.TaskRow,\n\t\t\t\t\t\"taskCell\": gantt.$keyboardNavigation.TaskCell\n\t\t\t\t};\n\n\t\t\t\treturn scopes[mode] || scopes.gantt;\n\t\t\t}\n\n\t\t\tfunction findVisibleColumnIndex(columnName) {\n\t\t\t\tvar columns = gantt.getGridColumns();\n\t\t\t\tfor (var i = 0; i < columns.length; i++){\n\t\t\t\t\tif(columns[i].name == columnName){\n\t\t\t\t\t\treturn i;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\treturn 0;\n\t\t\t}\n\n\t\t\tvar keyNavFacade = {};\n\t\t\teventable(keyNavFacade);\n\t\t\tgantt.mixin(keyNavFacade, {\n\t\t\t\taddShortcut: function(shortcut, handler, scope){\n\t\t\t\t\tvar scopeObject = getScope(scope);\n\t\t\t\t\tif(scopeObject){\n\t\t\t\t\t\tscopeObject.prototype.bind(shortcut, handler);\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tgetShortcutHandler: function(shortcut, scope){\n\t\t\t\t\tvar commands = gantt.$keyboardNavigation.shortcuts.parse(shortcut);\n\t\t\t\t\tif(commands.length){\n\t\t\t\t\t\treturn keyNavFacade.getCommandHandler(commands[0], scope);\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tgetCommandHandler: function(command, scope){\n\t\t\t\t\tvar scopeObject = getScope(scope);\n\t\t\t\t\tif(scopeObject){\n\t\t\t\t\t\tif(command){\n\t\t\t\t\t\t\treturn scopeObject.prototype.findHandler(command);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tremoveShortcut: function(shortcut, scope){\n\t\t\t\t\tvar scopeObject = getScope(scope);\n\t\t\t\t\tif(scopeObject){\n\t\t\t\t\t\tscopeObject.prototype.unbind(shortcut);\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tfocus: function(config){\n\t\t\t\t\tvar type = config ? config.type : null;\n\t\t\t\t\tvar constructor = getScope(type);\n\t\t\t\t\tvar node;\n\t\t\t\t\tswitch (type){\n\t\t\t\t\t\tcase \"taskCell\":\n\t\t\t\t\t\t\tnode = new constructor(config.id, findVisibleColumnIndex(config.column));\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\tcase \"taskRow\":\n\t\t\t\t\t\t\tnode = new constructor(config.id);\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\tcase \"headerCell\":\n\t\t\t\t\t\t\tnode = new constructor(findVisibleColumnIndex(config.column));\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\tdefault:\n\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t\tdispatcher.delay(function(){\n\t\t\t\t\t\tif(node){\n\t\t\t\t\t\t\tdispatcher.setActiveNode(node);\n\t\t\t\t\t\t}else{\n\t\t\t\t\t\t\tdispatcher.enable();\n\t\t\t\t\t\t\tif(!dispatcher.getActiveNode()){\n\n\t\t\t\t\t\t\t\tdispatcher.setDefaultNode();\n\t\t\t\t\t\t\t}else{\n\n\t\t\t\t\t\t\t\tif(!dispatcher.awaitsFocus()){\n\t\t\t\t\t\t\t\t\tdispatcher.enable();\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\n\t\t\t\t\t});\n\t\t\t\t},\n\n\t\t\t\tgetActiveNode: function(){\n\t\t\t\t\tif(dispatcher.isEnabled()){\n\t\t\t\t\t\tvar node = dispatcher.getActiveNode();\n\t\t\t\t\t\tvar scope = getScopeName(node);\n\t\t\t\t\t\tvar columns = gantt.getGridColumns();\n\t\t\t\t\t\tswitch (scope){\n\t\t\t\t\t\t\tcase \"taskCell\":\n\t\t\t\t\t\t\t\treturn {type:\"taskCell\", id:node.taskId, column:columns[node.columnIndex].name};\n\t\t\t\t\t\t\tcase \"taskRow\":\n\t\t\t\t\t\t\t\treturn {type:\"taskRow\", id:node.taskId};\n\t\t\t\t\t\t\tcase \"headerCell\":\n\t\t\t\t\t\t\t\treturn {type:\"headerCell\", column:columns[node.index].name};\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\treturn null;\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tgantt.$keyboardNavigation.facade = keyNavFacade;\n\n\t\t\tgantt.ext.keyboardNavigation = keyNavFacade;\n\t\t\tgantt.focus = function(){\n\t\t\t\tkeyNavFacade.focus();\n\t\t\t};\n\t\t\tgantt.addShortcut = keyNavFacade.addShortcut;\n\t\t\tgantt.getShortcutHandler = keyNavFacade.getShortcutHandler;\n\t\t\tgantt.removeShortcut = keyNavFacade.removeShortcut;\n\t\t})();\n\n\n\t}\n\n\tsetupKeyNav(gantt);\n\n\n\n};","export default function(gantt) {\n\n\tgantt.$keyboardNavigation.shortcuts = {\n\t\tcreateCommand: function () {\n\t\t\treturn {\n\t\t\t\tmodifiers: {\n\t\t\t\t\t\"shift\": false,\n\t\t\t\t\t\"alt\": false,\n\t\t\t\t\t\"ctrl\": false,\n\t\t\t\t\t\"meta\": false\n\t\t\t\t},\n\t\t\t\tkeyCode: null\n\t\t\t};\n\t\t},\n\t\tparse: function (shortcut) {\n\t\t\tvar commands = [];\n\n\t\t\tvar expr = this.getExpressions(this.trim(shortcut));\n\t\t\tfor (var i = 0; i < expr.length; i++) {\n\t\t\t\tvar words = this.getWords(expr[i]);\n\n\t\t\t\tvar command = this.createCommand();\n\n\t\t\t\tfor (var j = 0; j < words.length; j++) {\n\t\t\t\t\tif (this.commandKeys[words[j]]) {\n\t\t\t\t\t\tcommand.modifiers[words[j]] = true;\n\t\t\t\t\t} else if (this.specialKeys[words[j]]) {\n\t\t\t\t\t\tcommand.keyCode = this.specialKeys[words[j]];\n\t\t\t\t\t} else {\n\t\t\t\t\t\tcommand.keyCode = words[j].charCodeAt(0);\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tcommands.push(command);\n\t\t\t}\n\t\t\treturn commands;\n\t\t},\n\n\t\tgetCommandFromEvent: function (domEvent) {\n\t\t\tvar command = this.createCommand();\n\t\t\tcommand.modifiers.shift = !!domEvent.shiftKey;\n\t\t\tcommand.modifiers.alt = !!domEvent.altKey;\n\t\t\tcommand.modifiers.ctrl = !!domEvent.ctrlKey;\n\t\t\tcommand.modifiers.meta = !!domEvent.metaKey;\n\t\t\tcommand.keyCode = domEvent.which || domEvent.keyCode;\n\n\t\t\tif(command.keyCode >= 96 && command.keyCode <= 105){\n\t\t\t\t// numpad keys 96-105 -> 48-57\n\t\t\t\tcommand.keyCode -= 48;//convert numpad  number code to regular number code\n\t\t\t}\n\n\t\t\tvar printableKey = String.fromCharCode(command.keyCode);\n\t\t\tif (printableKey) {\n\t\t\t\tcommand.keyCode = printableKey.toLowerCase().charCodeAt(0);\n\t\t\t}\n\t\t\treturn command;\n\t\t},\n\n\t\tgetHashFromEvent: function (domEvent) {\n\t\t\treturn this.getHash(this.getCommandFromEvent(domEvent));\n\t\t},\n\n\t\tgetHash: function (command) {\n\t\t\tvar parts = [];\n\t\t\tfor (var i in command.modifiers) {\n\t\t\t\tif (command.modifiers[i]) {\n\t\t\t\t\tparts.push(i);\n\t\t\t\t}\n\t\t\t}\n\t\t\tparts.push(command.keyCode);\n\n\t\t\treturn parts.join(this.junctionChar);\n\t\t},\n\n\t\tgetExpressions: function (shortcut) {\n\t\t\treturn shortcut.split(this.junctionChar);\n\t\t},\n\t\tgetWords: function (term) {\n\t\t\treturn term.split(this.combinationChar);\n\t\t},\n\t\ttrim: function (shortcut) {\n\t\t\treturn shortcut.replace(/\\s/g, \"\");\n\t\t},\n\t\tjunctionChar: \",\",\n\t\tcombinationChar: \"+\",\n\t\tcommandKeys: {\n\t\t\t\"shift\": 16,\n\t\t\t\"alt\": 18,\n\t\t\t\"ctrl\": 17,\n\t\t\t\"meta\": true\n\t\t},\n\t\tspecialKeys: {\n\t\t\t\"backspace\": 8,\n\t\t\t\"tab\": 9,\n\t\t\t\"enter\": 13,\n\t\t\t\"esc\": 27,\n\t\t\t\"space\": 32,\n\t\t\t\"up\": 38,\n\t\t\t\"down\": 40,\n\t\t\t\"left\": 37,\n\t\t\t\"right\": 39,\n\t\t\t\"home\": 36,\n\t\t\t\"end\": 35,\n\t\t\t\"pageup\": 33,\n\t\t\t\"pagedown\": 34,\n\t\t\t\"delete\": 46,\n\t\t\t\"insert\": 45,\n\t\t\t\"plus\": 107,\n\t\t\t\"f1\": 112,\n\t\t\t\"f2\": 113,\n\t\t\t\"f3\": 114,\n\t\t\t\"f4\": 115,\n\t\t\t\"f5\": 116,\n\t\t\t\"f6\": 117,\n\t\t\t\"f7\": 118,\n\t\t\t\"f8\": 119,\n\t\t\t\"f9\": 120,\n\t\t\t\"f10\": 121,\n\t\t\t\"f11\": 122,\n\t\t\t\"f12\": 123\n\t\t}\n\t};\n};","export default function(gantt) {\n\n\tgantt.$keyboardNavigation.EventHandler = {\n\t\t_handlers: null,\n\t\tfindHandler: function (command) {\n\t\t\tif (!this._handlers) this._handlers = {};\n\t\t\tvar shortcuts = gantt.$keyboardNavigation.shortcuts;\n\t\t\tvar hash = shortcuts.getHash(command);\n\n\t\t\treturn this._handlers[hash];\n\t\t},\n\n\t\tdoAction: function (command, e) {\n\t\t\tvar handler = this.findHandler(command);\n\t\t\tif (handler) {\n\t\t\t\tvar eventFacade = gantt.$keyboardNavigation.facade;\n\n\t\t\t\tif(eventFacade.callEvent(\"onBeforeAction\", [command, e]) === false){\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\thandler.call(this, e);\n\n\t\t\t\tif (e.preventDefault) e.preventDefault();\n\t\t\t\telse e.returnValue = false;\n\n\t\t\t}\n\t\t},\n\t\tbind: function (shortcut, handler) {\n\t\t\tif (!this._handlers) this._handlers = {};\n\n\t\t\tvar shortcuts = gantt.$keyboardNavigation.shortcuts;\n\n\t\t\tvar commands = shortcuts.parse(shortcut);\n\t\t\tfor (var i = 0; i < commands.length; i++) {\n\t\t\t\tthis._handlers[shortcuts.getHash(commands[i])] = handler;\n\t\t\t}\n\t\t},\n\t\tunbind: function (shortcut) {\n\t\t\tvar shortcuts = gantt.$keyboardNavigation.shortcuts;\n\n\t\t\tvar commands = shortcuts.parse(shortcut);\n\t\t\tfor (var i = 0; i < commands.length; i++) {\n\t\t\t\tif (this._handlers[shortcuts.getHash(commands[i])]) {\n\t\t\t\t\tdelete this._handlers[shortcuts.getHash(commands[i])];\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\n\t\tbindAll: function (map) {\n\t\t\tfor (var i in map) {\n\t\t\t\tthis.bind(i, map[i]);\n\t\t\t}\n\t\t},\n\t\tinitKeys: function () {\n\t\t\tif (!this._handlers)\n\t\t\t\tthis._handlers = {};\n\t\t\tif (this.keys) {\n\t\t\t\tthis.bindAll(this.keys);\n\t\t\t}\n\t\t}\n\t};\n\n};","import * as domHelpers from \"../../../core/ui/utils/dom_helpers\";\n\nexport default function(gantt) {\n\n\t(function () {\n\t\t\n\t\tgantt.$keyboardNavigation.getFocusableNodes = domHelpers.getFocusableNodes;\n\n\t\tgantt.$keyboardNavigation.trapFocus = function trapFocus(root, e) {\n\t\t\tif (e.keyCode != 9) return false;\n\n\t\t\tvar focusable = gantt.$keyboardNavigation.getFocusableNodes(root);\n\t\t\tvar currentFocus = domHelpers.getActiveElement();\n\t\t\tvar currentIndex = -1;\n\t\t\tfor (var i = 0; i < focusable.length; i++) {\n\t\t\t\tif (focusable[i] == currentFocus) {\n\t\t\t\t\tcurrentIndex = i;\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (e.shiftKey) {\n\t\t\t\t// back tab\n\t\t\t\tif (currentIndex <= 0) {\n\t\t\t\t\t// go to the last element if we focused on the first\n\t\t\t\t\tvar lastItem = focusable[focusable.length - 1];\n\t\t\t\t\tif (lastItem) {\n\t\t\t\t\t\tlastItem.focus();\n\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t\treturn true;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t} else {\n\t\t\t\t// forward tab\n\t\t\t\tif (currentIndex >= focusable.length - 1) {\n\t\t\t\t\t// forward tab from last element should go back to the first element\n\t\t\t\t\tvar firstItem = focusable[0];\n\t\t\t\t\tif (firstItem) {\n\t\t\t\t\t\tfirstItem.focus();\n\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t\treturn true;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn false;\n\t\t};\n\t})();\n\n};","export default function(gantt) {\n\n\tgantt.$keyboardNavigation.GanttNode = function () {\n\t};\n\n\tgantt.$keyboardNavigation.GanttNode.prototype = gantt._compose(\n\t\tgantt.$keyboardNavigation.EventHandler,\n\t\t{\n\n\t\t\tfocus: function () {\n\t\t\t\tgantt.focus();\n\t\t\t},\n\n\t\t\tblur: function () {\n\n\t\t\t},\n\n\t\t\tisEnabled: function () {\n\t\t\t\treturn gantt.$container.hasAttribute(\"tabindex\");\n\t\t\t},\n\n\t\t\tscrollHorizontal: function scrollHorizontal(dir) {\n\t\t\t\tvar date = gantt.dateFromPos(gantt.getScrollState().x);\n\t\t\t\tvar scale = gantt.getScale();\n\t\t\t\tvar step = dir < 0 ? -scale.step : scale.step;\n\t\t\t\tdate = gantt.date.add(date, step, scale.unit);\n\t\t\t\tgantt.scrollTo(gantt.posFromDate(date));\n\t\t\t},\n\n\t\t\tscrollVertical: function scrollVertical(dir) {\n\t\t\t\tvar top = gantt.getScrollState().y;\n\t\t\t\tvar step = gantt.config.row_height;\n\t\t\t\tgantt.scrollTo(null, top + (dir < 0 ? -1 : 1) * step);\n\t\t\t},\n\n\t\t\tkeys: {\n\t\t\t\t\"alt+left\": function (e) {\n\t\t\t\t\tthis.scrollHorizontal(-1);\n\t\t\t\t},\n\t\t\t\t\"alt+right\": function (e) {\n\t\t\t\t\tthis.scrollHorizontal(1);\n\t\t\t\t},\n\t\t\t\t\"alt+up\": function (e) {\n\t\t\t\t\tthis.scrollVertical(-1);\n\t\t\t\t},\n\t\t\t\t\"alt+down\": function (e) {\n\t\t\t\t\tthis.scrollVertical(1);\n\t\t\t\t},\n\n\t\t\t\t// undo\n\t\t\t\t\"ctrl+z\": function () {\n\t\t\t\t\tif (gantt.undo) gantt.undo();\n\t\t\t\t},\n\n\t\t\t\t// redo\n\t\t\t\t\"ctrl+r\": function () {\n\t\t\t\t\tif (gantt.redo) gantt.redo();\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t);\n\n\tgantt.$keyboardNavigation.GanttNode.prototype.bindAll(gantt.$keyboardNavigation.GanttNode.prototype.keys);\n\n};","export default function(gantt) {\n\n\tgantt.$keyboardNavigation.KeyNavNode = function () {\n\t};\n\n\tgantt.$keyboardNavigation.KeyNavNode.prototype = gantt._compose(\n\t\tgantt.$keyboardNavigation.EventHandler,\n\t\t{\n\t\t\tisValid: function () {\n\t\t\t\treturn true;\n\t\t\t},\n\t\t\tfallback: function () {\n\t\t\t\treturn null;\n\t\t\t},\n\n\t\t\tmoveTo: function (element) {\n\t\t\t\tgantt.$keyboardNavigation.dispatcher.setActiveNode(element);\n\t\t\t},\n\n\t\t\tcompareTo: function (b) {\n\t\t\t\t// good enough comparison of two random objects\n\t\t\t\tif (!b) return false;\n\t\t\t\tfor (var i in this) {\n\t\t\t\t\tif (!!this[i] != !!b[i]) return false;\n\n\t\t\t\t\tvar canStringifyThis = !!(this[i] && this[i].toString);\n\t\t\t\t\tvar canStringifyThat = !!(b[i] && b[i].toString);\n\t\t\t\t\tif (canStringifyThat != canStringifyThis) return false;\n\t\t\t\t\tif (!(canStringifyThat && canStringifyThis)) {\n\t\t\t\t\t\tif (b[i] != this[i]) return false;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tif (b[i].toString() != this[i].toString())\n\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\treturn true;\n\t\t\t},\n\n\t\t\tgetNode: function () {\n\t\t\t},\n\t\t\tfocus: function () {\n\t\t\t\tvar node = this.getNode();\n\t\t\t\tif(!node)\n\t\t\t\t\treturn;\n\n\t\t\t\tvar eventFacade = gantt.$keyboardNavigation.facade;\n\n\t\t\t\tif(eventFacade.callEvent(\"onBeforeFocus\", [node]) === false){\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tif (node) {\n\t\t\t\t\tnode.setAttribute(\"tabindex\", \"-1\");\n\t\t\t\t\tif(!node.$eventAttached){\n\t\t\t\t\t\tnode.$eventAttached = true;\n\t\t\t\t\t\tgantt.event(node, \"focus\",function(e){\n\t\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t}, false);\n\t\t\t\t\t}\n\t\t\t\t\t//node.className += \" gantt_focused\";\n\t\t\t\t\tif (gantt.utils.dom.isChildOf(document.activeElement, node)){\n\t\t\t\t\t\tnode = document.activeElement;\n\t\t\t\t\t}\n\t\t\t\t\tif (node.focus) node.focus();\n\n\t\t\t\t\teventFacade.callEvent(\"onFocus\", [this.getNode()]);\n\t\t\t\t}\n\n\t\t\t},\n\t\t\tblur: function () {\n\t\t\t\tvar node = this.getNode();\n\t\t\t\tif (node) {\n\t\t\t\t\tvar eventFacade = gantt.$keyboardNavigation.facade;\n\t\t\t\t\teventFacade.callEvent(\"onBlur\", [node]);\n\t\t\t\t\tnode.setAttribute(\"tabindex\", \"-1\");\n\t\t\t\t\t//node.className = (node.className || \"\").replace(/ ?gantt_focused/g, \"\");\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t);\n\n};","import * as domHelpers from \"../../../core/ui/utils/dom_helpers\";\n\nexport default function(gantt) {\n\n\tgantt.$keyboardNavigation.HeaderCell = function (index) {\n\t\tthis.index = index || 0;\n\t};\n\n\tgantt.$keyboardNavigation.HeaderCell.prototype = gantt._compose(\n\t\tgantt.$keyboardNavigation.KeyNavNode,\n\t\t{\n\t\t\t_handlers: null,\n\n\t\t\tisValid: function () {\n\t\t\t\tif (!gantt.config.show_grid) {\n\t\t\t\t\tif (gantt.getVisibleTaskCount())\n\t\t\t\t\t\treturn false;\n\t\t\t\t}\n\t\t\t\treturn !!gantt.getGridColumns()[this.index] || !gantt.getVisibleTaskCount();\n\t\t\t},\n\t\t\tfallback: function () {\n\t\t\t\tif (!gantt.config.show_grid) {\n\t\t\t\t\tif (gantt.getVisibleTaskCount()) {\n\t\t\t\t\t\treturn new gantt.$keyboardNavigation.TaskRow();\n\t\t\t\t\t}\n\t\t\t\t\treturn null;\n\t\t\t\t}\n\t\t\t\tvar visibleColumns = gantt.getGridColumns();\n\t\t\t\tvar index = this.index;\n\t\t\t\twhile (index >= 0) {\n\t\t\t\t\tif (visibleColumns[index])\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tindex--;\n\t\t\t\t}\n\t\t\t\tif (visibleColumns[index]) {\n\t\t\t\t\treturn new gantt.$keyboardNavigation.HeaderCell(index);\n\t\t\t\t} else {\n\t\t\t\t\treturn null;\n\t\t\t\t}\n\t\t\t},\n\n\t\t\tfromDomElement: function(el){\n\t\t\t\tvar cellElement = domHelpers.locateClassName(el, \"gantt_grid_head_cell\");\n\t\t\t\tif(cellElement){\n\t\t\t\t\tvar index = 0;\n\t\t\t\t\twhile(cellElement && cellElement.previousSibling){\n\t\t\t\t\t\tcellElement = cellElement.previousSibling;\n\t\t\t\t\t\tindex += 1;\n\t\t\t\t\t}\n\t\t\t\t\treturn new gantt.$keyboardNavigation.HeaderCell(index);\n\t\t\t\t}else{\n\t\t\t\t\treturn null;\n\t\t\t\t}\n\t\t\t},\n\n\t\t\tgetNode: function () {\n\t\t\t\tvar cells = gantt.$grid_scale.childNodes;\n\t\t\t\treturn cells[this.index];\n\t\t\t},\n\n\n\t\t\tkeys: {\n\n\t\t\t\t\"left\": function () {\n\t\t\t\t\tif (this.index > 0) {\n\t\t\t\t\t\tthis.moveTo(new gantt.$keyboardNavigation.HeaderCell(this.index - 1));\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\t\"right\": function () {\n\t\t\t\t\tvar columns = gantt.getGridColumns();\n\t\t\t\t\tif (this.index < columns.length - 1) {\n\t\t\t\t\t\tthis.moveTo(new gantt.$keyboardNavigation.HeaderCell(this.index + 1));\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\t\"down\": function () {\n\t\t\t\t\tvar taskRow;\n\t\t\t\t\tvar rootLevel = gantt.getChildren(gantt.config.root_id);\n\t\t\t\t\tif (gantt.isTaskExists(rootLevel[0])) {\n\t\t\t\t\t\ttaskRow = rootLevel[0];\n\t\t\t\t\t}\n\t\t\t\t\tif (taskRow) {\n\t\t\t\t\t\tif (gantt.config.keyboard_navigation_cells) {\n\t\t\t\t\t\t\tthis.moveTo(new gantt.$keyboardNavigation.TaskCell(taskRow, this.index));\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tthis.moveTo(new gantt.$keyboardNavigation.TaskRow(taskRow));\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t},\n\n\t\t\t\t\"end\": function () {\n\t\t\t\t\tvar columns = gantt.getGridColumns();\n\t\t\t\t\tthis.moveTo(new gantt.$keyboardNavigation.HeaderCell(columns.length - 1));\n\t\t\t\t},\n\t\t\t\t\"home\": function () {\n\t\t\t\t\tthis.moveTo(new gantt.$keyboardNavigation.HeaderCell(0));\n\t\t\t\t},\n\n\n\t\t\t\t// press header button\n\t\t\t\t\"enter, space\": function () {\n\t\t\t\t\tvar node = domHelpers.getActiveElement();\n\t\t\t\t\tnode.click();\n\t\t\t\t},\n\n\t\t\t\t// add new task\n\t\t\t\t\"ctrl+enter\": function () {\n\t\t\t\t\tif (gantt.isReadonly(this)) {\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t\tgantt.createTask({}, this.taskId);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t);\n\n\tgantt.$keyboardNavigation.HeaderCell.prototype.bindAll(gantt.$keyboardNavigation.HeaderCell.prototype.keys);\n\n};","export default function(gantt) {\n\n\tgantt.$keyboardNavigation.TaskRow = function (taskId) {\n\t\tif (!taskId) {\n\t\t\tvar rootLevel = gantt.getChildren(gantt.config.root_id);\n\t\t\tif (rootLevel[0]) {\n\t\t\t\ttaskId = rootLevel[0];\n\t\t\t}\n\t\t}\n\t\tthis.taskId = taskId;\n\t\tif (gantt.isTaskExists(this.taskId)) {\n\t\t\tthis.index = gantt.getTaskIndex(this.taskId);\n\t\t\tthis.globalIndex = gantt.getGlobalTaskIndex(this.taskId);\n\t\t\tthis.splitItem = !!gantt.getTask(this.taskId).$split_subtask;\n\t\t\tthis.parentId = gantt.getParent(this.taskId);\n\t\t}\n\t};\n\n\tgantt.$keyboardNavigation.TaskRow.prototype = gantt._compose(\n\t\tgantt.$keyboardNavigation.KeyNavNode,\n\t\t{\n\t\t\t_handlers: null,\n\t\t\tisValid: function () {\n\t\t\t\treturn gantt.isTaskExists(this.taskId) && (gantt.getTaskIndex(this.taskId) > -1);\n\t\t\t},\n\t\t\tfallback: function () {\n\t\t\t\tif (!gantt.getVisibleTaskCount()) {\n\t\t\t\t\tvar header = new gantt.$keyboardNavigation.HeaderCell();\n\t\t\t\t\tif (!header.isValid()) return null;\n\t\t\t\t\telse return header;\n\t\t\t\t} else {\n\n\t\t\t\t\tif(!this.splitItem){\n\t\t\t\t\t\tvar nextIndex = -1;\n\t\t\t\t\t\t// GS-1393. When Gantt tries to restore the focus, it should rely on the global index\n\t\t\t\t\t\tif (gantt.getTaskByIndex(this.globalIndex - 1)) {\n\t\t\t\t\t\t\tnextIndex = this.globalIndex - 1;\n\t\t\t\t\t\t} else if (gantt.getTaskByIndex(this.globalIndex + 1)) {\n\t\t\t\t\t\t\tnextIndex = this.globalIndex + 1;\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tvar globalIndex = this.globalIndex;\n\t\t\t\t\t\t\twhile (globalIndex >= 0) {\n\t\t\t\t\t\t\t\tif (gantt.getTaskByIndex(globalIndex)) {\n\t\t\t\t\t\t\t\t\tnextIndex = globalIndex;\n\t\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tglobalIndex--;\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (nextIndex > -1) {\n\t\t\t\t\t\t\treturn new gantt.$keyboardNavigation.TaskRow(gantt.getTaskByIndex(nextIndex).id);\n\t\t\t\t\t\t}\n\t\t\t\t\t}else {\n\t\t\t\t\t\treturn new gantt.$keyboardNavigation.TaskRow(this.parentId);\n\t\t\t\t\t}\n\n\t\t\t\t}\n\t\t\t},\n\n\t\t\tfromDomElement: function(el){\n\t\t\t\tif(gantt.config.keyboard_navigation_cells){\n\t\t\t\t\treturn null;\n\t\t\t\t}\n\n\t\t\t\tvar taskId = gantt.locate(el);\n\t\t\t\tif(gantt.isTaskExists(taskId)){\n\t\t\t\t\treturn new gantt.$keyboardNavigation.TaskRow(taskId);\n\t\t\t\t}else{\n\t\t\t\t\treturn null;\n\t\t\t\t}\n\t\t\t},\n\n\t\t\tgetNode: function () {\n\t\t\t\tif (gantt.isTaskExists(this.taskId) && gantt.isTaskVisible(this.taskId)) {\n\t\t\t\t\tif (gantt.config.show_grid) {\n\t\t\t\t\t\treturn gantt.$grid.querySelector(\".gantt_row[\" + gantt.config.task_attribute + \"='\" + this.taskId + \"']\");\n\t\t\t\t\t} else {\n\t\t\t\t\t\treturn gantt.getTaskNode(this.taskId);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t},\n\n\t\t\tfocus: function (keptFocus) {\n\t\t\t\tif(!keptFocus) {\n\t\t\t\t\tconst pos = gantt.getTaskPosition(gantt.getTask(this.taskId));\n\t\t\t\t\tconst height = gantt.getTaskHeight(this.taskId);\n\t\t\t\t\tconst scroll = gantt.getScrollState();\n\n\t\t\t\t\tlet viewWidth;\n\t\t\t\t\tif(gantt.$task){\n\t\t\t\t\t\tviewWidth = gantt.$task.offsetWidth;\n\t\t\t\t\t}else{\n\t\t\t\t\t\tviewWidth = scroll.inner_width;\n\t\t\t\t\t}\n\n\t\t\t\t\tlet viewHeight;\n\t\t\t\t\tif(gantt.$grid_data || gantt.$task_data){\n\t\t\t\t\t\tviewHeight = (gantt.$grid_data || gantt.$task_data).offsetHeight;\n\t\t\t\t\t}else{\n\t\t\t\t\t\tviewHeight = scroll.inner_height;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (pos.top < scroll.y || pos.top + height > (scroll.y + viewHeight)) {\n\t\t\t\t\t\t// GS-2346: additional scrolling to be sure that the task will be in the required range\n\t\t\t\t\t\tgantt.scrollTo(null, pos.top - 20);\n\t\t\t\t\t} else if (gantt.config.scroll_on_click && gantt.config.show_chart) {\n\t\t\t\t\t\t// horizontal scroll activated\n\t\t\t\t\t\tif (pos.left > (scroll.x + viewWidth)) { // scroll forward to the start of the task\n\t\t\t\t\t\t\tgantt.scrollTo(pos.left - gantt.config.task_scroll_offset);\n\t\t\t\t\t\t} else if (pos.left + pos.width < scroll.x) {  // scroll back to the end of the task\n\t\t\t\t\t\t\tgantt.scrollTo(pos.left + pos.width - gantt.config.task_scroll_offset);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tgantt.$keyboardNavigation.KeyNavNode.prototype.focus.apply(this, [keptFocus]);\n\n\t\t\t\t// GS-152 if there are scrollbars with custom names, change their scroll position\n\t\t\t\tscrollGrid();\n\n\t\t\t\tfunction scrollGrid() {\n\t\t\t\t\tvar grid = gantt.$ui.getView(\"grid\");\n\t\t\t\t\tvar scrollPositionX = parseInt(grid.$grid.scrollLeft);\n\t\t\t\t\tvar scrollPositionY = parseInt(grid.$grid_data.scrollTop);\n\n\t\t\t\t\tvar attachedScrollbarHorizontal = grid.$config.scrollX;\n\n\t\t\t\t\tif (attachedScrollbarHorizontal && grid.$config.scrollable) {\n\t\t\t\t\t\tvar scrollbarHorizontal = gantt.$ui.getView(attachedScrollbarHorizontal);\n\t\t\t\t\t\tif (scrollbarHorizontal) {\n\t\t\t\t\t\t\tscrollbarHorizontal.scrollTo(scrollPositionX, scrollPositionY);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tvar attachedScrollbarVertical = grid.$config.scrollY;\n\n\t\t\t\t\tif (attachedScrollbarVertical) {\n\t\t\t\t\t\tvar scrollbarVertical = gantt.$ui.getView(attachedScrollbarVertical);\n\t\t\t\t\t\tif (scrollbarVertical) {\n\t\t\t\t\t\t\tscrollbarVertical.scrollTo(scrollPositionX, scrollPositionY);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t},\n\n\t\t\tkeys: {\n\t\t\t\t\"pagedown\": function () {\n\t\t\t\t\tif (gantt.getVisibleTaskCount()) {\n\t\t\t\t\t\tthis.moveTo(new gantt.$keyboardNavigation.TaskRow(gantt.getTaskByIndex(gantt.getVisibleTaskCount() - 1).id));\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\t\"pageup\": function () {\n\t\t\t\t\tif (gantt.getVisibleTaskCount()) {\n\t\t\t\t\t\tthis.moveTo(new gantt.$keyboardNavigation.TaskRow(gantt.getTaskByIndex(0).id));\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\t\"up\": function () {\n\t\t\t\t\tvar nextElement = null;\n\t\t\t\t\tvar prevTask = gantt.getPrev(this.taskId);\n\t\t\t\t\tif (!gantt.isTaskExists(prevTask)) {\n\t\t\t\t\t\tnextElement = new gantt.$keyboardNavigation.HeaderCell();\n\t\t\t\t\t} else {\n\t\t\t\t\t\tnextElement = new gantt.$keyboardNavigation.TaskRow(prevTask);\n\t\t\t\t\t}\n\t\t\t\t\tthis.moveTo(nextElement);\n\t\t\t\t},\n\t\t\t\t\"down\": function () {\n\t\t\t\t\tvar nextTask = gantt.getNext(this.taskId);\n\t\t\t\t\tif (gantt.isTaskExists(nextTask)) {\n\t\t\t\t\t\tthis.moveTo(new gantt.$keyboardNavigation.TaskRow(nextTask));\n\t\t\t\t\t}\n\t\t\t\t},\n\n\t\t\t\t\"shift+down\": function(){\n\t\t\t\t\tif(gantt.hasChild(this.taskId) && !gantt.getTask(this.taskId).$open){\n\t\t\t\t\t\tgantt.open(this.taskId);\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\t\"shift+up\": function(){\n\t\t\t\t\tif(gantt.hasChild(this.taskId) && gantt.getTask(this.taskId).$open){\n\t\t\t\t\t\tgantt.close(this.taskId);\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\t\"shift+right\": function() {\n\t\t\t\t\tif (gantt.isReadonly(this)) {\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t\tvar prevId = gantt.getPrevSibling(this.taskId);\n\t\t\t\t\tif(gantt.isTaskExists(prevId) && !gantt.isChildOf(this.taskId, prevId)){\n\t\t\t\t\t\tvar parent = gantt.getTask(prevId);\n\t\t\t\t\t\tparent.$open = true;\n\t\t\t\t\t\tvar result = gantt.moveTask(this.taskId, -1, prevId);\n\t\t\t\t\t\tif(result !== false)\n\t\t\t\t\t\t\tgantt.updateTask(this.taskId);\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\t\"shift+left\": function() {\n\t\t\t\t\tif (gantt.isReadonly(this)) {\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t\tvar parent = gantt.getParent(this.taskId);\n\t\t\t\t\tif(gantt.isTaskExists(parent)){\n\t\t\t\t\t\tvar result =  gantt.moveTask(this.taskId, gantt.getTaskIndex(parent) + 1, gantt.getParent(parent));\n\t\t\t\t\t\tif(result !== false)\n\t\t\t\t\t\t\tgantt.updateTask(this.taskId);\n\t\t\t\t\t}\n\t\t\t\t},\n\n\t\t\t\t// select\n\t\t\t\t\"space\": function (e) {\n\t\t\t\t\tif (!gantt.isSelectedTask(this.taskId)) {\n\t\t\t\t\t\tgantt.selectTask(this.taskId);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tgantt.unselectTask(this.taskId);\n\t\t\t\t\t}\n\t\t\t\t},\n\n\t\t\t\t// collapse\n\t\t\t\t\"ctrl+left\": function (e) {\n\t\t\t\t\tgantt.close(this.taskId);\n\t\t\t\t},\n\t\t\t\t// expand\n\t\t\t\t\"ctrl+right\": function (e) {\n\t\t\t\t\tgantt.open(this.taskId);\n\t\t\t\t},\n\n\t\t\t\t// delete task\n\t\t\t\t\"delete\": function (e) {\n\t\t\t\t\tif (gantt.isReadonly(this)) {\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t\tgantt.$click.buttons[\"delete\"](this.taskId);\n\t\t\t\t},\n\n\t\t\t\t// open lightbox\n\t\t\t\t\"enter\": function () {\n\t\t\t\t\tif (gantt.isReadonly(this)) {\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t\tgantt.showLightbox(this.taskId);\n\t\t\t\t},\n\n\t\t\t\t// add subtask\n\t\t\t\t\"ctrl+enter\": function () {\n\t\t\t\t\tif (gantt.isReadonly(this)) {\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t\tgantt.createTask({}, this.taskId);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t);\n\tgantt.$keyboardNavigation.TaskRow.prototype.bindAll(gantt.$keyboardNavigation.TaskRow.prototype.keys);\n\n};","import * as domHelpers from \"../../../core/ui/utils/dom_helpers\";\nimport {replaceValidZeroId} from \"../../../utils/helpers\";\n\nexport default function(gantt) {\n\n\n\tgantt.$keyboardNavigation.TaskCell = function (taskId, index) {\n\t\ttaskId = replaceValidZeroId(taskId, gantt.config.root_id);\n\t\tif (!taskId) {\n\t\t\tvar rootLevel = gantt.getChildren(gantt.config.root_id);\n\t\t\tif (rootLevel[0]) {\n\t\t\t\ttaskId = rootLevel[0];\n\t\t\t}\n\t\t}\n\t\tthis.taskId = taskId;\n\t\tthis.columnIndex = index || 0;\n\t\t// provided task may not exist, in this case node will be detectes as invalid\n\t\tif (gantt.isTaskExists(this.taskId)) {\n\t\t\tthis.index = gantt.getTaskIndex(this.taskId);\n\t\t\tthis.globalIndex = gantt.getGlobalTaskIndex(this.taskId);\n\t\t}\n\t};\n\n\tgantt.$keyboardNavigation.TaskCell.prototype = gantt._compose(\n\t\tgantt.$keyboardNavigation.TaskRow,\n\t\t{\n\t\t\t_handlers: null,\n\t\t\tisValid: function () {\n\n\t\t\t\treturn gantt.$keyboardNavigation.TaskRow.prototype.isValid.call(this) && !!gantt.getGridColumns()[this.columnIndex];\n\t\t\t},\n\t\t\tfallback: function () {\n\n\t\t\t\tvar node = gantt.$keyboardNavigation.TaskRow.prototype.fallback.call(this);\n\t\t\t\tvar result = node;\n\t\t\t\tif (node instanceof gantt.$keyboardNavigation.TaskRow) {\n\t\t\t\t\tvar visibleColumns = gantt.getGridColumns();\n\t\t\t\t\tvar index = this.columnIndex;\n\t\t\t\t\twhile (index >= 0) {\n\t\t\t\t\t\tif (visibleColumns[index])\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\tindex--;\n\t\t\t\t\t}\n\t\t\t\t\tif (visibleColumns[index]) {\n\t\t\t\t\t\tresult = new gantt.$keyboardNavigation.TaskCell(node.taskId, index);\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\treturn result;\n\t\t\t},\n\n\t\t\tfromDomElement: function(el){\n\t\t\t\tif(!gantt.config.keyboard_navigation_cells){\n\t\t\t\t\treturn null;\n\t\t\t\t}\n\n\t\t\t\tvar taskId = gantt.locate(el);\n\t\t\t\tif(gantt.isTaskExists(taskId)){\n\t\t\t\t\tvar index = 0;\n\t\t\t\t\tvar cellElement = domHelpers.locateAttribute(el, \"data-column-index\");\n\n\t\t\t\t\tif(cellElement){\n\t\t\t\t\t\tindex = cellElement.getAttribute(\"data-column-index\")*1;\n\t\t\t\t\t}\n\n\t\t\t\t\treturn new gantt.$keyboardNavigation.TaskCell(taskId, index);\n\t\t\t\t}else{\n\t\t\t\t\treturn null;\n\t\t\t\t}\n\t\t\t},\n\n\t\t\tgetNode: function () {\n\t\t\t\tif (gantt.isTaskExists(this.taskId) && gantt.isTaskVisible(this.taskId)) {\n\t\t\t\t\tif (gantt.config.show_grid) {\n\t\t\t\t\t\tvar row = gantt.$grid.querySelector(\".gantt_row[\" + gantt.config.task_attribute + \"='\" + this.taskId + \"']\");\n\t\t\t\t\t\tif(!row)\n\t\t\t\t\t\t\treturn null;\n\t\t\t\t\t\treturn row.querySelector(\"[data-column-index='\"+this.columnIndex+\"']\");\n\t\t\t\t\t} else {\n\t\t\t\t\t\treturn gantt.getTaskNode(this.taskId);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t},\n\n\t\t\tkeys: {\n\t\t\t\t\"up\": function () {\n\n\t\t\t\t\tvar nextElement = null;\n\t\t\t\t\tvar prevTask = gantt.getPrev(this.taskId);\n\t\t\t\t\tif (!gantt.isTaskExists(prevTask)) {\n\t\t\t\t\t\tnextElement = new gantt.$keyboardNavigation.HeaderCell(this.columnIndex);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tnextElement = new gantt.$keyboardNavigation.TaskCell(prevTask, this.columnIndex);\n\t\t\t\t\t}\n\t\t\t\t\tthis.moveTo(nextElement);\n\t\t\t\t},\n\t\t\t\t\"down\": function () {\n\t\t\t\t\tvar nextTask = gantt.getNext(this.taskId);\n\t\t\t\t\tif (gantt.isTaskExists(nextTask)) {\n\t\t\t\t\t\tthis.moveTo(new gantt.$keyboardNavigation.TaskCell(nextTask, this.columnIndex));\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\t\"left\": function () {\n\t\t\t\t\tif (this.columnIndex > 0) {\n\t\t\t\t\t\tthis.moveTo(new gantt.$keyboardNavigation.TaskCell(this.taskId, this.columnIndex - 1));\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\t\"right\": function () {\n\t\t\t\t\tvar columns = gantt.getGridColumns();\n\t\t\t\t\tif (this.columnIndex < columns.length - 1) {\n\t\t\t\t\t\tthis.moveTo(new gantt.$keyboardNavigation.TaskCell(this.taskId, this.columnIndex + 1));\n\t\t\t\t\t}\n\t\t\t\t},\n\n\t\t\t\t\"end\": function () {\n\t\t\t\t\tvar columns = gantt.getGridColumns();\n\t\t\t\t\tthis.moveTo(new gantt.$keyboardNavigation.TaskCell(this.taskId, columns.length - 1));\n\t\t\t\t},\n\t\t\t\t\"home\": function () {\n\t\t\t\t\tthis.moveTo(new gantt.$keyboardNavigation.TaskCell(this.taskId, 0));\n\t\t\t\t},\n\t\t\t\t\"pagedown\": function () {\n\t\t\t\t\tif (gantt.getVisibleTaskCount()) {\n\t\t\t\t\t\tthis.moveTo(new gantt.$keyboardNavigation.TaskCell(gantt.getTaskByIndex(gantt.getVisibleTaskCount() - 1).id, this.columnIndex));\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\t\"pageup\": function () {\n\t\t\t\t\tif (gantt.getVisibleTaskCount()) {\n\t\t\t\t\t\tthis.moveTo(new gantt.$keyboardNavigation.TaskCell(gantt.getTaskByIndex(0).id, this.columnIndex));\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t);\n\n\n\tgantt.$keyboardNavigation.TaskCell.prototype.bindAll(gantt.$keyboardNavigation.TaskRow.prototype.keys);\n\tgantt.$keyboardNavigation.TaskCell.prototype.bindAll(gantt.$keyboardNavigation.TaskCell.prototype.keys);\n\n};","export default function(gantt) {\n\n\tgantt.$keyboardNavigation.dispatcher = {\n\t\tisActive: false,\n\t\tactiveNode: null,\n\t\tglobalNode: new gantt.$keyboardNavigation.GanttNode(),\n\n\t\tenable: function () {\n\t\t\tthis.isActive = true;\n\t\t\tthis.setActiveNode(this.getActiveNode());\n\t\t},\n\n\t\tdisable: function () {\n\t\t\tthis.isActive = false;\n\t\t},\n\n\t\tisEnabled: function () {\n\t\t\treturn !!this.isActive;\n\t\t},\n\n\t\tgetDefaultNode: function () {\n\t\t\tvar node;\n\t\t\tif (gantt.config.keyboard_navigation_cells) {\n\t\t\t\tnode = new gantt.$keyboardNavigation.TaskCell();\n\t\t\t} else {\n\t\t\t\tnode = new gantt.$keyboardNavigation.TaskRow();\n\t\t\t}\n\n\t\t\tif (!node.isValid()) {\n\t\t\t\tnode = node.fallback();\n\t\t\t}\n\t\t\treturn node;\n\t\t},\n\n\t\tsetDefaultNode: function () {\n\t\t\tthis.setActiveNode(this.getDefaultNode());\n\t\t},\n\n\t\tgetActiveNode: function () {\n\t\t\tvar node = this.activeNode;\n\t\t\tif (node && !node.isValid()) {\n\t\t\t\tnode = node.fallback();\n\t\t\t}\n\t\t\treturn node;\n\t\t},\n\n\t\tfromDomElement: function(e){\n\t\t\tvar inputs = [\n\t\t\t\tgantt.$keyboardNavigation.TaskRow,\n\t\t\t\tgantt.$keyboardNavigation.TaskCell,\n\t\t\t\tgantt.$keyboardNavigation.HeaderCell\n\t\t\t];\n\t\t\tfor(var i = 0; i < inputs.length; i++){\n\t\t\t\tif(inputs[i].prototype.fromDomElement){\n\t\t\t\t\tvar node = inputs[i].prototype.fromDomElement(e);\n\t\t\t\t\tif(node) return node;\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn null;\n\t\t},\n\n\t\tfocusGlobalNode: function () {\n\t\t\tthis.blurNode(this.globalNode);\n\t\t\tthis.focusNode(this.globalNode);\n\t\t},\n\n\t\tsetActiveNode: function (el) {\n\t\t\t//console.trace()\n\t\t\tvar focusChanged = true;\n\t\t\tif (this.activeNode) {\n\t\t\t\tif (this.activeNode.compareTo(el)) {\n\t\t\t\t\tfocusChanged = false;\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (this.isEnabled()) {\n\t\t\t\tif(focusChanged)\n\t\t\t\t\tthis.blurNode(this.activeNode);\n\n\t\t\t\tthis.activeNode = el;\n\t\t\t\tthis.focusNode(this.activeNode, !focusChanged);\n\t\t\t}\n\t\t},\n\n\t\tfocusNode: function (el, keptFocus) {\n\t\t\tif (el && el.focus) {\n\t\t\t\tel.focus(keptFocus);\n\t\t\t}\n\t\t},\n\t\tblurNode: function (el) {\n\t\t\tif (el && el.blur) {\n\t\t\t\tel.blur();\n\t\t\t}\n\t\t},\n\n\t\tkeyDownHandler: function (e) {\n\n\t\t\tif (gantt.$keyboardNavigation.isModal())\n\t\t\t\treturn;\n\n\t\t\tif (!this.isEnabled())\n\t\t\t\treturn;\n\n\t\t\tif(e.defaultPrevented){\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tvar ganttNode = this.globalNode;\n\n\t\t\tvar command = gantt.$keyboardNavigation.shortcuts.getCommandFromEvent(e);\n\n\t\t\tvar activeElement = this.getActiveNode();\n\t\t\tvar eventFacade = gantt.$keyboardNavigation.facade;\n\t\t\tif(eventFacade.callEvent(\"onKeyDown\", [command, e]) === false){\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (!activeElement) {\n\t\t\t\tthis.setDefaultNode();\n\t\t\t} else if (activeElement.findHandler(command)) {\n\t\t\t\tactiveElement.doAction(command, e);\n\t\t\t} else if (ganttNode.findHandler(command)) {\n\t\t\t\tganttNode.doAction(command, e);\n\t\t\t}\n\n\t\t},\n\t\t_timeout: null,\n\t\tawaitsFocus: function(){\n\t\t\treturn this._timeout !== null;\n\t\t},\n\t\tdelay: function(callback, delay){\n\n\t\t\tclearTimeout(this._timeout);\n\t\t\tthis._timeout = setTimeout(gantt.bind(function(){\n\t\t\t\tthis._timeout = null;\n\t\t\t\tcallback();\n\t\t\t}, this)  , delay || 1);\n\n\t\t},\n\t\tclearDelay: function(){\n\t\t\tclearTimeout(this._timeout);\n\t\t}\n\t};\n\n};","import { QuickInfo } from \"./quickInfo\";\n\nexport default function(gantt: any){\n\nif (!gantt.ext) {\n\tgantt.ext = {};\n}\ngantt.ext.quickInfo = new QuickInfo(gantt);\n\ngantt.config.quickinfo_buttons = [\"icon_edit\", \"icon_delete\"];\ngantt.config.quick_info_detached = true;\ngantt.config.show_quick_info = true;\n\ngantt.templates.quick_info_title = function(start, end, ev){ return ev.text.substr(0,50); };\ngantt.templates.quick_info_content = function(start, end, ev){ return ev.details || ev.text; };\ngantt.templates.quick_info_date = function(start, end, ev){\n\treturn gantt.templates.task_time(start, end, ev);\n};\ngantt.templates.quick_info_class = function(start, end, task){ return \"\"; };\n\ngantt.attachEvent(\"onTaskClick\", function(id,e){\n\t// GS-1460 Don't show Quick Info when clicking on the \"+\" button\n\tif (!gantt.utils.dom.closest(e.target, \".gantt_add\")){\n\t\tsetTimeout(function() {\n\t\t\tgantt.ext.quickInfo.show(id);\n\t\t}, 0);\n\t}\n\n\treturn true;\n});\n\nconst events = [\"onViewChange\", \"onLightbox\", \"onBeforeTaskDelete\", \"onBeforeDrag\"];\nconst hidingFunction = function(){\n\tgantt.ext.quickInfo.hide();\n\treturn true;\n};\nfor (let i=0; i<events.length; i++){\n\tgantt.attachEvent(events[i], hidingFunction);\n}\n// GS-957: We don't want to hide QuickInfo when we click on it.\ngantt.attachEvent(\"onEmptyClick\", function(e){\n\tlet hideQuickInfo = true;\n\tconst parent = document.querySelector(\".gantt_cal_quick_info\");\n\tif (parent){\n\t\tconst quickInfoClick = gantt.utils.dom.isChildOf(e.target, parent);\n\t\tif (quickInfoClick){\n\t\t\thideQuickInfo = false;\n\t\t}\n\t}\n\tif (hideQuickInfo){\n\t\thidingFunction();\n\t}\n});\nfunction clearQuickInfo() {\n\tgantt.ext.quickInfo.hide();\n\tgantt.ext.quickInfo._quickInfoBox = null;\n\treturn true;\n}\ngantt.attachEvent(\"onGanttReady\", clearQuickInfo);\ngantt.attachEvent(\"onDestroy\", clearQuickInfo);\n\n// eslint-disable-next-line no-restricted-globals\ngantt.event(window, \"keydown\", function(e){\n\tif (e.keyCode === 27){\n\t\tgantt.ext.quickInfo.hide();\n\t}\n});\n\ngantt.showQuickInfo = function(){\n\tgantt.ext.quickInfo.show.apply(gantt.ext.quickInfo, arguments);\n};\ngantt.hideQuickInfo = function(){\n\tgantt.ext.quickInfo.hide.apply(gantt.ext.quickInfo, arguments);\n};\n\n}","import {TooltipManager} from \"./tooltipManager\";\n\nexport default function(gantt: any){\n\ngantt.config.tooltip_timeout = 30;\ngantt.config.tooltip_offset_y = 20;\ngantt.config.tooltip_offset_x = 10;\ngantt.config.tooltip_hide_timeout = 30;\n\n\n\nconst tooltipManager = new TooltipManager(gantt);\n\ngantt.ext.tooltips = tooltipManager;\n\ngantt.attachEvent(\"onGanttReady\", function(){\n\t//GS-2230: in case if `getGanttInstance` created without container\n\tif(!gantt.$root) return;\n\ttooltipManager.tooltipFor({\n\t\tselector: \"[\"+gantt.config.task_attribute+\"]:not(.gantt_task_row)\",\n\t\thtml: (event: MouseEvent) => {\n\t\t\tif (gantt.config.touch && !gantt.config.touch_tooltip) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst targetTaskId = gantt.locate(event);\n\t\t\tif(gantt.isTaskExists(targetTaskId)){\n\t\t\t\tconst task = gantt.getTask(targetTaskId);\n\t\t\t\treturn gantt.templates.tooltip_text(task.start_date, task.end_date, task);\n\t\t\t}\n\t\t\treturn null;\n\t\t},\n\t\tglobal: false\n\t});\n});\n\ngantt.attachEvent(\"onDestroy\", function() {\n\ttooltipManager.destructor();\n});\n\ngantt.attachEvent(\"onLightbox\", function() {\n\ttooltipManager.hideTooltip();\n});\nconst isLinkCreate = () => {\n\tconst state = gantt.getState();\n\treturn !!state.link_source_id;\n};\ngantt.attachEvent(\"onBeforeTooltip\", function() {\n\tif (isLinkCreate()){\n\t\treturn false;\n\t}\n});\n\ngantt.attachEvent(\"onGanttScroll\", function(){\n\ttooltipManager.hideTooltip();\n});\n\n}","import { Monitor } from \"./monitor\";\nimport { IMonitor, IUndoCommand, TEntityType, TUndoStack } from \"./types\";\nimport { Undo } from \"./undo\";\n\nexport default function(gantt: any){\n\nconst _undo = new Undo(gantt);\nconst monitor: IMonitor = new Monitor(_undo, gantt);\n\ngantt.config.undo = true;\ngantt.config.redo = true;\n\n/**\n * entities that require different processing for undoing-redoing changes\n * @type {{link: string, task: string}}\n */\ngantt.config.undo_types = {\n\tlink: \"link\",\n\ttask: \"task\"\n};\n\n/**\n * types of traced actions\n * @type {{update: string, remove: string, add: string}}\n */\ngantt.config.undo_actions = {\n\tupdate: \"update\",\n\tremove: \"remove\", // remove item from datastore\n\tadd: \"add\",\n\tmove: \"move\" // move task in grid\n};\n\nif (!gantt.ext) {\n\tgantt.ext = {};\n}\n\ngantt.ext.undo = {\n\tundo: () => _undo.undo(),\n\tredo: () => _undo.redo(),\n\tgetUndoStack: () => _undo.getUndoStack(),\n\tsetUndoStack: (stack:[]) => _undo.setUndoStack(stack),\n\tgetRedoStack: () => _undo.getRedoStack(),\n\tsetRedoStack: (stack:[]) => _undo.setRedoStack(stack),\n\tclearUndoStack: () => _undo.clearUndoStack(),\n\tclearRedoStack: () => _undo.clearRedoStack(),\n\tsaveState: (id: TaskID | LinkID, type: TEntityType) => monitor.store(id, type, true),\n\tgetInitialState: (id: TaskID | LinkID, type: TEntityType) => {\n\t\tif(type === gantt.config.undo_types.link){\n\t\t\treturn monitor.getInitialLink(id);\n\t\t}else{\n\t\t\treturn monitor.getInitialTask(id);\n\t\t}\n\t}\n};\n\ngantt.undo = gantt.ext.undo.undo;\ngantt.redo = gantt.ext.undo.redo;\ngantt.getUndoStack = gantt.ext.undo.getUndoStack;\ngantt.getRedoStack = gantt.ext.undo.getRedoStack;\ngantt.clearUndoStack = gantt.ext.undo.clearUndoStack;\ngantt.clearRedoStack = gantt.ext.undo.clearRedoStack;\n\nfunction updTask(task: ITask, oldId: TaskID, newId: TaskID) {\n\tif (!task) { return; }\n\n\tif (task.id === oldId) {\n\t\ttask.id = newId;\n\t}\n\n\tif (task.parent === oldId) {\n\t\ttask.parent = newId;\n\t}\n}\n\nfunction changeTaskCommandId(command: IUndoCommand, oldId: TaskID, newId: TaskID) {\n\tupdTask(command.value, oldId, newId);\n\tupdTask(command.oldValue, oldId, newId);\n}\n\nfunction updLink(link: ILink, oldTaskId: TaskID, newTaskId: TaskID) {\n\tif (!link) { return; }\n\tif (link.source === oldTaskId) {\n\t\tlink.source = newTaskId;\n\t}\n\tif (link.target === oldTaskId) {\n\t\tlink.target = newTaskId;\n\t}\n}\n\nfunction changeLinkCommandId(command: IUndoCommand, oldId: LinkID, newId: LinkID) {\n\tupdLink(command.value, oldId, newId);\n\tupdLink(command.oldValue, oldId, newId);\n}\n\nfunction updateTasksIds(log: TUndoStack, oldId: TaskID, newId: TaskID) {\n\tconst undo = _undo;\n\n\tfor (let i = 0; i < log.length; i++) {\n\t\tconst entry = log[i];\n\t\tfor (let j = 0; j < entry.commands.length; j++) {\n\t\t\tif (entry.commands[j].entity === undo.command.entity.task) {\n\t\t\t\tchangeTaskCommandId(entry.commands[j], oldId, newId);\n\t\t\t} else if (entry.commands[j].entity === undo.command.entity.link) {\n\t\t\t\tchangeLinkCommandId(entry.commands[j], oldId, newId);\n\t\t\t}\n\t\t}\n\t}\n}\n\nfunction updateLinksIds(log: TUndoStack, oldId: LinkID, newId: LinkID) {\n\tconst undo = _undo;\n\n\tfor (let i = 0; i < log.length; i++) {\n\t\tconst entry = log[i];\n\t\tfor (let j = 0; j < entry.commands.length; j++) {\n\t\t\tconst command = entry.commands[j];\n\t\t\tif (command.entity === undo.command.entity.link) {\n\t\t\t\tif (command.value && command.value.id === oldId) {\n\t\t\t\t\tcommand.value.id = newId;\n\t\t\t\t}\n\t\t\t\tif (command.oldValue && command.oldValue.id === oldId) {\n\t\t\t\t\tcommand.oldValue.id = newId;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n}\n\ngantt.attachEvent(\"onTaskIdChange\", (oldId: TaskID, newId: TaskID) => {\n\tconst undo = _undo;\n\tupdateTasksIds(undo.getUndoStack(), oldId, newId);\n\tupdateTasksIds(undo.getRedoStack(), oldId, newId);\n});\n\ngantt.attachEvent(\"onLinkIdChange\", (oldId: LinkID, newId: LinkID) => {\n\tconst undo = _undo;\n\tupdateLinksIds(undo.getUndoStack(), oldId, newId);\n\tupdateLinksIds(undo.getRedoStack(), oldId, newId);\n});\n\ngantt.attachEvent(\"onGanttReady\", () => {\n\t_undo.updateConfigs();\n});\n\n}","\nexport default function(gantt){\n\nif(!gantt._markers) {\n\tgantt._markers = gantt.createDatastore({\n\t\tname: \"marker\",\n\t\tinitItem: function (marker) {\n\t\t\tmarker.id = marker.id || gantt.uid();\n\t\t\treturn marker;\n\t\t}\n\t});\n}\n\ngantt.config.show_markers = true;\n\nfunction render_marker(marker){\n\tif(!gantt.config.show_markers)\n\t\treturn false;\n\n\tif(!marker.start_date)\n\t\treturn false;\n\n\tvar state = gantt.getState();\n\tif(+marker.start_date > +state.max_date)\n\t\treturn;\n\tif((!marker.end_date || +marker.end_date < +state.min_date) && +marker.start_date < +state.min_date)\n\t\treturn;\n\n\tvar div = document.createElement(\"div\");\n\n\tdiv.setAttribute(\"data-marker-id\", marker.id);\n\n\tvar css = \"gantt_marker\";\n\tif(gantt.templates.marker_class)\n\t\tcss += \" \" + gantt.templates.marker_class(marker);\n\n\tif(marker.css){\n\t\tcss += \" \" + marker.css;\n\t}\n\n\tif(gantt.templates.marker_class)\n\t\tcss += \" \" + gantt.templates.marker_class(marker);\n\n\tif(marker.title){\n\t\tdiv.title = marker.title;\n\t}\n\tdiv.className = css;\n\n\tvar start = gantt.posFromDate(marker.start_date);\n\tdiv.style.left = start + \"px\";\n\tlet markerHeight = Math.max(gantt.getRowTop(gantt.getVisibleTaskCount()), 0) + \"px\";\n\tif (gantt.config.timeline_placeholder && gantt.$task_data){\n\t\tmarkerHeight = gantt.$task_data.scrollHeight + \"px\";\n\t}\n\tdiv.style.height = markerHeight;\n\tif(marker.end_date){\n\t\tvar end = gantt.posFromDate(marker.end_date);\n\t\tdiv.style.width = Math.max((end - start), 0) + \"px\";\n\n\t}\n\n\tif(marker.text){\n\t\tdiv.innerHTML = \"<div class='gantt_marker_content' >\" + marker.text + \"</div>\";\n\t}\n\n\treturn div;\n}\n\nfunction initMarkerArea(){\n\tif(!gantt.$task_data)\n\t\treturn;\n\n\tvar markerArea = document.createElement(\"div\");\n\tmarkerArea.className = \"gantt_marker_area\";\n\tgantt.$task_data.appendChild(markerArea);\n\tgantt.$marker_area = markerArea;\n}\n\ngantt.attachEvent(\"onBeforeGanttRender\", function(){\n\tif(!gantt.$marker_area)\n\t\tinitMarkerArea();\n});\n\ngantt.attachEvent(\"onDataRender\", function(){\n\tif(!gantt.$marker_area){\n\t\tinitMarkerArea();\n\t\tgantt.renderMarkers();\n\t}\n});\n\ngantt.attachEvent(\"onGanttLayoutReady\", function(){\n\t// GS-1304 - markers should attach when layout is initialized, both on gantt.init and gantt.resetLayout\n\t// wait for \"onBeforeGanttRender\", so all layout elements will be in DOM\n\tgantt.attachEvent(\"onBeforeGanttRender\", function(){\n\t\tinitMarkerArea();\n\n\t\tvar layers = gantt.$services.getService(\"layers\");\n\t\tvar markerRenderer = layers.createDataRender({\n\t\t\tname: \"marker\",\n\t\t\tdefaultContainer: function(){ return gantt.$marker_area;}\n\t\t});\n\t\tmarkerRenderer.addLayer(render_marker);\n\t}, {once: true});\n});\n\ngantt.getMarker = function(id){\n\tif(!this._markers) return null;\n\n\treturn this._markers.getItem(id);\n};\n\ngantt.addMarker = function(marker){\n\treturn this._markers.addItem(marker);\n};\n\ngantt.deleteMarker = function(id){\n\tif(!this._markers.exists(id))\n\t\treturn false;\n\n\tthis._markers.removeItem(id);\n\treturn true;\n};\ngantt.updateMarker = function(id){\n\tthis._markers.refresh(id);\n};\n\ngantt._getMarkers = function(){\n\treturn this._markers.getItems();\n};\n\ngantt.renderMarkers = function () {\n\tthis._markers.refresh();\n};\n\n};","import {replaceValidZeroId} from \"../utils/helpers\";\n\nexport default function(gantt){\n\ngantt.config.multiselect = true;\ngantt.config.multiselect_one_level = false;\n\ngantt._multiselect = {\n\t_selected: {},\n\t_one_level: false,\n\t_active: true,\n\t_first_selected_when_shift: null,\n\tgetDefaultSelected: function() {\n\t\tvar selected = this.getSelected();\n\t\treturn selected.length ? selected[selected.length - 1] : null;\n\t},\n\tsetFirstSelected: function(id) {\n\t\tthis._first_selected_when_shift = id;\n\t},\n\tgetFirstSelected: function() {\n\t\treturn this._first_selected_when_shift;\n\t},\n\tisActive: function() {\n\t\tthis.updateState();\n\t\treturn this._active;\n\t},\n\tupdateState: function() {\n\t\tthis._one_level = gantt.config.multiselect_one_level;\n\t\tvar active = this._active;\n\t\tthis._active = gantt.config.select_task;\n\t\tif (this._active != active) {\n\t\t\tthis.reset();\n\t\t}\n\t},\n\treset: function () {\n\t\tthis._selected = {};\n\t},\n\tsetLastSelected: function (id) {\n\t\tgantt.$data.tasksStore.silent(function(){\n\t\t\tvar store = gantt.$data.tasksStore;\n\t\t\tif (id)\n\t\t\t\tstore.select(id+\"\");\n\t\t\telse\n\t\t\t\tstore.unselect(null);\n\t\t});\n\t},\n\tgetLastSelected: function () {\n\t\tvar last = gantt.$data.tasksStore.getSelectedId();\n\t\tif (last && gantt.isTaskExists(last))\n\t\t\treturn last;\n\t\treturn null;\n\t},\n\tselect: function (id, e) {\n\t\tif (id && gantt.callEvent(\"onBeforeTaskMultiSelect\", [id, true, e]) && gantt.callEvent(\"onBeforeTaskSelected\", [id])) {\n\t\t\tthis._selected[id] = true;\n\t\t\tthis.setLastSelected(id);\n\t\t\tthis.afterSelect(id);\n\t\t\tgantt.callEvent(\"onTaskMultiSelect\", [id, true, e]);\n\t\t\tgantt.callEvent(\"onTaskSelected\", [id]);\n\t\t\treturn true;\n\t\t}\n\t\treturn false;\n\t},\n\ttoggle: function (id, e) {\n\t\tif (this._selected[id]) {\n\t\t\tthis.unselect(id, e);\n\t\t} else {\n\t\t\tthis.select(id, e);\n\t\t}\n\t},\n\tunselect: function (id, e) {\n\t\tif (id && gantt.callEvent(\"onBeforeTaskMultiSelect\", [id, false, e])) {\n\t\t\tthis._selected[id] = false;\n\t\t\tif (this.getLastSelected() == id)\n\t\t\t\tthis.setLastSelected(this.getDefaultSelected());\n\t\t\tthis.afterSelect(id);\n\t\t\tgantt.callEvent(\"onTaskMultiSelect\", [id, false, e]);\n\t\t\tgantt.callEvent(\"onTaskUnselected\", [id]);\n\t\t}\n\t},\n\tisSelected: function (id) {\n\t\treturn !!(gantt.isTaskExists(id) && this._selected[id]);\n\t},\n\tgetSelected: function () {\n\t\tvar res = [];\n\t\tfor (var i in this._selected) {\n\t\t\tif (this._selected[i] && gantt.isTaskExists(i)) {\n\t\t\t\tres.push(i);\n\t\t\t} else {\n\t\t\t\tthis._selected[i] = false;\n\t\t\t}\n\t\t}\n\t\tres.sort(function(a, b) {\n\t\t\treturn gantt.getGlobalTaskIndex(a) > gantt.getGlobalTaskIndex(b) ? 1 : -1;\n\t\t});\n\t\treturn res;\n\t},\n\tforSelected: function (callback) {\n\t\tvar selected = this.getSelected();\n\t\tfor (var i = 0; i < selected.length; i++) {\n\t\t\tcallback(selected[i]);\n\t\t}\n\t},\n\tisSameLevel: function(id) {\n\t\tif (!this._one_level)\n\t\t\treturn true;\n\t\tvar last = this.getLastSelected();\n\t\tif (!last)\n\t\t\treturn true;\n\t\tif (!(gantt.isTaskExists(last) && gantt.isTaskExists(id)))\n\t\t\treturn true;\n\t\treturn !!(gantt.calculateTaskLevel(gantt.getTask(last)) == gantt.calculateTaskLevel(gantt.getTask(id)));\n\t},\n\tafterSelect: function(id) {\n\t\tif (gantt.isTaskExists(id)){\n\t\t\t// FIXME: quick workaround to prevent re-filtering inside refresh on multiselect\n\t\t\tgantt._quickRefresh(function(){\n\t\t\t\tgantt.refreshTask(id);\n\t\t\t});\n\t\t}\n\t},\n\tdoSelection: function(e) {\n\t\tif (!this.isActive())\n\t\t\treturn false;\n\n\t\t// deny selection when click on 'expand' or 'collapse' icons\n\t\tif (gantt._is_icon_open_click(e))\n\t\t\treturn false;\n\n\t\tvar target_ev = gantt.locate(e);\n\t\tif (!target_ev)\n\t\t\treturn false;\n\n\t\tif (!gantt.callEvent(\"onBeforeMultiSelect\", [e]))\n\t\t\treturn false;\n\n\t\tvar selected = this.getSelected();\n\t\tvar defaultLast = this.getFirstSelected();\n\t\tvar isLast = false;\n\t\tvar last = this.getLastSelected();\n\t\tvar multiSelect = gantt.config.multiselect;\n\n\n\t\tvar singleSelection = (function () {\n\t\t\t// GS-719: If the multiselect extension is added we still need a way\n\t\t\t// to open the inline editors after clicking on the cells in the grid\n\t\t\tvar controller = gantt.ext.inlineEditors;\n\t\t\tvar state = controller.getState();\n\t\t\tvar cell = controller.locateCell(e.target);\n\n\t\t\tif (gantt.config.inline_editors_multiselect_open && cell && controller.getEditorConfig(cell.columnName)) {\n\t\t\t\tif (controller.isVisible() && state.id == cell.id && state.columnName == cell.columnName) {\n\t\t\t\t\t// do nothing if editor is already active in this cell\n\t\t\t\t} else {\n\t\t\t\t\tcontroller.startEdit(cell.id, cell.columnName);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tthis.setFirstSelected(target_ev);\n\n\t\t\tif (!this.isSelected(target_ev)) {\n\t\t\t\tthis.select(target_ev, e);\n\t\t\t}\n\t\t\tselected = this.getSelected();\n\t\t\tfor (var i = 0; i < selected.length; i++) {\n\t\t\t\tif (selected[i] !== target_ev) {\n\t\t\t\t\tthis.unselect(selected[i], e);\n\t\t\t\t}\n\t\t\t}\n\t\t}).bind(this);\n\n\t\tvar blockSelection = (function(){\n\t\t\tif (!last)\n\t\t\t\tlast = target_ev;\n\t\t\telse if (target_ev) {\n\t\t\t\tvar first_indx = gantt.getGlobalTaskIndex(this.getFirstSelected());\n\t\t\t\tvar target_indx = gantt.getGlobalTaskIndex(target_ev);\n\t\t\t\tvar last_indx = gantt.getGlobalTaskIndex(last);\n\t\t\t\t// GS-1969: if the selected tasks are collapsed, need to remove them\n\t\t\t\tif(first_indx == -1 || last_indx == -1){\n\t\t\t\t\tfirst_indx = target_indx;\n\t\t\t\t\tthis.reset();\n\t\t\t\t}\n\t\t\t\t// clear prev selection\n\t\t\t\tvar tmp = last;\n\t\t\t\twhile (gantt.getGlobalTaskIndex(tmp) !== first_indx) {\n\t\t\t\t\tthis.unselect(tmp, e);\n\t\t\t\t\ttmp = (first_indx > last_indx) ? gantt.getNext(tmp) : gantt.getPrev(tmp);\n\t\t\t\t}\n\t\t\t\ttmp = target_ev;\n\t\t\t\twhile (gantt.getGlobalTaskIndex(tmp) !== first_indx) {\n\t\t\t\t\tif (this.select(tmp, e) && !isLast) {\n\t\t\t\t\t\tisLast = true;\n\t\t\t\t\t\tdefaultLast = tmp;\n\t\t\t\t\t}\n\t\t\t\t\ttmp = (first_indx > target_indx) ? gantt.getNext(tmp) : gantt.getPrev(tmp);\n\t\t\t\t}\n\t\t\t}\n\t\t}).bind(this);\n\n\n\t\tif (multiSelect && (e.ctrlKey || e.metaKey)) {\n\t\t\tif (!this.isSelected(target_ev))\n\t\t\t\tthis.setFirstSelected(target_ev);\n\n\t\t\tif (target_ev) {\n\t\t\t\tthis.toggle(target_ev, e);\n\t\t\t}\n\t\t}\n\n\t\telse if (multiSelect && e.shiftKey) {\n\t\t\tif (!gantt.isTaskExists(this.getFirstSelected()) || this.getFirstSelected() === null) {\n\t\t\t\tthis.setFirstSelected(target_ev);\n\t\t\t}\n\n\t\t\tif (selected.length) { // select a group of tasks\n\t\t\t\tblockSelection();\n\t\t\t}\n\t\t\telse { // select a task when no task is selected and Shift is pressed\n\t\t\t\tsingleSelection();\n\t\t\t}\n\t\t}\n\t\t\n\t\telse { // no key press or no multiple selection on the mouse click\n\t\t\tsingleSelection();\n\t\t}\n\n\n\t\tif (this.isSelected(target_ev)) {\n\t\t\tthis.setLastSelected(target_ev);\n\t\t} else if (defaultLast) {\n\t\t\tif (target_ev == last)\n\t\t\t\tthis.setLastSelected(e.shiftKey ? defaultLast : this.getDefaultSelected());\n\t\t} else {\n\t\t\tthis.setLastSelected(null);\n\t\t}\n\n\t\tif (!this.getSelected().length)\n\t\t\tthis.setLastSelected(null);\n\n\t\tif (!this.getLastSelected() || !this.isSelected(this.getFirstSelected()))\n\t\t\tthis.setFirstSelected(this.getLastSelected());\n\n\t\treturn true;\n\t}\n};\n\n(function(){\n\tvar old_selectTask = gantt.selectTask;\n\tgantt.selectTask = function(id) {\n\t\tid = replaceValidZeroId(id, this.config.root_id);\n\t\tif (!id)\n\t\t\treturn false;\n\t\tvar multiselect = gantt._multiselect;\n\t\tvar res = id;\n\t\tif (multiselect.isActive()) {\n\t\t\tif (multiselect.select(id, null)) {\n\t\t\t\tmultiselect.setLastSelected(id);\n\t\t\t}\n\t\t\tmultiselect.setFirstSelected(multiselect.getLastSelected());\n\t\t} else {\n\t\t\tres = old_selectTask.call(this, id);\n\t\t}\n\t\treturn res;\n\t};\n\n\tvar old_unselectTask = gantt.unselectTask;\n\tgantt.unselectTask = function(id) {\n\t\tvar multiselect = gantt._multiselect;\n\t\tvar isActive = multiselect.isActive();\n\t\tid = id || multiselect.getLastSelected();\n\t\tif(id && isActive) {\n\t\t\tmultiselect.unselect(id, null);\n\t\t\tif (id == multiselect.getLastSelected())\n\t\t\t\tmultiselect.setLastSelected(null);\n\t\t\tgantt.refreshTask(id);\n\t\t\tmultiselect.setFirstSelected(multiselect.getLastSelected());\n\t\t}\n\t\tvar res = id;\n\t\tif (!isActive)\n\t\t\tres = old_unselectTask.call(this, id);\n\t\treturn res;\n\t};\n\n\tgantt.toggleTaskSelection = function(id) {\n\t\tvar multiselect = gantt._multiselect;\n\t\tif (id && multiselect.isActive()) {\n\t\t\tmultiselect.toggle(id);\n\t\t\tmultiselect.setFirstSelected(multiselect.getLastSelected());\n\t\t}\n\t};\n\tgantt.getSelectedTasks = function() {\n\t\tvar multiselect = gantt._multiselect;\n\t\tmultiselect.isActive();\n\t\treturn multiselect.getSelected();\n\t};\n\tgantt.eachSelectedTask = function(callback){\n\t\treturn this._multiselect.forSelected(callback);\n\t};\n\tgantt.isSelectedTask = function(id){\n\t\treturn this._multiselect.isSelected(id);\n\t};\n\tgantt.getLastSelectedTask = function(){\n\t\treturn this._multiselect.getLastSelected();\n\t};\n\tgantt.attachEvent(\"onGanttReady\", function(){\n\t\tvar old_isSelected = gantt.$data.tasksStore.isSelected;\n\t\tgantt.$data.tasksStore.isSelected = function(id){\n\t\t\tif (gantt._multiselect.isActive()) {\n\t\t\t\treturn gantt._multiselect.isSelected(id);\n\t\t\t}\n\t\t\treturn old_isSelected.call(this, id);\n\t\t};\n\t});\n})();\n\ngantt.attachEvent(\"onTaskIdChange\", function (id, new_id) {\n\tvar multiselect = gantt._multiselect;\n\tif (!multiselect.isActive())\n\t\treturn true;\n\tif (gantt.isSelectedTask(id)) {\n\t\tmultiselect.unselect(id, null);\n\t\tmultiselect.select(new_id, null);\n\t}\n});\n\ngantt.attachEvent(\"onAfterTaskDelete\", function (id, item) {\n\tvar multiselect = gantt._multiselect;\n\tif (!multiselect.isActive())\n\t\treturn true;\n\n\tif (multiselect._selected[id]) {\n\t\t// GS-1057: don't unselect the task here because the task is already unselected \n\t\t// it was in the select.js file before it was deleted\n\t\t// multiselect.unselect(id, null);\n\t\tmultiselect._selected[id] = false;\n\t\tmultiselect.setLastSelected(multiselect.getDefaultSelected());\n\t}\n\n\tmultiselect.forSelected(function (task_id) {\n\t\tif (!gantt.isTaskExists(task_id))\n\t\t\tmultiselect.unselect(task_id, null);\n\t});\n});\n\ngantt.attachEvent(\"onBeforeTaskMultiSelect\", function(id, state, e){\n\tconst multiselect = gantt._multiselect;\n\tif (state && multiselect.isActive()) {\n\t\t//GS-1321: prevent unselecting task\n\t\tlet oldSelectedId = gantt.getSelectedId();\n\t\tlet oldSelectedTask = null;\n\t\tif (oldSelectedId) {\n\t\t\toldSelectedTask = gantt.getTask(oldSelectedId);\n\t\t}\n\t\tlet newSelectedTask = gantt.getTask(id);\n\t\tlet differentTreeLevel = false;\n\t\tif (oldSelectedTask && oldSelectedTask.$level != newSelectedTask.$level){\n\t\t\tdifferentTreeLevel = true;\n\t\t}\n\n\t\tif (gantt.config.multiselect_one_level && differentTreeLevel && !e.ctrlKey && !e.shiftKey) {\n\t\t\treturn true;\n\t\t}\n\t\tif (multiselect._one_level) {\n\t\t\treturn multiselect.isSameLevel(id);\n\t\t}\n\t}\n\treturn true;\n});\n\ngantt.attachEvent(\"onTaskClick\", function(id, e) {\n\tif (gantt._multiselect.doSelection(e))\n\t\tgantt.callEvent(\"onMultiSelect\", [e]);\n\treturn true;\n});\n\n};","/* eslint-disable */\n\nexport default function(gantt: any) {\n\n\tgantt.ext = gantt.ext || {};\n\n\tgantt.ext.export_api = gantt.ext.export_api || {\n\n\t\t_apiUrl: \"https://export.dhtmlx.com/gantt\",\n\n\t\t_preparePDFConfigRaw(config, type){\n\t\t\tlet previousDateRage:any = null;\n\t\t\tif (config.start && config.end){\n\t\t\t\tpreviousDateRage = {\n\t\t\t\t\tstart_date: gantt.config.start_date,\n\t\t\t\t\tend_date: gantt.config.end_date,\n\t\t\t\t};\n\t\t\t\tgantt.config.start_date = gantt.date.str_to_date(gantt.config.date_format)(config.start);\n\t\t\t\tgantt.config.end_date = gantt.date.str_to_date(gantt.config.date_format)(config.end);\n\t\t\t}\n\n\t\t\tconfig = gantt.mixin(config, {\n\t\t\t\tname: \"gantt.\" + type, data: gantt.ext.export_api._serializeHtml()\n\t\t\t});\n\n\t\t\tif (previousDateRage){\n\t\t\t\tgantt.config.start_date = previousDateRage.start_date;\n\t\t\t\tgantt.config.end_date = previousDateRage.end_date;\n\t\t\t}\n\t\t},\n\n\t\t_prepareConfigPDF(config, type){\n\t\t\tconfig = gantt.mixin((config || {}), {\n\t\t\t\tname: \"gantt.\" + type,\n\t\t\t\tdata: gantt.ext.export_api._serializeAll(),\n\t\t\t\tconfig: gantt.config\n\t\t\t});\n\t\t\tgantt.ext.export_api._fixColumns(config.config.columns);\n\t\t\treturn config;\n\t\t},\n\n\t\t_pdfExportRouter(config, type){\n\t\t\tif (config && config.raw) {\n\t\t\t\tgantt.ext.export_api._preparePDFConfigRaw(config, type);\n\t\t\t} else {\n\t\t\t\tconfig = gantt.ext.export_api._prepareConfigPDF(config, type);\n\t\t\t}\n\t\t\tconfig.version = gantt.version;\n\t\t\tgantt.ext.export_api._sendToExport(config, type);\n\t\t},\n\n\t\texportToPDF(config) {\n\t\t\tgantt.ext.export_api._pdfExportRouter(config, \"pdf\");\n\t\t},\n\n\t\texportToPNG(config) {\n\t\t\tgantt.ext.export_api._pdfExportRouter(config, \"png\");\n\t\t},\n\n\n\t\texportToICal(config) {\n\t\t\tconfig = gantt.mixin((config || {}), {\n\t\t\t\tname: \"gantt.ical\",\n\t\t\t\tdata: gantt.ext.export_api._serializePlain().data,\n\t\t\t\tversion: gantt.version\n\t\t\t});\n\t\t\tgantt.ext.export_api._sendToExport(config, \"ical\");\n\t\t},\n\n\t\texportToExcel(config) {\n\t\t\tconfig = config || {};\n\n\t\t\tlet tasks;\n\t\t\tlet dates;\n\t\t\tlet state;\n\t\t\tlet scroll;\n\t\t\t// GS-2124, we need to get all task nodes to correctly obtain the colors\n\t\t\tconst smartRendering = gantt.config.smart_rendering;\n\t\t\tif (config.visual === \"base-colors\"){\n\t\t\t\tgantt.config.smart_rendering = false;\n\t\t\t}\n\n\t\t\tif (config.start || config.end) {\n\t\t\t\tstate = gantt.getState();\n\t\t\t\tdates = [gantt.config.start_date, gantt.config.end_date];\n\t\t\t\tscroll = gantt.getScrollState();\n\t\t\t\tconst convert = gantt.date.str_to_date(gantt.config.date_format);\n\t\t\t\ttasks = gantt.eachTask;\n\n\t\t\t\tif (config.start){\n\t\t\t\t\tgantt.config.start_date = convert(config.start);\n\t\t\t\t}\n\t\t\t\tif (config.end){\n\t\t\t\t\tgantt.config.end_date = convert(config.end);\n\t\t\t\t}\n\n\t\t\t\tgantt.render();\n\t\t\t\tgantt.config.smart_rendering = smartRendering;\n\n\t\t\t\tgantt.eachTask = gantt.ext.export_api._eachTaskTimed(gantt.config.start_date, gantt.config.end_date);\n\t\t\t} else if (config.visual === \"base-colors\"){\n\t\t\t\tgantt.render();\n\t\t\t\tgantt.config.smart_rendering = smartRendering;\n\t\t\t}\n\n\t\t\tgantt._no_progress_colors = config.visual === \"base-colors\";\n\n\t\t\tconfig = gantt.mixin(config, {\n\t\t\t\tname: \"gantt.xlsx\",\n\t\t\t\ttitle: \"Tasks\",\n\t\t\t\tdata: gantt.ext.export_api._serializeTimeline(config).data,\n\t\t\t\tcolumns: gantt.ext.export_api._serializeGrid({ rawDates: true }),\n\t\t\t\tversion: gantt.version\n\t\t\t});\n\n\t\t\tif (config.visual){\n\t\t\t\tconfig.scales = gantt.ext.export_api._serializeScales(config);\n\t\t\t}\n\n\t\t\tgantt.ext.export_api._sendToExport(config, \"excel\");\n\n\t\t\tif (config.start || config.end) {\n\t\t\t\tgantt.config.start_date = state.min_date;\n\t\t\t\tgantt.config.end_date = state.max_date;\n\t\t\t\tgantt.eachTask = tasks;\n\n\t\t\t\tgantt.render();\n\t\t\t\tgantt.scrollTo(scroll.x, scroll.y);\n\n\t\t\t\tgantt.config.start_date = dates[0];\n\t\t\t\tgantt.config.end_date = dates[1];\n\t\t\t}\n\t\t},\n\n\t\texportToJSON(config) {\n\t\t\tconfig = gantt.mixin((config || {}), {\n\t\t\t\tname: \"gantt.json\",\n\t\t\t\tdata: gantt.ext.export_api._serializeAll(),\n\t\t\t\tconfig: gantt.config,\n\t\t\t\tcolumns: gantt.ext.export_api._serializeGrid(),\n\t\t\t\tworktime: gantt.ext.export_api._getWorktimeSettings(),\n\t\t\t\tversion: gantt.version\n\t\t\t});\n\t\t\tgantt.ext.export_api._sendToExport(config, \"json\");\n\t\t},\n\n\n\t\timportFromExcel(config) {\n\t\t\ttry {\n\t\t\t\tconst formData = config.data;\n\t\t\t\tif (formData instanceof File) {\n\t\t\t\t\tconst data = new FormData();\n\t\t\t\t\tdata.append(\"file\", formData);\n\t\t\t\t\tconfig.data = data;\n\t\t\t\t}\n\t\t\t} catch (error) {}\n\t\t\tgantt.ext.export_api._sendImportAjaxExcel(config);\n\t\t},\n\n\t\timportFromMSProject(config) {\n\t\t\tconst formData = config.data;\n\t\t\ttry {\n\t\t\t\tif (formData  instanceof File) {\n\t\t\t\t\tconst data = new FormData();\n\t\t\t\t\tdata.append(\"file\", formData);\n\t\t\t\t\tconfig.data = data;\n\t\t\t\t}\n\t\t\t} catch (error) {}\n\t\t\tgantt.ext.export_api._sendImportAjaxMSP(config);\n\t\t},\n\n\t\timportFromPrimaveraP6(config) {\n\t\t\tconfig.type = \"primaveraP6-parse\";\n\t\t\treturn gantt.importFromMSProject(config);\n\t\t},\n\n\t\texportToMSProject(config) {\n\t\t\tconfig = config || {};\n\t\t\tconfig.skip_circular_links = config.skip_circular_links === undefined ? true : !!config.skip_circular_links;\n\n\t\t\tconst oldXmlFormat = gantt.templates.xml_format;\n\t\t\tconst oldFormatDate = gantt.templates.format_date;\n\t\t\tconst oldXmlDate = gantt.config.xml_date;\n\t\t\tconst oldDateFormat = gantt.config.date_format;\n\n\t\t\tconst exportServiceDateFormat = \"%d-%m-%Y %H:%i:%s\";\n\n\t\t\tgantt.config.xml_date = exportServiceDateFormat;\n\t\t\tgantt.config.date_format = exportServiceDateFormat;\n\t\t\tgantt.templates.xml_format = gantt.date.date_to_str(exportServiceDateFormat);\n\t\t\tgantt.templates.format_date = gantt.date.date_to_str(exportServiceDateFormat);\n\t\t\tconst data = gantt.ext.export_api._serializeAll();\n\n\t\t\tgantt.ext.export_api._customProjectProperties(data, config);\n\n\t\t\tgantt.ext.export_api._customTaskProperties(data, config);\n\n\t\t\tif (config.skip_circular_links) {\n\t\t\t\tgantt.ext.export_api._clearRecLinks(data);\n\t\t\t}\n\n\t\t\tconfig = gantt.ext.export_api._exportConfig(data, config);\n\n\t\t\tgantt.ext.export_api._sendToExport(config, config.type || \"msproject\");\n\t\t\tgantt.config.xml_date = oldXmlDate;\n\t\t\tgantt.config.date_format = oldDateFormat;\n\t\t\tgantt.templates.xml_format = oldXmlFormat;\n\t\t\tgantt.templates.format_date = oldFormatDate;\n\n\t\t\tgantt.config.$custom_data = null;\n\t\t\tgantt.config.custom = null;\n\t\t},\n\n\t\texportToPrimaveraP6(config) {\n\t\t\tconfig = config || {};\n\t\t\tconfig.type = \"primaveraP6\";\n\t\t\treturn gantt.exportToMSProject(config);\n\t\t},\n\n\t\t_fixColumns(columns) {\n\t\t\tfor (let i = 0; i < columns.length; i++) {\n\t\t\t\tcolumns[i].label = columns[i].label || gantt.locale.labels[\"column_\" + columns[i].name];\n\t\t\t\tif (typeof columns[i].width === \"string\") {\n\t\t\t\t\tcolumns[i].width = columns[i].width * 1;\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\n\t\t_xdr(url, pack, cb) {\n\t\t\tgantt.ajax.post(url, pack, cb);\n\t\t},\n\n\t\t_markColumns(base) {\n\t\t\tconst columns = base.config.columns;\n\t\t\tif (columns){\n\t\t\t\tfor (let i = 0; i < columns.length; i++) {\n\t\t\t\t\tif (columns[i].template){\n\t\t\t\t\t\tcolumns[i].$template = true;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\n\n\t\t_sendImportAjaxExcel(config) {\n\t\t\tconst url = config.server || gantt.ext.export_api._apiUrl;\n\t\t\tconst store = config.store || 0;\n\t\t\tconst formData = config.data;\n\t\t\tconst callback = config.callback;\n\n\t\t\tformData.append(\"type\", \"excel-parse\");\n\t\t\tformData.append(\"data\", JSON.stringify({\n\t\t\t\tsheet: config.sheet || 0\n\t\t\t}));\n\n\t\t\tif (store){\n\t\t\t\tformData.append(\"store\", store);\n\t\t\t}\n\n\t\t\tconst xhr = new XMLHttpRequest();\n\t\t\txhr.onreadystatechange = function(e) {\n\t\t\t\tif (xhr.readyState === 4 && xhr.status === 0) {// network error\n\t\t\t\t\tif (callback) {\n\t\t\t\t\t\tcallback(null);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t};\n\n\t\t\txhr.onload = function() {\n\t\t\t\tconst fail = xhr.status > 400;\n\t\t\t\tlet info = null;\n\n\t\t\t\tif (!fail) {\n\t\t\t\t\ttry {\n\t\t\t\t\t\tinfo = JSON.parse(xhr.responseText);\n\t\t\t\t\t} catch (e) { }\n\t\t\t\t}\n\n\t\t\t\tif (callback) {\n\t\t\t\t\tcallback(info);\n\t\t\t\t}\n\t\t\t};\n\n\t\t\txhr.open(\"POST\", url, true);\n\t\t\txhr.setRequestHeader(\"X-Requested-With\", \"XMLHttpRequest\");\n\t\t\txhr.send(formData);\n\t\t},\n\n\n\t\t_ajaxToExport(data, type, callback) {\n\t\t\tdelete data.callback;\n\n\t\t\tconst url = data.server || gantt.ext.export_api._apiUrl;\n\t\t\tconst pack = \"type=\" + type + \"&store=1&data=\" + encodeURIComponent(JSON.stringify(data));\n\n\t\t\tconst cb = function(loader) {\n\t\t\t\tconst xdoc = loader.xmlDoc || loader;\n\t\t\t\tconst fail = xdoc.status > 400;\n\t\t\t\tlet info = null;\n\n\t\t\t\tif (!fail) {\n\t\t\t\t\ttry {\n\t\t\t\t\t\tinfo = JSON.parse(xdoc.responseText);\n\t\t\t\t\t} catch (e) { }\n\t\t\t\t}\n\t\t\t\tcallback(info);\n\t\t\t};\n\n\t\t\tgantt.ext.export_api._xdr(url, pack, cb);\n\t\t},\n\t\t_serializableGanttConfig(config) {\n\t\t\tconst result = gantt.mixin({}, config);\n\n\t\t\tif (result.columns) {\n\t\t\t\tresult.columns = result.columns.map(function(col) {\n\t\t\t\t\tconst copy = gantt.mixin({}, col);\n\t\t\t\t\tdelete copy.editor;\n\t\t\t\t\treturn copy;\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tdelete result.editor_types;\n\t\t\treturn result;\n\t\t},\n\n\t\t_sendToExport(data, type) {\n\t\t\tconst convert = gantt.date.date_to_str(gantt.config.date_format || gantt.config.xml_date);\n\t\t\tif(!data.skin){\n\t\t\t\tdata.skin = gantt.skin;\n\t\t\t}\n\t\t\tif (data.config) {\n\t\t\t\tdata.config = gantt.copy(gantt.ext.export_api._serializableGanttConfig(data.config));\n\t\t\t\tgantt.ext.export_api._markColumns(data, type);\n\n\t\t\t\tif (data.config.start_date && data.config.end_date) {\n\t\t\t\t\tif (data.config.start_date instanceof Date) {\n\t\t\t\t\t\tdata.config.start_date = convert(data.config.start_date);\n\t\t\t\t\t}\n\t\t\t\t\tif (data.config.end_date instanceof Date) {\n\t\t\t\t\t\tdata.config.end_date = convert(data.config.end_date);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (data.callback) {\n\t\t\t\treturn gantt.ext.export_api._ajaxToExport(data, type, data.callback);\n\t\t\t}\n\n\t\t\tconst form = gantt.ext.export_api._createHiddenForm();\n\t\t\tform.firstChild.action = data.server || gantt.ext.export_api._apiUrl;\n\t\t\tform.firstChild.childNodes[0].value = JSON.stringify(data);\n\t\t\tform.firstChild.childNodes[1].value = type;\n\t\t\tform.firstChild.submit();\n\t\t},\n\n\t\t_createHiddenForm() {\n\t\t\tif (!gantt.ext.export_api._hidden_export_form) {\n\t\t\t\tconst t = gantt.ext.export_api._hidden_export_form = document.createElement(\"div\");\n\t\t\t\tt.style.display = \"none\";\n\t\t\t\tt.innerHTML = \"<form method='POST' target='_blank'><textarea name='data' style='width:0px; height:0px;' readonly='true'></textarea><input type='hidden' name='type' value=''></form>\";\n\t\t\t\tdocument.body.appendChild(t);\n\t\t\t}\n\t\t\treturn gantt.ext.export_api._hidden_export_form;\n\t\t},\n\n\n\t\t_copyObjectBase(obj) {\n\t\t\tconst copy = {\n\t\t\t\tstart_date: undefined,\n\t\t\t\tend_date: undefined,\n\t\t\t\tconstraint_date: undefined,\n\t\t\t\tdeadline: undefined\n\t\t\t};\n\t\t\tfor (const key in obj) {\n\t\t\t\tif (key.charAt(0) === \"$\" || key === \"baselines\"){\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\t\t\t\tcopy[key] = obj[key];\n\t\t\t}\n\t\t\tconst formatDate = gantt.templates.xml_format || gantt.templates.format_date;\n\n\t\t\tcopy.start_date = formatDate(copy.start_date);\n\t\t\tif (copy.end_date){\n\t\t\t\tcopy.end_date = formatDate(copy.end_date);\n\t\t\t}\n\t\t\tif (copy.constraint_date){\n\t\t\t\tcopy.constraint_date = formatDate(copy.constraint_date);\n\t\t\t}\n\t\t\tif (copy.deadline){\n\t\t\t\tcopy.deadline = formatDate(copy.deadline);\n\t\t\t}\n\n\t\t\treturn copy;\n\t\t},\n\n\n\t\t_color_box: null,\n\t\t_color_hash: {},\n\n\t\t_getStyles(css) {\n\t\t\tif (!gantt.ext.export_api._color_box) {\n\t\t\t\tgantt.ext.export_api._color_box = document.createElement(\"DIV\");\n\t\t\t\tgantt.ext.export_api._color_box.style.cssText = \"position:absolute; display:none;\";\n\t\t\t\tdocument.body.appendChild(gantt.ext.export_api._color_box);\n\t\t\t}\n\t\t\tif (gantt.ext.export_api._color_hash[css]){\n\t\t\t\treturn gantt.ext.export_api._color_hash[css];\n\t\t\t}\n\n\t\t\tgantt.ext.export_api._color_box.className = css;\n\t\t\tconst color = gantt.ext.export_api._getColor(gantt.ext.export_api._color_box, \"color\");\n\t\t\tconst backgroundColor = gantt.ext.export_api._getColor(gantt.ext.export_api._color_box, \"backgroundColor\");\n\t\t\treturn (gantt.ext.export_api._color_hash[css] = color + \";\" + backgroundColor);\n\t\t},\n\n\n\t\t_getMinutesWorktimeSettings(parsedRanges) {\n\t\t\tconst minutes:any = [];\n\t\t\tparsedRanges.forEach(function(range) {\n\t\t\t\tminutes.push(range.startMinute);\n\t\t\t\tminutes.push(range.endMinute);\n\t\t\t});\n\t\t\treturn minutes;\n\t\t},\n\n\t\t_getWorktimeSettings() {\n\n\t\t\tconst defaultWorkTimes = {\n\t\t\t\thours: [0, 24],\n\t\t\t\tminutes: null,\n\t\t\t\tdates: { 0: true, 1: true, 2: true, 3: true, 4: true, 5: true, 6: true }\n\t\t\t};\n\n\t\t\tlet time;\n\t\t\tif (!gantt.config.work_time) {\n\t\t\t\ttime = defaultWorkTimes;\n\t\t\t} else {\n\t\t\t\tconst wTime = gantt._working_time_helper;\n\t\t\t\tif (wTime && wTime.get_calendar) {\n\t\t\t\t\ttime = wTime.get_calendar();\n\t\t\t\t} else if (wTime) {\n\t\t\t\t\ttime = {\n\t\t\t\t\t\thours: wTime.hours,\n\t\t\t\t\t\tminutes: null,\n\t\t\t\t\t\tdates: wTime.dates\n\t\t\t\t\t};\n\t\t\t\t} else if (gantt.config.worktimes && gantt.config.worktimes.global) {\n\t\t\t\t\tconst settings = gantt.config.worktimes.global;\n\n\t\t\t\t\tif (settings.parsed) {\n\t\t\t\t\t\tconst minutes = gantt.ext.export_api._getMinutesWorktimeSettings(settings.parsed.hours);\n\t\t\t\t\t\ttime = {\n\t\t\t\t\t\t\thours: null,\n\t\t\t\t\t\t\tminutes,\n\t\t\t\t\t\t\tdates: {}\n\t\t\t\t\t\t};\n\t\t\t\t\t\tfor (const i in settings.parsed.dates) {\n\t\t\t\t\t\t\tif (Array.isArray(settings.parsed.dates[i])) {\n\t\t\t\t\t\t\t\ttime.dates[i] = gantt.ext.export_api._getMinutesWorktimeSettings(settings.parsed.dates[i]);\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\ttime.dates[i] = settings.parsed.dates[i];\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\t\t\ttime = {\n\t\t\t\t\t\t\thours: settings.hours,\n\t\t\t\t\t\t\tminutes: null,\n\t\t\t\t\t\t\tdates: settings.dates\n\t\t\t\t\t\t};\n\t\t\t\t\t}\n\n\t\t\t\t} else {\n\t\t\t\t\ttime = defaultWorkTimes;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn time;\n\t\t},\n\n\n\t\t_eachTaskTimed(start, end) {\n\t\t\treturn function(code, parent, master) {\n\t\t\t\tparent = parent || gantt.config.root_id;\n\t\t\t\tmaster = master || gantt;\n\n\t\t\t\tconst branch = gantt.getChildren(parent);\n\t\t\t\tif (branch){\n\t\t\t\t\tfor (let i = 0; i < branch.length; i++) {\n\t\t\t\t\t\tconst item = gantt._pull[branch[i]];\n\t\t\t\t\t\tif ((!start || item.end_date > start) && (!end || item.start_date < end)){\n\t\t\t\t\t\t\tcode.call(master, item);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (gantt.hasChild(item.id)){\n\t\t\t\t\t\t\tgantt.eachTask(code, item.id, master);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t};\n\t\t},\n\n\n\t\t// patch broken json serialization in gantt 2.1\n\t\t_originalCopyObject: gantt.json._copyObject,\n\n\n\t\t_copyObjectPlain(obj) {\n\t\t\tconst text = gantt.templates.task_text(obj.start_date, obj.end_date, obj);\n\n\t\t\tconst copy = gantt.ext.export_api._copyObjectBase(obj);\n\t\t\tcopy.text = text || copy.text;\n\n\t\t\treturn copy;\n\t\t},\n\n\t\t_getColor(node, style) {\n\t\t\tconst value = node.currentStyle ? node.currentStyle[style] : getComputedStyle(node, null)[style];\n\t\t\tconst rgb = value.replace(/\\s/g, \"\").match(/^rgba?\\((\\d+),(\\d+),(\\d+)/i);\n\t\t\treturn ((rgb && rgb.length === 4) ?\n\t\t\t\t(\"0\" + parseInt(rgb[1], 10).toString(16)).slice(-2) +\n\t\t\t\t(\"0\" + parseInt(rgb[2], 10).toString(16)).slice(-2) +\n\t\t\t\t(\"0\" + parseInt(rgb[3], 10).toString(16)).slice(-2) : value).replace(\"#\", \"\");\n\t\t},\n\n\n\t\t// excel serialization\n\t\t_copyObjectTable(obj) {\n\t\t\t// Excel interprets UTC time as local time in every timezone, send local time instead of actual UTC time.\n\t\t\t// https://github.com/SheetJS/js-xlsx/issues/126#issuecomment-60531614\n\t\t\tconst toISOstring = gantt.date.date_to_str(\"%Y-%m-%dT%H:%i:%s.000Z\");\n\n\t\t\tconst copy = gantt.ext.export_api._copyObjectColumns(obj, gantt.ext.export_api._copyObjectPlain(obj));\n\t\t\tif (copy.start_date){\n\t\t\t\tcopy.start_date = toISOstring(obj.start_date);\n\t\t\t}\n\t\t\tif (copy.end_date){\n\t\t\t\tcopy.end_date = toISOstring(obj.end_date);\n\t\t\t}\n\n\t\t\t// private gantt._day_index_by_date was replaced by public gantt.columnIndexByDate in gantt 5.0\n\t\t\tconst getDayIndex = gantt._day_index_by_date ? gantt._day_index_by_date : gantt.columnIndexByDate;\n\n\t\t\tcopy.$start = getDayIndex.call(gantt, obj.start_date);\n\t\t\tcopy.$end = getDayIndex.call(gantt, obj.end_date);\n\n\t\t\t// GS-2100. Correct bar position considering hidden cells\n\t\t\tlet hiddenCells = 0;\n\t\t\tconst scaleCellsWidth = gantt.getScale().width;\n\t\t\tif (scaleCellsWidth.indexOf(0) > -1) {\n\t\t\t\tlet i = 0;\n\t\t\t\tfor (i; i < copy.$start; i++) {\n\t\t\t\t\tif (!scaleCellsWidth[i]) {\n\t\t\t\t\t\thiddenCells++;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tcopy.$start -= hiddenCells;\n\n\t\t\t\tfor (i; i < copy.$end; i++) {\n\t\t\t\t\tif (!scaleCellsWidth[i]) {\n\t\t\t\t\t\thiddenCells++;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tcopy.$end -= hiddenCells;\n\t\t\t}\n\n\t\t\tcopy.$level = obj.$level;\n\t\t\tcopy.$type = obj.$rendered_type;\n\n\t\t\tconst tmps = gantt.templates;\n\t\t\tcopy.$text = tmps.task_text(obj.start, obj.end_date, obj);\n\t\t\tcopy.$left = tmps.leftside_text ? tmps.leftside_text(obj.start, obj.end_date, obj) : \"\";\n\t\t\tcopy.$right = tmps.rightside_text ? tmps.rightside_text(obj.start, obj.end_date, obj) : \"\";\n\n\t\t\treturn copy;\n\t\t},\n\n\t\t_copyObjectColors(obj) {\n\t\t\tconst copy = gantt.ext.export_api._copyObjectTable(obj);\n\n\t\t\tconst node = gantt.getTaskNode(obj.id);\n\t\t\tif (node && node.firstChild) {\n\t\t\t\tlet color = gantt.ext.export_api._getColor((gantt._no_progress_colors ? node : node.firstChild), \"backgroundColor\");\n\t\t\t\tif (color === \"363636\"){\n\t\t\t\t\tcolor = gantt.ext.export_api._getColor(node, \"backgroundColor\");\n\t\t\t\t}\n\n\t\t\t\tcopy.$color = color;\n\t\t\t} else if (obj.color){\n\t\t\t\tcopy.$color = obj.color;\n\t\t\t}\n\n\t\t\treturn copy;\n\t\t},\n\n\t\t_copyObjectColumns(obj, copy) {\n\t\t\tfor (let i = 0; i < gantt.config.columns.length; i++) {\n\t\t\t\tconst ct = gantt.config.columns[i].template;\n\t\t\t\tif (ct) {\n\t\t\t\t\tlet val = ct(obj);\n\t\t\t\t\tif (val instanceof Date){\n\t\t\t\t\t\tval = gantt.templates.date_grid(val, obj);\n\t\t\t\t\t}\n\t\t\t\t\tcopy[\"_\" + i] = val;\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn copy;\n\t\t},\n\n\t\t_copyObjectAll(obj) {\n\t\t\tconst copy = gantt.ext.export_api._copyObjectBase(obj);\n\n\t\t\tconst templates = [\n\t\t\t\t\"leftside_text\",\n\t\t\t\t\"rightside_text\",\n\t\t\t\t\"task_text\",\n\t\t\t\t\"progress_text\",\n\t\t\t\t\"task_class\"\n\t\t\t];\n\n\t\t\t// serialize all text templates\n\t\t\tfor (let i = 0; i < templates.length; i++) {\n\t\t\t\tconst template = gantt.templates[templates[i]];\n\t\t\t\tif (template){\n\t\t\t\t\tcopy[\"$\" + i] = template(obj.start_date, obj.end_date, obj);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tgantt.ext.export_api._copyObjectColumns(obj, copy);\n\t\t\tcopy.open = obj.$open;\n\t\t\treturn copy;\n\t\t},\n\n\n\t\t_serializeHtml() {\n\t\t\tconst smartScales = gantt.config.smart_scales;\n\t\t\tconst smartRendering = gantt.config.smart_rendering;\n\t\t\tif (smartScales || smartRendering) {\n\t\t\t\tgantt.config.smart_rendering = false;\n\t\t\t\tgantt.config.smart_scales = false;\n\t\t\t\tgantt.render();\n\t\t\t}\n\n\t\t\tconst html = gantt.$container.parentNode.innerHTML;\n\n\t\t\tif (smartScales || smartRendering) {\n\t\t\t\tgantt.config.smart_scales = smartScales;\n\t\t\t\tgantt.config.smart_rendering = smartRendering;\n\t\t\t\tgantt.render();\n\t\t\t}\n\n\t\t\treturn html;\n\t\t},\n\n\t\t_serializeAll() {\n\t\t\tgantt.json._copyObject = gantt.ext.export_api._copyObjectAll;\n\t\t\tconst data = gantt.ext.export_api._exportSerialize();\n\t\t\tgantt.json._copyObject = gantt.ext.export_api._originalCopyObject;\n\t\t\treturn data;\n\t\t},\n\n\t\t_serializePlain() {\n\t\t\tconst oldXmlFormat = gantt.templates.xml_format;\n\t\t\tconst oldFormatDate = gantt.templates.format_date;\n\t\t\tgantt.templates.xml_format = gantt.date.date_to_str(\"%Y%m%dT%H%i%s\", true);\n\t\t\tgantt.templates.format_date = gantt.date.date_to_str(\"%Y%m%dT%H%i%s\", true);\n\t\t\tgantt.json._copyObject = gantt.ext.export_api._copyObjectPlain;\n\n\t\t\tconst data = gantt.ext.export_api._exportSerialize();\n\n\t\t\tgantt.templates.xml_format = oldXmlFormat;\n\t\t\tgantt.templates.format_date = oldFormatDate;\n\t\t\tgantt.json._copyObject = gantt.ext.export_api._originalCopyObject;\n\n\t\t\tdelete data.links;\n\t\t\treturn data;\n\t\t},\n\n\t\t_getRaw() {\n\t\t\t// support Gantt < 5.0\n\t\t\tif (gantt._scale_helpers) {\n\t\t\t\tconst scales = gantt._get_scales();\n\t\t\t\tconst\tminWidth = gantt.config.min_column_width;\n\t\t\t\tconst\tautosizeMinWidth = gantt._get_resize_options().x ? Math.max(gantt.config.autosize_min_width, 0) : gantt.config.$task.offsetWidth;\n\t\t\t\tconst\theight = gantt.config.config.scale_height - 1;\n\t\t\t\treturn gantt._scale_helpers.prepareConfigs(scales, minWidth, autosizeMinWidth, height);\n\t\t\t} else { // Gantt >= 5.0\n\t\t\t\tconst timeline = gantt.$ui.getView(\"timeline\");\n\t\t\t\tif (timeline) {\n\t\t\t\t\tlet availWidth = timeline.$config.width;\n\t\t\t\t\tif (gantt.config.autosize === \"x\" || gantt.config.autosize === \"xy\") {\n\t\t\t\t\t\tavailWidth = Math.max(gantt.config.autosize_min_width, 0);\n\t\t\t\t\t}\n\t\t\t\t\tconst state = gantt.getState();\n\t\t\t\t\tconst\tscales = timeline._getScales();\n\t\t\t\t\tconst\tminWidth = gantt.config.min_column_width;\n\t\t\t\t\tconst\theight = gantt.config.scale_height - 1;\n\t\t\t\t\tconst\trtl = gantt.config.rtl;\n\t\t\t\t\treturn timeline.$scaleHelper.prepareConfigs(scales, minWidth, availWidth, height, state.min_date, state.max_date, rtl);\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\n\t\t_serializeTimeline(config) {\n\t\t\tgantt.json._copyObject = config.visual ? gantt.ext.export_api._copyObjectColors : gantt.ext.export_api._copyObjectTable;\n\t\t\tconst data = gantt.ext.export_api._exportSerialize();\n\t\t\tgantt.json._copyObject = gantt.ext.export_api._originalCopyObject;\n\n\t\t\tdelete data.links;\n\n\t\t\tif (config.cellColors) {\n\t\t\t\tconst css = gantt.templates.timeline_cell_class || gantt.templates.task_cell_class;\n\t\t\t\tif (css) {\n\t\t\t\t\tconst raw = gantt.ext.export_api._getRaw();\n\t\t\t\t\tlet steps = raw[0].trace_x;\n\t\t\t\t\tfor (let i = 1; i < raw.length; i++){\n\t\t\t\t\t\tif (raw[i].trace_x.length > steps.length){\n\t\t\t\t\t\t\tsteps = raw[i].trace_x;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tfor (let i = 0; i < data.data.length; i++) {\n\t\t\t\t\t\tdata.data[i].styles = [];\n\t\t\t\t\t\tconst task = gantt.getTask(data.data[i].id);\n\t\t\t\t\t\tfor (let j = 0; j < steps.length; j++) {\n\t\t\t\t\t\t\tconst date = steps[j];\n\t\t\t\t\t\t\tconst cellCss = css(task, date);\n\t\t\t\t\t\t\tif (cellCss){\n\t\t\t\t\t\t\t\tdata.data[i].styles.push({ index: j, styles: gantt.ext.export_api._getStyles(cellCss) });\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn data;\n\t\t},\n\n\t\t_serializeScales(config) {\n\t\t\tconst scales:any = [];\n\t\t\tconst raw = gantt.ext.export_api._getRaw();\n\n\t\t\tlet min = Infinity;\n\t\t\tlet max = 0;\n\t\t\tfor (let i = 0; i < raw.length; i++) {\n\t\t\t\tmin = Math.min(min, raw[i].col_width);\n\t\t\t}\n\n\t\t\tfor (let i = 0; i < raw.length; i++) {\n\t\t\t\tlet start = 0;\n\t\t\t\tlet end = 0;\n\t\t\t\tconst row:any = [];\n\n\t\t\t\tscales.push(row);\n\t\t\t\tconst step = raw[i];\n\t\t\t\tmax = Math.max(max, step.trace_x.length);\n\t\t\t\tconst template = step.format || step.template || (step.date ? gantt.date.date_to_str(step.date) : gantt.config.date_scale);\n\n\t\t\t\tfor (let j = 0; j < step.trace_x.length; j++) {\n\t\t\t\t\tconst date = step.trace_x[j];\n\t\t\t\t\tend = start + Math.round(step.width[j] / min);\n\n\t\t\t\t\tconst scaleCell = { text: template(date), start, end, styles: \"\" };\n\n\t\t\t\t\tif (config.cellColors) {\n\t\t\t\t\t\tconst css = step.css || gantt.templates.scaleCell_class;\n\t\t\t\t\t\tif (css) {\n\t\t\t\t\t\t\tconst scaleCss = css(date);\n\t\t\t\t\t\t\tif (scaleCss){\n\t\t\t\t\t\t\t\tscaleCell.styles = gantt.ext.export_api._getStyles(scaleCss);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\trow.push(scaleCell);\n\t\t\t\t\tstart = end;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn { width: max, height: scales.length, data: scales };\n\t\t},\n\n\t\t_serializeGrid(config) {\n\t\t\tgantt.exportMode = true;\n\n\t\t\tconst columns:any = [];\n\t\t\tconst cols = gantt.config.columns;\n\n\t\t\tlet ccount = 0;\n\t\t\tfor (let i = 0; i < cols.length; i++) {\n\t\t\t\tif (cols[i].name === \"add\" || cols[i].name === \"buttons\") {\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\n\t\t\t\tcolumns[ccount] = {\n\t\t\t\t\tid: ((cols[i].template) ? (\"_\" + i) : cols[i].name),\n\t\t\t\t\theader: cols[i].label || gantt.locale.labels[\"column_\" + cols[i].name],\n\t\t\t\t\twidth: (cols[i].width ? Math.floor(cols[i].width / 4) : \"\"),\n\t\t\t\t\ttree: cols[i].tree || false\n\t\t\t\t};\n\n\t\t\t\tif (cols[i].name === \"duration\"){\n\t\t\t\t\tcolumns[ccount].type = \"number\";\n\t\t\t\t}\n\t\t\t\tif (cols[i].name === \"start_date\" || cols[i].name === \"end_date\") {\n\t\t\t\t\tcolumns[ccount].type = \"date\";\n\t\t\t\t\tif (config && config.rawDates){\n\t\t\t\t\t\tcolumns[ccount].id = cols[i].name;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tccount++;\n\t\t\t}\n\n\t\t\tgantt.exportMode = false;\n\t\t\treturn columns;\n\t\t},\n\n\t\t_exportSerialize() {\n\t\t\tgantt.exportMode = true;\n\n\t\t\tconst xmlFormat = gantt.templates.xml_format;\n\t\t\tconst formatDate = gantt.templates.format_date;\n\n\t\t\t// use configuration date format for serialization so date could be parsed on the export\n\t\t\t// required when custom format date function is defined\n\t\t\tgantt.templates.xml_format =\n\t\t\t\tgantt.templates.format_date =\n\t\t\t\tgantt.date.date_to_str(gantt.config.date_format || gantt.config.xml_date);\n\n\t\t\tconst data = gantt.serialize();\n\n\t\t\tgantt.templates.xml_format = xmlFormat;\n\t\t\tgantt.templates.format_date = formatDate;\n\t\t\tgantt.exportMode = false;\n\t\t\treturn data;\n\t\t},\n\n\n\t\t_setLevel(data) {\n\t\t\tfor (let i = 0; i < data.length; i++) {\n\t\t\t\t// tslint:disable-next-line triple-equals\n\t\t\t\tif (data[i].parent == 0) {\n\t\t\t\t\tdata[i]._lvl = 1;\n\t\t\t\t}\n\t\t\t\tfor (let j = i + 1; j < data.length; j++) {\n\t\t\t\t\t// tslint:disable-next-line triple-equals\n\t\t\t\t\tif (data[i].id == data[j].parent) {\n\t\t\t\t\t\tdata[j]._lvl = data[i]._lvl + 1;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\n\t\t_clearLevel(data) {\n\t\t\tfor (let i = 0; i < data.length; i++) {\n\t\t\t\tdelete data[i]._lvl;\n\t\t\t}\n\t\t},\n\n\t\t_clearRecLinks(data) {\n\t\t\tgantt.ext.export_api._setLevel(data.data);\n\t\t\tconst tasks = {};\n\t\t\tfor (let i = 0; i < data.data.length; i++) {\n\t\t\t\ttasks[data.data[i].id] = data.data[i];\n\t\t\t}\n\n\t\t\tconst links = {};\n\n\t\t\tfor (let i = 0; i < data.links.length; i++) {\n\t\t\t\tconst link = data.links[i];\n\t\t\t\tif (gantt.isTaskExists(link.source) && gantt.isTaskExists(link.target) &&\n\t\t\t\t\ttasks[link.source] && tasks[link.target]) {\n\t\t\t\t\tlinks[link.id] = link;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tfor (const j in links) {\n\t\t\t\tgantt.ext.export_api._makeLinksSameLevel(links[j], tasks);\n\t\t\t}\n\n\t\t\tconst skippedLinks = {};\n\t\t\tfor (const j in tasks) {\n\t\t\t\tgantt.ext.export_api._clearCircDependencies(tasks[j], links, tasks, {}, skippedLinks, null);\n\t\t\t}\n\n\t\t\tif (Object.keys(links)) {\n\t\t\t\tgantt.ext.export_api._clearLinksSameLevel(links, tasks);\n\t\t\t}\n\n\t\t\tfor (let i = 0; i < data.links.length; i++) {\n\t\t\t\tif (!links[data.links[i].id]) {\n\t\t\t\t\tdata.links.splice(i, 1);\n\t\t\t\t\ti--;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tgantt.ext.export_api._clearLevel(data.data);\n\t\t},\n\n\t\t_clearCircDependencies(task, links, tasks, usedTasks, skippedLinks, prevLink) {\n\t\t\tconst sources = task.$_source;\n\t\t\tif (!sources) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (usedTasks[task.id]) {\n\t\t\t\tgantt.ext.export_api._onCircDependencyFind(prevLink, links, usedTasks, skippedLinks);\n\t\t\t}\n\n\t\t\tusedTasks[task.id] = true;\n\n\t\t\tconst targets = {};\n\n\t\t\tfor (let i = 0; i < sources.length; i++) {\n\t\t\t\tif (skippedLinks[sources[i]]) {\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\t\t\t\tconst curLink = links[sources[i]];\n\t\t\t\tconst targetTask = tasks[curLink._target];\n\t\t\t\tif (targets[targetTask.id]) { // two link from one task to another\n\t\t\t\t\tgantt.ext.export_api._onCircDependencyFind(curLink, links, usedTasks, skippedLinks);\n\t\t\t\t}\n\t\t\t\ttargets[targetTask.id] = true;\n\t\t\t\tgantt.ext.export_api._clearCircDependencies(targetTask, links, tasks, usedTasks, skippedLinks, curLink);\n\t\t\t}\n\t\t\tusedTasks[task.id] = false;\n\t\t},\n\n\t\t_onCircDependencyFind(link, links, usedTasks, skippedLinks) {\n\t\t\tif (link) {\n\t\t\t\tif (gantt.callEvent(\"onExportCircularDependency\", [link.id, link])) {\n\t\t\t\t\tdelete links[link.id];\n\t\t\t\t}\n\n\t\t\t\tdelete usedTasks[link._source];\n\t\t\t\tdelete usedTasks[link._target];\n\t\t\t\tskippedLinks[link.id] = true;\n\t\t\t}\n\t\t},\n\n\t\t_makeLinksSameLevel(link, tasks) {\n\t\t\tlet task;\n\t\t\tlet targetLvl;\n\t\t\tconst linkT = {\n\t\t\t\ttarget: tasks[link.target],\n\t\t\t\tsource: tasks[link.source]\n\t\t\t};\n\t\t\t// tslint:disable-next-line triple-equals\n\t\t\tif (linkT.target._lvl != linkT.source._lvl) {\n\t\t\t\tif (linkT.target._lvl < linkT.source._lvl) {\n\t\t\t\t\ttask = \"source\";\n\t\t\t\t\ttargetLvl = linkT.target._lvl;\n\t\t\t\t} else {\n\t\t\t\t\ttask = \"target\";\n\t\t\t\t\ttargetLvl = linkT.source._lvl;\n\t\t\t\t}\n\n\t\t\t\tdo {\n\t\t\t\t\tconst parent = tasks[linkT[task].parent];\n\t\t\t\t\tif (!parent) {\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t\tlinkT[task] = parent;\n\t\t\t\t} while (linkT[task]._lvl < targetLvl);\n\n\t\t\t\tlet sourceParent = tasks[linkT.source.parent];\n\t\t\t\tlet\ttargetParent = tasks[linkT.target.parent];\n\t\t\t\t// tslint:disable-next-line triple-equals\n\t\t\t\twhile (sourceParent && targetParent && sourceParent.id != targetParent.id) {\n\t\t\t\t\tlinkT.source = sourceParent;\n\t\t\t\t\tlinkT.target = targetParent;\n\t\t\t\t\tsourceParent = tasks[linkT.source.parent];\n\t\t\t\t\ttargetParent = tasks[linkT.target.parent];\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tlink._target = linkT.target.id;\n\t\t\tlink._source = linkT.source.id;\n\n\t\t\tif (!linkT.target.$_target){\n\t\t\t\tlinkT.target.$_target = [];\n\t\t\t}\n\t\t\tlinkT.target.$_target.push(link.id);\n\n\t\t\tif (!linkT.source.$_source){\n\t\t\t\tlinkT.source.$_source = [];\n\t\t\t}\n\t\t\tlinkT.source.$_source.push(link.id);\n\t\t},\n\n\t\t_clearLinksSameLevel(links, tasks) {\n\t\t\tfor (const link in links) {\n\t\t\t\tdelete links[link]._target;\n\t\t\t\tdelete links[link]._source;\n\t\t\t}\n\n\t\t\tfor (const task in tasks) {\n\t\t\t\tdelete tasks[task].$_source;\n\t\t\t\tdelete tasks[task].$_target;\n\t\t\t}\n\t\t},\n\n\n\t\t_customProjectProperties(data, config) {\n\t\t\tif (config && config.project) {\n\t\t\t\tfor (const i in config.project) {\n\t\t\t\t\tif (!gantt.config.$custom_data){\n\t\t\t\t\t\tgantt.config.$custom_data = {};\n\t\t\t\t\t}\n\t\t\t\t\tgantt.config.$custom_data[i] = typeof config.project[i] === \"function\" ? config.project[i](gantt.config) : config.project[i];\n\t\t\t\t}\n\t\t\t\tdelete config.project;\n\t\t\t}\n\t\t},\n\n\t\t_customTaskProperties(data, config) {\n\t\t\tif (config && config.tasks) {\n\t\t\t\tdata.data.forEach(function(el) {\n\t\t\t\t\tfor (const i in config.tasks) {\n\t\t\t\t\t\tif (!el.$custom_data){\n\t\t\t\t\t\t\tel.$custom_data = {};\n\t\t\t\t\t\t}\n\t\t\t\t\t\tel.$custom_data[i] = typeof config.tasks[i] === \"function\" ? config.tasks[i](el, gantt.config) : config.tasks[i];\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t\tdelete config.tasks;\n\t\t\t}\n\t\t},\n\n\t\t_exportConfig(data, config) {\n\t\t\tconst projectName = config.name || \"gantt.xml\";\n\t\t\tdelete config.name;\n\n\t\t\tgantt.config.custom = config;\n\n\t\t\tconst time = gantt.ext.export_api._getWorktimeSettings();\n\n\t\t\tconst projectDates = gantt.getSubtaskDates();\n\t\t\tif (projectDates.start_date && projectDates.end_date) {\n\t\t\t\tconst formatDate = gantt.templates.format_date || gantt.templates.xml_format;\n\t\t\t\tgantt.config.start_end = {\n\t\t\t\t\tstart_date: formatDate(projectDates.start_date),\n\t\t\t\t\tend_date: formatDate(projectDates.end_date)\n\t\t\t\t};\n\t\t\t}\n\n\t\t\tconst manual = config.auto_scheduling === undefined ? false : !!config.auto_scheduling;\n\n\t\t\tconst res = {\n\t\t\t\tcallback: config.callback || null,\n\t\t\t\tconfig: gantt.config,\n\t\t\t\tdata,\n\t\t\t\tmanual,\n\t\t\t\tname: projectName,\n\t\t\t\tworktime: time\n\t\t\t};\n\t\t\tfor (const i in config) {\n\t\t\t\tres[i] = config[i];\n\t\t\t}\n\t\t\treturn res;\n\t\t},\n\n\n\t\t_sendImportAjaxMSP(config) {\n\t\t\tconst url = config.server || gantt.ext.export_api._apiUrl;\n\t\t\tconst store = config.store || 0;\n\t\t\tconst formData = config.data;\n\t\t\tconst callback = config.callback;\n\n\t\t\tconst settings = {\n\t\t\t\tdurationUnit: config.durationUnit || undefined,\n\t\t\t\tprojectProperties: config.projectProperties || undefined,\n\t\t\t\ttaskProperties: config.taskProperties || undefined\n\t\t\t};\n\n\t\t\tformData.append(\"type\", config.type || \"msproject-parse\");\n\t\t\tformData.append(\"data\", JSON.stringify(settings));\n\n\t\t\tif (store){\n\t\t\t\tformData.append(\"store\", store);\n\t\t\t}\n\n\t\t\tconst xhr = new XMLHttpRequest();\n\t\t\txhr.onreadystatechange = function(e) {\n\t\t\t\tif (xhr.readyState === 4 && xhr.status === 0) {// network error\n\t\t\t\t\tif (callback) {\n\t\t\t\t\t\tcallback(null);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t};\n\n\t\t\txhr.onload = function(){\n\t\t\t\tconst fail = xhr.status > 400;\n\t\t\t\tlet info = null;\n\n\t\t\t\tif (!fail) {\n\t\t\t\t\ttry {\n\t\t\t\t\t\tinfo = JSON.parse(xhr.responseText);\n\t\t\t\t\t} catch (e) { }\n\t\t\t\t}\n\n\t\t\t\tif (callback) {\n\t\t\t\t\tcallback(info);\n\t\t\t\t}\n\t\t\t};\n\n\t\t\txhr.open(\"POST\", url, true);\n\t\t\txhr.setRequestHeader(\"X-Requested-With\", \"XMLHttpRequest\");\n\t\t\txhr.send(formData);\n\t\t}\n\n\t};\n\n\n\tgantt.exportToPDF = gantt.ext.export_api.exportToPDF;\n\tgantt.exportToPNG = gantt.ext.export_api.exportToPNG;\n\tgantt.exportToICal = gantt.ext.export_api.exportToICal;\n\tgantt.exportToExcel = gantt.ext.export_api.exportToExcel;\n\tgantt.exportToJSON = gantt.ext.export_api.exportToJSON;\n\tgantt.importFromExcel = gantt.ext.export_api.importFromExcel;\n\tgantt.importFromMSProject = gantt.ext.export_api.importFromMSProject;\n\tgantt.exportToMSProject = gantt.ext.export_api.exportToMSProject;\n\tgantt.importFromPrimaveraP6 = gantt.ext.export_api.importFromPrimaveraP6;\n\tgantt.exportToPrimaveraP6 = gantt.ext.export_api.exportToPrimaveraP6;\n\n\n\treturn gantt.ext.export_api;\n}\n","export default {\n\tKEY_CODES: {\n\t\tUP: 38,\n\t\tDOWN: 40,\n\t\tLEFT: 37,\n\t\tRIGHT: 39,\n\t\tSPACE: 32,\n\t\tENTER: 13,\n\t\tDELETE: 46,\n\t\tESC: 27,\n\t\tTAB: 9\n\t}\n};","export default class ExtensionsManager{\n\tprivate _extensions:{[key:string]: GanttPlugin };\n\n\tconstructor(config: {[key:string]: GanttPlugin }){\n\t\tthis._extensions = {};\n\t\tfor(const i in config){\n\t\t\tthis._extensions[i] = config[i];\n\t\t}\n\t}\n\n\taddExtension = (name: string, ext: GanttPlugin) => {\n\t\tthis._extensions[name] = ext;\n\t};\n\n\tgetExtension = (name: string): GanttPlugin => {\n\t\treturn this._extensions[name];\n\t};\n}","type DurationUnits = \"minute\" | \"hour\" | \"day\" | \"week\" | \"month\" | \"year\";\ntype Align = \"left\" | \"center\" | \"right\";\ntype SectionType = \"textarea\"\n\t\t\t\t\t| \"time\"\n\t\t\t\t\t| \"duration\"\n\t\t\t\t\t| \"select\"\n\t\t\t\t\t| \"typeselect\"\n\t\t\t\t\t| \"parent\"\n\t\t\t\t\t| \"template\"\n\t\t\t\t\t| \"checkbox\"\n\t\t\t\t\t| \"radio\"\n\t\t\t\t\t| \"resources\"\n\t\t\t\t\t| \"constraint\";\n\ntype LightboxSection = Array<ILightboxSection\n\t| ILightboxTimeAndDurationSection\n\t| ILightboxInputControl\n\t| ILightboxSelectControl\n\t| ILightboxParentControl\n\t| ILightboxTypeselectControl>;\n\ntype LayoutView = \"grid\"\n\t| \"timeline\"\n\t| \"resizer\"\n\t| \"scrollbar\"\n\t| \"resourceGrid\"\n\t| \"resourceTimeline\";\n\ninterface IColumnItem {\n\tname: string;\n\tlabel?: string;\n\ttree?: boolean;\n\talign?: Align;\n\thide?: boolean;\n\tmax_width?: number;\n\tmin_width?: number;\n\tresize?: boolean;\n\ttemplate?: (obj: any) => string;\n\twidth?: number | \"*\";\n}\n\nexport type TModifierKeys = \"metaKey\" | \"ctrlKey\" | \"altKey\" | \"shiftKey\" | false | undefined;\n\nexport interface IScale {\n\tcss?: () => string;\n\tdate?: string;\n\tstep: number;\n\ttemplate?: (date: Date) => string;\n\tunit: DurationUnits;\n}\n\ninterface ILightboxSection {\n\tname: string;\n\tmap_to: string;\n\ttype: SectionType;\n\theight?: number;\n\tfocus?: boolean;\n}\n\ninterface ILightboxTimeAndDurationSection extends ILightboxSection {\n\treadonly: boolean;\n\tyear_range: number[] | number;\n\tsingle_date: boolean;\n\ttime_format: string;\n}\n\ninterface ILightboxInputControl extends ILightboxSection {\n\tdefault_value?: any;\n\toptions?: Array<{key: string, label: string}>;\n}\n\ninterface ILightboxSelectControl extends ILightboxInputControl {\n\tonchange: () => boolean | undefined;\n}\n\ninterface ILightboxParentControl extends ILightboxSection {\n\tallow_root: boolean;\n\troot_label: string;\n\tsort?: (a: any, b: any) => -1 | 0 | 1;\n\tfilter?: (task: string | number | object) => boolean;\n\ttemplate?: (start: Date, end: Date, ev: object) => string;\n}\n\ninterface ILightboxTypeselectControl extends ILightboxSection {\n\tfilter?: (typeName: string) => boolean;\n}\n\n\ninterface ILayoutScrollbar {\n\tview: \"scrollbar\";\n\tscroll?: \"x\" | \"y\";\n\tid: string;\n\theight?: number;\n\twidth?: number;\n}\n\ninterface ILayoutView {\n\tview: LayoutView;\n\tid?: string;\n\tscrollX?: string;\n\tscrollY?: string;\n\tconfig?: object;\n}\n\ninterface ILayoutGrid extends ILayoutView {\n\tview: \"grid\";\n\tbind?: string;\n}\n\ninterface ILayoutTimeline extends ILayoutView {\n\tview: \"timeline\";\n\tbindLinks?: string;\n\tlayers?: any[];\n}\n\ninterface ILayoutResizer {\n\tview?: undefined;\n\tresizer: boolean;\n\twidth: number;\n}\n\ninterface ILayoutResourceGrid extends ILayoutView {\n\tview: \"resourceGrid\";\n\twidth: number;\n\tgroup: \"string\";\n}\n\ninterface ILayoutResourceTimeline extends ILayoutView {\n\tview: \"resourceTimeline\";\n\twidth: number;\n\tgroup: \"string\";\n}\n\ninterface ILayoutHtml {\n\thtml: string;\n\tcss: string;\n\twidth: number;\n}\n\ntype LayoutRow = ILayoutGrid\n\t| ILayoutTimeline\n\t| ILayoutResizer\n\t| ILayoutResourceGrid\n\t| ILayoutResourceTimeline\n\t| ILayoutHtml\n\t| ILayoutScrollbar\n\t| { cols: LayoutCol[] };\n\ntype LayoutCol = ILayoutGrid\n\t| ILayoutTimeline\n\t| ILayoutResizer\n\t| ILayoutResourceGrid\n\t| ILayoutResourceTimeline\n\t| ILayoutHtml\n\t| ILayoutScrollbar\n\t| { rows: LayoutRow[] };\n\ninterface ILayout {\n\tcss: string;\n\trows?: LayoutRow[];\n\tcols?: LayoutCol[];\n}\n\ntype TCsp = boolean | \"auto\";\n\ninterface IResourceConfig {\n\tdataprocessor_assignments?: boolean;\n\tdataprocessor_resources?: boolean;\n\teditable_resource_diagram?: boolean;\n\tresource_store?: {\n\t\ttype?: \"treeDataStore\"|\"dataStore\"|string;\n\t\tfetchTasks?: boolean;\n\t\tinitItem?: (item: any) => any;\n\t};\n\tlightbox_resources?: (resources: any[]) => any[];\n\n}\n\ninterface IGanttConfig {\n\tlayout: ILayout;\n\tlinks: {\n\t\tfinish_to_start: \"0\";\n\t\tstart_to_start: \"1\";\n\t\tfinish_to_finish: \"2\";\n\t\tstart_to_finish: \"3\";\n\t};\n\ttypes: {\n\t\ttask: string;\n\t\tproject: string;\n\t\tmilestone: string;\n\t};\n\tauto_types: boolean;\n\tduration_unit: DurationUnits;\n\twork_time: boolean;\n\tcorrect_work_time: boolean;\n\tdeadlines: boolean;\n\tskip_off_time: boolean;\n\tcascade_delete: boolean;\n\tautosize: boolean | string;\n\tautoscroll: boolean;\n\tshow_links: boolean;\n\tshow_task_cells: boolean;\n\tautosize_min_width: number;\n\tautoscroll_speed: number;\n\tdeepcopy_on_parse: boolean;\n\tstatic_background: boolean;\n\tstatic_background_cells: boolean;\n\tbranch_loading: boolean;\n\tbranch_loading_property: string;\n\tshow_loading: boolean;\n\tshow_chart: boolean;\n\tshow_grid: boolean;\n\tmin_duration: number;\n\tdate_format: string; // use instead xml_date\n\txml_date?: string; // deprecated\n\tstart_on_monday: boolean;\n\tserver_utc: boolean;\n\tshow_progress: boolean;\n\tfit_tasks: boolean;\n\tselect_task: boolean;\n\tscroll_on_click: boolean;\n\tsmart_rendering: boolean;\n\tpreserve_scroll: boolean;\n\treadonly: boolean;\n\tcontainer_resize_timeout: number;\n\n\t/*grid */\n\tdate_grid: string;\n\n\tdrag_links: boolean;\n\tdrag_progress: boolean;\n\tdrag_resize: boolean;\n\tdrag_project: boolean;\n\tdrag_move: boolean;\n\tdrag_mode: {\n\t\tresize: \"resize\",\n\t\tprogress: \"progress\",\n\t\tmove: \"move\",\n\t\tignore: \"ignore\"\n\t};\n\tround_dnd_dates: boolean;\n\tlink_wrapper_width: number;\n\troot_id: string | number;\n\n\tlink_arrow_size:number;\n\n\tautofit: boolean;\n\tcolumns: IColumnItem[];\n\n\t/* scale*/\n\t/* it will be deprecated */\n\tdate_scale?: string;\n\tstep?: number;\n\tscale_unit?: DurationUnits;\n\tsubscales?: IScale[];\n\t/* it will be deprecated end */\n\n\tscales: IScale[];\n\n\tscale_offset_minimal: boolean;\n\n\tinherit_scale_class: boolean;\n\n\n\ttime_step: number;\n\tduration_step: number;\n\n\n\ttask_date: string;\n\ttime_picker: string;\n\ttask_attribute: string;\n\tlink_attribute: string;\n\tlayer_attribute: string;\n\tbuttons_left: string[];\n\t_migrate_buttons: {\n\t\tdhx_save_btn: \"gantt_save_btn\",\n\t\tdhx_cancel_btn: \"gantt_cancel_btn\",\n\t\tdhx_delete_btn: \"gantt_delete_btn\"\n\t};\n\n\tbuttons_right: string[];\n\n\n\tlightbox: {\n\t\tsections?: LightboxSection,\n\t\tproject_sections?: LightboxSection,\n\t\tmilestone_sections?: LightboxSection\n\t};\n\tdrag_lightbox: boolean;\n\tsort: boolean;\n\tdetails_on_create: boolean;\n\tdetails_on_dblclick: boolean;\n\tinitial_scroll: boolean;\n\ttask_scroll_offset: number;\n\n\torder_branch: boolean;\n\torder_branch_free: boolean;\n\n\t// task_height is deprecated, use 'bar_height` instead\n\ttask_height: number | \"full\" | undefined;\n\tbar_height: number | \"full\";\n\tmin_column_width: number;\n\tbar_height_padding: number,\n\trow_height: number,\n\n\t// min width for grid column (when resizing)\n\tmin_grid_column_width: number;\n\t// name of the attribute with column index for resize element\n\tgrid_resizer_column_attribute: string;\n\t// name of the attribute with column index for resize element\n\t// grid_resizer_attribute: string; // usage of this parameter is not found\n\n\t// grid width can be increased after the column has been resized\n\tkeep_grid_width: boolean;\n\n\t// grid width can be adjusted\n\tgrid_resize: boolean;\n\tgrid_elastic_columns: boolean;\n\tshow_tasks_outside_timescale: boolean;\n\tshow_unscheduled: boolean;\n\treadonly_property: string;\n\teditable_property: string;\n\tcalendar_property: string;\n\tresource_calendars: object;\n\tdynamic_resource_calendars: boolean;\n\tinherit_calendar: boolean;\n\ttype_renderers: object;\n\n\tresize_rows: boolean;\n\t// name of the attribute with row index for resize element\n\ttask_grid_row_resizer_attribute: string;\n\t// min height for row (when resizing)\n\tmin_task_grid_row_height: number;\n\n\topen_tree_initially: boolean;\n\toptimize_render: boolean;\n\tprevent_default_scroll: boolean;\n\tshow_errors: boolean;\n\twai_aria_attributes: boolean;\n\tsmart_scales: boolean;\n\trtl: boolean;\n\tplaceholder_task: boolean | object;\n\thorizontal_scroll_key: TModifierKeys;\n\tdrag_timeline: {\n\t\tuseKey: TModifierKeys;\n\t\tignore: string;\n\t\trender?: boolean;\n\t};\n\tdrag_multiple: boolean;\n\tcsp: TCsp;\n\n\tresources?: IResourceConfig;\n}\n\nexport default () => {\n\tconst result: IGanttConfig = {\n\t\tlayout: {\n\t\t\tcss: \"gantt_container\",\n\t\t\trows: [\n\t\t\t\t{\n\t\t\t\t\tcols: [\n\t\t\t\t\t\t{view: \"grid\", scrollX: \"scrollHor\", scrollY: \"scrollVer\"},\n\t\t\t\t\t\t{resizer: true, width: 1},\n\t\t\t\t\t\t{view: \"timeline\", scrollX: \"scrollHor\", scrollY: \"scrollVer\"},\n\t\t\t\t\t\t{view: \"scrollbar\", id: \"scrollVer\"}\n\t\t\t\t\t]\n\t\t\t\t},\n\t\t\t\t{view: \"scrollbar\", id: \"scrollHor\", height: 20}\n\t\t\t]\n\t\t},\n\t\tlinks: {\n\t\t\tfinish_to_start: \"0\",\n\t\t\tstart_to_start: \"1\",\n\t\t\tfinish_to_finish: \"2\",\n\t\t\tstart_to_finish: \"3\"\n\t\t},\n\t\ttypes: {\n\t\t\ttask: \"task\",\n\t\t\tproject: \"project\",\n\t\t\tmilestone: \"milestone\"\n\t\t},\n\t\tauto_types: false,\n\t\tduration_unit: \"day\",\n\t\twork_time: false,\n\t\tcorrect_work_time: false,\n\t\tskip_off_time: false,\n\n\t\tcascade_delete: true,\n\n\t\tautosize: false,\n\t\tautosize_min_width: 0,\n\t\tautoscroll: true,\n\t\tautoscroll_speed: 30,\n\t\tdeepcopy_on_parse: false,\n\t\tshow_links: true,\n\t\tshow_task_cells: true,\n\t\t// replace backgroung of the task area with a canvas img\n\t\tstatic_background: false,\n\t\tstatic_background_cells: true,\n\t\tbranch_loading: false,\n\t\tbranch_loading_property: \"$has_child\",\n\t\tshow_loading: false,\n\t\tshow_chart: true,\n\t\tshow_grid: true,\n\t\tmin_duration: 60 * 60 * 1000,\n\t\tdate_format: \"%d-%m-%Y %H:%i\", // use instead xml_date\n\t\txml_date: undefined, // \"%d-%m-%Y %H:%i\", // deprecated\n\t\tstart_on_monday: true,\n\t\tserver_utc: false,\n\t\tshow_progress: true,\n\t\tfit_tasks: false,\n\t\tselect_task: true,\n\t\tscroll_on_click: true,\n\t\tsmart_rendering: true,\n\t\tpreserve_scroll: true,\n\t\treadonly: false,\n\t\tcontainer_resize_timeout: 20,\n\t\tdeadlines: true,\n\n\t\t/*grid */\n\t\tdate_grid: \"%Y-%m-%d\",\n\n\t\tdrag_links: true,\n\t\tdrag_progress: true,\n\t\tdrag_resize: true,\n\t\tdrag_project: false,\n\t\tdrag_move: true,\n\t\tdrag_mode: {\n\t\t\tresize: \"resize\",\n\t\t\tprogress: \"progress\",\n\t\t\tmove: \"move\",\n\t\t\tignore: \"ignore\"\n\t\t},\n\t\tround_dnd_dates: true,\n\t\tlink_wrapper_width: 20,\n\t\tlink_arrow_size:12,\n\t\troot_id: 0,\n\n\t\tautofit: false, // grid column automatic fit grid_width config\n\t\tcolumns: [\n\t\t\t{name: \"text\", tree: true, width: \"*\", resize: true},\n\t\t\t{name: \"start_date\", align: \"center\", resize: true},\n\t\t\t{name: \"duration\", align: \"center\"},\n\t\t\t{name: \"add\", width: 44}\n\t\t],\n\n\t\t/*scale*/\n\n\t\tscale_offset_minimal: true,\n\t\tinherit_scale_class: false,\n\n\t\tscales: [\n\t\t\t{\n\t\t\t\tunit: \"day\",\n\t\t\t\tstep: 1,\n\t\t\t\tdate: \"%d %M\"\n\t\t\t}\n\t\t],\n// \t\tdate_scale: \"%d %M\",\n\n\t\ttime_step: 60,\n\t\tduration_step: 1,\n\t\ttask_date: \"%d %F %Y\",\n\t\ttime_picker: \"%H:%i\",\n\t\ttask_attribute: \"data-task-id\",\n\t\tlink_attribute: \"data-link-id\",\n\t\tlayer_attribute: \"data-layer\",\n\t\tbuttons_left: [\n\t\t\t\"gantt_save_btn\",\n\t\t\t\"gantt_cancel_btn\"\n\t\t],\n\t\t_migrate_buttons: {\n\t\t\tdhx_save_btn: \"gantt_save_btn\",\n\t\t\tdhx_cancel_btn: \"gantt_cancel_btn\",\n\t\t\tdhx_delete_btn: \"gantt_delete_btn\"\n\t\t},\n\t\tbuttons_right: [\n\t\t\t\"gantt_delete_btn\"\n\t\t],\n\t\tlightbox: {\n\t\t\tsections: [\n\t\t\t\t{name: \"description\", height: 70, map_to: \"text\", type: \"textarea\", focus: true},\n\t\t\t\t{name: \"time\", type: \"duration\", map_to: \"auto\"}\n\t\t\t],\n\t\t\tproject_sections: [\n\t\t\t\t{name: \"description\", height: 70, map_to: \"text\", type: \"textarea\", focus: true},\n\t\t\t\t{name: \"type\", type: \"typeselect\", map_to: \"type\"},\n\t\t\t\t{name: \"time\", type: \"duration\", readonly: true, map_to: \"auto\"}\n\t\t\t],\n\t\t\tmilestone_sections: [\n\t\t\t\t{name: \"description\", height: 70, map_to: \"text\", type: \"textarea\", focus: true},\n\t\t\t\t{name: \"type\", type: \"typeselect\", map_to: \"type\"},\n\t\t\t\t{name: \"time\", type: \"duration\", single_date: true, map_to: \"auto\"}\n\t\t\t]\n\t\t},\n\t\tdrag_lightbox: true,\n\t\tsort: false,\n\t\tdetails_on_create: true,\n\t\tdetails_on_dblclick: true,\n\t\tinitial_scroll: true,\n\t\ttask_scroll_offset: 100,\n\n\t\torder_branch: false,\n\t\torder_branch_free: false,\n\n\t\t// task height is deprecated, use 'bar_height' instead\n\t\ttask_height: undefined,// number px of 'full' for row height\n\t\tbar_height: \"full\",\n\t\tbar_height_padding:9,\n\t\tmin_column_width: 70,\n\n\t\t// min width for grid column (when resizing)\n\t\tmin_grid_column_width: 70,\n\t\t// name of the attribute with column index for resize element\n\t\tgrid_resizer_column_attribute: \"data-column-index\",\n\t\t// name of the attribute with column index for resize element\n\t\t// grid_resizer_attribute: \"grid_resizer\", // - usage of this parameter is not found in code\n\n\t\t// grid width can be increased after the column has been resized\n\t\tkeep_grid_width: false,\n\n\t\t// grid width can be adjusted\n\t\tgrid_resize: false,\n\t\tgrid_elastic_columns: false,\n\t\tshow_tasks_outside_timescale: false,\n\t\tshow_unscheduled: true,\n\n\t\tresize_rows: false,\n\t\t// name of the attribute with row index for resize element\n\t\ttask_grid_row_resizer_attribute: \"data-row-index\",\n\t\t// min height for row (when resizing)\n\t\tmin_task_grid_row_height: 30,\n\t\trow_height: 36,\n\n\t\t//\n\t\treadonly_property: \"readonly\",\n\t\teditable_property: \"editable\",\n\t\tcalendar_property: \"calendar_id\",\n\t\tresource_calendars: {},\n\t\tdynamic_resource_calendars: false,\n\t\tinherit_calendar: false,\n\t\ttype_renderers: {},\n\n\t\topen_tree_initially: false,\n\t\toptimize_render: true,\n\t\tprevent_default_scroll: false,\n\t\tshow_errors: true,\n\t\twai_aria_attributes: true,\n\t\tsmart_scales: true,\n\t\trtl:false,\n\t\tplaceholder_task: false,\n\t\thorizontal_scroll_key: \"shiftKey\",\n\t\tdrag_timeline: {\n\t\t\tuseKey: undefined,\n\t\t\tignore: \".gantt_task_line, .gantt_task_link\",\n\t\t\trender: false\n\t\t},\n\t\tdrag_multiple: true,\n\t\tcsp: \"auto\"\n\t};\n\treturn result;\n};\n","/* eslint-disable no-restricted-globals */\nvar isWindowAwailable = typeof window !== \"undefined\";\n\n/* eslint-enable no-restricted-globals */\n\nexport default {\n\tisIE: isWindowAwailable && (navigator.userAgent.indexOf(\"MSIE\") >= 0 || navigator.userAgent.indexOf(\"Trident\") >= 0),\n\tisIE6: isWindowAwailable && (!XMLHttpRequest && navigator.userAgent.indexOf(\"MSIE\") >= 0),\n\tisIE7: isWindowAwailable && (navigator.userAgent.indexOf(\"MSIE 7.0\") >= 0 && navigator.userAgent.indexOf(\"Trident\") < 0),\n\tisIE8: isWindowAwailable && (navigator.userAgent.indexOf(\"MSIE 8.0\") >= 0 && navigator.userAgent.indexOf(\"Trident\") >= 0),\n\tisOpera: isWindowAwailable && (navigator.userAgent.indexOf(\"Opera\") >= 0),\n\tisChrome: isWindowAwailable && (navigator.userAgent.indexOf(\"Chrome\") >= 0),\n\tisKHTML: isWindowAwailable && (navigator.userAgent.indexOf(\"Safari\") >= 0 || navigator.userAgent.indexOf(\"Konqueror\") >= 0),\n\tisFF: isWindowAwailable && (navigator.userAgent.indexOf(\"Firefox\") >= 0),\n\tisIPad: isWindowAwailable && (navigator.userAgent.search(/iPad/gi) >= 0),\n\tisEdge: isWindowAwailable && (navigator.userAgent.indexOf(\"Edge\")!=-1),\n\tisNode: (!isWindowAwailable || typeof navigator == \"undefined\" || (typeof PRODUCTION !== \"undefined\" && PRODUCTION === \"test\"))\n};\n","export default function serialize(data: object | string) {\n\tif (typeof data === \"string\" || typeof data === \"number\") {\n\t\treturn data;\n\t}\n\n\tlet result = \"\";\n\n\tfor (const key in data) {\n\t\tlet serialized = \"\";\n\t\tif (data.hasOwnProperty(key)) {\n\t\t\tif (typeof data[key] === \"string\") {\n\t\t\t\tserialized = encodeURIComponent(data[key]);\n\t\t\t} else if (typeof data[key] === \"number\") {\n\t\t\t\tserialized = String(data[key]);\n\t\t\t} else {\n\t\t\t\tserialized = encodeURIComponent(JSON.stringify(data[key]));\n\t\t\t}\n\t\t\tserialized = key + \"=\" + serialized;\n\n\t\t\tif (result.length) {\n\t\t\t\tserialized = \"&\" + serialized;\n\t\t\t}\n\t\t\tresult += serialized;\n\t\t}\n\t}\n\treturn result;\n}\n","import env from \"../../utils/env\";\nimport global from \"../../utils/global\";\nimport serialize from \"./serialize\";\n\nfunction createConfig(method, args) {\n\tvar result = {\n\t\tmethod: method\n\t};\n\n\tif (args.length === 0) {\n\t\tthrow new Error(\"Arguments list of query is wrong.\");\n\t}\n\tif (args.length === 1) {\n\t\tif (typeof args[0] === \"string\") {\n\t\t\tresult.url = args[0];\n\t\t\tresult.async = true;\n\t\t} else {\n\t\t\tresult.url = args[0].url;\n\t\t\tresult.async = (args[0].async || true);\n\t\t\tresult.callback = args[0].callback;\n\t\t\tresult.headers = args[0].headers;\n\t\t}\n\t\tif (method === \"POST\" || \"PUT\") {\n\t\t\tif (args[0].data) {\n\t\t\t\tif (typeof args[0].data !== \"string\") {\n\t\t\t\t\tresult.data = serialize(args[0].data);\n\t\t\t\t} else {\n\t\t\t\t\tresult.data = args[0].data;\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tresult.data = \"\";\n\t\t\t}\n\t\t}\n\t\treturn result;\n\t}\n\n\tresult.url = args[0];\n\tswitch(method) {\n\t\tcase \"GET\":\n\t\tcase \"DELETE\":\n\t\t\tresult.callback = args[1];\n\t\t\tresult.headers = args[2];\n\t\tbreak;\n\t\tcase \"POST\":\n\t\tcase \"PUT\":\n\t\t\tif (args[1]) {\n\t\t\t\tif (typeof args[1] !== \"string\") {\n\t\t\t\t\tresult.data = serialize(args[1]);\n\t\t\t\t} else {\n\t\t\t\t\tresult.data = args[1];\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tresult.data = \"\";\n\t\t\t}\n\t\t\tresult.callback = args[2];\n\t\t\tresult.headers = args[3];\n\t\tbreak;\n\t}\n\treturn result;\n}\n\nexport default function(gantt) {\n\treturn {\n\n\t\t// if false - dhxr param will added to prevent caching on client side (default),\n\t\t// if true - do not add extra params\n\t\tcache: true,\n\n\t\t// default method for load/loadStruct, post/get allowed\n\t\t// get - since 4.1.1, this should fix 412 error for macos safari\n\t\tmethod: \"get\",\n\n\t\tparse: function(data) {\n\t\t\tif (typeof data !== \"string\") return data;\n\n\t\t\tvar obj;\n\t\t\tdata = data.replace(/^[\\s]+/,\"\");\n\t\t\tif (typeof DOMParser !== \"undefined\" && !env.isIE) { // ff,ie9\n\t\t\t\tobj = (new DOMParser()).parseFromString(data, \"text/xml\");\n\t\t\t} else if (typeof global.ActiveXObject !== \"undefined\") {\n\t\t\t\tobj = new global.ActiveXObject(\"Microsoft.XMLDOM\");\n\t\t\t\tobj.async = \"false\";\n\t\t\t\tobj.loadXML(data);\n\t\t\t}\n\t\t\treturn obj;\n\t\t},\n\t\txmltop: function(tagname, xhr, obj) {\n\t\t\tif (typeof xhr.status == \"undefined\" || xhr.status < 400) {\n\t\t\t\tvar xml = (!xhr.responseXML) ? this.parse(xhr.responseText || xhr) : (xhr.responseXML || xhr);\n\t\t\t\tif (xml && xml.documentElement !== null && !xml.getElementsByTagName(\"parsererror\").length) {\n\t\t\t\t\treturn xml.getElementsByTagName(tagname)[0];\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (obj !== -1) gantt.callEvent(\"onLoadXMLError\",[\"Incorrect XML\", arguments[1], obj]);\n\t\t\treturn document.createElement(\"DIV\");\n\t\t},\n\t\txpath: function(xpathExp, docObj) {\n\t\t\tif (!docObj.nodeName) docObj = docObj.responseXML || docObj;\n\t\t\tif (env.isIE) {\n\t\t\t\treturn docObj.selectNodes(xpathExp)||[];\n\t\t\t} else {\n\t\t\t\tvar rows = [];\n\t\t\t\tvar first;\n\t\t\t\tvar col = (docObj.ownerDocument||docObj).evaluate(xpathExp, docObj, null, XPathResult.ANY_TYPE, null);\n\n\t\t\t\twhile (true){\n\t\t\t\t\tfirst = col.iterateNext();\n\t\t\t\t\tif(first){\n\t\t\t\t\t\trows.push(first);\n\t\t\t\t\t}else{\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\treturn rows;\n\t\t\t}\n\t\t},\n\t\tquery: function(config) {\n\t\t\treturn this._call(\n\t\t\t\t(config.method || \"GET\"),\n\t\t\t\tconfig.url,\n\t\t\t\tconfig.data || \"\",\n\t\t\t\t(config.async || true),\n\t\t\t\tconfig.callback,\n\t\t\t\tconfig.headers\n\t\t\t);\n\t\t},\n\t\tget: function(url, onLoad, headers) {\n\t\t\tvar config = createConfig(\"GET\", arguments);\n\t\t\treturn this.query(config);\n\t\t},\n\t\tgetSync: function(url, headers) {\n\t\t\tvar config = createConfig(\"GET\", arguments);\n\t\t\tconfig.async = false;\n\t\t\treturn this.query(config);\n\t\t},\n\t\tput: function(url, postData, onLoad, headers) {\n\t\t\tvar config = createConfig(\"PUT\", arguments);\n\t\t\treturn this.query(config);\n\t\t},\n\t\tdel: function(url, onLoad, headers) {\n\t\t\t/**\n\t\t\t * https://tools.ietf.org/html/rfc7231#section-4.3.5\n\t\t\t * A payload within a DELETE request message has no defined semantics;\n\t\t\t * sending a payload body on a DELETE request might cause some existing\n\t\t\t * implementations to reject the request.\n\t\t\t */\n\t\t\tvar config = createConfig(\"DELETE\", arguments);\n\t\t\treturn this.query(config);\n\t\t},\n\t\tpost: function(url, postData, onLoad, headers) {\n\t\t\tif (arguments.length == 1) {\n\t\t\t\tpostData = \"\";\n\t\t\t} else if (arguments.length == 2 && typeof(postData) == \"function\") {\n\t\t\t\tonLoad = postData;\n\t\t\t\tpostData = \"\";\n\t\t\t}\n\t\t\tvar config = createConfig(\"POST\", arguments);\n\t\t\treturn this.query(config);\n\t\t},\n\t\tpostSync: function(url, postData, headers) {\n\t\t\tpostData = (postData === null ? \"\" : String(postData));\n\n\t\t\tvar config = createConfig(\"POST\", arguments);\n\t\t\tconfig.async = false;\n\t\t\treturn this.query(config);\n\t\t},\n\t\t_call: function(method, url, postData, async, onLoad, headers) {\n\t\t\treturn new gantt.Promise(function(resolve, reject) {\n\t\t\t\tvar t = (typeof XMLHttpRequest !== undefined ? new XMLHttpRequest() : new global.ActiveXObject(\"Microsoft.XMLHTTP\"));\n\t\t\t\tvar isQt = (navigator.userAgent.match(/AppleWebKit/) !== null && navigator.userAgent.match(/Qt/) !== null && navigator.userAgent.match(/Safari/) !== null);\n\n\t\t\t\tif (!!async) {\n\t\t\t\t\tt.onreadystatechange = function() {\n\t\t\t\t\t\tif ((t.readyState == 4) || (isQt && t.readyState == 3)) { // what for long response and status 404?\n\t\t\t\t\t\t\tif (t.status != 200 || t.responseText === \"\")\n\t\t\t\t\t\t\t\tif (!gantt.callEvent(\"onAjaxError\", [t])) return;\n\n\t\t\t\t\t\t\tsetTimeout(function() {\n\t\t\t\t\t\t\t\tif (typeof(onLoad) == \"function\") {\n\t\t\t\t\t\t\t\t\tonLoad.apply(global, [{xmlDoc:t, filePath:url}]); // dhtmlx-compat, response.xmlDoc.responseXML/responseText\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tresolve(t);\n\t\t\t\t\t\t\t\tif (typeof(onLoad) == \"function\") {\n\t\t\t\t\t\t\t\t\tonLoad = null;\n\t\t\t\t\t\t\t\t\tt = null;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}, 0);\n\t\t\t\t\t\t}\n\t\t\t\t\t};\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\tvar noCache = !this || !this.cache;\n\t\t\t\tif (method == \"GET\" && noCache) {\n\t\t\t\t\turl += (url.indexOf(\"?\")>=0?\"&\":\"?\")+\"dhxr\"+new Date().getTime()+\"=1\";\n\t\t\t\t}\n\n\t\t\t\tt.open(method, url, async);\n\n\t\t\t\tif (headers){\n\t\t\t\t\tfor (var key in headers)\n\t\t\t\t\t\tt.setRequestHeader(key, headers[key]);\n\t\t\t\t} else if (method.toUpperCase() == \"POST\" || method == \"PUT\" || method == \"DELETE\") {\n\t\t\t\t\tt.setRequestHeader(\"Content-Type\", \"application/x-www-form-urlencoded\");\n\t\t\t\t} else if (method == \"GET\") {\n\t\t\t\t\tpostData = null;\n\t\t\t\t}\n\n\t\t\t\tt.setRequestHeader(\"X-Requested-With\", \"XMLHttpRequest\");\n\n\t\t\t\tt.send(postData);\n\n\t\t\t\tif (!async) return {xmlDoc:t, filePath:url}; // dhtmlx-compat, response.xmlDoc.responseXML/responseText\n\t\t\t});\n\t\t},\n\t\turlSeparator: function(str){\n\t\t\tif (str.indexOf(\"?\") != -1)\n\t\t\t\treturn \"&\";\n\t\t\telse\n\t\t\t\treturn \"?\";\n\t\t}\n\t};\n};\n","const dateToStr = (format: string, utc: boolean, gantt) => {\n\tformat = format.replace(/%[a-zA-Z]/g, (a) => {\n\t\tswitch (a) {\n\t\t\tcase \"%d\":\n\t\t\t\treturn `\"+to_fixed(date.get${utc?\"UTC\":\"\"}Date())+\"`;\n\t\t\tcase \"%m\":\n\t\t\t\treturn `\"+to_fixed((date.get${utc?\"UTC\":\"\"}Month()+1))+\"`;\n\t\t\tcase \"%j\":\n\t\t\t\treturn `\"+date.get${utc?\"UTC\":\"\"}Date()+\"`;\n\t\t\tcase \"%n\":\n\t\t\t\treturn `\"+(date.get${utc?\"UTC\":\"\"}Month()+1)+\"`;\n\t\t\tcase \"%y\":\n\t\t\t\treturn `\"+to_fixed(date.get${utc?\"UTC\":\"\"}FullYear()%100)+\"`;\n\t\t\tcase \"%Y\":\n\t\t\t\treturn `\"+date.get${utc?\"UTC\":\"\"}FullYear()+\"`;\n\t\t\tcase \"%D\":\n\t\t\t\treturn `\"+locale.date.day_short[date.get${utc?\"UTC\":\"\"}Day()]+\"`;\n\t\t\tcase \"%l\":\n\t\t\t\treturn `\"+locale.date.day_full[date.get${utc?\"UTC\":\"\"}Day()]+\"`;\n\t\t\tcase \"%M\":\n\t\t\t\treturn `\"+locale.date.month_short[date.get${utc?\"UTC\":\"\"}Month()]+\"`;\n\t\t\tcase \"%F\":\n\t\t\t\treturn `\"+locale.date.month_full[date.get${utc?\"UTC\":\"\"}Month()]+\"`;\n\t\t\tcase \"%h\":\n\t\t\t\treturn `\"+to_fixed((date.get${utc?\"UTC\":\"\"}Hours()+11)%12+1)+\"`;\n\t\t\tcase \"%g\":\n\t\t\t\treturn `\"+((date.get${utc?\"UTC\":\"\"}Hours()+11)%12+1)+\"`;\n\t\t\tcase \"%G\":\n\t\t\t\treturn `\"+date.get${utc?\"UTC\":\"\"}Hours()+\"`;\n\t\t\tcase \"%H\":\n\t\t\t\treturn `\"+to_fixed(date.get${utc?\"UTC\":\"\"}Hours())+\"`;\n\t\t\tcase \"%i\":\n\t\t\t\treturn `\"+to_fixed(date.get${utc?\"UTC\":\"\"}Minutes())+\"`;\n\t\t\tcase \"%a\":\n\t\t\t\treturn `\"+(date.get${utc?\"UTC\":\"\"}Hours()>11?\"pm\":\"am\")+\"`;\n\t\t\tcase \"%A\":\n\t\t\t\treturn `\"+(date.get${utc?\"UTC\":\"\"}Hours()>11?\"PM\":\"AM\")+\"`;\n\t\t\tcase \"%s\":\n\t\t\t\treturn `\"+to_fixed(date.get${utc?\"UTC\":\"\"}Seconds())+\"`;\n\t\t\tcase \"%W\":\n\t\t\t\treturn `\"+to_fixed(getISOWeek(date))+\"`;\n\t\t\tcase \"%w\":\n\t\t\t\treturn `\"+to_fixed(getWeek(date))+\"`;\n\t\t\tdefault:\n\t\t\t\treturn a;\n\t\t}\n\t});\n\n\t// tslint:disable-next-line: function-constructor\n\tconst dateToStrFn = new Function(\"date\", \"to_fixed\", \"locale\", \"getISOWeek\", \"getWeek\", `return \"${format}\";`);\n\n\treturn (date: Date) => {\n\t\treturn dateToStrFn(date, gantt.date.to_fixed, gantt.locale, gantt.date.getISOWeek, gantt.date.getWeek);\n\t};\n};\n\n\nconst strToDate = (format: string, utc: boolean, gantt:any) => {\n\tlet splt = \"var temp=date.match(/[a-zA-Z]+|[0-9]+/g);\";\n\tconst mask = format.match(/%[a-zA-Z]/g);\n\tfor (let i = 0; i < mask.length; i++) {\n\t\tswitch (mask[i]) {\n\t\t\tcase \"%j\":\n\t\t\tcase \"%d\":\n\t\t\t\tsplt += `set[2]=temp[${i}]||1;`;\n\t\t\t\tbreak;\n\t\t\tcase \"%n\":\n\t\t\tcase \"%m\":\n\t\t\t\tsplt += `set[1]=(temp[${i}]||1)-1;`;\n\t\t\t\tbreak;\n\t\t\tcase \"%y\":\n\t\t\t\tsplt += `set[0]=temp[${i}]*1+(temp[${i}]>50?1900:2000);`;\n\t\t\t\tbreak;\n\t\t\tcase \"%g\":\n\t\t\tcase \"%G\":\n\t\t\tcase \"%h\":\n\t\t\tcase \"%H\":\n\t\t\t\tsplt += `set[3]=temp[${i}]||0;`;\n\t\t\t\tbreak;\n\t\t\tcase \"%i\":\n\t\t\t\tsplt += `set[4]=temp[${i}]||0;`;\n\t\t\t\tbreak;\n\t\t\tcase \"%Y\":\n\t\t\t\tsplt += `set[0]=temp[${i}]||0;`;\n\t\t\t\tbreak;\n\t\t\tcase \"%a\":\n\t\t\tcase \"%A\":\n\t\t\t\tsplt += `set[3]=set[3]%12+((temp[${i}]||'').toLowerCase()=='am'?0:12);`;\n\t\t\t\tbreak;\n\t\t\tcase \"%s\":\n\t\t\t\tsplt += `set[5]=temp[${i}]||0;`;\n\t\t\t\tbreak;\n\t\t\tcase \"%M\":\n\t\t\t\tsplt += `set[1]=locale.date.month_short_hash[temp[${i}]]||0;`;\n\t\t\t\tbreak;\n\t\t\tcase \"%F\":\n\t\t\t\tsplt += `set[1]=locale.date.month_full_hash[temp[${i}]]||0;`;\n\t\t\t\tbreak;\n\t\t\tdefault:\n\t\t\t\tbreak;\n\t\t}\n\t}\n\tlet code = \"set[0],set[1],set[2],set[3],set[4],set[5]\";\n\tif (utc) { code = ` Date.UTC(${code})`; }\n\t// tslint:disable-next-line: function-constructor\n\tconst strToDateFn = new Function(\"date\", \"locale\", `var set=[0,0,1,0,0,0]; ${splt} return new Date(${code});`);\n\n\treturn (dateString) => {\n\t\treturn strToDateFn(dateString, gantt.locale);\n\t};\n};\n\nconst fastVersion = {\n\tdate_to_str: dateToStr,\n\tstr_to_date: strToDate\n};\n\nexport default fastVersion;","const dateToStr = (format: string, utc: boolean, gantt) => {\n\treturn (date) => {\n\t\treturn format.replace(/%[a-zA-Z]/g, (a) => {\n\t\t\tswitch (a) {\n\t\t\t\tcase \"%d\": return utc ? gantt.date.to_fixed(date.getUTCDate()) : gantt.date.to_fixed(date.getDate());\n\t\t\t\tcase \"%m\": return utc ? gantt.date.to_fixed((date.getUTCMonth() + 1)) : gantt.date.to_fixed((date.getMonth() + 1));\n\t\t\t\tcase \"%j\": return utc ? date.getUTCDate() : date.getDate();\n\t\t\t\tcase \"%n\": return utc ? (date.getUTCMonth() + 1) : (date.getMonth() + 1);\n\t\t\t\tcase \"%y\": return utc ? gantt.date.to_fixed(date.getUTCFullYear() % 100) : gantt.date.to_fixed(date.getFullYear() % 100);\n\t\t\t\tcase \"%Y\": return utc ? date.getUTCFullYear() : date.getFullYear();\n\t\t\t\tcase \"%D\": return utc ? gantt.locale.date.day_short[date.getUTCDay()] : gantt.locale.date.day_short[date.getDay()];\n\t\t\t\tcase \"%l\": return utc ? gantt.locale.date.day_full[date.getUTCDay()] : gantt.locale.date.day_full[date.getDay()];\n\t\t\t\tcase \"%M\": return utc ? gantt.locale.date.month_short[date.getUTCMonth()] : gantt.locale.date.month_short[date.getMonth()];\n\t\t\t\tcase \"%F\": return utc ? gantt.locale.date.month_full[date.getUTCMonth()] : gantt.locale.date.month_full[date.getMonth()];\n\t\t\t\tcase \"%h\": return utc ? gantt.date.to_fixed((date.getUTCHours() + 11) % 12 + 1) : gantt.date.to_fixed((date.getHours() + 11) % 12 + 1);\n\t\t\t\tcase \"%g\": return utc ? ((date.getUTCHours() + 11) % 12 + 1) : ((date.getHours() + 11) % 12 + 1);\n\t\t\t\tcase \"%G\": return utc ? date.getUTCHours() : date.getHours();\n\t\t\t\tcase \"%H\": return utc ? gantt.date.to_fixed(date.getUTCHours()) : gantt.date.to_fixed(date.getHours());\n\t\t\t\tcase \"%i\": return utc ? gantt.date.to_fixed(date.getUTCMinutes()) : gantt.date.to_fixed(date.getMinutes());\n\t\t\t\tcase \"%a\": return utc ? (date.getUTCHours() > 11 ? \"pm\" : \"am\") : (date.getHours() > 11 ? \"pm\" : \"am\");\n\t\t\t\tcase \"%A\": return utc ? (date.getUTCHours() > 11 ? \"PM\" : \"AM\") : (date.getHours() > 11 ? \"PM\" : \"AM\");\n\t\t\t\tcase \"%s\": return utc ? gantt.date.to_fixed(date.getUTCSeconds()) : gantt.date.to_fixed(date.getSeconds());\n\t\t\t\tcase \"%W\": return utc ? gantt.date.to_fixed(gantt.date.getUTCISOWeek(date)) : gantt.date.to_fixed(gantt.date.getISOWeek(date));\n\t\t\t\tdefault: return a;\n\t\t\t}\n\t\t});\n\t};\n};\nconst strToDate = (format: string, utc: boolean, gantt:any) => {\n\treturn (date: string) => {\n\t\tconst set: Array<string|number> = [0, 0, 1, 0, 0, 0];\n\t\tconst temp = date.match(/[a-zA-Z]+|[0-9]+/g);\n\t\tconst mask = format.match(/%[a-zA-Z]/g);\n\n\t\tfor (let i = 0; i < mask.length; i++) {\n\t\t\tswitch (mask[i]) {\n\t\t\t\tcase \"%j\":\n\t\t\t\tcase \"%d\":\n\t\t\t\t\tset[2] = temp[i] as unknown as number || 1;\n\t\t\t\t\tbreak;\n\t\t\t\tcase \"%n\":\n\t\t\t\tcase \"%m\":\n\t\t\t\t\tset[1] = (temp[i] as unknown as number || 1) - 1;\n\t\t\t\t\tbreak;\n\t\t\t\tcase \"%y\":\n\t\t\t\t\tset[0] = temp[i] as unknown as number * 1 + ((temp[i] as unknown as number) > 50 ? 1900 : 2000);\n\t\t\t\t\tbreak;\n\t\t\t\tcase \"%g\":\n\t\t\t\tcase \"%G\":\n\t\t\t\tcase \"%h\":\n\t\t\t\tcase \"%H\":\n\t\t\t\t\tset[3] = temp[i] as unknown as number || 0;\n\t\t\t\t\tbreak;\n\t\t\t\tcase \"%i\":\n\t\t\t\t\tset[4] = temp[i] as unknown as number || 0;\n\t\t\t\t\tbreak;\n\t\t\t\tcase \"%Y\":\n\t\t\t\t\tset[0] = temp[i] as unknown as number || 0;\n\t\t\t\t\tbreak;\n\t\t\t\tcase \"%a\":\n\t\t\t\tcase \"%A\":\n\t\t\t\t\tset[3] = set[3] as number % 12 + ((temp[i] || \"\").toLowerCase() === \"am\" ? 0 : 12);\n\t\t\t\t\tbreak;\n\t\t\t\tcase \"%s\":\n\t\t\t\t\tset[5] = temp[i] || 0;\n\t\t\t\t\tbreak;\n\t\t\t\tcase \"%M\":\n\t\t\t\t\tset[1] = gantt.locale.date.month_short_hash[temp[i]] || 0;\n\t\t\t\t\tbreak;\n\t\t\t\tcase \"%F\":\n\t\t\t\t\tset[1] = gantt.locale.date.month_full_hash[temp[i]] || 0;\n\t\t\t\t\tbreak;\n\t\t\t\tdefault:\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\n\t\tif (utc) {\n\t\t\treturn new Date(Date.UTC(\n\t\t\t\tset[0] as number,\n\t\t\t\tset[1] as number,\n\t\t\t\tset[2] as number,\n\t\t\t\tset[3] as number,\n\t\t\t\tset[4] as number,\n\t\t\t\tset[5] as number\n\t\t\t));\n\t\t}\n\t\treturn new Date(\n\t\t\tset[0] as number,\n\t\t\tset[1] as number,\n\t\t\tset[2] as number,\n\t\t\tset[3] as number,\n\t\t\tset[4] as number,\n\t\t\tset[5] as number\n\t\t);\n\t};\n\n};\n\n\nconst cspVersion = {\n\tdate_to_str: dateToStr,\n\tstr_to_date: strToDate\n};\n\nexport default cspVersion;","/*\n %d - the day as a number with a leading zero ( 01 to 31 );\n %j - the day as a number without a leading zero ( 1 to 31 );\n %D - the day as an abbreviation ( Sun to Sat );\n %l - the day as a full name ( Sunday to Saturday );\n %W - the ISO-8601 week number of the year. Weeks start on Monday; 1)\n %m - the month as a number without a leading zero ( 1 to 12 );\n %n - the month as a number with a leading zero ( 01 to 12);\n %M - the month as an abbreviation ( Jan to Dec );\n %F - the month as a full name ( January to December );\n %y - the year as a two-digit number ( 00 to 99 );\n %Y - the year as a four-digit number ( 1900–9999 );\n %h - the hour based on the 12-hour clock ( 00 to 11 );\n %H - the hour based on the 24-hour clock ( 00 to 23 );\n %i - the minute as a number with a leading zero ( 00 to 59 );\n %s - the second as a number without a leading zero ( 00 to 59 ); 2)\n %a - displays am (for times from midnight until noon) and pm (for times from noon until midnight);\n %A - displays AM (for times from midnight until noon) and PM (for times from noon until midnight).\n*/\n\nimport fastVersion from \"./date_parsers/fast_version\";\nimport cspCompliantVersion from \"./date_parsers/csp_compliant_version\";\n\nexport default function(gantt) {\n\tvar canUseCsp = null;\n\tfunction cspAutoCheck() {\n\t\ttry {\n\t\t\tnew Function(\"canUseCsp = false;\");\n\t\t} catch(e) {\n\t\t\tcanUseCsp = true;\n\t\t}\n\t}\n\tfunction useCsp() {\n\t\tvar result = false;\n\t\tif (gantt.config.csp === \"auto\") {\n\t\t\tif(canUseCsp === null) {\n\t\t\t\tcspAutoCheck();\n\t\t\t}\n\t\t\tresult = canUseCsp;\n\t\t} else {\n\t\t\tresult = gantt.config.csp;\n\t\t}\n\t\treturn result;\n\t}\n\n\tvar dateHelper = {\n\t\tinit: function () {\n\t\t\tvar locale = gantt.locale;\n\n\t\t\tvar s = locale.date.month_short;\n\t\t\tvar t = locale.date.month_short_hash = {};\n\t\t\tfor (var i = 0; i < s.length; i++)\n\t\t\t\tt[s[i]] = i;\n\n\t\t\tvar s = locale.date.month_full;\n\t\t\tvar t = locale.date.month_full_hash = {};\n\t\t\tfor (var i = 0; i < s.length; i++)\n\t\t\t\tt[s[i]] = i;\n\t\t},\n\t\tdate_part: function (date) {\n\t\t\tvar old = new Date(date);\n\t\t\tdate.setHours(0);\n\t\t\tthis.hour_start(date);\n\t\t\tif (date.getHours() && //shift to yesterday on dst\n\t\t\t\t(date.getDate() < old.getDate() || date.getMonth() < old.getMonth() || date.getFullYear() < old.getFullYear()))\n\t\t\t\tdate.setTime(date.getTime() + 60 * 60 * 1000 * (24 - date.getHours()));\n\t\t\treturn date;\n\t\t},\n\t\ttime_part: function (date) {\n\t\t\treturn (date.valueOf() / 1000 - date.getTimezoneOffset() * 60) % 86400;\n\t\t},\n\t\tweek_start: function (date) {\n\t\t\tvar shift = date.getDay();\n\t\t\tif (gantt.config.start_on_monday) {\n\t\t\t\tif (shift === 0) shift = 6;\n\t\t\t\telse shift--;\n\t\t\t}\n\t\t\treturn this.date_part(this.add(date, -1 * shift, \"day\"));\n\t\t},\n\t\tmonth_start: function (date) {\n\t\t\tdate.setDate(1);\n\t\t\treturn this.date_part(date);\n\t\t},\n\t\tquarter_start: function (date) {\n\t\t\tthis.month_start(date);\n\t\t\tvar m = date.getMonth(),\n\t\t\t\tres_month;\n\n\t\t\tif (m >= 9) {\n\t\t\t\tres_month = 9;\n\t\t\t} else if (m >= 6) {\n\t\t\t\tres_month = 6;\n\t\t\t} else if (m >= 3) {\n\t\t\t\tres_month = 3;\n\t\t\t} else {\n\t\t\t\tres_month = 0;\n\t\t\t}\n\n\t\t\tdate.setMonth(res_month);\n\t\t\treturn date;\n\t\t},\n\t\tyear_start: function (date) {\n\t\t\tdate.setMonth(0);\n\t\t\treturn this.month_start(date);\n\t\t},\n\t\tday_start: function (date) {\n\t\t\treturn this.date_part(date);\n\t\t},\n\t\thour_start: function (date) {\n\t\t\tif (date.getMinutes())\n\t\t\t\tdate.setMinutes(0);\n\t\t\tthis.minute_start(date);\n\n\t\t\treturn date;\n\t\t},\n\t\tminute_start: function (date) {\n\t\t\tif (date.getSeconds())\n\t\t\t\tdate.setSeconds(0);\n\t\t\tif (date.getMilliseconds())\n\t\t\t\tdate.setMilliseconds(0);\n\t\t\treturn date;\n\t\t},\n\t\t_add_days: function (modifiedDate, inc, originalDate) {\n\n\t\t\tmodifiedDate.setDate(modifiedDate.getDate() + inc);\n\t\t\tvar incCondition = inc >= 0;\n\t\t\tvar getHoursCondition = !originalDate.getHours() && modifiedDate.getHours(); //shift to yesterday on dst\n\t\t\tvar getDateCondition = (modifiedDate.getDate() <= originalDate.getDate() || modifiedDate.getMonth() < originalDate.getMonth() || modifiedDate.getFullYear() < originalDate.getFullYear());\n\t\t\tif (incCondition && getHoursCondition && getDateCondition){\n\t\t\t\tmodifiedDate.setTime(modifiedDate.getTime() + 60 * 60 * 1000 * (24 - modifiedDate.getHours()));\n\t\t\t}\n\t\t\tvar worktimeCalculation = inc > 1;\n\t\t\tif (worktimeCalculation && getHoursCondition){\n\t\t\t\t// try to shift the modified Date to 00:00\n\t\t\t\tmodifiedDate.setHours(0);\n\t\t\t}\n\t\t\treturn modifiedDate;\n\t\t},\n\n\t\tadd: function (date, inc, mode) {\n\t\t\t/*jsl:ignore*/\n\t\t\tvar ndate = new Date(date.valueOf());\n\t\t\tswitch (mode) {\n\t\t\t\tcase \"day\":\n\t\t\t\t\tndate = this._add_days(ndate, inc, date);\n\t\t\t\t\tbreak;\n\t\t\t\tcase \"week\":\n\t\t\t\t\tndate = this._add_days(ndate, inc * 7, date);\n\t\t\t\t\tbreak;\n\t\t\t\tcase \"month\":\n\t\t\t\t\tndate.setMonth(ndate.getMonth() + inc);\n\t\t\t\t\tbreak;\n\t\t\t\tcase \"year\":\n\t\t\t\t\tndate.setYear(ndate.getFullYear() + inc);\n\t\t\t\t\tbreak;\n\t\t\t\tcase \"hour\":\n\t\t\t\t\t/*\n\t\t\t\t\t\tadding hours/minutes via setHour(getHour() + inc) gives weird result when\n\t\t\t\t\t\tadding one hour to the time before switch to a Daylight Saving time\n\n\t\t\t\t\t\texample: //Sun Mar 30 2014 01:00:00 GMT+0100 (W. Europe Standard Time)\n\t\t\t\t\t\tnew Date(2014, 02, 30, 1).setHours(2)\n\t\t\t\t\t\t>>Sun Mar 30 2014 01:00:00 GMT+0100 (W. Europe Standard Time)\n\n\t\t\t\t\t\tsetTime seems working as expected\n\t\t\t\t\t */\n\t\t\t\t\tndate.setTime(ndate.getTime() + inc * 60 * 60 * 1000);\n\t\t\t\t\tbreak;\n\t\t\t\tcase \"minute\":\n\n\t\t\t\t\tndate.setTime(ndate.getTime() + inc * 60 * 1000);\n\n\t\t\t\t\tbreak;\n\t\t\t\tdefault:\n\t\t\t\t\treturn this[\"add_\" + mode](date, inc, mode);\n\t\t\t}\n\t\t\treturn ndate;\n\t\t\t/*jsl:end*/\n\t\t},\n\t\tadd_quarter: function (date, inc) {\n\t\t\treturn this.add(date, inc * 3, \"month\");\n\t\t},\n\n\t\tto_fixed: function (num) {\n\t\t\tif (num < 10) return \"0\" + num;\n\t\t\treturn num;\n\t\t},\n\t\tcopy: function (date) {\n\t\t\treturn new Date(date.valueOf());\n\t\t},\n\t\tdate_to_str: function (format, utc) {\n\t\t\tvar result = fastVersion;\n\t\t\tif (useCsp()) {\n\t\t\t\tresult = cspCompliantVersion;\n\t\t\t}\n\t\t\treturn result.date_to_str(format, utc, gantt);\n\t\t},\n\t\tstr_to_date: function (format, utc) {\n\t\t\tvar result = fastVersion;\n\t\t\tif (useCsp()) {\n\t\t\t\tresult = cspCompliantVersion;\n\t\t\t}\n\t\t\treturn result.str_to_date(format, utc, gantt);\n\t\t},\n\t\tgetISOWeek: function (ndate) {\n\t\t\treturn gantt.date._getWeekNumber(ndate, true);\n\t\t},\n\t\t_getWeekNumber: function(ndate, isoWeek){\n\t\t\tif (!ndate) return false;\n\t\t\tvar nday = ndate.getDay();\n\t\t\tif(isoWeek){\n\t\t\t\tif (nday === 0) {\n\t\t\t\t\tnday = 7;\n\t\t\t\t}\n\t\t\t}\n\t\t\tvar first_thursday = new Date(ndate.valueOf());\n\t\t\tfirst_thursday.setDate(ndate.getDate() + (4 - nday));\n\t\t\tvar year_number = first_thursday.getFullYear(); // year of the first Thursday\n\t\t\tvar ordinal_date = Math.round((first_thursday.getTime() - new Date(year_number, 0, 1).getTime()) / 86400000); //ordinal date of the first Thursday - 1 (so not really ordinal date)\n\t\t\tvar week_number = 1 + Math.floor(ordinal_date / 7);\n\t\t\treturn week_number;\n\t\t},\n\n\t\tgetWeek: function(ndate){\n\t\t\treturn gantt.date._getWeekNumber(ndate, gantt.config.start_on_monday);\n\t\t},\n\t\tgetUTCISOWeek: function (ndate) {\n\t\t\treturn gantt.date.getISOWeek(ndate);\n\t\t},\n\t\tconvert_to_utc: function (date) {\n\t\t\treturn new Date(date.getUTCFullYear(), date.getUTCMonth(), date.getUTCDate(), date.getUTCHours(), date.getUTCMinutes(), date.getUTCSeconds());\n\t\t},\n\t\tparseDate: function (date, format) {\n\t\t\t// raw date may be of type string, number (timestamp) or something else\n\t\t\t// do not check for instanceof Date explicitly, since we may swap native date with different date implementation at some point\n\t\t\tif (date && !date.getFullYear) {\n\t\t\t\tif (typeof(format) !== \"function\") {\n\t\t\t\t\tif (typeof(format) === \"string\") {\n\t\t\t\t\t\tif (format === \"parse_date\" || format === \"xml_date\") {\n\t\t\t\t\t\t\tformat = gantt.defined(gantt.templates.xml_date) ? gantt.templates.xml_date : gantt.templates.parse_date;\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tformat = gantt.defined(gantt.templates[format]) ? gantt.templates[format] : gantt.date.str_to_date(format);\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\t\t\tformat = gantt.defined(gantt.templates.xml_date) ? gantt.templates.xml_date : gantt.templates.parse_date;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tif (date) {\n\t\t\t\t\tdate = format(date);\n\t\t\t\t} else {\n\t\t\t\t\tdate = null;\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn date;\n\t\t}\n\t};\n\treturn dateHelper;\n};","class t{constructor(t){const{url:e,token:s}=t;this._url=e,this._token=s,this._mode=1,this._seed=1,this._queue=[],this.data={},this.api={},this._events={}}headers(){return{Accept:\"application/json\",\"Content-Type\":\"application/json\",\"Remote-Token\":this._token}}fetch(t,e){const s={credentials:\"include\",headers:this.headers()};return e&&(s.method=\"POST\",s.body=e),fetch(t,s).then(t=>t.json())}load(t){return t&&(this._url=t),this.fetch(this._url).then(t=>this.parse(t))}parse(t){const{key:e,websocket:s}=t;e&&(this._token=t.key);for(const e in t.data)this.data[e]=t.data[e];for(const e in t.api){const s=this.api[e]={},i=t.api[e];for(const t in i)s[t]=this._wrapper(e+\".\"+t)}return s&&this.connect(),this}connect(){const t=this._socket;t&&(this._socket=null,t.onclose=function(){},t.close()),this._mode=2,this._socket=function(t,e,s,i){let n=e;\"/\"===n[0]&&(n=document.location.protocol+\"//\"+document.location.host+e);n=n.replace(/^http(s|):/,\"ws$1:\");const o=-1!=n.indexOf(\"?\")?\"&\":\"?\";n=`${n}${o}token=${s}&ws=1`;const r=new WebSocket(n);return r.onclose=()=>setTimeout(()=>t.connect(),2e3),r.onmessage=e=>{const s=JSON.parse(e.data);switch(s.action){case\"result\":t.result(s.body,[]);break;case\"event\":t.fire(s.body.name,s.body.value);break;case\"start\":i();break;default:t.onError(s.data)}},r}(this,this._url,this._token,()=>(this._mode=3,this._send(),this._resubscribe(),this))}_wrapper(t){return function(){const e=[].slice.call(arguments);let s=null;const i=new Promise((i,n)=>{s={data:{id:this._uid(),name:t,args:e},status:1,resolve:i,reject:n},this._queue.push(s)});return this.onCall(s,i),3===this._mode?this._send(s):setTimeout(()=>this._send(),1),i}.bind(this)}_uid(){return(this._seed++).toString()}_send(t){if(2==this._mode)return void setTimeout(()=>this._send(),100);const e=t?[t]:this._queue.filter(t=>1===t.status);if(!e.length)return;const s=e.map(t=>(t.status=2,t.data));3!==this._mode?this.fetch(this._url,JSON.stringify(s)).catch(t=>this.onError(t)).then(t=>this.result(t,s)):this._socket.send(JSON.stringify({action:\"call\",body:s}))}result(t,e){const s={};if(t)for(let e=0;e<t.length;e++)s[t[e].id]=t[e];else for(let t=0;t<e.length;t++)s[e[t].id]={id:e[t].id,error:\"Network Error\",data:null};for(let t=this._queue.length-1;t>=0;t--){const e=this._queue[t],i=s[e.data.id];i&&(this.onResponse(e,i),i.error?e.reject(i.error):e.resolve(i.data),this._queue.splice(t,1))}}on(t,e){const s=this._uid();let i=this._events[t];const n=!!i;return n||(i=this._events[t]=[]),i.push({id:s,handler:e}),n||3!=this._mode||this._socket.send(JSON.stringify({action:\"subscribe\",name:t})),{name:t,id:s}}_resubscribe(){if(3==this._mode)for(const t in this._events)this._socket.send(JSON.stringify({action:\"subscribe\",name:t}))}detach(t){if(!t){if(3==this._mode)for(const t in this._events)this._socket.send(JSON.stringify({action:\"unsubscribe\",key:t}));return void(this._events={})}const{id:e,name:s}=t,i=this._events[s];if(i){const t=i.filter(t=>t.id!=e);t.length?this._events[s]=t:(delete this._events[s],3==this._mode&&this._socket.send(JSON.stringify({action:\"unsubscribe\",name:s})))}}fire(t,e){const s=this._events[t];if(s)for(let t=0;t<s.length;t++)s[t].handler(e)}onError(t){return null}onCall(t,e){}onResponse(t,e){}}export{t as Client};\n//# sourceMappingURL=remote.es6.js.map\n","import * as remote_client from \"remote-client\";\nexport const remoteEvents = function(url, token) {\n    const remote = new remote_client.Client({\n      url,\n      token\n    });\n\n    // temporary patch, as we do not want credentials\n    remote.fetch = function (url, body) {\n      const req = {\n        headers: this.headers()\n      };\n      if (body) {\n        req.method = \"POST\";\n        req.body = body;\n      }\n\n      return fetch(url, req).then((res) => res.json());\n    };\n\n    this._ready = remote.load().then((back) => (this._remote = back));\n\n    function ready() {\n      return this._ready;\n    }\n  \n    function on(name, handler) {\n      this.ready().then((back) => {\n        if (typeof name === \"string\") back.on(name, handler);\n        else {\n          for (const key in name) {\n            back.on(key, name[key]);\n          }\n        }\n      });\n    }\n\n    this.ready = ready;\n    this.on = on;\n  };\n\n","function checkTimeout(host, updPerSecond){\n\tif (!updPerSecond)\n\t\treturn true;\n\t\n\tif (host._on_timeout)\n\t\treturn false;\n\t\n\tvar timeout = Math.ceil(1000/updPerSecond);\n\tif (timeout < 2) return true;\n\n\tsetTimeout(function(){\n\t\tdelete host._on_timeout;\n\t}, timeout);\n\n\thost._on_timeout = true;\n\treturn true;\n}\n\nexport default checkTimeout;","import * as utils from \"../../utils/utils\";\n\nvar StateService = (function(){\n\tvar stateProviders = {};\n\n\tfunction getState(name){\n\t\tvar provider = stateProviders[name];\n\t\tif(provider){\n\t\t\treturn stateProviders[name].method();\n\t\t}else{\n\t\t\tvar res = {};\n\t\t\tfor(var i in stateProviders){\n\t\t\t\tif(!stateProviders[i].internal)\n\t\t\t\t\tutils.mixin(res, stateProviders[i].method(), true);\n\t\t\t}\n\t\t\treturn res;\n\t\t}\n\t}\n\n\tfunction registerProvider(name, provider, internal){\n\t\tstateProviders[name] = { method: provider, internal: internal};\n\t}\n\n\tfunction unregisterProvider(name){\n\t\tdelete stateProviders[name];\n\t}\n\n\treturn {\n\t\tgetState: getState,\n\t\tregisterProvider: registerProvider,\n\t\tunregisterProvider: unregisterProvider\n\t};\n});\n\nexport default StateService;\n\n","// eslint-disable-next-line no-restricted-globals\nexport default Promise;","import * as utils from \"../../utils/utils\";\nimport {replaceValidZeroId} from \"../../utils/helpers\";\n\nvar createTasksDatastoreFacade = function(){\n\treturn {\n\tgetTask: function (id) {\n\t\tid = replaceValidZeroId(id, this.config.root_id);\n\t\tthis.assert(id, \"Invalid argument for gantt.getTask\");\n\t\tvar task = this.$data.tasksStore.getItem(id);\n\t\tthis.assert(task, \"Task not found id=\" + id);\n\t\treturn task;\n\t},\n\tgetTaskByTime: function (from, to) {\n\t\tvar p = this.$data.tasksStore.getItems();\n\n\t\tvar res = [];\n\n\t\tif (!(from || to)) {\n\t\t\tres = p;\n\t\t} else {\n\t\t\tfrom = +from || -Infinity;\n\t\t\tto = +to || Infinity;\n\t\t\tfor (var t = 0; t < p.length; t++){\n\t\t\t\tvar task = p[t];\n\t\t\t\tif (+task.start_date < to && +task.end_date > from)\n\t\t\t\t\tres.push(task);\n\t\t\t}\n\t\t}\n\t\treturn res;\n\t},\n\tisTaskExists: function (id) {\n\t\tif(!this.$data || !this.$data.tasksStore){\n\t\t\treturn false;\n\t\t}\n\t\treturn this.$data.tasksStore.exists(id);\n\t},\n\tupdateTask: function (id, item) {\n\t\tif (!utils.defined(item)) item = this.getTask(id);\n\t\tthis.$data.tasksStore.updateItem(id, item);\n\t\tif(this.isTaskExists(id))\n\t\t\tthis.refreshTask(id);\n\t},\n\taddTask: function (item, parent, index) {\n\t\tif (!utils.defined(item.id))\n\t\t\titem.id = utils.uid();\n\n\t\t//GS-761: assert unique ID\n\t\tif (this.isTaskExists(item.id)){\n\t\t\tvar task = this.getTask(item.id);\n\t\t\tif (task.$index != item.$index) {\n\t\t\t\t// Someone may try to mistakenly add a task with the same ID, and most likely\n\t\t\t\t// use the string format for the dates. Gantt shouldn't break in this scenario\n\t\t\t\tif (item.start_date && typeof item.start_date === \"string\"){\n\t\t\t\t\titem.start_date = this.date.parseDate(item.start_date, \"parse_date\");\n\t\t\t\t}\n\t\t\t\tif (item.end_date && typeof item.end_date === \"string\"){\n\t\t\t\t\titem.end_date = this.date.parseDate(item.end_date, \"parse_date\");\n\t\t\t\t}\n\n\t\t\t\treturn this.$data.tasksStore.updateItem(item.id, item);\n\t\t\t}\n\t\t}\n\n\n\t\tif (!utils.defined(parent)) parent = this.getParent(item) || 0;\n\t\tif (!this.isTaskExists(parent)) parent = this.config.root_id;\n\t\tthis.setParent(item, parent);\n\n\t\t// GS-1583. Save the $open state to the Undo Stack\n\t\tif (this.getState().lightbox && this.isTaskExists(parent)) {\n\t\t\tvar parentObj = this.getTask(parent);\n\t\t\tthis.callEvent(\"onAfterParentExpand\", [parent, parentObj]);\n\t\t}\n\t\treturn this.$data.tasksStore.addItem(item, index, parent);\n\t},\n\tdeleteTask: function (id) {\n\t\tid = replaceValidZeroId(id, this.config.root_id);\n\t\treturn this.$data.tasksStore.removeItem(id);\n\t},\n\tgetTaskCount: function () {\n\t\treturn this.$data.tasksStore.count();\n\t},\n\tgetVisibleTaskCount: function () {\n\t\treturn this.$data.tasksStore.countVisible();\n\t},\n\tgetTaskIndex: function (id) {\n\t\treturn this.$data.tasksStore.getBranchIndex(id);\n\t},\n\tgetGlobalTaskIndex: function (id) {\n\t\tid = replaceValidZeroId(id, this.config.root_id);\n\t\tthis.assert(id, \"Invalid argument\");\n\t\treturn this.$data.tasksStore.getIndexById(id);\n\t},\n\teachTask: function (code, parent, master) {\n\t\treturn this.$data.tasksStore.eachItem(utils.bind(code, master||this), parent);\n\t},\n\teachParent: function (callback, startTask, master) {\n\t\treturn this.$data.tasksStore.eachParent(utils.bind(callback, master || this), startTask);\n\t},\n\tchangeTaskId: function (oldid, newid) {\n\t\tthis.$data.tasksStore.changeId(oldid, newid);\n\t\tvar task = this.$data.tasksStore.getItem(newid);\n\n\t\tvar links = [];\n\n\t\tif (task.$source) {\n\t\t\tlinks = links.concat(task.$source);\n\t\t}\n\t\tif (task.$target) {\n\t\t\tlinks = links.concat(task.$target);\n\t\t}\n\n\t\tfor (var i = 0; i < links.length; i++) {\n\t\t\tvar link = this.getLink(links[i]);\n\t\t\tif (link.source == oldid) {\n\t\t\t\tlink.source = newid;\n\t\t\t}\n\t\t\tif (link.target == oldid) {\n\t\t\t\tlink.target = newid;\n\t\t\t}\n\t\t}\n\t},\n\tcalculateTaskLevel: function (item) {\n\t\treturn this.$data.tasksStore.calculateItemLevel(item);\n\t},\n\tgetNext: function (id) {\n\t\treturn this.$data.tasksStore.getNext(id);\n\t},\n\tgetPrev: function (id) {\n\t\treturn this.$data.tasksStore.getPrev(id);\n\t},\n\tgetParent: function (id) {\n\t\treturn this.$data.tasksStore.getParent(id);\n\t},\n\tsetParent: function (task, new_pid, silent) {\n\t\treturn this.$data.tasksStore.setParent(task, new_pid, silent);\n\t},\n\tgetSiblings: function (id) {\n\t\treturn this.$data.tasksStore.getSiblings(id).slice();\n\t},\n\tgetNextSibling: function (id) {\n\t\treturn this.$data.tasksStore.getNextSibling(id);\n\t},\n\tgetPrevSibling: function (id) {\n\t\treturn this.$data.tasksStore.getPrevSibling(id);\n\t},\n\tgetTaskByIndex: function(index){\n\t\tvar id = this.$data.tasksStore.getIdByIndex(index);\n\t\tif(this.isTaskExists(id)){\n\t\t\treturn this.getTask(id);\n\t\t}else{\n\t\t\treturn null;\n\t\t}\n\t},\n\tgetChildren: function (id) {\n\t\tif(!this.hasChild(id)){\n\t\t\treturn [];\n\t\t}else{\n\t\t\treturn this.$data.tasksStore.getChildren(id).slice();\n\t\t}\n\t},\n\thasChild: function (id) {\n\t\treturn this.$data.tasksStore.hasChild(id);\n\t},\n\topen: function (id) {\n\t\tthis.$data.tasksStore.open(id);\n\t},\n\tclose: function (id) {\n\t\tthis.$data.tasksStore.close(id);\n\t},\n\tmoveTask: function (sid, tindex, parent) {\n\t\tparent = replaceValidZeroId(parent, this.config.root_id);\n\t\treturn this.$data.tasksStore.move.apply(this.$data.tasksStore, arguments);\n\t},\n\tsort: function(field, desc, parent, silent) {\n\t\tvar render = !silent;//4th argument to cancel redraw after sorting\n\n\t\tthis.$data.tasksStore.sort(field, desc, parent);\n\t\tthis.callEvent(\"onAfterSort\", [field, desc, parent]);\n\n\t\tif (render) {\n\t\t\tthis.render();\n\t\t}\n\t}\n};\n};\n\nexport default createTasksDatastoreFacade;\n\n\n","import * as utils from \"../../utils/utils\";\n\nvar $powerArray  = {\n\t$create: function(array){\n\t\treturn utils.mixin(array || [], this);\n\t},\n\t//remove element at specified position\n\t$removeAt:function(pos,len){\n\t\tif (pos>=0) this.splice(pos,(len||1));\n\t},\n\t//find element in collection and remove it\n\t$remove:function(value){\n\t\tthis.$removeAt(this.$find(value));\n\t},\n\t//add element to collection at specific position\n\t$insertAt:function(data,pos){\n\t\tif (!pos && pos!==0) \t//add to the end by default\n\t\t\tthis.push(data);\n\t\telse {\n\t\t\tvar b = this.splice(pos,(this.length-pos));\n\t\t\tthis[pos] = data;\n\t\t\tthis.push.apply(this,b); //reconstruct array without loosing this pointer\n\t\t}\n\t},\n\t//return index of element, -1 if it doesn't exists\n\t$find:function(data){\n\t\tfor (var i=0; i<this.length; i++)\n\t\t\tif (data==this[i]) return i;\n\t\treturn -1;\n\t},\n\t//execute some method for each element of array\n\t$each:function(functor,master){\n\t\tfor (var i=0; i < this.length; i++)\n\t\t\tfunctor.call((master||this),this[i]);\n\t},\n\t//create new array from source, by using results of functor\n\t$map:function(functor,master){\n\t\tfor (var i=0; i < this.length; i++)\n\t\t\tthis[i]=functor.call((master||this),this[i]);\n\t\treturn this;\n\t},\n\t$filter:function(functor, master){\n\t\tfor (var i=0; i < this.length; i++)\n\t\t\tif (!functor.call((master||this),this[i])){\n\t\t\t\tthis.splice(i,1);\n\t\t\t\ti--;\n\t\t\t}\n\t\treturn this;\n\t}\n};\n\nexport default $powerArray;","/**\n * Check the over task or draggble task is placeholder task\n */\n\nexport default function isPlaceholderTask(id, gantt, store, config) {\n\t// return false;\n\tvar config = gantt ? gantt.config : config;\n\tif (config && config.placeholder_task) {\n\t\tif (store.exists(id)){\n\t\t\tvar item = store.getItem(id);\n\t\t\treturn item.type === config.types.placeholder;\n\t\t}\n\t}\n\treturn false;\n};","import powerArray from \"./power_array\";\nimport * as utils from \"../../utils/utils\";\nimport eventable from \"../../utils/eventable\";\nimport isPlaceholderTask from \"../../utils/placeholder_task\";\n\nvar DataStore = function(config){\n\tthis.pull = {};\n\tthis.$initItem = config.initItem;\n\tthis.visibleOrder = powerArray.$create();\n\tthis.fullOrder = powerArray.$create();\n\tthis._skip_refresh = false;\n\tthis._filterRule = null;\n\tthis._searchVisibleOrder = {};\n\tthis._indexRangeCache = {};\n\tthis._getItemsCache = null;\n\tthis.$config = config;\n\teventable(this);\n\n\tthis._attachDataChange(function(){\n\t\tthis._indexRangeCache = {};\n\t\tthis._getItemsCache = null;\n\t\treturn true;\n\t});\n\treturn this;\n};\nDataStore.prototype = {\n\n\t_attachDataChange: function(callback){\n\t\tthis.attachEvent(\"onClearAll\", callback);\n\t\tthis.attachEvent(\"onBeforeParse\", callback);\n\t\tthis.attachEvent(\"onBeforeUpdate\", callback);\n\t\tthis.attachEvent(\"onBeforeDelete\", callback);\n\t\tthis.attachEvent(\"onBeforeAdd\", callback);\n\t\tthis.attachEvent(\"onParse\", callback);\n\t\tthis.attachEvent(\"onBeforeFilter\", callback);\n\t},\n\t_parseInner: function(data){\n\t\tvar item = null,\n\t\t\tloaded = [];\n\t\tfor(var i = 0, len = data.length; i< len; i++){\n\t\t\titem = data[i];\n\t\t\tif(this.$initItem){\n\t\t\t\tif(this.$config.copyOnParse()){\n\t\t\t\t\titem = utils.copy(item);\n\t\t\t\t}\n\t\t\t\titem = this.$initItem(item);\n\t\t\t}\n\t\t\t\n\t\t\tif(this.callEvent(\"onItemLoading\", [item])){\n\t\t\t\tif (!this.pull.hasOwnProperty(item.id)) {\n\t\t\t\t\tthis.fullOrder.push(item.id);\n\t\t\t\t}\n\t\t\t\tloaded.push(item);\n\t\t\t\tthis.pull[item.id] = item;\n\t\t\t}\n\t\t}\n\t\treturn loaded;\n\t},\n\tparse: function(data){\n\t\tif (!this.isSilent()) {\n\t\t\tthis.callEvent(\"onBeforeParse\", [data]);\n\t\t}\n\t\tvar loaded = this._parseInner(data);\n\t\tif (!this.isSilent()) {\n\t\t\tthis.refresh();\n\t\t\tthis.callEvent(\"onParse\", [loaded]);\n\t\t}\n\t},\n\tgetItem: function(id){\n\t\treturn this.pull[id];\n\t},\n\n\t_updateOrder: function(code){\n\t\tcode.call(this.visibleOrder);\n\t\tcode.call(this.fullOrder);\n\t},\n\tupdateItem: function(id, item){\n\t\tif (!utils.defined(item)) item = this.getItem(id);\n\n\t\tif (!this.isSilent()) {\n\t\t\tif (this.callEvent(\"onBeforeUpdate\", [item.id, item]) === false) return false;\n\t\t}\n\t\t// This is how it worked before updating the properties:\n\t\t// this.pull[id]=item;\n\t\tutils.mixin(this.pull[id],item, true);\n\t\tif (!this.isSilent()) {\n\t\t\tthis.callEvent(\"onAfterUpdate\", [item.id, item]);\n\t\t\tthis.callEvent(\"onStoreUpdated\", [item.id, item, \"update\"]);\n\t\t}\n\t},\n\n\t_removeItemInner: function(id){\n\t\t//clear from collections\n\t\t//this.visibleOrder.$remove(id);\n\t\tthis._updateOrder(function(){ this.$remove(id);});\n\t\tdelete this.pull[id];\n\t},\n\n\tremoveItem: function(id){\n\t\t//utils.assert(this.exists(id), \"Not existing ID in remove command\"+id);\n\n\t\tvar obj = this.getItem(id);\t//save for later event\n\t\tif (!this.isSilent()) {\n\t\t\tif (this.callEvent(\"onBeforeDelete\", [obj.id, obj]) === false) return false;\n\t\t}\n\n\t\tthis.callEvent(\"onAfterDeleteConfirmed\", [obj.id, obj]);\n\t\tthis._removeItemInner(id);\n\t\t\n\t\tif (this.isSilent()) {\n\t\t\tthis.callEvent(\"onAfterSilentDelete\", [obj.id, obj]);\n\t\t}\n\n\t\tif (!this.isSilent()) {\n\t\t\tthis.filter();\n\t\t\tthis.callEvent(\"onAfterDelete\", [obj.id, obj]);\n\t\t\t//repaint signal\n\t\t\tthis.callEvent(\"onStoreUpdated\", [obj.id, obj, \"delete\"]);\n\t\t}\n\t},\n\n\t_addItemInner: function(item, index){\n\t\t//in case of treetable order is sent as 3rd parameter\n\t\t//var order = index;\n\n\t\tif(this.exists(item.id)){\n\t\t\tthis.silent(function(){this.updateItem(item.id, item);});\n\t\t}else{\n\t\t\tvar order = this.visibleOrder;\n\n\t\t\t//by default item is added to the end of the list\n\t\t\tvar data_size = order.length;\n\n\t\t\tif (!utils.defined(index) || index < 0)\n\t\t\t\tindex = data_size;\n\t\t\t//check to prevent too big indexes\n\t\t\tif (index > data_size){\n\t\t\t\t//dhx.log(\"Warning\",\"DataStore:add\",\"Index of out of bounds\");\n\t\t\t\tindex = Math.min(order.length,index);\n\t\t\t}\n\t\t}\n\n\n\t\t//gantt.assert(!this.exists(id), \"Not unique ID\");\n\n\t\tthis.pull[item.id]=item;\n\t\tif (!this.isSilent()){\n\t\t\tthis._updateOrder(function(){\n\t\t\t\tif(this.$find(item.id) === -1)\n\t\t\t\t\tthis.$insertAt(item.id,index);\n\t\t\t});\n\t\t}\n\t\tthis.filter();\n\t\t//order.$insertAt(item.id,index);\n\t},\n\n\n\tisVisible: function(id){\n\t\treturn this.visibleOrder.$find(id) > -1;\n\t},\n\tgetVisibleItems: function(){\n\t\treturn this.getIndexRange();\n\t},\n\n\taddItem: function(item, index){\n\t\tif (!utils.defined(item.id))\n\t\t\titem.id = utils.uid();\n\n\t\tif(this.$initItem){\n\t\t\titem = this.$initItem(item);\n\t\t}\n\n\t\tif (!this.isSilent()){\n\t\t\tif (this.callEvent(\"onBeforeAdd\", [item.id, item]) === false) return false;\n\t\t}\n\n\n\t\tthis._addItemInner(item, index);\n\n\t\tif (!this.isSilent()){\n\t\t\tthis.callEvent(\"onAfterAdd\",[item.id, item]);\n\t\t\t//repaint signal\n\t\t\tthis.callEvent(\"onStoreUpdated\",[item.id,item,\"add\"]);\n\t\t}\n\t\treturn item.id;\n\t},\n\n\t_changeIdInner: function(oldId, newId){\n\t\tif(this.pull[oldId])\n\t\t\tthis.pull[newId] = this.pull[oldId];\n\n\t\tvar visibleOrder = this._searchVisibleOrder[oldId];\n\t\tthis.pull[newId].id = newId;\n\t\tthis._updateOrder(function(){\n\t\t\tthis[this.$find(oldId)] = newId;\n\t\t});\n\t\tthis._searchVisibleOrder[newId] = visibleOrder;\n\t\tdelete this._searchVisibleOrder[oldId];\n\n\t\t//this.visibleOrder[this.visibleOrder.$find(oldId)]=newId;\n\t\tdelete this.pull[oldId];\n\t},\n\tchangeId: function(oldId, newId){\n\t\tthis._changeIdInner(oldId, newId);\n\n\t\tthis.callEvent(\"onIdChange\", [oldId, newId]);\n\n\t},\n\texists: function(id){\n\t\treturn !!(this.pull[id]);\n\t},\n\n\t_moveInner: function(sindex, tindex){\n\t\tvar id = this.getIdByIndex(sindex);\n\n\t\tthis._updateOrder(function(){\n\t\t\tthis.$removeAt(sindex);\n\t\t\tthis.$insertAt(id,Math.min(this.length, tindex));\n\t\t});\n\t\t//this.visibleOrder.$removeAt(sindex);\t//remove at old position\n\t\t//if (sindex<tindex) tindex--;\t//correct shift, caused by element removing\n\t\t//this.visibleOrder.$insertAt(id,Math.min(this.visibleOrder.length, tindex));\t//insert at new position\n\t},\n\n\tmove: function(sindex, tindex){\n\t\t//gantt.assert(sindex>=0 && tindex>=0, \"DataStore::move\",\"Incorrect indexes\");\n\n\t\tvar id = this.getIdByIndex(sindex);\n\t\tvar obj = this.getItem(id);\n\t\tthis._moveInner(sindex, tindex);\n\n\t\tif (!this.isSilent()) {\n\t\t\t//repaint signal\n\t\t\tthis.callEvent(\"onStoreUpdated\", [obj.id, obj, \"move\"]);\n\t\t}\n\t},\n\tclearAll: function(){\n\t\tif(this.$destroyed){\n\t\t\treturn;\n\t\t}\n\t\t// GS-956 We need to unselect the resource as its ID is cached\n\t\tthis.silent(function(){\n\t\t\tthis.unselect();\n\t\t});\n\t\tthis.pull = {};\n\t\tthis.visibleOrder = powerArray.$create();\n\t\tthis.fullOrder = powerArray.$create();\n\t\tif (this.isSilent()) return;\n\t\tthis.callEvent(\"onClearAll\",[]);\n\t\tthis.refresh();\n\t},\n\n\tsilent:function(code, master){\n\t\tvar alreadySilent = false;\n\t\tif(this.isSilent()) {\n\t\t\talreadySilent = true;\n\t\t}\n\t\tthis._skip_refresh = true;\n\t\tcode.call(master||this);\n\t\t\n\t\tif (!alreadySilent) {\n\t\t\tthis._skip_refresh = false;\n\t\t}\n\t},\n\tisSilent: function(){\n\t\treturn !!this._skip_refresh;\n\t},\n\n\tarraysEqual: function (arr1, arr2) {\n\t\tif(arr1.length !== arr2.length)\n\t\t\treturn false;\n\t\tfor(var i = 0; i < arr1.length; i++) {\n\t\t\tif(arr1[i] !== arr2[i])\n\t\t\t\treturn false;\n\t\t}\n\n\t\treturn true;\n\t},\n\n\trefresh: function(id, quick){\n\t\tif (this.isSilent()) return;\n\n\t\tvar item;\n\t\tif(id){\n\t\t\titem = this.getItem(id);\n\t\t}\n\n\t\tvar args;\n\t\tif (id){\n\t\t\targs = [id, item, \"paint\"];\n\t\t}else{\n\t\t\targs = [null,null,null];\n\t\t}\n\n\t\tif(this.callEvent(\"onBeforeStoreUpdate\", args) === false){\n\t\t\treturn;\n\t\t}\n\n\t\tvar skipFilter = this._quick_refresh && !this._mark_recompute;\n\t\tthis._mark_recompute = false;\n\t\tif(id){\n\t\t\t// if item changes visible order (e.g. expand-collapse branch) - do a complete repaint\n\t\t\tif(!quick && !skipFilter){\n\t\t\t\tvar oldOrder = this.visibleOrder;\n\t\t\t\tthis.filter();\n\t\t\t\tif(!this.arraysEqual(oldOrder, this.visibleOrder)){\n\t\t\t\t\tid = undefined;\n\t\t\t\t}\n\t\t\t}\n\n\t\t}else if(!skipFilter){\n\t\t\tthis.filter();\n\t\t}\n\n\t\tif (id){\n\t\t\targs = [id, item, \"paint\"];\n\t\t}else{\n\t\t\targs = [null,null,null];\n\t\t}\n\n\t\tthis.callEvent(\"onStoreUpdated\",args);\n\t},\n\n\tcount: function(){\n\t\treturn this.fullOrder.length;\n\t},\n\tcountVisible: function(){\n\t\treturn this.visibleOrder.length;\n\t},\n\n\tsort: function(sort){},\n\n\tserialize: function(){},\n\n\teachItem: function(code){\n\t\tfor (var i=0; i<this.fullOrder.length; i++) {\n\t\t\tvar item = this.getItem(this.fullOrder[i]);\n\t\t\tcode.call(this, item);\n\t\t}\n\t},\n\n\tfind: function(filter) {\n\t\tvar result = [];\n\t\tthis.eachItem(function(item) {\n\t\t\tif(filter(item)){\n\t\t\t\tresult.push(item);\n\t\t\t}\n\t\t});\n\t\treturn result;\n\t},\n\n\tfilter: function(rule){\n\t\tif (!this.isSilent()) {\n\t\t\tthis.callEvent(\"onBeforeFilter\", []);\n\t\t}\n\t\tthis.callEvent(\"onPreFilter\", []);\n\t\tvar filteredOrder = powerArray.$create();\n\t\tvar placeholderIds = [];\n\t\tthis.eachItem(function(item){\n\t\t\tif(this.callEvent(\"onFilterItem\", [item.id, item])){\n\t\t\t\tif(isPlaceholderTask(item.id, null, this, this._ganttConfig)){\n\t\t\t\t\tplaceholderIds.push(item.id);\n\t\t\t\t} else {\n\t\t\t\t\tfilteredOrder.push(item.id);\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n\t\tfor(var i = 0; i < placeholderIds.length; i++){\n\t\t\tfilteredOrder.push(placeholderIds[i]);\n\t\t}\n\n\t\tthis.visibleOrder = filteredOrder;\n\t\tthis._searchVisibleOrder = {};\n\t\tfor(var i = 0; i < this.visibleOrder.length; i++){\n\t\t\tthis._searchVisibleOrder[this.visibleOrder[i]] = i;\n\t\t}\n\t\tif (!this.isSilent()) {\n\t\t\tthis.callEvent(\"onFilter\", []);\n\t\t}\n\t},\n\n\tgetIndexRange: function(from, to){\n\t\tvar max = Math.min((to||Infinity),this.countVisible()-1);\n\t\tvar min = from||0;\n\n\t\tvar cacheKey = min + '-' + max;\n\t\tif(this._indexRangeCache[cacheKey]){\n\t\t\treturn this._indexRangeCache[cacheKey].slice();\n\t\t}\n\n\t\tvar ret= [];\n\t\tfor (var i=min; i <= max; i++)\n\t\t\tret.push(this.getItem(this.visibleOrder[i]));\n\n\t\tthis._indexRangeCache[cacheKey] = ret.slice();\n\t\treturn ret;\n\t},\n\tgetItems: function(){\n\t\tif(this._getItemsCache){\n\t\t\treturn this._getItemsCache.slice();\n\t\t}\n\n\t\tvar res = [];\n\t\tfor(var i in this.pull){\n\t\t\tres.push(this.pull[i]);\n\t\t}\n\t\tthis._getItemsCache = res.slice();\n\n\t\treturn res;\n\t},\n\n\tgetIdByIndex: function(index){\n\t\treturn this.visibleOrder[index];\n\t},\n\tgetIndexById: function(id){\n\t\tvar res = this._searchVisibleOrder[id];\n\t\tif(res === undefined){\n\t\t\tres = -1;\n\t\t}\n\t\treturn res;\n\t},\n\t_getNullIfUndefined: function(value){\n\t\tif(value === undefined){\n\t\t\treturn null;\n\t\t}else{\n\t\t\treturn value;\n\t\t}\n\t},\n\tgetFirst: function(){\n\t\treturn this._getNullIfUndefined(this.visibleOrder[0]);\n\t},\n\tgetLast: function(){\n\t\treturn this._getNullIfUndefined(this.visibleOrder[this.visibleOrder.length-1]);\n\t},\n\tgetNext: function(id){\n\t\treturn this._getNullIfUndefined(this.visibleOrder[this.getIndexById(id) + 1]);\n\t},\n\tgetPrev: function(id){\n\t\treturn this._getNullIfUndefined(this.visibleOrder[this.getIndexById(id) - 1]);\n\t},\n\tdestructor: function(){\n\t\tthis.callEvent(\"onDestroy\", []);\n\t\tthis.detachAllEvents();\n\t\tthis.$destroyed = true;\n\t\tthis.pull = null;\n\t\tthis.$initItem = null;\n\t\tthis.visibleOrder = null;\n\t\tthis.fullOrder = null;\n\t\tthis._skip_refresh = null;\n\t\tthis._filterRule = null;\n\t\tthis._searchVisibleOrder = null;\n\t\tthis._indexRangeCache = {};\n\t}\n};\n\nexport default DataStore;","import powerArray from \"./power_array\";\nimport * as utils from \"../../utils/utils\";\nimport * as helpers from \"../../utils/helpers\";\nimport DataStore from \"./datastore\";\nimport isPlaceholderTask from \"../../utils/placeholder_task\";\nimport {replaceValidZeroId} from \"../../utils/helpers\";\n\nvar TreeDataStore = function(config){\n\tDataStore.apply(this, [config]);\n\tthis._branches = {};\n\n\tthis.pull = {};\n\t//GS-761 Update existing item instead of adding it to the new position\n\tthis.$initItem = function (item){\n\t\tvar loadedItem = item;\n\t\tif(config.initItem){\n\t\t\tloadedItem = config.initItem(loadedItem);\n\t\t}\n\t\tvar existingItem = this.getItem(item.id);\n\t\tif(existingItem && existingItem.parent != loadedItem.parent){\n\t\t\tthis.move(loadedItem.id, loadedItem.$index || -1, loadedItem.parent || this._ganttConfig.root_id);\n\t\t}\n\t\treturn loadedItem;\n\t};\n\tthis.$parentProperty = config.parentProperty || \"parent\";\n\n\tif(typeof config.rootId !== \"function\"){\n\t\tthis.$getRootId = (function(val){\n\t\t\treturn function(){return val;};\n\t\t})(config.rootId || 0);\n\t}else{\n\t\tthis.$getRootId = config.rootId;\n\t}\n\n\t// TODO: replace with live reference to gantt config\n\tthis.$openInitially = config.openInitially;\n\n\tthis.visibleOrder = powerArray.$create();\n\tthis.fullOrder = powerArray.$create();\n\tthis._searchVisibleOrder = {};\n\tthis._indexRangeCache = {};\n\tthis._eachItemMainRangeCache = null;\n\tthis._getItemsCache = null;\n\tthis._skip_refresh = false;\n\n\tthis._ganttConfig = null;\n\tif(config.getConfig){\n\t\tthis._ganttConfig = config.getConfig();\n\t}\n\n\tvar splitParents = {};\n\tvar splitItems = {};\n\n\tvar taskOpenState = {};\n\tvar taskVisibility = {};\n\tvar haveSplitItems = false;\n\n\tthis._attachDataChange(function(){\n\t\tthis._indexRangeCache = {};\n\t\tthis._eachItemMainRangeCache = null;\n\t\tthis._getItemsCache = null;\n\t\treturn true;\n\t});\n\n\tthis.attachEvent(\"onPreFilter\", function(){\n\t\tthis._indexRangeCache = {};\n\t\tthis._eachItemMainRangeCache = null;\n\n\t\tsplitParents = {};\n\t\tsplitItems = {};\n\t\ttaskOpenState = {};\n\t\ttaskVisibility = {};\n\t\thaveSplitItems = false;\n\n\t\tthis.eachItem(function(item){\n\t\t\tvar parent = this.getParent(item.id);\n\t\t\tif(item.$open && taskOpenState[parent] !== false){\n\t\t\t\ttaskOpenState[item.id] = true;\n\t\t\t}else{\n\t\t\t\ttaskOpenState[item.id] = false;\n\t\t\t}\n\n\t\t\tif(this._isSplitItem(item)){\n\t\t\t\thaveSplitItems = true;\n\t\t\t\tsplitParents[item.id] = true;\n\t\t\t\tsplitItems[item.id] = true;\n\t\t\t}\n\n\n\t\t\tif(haveSplitItems && splitItems[parent]){\n\t\t\t\tsplitItems[item.id] = true;\n\t\t\t}\n\n\n\t\t\tif(taskOpenState[parent] || taskOpenState[parent] === undefined){\n\t\t\t\ttaskVisibility[item.id] = true;\n\t\t\t}else{\n\t\t\t\ttaskVisibility[item.id] = false;\n\t\t\t}\n\t\t});\n\t});\n\n\tthis.attachEvent(\"onFilterItem\", function(id, item){\n\n\t\tvar canOpenSplitTasks = false;\n\t\tif(this._ganttConfig){\n\t\t\tvar canOpenSplitTasks = this._ganttConfig.open_split_tasks;\n\t\t}\n\n\t\tvar open = taskVisibility[item.id];\n\n\t\tif(haveSplitItems){\n\t\t\tif(open && splitItems[item.id] && !splitParents[item.id]){\n\t\t\t\topen = !!canOpenSplitTasks;\n\t\t\t}\n\n\t\t\tif(splitItems[item.id] && !splitParents[item.id]){\n\t\t\t\titem.$split_subtask = true;\n\t\t\t}\n\t\t}\n\n\t\titem.$expanded_branch = !!taskVisibility[item.id];\n\n\t\treturn !!open;\n\t});\n\n\tthis.attachEvent(\"onFilter\", function(){\n\t\tsplitParents = {};\n\t\tsplitItems = {};\n\n\t\ttaskOpenState = {};\n\t\ttaskVisibility = {};\n\t});\n\n\treturn this;\n};\n\nTreeDataStore.prototype = utils.mixin({\n\n\t\t_buildTree: function(data){\n\t\t\tvar item = null;\n\t\t\tvar rootId = this.$getRootId();\n\t\t\tfor (var i = 0, len = data.length; i < len; i++){\n\t\t\t\titem = data[i];\n\t\t\t\tthis.setParent(item, replaceValidZeroId(this.getParent(item), rootId) || rootId);\n\t\t\t}\n\n\t\t\t// calculating $level for each item\n\t\t\tfor (var i = 0, len = data.length; i < len; i++){\n\t\t\t\titem = data[i];\n\t\t\t\tthis._add_branch(item);\n\t\t\t\titem.$level = this.calculateItemLevel(item);\n\t\t\t\titem.$local_index = this.getBranchIndex(item.id);\n\n\t\t\t\tif (!utils.defined(item.$open)) {\n\t\t\t\t\titem.$open = utils.defined(item.open) ? item.open : this.$openInitially();\n\t\t\t\t}\n\n\t\t\t}\n\t\t\tthis._updateOrder();\n\t\t},\n\t\t_isSplitItem: function(item){\n\t\t\treturn (item.render == \"split\" && this.hasChild(item.id));\n\t\t},\n\t\tparse: function(data){\n\t\t\tif (!this._skip_refresh) {\n\t\t\t\tthis.callEvent(\"onBeforeParse\", [data]);\n\t\t\t}\n\t\t\tvar loaded = this._parseInner(data);\n\t\t\tthis._buildTree(loaded);\n\t\t\tthis.filter();\n\t\t\tif (!this._skip_refresh) {\n\t\t\t\tthis.callEvent(\"onParse\", [loaded]);\n\t\t\t}\n\t\t},\n\n\t\t_addItemInner: function(item, index){\n\n\t\t\tvar parent = this.getParent(item);\n\n\t\t\tif(!utils.defined(parent)){\n\t\t\t\tparent = this.$getRootId();\n\t\t\t\tthis.setParent(item, parent);\n\t\t\t}\n\n\t\t\tvar parentIndex = this.getIndexById(parent);\n\t\t\tvar targetIndex = parentIndex + Math.min(Math.max(index, 0), this.visibleOrder.length);\n\n\t\t\tif(targetIndex*1 !== targetIndex){\n\t\t\t\ttargetIndex = undefined;\n\t\t\t}\n\t\t\tDataStore.prototype._addItemInner.call(this, item, targetIndex);\n\t\t\tthis.setParent(item, parent);\n\n\t\t\tif(item.hasOwnProperty(\"$rendered_parent\")){\n\t\t\t\tthis._move_branch(item, item.$rendered_parent);\n\t\t\t}\n\t\t\tthis._add_branch(item, index);\n\t\t},\n\t\t_changeIdInner: function(oldId, newId){\n\t\t\tvar children = this.getChildren(oldId);\n\t\t\tvar visibleOrder = this._searchVisibleOrder[oldId];\n\n\t\t\tDataStore.prototype._changeIdInner.call(this, oldId, newId);\n\n\t\t\tvar parent = this.getParent(newId);\n\n\t\t\tthis._replace_branch_child(parent, oldId, newId);\n\n\t\t\tif(this._branches[oldId]){\n\t\t\t\tthis._branches[newId] = this._branches[oldId];\n\t\t\t}\n\t\t\tfor(var i = 0; i < children.length; i++){\n\t\t\t\tvar child = this.getItem(children[i]);\n\t\t\t\tchild[this.$parentProperty] = newId;\n\t\t\t\tchild.$rendered_parent = newId;\n\t\t\t}\n\n\t\t\tthis._searchVisibleOrder[newId] = visibleOrder;\n\t\t\tdelete this._branches[oldId];\n\t\t},\n\n\t\t_traverseBranches: function(code, parent){\n\t\t\tif (!utils.defined(parent)) {\n\t\t\t\tparent = this.$getRootId();\n\t\t\t}\n\t\t\tvar branch = this._branches[parent];\n\t\t\tif (branch) {\n\t\t\t\tfor (var i = 0; i < branch.length; i++) {\n\t\t\t\t\tvar itemId = branch[i];\n\t\t\t\t\tcode.call(this, itemId);\n\t\t\t\t\tif (this._branches[itemId])\n\t\t\t\t\t\tthis._traverseBranches(code, itemId);\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\n\t\t_updateOrder: function(code){\n\n\t\t\tthis.fullOrder = powerArray.$create();\n\t\t\tthis._traverseBranches(function(taskId){\n\t\t\t\tthis.fullOrder.push(taskId);\n\t\t\t});\n\n\t\t\tif(code)\n\t\t\t\tDataStore.prototype._updateOrder.call(this, code);\n\t\t},\n\n\t\t_removeItemInner: function(id){\n\n\t\t\tvar items = [];\n\t\t\tthis.eachItem(function(child){\n\t\t\t\titems.push(child);\n\t\t\t}, id);\n\n\t\t\titems.push(this.getItem(id));\n\n\t\t\tfor(var i = 0; i < items.length; i++){\n\n\t\t\t\tthis._move_branch(items[i], this.getParent(items[i]), null);\n\t\t\t\tDataStore.prototype._removeItemInner.call(this, items[i].id);\n\t\t\t\tthis._move_branch(items[i], this.getParent(items[i]), null);\n\t\t\t}\n\t\t},\n\n\t\tmove: function(sid, tindex, parent){\n\t\t\t//target id as 4th parameter\n\t\t\tvar id = arguments[3];\n\t\t\tvar config = this._ganttConfig || {};\n\t\t\tvar root_id = config.root_id || 0;\n\t\t\tid = replaceValidZeroId(id, root_id);\n\t\t\tif (id) {\n\t\t\t\tif (id === sid) return;\n\n\t\t\t\tparent = this.getParent(id);\n\t\t\t\ttindex = this.getBranchIndex(id);\n\t\t\t}\n\t\t\tif(sid == parent){\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tif (!utils.defined(parent)) {\n\t\t\t\tparent = this.$getRootId();\n\t\t\t}\n\t\t\tvar source = this.getItem(sid);\n\t\t\tvar source_pid = this.getParent(source.id);\n\n\t\t\tvar tbranch = this.getChildren(parent);\n\n\t\t\tif (tindex == -1)\n\t\t\t\ttindex = tbranch.length + 1;\n\t\t\tif (source_pid == parent) {\n\t\t\t\tvar sindex = this.getBranchIndex(sid);\n\t\t\t\tif (sindex == tindex) return;\n\t\t\t}\n\n\t\t\tif(this.callEvent(\"onBeforeItemMove\", [sid, parent, tindex]) === false)\n\t\t\t\treturn false;\n\n\t\t\tvar placeholderIds = [];\n\t\t\tfor(var i = 0; i < tbranch.length; i++){\n\t\t\t\tif (isPlaceholderTask(tbranch[i], null, this, this._ganttConfig)){\n\t\t\t\t\tplaceholderIds.push(tbranch[i]);\n\t\t\t\t\ttbranch.splice(i, 1);\n\t\t\t\t\ti--;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tthis._replace_branch_child(source_pid, sid);\n\t\t\ttbranch = this.getChildren(parent);\n\n\t\t\tvar tid = tbranch[tindex];\n\t\t\ttid = replaceValidZeroId(tid, root_id);\n\t\t\tif (!tid) //adding as last element\n\t\t\t\ttbranch.push(sid);\n\t\t\telse\n\t\t\t\ttbranch = tbranch.slice(0, tindex).concat([ sid ]).concat(tbranch.slice(tindex));\n\n\t\t\tif (placeholderIds.length){\n\t\t\t\ttbranch = tbranch.concat(placeholderIds);\n\t\t\t}\n\t\t\t// GS-2423 to return initial parent to the task before it will be moved\n\t\t\tif (source.$rendered_parent !== source_pid && source_pid !== parent){\n\t\t\t\tsource.$rendered_parent = source_pid;\n\t\t\t}\n\t\t\tthis.setParent(source, parent);\n\t\t\tthis._branches[parent] = tbranch;\n\n\t\t\tvar diff = this.calculateItemLevel(source) - source.$level;\n\t\t\tsource.$level += diff;\n\t\t\tthis.eachItem(function(item){\n\t\t\t\titem.$level += diff;\n\t\t\t}, source.id, this);\n\n\n\t\t\tthis._moveInner(this.getIndexById(sid), this.getIndexById(parent) + tindex);\n\n\t\t\tthis.callEvent(\"onAfterItemMove\", [sid, parent, tindex]);\n\t\t\tthis.refresh();\n\t\t},\n\n\t\tgetBranchIndex: function(id){\n\t\t\tvar branch = this.getChildren(this.getParent(id));\n\t\t\tlet index = branch.indexOf(id + \"\");\n\t\t\tif (index == -1){\n\t\t\t\tindex = branch.indexOf(+id);\n\t\t\t}\n\t\t\treturn index;\n\t\t},\n\t\thasChild: function(id){\n\t\t\tvar branch = this._branches[id];\n\t\t\treturn branch && branch.length;\n\t\t},\n\t\tgetChildren: function(id){\n\t\t\tvar branch = this._branches[id];\n\t\t\treturn branch ? branch : powerArray.$create();\n\t\t},\n\n\t\tisChildOf: function(childId, parentId){\n\t\t\tif (!this.exists(childId))\n\t\t\t\treturn false;\n\t\t\tif (parentId === this.$getRootId())\n\t\t\t\treturn true;\n\n\t\t\tif (!this.hasChild(parentId))\n\t\t\t\treturn false;\n\n\t\t\tvar item = this.getItem(childId);\n\t\t\tvar pid = this.getParent(childId);\n\n\t\t\tvar parent = this.getItem(parentId);\n\t\t\tif(parent.$level >= item.$level){\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\twhile (item && this.exists(pid)) {\n\t\t\t\titem = this.getItem(pid);\n\n\t\t\t\tif (item && item.id == parentId)\n\t\t\t\t\treturn true;\n\t\t\t\tpid = this.getParent(item);\n\t\t\t}\n\t\t\treturn false;\n\t\t},\n\n\t\tgetSiblings: function(id){\n\t\t\tif(!this.exists(id)){\n\t\t\t\treturn powerArray.$create();\n\t\t\t}\n\t\t\tvar parent = this.getParent(id);\n\t\t\treturn this.getChildren(parent);\n\n\t\t},\n\t\tgetNextSibling: function(id){\n\t\t\tvar siblings = this.getSiblings(id);\n\t\t\tfor(var i= 0, len = siblings.length; i < len; i++){\n\t\t\t\tif(siblings[i] == id){\n\t\t\t\t\tvar nextSibling = siblings[i+1];\n\t\t\t\t\tif (nextSibling === 0 && i > 0){\n\t\t\t\t\t\tnextSibling = \"0\";\n\t\t\t\t\t}\n\t\t\t\t\treturn nextSibling || null;\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn null;\n\t\t},\n\t\tgetPrevSibling: function(id){\n\t\t\tvar siblings = this.getSiblings(id);\n\t\t\tfor(var i= 0, len = siblings.length; i < len; i++){\n\t\t\t\tif(siblings[i] == id){\n\t\t\t\t\tvar previousSibling = siblings[i-1];\n\t\t\t\t\tif (previousSibling === 0 && i > 0){\n\t\t\t\t\t\tpreviousSibling = \"0\";\n\t\t\t\t\t}\n\t\t\t\t\treturn previousSibling || null;\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn null;\n\t\t},\n\t\tgetParent: function(id){\n\t\t\tvar item = null;\n\t\t\tif(id.id !== undefined){\n\t\t\t\titem = id;\n\t\t\t}else{\n\t\t\t\titem = this.getItem(id);\n\t\t\t}\n\n\t\t\tvar parent;\n\t\t\tif(item){\n\t\t\t\tparent = item[this.$parentProperty];\n\t\t\t}else{\n\t\t\t\tparent = this.$getRootId();\n\t\t\t}\n\t\t\treturn parent;\n\n\t\t},\n\n\t\tclearAll: function(){\n\t\t\tthis._branches = {};\n\t\t\tDataStore.prototype.clearAll.call(this);\n\t\t},\n\n\t\tcalculateItemLevel: function(item){\n\t\t\tvar level = 0;\n\t\t\tthis.eachParent(function(){\n\t\t\t\tlevel++;\n\t\t\t}, item);\n\t\t\treturn level;\n\t\t},\n\n\t\t_setParentInner: function(item, new_pid, silent){\n\t\t\tif(!silent){\n\t\t\t\tif(item.hasOwnProperty(\"$rendered_parent\")){\n\t\t\t\t\tthis._move_branch(item, item.$rendered_parent, new_pid);\n\t\t\t\t}else{\n\t\t\t\t\tthis._move_branch(item, item[this.$parentProperty], new_pid);\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t\tsetParent: function(item, new_pid, silent){\n\t\t\tthis._setParentInner(item, new_pid, silent);\n\n\t\t\titem[this.$parentProperty] = new_pid;\n\t\t},\n\n\t\t_eachItemCached: function(code, cache){\n\t\t\tfor(var i = 0, len = cache.length; i < len; i++){\n\t\t\t\tcode.call(this, cache[i]);\n\t\t\t}\n\t\t},\n\t\t_eachItemIterate: function(code, startId, cache){\n\t\t\tvar itemsStack = this.getChildren(startId);\n\t\t\tif(itemsStack.length){\n\t\t\t\titemsStack = itemsStack.slice().reverse();\n\t\t\t}\n\t\t\twhile(itemsStack.length){\n\t\t\t\tvar itemId = itemsStack.pop();\n\t\t\t\tvar item = this.getItem(itemId);\n\t\t\t\tcode.call(this, item);\n\t\t\t\tif(cache){\n\t\t\t\t\tcache.push(item);\n\t\t\t\t}\n\n\t\t\t\tif(this.hasChild(item.id)){\n\t\t\t\t\tvar children = this.getChildren(item.id);\n\t\t\t\t\tvar len = children.length;\n\t\t\t\t\tfor(var i = len - 1; i >= 0; i--){\n\t\t\t\t\t\titemsStack.push(children[i]);\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t}\n\t\t},\n\n\t\teachItem: function(code, parent){\n\t\t\tvar rootId = this.$getRootId();\n\t\t\tif (!utils.defined(parent)) {\n\t\t\t\tparent = rootId;\n\t\t\t}\n\t\t\tvar startId = replaceValidZeroId(parent, rootId) || rootId;\n\n\t\t\tvar useCache = false;\n\t\t\tvar buildCache = false;\n\t\t\tvar cache = null;\n\t\t\tif(startId === rootId){\n\t\t\t\tif(this._eachItemMainRangeCache){\n\t\t\t\t\tuseCache = true;\n\t\t\t\t\tcache = this._eachItemMainRangeCache;\n\t\t\t\t}else{\n\t\t\t\t\tbuildCache = true;\n\t\t\t\t\tcache = this._eachItemMainRangeCache = [];\n\t\t\t\t}\n\t\t\t}\n\t\t\tif(useCache){\n\t\t\t\tthis._eachItemCached(code, cache);\n\t\t\t}else{\n\t\t\t\tthis._eachItemIterate(code, startId, buildCache ? cache : null);\n\t\t\t}\n\t\t},\n\t\teachParent: function(code, startItem) {\n\t\t\tvar parentsHash = {};\n\t\t\tvar item = startItem;\n\t\t\tvar parent = this.getParent(item);\n\n\t\t\twhile (this.exists(parent)) {\n\t\t\t\tif (parentsHash[parent]) {\n\t\t\t\t\tthrow new Error(\"Invalid tasks tree. Cyclic reference has been detected on task \" + parent);\n\t\t\t\t}\n\t\t\t\tparentsHash[parent] = true;\n\t\t\t\titem = this.getItem(parent);\n\t\t\t\tcode.call(this, item);\n\t\t\t\tparent = this.getParent(item);\n\t\t\t}\n\t\t},\n\t\t_add_branch: function(item, index, parent){\n\t\t\tvar pid = parent === undefined ? this.getParent(item) : parent;\n\t\t\tif (!this.hasChild(pid))\n\t\t\t\tthis._branches[pid] = powerArray.$create();\n\t\t\tvar branch = this.getChildren(pid);\n\t\t\tvar added_already = branch.indexOf(item.id + \"\") > -1 || branch.indexOf(+item.id) > -1;\n\t\t\tif(!added_already){\n\t\t\t\tif(index*1 == index){\n\n\t\t\t\t\tbranch.splice(index, 0, item.id);\n\t\t\t\t}else{\n\t\t\t\t\tbranch.push(item.id);\n\t\t\t\t}\n\n\t\t\t\titem.$rendered_parent = pid;\n\t\t\t}\n\t\t},\n\t\t_move_branch: function(item, old_parent, new_parent){\n\t\t\tthis._eachItemMainRangeCache = null;\n\t\t\t//this.setParent(item, new_parent);\n\t\t\t//this._sync_parent(task);\n\t\t\tthis._replace_branch_child(old_parent, item.id);\n\t\t\tif(this.exists(new_parent) || new_parent == this.$getRootId()){\n\n\t\t\t\tthis._add_branch(item, undefined, new_parent);\n\t\t\t}else{\n\t\t\t\tdelete this._branches[item.id];\n\t\t\t}\n\t\t\titem.$level =  this.calculateItemLevel(item);\n\t\t\tthis.eachItem(function(child){\n\t\t\t\tchild.$level = this.calculateItemLevel(child);\n\t\t\t}, item.id);\n\t\t},\n\n\t\t_replace_branch_child: function(node, old_id, new_id){\n\t\t\tvar branch = this.getChildren(node);\n\t\t\tif (branch && node !== undefined){\n\t\t\t\tvar newbranch = powerArray.$create();\n\n\t\t\t\tlet index = branch.indexOf(old_id + \"\");\n\t\t\t\tif (index == -1 && !isNaN(+old_id)){\n\t\t\t\t\tindex = branch.indexOf(+old_id);\n\t\t\t\t} \n\n\t\t\t\tif (index > -1){\n\t\t\t\t\tif (new_id){\n\t\t\t\t\t\tbranch.splice(index, 1, new_id);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tbranch.splice(index, 1);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tnewbranch = branch;\n\n\t\t\t\tthis._branches[node] = newbranch;\n\t\t\t}\n\n\t\t},\n\n\t\tsort: function(field, desc, parent){\n\t\t\tif (!this.exists(parent)) {\n\t\t\t\tparent = this.$getRootId();\n\t\t\t}\n\n\t\t\tif (!field) field = \"order\";\n\t\t\tvar criteria = (typeof(field) == \"string\") ? (function(a, b) {\n\t\t\t\tif (a[field] == b[field] ||\n\t\t\t\t\t(helpers.isDate(a[field]) && helpers.isDate(b[field]) && a[field].valueOf() == b[field].valueOf()))\n\t\t\t\t{\n\t\t\t\t\treturn 0;\n\t\t\t\t}\n\n\t\t\t\tvar result = a[field] > b[field];\n\t\t\t\treturn result ? 1 : -1;\n\t\t\t}) : field;\n\n\t\t\tif (desc) {\n\t\t\t\tvar original_criteria = criteria;\n\t\t\t\tcriteria = function (a, b) {\n\t\t\t\t\treturn original_criteria(b, a);\n\t\t\t\t};\n\t\t\t}\n\n\t\t\tvar els = this.getChildren(parent);\n\n\t\t\tif (els){\n\t\t\t\tvar temp = [];\n\t\t\t\tfor (var i = els.length - 1; i >= 0; i--)\n\t\t\t\t\ttemp[i] = this.getItem(els[i]);\n\n\t\t\t\ttemp.sort(criteria);\n\n\t\t\t\tfor (var i = 0; i < temp.length; i++) {\n\t\t\t\t\tels[i] = temp[i].id;\n\t\t\t\t\tthis.sort(field, desc, els[i]);\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\n\t\tfilter: function(rule){\n\t\t\tfor(let i in this.pull){\n\t\t\t\tconst renderedParent = this.pull[i].$rendered_parent;\n\t\t\t\tconst actualParent = this.getParent(this.pull[i]);\n\t\t\t\tif(renderedParent !== actualParent){\n\t\t\t\t\tthis._move_branch(this.pull[i], renderedParent, actualParent);\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn DataStore.prototype.filter.apply(this, arguments);\n\t\t},\n\n\t\topen: function(id){\n\t\t\tif(this.exists(id)){\n\t\t\t\tthis.getItem(id).$open = true;\n\t\t\t\t// GS-2170. Do not recalculate the indexes and dates as they will be recalculated later\n\t\t\t\tthis._skipTaskRecalculation = true;\n\t\t\t\tthis.callEvent(\"onItemOpen\", [id]);\n\t\t\t}\n\t\t},\n\n\t\tclose: function(id){\n\t\t\tif(this.exists(id)){\n\t\t\t\tthis.getItem(id).$open = false;\n\t\t\t\t// GS-2170. Do not recalculate the indexes and dates as they will be recalculated later\n\t\t\t\tthis._skipTaskRecalculation = true;\n\t\t\t\tthis.callEvent(\"onItemClose\", [id]);\n\t\t\t}\n\t\t},\n\n\t\tdestructor: function(){\n\t\t\tDataStore.prototype.destructor.call(this);\n\t\t\tthis._branches = null;\n\t\t\tthis._indexRangeCache = {};\n\t\t\tthis._eachItemMainRangeCache = null;\n\t\t}\n\t},\n\tDataStore.prototype\n);\n\nexport default TreeDataStore;","import env from \"./env\";\n\nexport default function(gantt){\n\treturn env.isNode || !gantt.$root;\n};","import isHeadless from \"../../utils/is_headless\";\n\nconst storeRenderCreator = function(name, gantt){\n\n\tconst store = gantt.getDatastore(name);\n\n\tconst itemRepainter = {\n\t\trenderItem: function(id, renderer){\n\n\t\t\tconst renders = renderer.getLayers();\n\n\t\t\tconst item = store.getItem(id);\n\t\t\tif(item && store.isVisible(id)) {\n\t\t\t\tfor (let i = 0; i < renders.length; i++)\n\t\t\t\t\trenders[i].render_item(item);\n\t\t\t}\n\t\t},\n\t\trenderItems: function(renderer){\n\t\t\tconst renderers = renderer.getLayers();\n\t\t\tfor (let i = 0; i < renderers.length; i++) {\n\t\t\t\trenderers[i].clear();\n\t\t\t}\n\n\t\t\tlet allData = null;\n\n\t\t\tconst loadedRanges = {};\n\t\t\tfor (let i = 0; i < renderers.length; i++) {\n\t\t\t\tconst layer = renderers[i];\n\t\t\t\tlet layerData;\n\t\t\t\tif(layer.get_visible_range){\n\n\t\t\t\t\tvar range = layer.get_visible_range(store);\n\t\t\t\t\tif(range.start !== undefined && range.end !== undefined){\n\t\t\t\t\t\tvar key = range.start + \" - \" + range.end;\n\t\t\t\t\t\tif(loadedRanges[key]){\n\t\t\t\t\t\t\tlayerData = loadedRanges[key];\n\t\t\t\t\t\t}else{\n\t\t\t\t\t\t\tlayerData = store.getIndexRange(range.start, range.end);\n\t\t\t\t\t\t\tloadedRanges[key] = layerData;\n\t\t\t\t\t\t}\n\t\t\t\t\t}else if(range.ids !== undefined){\n\t\t\t\t\t\tlayerData = range.ids.map(function(id){\n\t\t\t\t\t\t\treturn store.getItem(id);\n\t\t\t\t\t\t});\n\t\t\t\t\t}else{\n\t\t\t\t\t\tthrow new Error(\"Invalid range returned from 'getVisibleRange' of the layer\");\n\t\t\t\t\t}\n\t\t\t\t}else{\n\t\t\t\t\tif(!allData){\n\t\t\t\t\t\tallData = store.getVisibleItems();\n\t\t\t\t\t}\n\t\t\t\t\tlayerData = allData;\n\t\t\t\t}\n\n\t\t\t\tif (layer.prepare_data) {\n\t\t\t\t\t// GS-1605. Highlight timeline cells below tasks and in an empty chart\n\t\t\t\t\tlayer.prepare_data(layerData);\n\t\t\t\t}\n\n\t\t\t\trenderers[i].render_items(layerData);\n\t\t\t}\n\t\t},\n\t\tupdateItems: function(layer) {\n\t\t\tif(layer.update_items){\n\t\t\t\tlet data = [];\n\t\t\t\tif(layer.get_visible_range){\n\n\t\t\t\t\tvar range = layer.get_visible_range(store);\n\t\t\t\t\tif(range.start !== undefined && range.end !== undefined){\n\t\t\t\t\t\tdata = store.getIndexRange(range.start, range.end);\n\t\t\t\t\t}\n\t\t\t\t\tif(range.ids !== undefined){\n\t\t\t\t\t\tlet extraDataArr = range.ids.map(function(id){\n\t\t\t\t\t\t\treturn store.getItem(id);\n\t\t\t\t\t\t});\n\t\t\t\t\t\t// GS-2502: range.ids might not exist in other datastores\n\t\t\t\t\t\tif(extraDataArr.length > 0){\n\t\t\t\t\t\t\textraDataArr = extraDataArr.filter(element => element !== undefined);\n\t\t\t\t\t\t\tdata = data.concat(extraDataArr);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tif((range.start == undefined || range.end == undefined) && range.ids == undefined)  {\n\t\t\t\t\t\tthrow new Error(\"Invalid range returned from 'getVisibleRange' of the layer\");\n\t\t\t\t\t}\n\t\t\t\t}else{\n\t\t\t\t\tdata = store.getVisibleItems();\n\t\t\t\t}\n\n\t\t\t\tif (layer.prepare_data) {\n\t\t\t\t\t// GS-1605. Highlight timeline cells below tasks and in an empty chart\n\t\t\t\t\tlayer.prepare_data(data, layer);\n\t\t\t\t}\n\t\t\t\tlayer.update_items(data);\n\t\t\t}\n\t\t}\n\t};\n\n\tstore.attachEvent(\"onStoreUpdated\", function(id, item, action){\n\t\tif(isHeadless(gantt)){\n\t\t\treturn true;\n\t\t}\n\n\t\tconst renderer = gantt.$services.getService(\"layers\").getDataRender(name);\n\t\tif(renderer){\n\t\t\trenderer.onUpdateRequest = function(layer){\n\t\t\t\titemRepainter.updateItems(layer);\n\t\t\t};\n\t\t}\n\t});\n\n\tfunction skipRepaint(gantt){\n\t\tconst state = gantt.$services.getService(\"state\");\n\t\tif(state.getState(\"batchUpdate\").batch_update){\n\t\t\treturn true;\n\t\t}else{\n\t\t\treturn false;\n\t\t}\n\t}\n\n\tstore.attachEvent(\"onStoreUpdated\", function(id, item, action){\n\t\tif(skipRepaint(gantt)){\n\t\t\treturn;\n\t\t}\n\t\tif(!id || action == \"move\" || action == \"delete\"){\n\t\t\tstore.callEvent(\"onBeforeRefreshAll\", []);\n\t\t\tstore.callEvent(\"onAfterRefreshAll\", []);\n\t\t}else{\n\t\t\tstore.callEvent(\"onBeforeRefreshItem\", [item.id]);\n\t\t\tstore.callEvent(\"onAfterRefreshItem\", [item.id]);\n\t\t}\n\t});\n\n\tstore.attachEvent(\"onAfterRefreshAll\", function(){\n\t\tif(isHeadless(gantt)){\n\t\t\treturn true;\n\t\t}\n\n\t\tconst renderer = gantt.$services.getService(\"layers\").getDataRender(name);\n\t\tif(renderer && !skipRepaint(gantt)){\n\t\t\titemRepainter.renderItems(renderer);\n\t\t}\n\t});\n\tstore.attachEvent(\"onAfterRefreshItem\", function(id){\n\t\tif(isHeadless(gantt)){\n\t\t\treturn true;\n\t\t}\n\n\t\tconst renderer = gantt.$services.getService(\"layers\").getDataRender(name);\n\t\tif(renderer){\n\t\t\titemRepainter.renderItem(id, renderer);\n\t\t}\n\t});\n\n\t// TODO: probably can be done more in a more efficient way\n\tstore.attachEvent(\"onItemOpen\", function(){\n\t\tif(isHeadless(gantt)){\n\t\t\treturn true;\n\t\t}\n\n\t\tgantt.render();\n\t});\n\n\tstore.attachEvent(\"onItemClose\", function(){\n\t\tif(isHeadless(gantt)){\n\t\t\treturn true;\n\t\t}\n\n\t\tgantt.render();\n\t});\n\n\tfunction refreshId(renders, oldId, newId, item) {\n\t\tfor (let i = 0; i < renders.length; i++) {\n\t\t\trenders[i].change_id(oldId, newId);\n\t\t}\n\t}\n\n\tstore.attachEvent(\"onIdChange\", function(oldId, newId){\n\t\tif(isHeadless(gantt)){\n\t\t\treturn true;\n\t\t}\n\n\t\t// in case of linked datastores (tasks <-> links), id change should recalculate something in linked datastore before any repaint\n\t\t// use onBeforeIdChange for this hook.\n\t\t// TODO: use something more reasonable instead\n\t\tstore.callEvent(\"onBeforeIdChange\", [oldId, newId]);\n\n\t\tif(skipRepaint(gantt)){\n\t\t\treturn;\n\t\t}\n\t\tif(!store.isSilent()){\n\t\t\tconst renderer = gantt.$services.getService(\"layers\").getDataRender(name);\n\t\t\tif(renderer){ // missing check for renderer GS-1814\n\t\t\t\trefreshId(renderer.getLayers(), oldId, newId, store.getItem(newId));\n\t\t\t\titemRepainter.renderItem(newId, renderer);\n\t\t\t}else{\n\t\t\t\t// GS-1814 repaint ui to apply new id when the datastore don't have own renderer\n\t\t\t\tgantt.render();\n\t\t\t}\n\t\t}\n\t});\n\n};\n\nexport default {\n\tbindDataStore: storeRenderCreator\n};","import * as utils from \"../../utils/utils\";\nimport createTasksFacade from \"./datastore_tasks\";\nimport createLinksFacade from \"./datastore_links\";\nimport DataStore from \"../datastore/datastore\";\nimport TreeDataStore from \"../datastore/treedatastore\";\nimport createDatastoreSelect from \"../datastore/select\";\nimport datastoreRender from \"../datastore/datastore_render\";\nimport isHeadless from \"../../utils/is_headless\";\nimport {replaceValidZeroId} from \"../../utils/helpers\";\n\nfunction getDatastores(){\n\tvar storeNames = this.$services.getService(\"datastores\");\n\tvar res = [];\n\tfor(var i = 0; i < storeNames.length; i++){\n\t\tvar store = this.getDatastore(storeNames[i]);\n\t\tif(!store.$destroyed){\n\t\t\tres.push(store);\n\t\t}\n\t}\n\treturn res;\n}\n\nvar createDatastoreFacade = function(){\n\treturn {\n\tcreateDatastore: function(config){\n\n\t\tvar $StoreType = (config.type || \"\").toLowerCase() == \"treedatastore\" ? TreeDataStore : DataStore;\n\n\t\tif (config) {\n\t\t\tvar self = this;\n\t\t\tconfig.openInitially = function(){ return self.config.open_tree_initially; };\n\t\t\tconfig.copyOnParse = function(){ return self.config.deepcopy_on_parse; };\n\t\t}\n\n\t\tvar store = new $StoreType(config);\n\t\tthis.mixin(store, createDatastoreSelect(store));\n\n\t\tif (config.name) {\n\t\t\tvar servicePrefix = \"datastore:\";\n\t\t\tvar storeAccessName = servicePrefix + config.name;\n\n\t\t\tstore.attachEvent(\"onDestroy\", function(){\n\t\t\t\tthis.$services.dropService(storeAccessName);\n\t\t\t\tvar storeList = this.$services.getService(\"datastores\");\n\t\t\t\tfor(var i = 0; i < storeList.length; i++){\n\t\t\t\t\tif(storeList[i] === config.name){\n\t\t\t\t\t\tstoreList.splice(i, 1);\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}.bind(this));\n\n\t\t\tthis.$services.dropService(storeAccessName);\n\t\t\tthis.$services.setService(storeAccessName, function() { return store; } );\n\n\t\t\tvar storeList = this.$services.getService(\"datastores\");\n\t\t\tif (!storeList) {\n\t\t\t\tstoreList = [];\n\t\t\t\tthis.$services.setService(\"datastores\", function() { return storeList; });\n\t\t\t\tstoreList.push(config.name);\n\t\t\t} else if (storeList.indexOf(config.name) < 0) {\n\t\t\t\tstoreList.push(config.name);\n\t\t\t}\n\n\t\t\tdatastoreRender.bindDataStore(config.name, this);\n\n\t\t}\n\n\t\treturn store;\n\t},\n\tgetDatastore: function(name){\n\t\treturn this.$services.getService(\"datastore:\" + name);\n\t},\n\t_getDatastores: getDatastores,\n\n\trefreshData: function () {\n\t\tvar scrollState;\n\t\tif(!isHeadless(this)){\n\t\t\tscrollState = this.getScrollState();\n\t\t}\n\n\t\tthis.callEvent(\"onBeforeDataRender\", []);\n\n\t\tvar stores = getDatastores.call(this);\n\t\tfor(var i = 0; i < stores.length; i++){\n\t\t\tstores[i].refresh();\n\t\t}\n\n\t\tif(this.config.preserve_scroll && !isHeadless(this) && (scrollState.x || scrollState.y)){\n\t\t\tthis.scrollTo(scrollState.x, scrollState.y);\n\t\t}\n\t\tthis.callEvent(\"onDataRender\", []);\n\n\t},\n\n\tisChildOf: function(childId, parentId){\n\t\treturn this.$data.tasksStore.isChildOf(childId, parentId);\n\t},\n\n\trefreshTask: function (taskId, refresh_links) {\n\t\tvar task = this.getTask(taskId);\n\t\tvar self = this;\n\t\tfunction refreshLinks(){\n\t\t\tif (refresh_links !== undefined && !refresh_links)\n\t\t\t\treturn;\n\t\t\tfor (var i = 0; i < task.$source.length; i++) {\n\t\t\t\tself.refreshLink(task.$source[i]);\n\t\t\t}\n\t\t\tfor (var i = 0; i < task.$target.length; i++) {\n\t\t\t\tself.refreshLink(task.$target[i]);\n\t\t\t}\n\t\t}\n\n\t\tif (task && this.isTaskVisible(taskId)) {\n\t\t\tthis.$data.tasksStore.refresh(taskId, !!this.getState(\"tasksDnd\").drag_id || refresh_links === false);// do quick refresh during drag and drop\n\t\t\trefreshLinks();\n\t\t}else if(this.isTaskExists(taskId) && this.isTaskExists(this.getParent(taskId)) && !this._bulk_dnd){\n\t\t\tthis.refreshTask(this.getParent(taskId));\n\n\t\t\tvar hasSplitParent = false;\n\t\t\tthis.eachParent(function(parent){\n\t\t\t\tif(hasSplitParent || this.isSplitTask(parent)){\n\t\t\t\t\thasSplitParent = true;\n\t\t\t\t}\n\t\t\t}, taskId);\n\t\t\tif(hasSplitParent){\n\t\t\t\trefreshLinks();\n\t\t\t}\n\t\t}\n\n\t},\n\trefreshLink: function (linkId) {\n\t\tthis.$data.linksStore.refresh(linkId, !!this.getState(\"tasksDnd\").drag_id);// do quick refresh during drag and drop\n\t},\n\n\tsilent: function(code){\n\t\tvar gantt = this;\n\t\tgantt.$data.tasksStore.silent(function(){\n\t\t\tgantt.$data.linksStore.silent(function(){\n\t\t\t\tcode();\n\t\t\t});\n\t\t});\n\t},\n\n\tclearAll: function () {\n\t\tvar stores = getDatastores.call(this);\n\t\t\n\t\t// clear all stores without invoking clearAll event\n\t\t// in order to prevent calling handlers when only some stores are cleared\n\t\tfor(var i = 0; i < stores.length; i++){\n\t\t\tstores[i].silent(function(){\n\t\t\t\tstores[i].clearAll();\t\n\t\t\t});\n\t\t}\n\t\t// run clearAll again to invoke events\n\t\tfor(var i = 0; i < stores.length; i++){\n\t\t\tstores[i].clearAll();\t\n\t\t}\n\n\t\tthis._update_flags();\n\t\tthis.userdata = {};\n\t\tthis.callEvent(\"onClear\", []);\n\t\tthis.render();\n\t},\n\t_clear_data: function () {\n\t\tthis.$data.tasksStore.clearAll();\n\t\tthis.$data.linksStore.clearAll();\n\t\tthis._update_flags();\n\t\tthis.userdata = {};\n\t},\n\n\tselectTask: function(id){\n\t\tvar store = this.$data.tasksStore;\n\t\tif(!this.config.select_task)\n\t\t\treturn false;\n\t\tid = replaceValidZeroId(id, this.config.root_id);\n\t\tif (id){\n\t\t\tlet oldSelectId = this.getSelectedId();\n\t\t\t// Don't repaint the resource panel as the data didn't change\n\t\t\tstore._skipResourceRepaint = true;\n\t\t\tstore.select(id);\n\t\t\tstore._skipResourceRepaint = false;\n\t\t\t// GS-730. Split task is not included in the tree, \n\t\t\t// so the datastore renderer will think that the task is not visible\n\t\t\tif (oldSelectId && store.pull[oldSelectId].$split_subtask && oldSelectId != id) {\n\t\t\t\tthis.refreshTask(oldSelectId);\n\t\t\t}\n\t\t\tif (store.pull[id].$split_subtask && oldSelectId != id) {// GS-1850. Do not repaint split task after double click\n\t\t\t\tthis.refreshTask(id);\n\t\t\t}\n\t\t}\n\t\treturn store.getSelectedId();\n\t},\n\tunselectTask: function(id){\n\t\tvar store = this.$data.tasksStore;\n\t\tstore.unselect(id);\n\t\t// GS-730. Split task is not included in the tree, \n\t\t// so the datastore renderer will think that the task is not visible\n\t\tif (id && store.pull[id].$split_subtask) {\n\t\t\tthis.refreshTask(id);\n\t\t}\n\t},\n\tisSelectedTask: function(id){\n\t\treturn this.$data.tasksStore.isSelected(id);\n\t},\n\tgetSelectedId: function() {\n\t\treturn this.$data.tasksStore.getSelectedId();\n\t}\n};\n};\n\nfunction createFacade(){\n\tvar res = utils.mixin({}, createDatastoreFacade());\n\tutils.mixin(res, createTasksFacade());\n\tutils.mixin(res, createLinksFacade());\n\treturn res;\n}\n\n\n\n\nexport default {create: createFacade};","function createDataStoreSelectMixin(store){\n\tvar selectedId = null;\n\n\tvar deleteItem = store._removeItemInner;\n\t\n\tfunction unselect(id){\n\t\tselectedId = null;\n\t\tthis.callEvent(\"onAfterUnselect\", [id]);\n\t}\n\n\tstore._removeItemInner = function(id){\n\t\tif(selectedId == id){\n\t\t\tunselect.call(this, id);\n\t\t}\n\n\t\tif(selectedId && this.eachItem){\n\t\t\tthis.eachItem(function(subItem){\n\t\t\t\tif(subItem.id == selectedId){\n\t\t\t\t\tunselect.call(this, subItem.id);\n\t\t\t\t}\n\t\t\t}, id);\n\t\t}\n\n\t\treturn deleteItem.apply(this, arguments);\n\t};\n\n\tstore.attachEvent(\"onIdChange\", function(oldId, newId) {\n\t\tif (store.getSelectedId() == oldId) {\n\t\t\tstore.silent(function () {\n\t\t\t\tstore.unselect(oldId);\n\t\t\t\tstore.select(newId);\n\t\t\t});\n\t\t}\n\t});\n\n\treturn {\n\t\tselect: function(id){\n\t\t\tif (id){\n\n\t\t\t\tif(selectedId == id)\n\t\t\t\t\treturn selectedId;\n\n\t\t\t\tif(!this._skip_refresh) {\n\t\t\t\t\tif (!this.callEvent(\"onBeforeSelect\", [id])) {\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tthis.unselect();\n\n\t\t\t\tselectedId = id;\n\n\t\t\t\tif(!this._skip_refresh) {\n\t\t\t\t\tthis.refresh(id);\n\t\t\t\t\tthis.callEvent(\"onAfterSelect\", [id]);\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn selectedId;\n\t\t},\n\t\tgetSelectedId: function(){\n\t\t\treturn selectedId;\n\t\t},\n\t\tisSelected: function(id){\n\t\t\treturn id == selectedId;\n\t\t},\n\t\tunselect: function(id){\n\t\t\tvar id = id || selectedId;\n\t\t\tif(!id)\n\t\t\t\treturn;\n\t\t\tselectedId = null;\n\t\t\tif(!this._skip_refresh){\n\t\t\t\tthis.refresh(id);\n\t\t\t\tunselect.call(this, id);\n\t\t\t}\n\t\t}\n\t};\n}\n\nexport default createDataStoreSelectMixin;","import * as utils from \"../../utils/utils\";\n\n\nvar createLinksStoreFacade = function(){\n\treturn {\n\tgetLinkCount: function () {\n\t\treturn this.$data.linksStore.count();\n\t},\n\n\tgetLink : function (id) {\n\t\treturn this.$data.linksStore.getItem(id);\n\t},\n\n\tgetLinks : function () {\n\t\treturn this.$data.linksStore.getItems();\n\t},\n\n\tisLinkExists : function (id) {\n\t\treturn this.$data.linksStore.exists(id);\n\t},\n\n\taddLink : function (link) {\n\t\tconst newLink = this.$data.linksStore.addItem(link);\n\t\t// GS-1222. Update fullOrder otherwise the link won't appear after render\n\t\tif (this.$data.linksStore.isSilent()){\n\t\t\tthis.$data.linksStore.fullOrder.push(newLink);\n\t\t}\n\t\treturn newLink;\n\t},\n\n\tupdateLink : function (id, data) {\n\t\tif (!utils.defined(data))\n\t\t\tdata = this.getLink(id);\n\t\tthis.$data.linksStore.updateItem(id, data);\n\t},\n\n\tdeleteLink : function (id) {\n\t\treturn this.$data.linksStore.removeItem(id);\n\t},\n\n\tchangeLinkId : function (oldid, newid) {\n\t\treturn this.$data.linksStore.changeId(oldid, newid);\n\t}\n};\n};\n\nexport default createLinksStoreFacade;","import * as utils from \"../../../utils/utils\";\n\nfunction ScaleHelper(gantt){\n\tvar dateHelper = gantt.date;\n\tvar services = gantt.$services;\n\n\treturn {\n\t\tgetSum: function (sizes, from, to) {\n\t\t\tif (to === undefined)\n\t\t\t\tto = sizes.length - 1;\n\t\t\tif (from === undefined)\n\t\t\t\tfrom = 0;\n\n\t\t\tvar summ = 0;\n\t\t\tfor (var i = from; i <= to; i++)\n\t\t\t\tsumm += sizes[i];\n\n\t\t\treturn summ;\n\t\t},\n\t\tsetSumWidth: function (sum_width, scale, from, to) {\n\t\t\tvar parts = scale.width;\n\n\t\t\tif (to === undefined)\n\t\t\t\tto = parts.length - 1;\n\t\t\tif (from === undefined)\n\t\t\t\tfrom = 0;\n\t\t\tvar length = to - from + 1;\n\n\t\t\tif (from > parts.length - 1 || length <= 0 || to > parts.length - 1)\n\t\t\t\treturn;\n\n\t\t\tvar oldWidth = this.getSum(parts, from, to);\n\n\t\t\tvar diff = sum_width - oldWidth;\n\n\t\t\tthis.adjustSize(diff, parts, from, to);\n\t\t\tthis.adjustSize(-diff, parts, to + 1);\n\n\t\t\tscale.full_width = this.getSum(parts);\n\t\t},\n\t\tsplitSize: function (width, count) {\n\t\t\tvar arr = [];\n\t\t\tfor (var i = 0; i < count; i++) arr[i] = 0;\n\n\t\t\tthis.adjustSize(width, arr);\n\t\t\treturn arr;\n\n\t\t},\n\t\tadjustSize: function (width, parts, from, to) {\n\t\t\tif (!from)\n\t\t\t\tfrom = 0;\n\t\t\tif (to === undefined)\n\t\t\t\tto = parts.length - 1;\n\n\t\t\tvar length = to - from + 1;\n\n\t\t\tvar full = this.getSum(parts, from, to);\n\n\t\t\tfor (var i = from; i <= to; i++) {\n\t\t\t\tvar share = Math.floor(width * (full ? (parts[i] / full) : (1 / length)));\n\n\t\t\t\tfull -= parts[i];\n\t\t\t\twidth -= share;\n\t\t\t\tlength--;\n\n\t\t\t\tparts[i] += share;\n\t\t\t}\n\t\t\tparts[parts.length - 1] += width;\n\t\t},\n\t\tsortScales: function (scales) {\n\t\t\tfunction cellSize(unit, step) {\n\t\t\t\tvar d = new Date(1970, 0, 1);\n\t\t\t\treturn dateHelper.add(d, step, unit) - d;\n\t\t\t}\n\n\t\t\tscales.sort(function (a, b) {\n\t\t\t\tif (cellSize(a.unit, a.step) < cellSize(b.unit, b.step)) {\n\t\t\t\t\treturn 1;\n\t\t\t\t} else if (cellSize(a.unit, a.step) > cellSize(b.unit, b.step)) {\n\t\t\t\t\treturn -1;\n\t\t\t\t} else {\n\t\t\t\t\treturn 0;\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tfor (var i = 0; i < scales.length; i++) {\n\t\t\t\tscales[i].index = i;\n\t\t\t}\n\t\t},\n\t\t_isLegacyMode: function(config){\n\t\t\tvar scaleConfig = config || gantt.config;\n\t\t\treturn scaleConfig.scale_unit || scaleConfig.date_scale || scaleConfig.subscales;\n\t\t},\n\t\t_prepareScaleObject: function(scale){\n\t\t\tvar format = scale.format;\n\t\t\tif(!format){\n\t\t\t\tformat = scale.template || scale.date || \"%d %M\";\n\t\t\t}\n\n\t\t\tif(typeof format === \"string\"){\n\t\t\t\tformat = gantt.date.date_to_str(format);\n\t\t\t}\n\t\t\treturn {\n\t\t\t\tunit: scale.unit || \"day\",\n\t\t\t\tstep: scale.step || 1,\n\t\t\t\tformat: format,\n\t\t\t\tcss: scale.css\n\t\t\t};\n\t\t},\n\t\tprimaryScale: function(config) {\n\t\t\tvar templates = services.getService(\"templateLoader\");\n\t\t\tvar legacyMode = this._isLegacyMode(config);\n\n\t\t\tvar scaleConfig = config || gantt.config;\n\n\t\t\tvar result;\n\t\t\tif(legacyMode){\n\t\t\t\ttemplates.initTemplate(\"date_scale\", undefined, undefined, scaleConfig, gantt.config.templates);\n\t\t\t\tresult = {\n\t\t\t\t\tunit: gantt.config.scale_unit,\n\t\t\t\t\tstep: gantt.config.step,\n\t\t\t\t\ttemplate: gantt.templates.date_scale,\n\t\t\t\t\tdate: gantt.config.date_scale,\n\t\t\t\t\tcss: gantt.templates.scale_cell_class\n\t\t\t\t};\n\t\t\t}else{\n\t\t\t\tvar primaryScale = scaleConfig.scales[0];\n\t\t\t\tresult = {\n\t\t\t\t\tunit: primaryScale.unit,\n\t\t\t\t\tstep: primaryScale.step,\n\t\t\t\t\ttemplate: primaryScale.template,\n\t\t\t\t\tformat: primaryScale.format,\n\t\t\t\t\tdate: primaryScale.date,\n\t\t\t\t\tcss: primaryScale.css || gantt.templates.scale_cell_class\n\t\t\t\t};\n\t\t\t}\n\n\t\t\treturn this._prepareScaleObject(result);\n\t\t},\n\t\tgetSubScales: function(config) {\n\t\t\tvar legacyMode = this._isLegacyMode(config);\n\t\t\tvar scaleConfig = config || gantt.config;\n\t\t\tvar scales;\n\t\t\tif(legacyMode){\n\t\t\t\tlet docLink = \"https://docs.dhtmlx.com/gantt/migrating.html#:~:text=%3D%20false%3B-,Time%20scale%20settings,-Configuration%20of%20time\";\n\t\t\t\tif (gantt.env.isFF){\n\t\t\t\t\tdocLink = \"https://docs.dhtmlx.com/gantt/migrating.html#6162\";\n\t\t\t\t}\n\t\t\t\t// eslint-disable-next-line no-console\n\t\t\t\tconsole.warn(`You are using the obsolete scale configuration.\nIt will stop working in the future versions.\nPlease migrate the configuration to the newer version:\n${docLink}`);\n\t\t\t\tscales = scaleConfig.subscales || [];\n\t\t\t}else{\n\t\t\t\tscales = scaleConfig.scales.slice(1);\n\t\t\t}\n\t\t\t\n\t\t\treturn scales.map(function(scale){\n\t\t\t\treturn this._prepareScaleObject(scale);\n\t\t\t}.bind(this));\n\t\t},\n\n\t\tprepareConfigs: function (scales, min_coll_width, container_width, scale_height, minDate, maxDate, rtl) {\n\t\t\tvar heights = this.splitSize(scale_height, scales.length);\n\t\t\tvar full_width = container_width;\n\n\t\t\tvar configs = [];\n\t\t\tfor (var i = scales.length - 1; i >= 0; i--) {\n\t\t\t\tvar main_scale = (i == scales.length - 1);\n\t\t\t\tvar cfg = this.initScaleConfig(scales[i], minDate, maxDate);\n\t\t\t\tif (main_scale) {\n\t\t\t\t\tthis.processIgnores(cfg);\n\t\t\t\t}\n\n\t\t\t\tthis.initColSizes(cfg, min_coll_width, full_width, heights[i]);\n\t\t\t\tthis.limitVisibleRange(cfg);\n\n\t\t\t\tif (main_scale) {\n\t\t\t\t\tfull_width = cfg.full_width;\n\t\t\t\t}\n\n\t\t\t\tconfigs.unshift(cfg);\n\t\t\t}\n\n\n\t\t\tfor (var i = 0; i < configs.length - 1; i++) {\n\t\t\t\tthis.alineScaleColumns(configs[configs.length - 1], configs[i]);\n\t\t\t}\n\t\t\tfor (var i = 0; i < configs.length; i++) {\n\n\t\t\t\tif(rtl){\n\t\t\t\t\tthis.reverseScale(configs[i]);\n\t\t\t\t}\n\t\t\t\tthis.setPosSettings(configs[i]);\n\t\t\t}\n\t\t\treturn configs;\n\n\t\t},\n\n\t\treverseScale: function(scale){\n\t\t\tscale.width = scale.width.reverse();\n\t\t\tscale.trace_x = scale.trace_x.reverse();\n\n\t\t\tvar indexes = scale.trace_indexes;\n\t\t\tscale.trace_indexes = {};\n\t\t\tscale.trace_index_transition = {};\n\t\t\tscale.rtl = true;\n\t\t\tfor(var i = 0; i < scale.trace_x.length; i++){\n\t\t\t\tscale.trace_indexes[scale.trace_x[i].valueOf()] = i;\n\t\t\t\tscale.trace_index_transition[indexes[scale.trace_x[i].valueOf()]] = i;\n\t\t\t}\n\t\t\treturn scale;\n\t\t},\n\n\t\tsetPosSettings: function (config) {\n\t\t\tfor (var i = 0, len = config.trace_x.length; i < len; i++) {\n\t\t\t\tconfig.left.push((config.width[i - 1] || 0) + (config.left[i - 1] || 0));\n\t\t\t}\n\t\t},\n\n\t\t_ignore_time_config: function (date, scale) {\n\n\t\t\tif (gantt.config.skip_off_time) {\n\t\t\t\tvar skip = true;\n\t\t\t\tvar probe = date;\n\n\t\t\t\t// check dates in case custom scale unit, e.g. {unit: \"month\", step: 3}\n\t\t\t\tfor (var i = 0; i < scale.step; i++) {\n\t\t\t\t\tif (i) {\n\t\t\t\t\t\tprobe = dateHelper.add(date, i, scale.unit);\n\t\t\t\t\t}\n\n\t\t\t\t\tskip = skip && !this.isWorkTime(probe, scale.unit);\n\t\t\t\t}\n\n\t\t\t\treturn skip;\n\t\t\t}\n\t\t\treturn false;\n\t\t},\n\t\t//defined in an extension\n\t\tprocessIgnores: function (config) {\n\t\t\tconfig.ignore_x = {};\n\t\t\tconfig.display_count = config.count;\n\t\t},\n\t\tinitColSizes: function (config, min_col_width, full_width, line_height) {\n\t\t\tvar cont_width = full_width;\n\n\t\t\tconfig.height = line_height;\n\n\t\t\tvar column_count = config.display_count === undefined ? config.count : config.display_count;\n\n\t\t\tif (!column_count)\n\t\t\t\tcolumn_count = 1;\n\n\t\t\tconfig.col_width = Math.floor(cont_width / column_count);\n\n\t\t\tif (min_col_width) {\n\t\t\t\tif (config.col_width < min_col_width) {\n\t\t\t\t\tconfig.col_width = min_col_width;\n\t\t\t\t\tcont_width = config.col_width * column_count;\n\t\t\t\t}\n\t\t\t}\n\t\t\tconfig.width = [];\n\t\t\tvar ignores = config.ignore_x || {};\n\t\t\tfor (var i = 0; i < config.trace_x.length; i++) {\n\t\t\t\tif (ignores[config.trace_x[i].valueOf()] || (config.display_count == config.count)) {\n\t\t\t\t\tconfig.width[i] = 0;\n\t\t\t\t} else {\n\t\t\t\t\t// width of month columns should be proportional month duration\n\t\t\t\t\tvar width = 1;\n\t\t\t\t\tif (config.unit == \"month\") {\n\t\t\t\t\t\tvar days = Math.round((dateHelper.add(config.trace_x[i], config.step, config.unit) - config.trace_x[i]) / (1000 * 60 * 60 * 24));\n\t\t\t\t\t\twidth = days;\n\t\t\t\t\t}\n\t\t\t\t\tconfig.width[i] = width;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tthis.adjustSize(cont_width - this.getSum(config.width)/* 1 width per column from the code above */, config.width);\n\t\t\tconfig.full_width = this.getSum(config.width);\n\t\t},\n\t\tinitScaleConfig: function (config, min_date, max_date) {\n\t\t\tvar cfg = utils.mixin({\n\t\t\t\tcount: 0,\n\t\t\t\tcol_width: 0,\n\t\t\t\tfull_width: 0,\n\t\t\t\theight: 0,\n\t\t\t\twidth: [],\n\t\t\t\tleft: [],\n\t\t\t\ttrace_x: [],\n\t\t\t\ttrace_indexes: {},\n\t\t\t\tmin_date: new Date(min_date),\n\t\t\t\tmax_date: new Date(max_date)\n\t\t\t}, config);\n\n\t\t\tthis.eachColumn(config.unit, config.step, min_date, max_date, function (date) {\n\t\t\t\tcfg.count++;\n\t\t\t\tcfg.trace_x.push(new Date(date));\n\t\t\t\tcfg.trace_indexes[date.valueOf()] = cfg.trace_x.length - 1;\n\t\t\t});\n\n\t\t\tcfg.trace_x_ascending = cfg.trace_x.slice();\n\t\t\treturn cfg;\n\t\t},\n\t\titerateScales: function (lower_scale, upper_scale, from, to, callback) {\n\t\t\tvar upper_dates = upper_scale.trace_x;\n\t\t\tvar lower_dates = lower_scale.trace_x;\n\n\t\t\tvar prev = from || 0;\n\t\t\tvar end = to || (lower_dates.length - 1);\n\t\t\tvar prevUpper = 0;\n\n\n\t\t\tfor (var up = 1; up < upper_dates.length; up++) {\n\t\t\t\tvar target_index = (lower_scale.trace_indexes[+upper_dates[up]]);\n\t\t\t\tif (target_index !== undefined && target_index <= end) {\n\t\t\t\t\tif (callback) {\n\t\t\t\t\t\tcallback.apply(this, [prevUpper, up, prev, target_index]);\n\t\t\t\t\t}\n\t\t\t\t\tprev = target_index;\n\t\t\t\t\tprevUpper = up;\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t\talineScaleColumns: function (lower_scale, upper_scale, from, to) {\n\t\t\tthis.iterateScales(lower_scale, upper_scale, from, to, function (upper_start, upper_end, lower_start, lower_end) {\n\t\t\t\tvar targetWidth = this.getSum(lower_scale.width, lower_start, lower_end - 1);\n\t\t\t\tvar actualWidth = this.getSum(upper_scale.width, upper_start, upper_end - 1);\n\t\t\t\tif (actualWidth != targetWidth) {\n\t\t\t\t\tthis.setSumWidth(targetWidth, upper_scale, upper_start, upper_end - 1);\n\t\t\t\t}\n\n\t\t\t});\n\t\t},\n\n\t\teachColumn: function (unit, step, min_date, max_date, callback) {\n\t\t\tvar start = new Date(min_date),\n\t\t\t\tend = new Date(max_date);\n\t\t\tif (dateHelper[unit + \"_start\"]) {\n\t\t\t\tstart = dateHelper[unit + \"_start\"](start);\n\t\t\t}\n\n\t\t\tvar curr = new Date(start);\n\t\t\tif (+curr >= +end) {\n\t\t\t\tend = dateHelper.add(curr, step, unit);\n\t\t\t}\n\t\t\twhile (+curr < +end) {\n\t\t\t\tcallback.call(this, new Date(curr));\n\t\t\t\tvar tzOffset = curr.getTimezoneOffset();\n\t\t\t\tcurr = dateHelper.add(curr, step, unit);\n\t\t\t\tcurr = gantt._correct_dst_change(curr, tzOffset, step, unit);\n\t\t\t\tif (dateHelper[unit + '_start'])\n\t\t\t\t\tcurr = dateHelper[unit + \"_start\"](curr);\n\t\t\t}\n\t\t},\n\t\tlimitVisibleRange: function (cfg) {\n\t\t\tvar dates = cfg.trace_x;\n\n\t\t\tvar left = 0, right = cfg.width.length - 1;\n\t\t\tvar diff = 0;\n\t\t\tif (+dates[0] < +cfg.min_date && left != right) {\n\t\t\t\tvar width = Math.floor(cfg.width[0] * ((dates[1] - cfg.min_date) / (dates[1] - dates[0])));\n\t\t\t\tdiff += cfg.width[0] - width;\n\t\t\t\tcfg.width[0] = width;\n\n\t\t\t\tdates[0] = new Date(cfg.min_date);\n\t\t\t}\n\n\t\t\tvar last = dates.length - 1;\n\t\t\tvar lastDate = dates[last];\n\t\t\tvar outDate = dateHelper.add(lastDate, cfg.step, cfg.unit);\n\t\t\tif (+outDate > +cfg.max_date && last > 0) {\n\t\t\t\tvar width = cfg.width[last] - Math.floor(cfg.width[last] * ((outDate - cfg.max_date) / (outDate - lastDate)));\n\t\t\t\tdiff += cfg.width[last] - width;\n\t\t\t\tcfg.width[last] = width;\n\t\t\t}\n\n\t\t\tif (diff) {\n\t\t\t\tvar full = this.getSum(cfg.width);\n\t\t\t\tvar shared = 0;\n\t\t\t\tfor (var i = 0; i < cfg.width.length; i++) {\n\t\t\t\t\tvar share = Math.floor(diff * (cfg.width[i] / full));\n\t\t\t\t\tcfg.width[i] += share;\n\t\t\t\t\tshared += share;\n\t\t\t\t}\n\t\t\t\tthis.adjustSize(diff - shared, cfg.width);\n\t\t\t}\n\n\t\t}\n\t};\n}\n\nexport default ScaleHelper;\n","import ScaleHelper from \"./ui/timeline/scales_ignore\";\nimport PrimaryScaleHelper from \"./ui/timeline/scales\";\n\nfunction resolveConfigRange(unit, gantt){\n\tvar range = {\n\t\tstart_date:null,\n\t\tend_date:null\n\t};\n\n\tif (gantt.config.start_date && gantt.config.end_date) {\n\t\trange.start_date = gantt.date[unit + \"_start\"](new Date(gantt.config.start_date));\n\n\t\tvar end = new Date(gantt.config.end_date);\n\t\tvar start_interval = gantt.date[unit + \"_start\"](new Date(end));\n\t\tif (+end != +start_interval) {\n\t\t\tend = gantt.date.add(start_interval, 1, unit);\n\t\t} else {\n\t\t\tend = start_interval;\n\t\t}\n\n\t\trange.end_date = end;\n\t}\n\treturn range;\n}\n\nfunction _scale_range_unit(gantt) {\n\tvar primaryScale = (new PrimaryScaleHelper(gantt)).primaryScale();\n\tvar unit = primaryScale.unit;\n\tvar step = primaryScale.step;\n\tif (gantt.config.scale_offset_minimal) {\n\n\t\tvar helper = new ScaleHelper(gantt);\n\t\tvar scales = [helper.primaryScale()].concat(helper.getSubScales());\n\n\t\thelper.sortScales(scales);\n\t\tunit = scales[scales.length - 1].unit;\n\t\tstep = scales[scales.length - 1].step || 1;\n\t}\n\treturn { unit:unit, step:step };\n}\n\nfunction _init_tasks_range(gantt) {\n\tvar cfg = _scale_range_unit(gantt);\n\tvar unit = cfg.unit,\n\t\tstep = cfg.step;\n\tvar range = resolveConfigRange(unit, gantt);\n\n\t// GS-1544: Show correct date range if we have tasks or only projects\n\tif(!(range.start_date && range.end_date)){\n\t\tvar onlyProjectTasks = true;\n\t\tvar tasks = gantt.getTaskByTime();\n\t\tfor (var i = 0; i < tasks.length; i++) {\n\t\t\tvar task = tasks[i];\n\t\t\tif (task.type !== gantt.config.types.project){\n\t\t\t\tonlyProjectTasks = false;\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t\tif (tasks.length && onlyProjectTasks){\n\t\t\tvar start_date = tasks[0].start_date;\n\t\t\tvar end_date = gantt.date.add(start_date, 1, gantt.config.duration_unit);\n\t\t\trange = {\n\t\t\t\tstart_date: new Date(start_date),\n\t\t\t\tend_date: new Date(end_date)\n\t\t\t};\n\t\t} else{\n\t\t\trange = gantt.getSubtaskDates();\n\t\t}\n\n\t\tif(!range.start_date || !range.end_date){\n\t\t\trange = {\n\t\t\t\tstart_date: new Date(),\n\t\t\t\tend_date: new Date()\n\t\t\t};\n\t\t}\n\t\t// extend the displayed date range including the constraints, deadlines and baselines\n\t\tgantt.eachTask(function(task){\n\t\t\tif (gantt.config.deadlines !== false && task.deadline){\n\t\t\t\textendRangeForDates(range, task.deadline, task.deadline);\n\t\t\t}\n\t\t\tif (task.constraint_date && task.constraint_type){\n\t\t\t\tif (gantt.config.constraint_types && task.constraint_type !== gantt.config.constraint_types.ASAP && task.constraint_type !== gantt.config.constraint_types.ALAP){\n\t\t\t\t\textendRangeForDates(range, task.constraint_date, task.constraint_date);\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (gantt.config.baselines !== false && task.baselines){\n\t\t\t\ttask.baselines.forEach(function(baseline){\n\t\t\t\t\textendRangeForDates(range, baseline.start_date, baseline.end_date);\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\n\t\trange.start_date = gantt.date[unit + \"_start\"](range.start_date);\n\t\trange.start_date = gantt.calculateEndDate({\n\t\t\tstart_date: gantt.date[unit + \"_start\"](range.start_date),\n\t\t\tduration: -1,\n\t\t\tunit: unit,\n\t\t\tstep:step\n\t\t});//one free column before first task\n\n\t\trange.end_date = gantt.date[unit + \"_start\"](range.end_date);\n\t\trange.end_date = gantt.calculateEndDate({start_date: range.end_date, duration: 2, unit: unit, step:step});//one free column after last task\n\t}\n\n\tgantt._min_date = range.start_date;\n\tgantt._max_date = range.end_date;\n}\n\nfunction extendRangeForDates(range, start_date, end_date){\n\tif (start_date < range.start_date){\n\t\trange.start_date = new Date(start_date);\n\t}\n\tif (end_date > range.end_date){\n\t\trange.end_date = new Date(end_date);\n\t}\n}\n\nfunction _adjust_scales(gantt) {\n\tif (gantt.config.fit_tasks) {\n\t\tvar old_min = +gantt._min_date,\n\t\t\told_max = +gantt._max_date;\n\t\t//this._init_tasks_range();\n\t\tif (+gantt._min_date != old_min || +gantt._max_date != old_max) {\n\t\t\tgantt.render();\n\n\t\t\tgantt.callEvent(\"onScaleAdjusted\", []);\n\t\t\treturn true;\n\t\t}\n\t}\n\treturn false;\n}\n\nexport default function updateTasksRange(gantt){\n\t_init_tasks_range(gantt);\n\t_adjust_scales(gantt);\n};\n","function copyLinkIdsArray(gantt, linkIds, targetHash){\n\tfor(var i = 0; i < linkIds.length; i++) {\n\t\tif(gantt.isLinkExists(linkIds[i])){\n\t\t\ttargetHash[linkIds[i]] = gantt.getLink(linkIds[i]);\n\t\t}\n\t}\n}\n\nfunction copyLinkIds(gantt, task, targetHash){\n\tcopyLinkIdsArray(gantt, task.$source, targetHash);\n\tcopyLinkIdsArray(gantt, task.$target, targetHash);\n}\n\nfunction getSubtreeLinks(gantt, rootId){\n\tvar res = {};\n\n\tif(gantt.isTaskExists(rootId)){\n\t\tcopyLinkIds(gantt, gantt.getTask(rootId), res);\n\t}\n\n\tgantt.eachTask(function(child){\n\t\tcopyLinkIds(gantt, child, res);\n\t}, rootId);\n\n\treturn res;\n}\n\nfunction getSubtreeTasks(gantt, rootId){\n\tvar res = {};\n\n\tgantt.eachTask(function(child){\n\t\tres[child.id] = child;\n\t}, rootId);\n\n\treturn res;\n}\n\nexport default {\n\tgetSubtreeLinks: getSubtreeLinks,\n\tgetSubtreeTasks: getSubtreeTasks\n};","import * as helpers from \"../../utils/helpers\";\nimport treeHelper from \"../../utils/task_tree_helpers\";\n\n\nexport default class DataProcessorEvents {\n\tprotected _dataProcessorHandlers: any[];\n\tprotected $gantt: any;\n\tprotected $dp: any;\n\n\tconstructor(gantt: any, dp: any) {\n\t\tthis.$gantt = gantt;\n\t\tthis.$dp = dp;\n\t\tthis._dataProcessorHandlers = [];\n\t}\n\n\tattach() {\n\t\tconst dp = this.$dp;\n\t\tconst gantt = this.$gantt;\n\t\tconst cascadeDelete = {};\n\n\t\tconst clientSideDelete = (id) => {\n\t\t\treturn this.clientSideDelete(id, dp, gantt);\n\t\t};\n\n\t\tfunction getTaskLinks(task) {\n\t\t\tlet _links = [];\n\n\t\t\tif (task.$source) {\n\t\t\t\t_links = _links.concat(task.$source);\n\t\t\t}\n\t\t\tif (task.$target) {\n\t\t\t\t_links = _links.concat(task.$target);\n\t\t\t}\n\n\t\t\treturn _links;\n\t\t}\n\n\t\tthis._dataProcessorHandlers.push(gantt.attachEvent(\"onAfterTaskAdd\", function(id, item) { // tslint:disable-line\n\t\t\tif (gantt.isTaskExists(id)) {\n\t\t\t\tdp.setGanttMode(\"tasks\");\n\t\t\t\tdp.setUpdated(id, true, \"inserted\");\n\t\t\t}\n\t\t}));\n\n\t\tthis._dataProcessorHandlers.push(gantt.attachEvent(\"onAfterTaskUpdate\", function(id, item) { // tslint:disable-line\n\t\t\tif (gantt.isTaskExists(id)) {\n\t\t\t\tdp.setGanttMode(\"tasks\");\n\t\t\t\tdp.setUpdated(id, true);\n\n\t\t\t\t// gantt can be destroyed/reinitialized after dp.setUpdated\n\t\t\t\tif(gantt._sendTaskOrder){\n\t\t\t\t\tgantt._sendTaskOrder(id, item);\n\t\t\t\t}\n\t\t\t}\n\t\t}));\n\n\t\tthis._dataProcessorHandlers.push(gantt.attachEvent(\"onBeforeTaskDelete\", function(id, item) { // tslint:disable-line\n\t\t\tif (gantt.config.cascade_delete) {\n\t\t\t\tcascadeDelete[id] = {\n\t\t\t\t\ttasks: treeHelper.getSubtreeTasks(gantt, id),\n\t\t\t\t\tlinks: treeHelper.getSubtreeLinks(gantt, id)\n\t\t\t\t};\n\t\t\t}\n\t\t\t// GS-631. Keep the deleted item in Gantt until we receive the successful response from the server\n\t\t\tif (dp.deleteAfterConfirmation) {\n\t\t\t\tdp.setGanttMode(\"tasks\");\n\t\t\t\tdp.setUpdated(id, true, \"deleted\");\n\t\t\t\treturn false;\n\t\t\t}\n\t\t\treturn true;\n\t\t}));\n\n\t\tthis._dataProcessorHandlers.push(gantt.attachEvent(\"onAfterTaskDelete\", function(id, item) { // tslint:disable-line\n\t\t\tdp.setGanttMode(\"tasks\");\n\n\t\t\t// not send delete request if item is not inserted into the db - just remove it from the client\n\t\t\tconst needDbDelete = !clientSideDelete(id);\n\t\t\tconst needCascadeDelete = gantt.config.cascade_delete && cascadeDelete[id];\n\t\t\tif (!needDbDelete && !needCascadeDelete) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (needCascadeDelete) {\n\t\t\t\tconst dpMode = dp.updateMode;\n\t\t\t\tdp.setUpdateMode(\"off\");\n\n\t\t\t\tconst cascade = cascadeDelete[id];\n\t\t\t\tfor (const i in cascade.tasks) {\n\t\t\t\t\tif (!clientSideDelete(i)) {\n\t\t\t\t\t\tdp.storeItem(cascade.tasks[i]);\n\t\t\t\t\t\tdp.setUpdated(i, true, \"deleted\");\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tdp.setGanttMode(\"links\");\n\t\t\t\tfor (const i in cascade.links) {\n\t\t\t\t\tif (!clientSideDelete(i)) {\n\t\t\t\t\t\tdp.storeItem(cascade.links[i]);\n\t\t\t\t\t\tdp.setUpdated(i, true, \"deleted\");\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tcascadeDelete[id] = null;\n\n\t\t\t\tif (dpMode !== \"off\") {\n\t\t\t\t\tdp.sendAllData();\n\t\t\t\t}\n\t\t\t\tdp.setGanttMode(\"tasks\");\n\t\t\t\tdp.setUpdateMode(dpMode);\n\t\t\t}\n\n\t\t\tif (needDbDelete){\n\t\t\t\tdp.storeItem(item);\n\t\t\t\tif (!dp.deleteAfterConfirmation){\n\t\t\t\t\tdp.setUpdated(id, true, \"deleted\");\n\t\t\t\t}\n\t\t\t}\n\n\n\t\t\tif (dp.updateMode !== \"off\" && !dp._tSend) {\n\t\t\t\tdp.sendAllData();\n\t\t\t}\n\t\t}));\n\n\t\tthis._dataProcessorHandlers.push(gantt.attachEvent(\"onAfterLinkUpdate\", function(id, item) { // tslint:disable-line\n\t\t\tif (gantt.isLinkExists(id)) {\n\t\t\t\tdp.setGanttMode(\"links\");\n\t\t\t\tdp.setUpdated(id, true);\n\t\t\t}\n\t\t}));\n\n\t\tthis._dataProcessorHandlers.push(gantt.attachEvent(\"onAfterLinkAdd\", function(id, item) { // tslint:disable-line\n\t\t\tif (gantt.isLinkExists(id)) {\n\t\t\t\tdp.setGanttMode(\"links\");\n\t\t\t\tdp.setUpdated(id, true,\"inserted\");\n\t\t\t}\n\t\t}));\n\n\t\tthis._dataProcessorHandlers.push(gantt.attachEvent(\"onAfterLinkDelete\", function(id, item) { // tslint:disable-line\n\t\t\tdp.setGanttMode(\"links\");\n\n\t\t\tconst needDbDelete = !clientSideDelete(id);\n\t\t\tif (!needDbDelete) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tdp.storeItem(item);\n\t\t\tdp.setUpdated(id, true,\"deleted\");\n\t\t}));\n\n\t\tthis._dataProcessorHandlers.push(gantt.attachEvent(\"onRowDragEnd\", function(id, target) { // tslint:disable-line\n\t\t\tgantt._sendTaskOrder(id, gantt.getTask(id));\n\t\t}));\n\n\t\tlet tasks = null;\n\t\tlet links = null;\n\n\t\tthis._dataProcessorHandlers.push(gantt.attachEvent(\"onTaskIdChange\", function(oldId, newId) { // tslint:disable-line\n\t\t\tif (!dp._waitMode) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst children = gantt.getChildren(newId);\n\t\t\tif (children.length) {\n\t\t\t\ttasks = tasks || {};\n\n\t\t\t\tfor (let i = 0; i < children.length; i++) {\n\t\t\t\t\tconst ch = this.getTask(children[i]);\n\t\t\t\t\ttasks[ch.id] = ch;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tconst item = this.getTask(newId);\n\t\t\tconst itemLinks = getTaskLinks(item);\n\n\t\t\tif (itemLinks.length) {\n\t\t\t\tlinks = links || {};\n\n\t\t\t\tfor (let i = 0; i < itemLinks.length; i++) {\n\t\t\t\t\tconst link = this.getLink(itemLinks[i]);\n\t\t\t\t\tlinks[link.id] = link;\n\t\t\t\t}\n\t\t\t}\n\t\t}));\n\n\t\tdp.attachEvent(\"onAfterUpdateFinish\", function() {\n\t\t\tif (tasks || links) {\n\t\t\t\tgantt.batchUpdate(function() {\n\t\t\t\t\tfor (const id in tasks) {\n\t\t\t\t\t\tgantt.updateTask(tasks[id].id);\n\t\t\t\t\t}\n\n\t\t\t\t\tfor (const id in links) {\n\t\t\t\t\t\tgantt.updateLink(links[id].id);\n\t\t\t\t\t}\n\t\t\t\t\ttasks = null;\n\t\t\t\t\tlinks = null;\n\t\t\t\t});\n\t\t\t\tif (tasks) {\n\t\t\t\t\tgantt._dp.setGanttMode(\"tasks\");\n\t\t\t\t} else {\n\t\t\t\t\tgantt._dp.setGanttMode(\"links\");\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n\t\tdp.attachEvent(\"onBeforeDataSending\", function() {\n\t\t\tif (this._tMode === \"CUSTOM\") {\n\t\t\t\treturn true;\n\t\t\t}\n\t\t\tlet url = this._serverProcessor;\n\t\t\tif (this._tMode === \"REST-JSON\" || this._tMode === \"REST\") {\n\t\t\t\tconst mode = this._ganttMode;\n\n\t\t\t\turl = url.substring(0, url.indexOf(\"?\") > -1 ? url.indexOf(\"?\") : url.length);\n\t\t\t\t// editing=true&\n\t\t\t\tthis.serverProcessor = url + (url.slice(-1) === \"/\" ? \"\" : \"/\") + mode;\n\t\t\t} else {\n\t\t\t\tconst pluralizedMode = this._ganttMode + \"s\";\n\t\t\t\tthis.serverProcessor = url + gantt.ajax.urlSeparator(url) + \"gantt_mode=\" + pluralizedMode;\n\t\t\t}\n\n\t\t\treturn true;\n\t\t});\n\n\t\tdp.attachEvent(\"insertCallback\", function insertCallback(upd, id, parent, mode) { // tslint:disable-line\n\t\t\tconst data = upd.data || gantt.xml._xmlNodeToJSON(upd.firstChild);\n\t\t\tconst methods = {\n\t\t\t\tadd: gantt.addTask,\n\t\t\t\tisExist: gantt.isTaskExists\n\t\t\t};\n\t\t\tif (mode === \"links\") {\n\t\t\t\tmethods.add = gantt.addLink;\n\t\t\t\tmethods.isExist = gantt.isLinkExists;\n\t\t\t}\n\t\t\tif (methods.isExist.call(gantt, id)) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tdata.id = id;\n\t\t\tmethods.add.call(gantt, data);\n\t\t});\n\n\t\tdp.attachEvent(\"updateCallback\", function updateCallback(upd, id) {\n\t\t\tconst data = upd.data || gantt.xml._xmlNodeToJSON(upd.firstChild);\n\t\t\tif (!gantt.isTaskExists(id)) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tconst objData = gantt.getTask(id);\n\t\t\tfor (const key in data) {\n\t\t\t\tlet property = data[key];\n\t\t\t\tswitch (key) {\n\t\t\t\t\tcase \"id\":\n\t\t\t\t\t\tcontinue;\n\t\t\t\t\tcase \"start_date\":\n\t\t\t\t\tcase \"end_date\":\n\t\t\t\t\t\tproperty = gantt.defined(gantt.templates.xml_date) ? gantt.templates.xml_date(property) : gantt.templates.parse_date(property);\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase \"duration\":\n\t\t\t\t\t\tobjData.end_date = gantt.calculateEndDate({start_date: objData.start_date, duration: property, task:objData});\n\t\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t\tobjData[key] = property;\n\t\t\t}\n\t\t\tgantt.updateTask(id);\n\t\t\tgantt.refreshData();\n\t\t});\n\t\tdp.attachEvent(\"deleteCallback\", function deleteCallback(upd, id, parent, mode) { // tslint:disable-line\n\t\t\tconst methods = {\n\t\t\t\tdelete: gantt.deleteTask,\n\t\t\t\tisExist: gantt.isTaskExists\n\t\t\t};\n\t\t\tif (mode === \"links\") {\n\t\t\t\tmethods.delete = gantt.deleteLink;\n\t\t\t\tmethods.isExist = gantt.isLinkExists;\n\t\t\t} else if(mode === \"assignment\") {\n\t\t\t\tmethods.delete = function(val) {\n\t\t\t\t\tgantt.$data.assignmentsStore.remove(val);\n\t\t\t\t};\n\t\t\t\tmethods.isExist = function(val){\n\t\t\t\t\treturn gantt.$data.assignmentsStore.exists(val);\n\t\t\t\t};\n\t\t\t}\n\t\t\tif (methods.isExist.call(gantt, id)) {\n\t\t\t\tmethods.delete.call(gantt, id);\n\t\t\t}\n\t\t});\n\n\t\tthis.handleResourceCRUD(dp, gantt);\n\t\tthis.handleResourceAssignmentCRUD(dp, gantt);\n\t\tthis.handleBaselineCRUD(dp, gantt);\n\t}\n\n\tclientSideDelete(id, dp, gantt){\n\t\tconst updated = dp.updatedRows.slice();\n\t\tlet clientOnly = false;\n\n\t\tif(gantt.getUserData(id, \"!nativeeditor_status\", dp._ganttMode) === \"true_deleted\"){\n\t\t\tclientOnly = true;\n\t\t\tdp.setUpdated(id,false);\n\t\t}\n\n\t\tfor (let i = 0; i < updated.length && !dp._in_progress[id]; i++) {\n\t\t\tif (updated[i] === id) {\n\t\t\t\tif (gantt.getUserData(id, \"!nativeeditor_status\", dp._ganttMode) === \"inserted\") {\n\t\t\t\t\tclientOnly = true;\n\t\t\t\t}\n\t\t\t\tdp.setUpdated(id,false);\n\t\t\t}\n\t\t}\n\t\treturn clientOnly;\n\t}\n\n\thandleResourceAssignmentCRUD(dp, gantt){\n\t\tif(!gantt.config.resources || gantt.config.resources.dataprocessor_assignments !== true){\n\t\t\treturn;\n\t\t}\n\n\t\tconst assignmentsStore = gantt.getDatastore(gantt.config.resource_assignment_store);\n\t\tconst insertedTasks = {};\n\t\tconst pendingAssignments = {};\n\n\t\tgantt.attachEvent(\"onBeforeTaskAdd\", function(id, task){\n\t\t\tinsertedTasks[id] = true;\n\t\t\treturn true;\n\t\t});\n\n\t\tfunction putAssignmentToQueue(item){\n\t\t\tpendingAssignments[item.id] = item;\n\t\t\tinsertedTasks[item.task_id] = true;\n\t\t}\n\n\t\tfunction insertResourceAssignment(assignment){\n\t\t\tconst id = assignment.id;\n\t\t\tif (assignmentsStore.exists(id)) {\n\t\t\t\tdp.setGanttMode(\"assignment\");\n\t\t\t\tdp.setUpdated(id, true,\"inserted\");\n\t\t\t}\n\t\t\tdelete pendingAssignments[id];\n\t\t}\n\n\t\tgantt.attachEvent(\"onTaskIdChange\", function(id, newId){\n\t\t\tdelete insertedTasks[id];\n\t\t});\n\n\t\tassignmentsStore.attachEvent(\"onAfterAdd\", (id, item) => {\n\t\t\tif(insertedTasks[item.task_id]){\n\t\t\t\t// inserting assignment of new task\n\t\t\t\t// task is not saved yet, need to wait till it gets permanent id and save assigmnents after that\n\t\t\t\tputAssignmentToQueue(item);\n\t\t\t}else{\n\t\t\t\tinsertResourceAssignment(item);\n\t\t\t}\n\t\t});\n\n\t\tassignmentsStore.attachEvent(\"onAfterUpdate\", (id, item) => {\n\t\t\tif (assignmentsStore.exists(id)) {\n\t\t\t\tif(pendingAssignments[id]){\n\t\t\t\t\tinsertResourceAssignment(item);\n\t\t\t\t}else{\n\t\t\t\t\tdp.setGanttMode(\"assignment\");\n\t\t\t\t\tdp.setUpdated(id, true);\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n\t\tassignmentsStore.attachEvent(\"onAfterDelete\", (id, item) => {\n\t\t\tdp.setGanttMode(\"assignment\");\n\n\t\t\tconst needDbDelete = !this.clientSideDelete(id, dp, gantt);\n\t\t\tif (!needDbDelete) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tdp.storeItem(item);\n\t\t\tdp.setUpdated(id, true,\"deleted\");\n\t\t});\n\n\t}\n\n\thandleResourceCRUD(dp, gantt){\n\t\tif(!gantt.config.resources || gantt.config.resources.dataprocessor_resources !== true){\n\t\t\treturn;\n\t\t}\n\n\t\tconst resourcesStore = gantt.getDatastore(gantt.config.resource_store);\n\n\t\tfunction insertResource(resource){\n\t\t\tconst id = resource.id;\n\t\t\tif (resourcesStore.exists(id)) {\n\t\t\t\tdp.setGanttMode(\"resource\");\n\t\t\t\tdp.setUpdated(id, true,\"inserted\");\n\t\t\t}\n\t\t}\n\n\t\tresourcesStore.attachEvent(\"onAfterAdd\", (id, item) => {\n\t\t\tinsertResource(item);\n\t\t});\n\n\t\tresourcesStore.attachEvent(\"onAfterUpdate\", (id, item) => {\n\t\t\tif (resourcesStore.exists(id)) {\n\t\t\t\tdp.setGanttMode(\"resource\");\n\t\t\t\tdp.setUpdated(id, true);\n\t\t\t}\n\t\t});\n\n\t\tresourcesStore.attachEvent(\"onAfterDelete\", (id, item) => {\n\t\t\tdp.setGanttMode(\"resource\");\n\n\t\t\tconst needDbDelete = !this.clientSideDelete(id, dp, gantt);\n\t\t\tif (!needDbDelete) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tdp.storeItem(item);\n\t\t\tdp.setUpdated(id, true,\"deleted\");\n\t\t});\n\n\t}\n\n\thandleBaselineCRUD(dp, gantt){\n\t\tif(!gantt.config.baselines || gantt.config.baselines.dataprocessor_baselines !== true){\n\t\t\treturn;\n\t\t}\n\n\t\tconst baselineStore = gantt.getDatastore(gantt.config.baselines.datastore);\n\n\t\tfunction insertResource(resource){\n\t\t\tconst id = resource.id;\n\t\t\tif (baselineStore.exists(id)) {\n\t\t\t\tdp.setGanttMode(\"baseline\");\n\t\t\t\tdp.setUpdated(id, true,\"inserted\");\n\t\t\t}\n\t\t}\n\n\t\tbaselineStore.attachEvent(\"onAfterAdd\", (id, item) => {\n\t\t\tinsertResource(item);\n\t\t});\n\n\t\tbaselineStore.attachEvent(\"onAfterUpdate\", (id, item) => {\n\t\t\tif (baselineStore.exists(id)) {\n\t\t\t\tdp.setGanttMode(\"baseline\");\n\t\t\t\tdp.setUpdated(id, true);\n\t\t\t}\n\t\t});\n\n\t\tbaselineStore.attachEvent(\"onAfterDelete\", (id, item) => {\n\t\t\tdp.setGanttMode(\"baseline\");\n\n\t\t\tconst needDbDelete = !this.clientSideDelete(id, dp, gantt);\n\t\t\tif (!needDbDelete) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tdp.storeItem(item);\n\t\t\tdp.setUpdated(id, true,\"deleted\");\n\t\t});\n\t}\n\n\tdetach() {\n\t\thelpers.forEach(this._dataProcessorHandlers, (e) => {\n\t\t\tthis.$gantt.detachEvent(e);\n\t\t});\n\t\tthis._dataProcessorHandlers = [];\n\t}\n}\n","import * as utils from \"../../utils/utils\";\n\nexport default class SimpleStorage {\n\tpublic static create = () : SimpleStorage => {\n\t\treturn new SimpleStorage();\n\t};\n\n\tprotected _storage: { [id: string]: any; };\n\n\tprotected constructor() {\n\t\tthis._storage = {};\n\t}\n\n\tpublic clear = (): void => {\n\t\tthis._storage = {};\n\t};\n\n\tpublic storeItem = (item: any): void => {\n\t\tthis._storage[item.id] = utils.copy(item);\n\t};\n\n\tpublic getStoredItem = (id: string): any => {\n\t\treturn this._storage[id] || null;\n\t};\n}","import eventable from \"../../utils/eventable\";\nimport * as helpers from \"../../utils/helpers\";\nimport * as utils from \"../../utils/utils\";\nimport DataProcessorEvents from \"./data_processor_events\";\nimport extendGantt from \"./extend_gantt\";\nimport SimpleStorage from \"./simple_storage\";\nimport global from \"../../utils/global\";\n\nexport interface DataProcessor { // tslint:disable-line\n\t$gantt: any;\n\tdetachAllEvents: any;\n\tattachEvent: any;\n\tcallEvent: any;\n\n\tserverProcessor: string;\n\taction_param: string;\n\tupdatedRows: any[];\n\tautoUpdate: boolean;\n\tupdateMode: string;\n\tmessages: any[];\n\tstyles: object;\n\tdnd: any;\n\tdeleteAfterConfirmation?: any;\n}\n\nexport function createDataProcessor(config: any) {\n\tlet router;\n\tlet tMode;\n\tlet headers;\n\tif (config instanceof Function) {\n\t\trouter = config;\n\t} else if (config.hasOwnProperty(\"router\")) {\n\t\trouter = config.router;\n\t} else if (config.hasOwnProperty(\"assignment\") || config.hasOwnProperty(\"baseline\") || config.hasOwnProperty(\"link\") || config.hasOwnProperty(\"task\")) {\n\t\trouter = config;\n\t} else if(config.hasOwnProperty(\"headers\")){\n\t\t// GS-2312 for custom headers\n\t\theaders = config.headers;\n\t}\n\tif (router) {\n\t\ttMode = \"CUSTOM\";\n\t} else {\n\t\ttMode = config.mode || \"REST-JSON\";\n\t}\n\tconst gantt = this; // tslint:disable-line\n\tconst dp = new DataProcessor(config.url);\n\n\n\tdp.init(gantt);\n\tdp.setTransactionMode({\n\t\tmode: tMode,\n\t\trouter,\n\t\theaders\n\t}, config.batchUpdate);\n\tif(config.deleteAfterConfirmation){\n\t\tdp.deleteAfterConfirmation = config.deleteAfterConfirmation;\n\t}\n\treturn dp;\n}\n\nexport class DataProcessor {\n\tpublic modes: object;\n\tpublic serverProcessor: string;\n\tpublic action_param: string; // tslint:disable-line\n\tpublic updatedRows: any[];\n\tpublic autoUpdate: boolean;\n\tpublic updateMode: string;\n\tpublic messages: any[];\n\tpublic styles: object;\n\tpublic dnd: any;\n\n\tprotected _tMode: string;\n\tprotected _headers: any;\n\tprotected _payload: any;\n\tprotected _postDelim: string;\n\tprotected _waitMode: number;\n\tprotected _in_progress: object; // tslint:disable-line\n\tprotected _invalid: object;\n\tprotected _storage: SimpleStorage;\n\tprotected _tSend: boolean;\n\tprotected _serializeAsJson: boolean;\n\tprotected _router: any;\n\tprotected _utf: boolean;\n\tprotected _methods: any[];\n\tprotected _user: any;\n\tprotected _uActions: object;\n\tprotected _needUpdate: boolean;\n\tprotected _ganttMode: \"task\"|\"link\";\n\tprotected _routerParametersFormat: \"parameters\"|\"object\";\n\n\tprotected _silent_mode: any; // tslint:disable-line\n\tprotected _updateBusy: any;\n\tprotected _serverProcessor: any;\n\tprotected _initialized: boolean;\n\n\tconstructor(serverProcessorURL?) {\n\t\tthis.serverProcessor = serverProcessorURL;\n\t\tthis.action_param = \"!nativeeditor_status\";\n\n\t\tthis.updatedRows = []; // ids of updated rows\n\n\t\tthis.autoUpdate = true;\n\t\tthis.updateMode = \"cell\";\n\t\tthis._headers = null;\n\t\tthis._payload = null;\n\t\tthis._postDelim = \"_\";\n\t\tthis._routerParametersFormat = \"parameters\";\n\n\t\tthis._waitMode = 0;\n\t\tthis._in_progress = {}; // ?\n\t\tthis._storage = SimpleStorage.create();\n\t\tthis._invalid = {};\n\t\tthis.messages = [];\n\n\t\tthis.styles = {\n\t\t\tupdated: \"font-weight:bold;\",\n\t\t\tinserted: \"font-weight:bold;\",\n\t\t\tdeleted: \"text-decoration : line-through;\",\n\t\t\tinvalid: \"background-color:FFE0E0;\",\n\t\t\tinvalid_cell: \"border-bottom:2px solid red;\",\n\t\t\terror: \"color:red;\",\n\t\t\tclear: \"font-weight:normal;text-decoration:none;\"\n\t\t};\n\t\tthis.enableUTFencoding(true);\n\t\teventable(this);\n\t}\n\n\tsetTransactionMode(mode:any, total?:any) {\n\t\tif (typeof mode === \"object\") {\n\t\t\tthis._tMode = mode.mode || this._tMode;\n\n\t\t\tif (utils.defined(mode.headers)) {\n\t\t\t\tthis._headers = mode.headers;\n\t\t\t}\n\n\t\t\tif (utils.defined(mode.payload)) {\n\t\t\t\tthis._payload = mode.payload;\n\t\t\t}\n\t\t\tthis._tSend = !!total;\n\t\t} else {\n\t\t\tthis._tMode = mode;\n\t\t\tthis._tSend = total;\n\t\t}\n\n\t\tif (this._tMode === \"REST\") {\n\t\t\tthis._tSend = false;\n\t\t}\n\n\t\tif (this._tMode === \"JSON\" || this._tMode === \"REST-JSON\") {\n\t\t\tthis._tSend = false;\n\t\t\tthis._serializeAsJson = true;\n\t\t\tthis._headers = this._headers || {};\n\t\t\tthis._headers[\"Content-Type\"] = \"application/json\";\n\t\t}else{\n\t\t\tif(this._headers && !this._headers[\"Content-Type\"]){\n\t\t\t\tthis._headers[\"Content-Type\"] = \"application/x-www-form-urlencoded\";\n\t\t\t}\n\t\t}\n\n\t\tif (this._tMode === \"CUSTOM\") {\n\t\t\tthis._tSend = false;\n\t\t\tthis._router = mode.router;\n\t\t}\n\t}\n\n\tescape(data:any) {\n\t\tif (this._utf) {\n\t\t\treturn encodeURIComponent(data);\n\t\t} else {\n\t\t\treturn escape(data);\n\t\t}\n\t}\n\n\t/**\n\t * @desc: allows to set escaping mode\n\t * @param: true - utf based escaping, simple - use current page encoding\n\t * @type: public\n\t */\n\tenableUTFencoding(mode:boolean) {\n\t\tthis._utf = !!mode;\n\t}\n\n\t/**\n\t * @desc: get state of updating\n\t * @returns:   true - all in sync with server, false - some items not updated yet.\n\t * @type: public\n\t */\n\tgetSyncState() {\n\t\treturn !this.updatedRows.length;\n\t}\n\n\t/**\n\t * @desc: set if rows should be send to server automatically\n\t * @param: mode - \"row\" - based on row selection changed, \"cell\" - based on cell editing finished, \"off\" - manual data sending\n\t * @type: public\n\t */\n\tsetUpdateMode(mode: string, dnd: any) {\n\t\tthis.autoUpdate = (mode === \"cell\");\n\t\tthis.updateMode = mode;\n\t\tthis.dnd = dnd;\n\t}\n\n\tignore(code: any, master: any) {\n\t\tthis._silent_mode = true;\n\t\tcode.call(master || global);\n\t\tthis._silent_mode = false;\n\t}\n\n\t/**\n\t * @desc: mark row as updated/normal. check mandatory fields, initiate autoupdate (if turned on)\n\t * @param: rowId - id of row to set update-status for\n\t * @param: state - true for \"updated\", false for \"not updated\"\n\t * @param: mode - update mode name\n\t * @type: public\n\t */\n\tsetUpdated(rowId:number|string, state: boolean, mode?: string) {\n\t\tif (this._silent_mode) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst ind = this.findRow(rowId);\n\n\t\tmode = mode || \"updated\";\n\t\tconst existing = this.$gantt.getUserData(rowId, this.action_param, this._ganttMode);\n\t\tif (existing && mode === \"updated\") {\n\t\t\tmode = existing;\n\t\t}\n\t\tif (state) {\n\t\t\tthis.set_invalid(rowId, false); // clear previous error flag\n\t\t\tthis.updatedRows[ind] = rowId;\n\t\t\tthis.$gantt.setUserData(rowId, this.action_param, mode, this._ganttMode);\n\t\t\tif (this._in_progress[rowId]) {\n\t\t\t\tthis._in_progress[rowId] = \"wait\";\n\t\t\t}\n\t\t} else {\n\t\t\tif (!this.is_invalid(rowId)) {\n\t\t\t\tthis.updatedRows.splice(ind, 1);\n\t\t\t\tthis.$gantt.setUserData(rowId, this.action_param, \"\", this._ganttMode);\n\t\t\t}\n\t\t}\n\n\t\tthis.markRow(rowId, state, mode);\n\t\tif (state && this.autoUpdate) {\n\t\t\tthis.sendData(rowId);\n\t\t}\n\t}\n\n\tmarkRow(id: number | string, state: boolean, mode: string) {\n\t\tlet str = \"\";\n\t\tconst invalid = this.is_invalid(id);\n\t\tif (invalid) {\n\t\t\tstr = this.styles[invalid];\n\t\t\tstate = true;\n\t\t}\n\t\tif (this.callEvent(\"onRowMark\", [id, state, mode, invalid])) {\n\t\t\t// default logic\n\t\t\tstr = this.styles[state ? mode : \"clear\"] + \" \" + str;\n\n\t\t\tthis.$gantt[this._methods[0]](id, str);\n\n\t\t\tif (invalid && invalid.details) {\n\t\t\t\tstr += this.styles[invalid + \"_cell\"];\n\t\t\t\tfor (let i = 0; i < invalid.details.length; i++) {\n\t\t\t\t\tif (invalid.details[i]) {\n\t\t\t\t\t\tthis.$gantt[this._methods[1]](id, i, str);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\tgetActionByState(state: string):string {\n\t\tif (state === \"inserted\") {\n\t\t\treturn \"create\";\n\t\t}\n\n\t\tif (state === \"updated\") {\n\t\t\treturn \"update\";\n\t\t}\n\n\t\tif (state === \"deleted\") {\n\t\t\treturn \"delete\";\n\t\t}\n\n\t\t// reorder\n\t\treturn \"update\";\n\t}\n\n\tgetState(id: number | string) {\n\t\treturn this.$gantt.getUserData(id, this.action_param, this._ganttMode);\n\t}\n\n\tis_invalid(id: number | string) {\n\t\treturn this._invalid[id];\n\t}\n\n\tset_invalid(id: number | string, mode: any, details?) {\n\t\tif (details) {\n\t\t\tmode = {\n\t\t\t\tvalue: mode,\n\t\t\t\tdetails,\n\t\t\t\ttoString: function() { // tslint:disable-line\n\t\t\t\t\treturn this.value.toString();\n\t\t\t\t}\n\t\t\t};\n\t\t}\n\t\tthis._invalid[id] = mode;\n\t}\n\n\t/**\n\t * @desc: check mandatory fields and verify values of cells, initiate update (if specified). Can be redefined in order to provide custom validation\n\t * @param: rowId - id of row to set update-status for\n\t * @type: public\n\t */\n\t// tslint:disable-next-line\n\tcheckBeforeUpdate(rowId: number | string) {\n\t\treturn true;\n\t}\n\n\t/**\n\t * @desc: send row(s) values to server\n\t * @param: rowId - id of row which data to send. If not specified, then all \"updated\" rows will be send\n\t * @type: public\n\t */\n\tsendData(rowId?: any) {\n\t\tif (this.$gantt.editStop) {\n\t\t\tthis.$gantt.editStop();\n\t\t}\n\n\t\tif (typeof rowId === \"undefined\" || this._tSend) {\n\n\t\t\tconst pendingUpdateModes = [];\n\t\t\tif(this.modes){\n\t\t\t\tconst knownModes = [\"task\", \"link\", \"assignment\", \"baseline\"];\n\t\t\t\tknownModes.forEach((mode) => {\n\t\t\t\t\tif(this.modes[mode] && this.modes[mode].updatedRows.length){\n\t\t\t\t\t\tpendingUpdateModes.push(mode);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tif (pendingUpdateModes.length){\n\t\t\t\tfor(let i = 0; i < pendingUpdateModes.length; i++){\n\t\t\t\t\tthis.setGanttMode(pendingUpdateModes[i]);\n\t\t\t\t\tthis.sendAllData();\n\t\t\t\t}\n\t\t\t\treturn;\n\t\t\t} else {\n\t\t\t\treturn this.sendAllData();\n\t\t\t}\n\t\t}\n\t\tif (this._in_progress[rowId]) {\n\t\t\treturn false;\n\t\t}\n\n\t\tthis.messages = [];\n\t\tif (!this.checkBeforeUpdate(rowId) && this.callEvent(\"onValidationError\", [rowId, this.messages])) {\n\t\t\treturn false;\n\t\t}\n\t\tthis._beforeSendData(this._getRowData(rowId), rowId);\n\t}\n\n\tserialize(data: any, id: any) {\n\t\tif (this._serializeAsJson) {\n\t\t\treturn  this._serializeAsJSON(data);\n\t\t}\n\n\t\tif (typeof data === \"string\") {\n\t\t\treturn data;\n\t\t}\n\t\tif (typeof id !== \"undefined\") {\n\t\t\treturn this.serialize_one(data, \"\");\n\t\t} else {\n\t\t\tconst stack = [];\n\t\t\tconst keys = [];\n\t\t\tfor (const key in data) {\n\t\t\t\tif (data.hasOwnProperty(key)) {\n\t\t\t\t\tstack.push(this.serialize_one(data[key], key + this._postDelim));\n\t\t\t\t\tkeys.push(key);\n\t\t\t\t}\n\t\t\t}\n\t\t\tstack.push(\"ids=\" + this.escape(keys.join(\",\")));\n\t\t\tif (this.$gantt.security_key) {\n\t\t\t\tstack.push(\"dhx_security=\" + this.$gantt.security_key);\n\t\t\t}\n\t\t\treturn stack.join(\"&\");\n\t\t}\n\t}\n\n\tserialize_one(data: any, pref: string) {\n\t\tif (typeof data === \"string\") {\n\t\t\treturn data;\n\t\t}\n\t\tconst stack = [];\n\t\tlet serialized = \"\";\n\t\tfor (const key in data)\n\t\t\tif (data.hasOwnProperty(key)) {\n\t\t\t\tif ((key === \"id\" ||\n\t\t\t\t\tkey == this.action_param) && // tslint:disable-line\n\t\t\t\t\tthis._tMode === \"REST\") {\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\t\t\t\tif (typeof data[key] === \"string\" || typeof data[key] === \"number\") {\n\t\t\t\t\tserialized = String(data[key]);\n\t\t\t\t} else {\n\t\t\t\t\tserialized = JSON.stringify(data[key]);\n\t\t\t\t}\n\t\t\t\tstack.push(this.escape((pref || \"\") + key) + \"=\" + this.escape(serialized));\n\t\t\t}\n\t\treturn stack.join(\"&\");\n\t}\n\n\tsendAllData() {\n\t\tif (!this.updatedRows.length) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis.messages = [];\n\t\tlet valid: any = true;\n\n\t\tthis._forEachUpdatedRow(function(rowId) {\n\t\t\tvalid = valid && this.checkBeforeUpdate(rowId);\n\t\t});\n\n\t\tif (!valid && !this.callEvent(\"onValidationError\", [\"\", this.messages])) {\n\t\t\treturn false;\n\t\t}\n\n\t\tif (this._tSend) {\n\t\t\tthis._sendData(this._getAllData());\n\t\t} else {\n\t\t\t// this.updatedRows can be spliced from onBeforeUpdate via dp.setUpdated false\n\t\t\t// use an iterator instead of for(var i = 0; i < this.updatedRows; i++) then\n\t\t\tthis._forEachUpdatedRow(function(rowId) {\n\t\t\t\tif (!this._in_progress[rowId]) {\n\t\t\t\t\tif (this.is_invalid(rowId)) {\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t\tthis._beforeSendData(this._getRowData(rowId), rowId);\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t}\n\n\tfindRow(pattern: any) {\n\t\tlet i = 0;\n\t\tfor (i = 0; i < this.updatedRows.length; i++) {\n\t\t\tif (pattern == this.updatedRows[i]) { // tslint:disable-line\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t\treturn i;\n\t}\n\n\t/**\n\t * @desc: define custom actions\n\t * @param: name - name of action, same as value of action attribute\n\t * @param: handler - custom function, which receives a XMl response content for action\n\t * @type: private\n\t */\n\tdefineAction(name: string, handler: any) {\n\t\tif (!this._uActions) {\n\t\t\tthis._uActions = {};\n\t\t}\n\t\tthis._uActions[name] = handler;\n\t}\n\n\t/**\n\t * @desc: used in combination with setOnBeforeUpdateHandler to create custom client-server transport system\n\t * @param: sid - id of item before update\n\t * @param: tid - id of item after up0ate\n\t * @param: action - action name\n\t * @type: public\n\t * @topic: 0\n\t */\n\tafterUpdateCallback(sid: number | string, tid: number | string, action: string, btag: any, ganttMode: string) {\n\t\tif(!this.$gantt){\n\t\t\t// destructor has been called before the callback\n\t\t\treturn;\n\t\t}\n\n\t\tthis.setGanttMode(ganttMode);\n\n\t\tconst marker = sid;\n\t\tconst correct = (action !== \"error\" && action !== \"invalid\");\n\t\tif (!correct) {\n\t\t\tthis.set_invalid(sid, action);\n\t\t}\n\t\tif ((this._uActions) && (this._uActions[action]) && (!this._uActions[action](btag))) {\n\t\t\treturn (delete this._in_progress[marker]);\n\t\t}\n\n\t\tif (this._in_progress[marker] !== \"wait\") {\n\t\t\tthis.setUpdated(sid, false);\n\t\t}\n\n\t\tconst originalSid = sid;\n\n\t\tswitch (action) {\n\t\t\tcase \"inserted\":\n\t\t\tcase \"insert\":\n\t\t\t\tif (tid != sid) { // tslint:disable-line\n\t\t\t\t\tthis.setUpdated(sid, false);\n\t\t\t\t\tthis.$gantt[this._methods[2]](sid, tid);\n\t\t\t\t\tsid = tid;\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\tcase \"delete\":\n\t\t\tcase \"deleted\":\n\t\t\t\tif(!this.deleteAfterConfirmation || this._ganttMode !== \"task\"){\n\t\t\t\t\tthis.$gantt.setUserData(sid, this.action_param, \"true_deleted\", this._ganttMode);\n\t\t\t\t\tthis.$gantt[this._methods[3]](sid);\n\t\t\t\t\tdelete this._in_progress[marker];\n\t\t\t\t\treturn this.callEvent(\"onAfterUpdate\", [sid, action, tid, btag]);\n\t\t\t\t}else{\n\t\t\t\t\tif (this._ganttMode === \"task\" && this.$gantt.isTaskExists(sid)) {\n\t\t\t\t\t\tthis.$gantt.setUserData(sid, this.action_param, \"true_deleted\", this._ganttMode);\n\t\t\t\t\t\tconst task = this.$gantt.getTask(sid);\n\t\t\t\t\t\tthis.$gantt.silent(() => {\n\t\t\t\t\t\t\tthis.$gantt.deleteTask(sid);\n\t\t\t\t\t\t});\n\t\t\t\t\t\tthis.$gantt.callEvent(\"onAfterTaskDelete\", [sid, task]);\n\t\t\t\t\t\tthis.$gantt.render();\n\t\t\t\t\t\tdelete this._in_progress[marker];\n\t\t\t\t\t}\n\t\t\t\t\treturn this.callEvent(\"onAfterUpdate\", [sid, action, tid, btag]);\n\t\t\t\t}\n\n\t\t}\n\n\t\tif (this._in_progress[marker] !== \"wait\") {\n\t\t\tif (correct) {\n\t\t\t\tthis.$gantt.setUserData(sid, this.action_param, \"\", this._ganttMode);\n\t\t\t}\n\t\t\tdelete this._in_progress[marker];\n\t\t} else {\n\t\t\tdelete this._in_progress[marker];\n\t\t\tthis.setUpdated(tid, true, this.$gantt.getUserData(sid, this.action_param, this._ganttMode));\n\t\t}\n\n\t\tthis.callEvent(\"onAfterUpdate\", [originalSid, action, tid, btag]);\n\t}\n\n\t/**\n\t * @desc: response from server\n\t * @param: xml - XMLLoader object with response XML\n\t * @type: private\n\t */\n\tafterUpdate(that: any, xml: any, id?:any) {\n\t\tlet _xml;\n\t\tif (arguments.length === 3) {\n\t\t\t_xml = arguments[1];\n\t\t} else {\n\t\t\t// old dataprocessor\n\t\t\t_xml = arguments[4];\n\t\t}\n\t\tlet mode = this.getGanttMode();\n\t\tconst reqUrl = _xml.filePath || _xml.url;\n\n\t\tif (this._tMode !== \"REST\" && this._tMode !== \"REST-JSON\") {\n\t\t\tif (reqUrl.indexOf(\"gantt_mode=links\") !== -1) {\n\t\t\t\tmode = \"link\";\n\t\t\t} else if (reqUrl.indexOf(\"gantt_mode=assignments\") !== -1) {\n\t\t\t\tmode = \"assignment\";\n\t\t\t} else if (reqUrl.indexOf(\"gantt_mode=baselines\") !== -1) {\n\t\t\t\tmode = \"baseline\";\n\t\t\t} else {\n\t\t\t\tmode = \"task\";\n\t\t\t}\n\t\t} else {\n\t\t\tif (reqUrl.indexOf(\"/link\") >= 0) {\n\t\t\t\tmode = \"link\";\n\t\t\t} else if(reqUrl.indexOf(\"/assignment\") >= 0){\n\t\t\t\tmode = \"assignment\";\n\t\t\t} else if(reqUrl.indexOf(\"/baseline\") >= 0){\n\t\t\t\tmode = \"baseline\";\n\t\t\t} else {\n\t\t\t\tmode = \"task\";\n\t\t\t}\n\t\t}\n\t\tthis.setGanttMode(mode);\n\n\t\tconst ajax = this.$gantt.ajax;\n\t\t// try to use json first\n\t\tlet tag;\n\n\t\ttry {\n\t\t\ttag = JSON.parse(xml.xmlDoc.responseText);\n\t\t// eslint-disable-next-line @typescript-eslint/no-unused-vars\n\t\t} catch (e) {\n\n\t\t\t// empty response also can be processed by json handler\n\t\t\tif (!xml.xmlDoc.responseText.length) {\n\t\t\t\ttag = {};\n\t\t\t}\n\t\t}\n\n\t\tconst processCallback = (itemId: any) => {\n\t\t\tconst action = tag.action || this.getState(itemId) || \"updated\";\n\t\t\tconst sid = tag.sid || itemId[0];\n\t\t\tconst tid = tag.tid || itemId[0];\n\t\t\tthat.afterUpdateCallback(sid, tid, action, tag, mode);\n\t\t};\n\t\tif (tag) {\n\t\t\t// GS-753. When multiple tasks are updated, unhighlight all of them\n\t\t\tif (Array.isArray(id) && id.length > 1) {\n\t\t\t\tid.forEach((taskId) => processCallback(taskId));\n\t\t\t} else {\n\t\t\t\tprocessCallback(id);\n\t\t\t}\n\t\t\tthat.finalizeUpdate();\n\t\t\tthis.setGanttMode(mode);\n\t\t\treturn;\n\t\t}\n\n\t\t// xml response\n\t\tconst top = ajax.xmltop(\"data\", xml.xmlDoc); // fix incorrect content type in IE\n\t\tif (!top) {\n\t\t\treturn this.cleanUpdate(id);\n\t\t}\n\t\tconst atag = ajax.xpath(\"//data/action\", top);\n\t\tif (!atag.length) {\n\t\t\treturn this.cleanUpdate(id);\n\t\t}\n\n\t\tfor (let i = 0; i < atag.length; i++) {\n\t\t\tconst btag = atag[i];\n\t\t\tconst action = btag.getAttribute(\"type\");\n\t\t\tconst sid = btag.getAttribute(\"sid\");\n\t\t\tconst tid = btag.getAttribute(\"tid\");\n\n\t\t\tthat.afterUpdateCallback(sid, tid, action, btag, mode);\n\t\t}\n\t\tthat.finalizeUpdate();\n\t}\n\n\tcleanUpdate(id: any[]) {\n\t\tif (id) {\n\t\t\tfor (let i = 0; i < id.length; i++) {\n\t\t\t\tdelete this._in_progress[id[i]];\n\t\t\t}\n\t\t}\n\t}\n\n\tfinalizeUpdate() {\n\t\tif (this._waitMode) {\n\t\t\tthis._waitMode--;\n\t\t}\n\n\t\tthis.callEvent(\"onAfterUpdateFinish\", []);\n\t\tif (!this.updatedRows.length) {\n\t\t\tthis.callEvent(\"onFullSync\", []);\n\t\t}\n\t}\n\n\t/**\n\t * @desc: initializes data-processor\n\t * @param: gantt - dhtmlxGantt object to attach this data-processor to\n\t * @type: public\n\t */\n\tinit(gantt: any) {\n\t\tif (this._initialized) {\n\t\t\treturn;\n\t\t}\n\t\tthis.$gantt = gantt;\n\t\tif (this.$gantt._dp_init) {\n\t\t\tthis.$gantt._dp_init(this);\n\t\t}\n\n\t\tthis._setDefaultTransactionMode();\n\n\t\tthis.styles = {\n\t\t\tupdated:\"gantt_updated\",\n\t\t\torder:\"gantt_updated\",\n\t\t\tinserted:\"gantt_inserted\",\n\t\t\tdeleted:\"gantt_deleted\",\n\t\t\tdelete_confirmation:\"gantt_deleted\",\n\t\t\tinvalid:\"gantt_invalid\",\n\t\t\terror:\"gantt_error\",\n\t\t\tclear:\"\"\n\t\t};\n\n\t\tthis._methods=[\"_row_style\",\"setCellTextStyle\",\"_change_id\",\"_delete_task\"];\n\t\textendGantt(this.$gantt, this);\n\t\tconst dataProcessorEvents = new DataProcessorEvents(this.$gantt, this);\n\t\tdataProcessorEvents.attach();\n\t\tthis.attachEvent(\"onDestroy\", function() {\n\t\t\tdelete this.setGanttMode;\n\t\t\tdelete this._getRowData;\n\n\t\t\tdelete this.$gantt._dp;\n\t\t\tdelete this.$gantt._change_id;\n\t\t\tdelete this.$gantt._row_style;\n\t\t\tdelete this.$gantt._delete_task;\n\t\t\tdelete this.$gantt._sendTaskOrder;\n\t\t\tdelete this.$gantt;\n\n\t\t\tdataProcessorEvents.detach();\n\t\t});\n\t\tthis.$gantt.callEvent(\"onDataProcessorReady\", [this]);\n\t\tthis._initialized = true;\n\t}\n\n\tsetOnAfterUpdate(handler) {\n\t\tthis.attachEvent(\"onAfterUpdate\", handler);\n\t}\n\n\tsetOnBeforeUpdateHandler(handler) {\n\t\tthis.attachEvent(\"onBeforeDataSending\", handler);\n\t}\n\n\t/* starts autoupdate mode\n\t\t@param interval time interval for sending update requests\n\t*/\n\tsetAutoUpdate(interval, user) {\n\t\tinterval = interval || 2000;\n\n\t\tthis._user = user || (new Date()).valueOf();\n\t\tthis._needUpdate = false;\n\n\t\tthis._updateBusy = false;\n\n\t\tthis.attachEvent(\"onAfterUpdate\", this.afterAutoUpdate); // arguments sid, action, tid, xml_node;\n\n\t\tthis.attachEvent(\"onFullSync\", this.fullSync);\n\n\t\tsetInterval(() => {\n\t\t\tthis.loadUpdate();\n\t\t}, interval);\n\t}\n\n\t/* process updating request response\n\t\tif status == collision version is deprecated\n\t\tset flag for autoupdating immediately\n\t*/\n\tafterAutoUpdate(sid, action, tid, xml_node) { // tslint:disable-line\n\t\tif (action === \"collision\") {\n\t\t\tthis._needUpdate = true;\n\t\t\treturn false;\n\t\t} else {\n\t\t\treturn true;\n\t\t}\n\t}\n\n\t/* callback function for onFillSync event\n\t\tcall update function if it's need\n\t*/\n\tfullSync() {\n\t\tif (this._needUpdate) {\n\t\t\tthis._needUpdate = false;\n\t\t\tthis.loadUpdate();\n\t\t}\n\t\treturn true;\n\t}\n\n\t/* sends query to the server and call callback function\n\t*/\n\tgetUpdates(url, callback) {\n\t\tconst ajax = this.$gantt.ajax;\n\t\tif (this._updateBusy) {\n\t\t\treturn false;\n\t\t} else {\n\t\t\tthis._updateBusy = true;\n\t\t}\n\n\t\tajax.get(url, callback);\n\n\t}\n\n\t/* loads updates and processes them\n\t*/\n\tloadUpdate() {\n\t\tconst ajax = this.$gantt.ajax;\n\t\tconst version = this.$gantt.getUserData(0, \"version\", this._ganttMode);\n\t\tlet url = this.serverProcessor + ajax.urlSeparator(this.serverProcessor) + [\"dhx_user=\" + this._user, \"dhx_version=\" + version].join(\"&\");\n\t\turl = url.replace(\"editing=true&\", \"\");\n\t\tthis.getUpdates(url, (xml) => {\n\t\t\tconst vers = ajax.xpath(\"//userdata\", xml);\n\t\t\tthis.$gantt.setUserData(0, \"version\", this._getXmlNodeValue(vers[0]), this._ganttMode);\n\n\t\t\tconst updates = ajax.xpath(\"//update\", xml);\n\t\t\tif (updates.length) {\n\t\t\t\tthis._silent_mode = true;\n\n\t\t\t\tfor (let i = 0; i < updates.length; i++) {\n\t\t\t\t\tconst status = updates[i].getAttribute(\"status\");\n\t\t\t\t\tconst id = updates[i].getAttribute(\"id\");\n\t\t\t\t\tconst parent = updates[i].getAttribute(\"parent\");\n\t\t\t\t\tswitch (status) {\n\t\t\t\t\t\tcase \"inserted\":\n\t\t\t\t\t\t\tthis.callEvent(\"insertCallback\", [updates[i], id, parent]);\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\tcase \"updated\":\n\t\t\t\t\t\t\tthis.callEvent(\"updateCallback\", [updates[i], id, parent]);\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\tcase \"deleted\":\n\t\t\t\t\t\t\tthis.callEvent(\"deleteCallback\", [updates[i], id, parent]);\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tthis._silent_mode = false;\n\t\t\t}\n\n\t\t\tthis._updateBusy = false;\n\t\t});\n\t}\n\n\tdestructor() {\n\t\tthis.callEvent(\"onDestroy\", []);\n\t\tthis.detachAllEvents();\n\n\t\tthis.updatedRows = [];\n\t\tthis._in_progress = {}; // ?\n\t\tthis._invalid = {};\n\t\tthis._storage.clear();\n\t\tthis._storage = null;\n\t\tthis._headers = null;\n\t\tthis._payload = null;\n\t\tdelete this._initialized;\n\t}\n\n\tsetGanttMode(mode) {\n\t\tif (mode === \"tasks\") {\n\t\t\tmode = \"task\";\n\t\t} else if (mode === \"links\") {\n\t\t\tmode = \"link\";\n\t\t}\n\n\t\tconst modes = this.modes || {};\n\t\tconst ganttMode = this.getGanttMode();\n\t\tif (ganttMode) {\n\t\t\tmodes[ganttMode] = {\n\t\t\t\t_in_progress : this._in_progress,\n\t\t\t\t_invalid: this._invalid,\n\t\t\t\t_storage: this._storage,\n\t\t\t\tupdatedRows : this.updatedRows\n\t\t\t};\n\t\t}\n\n\t\tlet newState = modes[mode];\n\t\tif (!newState) {\n\t\t\tnewState = modes[mode] = {\n\t\t\t\t_in_progress : {},\n\t\t\t\t_invalid : {},\n\t\t\t\t_storage : SimpleStorage.create(),\n\t\t\t\tupdatedRows : []\n\t\t\t};\n\t\t}\n\t\tthis._in_progress = newState._in_progress;\n\t\tthis._invalid = newState._invalid;\n\t\tthis._storage = newState._storage;\n\t\tthis.updatedRows = newState.updatedRows;\n\t\tthis.modes = modes;\n\t\tthis._ganttMode = mode;\n\t}\n\tgetGanttMode():string {\n\t\treturn this._ganttMode;\n\t}\n\n\tstoreItem(item) {\n\t\tthis._storage.storeItem(item);\n\t}\n\n\turl(url: string) {\n\t\tthis.serverProcessor = this._serverProcessor = url;\n\t}\n\n\tprotected _beforeSendData(data: any, rowId: any) {\n\t\tif (!this.callEvent(\"onBeforeUpdate\", [rowId, this.getState(rowId), data])) {\n\t\t\treturn false;\n\t\t}\n\t\tthis._sendData(data, rowId);\n\t}\n\n\tprotected _serializeAsJSON(data: any) {\n\t\tif (typeof data === \"string\") {\n\t\t\treturn data;\n\t\t}\n\n\t\tconst copy = utils.copy(data);\n\t\tif (this._tMode === \"REST-JSON\") {\n\t\t\tdelete copy.id;\n\t\t\tdelete copy[this.action_param];\n\t\t}\n\n\t\treturn JSON.stringify(copy);\n\t}\n\n\tprotected _applyPayload(url: string) {\n\t\tconst ajax = this.$gantt.ajax;\n\t\tif (this._payload) {\n\t\t\tfor (const key in this._payload) {\n\t\t\t\turl = url + ajax.urlSeparator(url) + this.escape(key) + \"=\" + this.escape(this._payload[key]);\n\t\t\t}\n\t\t}\n\t\treturn url;\n\t}\n\n\t// GET/POST/JSON modes of the dataProcessor didn't send the whole data items in 'delete' requests\n\t// clear extra info from the data in order not to change the request format\n\tprotected _cleanupArgumentsBeforeSend(dataToSend: any) {\n\t\tlet processedData;\n\t\tif(dataToSend[this.action_param] === undefined){// hash of updated items, and not an individual item\n\t\t\tprocessedData = {};\n\t\t\tfor(const i in dataToSend) {\n\t\t\t\tprocessedData[i] = this._cleanupArgumentsBeforeSend(dataToSend[i]);\n\t\t\t}\n\t\t} else {\n\t\t\tprocessedData = this._cleanupItemBeforeSend(dataToSend);\n\t\t}\n\t\treturn processedData;\n\t}\n\tprotected _cleanupItemBeforeSend(updatedItem: any) {\n\t\tlet output = null;\n\t\tif(updatedItem){\n\t\t\tif(updatedItem[this.action_param] === \"deleted\"){\n\t\t\t\toutput = {};\n\t\t\t\toutput.id = updatedItem.id;\n\t\t\t\toutput[this.action_param] = updatedItem[this.action_param];\n\t\t\t}else{\n\t\t\t\toutput = updatedItem;\n\t\t\t}\n\t\t}\n\n\t\treturn output;\n\t}\n\n\tprotected _sendData(dataToSend: any, rowId?: any) {\n\t\tif (!dataToSend) {\n\t\t\treturn; // nothing to send\n\t\t}\n\t\tif (!this.callEvent(\"onBeforeDataSending\", rowId ? [rowId, this.getState(rowId), dataToSend] : [null, null, dataToSend])) {\n\t\t\treturn false;\n\t\t}\n\n\t\tif (rowId) {\n\t\t\tthis._in_progress[rowId] = (new Date()).valueOf();\n\t\t}\n\n\t\tconst ajax = this.$gantt.ajax;\n\n\t\tif (this._tMode === \"CUSTOM\") {\n\t\t\tconst taskState = this.getState(rowId);\n\t\t\tconst taskAction = this.getActionByState(taskState);\n\t\t\tconst ganttMode = this.getGanttMode();\n\t\t\tconst _onResolvedCreateUpdate = (tag) => {\n\t\t\t\tlet action = taskState || \"updated\";\n\t\t\t\tlet sid = rowId;\n\t\t\t\tlet tid = rowId;\n\n\t\t\t\tif (tag) {\n\t\t\t\t\taction = tag.action || taskState;\n\t\t\t\t\tsid = tag.sid || sid;\n\t\t\t\t\ttid = tag.id || tag.tid || tid;\n\t\t\t\t}\n\t\t\t\tthis.afterUpdateCallback(sid, tid, action, tag, ganttMode);\n\t\t\t};\n\n\t\t\tlet actionPromise;\n\t\t\tif (this._router instanceof Function) {\n\t\t\t\tif(this._routerParametersFormat === \"object\"){\n\t\t\t\t\tconst obj = {\n\t\t\t\t\t\tentity: ganttMode,\n\t\t\t\t\t\taction: taskAction,\n\t\t\t\t\t\tdata: dataToSend,\n\t\t\t\t\t\tid: rowId\n\t\t\t\t\t};\n\t\t\t\t\tactionPromise = this._router(obj);\n\t\t\t\t} else {\n\t\t\t\t\tactionPromise = this._router(ganttMode, taskAction, dataToSend, rowId);\n\t\t\t\t}\n\t\t\t} else if (this._router[ganttMode] instanceof Function) {\n\t\t\t\tactionPromise = this._router[ganttMode](taskAction, dataToSend, rowId);\n\t\t\t} else {\n\n\t\t\t\tconst errorMsgStart = \"Incorrect configuration of gantt.createDataProcessor\";\n\t\t\t\tconst errorMsgEnd = `\nYou need to either add missing properties to the dataProcessor router object or to use a router function.\nSee https://docs.dhtmlx.com/gantt/desktop__server_side.html#customrouting and https://docs.dhtmlx.com/gantt/api__gantt_createdataprocessor.html for details.`;\n\n\t\t\t\tif(!this._router[ganttMode]){\n\t\t\t\t\tthrow new Error(`${errorMsgStart}: router for the **${ganttMode}** entity is not defined. ${errorMsgEnd}`);\n\t\t\t\t}\n\t\t\t\tswitch (taskState) {\n\t\t\t\t\tcase \"inserted\":\n\t\t\t\t\t\tif(!this._router[ganttMode].create){\n\t\t\t\t\t\t\tthrow new Error(`${errorMsgStart}: **create** action for the **${ganttMode}** entity is not defined. ${errorMsgEnd}`);\n\t\t\t\t\t\t}\n\t\t\t\t\t\tactionPromise = this._router[ganttMode].create(dataToSend);\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase \"deleted\":\n\t\t\t\t\t\tif(!this._router[ganttMode].delete){\n\t\t\t\t\t\t\tthrow new Error(`${errorMsgStart}: **delete** action for the **${ganttMode}** entity is not defined. ${errorMsgEnd}`);\n\t\t\t\t\t\t}\n\t\t\t\t\t\tactionPromise = this._router[ganttMode].delete(rowId);\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tdefault:\n\t\t\t\t\t\tif(!this._router[ganttMode].update){\n\t\t\t\t\t\t\tthrow new Error(`${errorMsgStart}: **update**\" action for the **${ganttMode}** entity is not defined. ${errorMsgEnd}`);\n\t\t\t\t\t\t}\n\t\t\t\t\t\tactionPromise = this._router[ganttMode].update(dataToSend, rowId);\n\t\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif(actionPromise){\n\t\t\t\t// neither promise nor {tid: newId} response object\n\t\t\t\tif(!actionPromise.then &&\n\t\t\t\t\t(actionPromise.id === undefined && actionPromise.tid === undefined && actionPromise.action === undefined)){\n\t\t\t\t\tthrow new Error(\"Incorrect router return value. A Promise or a response object is expected\");\n\t\t\t\t}\n\n\t\t\t\tif(actionPromise.then){\n\t\t\t\t\tactionPromise.then(_onResolvedCreateUpdate).catch((error) => {\n\t\t\t\t\t\tif(error && error.action){\n\t\t\t\t\t\t\t_onResolvedCreateUpdate(error);\n\t\t\t\t\t\t}else{\n\t\t\t\t\t\t\t_onResolvedCreateUpdate({ action: \"error\", value: error});\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t}else{\n\t\t\t\t\t// custom method may return a response object in case of sync action\n\t\t\t\t\t_onResolvedCreateUpdate(actionPromise);\n\t\t\t\t}\n\t\t\t}else{\n\t\t\t\t_onResolvedCreateUpdate(null);\n\t\t\t}\n\t\t\treturn;\n\t\t}\n\n\t\tlet queryParams: any;\n\t\tqueryParams = {\n\t\t\tcallback: (xml) => {\n\t\t\t\tconst ids = [];\n\n\t\t\t\tif (rowId) {\n\t\t\t\t\tids.push(rowId);\n\t\t\t\t} else if (dataToSend) {\n\t\t\t\t\tfor (const key in dataToSend) {\n\t\t\t\t\t\tids.push(key);\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\treturn this.afterUpdate(this, xml, ids);\n\t\t\t},\n\t\t\theaders: this._headers\n\t\t};\n\n\t\tconst dhxVersion = \"dhx_version=\" + this.$gantt.getUserData(0, \"version\", this._ganttMode);\n\t\tconst urlParams = this.serverProcessor + (this._user ? (ajax.urlSeparator(this.serverProcessor) + [\"dhx_user=\" + this._user, dhxVersion].join(\"&\")) : \"\");\n\t\tlet url: any = this._applyPayload(urlParams);\n\t\tlet data;\n\n\t\tswitch (this._tMode) {\n\t\t\tcase \"GET\":\n\t\t\t\tdata = this._cleanupArgumentsBeforeSend(dataToSend);\n\t\t\t\tqueryParams.url = url + ajax.urlSeparator(url) + this.serialize(data, rowId);\n\t\t\t\tqueryParams.method = \"GET\";\n\t\t\t\tbreak;\n\t\t\tcase \"POST\":\n\t\t\t\tdata = this._cleanupArgumentsBeforeSend(dataToSend);\n\t\t\t\tqueryParams.url = url;\n\t\t\t\tqueryParams.method = \"POST\";\n\t\t\t\tqueryParams.data = this.serialize(data, rowId);\n\t\t\t\tbreak;\n\t\t\tcase \"JSON\":\n\t\t\t\tdata = {};\n\t\t\t\tconst preprocessedData = this._cleanupItemBeforeSend(dataToSend);\n\t\t\t\tfor (const key in preprocessedData) {\n\t\t\t\t\tif (key === this.action_param || key === \"id\" || key === \"gr_id\") {\n\t\t\t\t\t\tcontinue;\n\t\t\t\t\t}\n\t\t\t\t\tdata[key] = preprocessedData[key];\n\t\t\t\t}\n\n\t\t\t\tqueryParams.url = url;\n\t\t\t\tqueryParams.method = \"POST\";\n\t\t\t\tqueryParams.data = JSON.stringify({\n\t\t\t\t\tid: rowId,\n\t\t\t\t\taction: dataToSend[this.action_param],\n\t\t\t\t\tdata\n\t\t\t\t});\n\t\t\t\tbreak;\n\t\t\tcase \"REST\":\n\t\t\tcase \"REST-JSON\":\n\t\t\t\turl = urlParams.replace(/(&|\\?)editing=true/, \"\");\n\t\t\t\tdata = \"\";\n\n\t\t\t\tswitch (this.getState(rowId)) {\n\t\t\t\t\tcase \"inserted\":\n\t\t\t\t\t\tqueryParams.method = \"POST\";\n\t\t\t\t\t\tqueryParams.data = this.serialize(dataToSend, rowId);\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase \"deleted\":\n\t\t\t\t\t\tqueryParams.method = \"DELETE\";\n\t\t\t\t\t\turl = url + (url.slice(-1) === \"/\" ? \"\" : \"/\") + rowId;\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tdefault:\n\t\t\t\t\t\tqueryParams.method = \"PUT\";\n\t\t\t\t\t\tqueryParams.data = this.serialize(dataToSend, rowId);\n\t\t\t\t\t\turl = url + (url.slice(-1) === \"/\" ? \"\" : \"/\") + rowId;\n\t\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t\tqueryParams.url = this._applyPayload(url);\n\t\t\t\tbreak;\n\t\t}\n\n\t\tthis._waitMode++;\n\t\treturn ajax.query(queryParams);\n\t}\n\n\tprotected _forEachUpdatedRow(code: any) {\n\t\tconst updatedRows = this.updatedRows.slice();\n\t\tfor (let i = 0; i < updatedRows.length; i++) {\n\t\t\tconst rowId = updatedRows[i];\n\t\t\tif (this.$gantt.getUserData(rowId, this.action_param, this._ganttMode)) {\n\t\t\t\tcode.call(this, rowId);\n\t\t\t}\n\t\t}\n\t}\n\n\tprotected _setDefaultTransactionMode() {\n\t\tif (this.serverProcessor) {\n\t\t\tthis.setTransactionMode(\"POST\", true);\n\t\t\tthis.serverProcessor += (this.serverProcessor.indexOf(\"?\") !== -1 ? \"&\" : \"?\") + \"editing=true\";\n\t\t\tthis._serverProcessor = this.serverProcessor;\n\t\t}\n\t}\n\n\t/* returns xml node value\n\t\t@param node\n\t\t\txml node\n\t*/\n\tprotected _getXmlNodeValue(node) {\n\t\tif (node.firstChild) {\n\t\t\treturn node.firstChild.nodeValue;\n\t\t}\n\t\treturn \"\";\n\t}\n\n\tprotected _getAllData() {\n\t\tconst out = {};\n\t\tlet hasOne = false;\n\n\t\tthis._forEachUpdatedRow(function(id) {\n\t\t\tif (this._in_progress[id] || this.is_invalid(id)){\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tconst row = this._getRowData(id);\n\t\t\tif (!this.callEvent(\"onBeforeUpdate\", [id, this.getState(id), row])) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tout[id] = row;\n\t\t\thasOne = true;\n\t\t\tthis._in_progress[id] = (new Date()).valueOf();\n\t\t});\n\n\t\treturn hasOne ? out : null;\n\t}\n\n\tprotected _prepareDate(value: Date) : string {\n\t\treturn this.$gantt.defined(this.$gantt.templates.xml_format) ? this.$gantt.templates.xml_format(value) : this.$gantt.templates.format_date(value);\n\t}\n\n\tprotected _prepareArray(value: any[], traversedObjects: object[]) : any[] {\n\t\ttraversedObjects.push(value);\n\n\t\treturn value.map((item) => {\n\t\t\tif(helpers.isDate(item)){\n\t\t\t\treturn this._prepareDate(item);\n\t\t\t} else if (Array.isArray(item) && !helpers.arrayIncludes(traversedObjects, item)){\n\t\t\t\treturn this._prepareArray(item, traversedObjects);\n\t\t\t} else if (item && typeof item === \"object\" && !helpers.arrayIncludes(traversedObjects, item)) {\n\t\t\t\treturn this._prepareObject(item, traversedObjects);\n\t\t\t} else {\n\t\t\t\treturn item;\n\t\t\t}\n\t\t});\n\t}\n\n\tprotected _prepareObject(rawItem: any, traversedObjects: object[]) : any {\n\t\tconst processedItem = {};\n\t\ttraversedObjects.push(rawItem);\n\n\t\tfor (const key in rawItem) {\n\t\t\tif (key.substr(0, 1) === \"$\") {\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tconst value = rawItem[key];\n\t\t\tif (helpers.isDate(value)) {\n\t\t\t\tprocessedItem[key] = this._prepareDate(value);\n\t\t\t} else if(value === null) {\n\t\t\t\tprocessedItem[key] = \"\";\n\t\t\t} else if (Array.isArray(value) && !helpers.arrayIncludes(traversedObjects, value)){\n\t\t\t\tprocessedItem[key] = this._prepareArray(value, traversedObjects);\n\t\t\t} else if (value && typeof value === \"object\" && !helpers.arrayIncludes(traversedObjects, value)) {\n\t\t\t\tprocessedItem[key] = this._prepareObject(value, traversedObjects);\n\t\t\t} else {\n\t\t\t\tprocessedItem[key] = value;\n\t\t\t}\n\t\t}\n\t\treturn processedItem;\n\t}\n\n\tprotected _prepareDataItem(rawItem: any): any {\n\t\tconst processedItem = this._prepareObject(rawItem, []);\n\n\t\tprocessedItem[this.action_param] = this.$gantt.getUserData(rawItem.id, this.action_param, this._ganttMode);\n\t\treturn processedItem;\n\t}\n\n\tprotected getStoredItem(id){\n\t\treturn this._storage.getStoredItem(id);\n\t}\n\n\tprotected _getRowData(id) {\n\t\tlet dataItem;\n\t\tconst gantt = this.$gantt;\n\t\tif (this.getGanttMode() === \"task\") {\n\t\t\tif(gantt.isTaskExists(id)){\n\t\t\t\tdataItem =this.$gantt.getTask(id);\n\t\t\t}\n\t\t} else if (this.getGanttMode() === \"assignment\") {\n\t\t\tif(this.$gantt.$data.assignmentsStore.exists(id)){\n\t\t\t\tdataItem =this.$gantt.$data.assignmentsStore.getItem(id);\n\t\t\t}\n\t\t} else if (this.getGanttMode() === \"baseline\") {\n\t\t\tif(this.$gantt.$data.baselineStore.exists(id)){\n\t\t\t\tdataItem =this.$gantt.$data.baselineStore.getItem(id);\n\t\t\t}\n\t\t} else {\n\t\t\tif(gantt.isLinkExists(id)){\n\t\t\t\tdataItem =this.$gantt.getLink(id);\n\t\t\t}\n\t\t}\n\n\t\tif (!dataItem) {\n\t\t\tdataItem = this.getStoredItem(id);\n\t\t}\n\n\t\tif (!dataItem) {\n\t\t\tdataItem = { id };\n\t\t}\n\n\t\treturn this._prepareDataItem(dataItem);\n\t}\n}","\nexport default function extendGantt(gantt: any, dp: any) {\n\tgantt.getUserData = function(id, name, store) {\n\t\tif (!this.userdata) {\n\t\t\tthis.userdata = {};\n\t\t}\n\t\tthis.userdata[store] = this.userdata[store] || {};\n\t\tif (this.userdata[store][id] && this.userdata[store][id][name]) {\n\t\t\treturn this.userdata[store][id][name];\n\t\t}\n\t\treturn \"\";\n\t};\n\tgantt.setUserData = function(id, name, value, store) {\n\t\tif (!this.userdata) {\n\t\t\tthis.userdata = {};\n\t\t}\n\t\tthis.userdata[store] = this.userdata[store] || {};\n\t\tthis.userdata[store][id] = this.userdata[store][id] || {};\n\t\tthis.userdata[store][id][name] = value;\n\t};\n\n\tgantt._change_id = function(oldId, newId) {\n\t\tswitch (this._dp._ganttMode) {\n\t\t\tcase \"task\":\n\t\t\t\tthis.changeTaskId(oldId, newId);\n\t\t\t\tbreak;\n\t\t\tcase \"link\":\n\t\t\t\tthis.changeLinkId(oldId, newId);\n\t\t\t\tbreak;\n\t\t\tcase \"assignment\":\n\t\t\t\tthis.$data.assignmentsStore.changeId(oldId, newId);\n\t\t\t\tbreak;\n\t\t\tcase \"resource\":\n\t\t\t\tthis.$data.resourcesStore.changeId(oldId, newId);\n\t\t\t\tbreak;\n\t\t\tcase \"baseline\":\n\t\t\t\tthis.$data.baselineStore.changeId(oldId, newId);\n\t\t\t\tbreak;\n\t\t\tdefault:\n\t\t\t\tthrow new Error(`Invalid mode of the dataProcessor after database id is received: ${this._dp._ganttMode}, new id: ${newId}`);\n\t\t}\n\t};\n\n\tgantt._row_style = function(rowId, classname){\n\t\tif (this._dp._ganttMode !== \"task\") {\n\t\t\treturn;\n\t\t}\n\t\tif (!gantt.isTaskExists(rowId)) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst task = gantt.getTask(rowId);\n\t\ttask.$dataprocessor_class = classname;\n\t\tgantt.refreshTask(rowId);\n\t};\n\n\t// fake method for dataprocessor\n\tgantt._delete_task = function(rowId, node) {}; // tslint:disable-line\n\n\tgantt._sendTaskOrder = function(id, item){\n\t\tif (item.$drop_target) {\n\t\t\tthis._dp.setGanttMode(\"task\");\n\t\t\tthis.getTask(id).target = item.$drop_target;\n\t\t\tthis._dp.setUpdated(id, true,\"order\");\n\t\t\tdelete this.getTask(id).$drop_target;\n\t\t}\n\t};\n\n\tgantt.setDp = function() {\n\t\tthis._dp = dp;\n\t};\n\n\tgantt.setDp();\n}","import * as DataProcessor from \"./data_processor\";\nexport default {\n\tDEPRECATED_api: function(server) {\n\t\treturn new (DataProcessor.DataProcessor)(server);\n\t},\n\tcreateDataProcessor: DataProcessor.createDataProcessor\n};","import global from \"../../utils/global\";\n\nfunction createMethod(gantt){\n\tvar methods = {};\n\tvar isActive = false;\n\tfunction disableMethod(methodName, dummyMethod){\n\t\tdummyMethod = typeof dummyMethod == \"function\" ? dummyMethod : function(){};\n\n\t\tif(!methods[methodName]){\n\t\t\tmethods[methodName] = this[methodName];\n\t\t\tthis[methodName] = dummyMethod;\n\t\t}\n\t}\n\tfunction restoreMethod(methodName){\n\t\tif(methods[methodName]){\n\t\t\tthis[methodName] = methods[methodName];\n\t\t\tmethods[methodName] = null;\n\t\t}\n\t}\n\tfunction disableMethods(methodsHash){\n\t\tfor(var i in methodsHash){\n\t\t\tdisableMethod.call(this, i, methodsHash[i]);\n\t\t}\n\t}\n\tfunction restoreMethods(){\n\t\tfor(var i in methods){\n\t\t\trestoreMethod.call(this, i);\n\t\t}\n\t}\n\n\tfunction batchUpdatePayload(callback){\n\t\ttry{\n\t\t\tcallback();\n\t\t}catch(e){\n\t\t\tglobal.console.error(e);\n\t\t}\n\t}\n\n\tvar state = gantt.$services.getService(\"state\");\n\tstate.registerProvider(\"batchUpdate\", function(){\n\t\treturn {\n\t\t\tbatch_update: isActive\n\t\t};\n\t}, false);\n\n\treturn function batchUpdate(callback, noRedraw) {\n\t\tif(isActive){\n\t\t\t// batch mode is already active\n\t\t\tbatchUpdatePayload(callback);\n\t\t\treturn;\n\t\t}\n\n\t\tvar call_dp = (this._dp && this._dp.updateMode != \"off\");\n\t\tvar dp_mode;\n\t\tif (call_dp){\n\t\t\tdp_mode = this._dp.updateMode;\n\t\t\tthis._dp.setUpdateMode(\"off\");\n\t\t}\n\n\t\t// temporary disable some methods while updating multiple tasks\n\t\tvar resetProjects = {};\n\t\tvar methods = {\n\t\t\t\"render\":true,\n\t\t\t\"refreshData\":true,\n\t\t\t\"refreshTask\":true,\n\t\t\t\"refreshLink\":true,\n\t\t\t\"resetProjectDates\":function(task){\n\t\t\t\tresetProjects[task.id] = task;\n\t\t\t}\n\t\t};\n\n\t\tdisableMethods.call(this, methods);\n\n\t\tisActive = true;\n\t\tthis.callEvent(\"onBeforeBatchUpdate\", []);\n\n\t\tbatchUpdatePayload(callback);\n\n\t\tthis.callEvent(\"onAfterBatchUpdate\", []);\n\n\t\trestoreMethods.call(this);\n\n\t\t// do required updates after changes applied\n\t\tfor(var i in resetProjects){\n\t\t\tthis.resetProjectDates(resetProjects[i]);\n\t\t}\n\n\t\tisActive = false;\n\n\t\tif(!noRedraw){\n\t\t\tthis.render();\n\t\t}\n\n\t\tif (call_dp) {\n\t\t\tthis._dp.setUpdateMode(dp_mode);\n\t\t\tthis._dp.setGanttMode(\"task\");\n\t\t\tthis._dp.sendData();\n\t\t\tthis._dp.setGanttMode(\"link\");\n\t\t\tthis._dp.sendData();\n\t\t}\n\t};\n\n\n\n}\n\nexport default function(gantt){\n\tgantt.batchUpdate = createMethod(gantt);\n};","var createWbs = (function(gantt){\n\treturn {\n\t_needRecalc: true,\n\treset: function(){\n\t\tthis._needRecalc = true;\n\t},\n\t_isRecalcNeeded: function(){\n\t\treturn (!this._isGroupSort() && this._needRecalc);\n\t},\n\t_isGroupSort: function() {\n\t\treturn !!(gantt.getState().group_mode);\n\t},\n\t_getWBSCode: function(task) {\n\t\tif(!task) return \"\";\n\n\t\tif(this._isRecalcNeeded()){\n\t\t\tthis._calcWBS();\n\t\t}\n\n\t\tif(task.$virtual) return \"\";\n\t\tif(this._isGroupSort()) return task.$wbs || \"\";\n\n\t\tif(!task.$wbs) {\n\t\t\tthis.reset();\n\t\t\tthis._calcWBS();\n\t\t}\n\t\treturn task.$wbs;\n\t},\n\t_setWBSCode: function(task, value) {\n\t\ttask.$wbs = value;\n\t},\n\tgetWBSCode: function(task) {\n\t\treturn this._getWBSCode(task);\n\t},\n\tgetByWBSCode: function(code){\n\t\tvar parts = code.split(\".\");\n\t\tvar currentNode = gantt.config.root_id;\n\t\tfor(var i = 0; i < parts.length; i++){\n\t\t\tvar children = gantt.getChildren(currentNode);\n\t\t\tvar index = parts[i]*1 - 1;\n\t\t\tif(gantt.isTaskExists(children[index])){\n\t\t\t\tcurrentNode = children[index];\n\t\t\t}else{\n\t\t\t\treturn null;\n\t\t\t}\n\t\t}\n\t\tif(gantt.isTaskExists(currentNode)){\n\t\t\treturn gantt.getTask(currentNode);\n\t\t}else{\n\t\t\treturn null;\n\t\t}\n\t},\n\t_calcWBS: function() {\n\t\tif(!this._isRecalcNeeded()) return;\n\n\t\tvar _isFirst = true;\n\t\tgantt.eachTask(function(ch) {\n\t\t\tif(_isFirst) {\n\t\t\t\t_isFirst = false;\n\t\t\t\tthis._setWBSCode(ch, \"1\");\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tvar _prevSibling = gantt.getPrevSibling(ch.id);\n\t\t\tif (_prevSibling !== null) {\n\t\t\t\tvar _wbs = gantt.getTask(_prevSibling).$wbs;\n\t\t\t\tif(_wbs) {\n\t\t\t\t\t_wbs = _wbs.split(\".\");\n\t\t\t\t\t_wbs[_wbs.length-1]++;\n\t\t\t\t\tthis._setWBSCode(ch, _wbs.join(\".\"));\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tvar _parent = gantt.getParent(ch.id);\n\t\t\t\tthis._setWBSCode(ch, gantt.getTask(_parent).$wbs + \".1\");\n\t\t\t}\n\t\t}, gantt.config.root_id, this);\n\n\t\tthis._needRecalc = false;\n\t}\n};\n});\n\nexport default function(gantt){\n\tvar wbs = createWbs(gantt);\n\tgantt.getWBSCode = function getWBSCode(task) {\n\t\treturn wbs.getWBSCode(task);\n\t};\n\n\tgantt.getTaskByWBSCode = function(code) {\n\t\treturn wbs.getByWBSCode(code);\n\t};\n\n\tfunction resetCache(){\n\t\twbs.reset();\n\t\treturn true;\n\t}\n\n\tgantt.attachEvent(\"onAfterTaskMove\", resetCache);\n\tgantt.attachEvent(\"onBeforeParse\", resetCache);\n\tgantt.attachEvent(\"onAfterTaskDelete\", resetCache);\n\tgantt.attachEvent(\"onAfterTaskAdd\", resetCache);\n\tgantt.attachEvent(\"onAfterSort\", resetCache);\n\n};\n","import * as helpers from \"../../utils/helpers\";\n\nfunction createResourceMethods(gantt){\n\n\tvar resourceTaskCache = {};\n\tvar singleResourceCacheBuilt = false;\n\n\tgantt.$data.tasksStore.attachEvent(\"onStoreUpdated\", function(){\n\t\tresourceTaskCache = {};\n\t\tsingleResourceCacheBuilt = false;\n\t});\n\tgantt.attachEvent(\"onBeforeGanttRender\", function(){\n\t\tresourceTaskCache = {};\n\t});\n\n\tfunction getTaskBy(propertyName, propertyValue, typeFilter) {\n\t\tif (typeof propertyName == \"function\") {\n\t\t\treturn filterResourceTasks(propertyName);\n\t\t} else {\n\t\t\tif (helpers.isArray(propertyValue)) {\n\t\t\t\treturn getResourceTasks(propertyName, propertyValue, typeFilter);\n\t\t\t} else {\n\t\t\t\treturn getResourceTasks(propertyName, [propertyValue], typeFilter);\n\t\t\t}\n\t\t}\n\t}\n\n\tfunction filterResourceTasks(filter) {\n\t\tvar res = [];\n\t\tgantt.eachTask(function (task) {\n\t\t\tif (filter(task)) {\n\t\t\t\tres.push(task);\n\t\t\t}\n\t\t});\n\t\treturn res;\n\t}\n\n\tvar falsyValuePrefix = String(Math.random());\n\tfunction resourceHashFunction(value){\n\t\tif (value === null){\n\t\t\treturn falsyValuePrefix + String(value);\n\t\t}\n\t\treturn String(value);\n\t}\n\n\tfunction getCacheKey(resourceIds, property, typeFilter) {\n\t\tif (Array.isArray(resourceIds)) {\n\t\t\treturn resourceIds.map(function (value) {\n\t\t\t\treturn resourceHashFunction(value);\n\t\t\t}).join(\"_\") + `_${property}_${typeFilter}`;\n\t\t} else {\n\t\t\treturn resourceHashFunction(resourceIds) + `_${property}_${typeFilter}`;\n\t\t}\n\t}\n\n\tfunction getResourceTasks(property, resourceIds, typeFilter) {\n\t\tvar res;\n\t\tvar cacheKey = getCacheKey(resourceIds, property, JSON.stringify(typeFilter));\n\t\tvar matchingResources = {};\n\t\thelpers.forEach(resourceIds, function(resourceId) {\n\t\t\tmatchingResources[resourceHashFunction(resourceId)] = true;\n\t\t});\n\n\t\tif (!resourceTaskCache[cacheKey]) {\n\t\t\tres = resourceTaskCache[cacheKey] = [];\n\t\t\tgantt.eachTask(function (task) {\n\t\t\t\tif (typeFilter) {\n\t\t\t\t\tif (!typeFilter[gantt.getTaskType(task)]) {\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t} else if (task.type == gantt.config.types.project) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tif (property in task) {\n\t\t\t\t\tvar resourceValue;\n\t\t\t\t\tif (!helpers.isArray(task[property])) {\n\t\t\t\t\t\tresourceValue = [task[property]];\n\t\t\t\t\t} else {\n\t\t\t\t\t\tresourceValue = task[property];\n\t\t\t\t\t}\n\n\t\t\t\t\thelpers.forEach(resourceValue, function(value) {\n\t\t\t\t\t\tvar resourceValue = (value && value.resource_id) ? value.resource_id : value;\n\n\t\t\t\t\t\tif (matchingResources[resourceHashFunction(resourceValue)]) {\n\t\t\t\t\t\t\tres.push(task);\n\t\t\t\t\t\t}else if(!singleResourceCacheBuilt){\n\n\t\t\t\t\t\t\tvar key = getCacheKey(value, property);\n\t\t\t\t\t\t\tif(!resourceTaskCache[key]){\n\t\t\t\t\t\t\t\tresourceTaskCache[key] = [];\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tresourceTaskCache[key].push(task);\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tsingleResourceCacheBuilt = true;\n\t\t} else {\n\t\t\tres = resourceTaskCache[cacheKey];\n\t\t}\n\n\t\treturn res;\n\t}\n\n\tfunction selectAssignments(resourceId, taskId, result){\n\t\tvar property = gantt.config.resource_property;\n\t\tvar owners = [];\n\t\tif (gantt.getDatastore(\"task\").exists(taskId)) {\n\t\t\tvar task = gantt.getTask(taskId);\n\t\t\towners = task[property] || [];\n\t\t}\n\n\t\tif (!Array.isArray(owners)) {\n\t\t\towners = [owners];\n\t\t}\n\t\tfor (var i = 0; i < owners.length; i++) {\n\t\t\tif (owners[i].resource_id == resourceId) {\n\t\t\t\tresult.push({task_id: task.id, resource_id:owners[i].resource_id, value:owners[i].value});\n\t\t\t}\n\t\t}\n\t}\n\n\tfunction getResourceAssignments(resourceId, taskId){\n\t\t// resource assignment as an independent module:\n\t\t// {taskId:, resourceId, value}\n\t\t// TODO: probably should add a separate datastore for these\n\t\tvar assignments = [];\n\t\tvar property = gantt.config.resource_property;\n\t\tif(taskId !== undefined){\n\t\t\tselectAssignments(resourceId, taskId, assignments);\n\t\t}else{\n\t\t\tvar tasks = gantt.getTaskBy(property, resourceId);\n\t\t\ttasks.forEach(function(task){\n\t\t\t\tselectAssignments(resourceId, task.id, assignments);\n\t\t\t});\n\t\t}\n\t\treturn assignments;\n\t}\n\n\treturn {\n\t\tgetTaskBy: getTaskBy,\n\t\tgetResourceAssignments: getResourceAssignments\n\t};\n}\n\nfunction createHelper(gantt){\n\tconst resourcePlugin = {\n\t\trenderEditableLabel: function(start_date, end_date, resource, tasks, assignments){\n\t\t\tconst editable = gantt.config.readonly ? \"\" : \"contenteditable\";\n\t\t\tif(start_date < resource.end_date && end_date > resource.start_date){\n\t\t\t\tfor(let i = 0; i < assignments.length; i++){\n\t\t\t\t\tconst a = assignments[i];\n\t\t\t\t\t\treturn \"<div \"+editable+\" data-assignment-cell data-assignment-id='\"+a.id+\"'\"+\n\t\t\t\t\t\t\" data-row-id='\"+resource.id+\"'\"+\n\t\t\t\t\t\t\" data-task='\"+resource.$task_id+\"'\"+\n\t\t\t\t\t\t\" data-start-date='\"+gantt.templates.format_date(start_date)+\"'\"+\n\t\t\t\t\t\t\" data-end-date='\"+gantt.templates.format_date(end_date)+\"'>\" + a.value + \"</div>\";\n\t\t\t\t}\n\t\t\t\treturn \"<div \"+editable+\" data-assignment-cell data-empty \"+ \n\t\t\t\t\t\t\" data-row-id='\"+resource.id+\"'\"+\n\t\t\t\t\t\t\" data-resource-id='\"+resource.$resource_id+\"'\"+\n\t\t\t\t\t\t\" data-task='\"+resource.$task_id+\"'\"+\n\t\t\t\t\t\t\" data-start-date='\"+gantt.templates.format_date(start_date)+\"'\"+\n\t\t\t\t\t\t\"'  data-end-date='\"+gantt.templates.format_date(end_date)+\"'>-</div>\";\n\t\t\t}\n\t\t\treturn \"\";\n\t\t},\n\t\trenderSummaryLabel: function(start_date, end_date, resource, tasks, assignments){\n\t\t\tlet sum = assignments.reduce(function(total, assignment){ \n\t\t\t\treturn total + Number(assignment.value);\n\t\t\t}, 0);\n\n\t\t\tif(sum % 1){\n\t\t\t\tsum = Math.round(sum * 10)/10;\n\t\t\t}\n\n\t\t\tif(sum){\n\t\t\t\treturn \"<div>\" + sum + \"</div>\";\n\t\t\t}\n\t\t\treturn \"\";\n\t\t},\n\t\teditableResourceCellTemplate: function(start_date, end_date, resource, tasks, assignments){\n\t\t\tif(resource.$role === \"task\"){\n\t\t\t\treturn resourcePlugin.renderEditableLabel(start_date, end_date, resource, tasks, assignments);\n\t\t\t}else{\n\t\t\t\treturn resourcePlugin.renderSummaryLabel(start_date, end_date, resource, tasks, assignments);\n\t\t\t}\n\n\t\t},\n\t\t\n\t\teditableResourceCellClass: function(start_date, end_date, resource, tasks, assignments){\n\t\t\tconst css = [];\n\t\t\tcss.push(\"resource_marker\");\n\n\t\t\tif(resource.$role === \"task\"){\n\t\t\t\tcss.push(\"task_cell\");\n\t\t\t}else{\n\t\t\t\tcss.push(\"resource_cell\");\n\t\t\t}\n\n\t\t\tconst sum = assignments.reduce(function(total, assignment){ \n\t\t\t\treturn total + Number(assignment.value);\n\t\t\t}, 0);\n\n\t\t\tlet capacity = Number(resource.capacity);\n\t\t\tif(isNaN(capacity)){\n\t\t\t\tcapacity = 8;\n\t\t\t}\n\t\t\tif (sum <= capacity) {\n\t\t\t\tcss.push(\"workday_ok\");\n\t\t\t} else {\n\t\t\t\tcss.push(\"workday_over\");\n\t\t\t}\n\t\t\treturn css.join(\" \");\n\t\t},\n\t\tgetSummaryResourceAssignments: function getResourceAssignments(resourceId) {\n\t\t\tlet assignments;\n\t\t\tconst store = gantt.getDatastore(gantt.config.resource_store);\n\t\t\tconst resource = store.getItem(resourceId);\n\n\t\t\tif(resource.$role === \"task\"){\n\t\t\t\tassignments = gantt.getResourceAssignments(resource.$resource_id, resource.$task_id);\n\t\t\t}else{\n\t\t\t\tassignments = gantt.getResourceAssignments(resourceId);\n\t\t\t\tif(store.eachItem){\n\t\t\t\t\tstore.eachItem(function(childResource){\n\t\t\t\t\t\tif(childResource.$role !== \"task\"){\n\t\t\t\t\t\t\tassignments = assignments.concat(gantt.getResourceAssignments(childResource.id));\n\t\t\t\t\t\t}\n\t\t\t\t\t}, resourceId);\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn assignments;\n\t\t},\n\t\t\n\t\tinitEditableDiagram: function(){\n\t\t\tgantt.config.resource_render_empty_cells = true;\n\t\t\t\n\t\t\t\n\t\t\t(function(){\n\t\t\t\t/// salesforce locker workaround\n\t\t\t\t// SF removes 'contenteditable' attribute from cells\n\t\t\t\t// restore it on render\n\t\t\t\tlet timeoutId = null;\n\t\t\t\tfunction makeEditable() {\n\t\t\t\t\tif (timeoutId) {\n\t\t\t\t\t\tcancelAnimationFrame(timeoutId);\n\t\t\t\t\t}\n\t\t\t\t\ttimeoutId = requestAnimationFrame(function () {\n\t\t\t\t\t\tif (gantt.$container){\n\t\t\t\t\t\t\tvar cells = Array.prototype.slice.call(gantt.$container.querySelectorAll(\".resourceTimeline_cell [data-assignment-cell]\"));\n\t\t\t\t\t\t\tcells.forEach(function (cell) {\n\t\t\t\t\t\t\t\tcell.contentEditable = true;\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t\treturn true;\n\t\t\t\t}\n\n\t\t\t\tgantt.attachEvent(\"onGanttReady\", function(){\n\t\t\t\t\tgantt.getDatastore(gantt.config.resource_assignment_store).attachEvent(\"onStoreUpdated\", makeEditable);\n\t\t\t\t\tgantt.getDatastore(gantt.config.resource_store).attachEvent(\"onStoreUpdated\", makeEditable);\n\t\t\t\t}, {once: true});\n\t\t\t\tgantt.attachEvent(\"onGanttLayoutReady\", function(){\n\t\t\t\t\tconst ganttViews = gantt.$layout.getCellsByType(\"viewCell\");\n\t\t\t\t\tganttViews.forEach(function(view){\n\t\t\t\t\t\tif(view.$config && view.$config.view === \"resourceTimeline\" && view.$content){\n\t\t\t\t\t\t\tview.$content.attachEvent(\"onScroll\", makeEditable);\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t\t})();\n\n\n\t\t\tgantt.attachEvent(\"onGanttReady\", function(){\n\t\t\t\tlet assignmentEditInProcess = false;\n\t\t\t\tgantt.event(gantt.$container, \"keypress\", function(e){\n\t\t\t\t\tvar target = e.target.closest(\".resourceTimeline_cell [data-assignment-cell]\");\n\t\t\t\t\tif(target){\n\t\t\t\t\t\tif (e.keyCode === 13 || e.keyCode === 27) {\n\t\t\t\t\t\t\ttarget.blur();\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t\tgantt.event(gantt.$container, \"focusout\", function(e){\n\t\t\t\t\tif (assignmentEditInProcess){\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t\tassignmentEditInProcess = true;\n\t\t\t\t\tsetTimeout(function(){\n\t\t\t\t\t\tassignmentEditInProcess = false;\n\t\t\t\t\t}, 300);\n\t\t\t\t\tvar target = e.target.closest(\".resourceTimeline_cell [data-assignment-cell]\");\n\t\t\t\t\tif(target){\n\t\t\t\t\t\tvar strValue = (target.innerText || \"\").trim();\n\t\t\t\t\t\tif(strValue == \"-\"){\n\t\t\t\t\t\t\tstrValue = \"0\";\n\t\t\t\t\t\t}\n\t\t\t\t\t\tvar value = Number(strValue);\n\t\t\t\t\t\tvar rowId = target.getAttribute(\"data-row-id\");\n\t\t\t\t\t\tvar assignmentId = target.getAttribute(\"data-assignment-id\");\n\t\t\t\t\t\tvar taskId = target.getAttribute(\"data-task\");\n\t\t\t\t\t\tvar resourceId = target.getAttribute(\"data-resource-id\");\n\t\t\t\t\t\tvar startDate = gantt.templates.parse_date(target.getAttribute(\"data-start-date\"));\n\t\t\t\t\t\tvar endDate = gantt.templates.parse_date(target.getAttribute(\"data-end-date\"));\n\n\t\t\t\t\t\tvar assignmentStore = gantt.getDatastore(gantt.config.resource_assignment_store);\n\t\t\t\t\t\tif(isNaN(value)){\n\t\t\t\t\t\t\tgantt.getDatastore(gantt.config.resource_store).refresh(rowId);\n\t\t\t\t\t\t}else{\n\t\t\t\t\t\t\tvar task = gantt.getTask(taskId);\n\t\t\t\t\t\t\t// GS-2141. Track the changes by the Undo extension\n\t\t\t\t\t\t\tif (gantt.plugins().undo){\n\t\t\t\t\t\t\t\tgantt.ext.undo.saveState(taskId, \"task\");\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tif(assignmentId){\n\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\tvar assignment = assignmentStore.getItem(assignmentId);\n\t\t\t\t\t\t\t\tif(value === assignment.value){\n\t\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tif(assignment.start_date.valueOf() === startDate.valueOf() && assignment.end_date.valueOf() === endDate.valueOf()){\n\t\t\t\t\t\t\t\t\tassignment.value = value;\n\t\t\t\t\t\t\t\t\tif(!value){\n\t\t\t\t\t\t\t\t\t\tassignmentStore.removeItem(assignment.id);\n\t\t\t\t\t\t\t\t\t}else{\n\t\t\t\t\t\t\t\t\t\tassignmentStore.updateItem(assignment.id);\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\tif(assignment.end_date.valueOf() > endDate.valueOf()){\n\t\t\t\t\t\t\t\t\t\tvar nextChunk = gantt.copy(assignment);\n\t\t\t\t\t\t\t\t\t\tnextChunk.id = gantt.uid();\n\t\t\t\t\t\t\t\t\t\tnextChunk.start_date = endDate;\n\t\t\t\t\t\t\t\t\t\tnextChunk.duration = gantt.calculateDuration({\n\t\t\t\t\t\t\t\t\t\t\tstart_date: nextChunk.start_date,\n\t\t\t\t\t\t\t\t\t\t\tend_date: nextChunk.end_date,\n\t\t\t\t\t\t\t\t\t\t\ttask: task\n\t\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\t\tnextChunk.delay = gantt.calculateDuration({\n\t\t\t\t\t\t\t\t\t\t\tstart_date: task.start_date,\n\t\t\t\t\t\t\t\t\t\t\tend_date: nextChunk.start_date,\n\t\t\t\t\t\t\t\t\t\t\ttask: task\n\t\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\t\tnextChunk.mode = assignment.mode || \"default\";\n\t\t\t\t\t\t\t\t\t\tif(nextChunk.duration !== 0){\n\t\t\t\t\t\t\t\t\t\t\tassignmentStore.addItem(nextChunk);\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\tif(assignment.start_date.valueOf() < startDate.valueOf()){\n\t\t\t\t\t\t\t\t\t\tassignment.end_date = startDate;\n\t\t\t\t\t\t\t\t\t\tassignment.duration = gantt.calculateDuration({\n\t\t\t\t\t\t\t\t\t\t\tstart_date: assignment.start_date,\n\t\t\t\t\t\t\t\t\t\t\tend_date: assignment.end_date,\n\t\t\t\t\t\t\t\t\t\t\ttask: task\n\t\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\t\tassignment.mode = \"fixedDuration\";\n\n\t\t\t\t\t\t\t\t\t\tif(assignment.duration === 0){\n\t\t\t\t\t\t\t\t\t\t\tassignmentStore.removeItem(assignment.id);\n\t\t\t\t\t\t\t\t\t\t}else{\n\t\t\t\t\t\t\t\t\t\t\tassignmentStore.updateItem(assignment.id);\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t}else{\n\t\t\t\t\t\t\t\t\t\tassignmentStore.removeItem(assignment.id);\n\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\tif(value){\n\t\t\t\t\t\t\t\t\t\tassignmentStore.addItem({\n\t\t\t\t\t\t\t\t\t\t\ttask_id: assignment.task_id,\n\t\t\t\t\t\t\t\t\t\t\tresource_id: assignment.resource_id,\n\t\t\t\t\t\t\t\t\t\t\tvalue: value,\n\t\t\t\t\t\t\t\t\t\t\tstart_date: startDate,\n\t\t\t\t\t\t\t\t\t\t\tend_date: endDate,\n\t\t\t\t\t\t\t\t\t\t\tduration: gantt.calculateDuration({\n\t\t\t\t\t\t\t\t\t\t\t\tstart_date: startDate,\n\t\t\t\t\t\t\t\t\t\t\t\tend_date: endDate,\n\t\t\t\t\t\t\t\t\t\t\t\ttask: task\n\t\t\t\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t\t\t\t\tdelay: gantt.calculateDuration({\n\t\t\t\t\t\t\t\t\t\t\t\tstart_date: task.start_date,\n\t\t\t\t\t\t\t\t\t\t\t\tend_date: startDate,\n\t\t\t\t\t\t\t\t\t\t\t\ttask: task\n\t\t\t\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t\t\t\t\tmode: \"fixedDuration\"\n\t\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\tgantt.updateTaskAssignments(task.id);\n\t\t\t\t\t\t\t\tgantt.updateTask(task.id);\n\t\t\t\t\t\t\t}else if(value){\n\t\t\t\t\t\t\t\tvar assignment = {\n\t\t\t\t\t\t\t\t\ttask_id: taskId,\n\t\t\t\t\t\t\t\t\tresource_id: resourceId,\n\t\t\t\t\t\t\t\t\tvalue: value,\n\t\t\t\t\t\t\t\t\tstart_date: startDate,\n\t\t\t\t\t\t\t\t\tend_date: endDate,\n\t\t\t\t\t\t\t\t\tduration: gantt.calculateDuration({\n\t\t\t\t\t\t\t\t\t\tstart_date: startDate,\n\t\t\t\t\t\t\t\t\t\tend_date: endDate,\n\t\t\t\t\t\t\t\t\t\ttask: task\n\t\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t\t\tdelay: gantt.calculateDuration({\n\t\t\t\t\t\t\t\t\t\tstart_date: task.start_date,\n\t\t\t\t\t\t\t\t\t\tend_date: startDate,\n\t\t\t\t\t\t\t\t\t\ttask: task\n\t\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t\t\tmode: \"fixedDuration\"\n\t\t\t\t\t\t\t\t};\n\n\t\t\t\t\t\t\t\tassignmentStore.addItem(assignment);\n\t\t\t\t\t\t\t\tgantt.updateTaskAssignments(task.id);\n\t\t\t\t\t\t\t\tgantt.updateTask(task.id);\n\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}, {once: true});\n\t\t}\n\t};\n\treturn resourcePlugin;\n}\n\nexport default function(gantt){\n\tvar methods = createResourceMethods(gantt);\n\t\n\tgantt.ext.resources = createHelper(gantt);\n\n\tgantt.config.resources = {\n\t\tdataprocessor_assignments: false,\n\t\tdataprocessor_resources: false,\n\t\teditable_resource_diagram: false,\n\t\tresource_store: {\n\t\t\ttype: \"treeDataStore\",\n\t\t\tfetchTasks: false,\n\t\t\tinitItem: function(item) {\n\t\t\t\titem.parent = item.parent || gantt.config.root_id;\n\t\t\t\titem[gantt.config.resource_property] = item.parent;\n\t\t\t\titem.open = true;\n\t\t\t\treturn item;\n\t\t\t}\n\t\t},\n\t\tlightbox_resources: function selectResourceControlOptions(resources){\n\t\t\tconst lightboxOptions = [];\n\t\t\tconst store = gantt.getDatastore(gantt.config.resource_store);\n\t\t\tresources.forEach(function(res) {\n\t\t\t\tif (!store.hasChild(res.id)) {\n\t\t\t\t\tconst copy = gantt.copy(res);\n\t\t\t\t\tcopy.key = res.id;\n\t\t\t\t\tcopy.label = res.text;\n\t\t\t\t\tlightboxOptions.push(copy);\n\t\t\t\t}\n\t\t\t});\n\t\t\treturn lightboxOptions;\n\t\t}\n\t};\n\n\tgantt.attachEvent(\"onBeforeGanttReady\", function(){\n\t\tif(gantt.getDatastore(gantt.config.resource_store)){\n\t\t\treturn;\n\t\t}\n\n\t\tconst resourceStoreConfig = gantt.config.resources ? gantt.config.resources.resource_store : undefined;\n\t\tlet fetchTasks = resourceStoreConfig ? resourceStoreConfig.fetchTasks : undefined;\n\t\tif(gantt.config.resources && gantt.config.resources.editable_resource_diagram){\n\t\t\tfetchTasks = true;\n\t\t}\n\n\t\tlet initItems = function(item) {\n\t\t\titem.parent = item.parent || gantt.config.root_id;\n\t\t\titem[gantt.config.resource_property] = item.parent;\n\t\t\titem.open = true;\n\t\t\treturn item;\n\t\t};\n\n\t\tif(resourceStoreConfig && resourceStoreConfig.initItem){\n\t\t\tinitItems = resourceStoreConfig.initItem;\n\t\t}\n\n\t\tconst storeType = resourceStoreConfig && resourceStoreConfig.type ? resourceStoreConfig.type : \"treeDatastore\";\n\n\t\tgantt.$resourcesStore = gantt.createDatastore({\n\t\t\tname: gantt.config.resource_store,\n\t\t\ttype: storeType,\n\t\t\tfetchTasks: fetchTasks !== undefined ? fetchTasks : false,\n\t\t\tinitItem: initItems\n\t\t});\n\n\t\tgantt.$data.resourcesStore = gantt.$resourcesStore;\n\n\t\tgantt.$resourcesStore.attachEvent(\"onParse\", function() {\n\t\t\tfunction selectResourceControlOptions(resources){\n\t\t\t\tconst lightboxOptions = [];\n\t\t\t\tresources.forEach(function(res) {\n\t\t\t\t\tif (!gantt.$resourcesStore.hasChild(res.id)) {\n\t\t\t\t\t\tvar copy = gantt.copy(res);\n\t\t\t\t\t\tcopy.key = res.id;\n\t\t\t\t\t\tcopy.label = res.text;\n\t\t\t\t\t\tlightboxOptions.push(copy);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t\treturn lightboxOptions;\n\t\t\t}\n\n\t\t\tlet lightboxOptionsFnc = selectResourceControlOptions;\n\t\t\tif(gantt.config.resources && gantt.config.resources.lightbox_resources){\n\t\t\t\tlightboxOptionsFnc = gantt.config.resources.lightbox_resources;\n\t\t\t}\n\n\t\t\tconst options = lightboxOptionsFnc(gantt.$resourcesStore.getItems());\n\n\t\t\tgantt.updateCollection(\"resourceOptions\", options);\n\t\t});\n\t});\n\n\tgantt.getTaskBy = methods.getTaskBy;\n\tgantt.getResourceAssignments = methods.getResourceAssignments;\n\tgantt.config.resource_property = \"owner_id\";\n\tgantt.config.resource_store = \"resource\";\n\tgantt.config.resource_render_empty_cells = false;\n\n\t/**\n\t * these are placeholder functions that should be redefined by the user\n\t*/\n\tgantt.templates.histogram_cell_class = function(start_date, end_date, resource, tasks, assignments) {};\n\tgantt.templates.histogram_cell_label = function(start_date, end_date, resource, tasks, assignments) {\n\t\treturn tasks.length + \"/3\";\n\t};\n\tgantt.templates.histogram_cell_allocated = function(start_date, end_date, resource, tasks, assignments) {\n\t\treturn tasks.length / 3;\n\t};\n\tgantt.templates.histogram_cell_capacity = function(start_date, end_date, resource, tasks, assignments) {\n\t\treturn 0;\n\t};\n\n\n\tconst defaultResourceCellClass = function(start, end, resource, tasks, assignments) {\n\t\tvar css = \"\";\n\t\tif (tasks.length <= 1) {\n\t\t\tcss = \"gantt_resource_marker_ok\";\n\t\t} else {\n\t\t\tcss = \"gantt_resource_marker_overtime\";\n\t\t}\n\t\treturn css;\n\t};\n\n\tconst defaultResourceCellTemplate = function(start, end, resource, tasks, assignments) {\n\t\treturn tasks.length * 8;\n\t};\n\n\tgantt.templates.resource_cell_value = defaultResourceCellTemplate;\n\tgantt.templates.resource_cell_class = defaultResourceCellClass;\n\n\t//editable_resource_diagram\n\tgantt.attachEvent(\"onBeforeGanttReady\", function(){\n\t\tif(gantt.config.resources && gantt.config.resources.editable_resource_diagram){\n\n\t\t\tgantt.config.resource_render_empty_cells = true;\n\t\t\tif(gantt.templates.resource_cell_value === defaultResourceCellTemplate){\n\t\t\t\tgantt.templates.resource_cell_value = gantt.ext.resources.editableResourceCellTemplate;\n\t\t\t}\n\t\t\tif(gantt.templates.resource_cell_class === defaultResourceCellClass){\n\t\t\t\tgantt.templates.resource_cell_class = gantt.ext.resources.editableResourceCellClass;\n\t\t\t}\n\t\t\t\n\t\t\tgantt.ext.resources.initEditableDiagram(gantt);\n\t\t}\n\t});\n};\n\n\n","export default function (gantt) {\n\tvar resourceAssignmentsProperty = \"$resourceAssignments\";\n\tgantt.config.resource_assignment_store = \"resourceAssignments\";\n\tgantt.config.process_resource_assignments = true;\n\n\tvar resourceAssignmentFormats = {\n\t\tauto: \"auto\",\n\t\tsingleValue: \"singleValue\",\n\t\tvalueArray: \"valueArray\",\n\t\tresourceValueArray: \"resourceValueArray\",\n\t\tassignmentsArray: \"assignmentsArray\"\n\t};\n\tvar resourceAssignmentFormat = resourceAssignmentFormats.auto;//\"primitiveSingle\";//\"primitive\";//\"object\"|\"assignment\"\n\n\tvar assignmentModes = {\n\t\tfixedDates: \"fixedDates\",\n\t\tfixedDuration: \"fixedDuration\",\n\t\tdefault: \"default\"\n\t};\n\n\n\tfunction initAssignmentFields(item, task){\n\t\tif (item.start_date) {\n\t\t\titem.start_date = gantt.date.parseDate(item.start_date, \"parse_date\");\n\t\t} else {\n\t\t\titem.start_date = null;\n\t\t}\n\n\t\tif (item.end_date) {\n\t\t\titem.end_date = gantt.date.parseDate(item.end_date, \"parse_date\");\n\t\t} else {\n\t\t\titem.end_date = null;\n\t\t}\n\n\t\tvar delay = Number(item.delay);\n\t\tvar initDelay = false;\n\t\tif (!isNaN(delay)) {\n\t\t\titem.delay = delay;\n\t\t} else {\n\t\t\titem.delay = 0;\n\t\t\tinitDelay = true;\n\t\t}\n\n\t\tif (!gantt.defined(item.value)) {\n\t\t\titem.value = null;\n\t\t}\n\n\t\tif (!item.task_id || !item.resource_id) {\n\t\t\treturn false;\n\t\t}\n\n\t\titem.mode = item.mode || assignmentModes.default;\n\n\t\tif(item.mode === assignmentModes.fixedDuration){\n\t\t\tif(isNaN(Number(item.duration))){\n\t\t\t\ttask = task || gantt.getTask(item.task_id);\n\t\t\t\titem.duration = gantt.calculateDuration({\n\t\t\t\t\tstart_date: item.start_date,\n\t\t\t\t\tend_date: item.end_date,\n\t\t\t\t\tid: task\n\t\t\t\t});\n\t\t\t}\n\t\t\tif(initDelay){\n\t\t\t\ttask = task || gantt.getTask(item.task_id);\n\t\t\t\titem.delay = gantt.calculateDuration({\n\t\t\t\t\tstart_date: task.start_date,\n\t\t\t\t\tend_date: item.start_date,\n\t\t\t\t\tid: task\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\n\t\tif (item.mode !== assignmentModes.fixedDates && (task || gantt.isTaskExists(item.task_id))) {\n\t\t\ttask = task || gantt.getTask(item.task_id);\n\t\t\tvar timing = _assignmentTimeFromTask(item, task);\n\t\t\titem.start_date = timing.start_date;\n\t\t\titem.end_date = timing.end_date;\n\t\t\titem.duration = timing.duration;\n\t\t}\n\t}\n\t// gantt init\n\tvar resourceAssignmentsStore = gantt.createDatastore({\n\t\tname: gantt.config.resource_assignment_store,\n\t\tinitItem: function (item) {\n\t\t\tif (!item.id) {\n\t\t\t\titem.id = gantt.uid();\n\t\t\t}\n\n\t\t\tinitAssignmentFields(item);\n\n\t\t\treturn item;\n\t\t}\n\t});\n\t\n\tgantt.$data.assignmentsStore = resourceAssignmentsStore;\n\n\tfunction _assignmentTimeFromTask(assignment, task) {\n\n\t\tif (assignment.mode === assignmentModes.fixedDates) {\n\t\t\treturn {\n\t\t\t\tstart_date: assignment.start_date,\n\t\t\t\tend_date: assignment.end_date,\n\t\t\t\tduration: assignment.duration\n\t\t\t};\n\t\t} else {\n\t\t\tvar start = assignment.delay ? gantt.calculateEndDate({\n\t\t\t\tstart_date: task.start_date,\n\t\t\t\tduration: assignment.delay,\n\t\t\t\ttask: task\n\t\t\t}) : new Date(task.start_date);\n\n\t\t\tvar end;\n\t\t\tvar duration;\n\t\t\tif (assignment.mode === assignmentModes.fixedDuration) {\n\t\t\t\tend = gantt.calculateEndDate({\n\t\t\t\t\tstart_date: start,\n\t\t\t\t\tduration: assignment.duration,\n\t\t\t\t\ttask: task\n\t\t\t\t});\n\t\t\t\tduration = assignment.duration;\n\t\t\t} else {\n\t\t\t\tend = new Date(task.end_date);\n\t\t\t\tduration = task.duration - assignment.delay;\n\t\t\t}\n\t\t}\n\n\t\treturn {\n\t\t\tstart_date: start,\n\t\t\tend_date: end,\n\t\t\tduration: duration\n\t\t};\n\t}\n\n\t// data loading\n\n\tfunction _makeAssignmentsFromTask(task) {\n\t\tconst property = gantt.config.resource_property;\n\t\tlet assignments = task[property];\n\t\tconst resourceAssignments = [];\n\t\tlet detectFormat = resourceAssignmentFormat === resourceAssignmentFormats.auto;\n\n\t\tif (gantt.defined(assignments) && assignments) {\n\t\t\tif (!Array.isArray(assignments)) {\n\t\t\t\tassignments = [assignments];\n\t\t\t\tif (detectFormat) {\n\t\t\t\t\tresourceAssignmentFormat = resourceAssignmentFormats.singleValue;\n\t\t\t\t\tdetectFormat = false;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tconst usedIds = {};\n\t\t\tassignments.forEach(function (res) {\n\t\t\t\tif (!res.resource_id) { // when resource is a string/number\n\t\t\t\t\tres = { resource_id: res };\n\t\t\t\t\tif (detectFormat) {\n\t\t\t\t\t\tresourceAssignmentFormat = resourceAssignmentFormats.valueArray;\n\t\t\t\t\t\tdetectFormat = false;\n\t\t\t\t\t}\n\t\t\t\t\t//\tisSimpleArray = true;\n\t\t\t\t}\n\n\t\t\t\tif (detectFormat) {\n\t\t\t\t\tif (res.id && res.resource_id) {\n\t\t\t\t\t\tresourceAssignmentFormat = resourceAssignmentFormats.assignmentsArray;\n\t\t\t\t\t\tdetectFormat = false;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tresourceAssignmentFormat = resourceAssignmentFormats.resourceValueArray;\n\t\t\t\t\t\tdetectFormat = false;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tlet defaultMode = assignmentModes.default;\n\t\t\t\tif(!res.mode){\n\t\t\t\t\tif((res.start_date && res.end_date) || (res.start_date && res.duration)){\n\t\t\t\t\t\tdefaultMode = assignmentModes.fixedDuration;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tlet id;\n\t\t\t\tif(!res.id && res.$id && !usedIds[res.$id]){\n\t\t\t\t\tid = res.$id;\n\t\t\t\t} else if(res.id && !usedIds[res.id]){\n\t\t\t\t\tid = res.id;\n\t\t\t\t} else{\n\t\t\t\t\tid = gantt.uid();\n\t\t\t\t}\n\t\t\t\tusedIds[id] = true;\n\n\t\t\t\tconst assignment = {\n\t\t\t\t\tid: id,\n\t\t\t\t\tstart_date: res.start_date,\n\t\t\t\t\tduration: res.duration,\n\t\t\t\t\tend_date: res.end_date,\n\t\t\t\t\tdelay: res.delay,\n\t\t\t\t\ttask_id: task.id,\n\t\t\t\t\tresource_id: res.resource_id,\n\t\t\t\t\tvalue: res.value,\n\t\t\t\t\tmode: res.mode || defaultMode\n\t\t\t\t};\n\t\t\t\t// GS-2490: to add custom properties to assignment\n\t\t\t\t// need to exclude $id which incfluences on render \n\t\t\t\tObject.keys(res).forEach(key => {\n\t\t\t\t\tif(key != \"$id\") {\n\t\t\t\t\t\tassignment[key] = res[key];\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t\tif(!(assignment.start_date && assignment.start_date.getMonth \n\t\t\t\t\t&& assignment.end_date && assignment.end_date.getMonth && typeof assignment.duration === \"number\")){\n\t\t\t\t\tinitAssignmentFields(assignment, task);\n\t\t\t\t}\n\n\t\t\t\tresourceAssignments.push(assignment);\n\t\t\t});\n\t\t}\n\t\treturn resourceAssignments;\n\t}\n\n\tfunction _updateTaskBack(taskId) {\n\t\t// GS-1493. In some cases, the resource assignment store has the tasks that no longer exist\n\t\tif (!gantt.isTaskExists(taskId)){\n\t\t\treturn;\n\t\t}\n\n\t\tvar task = gantt.getTask(taskId);\n\t\tvar assignments = gantt.getTaskAssignments(task.id);\n\t\t_assignAssignments(task, assignments);\n\t}\n\n\tfunction _assignAssignments(task, assignments){\n\t\tassignments.sort(function(a, b){\n\t\t\tif(a.start_date && b.start_date && a.start_date.valueOf() != b.start_date.valueOf()){\n\t\t\t\treturn a.start_date - b.start_date;\n\t\t\t}else{\n\t\t\t\treturn 0;\n\t\t\t}\n\t\t});\n\t\tif (resourceAssignmentFormat == resourceAssignmentFormats.assignmentsArray) {\n\t\t\ttask[gantt.config.resource_property] = assignments;\n\t\t} else if (resourceAssignmentFormat == resourceAssignmentFormats.resourceValueArray) {\n\t\t\ttask[gantt.config.resource_property] = assignments.map(function (a) {\n\t\t\t\treturn {\n\t\t\t\t\t$id: a.id,\n\t\t\t\t\tstart_date: a.start_date,\n\t\t\t\t\tduration: a.duration,\n\t\t\t\t\tend_date: a.end_date,\n\t\t\t\t\tdelay: a.delay,\n\t\t\t\t\tresource_id: a.resource_id,\n\t\t\t\t\tvalue: a.value,\n\t\t\t\t\tmode: a.mode\n\t\t\t\t};\n\t\t\t});\n\t\t}\n\n\t\ttask[resourceAssignmentsProperty] = assignments;\n\t}\n\n\tfunction _loadAssignmentsFromTask(task) {\n\t\tvar assignments = _makeAssignmentsFromTask(task);\n\t\tvar taskAssignments = [];\n\t\tassignments.forEach(function (a) {\n\t\t\ta.id = a.id || gantt.uid();\n\t\t\t//var newId = resourceAssignmentsStore.addItem(a);\n\t\t\ttaskAssignments.push(a);\n\t\t});\n\n\t\treturn assignments;\n\t}\n\n\tfunction diffAssignments(taskValues, assignmentsStoreValues) {\n\t\tvar result = {\n\t\t\tinBoth: [],\n\t\t\tinTaskNotInStore: [],\n\t\t\tinStoreNotInTask: []\n\t\t};\n\n\t\tif (resourceAssignmentFormat == resourceAssignmentFormats.singleValue) {\n\t\t\tvar taskOwner = taskValues[0];\n\t\t\tvar ownerId = taskOwner ? taskOwner.resource_id : null;\n\t\t\tvar foundOwnerAssignment = false;\n\t\t\tassignmentsStoreValues.forEach(function (a) {\n\t\t\t\tif (a.resource_id != ownerId) {\n\t\t\t\t\tresult.inStoreNotInTask.push(a);\n\t\t\t\t} else if (a.resource_id == ownerId) {\n\t\t\t\t\tresult.inBoth.push({ store: a, task: taskOwner });\n\t\t\t\t\tfoundOwnerAssignment = true;\n\t\t\t\t}\n\t\t\t});\n\t\t\tif (!foundOwnerAssignment && taskOwner) {\n\t\t\t\tresult.inTaskNotInStore.push(taskOwner);\n\t\t\t}\n\n\n\t\t} else if (resourceAssignmentFormat == resourceAssignmentFormats.valueArray){\n\n\t\t\tvar taskSearch = {};\n\t\t\tvar storeSearch = {};\n\t\t\tvar processedIds = {};\n\t\t\ttaskValues.forEach(function (a) {\n\t\t\t\ttaskSearch[a.resource_id] = a;\n\t\t\t});\n\t\t\tassignmentsStoreValues.forEach(function (a) {\n\t\t\t\tstoreSearch[a.resource_id] = a;\n\t\t\t});\n\t\t\ttaskValues.concat(assignmentsStoreValues).forEach(function (a) {\n\t\t\t\tif (processedIds[a.resource_id]) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tprocessedIds[a.resource_id] = true;\n\t\t\t\tvar inTask = taskSearch[a.resource_id];\n\t\t\t\tvar inStore = storeSearch[a.resource_id];\n\n\t\t\t\tif (inTask && inStore) {\n\t\t\t\t\tresult.inBoth.push({ store: inStore, task: inTask });\n\t\t\t\t} else if (inTask && !inStore) {\n\t\t\t\t\tresult.inTaskNotInStore.push(inTask);\n\t\t\t\t} else if (!inTask && inStore) {\n\t\t\t\t\tresult.inStoreNotInTask.push(inStore);\n\t\t\t\t}\n\t\t\t});\n\t\t} else if ((resourceAssignmentFormat == resourceAssignmentFormats.assignmentsArray)\n\t\t\t|| (resourceAssignmentFormat == resourceAssignmentFormats.resourceValueArray)) {\n\t\t\tvar taskSearch = {};\n\t\t\tvar storeSearch = {};\n\t\t\tvar processedIds = {};\n\t\t\ttaskValues.forEach(function (a) {\n\t\t\t\ttaskSearch[a.id || a.$id] = a;\n\t\t\t});\n\t\t\tassignmentsStoreValues.forEach(function (a) {\n\t\t\t\tstoreSearch[a.id] = a;\n\t\t\t});\n\t\t\ttaskValues.concat(assignmentsStoreValues).forEach(function (a) {\n\t\t\t\tvar id = a.id || a.$id;\n\t\t\t\tif (processedIds[id]) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tprocessedIds[id] = true;\n\t\t\t\tvar inTask = taskSearch[id];\n\t\t\t\tvar inStore = storeSearch[id];\n\n\t\t\t\tif (inTask && inStore) {\n\t\t\t\t\tresult.inBoth.push({ store: inStore, task: inTask });\n\t\t\t\t} else if (inTask && !inStore) {\n\t\t\t\t\tresult.inTaskNotInStore.push(inTask);\n\t\t\t\t} else if (!inTask && inStore) {\n\t\t\t\t\tresult.inStoreNotInTask.push(inStore);\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t\treturn result;\n\t}\n\n\tfunction assignmentHasChanged(source, target) {\n\t\tvar ignoreFields = {\n\t\t\tid: true\n\t\t};\n\n\t\tfor (var i in source) {\n\t\t\tif (!ignoreFields[i]) {\n\t\t\t\tif (String(source[i]) !== String(target[i])) {\n\t\t\t\t\treturn true;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\treturn false;\n\t}\n\tfunction updateAssignment(source, target) {\n\t\tvar ignoreFields = {\n\t\t\tid: true\n\t\t};\n\n\t\tfor (var i in source) {\n\t\t\tif (!ignoreFields[i]) {\n\t\t\t\ttarget[i] = source[i];\n\t\t\t}\n\t\t}\n\t}\n\n\tfunction _syncAssignments(task, storeAssignments){\n\t\tvar tasksAssignments = _makeAssignmentsFromTask(task);\n\n\t\tvar diff = diffAssignments(tasksAssignments, storeAssignments);\n\t\tdiff.inStoreNotInTask.forEach(function (a) {\n\t\t\tresourceAssignmentsStore.removeItem(a.id);\n\t\t});\n\t\tdiff.inTaskNotInStore.forEach(function (a) {\n\t\t\tresourceAssignmentsStore.addItem(a);\n\t\t});\n\n\t\tdiff.inBoth.forEach(function (a) {\n\t\t\tif (assignmentHasChanged(a.task, a.store)) {\n\t\t\t\tupdateAssignment(a.task, a.store);\n\t\t\t\tresourceAssignmentsStore.updateItem(a.store.id);\n\t\t\t} else {\n\t\t\t\tif (a.task.start_date && a.task.end_date && a.task.mode !== assignmentModes.fixedDates) {\n\t\t\t\t\tvar timing = _assignmentTimeFromTask(a.store, task);\n\t\t\t\t\tif (a.store.start_date.valueOf() != timing.start_date.valueOf() || a.store.end_date.valueOf() != timing.end_date.valueOf()) {\n\t\t\t\t\t\ta.store.start_date = timing.start_date;\n\t\t\t\t\t\ta.store.end_date = timing.end_date;\n\t\t\t\t\t\ta.store.duration = timing.duration;\n\t\t\t\t\t\tresourceAssignmentsStore.updateItem(a.store.id);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n\t\t_updateTaskBack(task.id);\n\t}\n\n\tfunction _syncOnTaskUpdate(task) {\n\t\tvar storeAssignments = task[resourceAssignmentsProperty] || resourceAssignmentsStore.find(function (a) {\n\t\t\treturn a.task_id == task.id;\n\t\t});\n\n\t\t_syncAssignments(task, storeAssignments);\n\t}\n\n\tfunction _syncOnTaskDelete(ids) {\n\t\tvar idsSearch = {};\n\t\tids.forEach(function (id) {\n\t\t\tidsSearch[id] = true;\n\t\t});\n\t\tvar taskResources = resourceAssignmentsStore.find(function (a) {\n\t\t\treturn idsSearch[a.task_id];\n\t\t});\n\t\ttaskResources.forEach(function (a) {\n\t\t\tresourceAssignmentsStore.removeItem(a.id);\n\t\t});\n\t}\n\n\tgantt.attachEvent(\"onGanttReady\", function(){\n\n\t\tif (gantt.config.process_resource_assignments) {\n\t\t\tgantt.attachEvent(\"onParse\", function () {\n\t\t\t\tgantt.silent(function () {\n\t\t\t\t\tresourceAssignmentsStore.clearAll();\n\t\t\t\t\tvar totalAssignments = [];\n\t\t\t\t\tgantt.eachTask(function (task) {\n\t\t\t\t\t\tif (task.type === gantt.config.types.project) {\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tvar assignments = _loadAssignmentsFromTask(task);\n\t\t\t\t\t\t_assignAssignments(task, assignments);\n\n\t\t\t\t\t\tassignments.forEach(function (a) {\n\t\t\t\t\t\t\ttotalAssignments.push(a);\n\t\t\t\t\t\t});\n\t\t\t\t\t});\n\t\t\t\t\tresourceAssignmentsStore.parse(totalAssignments);\n\t\t\t\t});\n\n\t\t\t});\n\n\t\t\tvar batchUpdate = false;\n\t\t\tvar needUpdate = false;\n\t\t\tvar needUpdateFor = {};\n\t\t\tvar undoBatchCancel = false;\n\t\t\tgantt.attachEvent(\"onBeforeBatchUpdate\", function(){\n\t\t\t\tbatchUpdate = true;\n\t\t\t});\n\t\t\tgantt.attachEvent(\"onAfterBatchUpdate\", function(){\n\t\t\t\t\n\t\t\t\tif(needUpdate){\n\t\t\t\t\tvar assignmentsHash = {};\n\t\t\t\t\tfor(var i in needUpdateFor){\n\t\t\t\t\t\tassignmentsHash[i] = gantt.getTaskAssignments(needUpdateFor[i].id);\n\t\t\t\t\t}\n\t\t\t\t\tfor(var i in needUpdateFor){\n\t\t\t\t\t\t_syncAssignments(needUpdateFor[i], assignmentsHash[i]);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tneedUpdate = false;\n\t\t\t\tbatchUpdate = false;\n\t\t\t\tneedUpdateFor = {};\n\t\t\t});\n\n\t\t\tgantt.attachEvent(\"onTaskCreated\", function (item) {\n\t\t\t\tvar assignments = _loadAssignmentsFromTask(item);\n\t\t\t\tresourceAssignmentsStore.parse(assignments);\n\t\t\t\t_assignAssignments(item, assignments);\n\t\t\t\treturn true;\n\t\t\t});\n\t\t\tgantt.attachEvent(\"onAfterTaskUpdate\", function (id, item) {\n\t\t\t\tif(batchUpdate){\n\t\t\t\t\tneedUpdate = true;\n\t\t\t\t\tneedUpdateFor[id] = item;\n\t\t\t\t}else if (!item.unscheduled){\n\t\t\t\t\t_syncOnTaskUpdate(item);\n\t\t\t\t}\n\t\t\t});\n\t\t\tgantt.attachEvent(\"onAfterTaskAdd\", function (id, item) {\n\t\t\t\tif(batchUpdate){\n\t\t\t\t\tneedUpdate = true;\n\t\t\t\t\tneedUpdateFor[id] = item;\n\t\t\t\t}else{\n\t\t\t\t\t_syncOnTaskUpdate(item);\n\t\t\t\t}\n\t\t\t});\n\n\t\t/*\tgantt.attachEvent(\"onRowDragMove\", function (id) {\n\t\t\t\t_syncOnTaskUpdate(gantt.getTask(id));\n\t\t\t});*/\n\t\t\tgantt.attachEvent(\"onRowDragEnd\", function (id) {\n\t\t\t\t_syncOnTaskUpdate(gantt.getTask(id));\n\t\t\t});\n\t\t\tgantt.$data.tasksStore.attachEvent(\"onAfterDeleteConfirmed\", function (id, item) {\n\t\t\t\tvar deleteIds = [id];\n\t\t\t\tgantt.eachTask(function (task) {\n\t\t\t\t\tdeleteIds.push(task.id);\n\t\t\t\t}, id);\n\t\t\t\t_syncOnTaskDelete(deleteIds);\n\t\t\t});\n\t\t\tgantt.$data.tasksStore.attachEvent(\"onClearAll\", function () {\n\t\t\t\tresourceAssignmentsCache = null;\n\t\t\t\tresourceTaskAssignmentsCache = null;\n\t\t\t\ttaskAssignmentsCache = null;\n\t\t\t\tresourceAssignmentsStore.clearAll();\n\t\t\t\treturn true;\n\t\t\t});\n\t\t\tgantt.attachEvent(\"onTaskIdChange\", function (id, new_id) {\n\t\t\t\tvar taskResources = resourceAssignmentsStore.find(function (a) {\n\t\t\t\t\treturn a.task_id == id;\n\t\t\t\t});\n\t\t\t\ttaskResources.forEach(function (a) {\n\t\t\t\t\ta.task_id = new_id;\n\t\t\t\t\tresourceAssignmentsStore.updateItem(a.id);\n\t\t\t\t});\n\t\t\t\t_updateTaskBack(new_id);\n\t\t\t\t//any custom logic here\n\t\t\t});\n\t\t\t// GS-2144. When we Undo something, the cache should be reset\n\t\t\t// during the `onStoreUpdated` event to properly update the assignments\n\t\t\tgantt.attachEvent(\"onBeforeUndo\", function (action) {\n\t\t\t\tundoBatchCancel = true;\n\t\t\t\treturn true;\n\t\t\t});\n\t\t\tgantt.attachEvent(\"onAfterUndo\", function (action) {\n\t\t\t\tundoBatchCancel = true;\n\t\t\t});\n\n\n\t\t\tvar resourceAssignmentsCache = null;\n\t\t\tvar resourceTaskAssignmentsCache = null;\n\t\t\tvar taskAssignmentsCache = null;\n\n\t\t\tresourceAssignmentsStore.attachEvent(\"onStoreUpdated\", function resetCache(){\n\t\t\t\tif(batchUpdate && !undoBatchCancel){\n\t\t\t\t\treturn true;\n\t\t\t\t}\n\t\t\t\tresourceAssignmentsCache = null;\n\t\t\t\tresourceTaskAssignmentsCache = null;\n\t\t\t\ttaskAssignmentsCache = null;\n\t\t\t\treturn true;\n\t\t\t});\n\n\t\t\tgantt.getResourceAssignments = function (resourceId, taskId) {\n\t\t\t\tvar searchTaskId = gantt.defined(taskId) && taskId !== null;\n\n\t\t\t\tif(resourceAssignmentsCache === null){\n\t\t\t\t\tresourceAssignmentsCache = {};\n\t\t\t\t\tresourceTaskAssignmentsCache = {};\n\n\t\t\t\t\tresourceAssignmentsStore.eachItem(function (a) {\n\t\t\t\t\t\tif(!resourceAssignmentsCache[a.resource_id]){\n\t\t\t\t\t\t\tresourceAssignmentsCache[a.resource_id] = [];\n\t\t\t\t\t\t}\n\t\t\t\t\t\tresourceAssignmentsCache[a.resource_id].push(a);\n\n\t\t\t\t\t\tvar resourceTaskCacheKey = a.resource_id + \"-\" + a.task_id;\n\t\t\t\t\t\tif(!resourceTaskAssignmentsCache[resourceTaskCacheKey]){\n\t\t\t\t\t\t\tresourceTaskAssignmentsCache[resourceTaskCacheKey] = [];\n\t\t\t\t\t\t}\n\t\t\t\t\t\tresourceTaskAssignmentsCache[resourceTaskCacheKey].push(a);\n\t\t\t\t\t});\n\t\t\t\t}\n\n\n\t\t\t\tif(searchTaskId){\n\t\t\t\t\treturn (resourceTaskAssignmentsCache[resourceId + \"-\" + taskId] || []).slice();\n\t\t\t\t}else{\n\t\t\t\t\treturn (resourceAssignmentsCache[resourceId] || []).slice();\n\t\t\t\t}\n\t\t\t};\n\n\t\t\t\n\t\t\tgantt.getTaskAssignments = function (taskId) {\n\t\t\t\tif(taskAssignmentsCache === null){\n\t\t\t\t\tvar result = [];\n\t\t\t\t\ttaskAssignmentsCache = {};\n\t\t\t\t\tresourceAssignmentsStore.eachItem(function (a) {\n\t\t\t\t\t\tif(!taskAssignmentsCache[a.task_id]){\n\t\t\t\t\t\t\ttaskAssignmentsCache[a.task_id] = [];\n\t\t\t\t\t\t}\n\t\t\t\t\t\ttaskAssignmentsCache[a.task_id].push(a);\n\t\t\t\t\t\tif (a.task_id == taskId) {\n\t\t\t\t\t\t\tresult.push(a);\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t\treturn (taskAssignmentsCache[taskId] || []).slice();\n\t\t\t};\n\t\t\t\n\t\t\tgantt.getTaskResources = function (taskId) {\n\t\t\t\tconst store = gantt.getDatastore(\"resource\");\n\t\t\t\tconst assignments = gantt.getTaskAssignments(taskId);\n\t\n\t\t\t\tconst uniqueResources = {};\n\t\t\t\tassignments.forEach(function(a){\n\t\t\t\t\tif(!uniqueResources[a.resource_id]){\n\t\t\t\t\t\tuniqueResources[a.resource_id] = a.resource_id;\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t\t\n\t\t\t\tconst resources = [];\n\t\t\t\tfor(const i in uniqueResources){\n\t\t\t\t\tconst res = store.getItem(uniqueResources[i]);\n\t\t\t\t\tif(res){\n\t\t\t\t\t\tresources.push(res);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\treturn resources;\n\t\t\t};\n\n\t\t\tgantt.updateTaskAssignments = _updateTaskBack;\n\t\t}\n\t}, {once: true});\n};","export default function addPlaceholder(gantt){\n\tfunction isEnabled(){\n\t\treturn gantt.config.placeholder_task;\n\t}\n\n\tfunction callIfEnabled(callback){\n\t\treturn function(){\n\t\t\tif(!isEnabled()){\n\t\t\t\treturn true;\n\t\t\t}\n\t\t\treturn callback.apply(this, arguments);\n\t\t};\n\t}\n\n\tfunction silenceDataProcessor(dataProcessor){\n\t\tif(dataProcessor && !dataProcessor._silencedPlaceholder){\n\t\t\tdataProcessor._silencedPlaceholder = true;\n\t\t\tdataProcessor.attachEvent(\"onBeforeUpdate\", callIfEnabled(function(id, state, data){\n\t\t\t\tif(data.type == gantt.config.types.placeholder){\n\t\t\t\t\tdataProcessor.setUpdated(id, false);\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\t\t\t\treturn true;\n\t\t\t}));\n\t\t}\n\t}\n\n\tfunction insertPlaceholder(){\n\t\tvar placeholders = gantt.getTaskBy(\"type\", gantt.config.types.placeholder);\n\t\tif(!placeholders.length || !gantt.isTaskExists(placeholders[0].id)){\n\t\t\tvar placeholder = {\n\t\t\t\tunscheduled: true,\n\t\t\t\ttype: gantt.config.types.placeholder,\n\t\t\t\tduration:0,\n\t\t\t\ttext: gantt.locale.labels.new_task\n\t\t\t};\n\t\t\tif(gantt.callEvent(\"onTaskCreated\", [placeholder]) === false){\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tgantt.addTask(placeholder);\n\t\t\t\n\t\t}\n\t}\n\n\tfunction afterEdit(id){\n\t\tvar item = gantt.getTask(id);\n\t\tif(item.type == gantt.config.types.placeholder) {\n\t\t\tif(item.start_date && item.end_date && item.unscheduled){\n\t\t\t\titem.unscheduled = false;\n\t\t\t}\n\n\t\t\tgantt.batchUpdate(function(){\n\t\t\t\tvar newTask = gantt.copy(item);\n\t\t\t\tgantt.silent(function(){\n\t\t\t\t\tgantt.deleteTask(item.id);\n\t\t\t\t});\n\n\t\t\t\tdelete newTask[\"!nativeeditor_status\"];\n\t\t\t\tnewTask.type = gantt.config.types.task;\n\t\t\t\tnewTask.id = gantt.uid();\n\t\t\t\tgantt.addTask(newTask);\n\n\t\t\t\t//insertPlaceholder();\n\t\t\t});\n\n\t\t}\n\t}\n\n\tgantt.config.types.placeholder = \"placeholder\";\n\tgantt.attachEvent(\"onDataProcessorReady\", callIfEnabled(silenceDataProcessor));\n\n\tvar ready = false;\n\tgantt.attachEvent(\"onGanttReady\", function(){\n\t\tif(ready){\n\t\t\treturn;\n\t\t}\n\t\tready = true;\n\t\tgantt.attachEvent(\"onAfterTaskUpdate\", callIfEnabled(afterEdit));\n\t\tgantt.attachEvent(\"onAfterTaskAdd\", callIfEnabled(function(id, task){\n\t\t\tif(task.type != gantt.config.types.placeholder){\n\t\t\t\tvar placeholders = gantt.getTaskBy(\"type\", gantt.config.types.placeholder);\n\t\t\t\tplaceholders.forEach(function(p){\n\t\t\t\t\tgantt.silent(function(){\n\t\t\t\t\t\tif(gantt.isTaskExists(p.id))\n\t\t\t\t\t\t\tgantt.deleteTask(p.id);\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t\t\tinsertPlaceholder();\n\t\t\t}\n\t\t}));\n\t\tgantt.attachEvent(\"onParse\", callIfEnabled(insertPlaceholder));\n\t});\n\n\tfunction isPlaceholderTask(taskId){\n\t\tif(gantt.config.types.placeholder && gantt.isTaskExists(taskId)){\n\t\t\tvar task = gantt.getTask(taskId);\n\t\t\tif(task.type == gantt.config.types.placeholder){\n\t\t\t\treturn true;\n\t\t\t}\n\t\t}\n\t\treturn false;\n\t}\n\tfunction isPlaceholderLink(link){\n\t\tif(isPlaceholderTask(link.source) || isPlaceholderTask(link.target)){\n\t\t\treturn true;\n\t\t}\n\t\treturn false;\n\t}\n\tgantt.attachEvent(\"onLinkValidation\", function(link){\n\t\tif(isPlaceholderLink(link)){\n\t\t\treturn false;\n\t\t}\n\t\treturn true;\n\t});\n\tgantt.attachEvent(\"onBeforeLinkAdd\", function(id,link){\n\t\tif(isPlaceholderLink(link)){\n\t\t\treturn false;\n\t\t}\n\t\treturn true;\n\t});\n\n\tgantt.attachEvent(\"onBeforeUndoStack\", function(action){\n\t\tfor(var i = 0; i < action.commands.length; i++){\n\t\t\tvar command = action.commands[i];\n\t\t\tif(command.entity === \"task\" && command.value.type === gantt.config.types.placeholder){\n\t\t\t\taction.commands.splice(i,1);\n\t\t\t\ti--;\n\t\t\t}\n\t\t}\n\t\treturn true;\n\t});\n\n};","export default function(gantt) {\n\tfunction isEnabled() {\n\t\treturn gantt.config.auto_types && // if enabled\n\t\t\t(gantt.getTaskType(gantt.config.types.project) == gantt.config.types.project);// and supported\n\t}\n\n\tfunction callIfEnabled(callback) {\n\t\treturn function() {\n\t\t\tif (!isEnabled()) {\n\t\t\t\treturn true;\n\t\t\t}\n\t\t\treturn callback.apply(this, arguments);\n\t\t};\n\t}\n\n\tfunction checkTaskType(id, changedTypes) {\n\t\tvar task = gantt.getTask(id);\n\t\tvar targetType = getTaskTypeToUpdate(task);\n\t\tif (targetType !== false && gantt.getTaskType(task) !== targetType) {\n\t\t\tchangedTypes.$needsUpdate = true;\n\t\t\tchangedTypes[task.id] = {task: task, type: targetType};\n\t\t}\n\t}\n\n\tfunction getUpdatedTypes(id, changedTypes) {\n\t\tchangedTypes = changedTypes || {};\n\t\t\n\t\tcheckTaskType(id, changedTypes);\n\t\tgantt.eachParent(function(parent) {\n\t\t\tcheckTaskType(parent.id, changedTypes);\n\t\t}, id);\n\n\t\treturn changedTypes;\n\t}\n\n\tfunction applyChanges(changedTypes) {\n\t\tfor (var i in changedTypes) {\n\t\t\tif(changedTypes[i] && changedTypes[i].task){\n\t\t\t\tvar task = changedTypes[i].task;\n\t\t\t\ttask.type = changedTypes[i].type;\n\t\t\t\tgantt.updateTask(task.id);\n\t\t\t}\n\t\t}\n\t}\n\n\tfunction updateParentTypes(startId) {\n\t\tif (gantt.getState().group_mode) {\n\t\t\treturn;\n\t\t}\n\t\t\n\t\tvar changedTypes = getUpdatedTypes(startId);\n\t\tif (changedTypes.$needsUpdate) {\n\t\t\tgantt.batchUpdate(function() {\n\t\t\t\tapplyChanges(changedTypes);\n\t\t\t});\n\t\t}\n\t}\n\n\tvar delTaskParent;\n\n\tfunction updateTaskType(task, targetType) {\n\t\tif(!gantt.getState().group_mode){\n\t\t\ttask.type = targetType;\n\t\t\tgantt.updateTask(task.id);\n\t\t}\n\t}\n\n\tfunction getTaskTypeToUpdate(task) {\n\t\tvar allTypes = gantt.config.types;\n\t\tvar hasChildren = gantt.hasChild(task.id);\n\t\tvar taskType = gantt.getTaskType(task.type);\n\n\t\tif (hasChildren && taskType === allTypes.task) {\n\t\t\treturn allTypes.project;\n\t\t}\n\n\t\tif (!hasChildren && taskType === allTypes.project) {\n\t\t\treturn allTypes.task;\n\t\t}\n\n\t\treturn false;\n\t}\n\n\tvar isParsingDone = true;\n\n\tgantt.attachEvent(\"onParse\", callIfEnabled(function() {\n\t\tisParsingDone = false;\n\t\tif(gantt.getState().group_mode){\n\t\t\treturn;\n\t\t}\n\n\t\tgantt.batchUpdate(function() {\n\t\t\tgantt.eachTask(function(task) {\n\t\t\t\tvar targetType = getTaskTypeToUpdate(task);\n\t\t\t\tif (targetType !== false) {\n\t\t\t\t\tupdateTaskType(task, targetType);\n\t\t\t\t}\n\t\t\t});\n\t\t});\n\n\t\tisParsingDone = true;\n\t}));\n\n\tgantt.attachEvent(\"onAfterTaskAdd\", callIfEnabled(function(id) {\n\t\tif (isParsingDone) {\n\t\t\tupdateParentTypes(id);\n\t\t}\n\t}));\n\n\tgantt.attachEvent(\"onAfterTaskUpdate\", callIfEnabled(function(id) {\n\t\tif (isParsingDone) {\n\t\t\tupdateParentTypes(id);\n\t\t}\n\t}));\n\n\tfunction updateAfterRemoveChild(id){\n\t\tif (id != gantt.config.root_id && gantt.isTaskExists(id)) {\n\t\t\tupdateParentTypes(id);\n\t\t}\n\t}\n\n\tgantt.attachEvent(\"onBeforeTaskDelete\", callIfEnabled(function(id, task) {\n\t\tdelTaskParent = gantt.getParent(id);\n\t\treturn true;\n\t}));\n\n\tgantt.attachEvent(\"onAfterTaskDelete\", callIfEnabled(function(id, task) {\n\t\tupdateAfterRemoveChild(delTaskParent);\n\t}));\n\n\n\tvar originalRowDndParent;\n\n\tgantt.attachEvent(\"onRowDragStart\", callIfEnabled(function(id, target, e) {\n\t\toriginalRowDndParent = gantt.getParent(id);\n\t\treturn true;\n\t}));\n\n\tgantt.attachEvent(\"onRowDragEnd\", callIfEnabled(function(id, target) {\n\t\tupdateAfterRemoveChild(originalRowDndParent);\n\t\tupdateParentTypes(id);\n\t}));\n\n\tvar originalMoveTaskParent;\n\n\tgantt.attachEvent(\"onBeforeTaskMove\", callIfEnabled(function(sid, parent, tindex) {\n\t\toriginalMoveTaskParent = gantt.getParent(sid);\n\t\treturn true;\n\t}));\n\n\tgantt.attachEvent(\"onAfterTaskMove\", callIfEnabled(function(id, parent, tindex) {\n\t\tif (document.querySelector(\".gantt_drag_marker\")) {\n\t\t\t// vertical dnd in progress\n\t\t\treturn;\n\t\t}\n\t\tupdateAfterRemoveChild(originalMoveTaskParent);\n\t\tupdateParentTypes(id);\n\t}));\n};","export default class DurationFormatterNumeric implements IDurationFormatter {\n\tstatic create = (settings: IDurationFormatterConfig = null): IDurationFormatter => {\n\t\treturn new DurationFormatterNumeric();\n\t};\n\tcanParse = (value: string) : boolean => {\n\t\treturn !isNaN(this.parse(value));\n\t};\n\tformat = (value: number) : string => {\n\t\treturn String(value);\n\t};\n\tparse = (value: string) : number => {\n\t\treturn parseInt(value, 10);\n\t};\n}","export default class LinkFormatterSimple implements ILinkFormatter {\n\tstatic create = (settings: ILinkFormatterConfig = null, gantt: any): LinkFormatterSimple => {\n\t\treturn new LinkFormatterSimple(gantt);\n\t};\n\tprotected _linkReg: RegExp;\n\tprotected _gantt: any;\n\n\tconstructor(gantt: any) {\n\t\tthis._linkReg = /^[0-9\\.]+/;\n\t\tthis._gantt = gantt;\n\t}\n\n\tformat = (link: ILink) : string => {\n\t\tconst wbs = this._getWBSCode(link.source);\n\t\treturn wbs;\n\t};\n\n\tcanParse = (value: string) : boolean => {\n\t\treturn this._linkReg.test(value);\n\t};\n\tparse = (value: string) : ILink => {\n\t\tif(!this.canParse(value)){\n\t\t\treturn null;\n\t\t}\n\n\t\tconst linkPart = this._linkReg.exec(value)[0].trim();\n\n\t\tconst source = this._findSource(linkPart) || null;\n\n\t\treturn {\n\t\t\tid: undefined,\n\t\t\tsource,\n\t\t\ttarget: null,\n\t\t\ttype: this._gantt.config.links.finish_to_start,\n\t\t\tlag: 0\n\t\t};\n\t};\n\n\tprotected _getWBSCode = (source: number | string) => {\n\t\tconst pred = this._gantt.getTask(source);\n\t\treturn this._gantt.getWBSCode(pred);\n\t};\n\n\tprotected _findSource = (value: string) => {\n\t\tconst reqTemplate = new RegExp(\"^[0-9\\.]+\", \"i\");\n\t\tif(reqTemplate.exec(value)){\n\t\t\tconst wbs = reqTemplate.exec(value)[0];\n\t\t\tconst task = this._gantt.getTaskByWBSCode(wbs);\n\t\t\tif(task){\n\t\t\t\treturn task.id;\n\t\t\t}\n\t\t}\n\t\treturn null;\n\t};\n}","\nimport DurationFormatter from \"../common/duration_formatter\";\nimport LinkFormatter from \"../common/link_formatter\";\n\nexport default function(gantt){\n\tgantt.ext.formatters = {\n\t\tdurationFormatter: function(settings){\n\t\t\tif(!settings){\n\t\t\t\tsettings = {};\n\t\t\t}\n\t\t\tif(!settings.store){\n\t\t\t\tsettings.store = gantt.config.duration_unit;\n\t\t\t}\n\t\t\tif(!settings.enter){\n\t\t\t\tsettings.enter = gantt.config.duration_unit;\n\t\t\t}\n\t\t\treturn DurationFormatter.create(settings, gantt);\n\t\t},\n\t\tlinkFormatter: function(settings){\n\t\t\treturn LinkFormatter.create(settings, gantt);\n\t\t}\n\t};\n};","export default function(gantt: any){\n\n\tgantt.ext = gantt.ext || {};\n\tgantt.config.show_empty_state = false;\n\n\tgantt.ext.emptyStateElement = gantt.ext.emptyStateElement || {\n\t\tisEnabled() {\n\t\t\treturn gantt.config.show_empty_state === true;\n\t\t},\n\t\tisGanttEmpty(){\n\t\t\treturn !gantt.getTaskByTime().length;\n\t\t},\n\t\trenderContent(container){\n\t\t\tconst placeholderTextElement = `<div class='gantt_empty_state_text'>\n    <div class='gantt_empty_state_text_link' data-empty-state-create-task>${gantt.locale.labels.empty_state_text_link}</div>\n    <div class='gantt_empty_state_text_description'>${gantt.locale.labels.empty_state_text_description}</div>\n    </div>`;\n\t\t\tconst placeholderImageElement = \"<div class='gantt_empty_state_image'></div>\";\n\n\t\t\tconst placeholderContainer = `<div class='gantt_empty_state'>${placeholderImageElement}${placeholderTextElement}</div>`;\n\t\t\tcontainer.innerHTML = placeholderContainer;\n\t\t},\n\n\t\tclickEvents: [],\n\t\tattachAddTaskEvent(){\n\t\t\tconst id = gantt.attachEvent(\"onEmptyClick\", function(e){\n\t\t\t\tconst domHelpers = gantt.utils.dom;\n\t\t\t\tconst gridPlaceholder = domHelpers.closest(e.target, \"[data-empty-state-create-task]\");\n\t\t\t\tif (gridPlaceholder){\n\t\t\t\t\tgantt.createTask({\n\t\t\t\t\t\tid: gantt.uid(),\n\t\t\t\t\t\ttext: \"New Task\"\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t});\n\t\t\tthis.clickEvents.push(id);\n\t\t},\n\t\tdetachAddTaskEvents(){\n\t\t\tthis.clickEvents.forEach(function(event){\n\t\t\t\tgantt.detachEvent(event);\n\t\t\t});\n\t\t\tthis.clickEvents = [];\n\t\t},\n\n\t\tgetContainer(){\n\t\t\tif (gantt.$container) {\n\t\t\t\tconst domHelpers = gantt.utils.dom;\n\t\t\t\tif (gantt.$container.contains(gantt.$grid_data)) {\n\t\t\t\t\treturn domHelpers.closest(gantt.$grid_data, \".gantt_layout_content\");\n\t\t\t\t}\n\t\t\t\tif (gantt.$container.contains(gantt.$task_data)){\n\t\t\t\t\treturn domHelpers.closest(gantt.$task_data, \".gantt_layout_content\");\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn null;\n\t\t},\n\n\t\tgetNode(){\n\t\t\tconst container = this.getContainer();\n\t\t\tif (!container){\n\t\t\t\treturn null;\n\t\t\t}\n\t\t\tconst emptyStateElementNode = container.querySelector(\".gantt_empty_state_wrapper\");\n\t\t\treturn emptyStateElementNode;\n\t\t},\n\n\t\tshow(){\n\t\t\tconst container = this.getContainer();\n\t\t\tif (!container && this.isGanttEmpty()){\n\t\t\t\treturn null;\n\t\t\t}\n\n\t\t\tconst wrapper = document.createElement(\"div\");\n\t\t\twrapper.className = \"gantt_empty_state_wrapper\";\n\t\t\twrapper.style.marginTop = (gantt.config.scale_height - container.offsetHeight) + \"px\";\n\t\t\tconst oldNodes = gantt.$container.querySelectorAll(\".gantt_empty_state_wrapper\");\n\t\t\t// for IE11\n\t\t\tArray.prototype.forEach.call(oldNodes, function(node){\n\t\t\t\tnode.parentNode.removeChild(node);\n\t\t\t});\n\n\t\t\tthis.detachAddTaskEvents();\n\t\t\tthis.attachAddTaskEvent();\n\n\t\t\tcontainer.appendChild(wrapper);\n\t\t\tthis.renderContent(wrapper);\n\t\t},\n\t\thide(){\n\t\t\tconst emptyStateElementNode = this.getNode();\n\t\t\tif (emptyStateElementNode){\n\t\t\t\temptyStateElementNode.parentNode.removeChild(emptyStateElementNode);\n\t\t\t} else{\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t},\n\t\tinit(){ }\n\t};\n\n\tgantt.attachEvent(\"onDataRender\", function() {\n\t\tconst emptyStateElement = gantt.ext.emptyStateElement;\n\t\tif (emptyStateElement.isEnabled() && emptyStateElement.isGanttEmpty()) {\n\t\t\temptyStateElement.show();\n\t\t} else {\n\t\t\temptyStateElement.hide();\n\t\t}\n\t});\n\n\n\n\n}\n","export const hasBaselinesBelow = function (gantt, task) {\n  const baselines = task.baselines && task.baselines.length;\n  const baselinesOnDifferentRow = gantt.config.baselines.render_mode == \"separateRow\" || gantt.config.baselines.render_mode == \"individualRow\";\n  if (baselines && baselinesOnDifferentRow) {\n    return true;\n  }\n};\n\nexport const childrenHaveBaselines = function (gantt, taskId) {\n  let hasBaselines = false;\n  gantt.eachTask(function (child) {\n    if (hasBaselines) {\n      return;\n    }\n    hasBaselines = hasBaselinesBelow(gantt, child);\n  }, taskId);\n  return hasBaselines;\n};\n\nexport const isSplitChild = function (gantt, id) {\n  let splitChild = false;\n  gantt.eachParent(function (parent) {\n    if (isSplitParent(parent)) {\n      splitChild = true;\n    }\n  }, id);\n  return splitChild;\n};\n\nexport const isSplitParent = function (task) {\n  return task.render && task.render == \"split\" && !task.$open;\n};\n\nexport const getMaxParentHeight = function (gantt, view, task, heightLimit) {\n  let maxHeight = heightLimit || view.$task_data.scrollHeight;\n  let shrinkHeight = false;\n  let splitChild = false;\n\n  gantt.eachParent(function (parent) {\n    if (isSplitParent(parent)) {\n      splitChild = true;\n      const parentSizes = view.getItemPosition(parent);\n      const parentHeight = parentSizes.rowHeight;\n      if (parentHeight < maxHeight) {\n        maxHeight = parentHeight;\n        shrinkHeight = true;\n      }\n    }\n  }, task.id);\n\n  return { maxHeight, shrinkHeight, splitChild };\n};\n\nexport const getMilestoneHeight = function (height) {\n  return Math.sqrt(2 * height * height);\n};\n\nexport const getInvertedMilestoneHeight = function (height) {\n  return Math.round(height / Math.sqrt(2));\n};\n\nexport const getAdjustedPosition = function (gantt, timeline, sizes, heightLimit, task, childBaselines) {\n  const baselines = hasBaselinesBelow(gantt, task);\n\n  const splitParams = getMaxParentHeight(gantt, timeline, task);\n  let maxHeight = splitParams.maxHeight;\n\n  let height = sizes.height;\n  let largerHeight = height > heightLimit;\n  let noNeedToShrink = sizes.rowHeight >= heightLimit && !splitParams.splitChild && !baselines;\n  if (largerHeight || noNeedToShrink) {\n    height = heightLimit;\n  }\n\n  if (maxHeight < height) {\n    height = maxHeight;\n  }\n\n  let marginTop = Math.floor((sizes.rowHeight - height) / 2);\n\n  if (splitParams.splitChild) {\n    marginTop = Math.floor((maxHeight - height) / 2);\n  }\n  if (childBaselines || baselines) {\n    let heightDiff = Math.min(sizes.height, maxHeight) - height;\n\n    let additionalMargin = 2;\n    let exceedBarHeight = baselines && task.bar_height >= task.row_height;\n    let exceedParentHeight = splitParams.splitChild && sizes.height >= maxHeight;\n    if (exceedBarHeight || exceedParentHeight){\n      additionalMargin = 0;\n    }\n\n    marginTop = Math.floor(heightDiff / 2) + additionalMargin;\n    const bottom = height + marginTop;\n    if (bottom > sizes.rowHeight || bottom > maxHeight) {\n      // marginTop = 0;\n    }\n  }\n\n  return { height, marginTop };\n};\n\nexport default {\n  hasBaselinesBelow,\n  childrenHaveBaselines,\n  isSplitChild,\n  isSplitParent,\n  getMaxParentHeight,\n  getMilestoneHeight,\n  getInvertedMilestoneHeight,\n  getAdjustedPosition\n};\n","import { hasBaselinesBelow, isSplitParent } from \"../ui/render/baseline_helper\";\n\nexport default function (gantt) {\n  gantt.config.baselines = {\n    datastore: \"baselines\",\n    render_mode: false,\n    dataprocessor_baselines: false,\n    row_height: 16,\n    bar_height: 8\n  };\n\n  function initBaselineFields(item, task) {\n    // don't add baseline if it doesn't belong to any task\n    // or if doesn't have the dates\n    if (!item.task_id || (!item.start_date && !item.end_date)) {\n      return false;\n    }\n\n    if (item.start_date) {\n      item.start_date = gantt.date.parseDate(item.start_date, \"parse_date\");\n    } else {\n      item.start_date = null;\n    }\n\n    if (item.end_date) {\n      item.end_date = gantt.date.parseDate(item.end_date, \"parse_date\");\n    } else {\n      item.end_date = null;\n    }\n\n    // set min baseline duration\n    item.duration = item.duration || 1;\n\n    // GS-2636. Calculate the 3rd date parameter basing on existing date parameters\n    if (item.start_date && !item.end_date){\n      item.end_date = gantt.calculateEndDate(item.start_date, item.duration);\n    } else if (item.end_date && !item.start_date){\n      item.start_date = gantt.calculateEndDate(item.end_date, -item.duration);\n    } \n  }\n  // gantt init\n  const baselineStore = gantt.createDatastore({\n    name: gantt.config.baselines.datastore,\n    initItem: function (item) {\n      if (!item.id) {\n        item.id = gantt.uid();\n      }\n\n      initBaselineFields(item);\n\n      return item;\n    }\n  });\n\n  gantt.$data.baselineStore = baselineStore;\n\n  function _syncBaselines(task) {\n    let shouldRepaint = false;\n    const iteratedBaselines = {};\n\n    const taskBaselines = task.baselines || [];\n    const exisingBaselines = gantt.getTaskBaselines(task.id);\n\n    if (taskBaselines.length != exisingBaselines.length) {\n      shouldRepaint = true;\n    }\n\n    taskBaselines.forEach(function (baseline) {\n      iteratedBaselines[baseline.id] = true;\n      const exisingBaseline = baselineStore.getItem(baseline.id);\n      if (exisingBaseline) {\n        const start = +exisingBaseline.start_date !== +baseline.start_date;\n        const end = +exisingBaseline.end_date !== +baseline.end_date;\n        if (start || end) {\n          baselineStore.updateItem(baseline.id, baseline);\n        }\n      } else {\n        baselineStore.addItem(baseline);\n      }\n    });\n\n    exisingBaselines.forEach(function (baseline) {\n      if (!iteratedBaselines[baseline.id]) {\n        baselineStore.removeItem(baseline.id);\n      }\n    });\n\n    if (shouldRepaint) {\n      if (isSplitParent(task)){\n        // here we adjust the parent height, then adjust it with the total child height\n        _adjustSplitParentHeight (task);\n      } else {\n        gantt.adjustTaskHeightForBaselines(task);\n      }\n      gantt.render();\n    }\n  }\n\n  function _deleteOrphanBaselines() {\n    baselineStore.eachItem(function (baseline) {\n      if (!gantt.isTaskExists(baseline.task_id)) {\n        baselineStore.removeItem(baseline.id);\n      }\n    });\n  }\n\n  function _adjustSplitParentHeight (task){\n    let maxParentHeight = 0;\n\n    gantt.adjustTaskHeightForBaselines(task);\n\n    gantt.eachTask(function(child){\n      let childHeight = child.row_height || gantt.config.row_height;\n\n      maxParentHeight = maxParentHeight || childHeight;\n      if (childHeight > maxParentHeight){\n        maxParentHeight = childHeight;\n      }\n    }, task.id);\n\n    if (task.row_height < maxParentHeight){\n      task.row_height = maxParentHeight;\n    }\n  }\n\n  gantt.adjustTaskHeightForBaselines = function (task) {\n    let height, baselineSize, betweenBaselines;\n    let margins = 2;\n    let baselineAmount = task.baselines && task.baselines.length || 0;\n    const subrowHeight = gantt.config.baselines.row_height;\n    //const baselineBarHeight = task?.baselines.bar_height\n\n    switch (gantt.config.baselines.render_mode) {\n      case \"taskRow\":\n        task.row_height = task.bar_height + 4;\n        break;\n\n      case \"separateRow\":\n        height = gantt.getLayoutView(\"timeline\").getBarHeight(task.id);\n        if (baselineAmount) {\n          task.bar_height = task.bar_height || height;\n\n          if (task.bar_height > height){\n            height = task.bar_height;\n          }\n\n          task.row_height = height + subrowHeight;\n        } else if (task.bar_height) {\n          task.row_height = task.bar_height + 4;\n        }\n\n        _increaseSplitParentHeight(task);\n        break;\n\n      case \"individualRow\":\n        height = gantt.getLayoutView(\"timeline\").getBarHeight(task.id);\n\n        if (baselineAmount) {\n          task.bar_height = task.bar_height || height;\n\n          if (task.bar_height > height){\n            height = task.bar_height;\n          }\n\n          baselineSize = subrowHeight * baselineAmount;\n       //   betweenBaselines = 3 * (baselineAmount + 1);\n\n          task.row_height = height + baselineSize + margins;\n        } else if (task.bar_height){\n          task.row_height = task.bar_height + 4;\n        }\n\n        _increaseSplitParentHeight(task);\n    }\n  };\n\n  function _increaseSplitParentHeight(task) {\n    gantt.eachParent(function (parent) {\n      if (isSplitParent(parent)) {\n        const parentHeight = parent.row_height || gantt.getLayoutView(\"timeline\").getBarHeight(parent.id);\n        let maxHeight = task.row_height;\n\n        // iterate only direct children\n        const subtasks = gantt.getChildren(parent.id);\n        subtasks.forEach(function (subtaskId) {\n          const subtask = gantt.getTask(subtaskId);\n          if (subtask.id == task.id) {\n            return;\n          }\n          const subtaskHeight = subtask.row_height || gantt.getLayoutView(\"timeline\").getBarHeight(subtask.id);\n          maxHeight = maxHeight || subtaskHeight;\n          if (subtaskHeight > maxHeight) {\n            maxHeight = subtaskHeight;\n          }\n        });\n\n        parent.row_height = maxHeight;\n        parent.bar_height = parent.bar_height || parentHeight;\n      }\n    }, task.id);\n  }\n\n  gantt.attachEvent(\n    \"onGanttReady\",\n    function () {\n\n      if(gantt.config.baselines === false){\n        return;\n      }\n\n      gantt.attachEvent(\"onParse\", function () {\n        baselineStore.eachItem(function (baseline) {\n          const taskId = baseline.task_id;\n          if (gantt.isTaskExists(taskId)) {\n            const task = gantt.getTask(taskId);\n\n            task.baselines = task.baselines || [];\n\n            let newBaseline = true;\n            for (let i = 0; i < task.baselines.length; i++) {\n              let existingBaseline = task.baselines[i];\n              if (existingBaseline.id == baseline.id){\n                newBaseline = false;\n                gantt.mixin(existingBaseline, baseline, true);\n                break;\n              }\n            }\n            if (newBaseline){\n              task.baselines.push(baseline);\n            }\n\n            if (isSplitParent(task)){\n              _adjustSplitParentHeight (task);\n            } else {\n              gantt.adjustTaskHeightForBaselines(task);\n            }\n          }\n        });\n      });\n\n      gantt.attachEvent(\"onBeforeTaskUpdate\", function (id, task) {\n        _syncBaselines(task);\n        return true;\n      });\n\n      gantt.attachEvent(\"onAfterUndo\", function(action){\n        const baselinesRenderedBelow = gantt.config.baselines.render_mode == \"separateRow\" || gantt.config.baselines.render_mode == \"individualRow\";\n        if (baselinesRenderedBelow && action){\n          let repaint = false;\n          action.commands.forEach(function(command){\n            if (command.entity == \"task\"){\n              const taskId = command.value.id;\n              if (gantt.isTaskExists(taskId)){\n                const task = gantt.getTask(taskId);\n                if (task.parent && gantt.isTaskExists(task.parent)){\n                  const parent = gantt.getTask(task.parent);\n                  if (isSplitParent(parent)){\n                    _adjustSplitParentHeight (parent);\n                    repaint = true;\n                  }\n                }\n              }    \n            }\n          });\n          if (repaint){\n            gantt.render();\n          }\n        }\n      });\n\n      gantt.attachEvent(\"onAfterTaskDelete\", function (id, task) {\n        if (hasBaselinesBelow){\n          if (task.parent && gantt.isTaskExists(task.parent)){\n            const parent = gantt.getTask(task.parent);\n            if (isSplitParent(parent)){\n              _adjustSplitParentHeight (parent);\n            }\n          }\n        }\n        _deleteOrphanBaselines();\n      });\n\n      gantt.getTaskBaselines = function (taskId) {\n        const baselines = [];\n        baselineStore.eachItem(function (baseline) {\n          if (baseline.task_id == taskId) {\n            baselines.push(baseline);\n          }\n        });\n        return baselines;\n      };\n      gantt.$data.baselineStore.attachEvent(\"onClearAll\", function () {\n        gantt.eachTask(function(task){\n          if (task.baselines){\n            delete task.baselines;\n          }\n        });\n        // The data should not be repainted as otherwise it causes issues when we have resource \n        // assignments and group tasks. It should be fixed when we add a repaint stack\n        // gantt.refreshData();\n        return true;\n      });\n\n      gantt.$data.tasksStore.attachEvent(\"onClearAll\", function () {\n        baselineStore.clearAll();\n        return true;\n      });\n      gantt.attachEvent(\"onTaskIdChange\", function (id, new_id) {\n        const baselines = baselineStore.find(function (a) {\n          return a.task_id == id;\n        });\n        baselines.forEach(function (a) {\n          a.task_id = new_id;\n          baselineStore.updateItem(a.id);\n        });\n      });\n    },\n    { once: true }\n  );\n};\n","import * as helpers from \"../../utils/helpers\";\n\nexport default function(gantt) {\n\tgantt.load = function(){\n\t\tthrow new Error(\"gantt.load() method is not available in the node.js, use gantt.parse() instead\");\n\t};\n\tgantt.parse = function (data, type) {\n\t\tthis.on_load({xmlDoc: {responseText: data}}, type);\n\t};\n\n\tgantt.serialize = function (type) {\n\t\ttype = type || \"json\";\n\t\treturn this[type].serialize();\n\t};\n\n\t/*\n\ttasks and relations\n\t{\n\tdata:[\n\t\t{\n\t\t\t\"id\":\"string\",\n\t\t\t\"text\":\"...\",\n\t\t\t\"start_date\":\"Date or string\",\n\t\t\t\"end_date\":\"Date or string\",\n\t\t\t\"duration\":\"number\",\n\t\t\t\"progress\":\"0..1\",\n\t\t\t\"parent_id\":\"string\",\n\t\t\t\"order\":\"number\"\n\t\t},...],\n\tlinks:[\n\t\t{\n\t\t\tid:\"string\",\n\t\t\tsource:\"string\",\n\t\t\ttarget:\"string\",\n\t\t\ttype:\"string\"\n\t\t},...],\n\tcollections:{\n\t\t\tcollectionName:[\n\t\t\t\t{key:, label:, optional:...},...\n\t\t\t],...\n\t\t}\n\t}\n\n\t* */\n\n\tgantt.on_load = function (resp, type) {\n\t\tif(resp.xmlDoc && resp.xmlDoc.status === 404){ // work if we don't have a file at current url\n\t\t\tthis.assert(false, \"Failed to load the data from <a href='\" + resp.xmlDoc.responseURL + \"' target='_blank'>\" \n\t\t\t\t+ resp.xmlDoc.responseURL + \"</a>, server returns 404\");\n\t\t\treturn;\n\t\t}\n\t\tif(gantt.$destroyed){\n\t\t\treturn;\n\t\t}\n\t\tthis.callEvent(\"onBeforeParse\", []);\n\t\tif (!type)\n\t\t\ttype = \"json\";\n\t\tthis.assert(this[type], \"Invalid data type:'\" + type + \"'\");\n\n\t\tvar raw = resp.xmlDoc.responseText;\n\n\t\tvar data = this[type].parse(raw, resp);\n\t\tthis._process_loading(data);\n\t};\n\n\tfunction attachAssignmentsToTasks(tasks, assignments) {\n\t\tconst assignmentsByTasks = {};\n\t\tassignments.forEach((a)=>{\n\t\t\tif(!assignmentsByTasks[a.task_id]) {\n\t\t\t\tassignmentsByTasks[a.task_id] = [];\n\t\t\t}\n\t\t\tassignmentsByTasks[a.task_id].push(a);\n\t\t});\n\t\ttasks.forEach((t) => {\n\t\t\tt[gantt.config.resource_property] = assignmentsByTasks[t.id] || [];\n\t\t});\t\n\t}\n\t\n\tgantt._process_loading = function (data) {\n\t\tif(data.collections)\n\t\t\tthis._load_collections(data.collections);\n\n\t\tif(data.resources && this.$data.resourcesStore){\n\t\t\tthis.$data.resourcesStore.parse(data.resources);\n\t\t}\n\t\tif(gantt.config.baselines !== false && data.baselines && this.$data.baselineStore){\n\t\t\tthis.$data.baselineStore.parse(data.baselines);\n\t\t}\n\t\t\n\t\tconst tasks = data.data || data.tasks;\n\t\tif(data.assignments){\n\t\t\tattachAssignmentsToTasks(tasks, data.assignments);\n\t\t}\n\n\t\tthis.$data.tasksStore.parse(tasks);\n\t\tvar links = data.links || (data.collections ? data.collections.links : []);\n\t\tthis.$data.linksStore.parse(links);\n\n\t\t//this._sync_links();\n\t\tthis.callEvent(\"onParse\", []);\n\t\tthis.render();\n\t};\n\n\tgantt._load_collections = function (collections) {\n\t\tvar collections_loaded = false;\n\t\tfor (var key in collections) {\n\t\t\tif (collections.hasOwnProperty(key)) {\n\t\t\t\tcollections_loaded = true;\n\t\t\t\tvar collection = collections[key];\n\t\t\t\t// GS-1728. Create an empty serverList if it doesn't exist\n\t\t\t\tthis.serverList[key] = this.serverList[key] || [];\n\t\t\t\tvar arr = this.serverList[key];\n\t\t\t\tif (!arr) continue;\n\t\t\t\tarr.splice(0, arr.length); //clear old options\n\t\t\t\tfor (var j = 0; j < collection.length; j++) {\n\t\t\t\t\tvar option = collection[j];\n\t\t\t\t\tvar obj = this.copy(option);\n\t\t\t\t\tobj.key = obj.value;// resulting option object\n\n\t\t\t\t\tfor (var option_key in option) {\n\t\t\t\t\t\tif (option.hasOwnProperty(option_key)) {\n\t\t\t\t\t\t\tif (option_key == \"value\" || option_key == \"label\")\n\t\t\t\t\t\t\t\tcontinue;\n\t\t\t\t\t\t\tobj[option_key] = option[option_key]; // obj['value'] = option['value']\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tarr.push(obj);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tif (collections_loaded)\n\t\t\tthis.callEvent(\"onOptionsLoad\", []);\n\t};\n\n\tgantt.attachEvent(\"onBeforeTaskDisplay\", function (id, task) {\n\t\treturn !task.$ignore;\n\t});\n\n\tfunction jsonParseError(data){\n\t\tgantt.assert(false, \"Can't parse data: incorrect value of gantt.parse or gantt.load method. \"\n\t\t\t+ \"Actual argument value: \" + JSON.stringify(data));\n\t\tthrow new Error(\"Invalid argument for gantt.parse or gantt.load. An object or a JSON string of format https://docs.dhtmlx.com/gantt/desktop__supported_data_formats.html#json is expected. Actual argument value: \"\n\t\t\t+ JSON.stringify(data));\n\t}\n\n\tgantt.json = {\n\t\tparse: function (data) {\n\t\t\tif(!data){\n\t\t\t\tjsonParseError(data);\n\t\t\t}\n\n\t\t\tif (typeof data == \"string\") {\n\t\t\t\tif (typeof JSON != undefined){\n\t\t\t\t\ttry{\n\t\t\t\t\t\tdata = JSON.parse(data);\n\t\t\t\t\t}\n\t\t\t\t\tcatch(e) {\n\t\t\t\t\t\tjsonParseError(data);\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tgantt.assert(false, \"JSON is not supported\");\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif(!data.data && !data.tasks){\n\t\t\t\tjsonParseError(data);\n\t\t\t}\n\n\t\t\tif (data.dhx_security)\n\t\t\t\tgantt.security_key = data.dhx_security;\n\t\t\treturn data;\n\t\t},\n\t\tserializeTask: function (task) {\n\t\t\treturn this._copyObject(task);\n\t\t},\n\t\tserializeLink: function (link) {\n\t\t\treturn this._copyLink(link);\n\t\t},\n\t\t_copyLink: function (obj) {\n\t\t\tvar copy = {};\n\t\t\tfor (var key in obj)\n\t\t\t\tcopy[key] = obj[key];\n\t\t\treturn copy;\n\t\t},\n\t\t_copyObject: function (obj) {\n\t\t\tvar copy = {};\n\t\t\tfor (var key in obj) {\n\t\t\t\tif (key.charAt(0) == \"$\")\n\t\t\t\t\tcontinue;\n\t\t\t\tcopy[key] = obj[key];\n\n\t\t\t\tif (helpers.isDate(copy[key])) {\n\t\t\t\t\tcopy[key] = gantt.defined(gantt.templates.xml_format) ? gantt.templates.xml_format(copy[key]) : gantt.templates.format_date(copy[key]);\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn copy;\n\t\t},\n\t\tserialize: function () {\n\t\t\tvar tasks = [];\n\t\t\tvar links = [];\n\t\t\tlet baselines = [];\n\n\t\t\tgantt.eachTask(function (obj) {\n\t\t\t\tgantt.resetProjectDates(obj);\n\t\t\t\ttasks.push(this.serializeTask(obj));\n\t\t\t}, gantt.config.root_id, this);\n\n\t\t\tvar rawLinks = gantt.getLinks();\n\t\t\tfor (var i = 0; i < rawLinks.length; i++) {\n\t\t\t\tlinks.push(this.serializeLink(rawLinks[i]));\n\t\t\t}\n\n\t\t\tconst baselineStore = gantt.getDatastore(\"baselines\");\n\t\t\tbaselineStore.eachItem(function(baseline){\n\t\t\t\tconst baselineCopy = gantt.json.serializeTask(baseline);\n\t\t\t\tbaselines.push(baselineCopy);\n\t\t\t});\n\n\t\t\treturn {\n\t\t\t\tdata: tasks,\n\t\t\t\tlinks,\n\t\t\t\tbaselines\n\t\t\t};\n\t\t}\n\t};\n\n\t/*\n\t<data>\n\t\t<task id:\"some\" parent_id=\"0\" progress=\"0.5\">\n\t\t\t<text>My task 1</text>\n\t\t\t<start_date>16.08.2013</start_date>\n\t\t\t<end_date>22.08.2013</end_date>\n\t\t</task>\n\t\t<coll_options>\n\t\t\t<links>\n\t\t\t\t<link source='a1' target='b2' type='c3' />\n\t\t\t</links>\n\t\t</coll_options>\n\t</data>\n\t*/\n\n\tfunction xmlParseError(data){\n\t\tgantt.assert(false, \"Can't parse data: incorrect value of gantt.parse or gantt.load method. \"\n\t\t\t+ \"Actual argument value: \" + JSON.stringify(data));\n\t\tthrow new Error(\"Invalid argument for gantt.parse or gantt.load. An XML of format https://docs.dhtmlx.com/gantt/desktop__supported_data_formats.html#xmldhtmlxgantt20 is expected. Actual argument value: \"\n\t\t\t+ JSON.stringify(data));\n\t}\n\n\tgantt.xml = {\n\t\t_xmlNodeToJSON: function (node, attrs_only) {\n\t\t\tvar t = {};\n\t\t\tfor (var i = 0; i < node.attributes.length; i++)\n\t\t\t\tt[node.attributes[i].name] = node.attributes[i].value;\n\n\t\t\tif (!attrs_only) {\n\t\t\t\tfor (var i = 0; i < node.childNodes.length; i++) {\n\t\t\t\t\tvar child = node.childNodes[i];\n\t\t\t\t\tif (child.nodeType == 1)\n\t\t\t\t\t\tt[child.tagName] = child.firstChild ? child.firstChild.nodeValue : \"\";\n\t\t\t\t}\n\n\t\t\t\tif (!t.text) t.text = node.firstChild ? node.firstChild.nodeValue : \"\";\n\t\t\t}\n\n\t\t\treturn t;\n\t\t},\n\t\t_getCollections: function (loader) {\n\t\t\tvar collection = {};\n\t\t\tvar opts = gantt.ajax.xpath(\"//coll_options\", loader);\n\t\t\tfor (var i = 0; i < opts.length; i++) {\n\t\t\t\tvar bind = opts[i].getAttribute(\"for\");\n\t\t\t\tvar arr = collection[bind] = [];\n\t\t\t\tvar itms = gantt.ajax.xpath(\".//item\", opts[i]);\n\t\t\t\tfor (var j = 0; j < itms.length; j++) {\n\t\t\t\t\tvar itm = itms[j];\n\t\t\t\t\tvar attrs = itm.attributes;\n\t\t\t\t\tvar obj = {key: itms[j].getAttribute(\"value\"), label: itms[j].getAttribute(\"label\")};\n\t\t\t\t\tfor (var k = 0; k < attrs.length; k++) {\n\t\t\t\t\t\tvar attr = attrs[k];\n\t\t\t\t\t\tif (attr.nodeName == \"value\" || attr.nodeName == \"label\")\n\t\t\t\t\t\t\tcontinue;\n\t\t\t\t\t\tobj[attr.nodeName] = attr.nodeValue;\n\t\t\t\t\t}\n\t\t\t\t\tarr.push(obj);\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn collection;\n\t\t},\n\t\t_getXML: function (text, loader, toptag) {\n\t\t\ttoptag = toptag || \"data\";\n\t\t\tif (!loader.getXMLTopNode) {\n\t\t\t\tloader = gantt.ajax.parse(loader);\n\t\t\t}\n\n\t\t\tvar xml = gantt.ajax.xmltop(toptag, loader.xmlDoc);\n\t\t\tif (!xml || xml.tagName != toptag) {\n\t\t\t\txmlParseError(text);\n\t\t\t}\n\n\t\t\tvar skey = xml.getAttribute(\"dhx_security\");\n\t\t\tif (skey)\n\t\t\t\tgantt.security_key = skey;\n\n\t\t\treturn xml;\n\t\t},\n\t\tparse: function (text, loader) {\n\t\t\tloader = this._getXML(text, loader);\n\t\t\tvar data = {};\n\n\t\t\tvar evs = data.data = [];\n\t\t\tvar xml = gantt.ajax.xpath(\"//task\", loader);\n\n\t\t\tfor (var i = 0; i < xml.length; i++)\n\t\t\t\tevs[i] = this._xmlNodeToJSON(xml[i]);\n\n\t\t\tdata.collections = this._getCollections(loader);\n\t\t\treturn data;\n\t\t},\n\t\t_copyLink: function (obj) {\n\t\t\treturn \"<item id='\" + obj.id + \"' source='\" + obj.source + \"' target='\" + obj.target + \"' type='\" + obj.type + \"' />\";\n\t\t},\n\t\t_copyObject: function (obj) {\n\t\t\treturn \"<task id='\" + obj.id + \"' parent='\" + (obj.parent || \"\") + \"' start_date='\" + obj.start_date + \"' duration='\" + obj.duration + \"' open='\" + (!!obj.open) + \"' progress='\" + obj.progress + \"' end_date='\" + obj.end_date + \"'><![CDATA[\" + obj.text + \"]]></task>\";\n\t\t},\n\t\tserialize: function () {\n\t\t\tvar tasks = [];\n\t\t\tvar links = [];\n\n\t\t\tvar json = gantt.json.serialize();\n\t\t\tfor (var i = 0, len = json.data.length; i < len; i++) {\n\t\t\t\ttasks.push(this._copyObject(json.data[i]));\n\t\t\t}\n\t\t\tfor (var i = 0, len = json.links.length; i < len; i++) {\n\t\t\t\tlinks.push(this._copyLink(json.links[i]));\n\t\t\t}\n\t\t\treturn \"<data>\" + tasks.join(\"\") + \"<coll_options for='links'>\" + links.join(\"\") + \"</coll_options></data>\";\n\t\t}\n\t};\n\n\n\tgantt.oldxml = {\n\t\tparse: function (text, loader) {\n\t\t\tloader = gantt.xml._getXML(text, loader, \"projects\");\n\t\t\tvar data = {collections: {links: []}};\n\n\t\t\tvar evs = data.data = [];\n\t\t\tvar xml = gantt.ajax.xpath(\"//task\", loader);\n\n\t\t\tfor (var i = 0; i < xml.length; i++) {\n\t\t\t\tevs[i] = gantt.xml._xmlNodeToJSON(xml[i]);\n\t\t\t\tvar parent = xml[i].parentNode;\n\n\t\t\t\tif (parent.tagName == \"project\")\n\t\t\t\t\tevs[i].parent = \"project-\" + parent.getAttribute(\"id\");\n\t\t\t\telse\n\t\t\t\t\tevs[i].parent = parent.parentNode.getAttribute(\"id\");\n\t\t\t}\n\n\t\t\txml = gantt.ajax.xpath(\"//project\", loader);\n\t\t\tfor (var i = 0; i < xml.length; i++) {\n\t\t\t\tvar ev = gantt.xml._xmlNodeToJSON(xml[i], true);\n\t\t\t\tev.id = \"project-\" + ev.id;\n\t\t\t\tevs.push(ev);\n\t\t\t}\n\n\t\t\tfor (var i = 0; i < evs.length; i++) {\n\t\t\t\tvar ev = evs[i];\n\t\t\t\tev.start_date = ev.startdate || ev.est;\n\t\t\t\tev.end_date = ev.enddate;\n\t\t\t\tev.text = ev.name;\n\t\t\t\tev.duration = ev.duration / 8;\n\t\t\t\tev.open = 1;\n\t\t\t\tif (!ev.duration && !ev.end_date) ev.duration = 1;\n\t\t\t\tif (ev.predecessortasks)\n\t\t\t\t\tdata.collections.links.push({\n\t\t\t\t\t\ttarget: ev.id,\n\t\t\t\t\t\tsource: ev.predecessortasks,\n\t\t\t\t\t\ttype: gantt.config.links.finish_to_start\n\t\t\t\t\t});\n\t\t\t}\n\n\t\t\treturn data;\n\t\t},\n\t\tserialize: function () {\n\t\t\tgantt.message(\"Serialization to 'old XML' is not implemented\");\n\t\t}\n\t};\n\n\tgantt.serverList = function (name, array) {\n\t\tif (array) {\n\t\t\tthis.serverList[name] = array.slice(0);\n\t\t} else if (!this.serverList[name]) {\n\t\t\tthis.serverList[name] = [];\n\t\t}\n\t\treturn this.serverList[name];\n\t};\n\n};","import * as utils from \"../../utils/utils\";\nimport * as helpers from \"../../utils/helpers\";\n\n\nfunction IsWorkTimeArgument(date, unit, task, id, calendar){\n\tthis.date = date;\n\tthis.unit = unit;\n\tthis.task = task;\n\tthis.id = id;\n\tthis.calendar = calendar;\n\treturn this;\n}\n\nfunction ClosestWorkTimeArgument(date, dir, unit, task, id, calendar){\n\tthis.date = date;\n\tthis.dir = dir;\n\tthis.unit = unit;\n\tthis.task = task;\n\tthis.id = id;\n\tthis.calendar = calendar;\n\treturn this;\n}\n\nfunction CalculateEndDateArgument(start_date, duration, unit, step, task, id, calendar){\n\tthis.start_date = start_date;\n\tthis.duration = duration;\n\tthis.unit = unit;\n\tthis.step = step;\n\tthis.task = task;\n\tthis.id = id;\n\tthis.calendar = calendar;\n\treturn this;\n}\n\nfunction GetDurationArgument(start, end, task, calendar) {\n\tthis.start_date = start;\n\tthis.end_date = end;\n\tthis.task = task;\n\tthis.calendar = calendar;\n\tthis.unit = null;\n\tthis.step = null;\n\treturn this;\n}\n\nvar calendarArgumentsHelper = function(gantt){\n\treturn {\n\t\tgetWorkHoursArguments: function () {\n\t\t\tvar config = arguments[0];\n\t\t\tif (helpers.isDate(config)) {\n\t\t\t\tconfig = {\n\t\t\t\t\tdate: config\n\t\t\t\t};\n\t\t\t} else {\n\t\t\t\tconfig = utils.mixin({}, config);\n\t\t\t}\n\n\t\t\tif(!helpers.isValidDate(config.date)){\n\t\t\t\tgantt.assert(false, \"Invalid date argument for getWorkHours method\");\n\t\t\t\tthrow new Error(\"Invalid date argument for getWorkHours method\");\n\t\t\t}\n\n\t\t\treturn config;\n\t\t},\n\t\tsetWorkTimeArguments: function () {\n\t\t\treturn arguments[0];\n\t\t},\n\t\tunsetWorkTimeArguments: function () {\n\t\t\treturn arguments[0];\n\t\t},\n\t\tisWorkTimeArguments: function () {\n\t\t\tvar config = arguments[0];\n\t\t\tif(config instanceof IsWorkTimeArgument){\n\t\t\t\treturn config;\n\t\t\t}\n\n\t\t\tvar processedConfig;\n\t\t\tif (!config.date) {\n\t\t\t\t//IsWorkTimeArgument(date, unit, task, id, calendar)\n\t\t\t\tprocessedConfig = new IsWorkTimeArgument(arguments[0], arguments[1], arguments[2], null, arguments[3]);\n\t\t\t} else {\n\t\t\t\tprocessedConfig = new IsWorkTimeArgument(config.date, config.unit, config.task, null, config.calendar);\n\t\t\t}\n\n\t\t\tprocessedConfig.unit = processedConfig.unit || gantt.config.duration_unit;\n\n\t\t\tif(!helpers.isValidDate(processedConfig.date)){\n\t\t\t\tgantt.assert(false, \"Invalid date argument for isWorkTime method\");\n\t\t\t\tthrow new Error(\"Invalid date argument for isWorkTime method\");\n\t\t\t}\n\n\t\t\treturn processedConfig;\n\t\t},\n\t\tgetClosestWorkTimeArguments: function (arg) {\n\t\t\tvar config = arguments[0];\n\t\t\tif (config instanceof ClosestWorkTimeArgument)\n\t\t\t\treturn config;\n\n\t\t\tvar processedConfig;\n\t\t\tif (helpers.isDate(config)) {\n\t\t\t\tprocessedConfig = new ClosestWorkTimeArgument(config);\n\n\t\t\t} else {\n\t\t\t\tprocessedConfig = new ClosestWorkTimeArgument(\n\t\t\t\t\tconfig.date,\n\t\t\t\t\tconfig.dir,\n\t\t\t\t\tconfig.unit,\n\t\t\t\t\tconfig.task,\n\t\t\t\t\tnull,//config.id,\n\t\t\t\t\tconfig.calendar\n\t\t\t\t);\n\t\t\t}\n\n\t\t\tif(config.id){\n\t\t\t\tprocessedConfig.task = config;\n\t\t\t}\n\t\t\tprocessedConfig.dir = config.dir || 'any';\n\t\t\tprocessedConfig.unit = config.unit || gantt.config.duration_unit;\n\n\t\t\tif(!helpers.isValidDate(processedConfig.date)){\n\t\t\t\tgantt.assert(false, \"Invalid date argument for getClosestWorkTime method\");\n\t\t\t\tthrow new Error(\"Invalid date argument for getClosestWorkTime method\");\n\t\t\t}\n\t\t\treturn processedConfig;\n\t\t},\n\n\t\t_getStartEndConfig: function (param) {\n\t\t\tvar argumentType = GetDurationArgument;\n\t\t\tvar config;\n\t\t\tif (param instanceof argumentType)\n\t\t\t\treturn param;\n\n\t\t\tif (helpers.isDate(param)) {\n\t\t\t\tconfig = new argumentType(arguments[0], arguments[1], arguments[2], arguments[3]);\n\t\t\t} else {\n\t\t\t\tconfig = new argumentType(param.start_date, param.end_date, param.task);\n\t\t\t\tif (param.id !== null && param.id !== undefined) {\n\t\t\t\t\tconfig.task = param;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tconfig.unit = config.unit || gantt.config.duration_unit;\n\t\t\tconfig.step = config.step || gantt.config.duration_step;\n\t\t\tconfig.start_date = config.start_date || config.start || config.date;\n\n\t\t\tif(!helpers.isValidDate(config.start_date)){\n\t\t\t\tgantt.assert(false, \"Invalid start_date argument for getDuration method\");\n\t\t\t\tthrow new Error(\"Invalid start_date argument for getDuration method\");\n\t\t\t}\n\n\t\t\tif(!helpers.isValidDate(config.end_date)){\n\t\t\t\tgantt.assert(false, \"Invalid end_date argument for getDuration method\");\n\t\t\t\tthrow new Error(\"Invalid end_date argument for getDuration method\");\n\t\t\t}\n\n\t\t\treturn config;\n\t\t},\n\n\t\tgetDurationArguments: function (start, end, unit, step) {\n\t\t\treturn this._getStartEndConfig.apply(this, arguments);\n\t\t},\n\n\t\thasDurationArguments: function (start, end, unit, step) {\n\t\t\treturn this._getStartEndConfig.apply(this, arguments);\n\t\t},\n\n\t\tcalculateEndDateArguments: function (start, duration, unit, step) {\n\t\t\tvar config = arguments[0];\n\t\t\tif (config instanceof CalculateEndDateArgument)\n\t\t\t\treturn config;\n\n\t\t\tvar processedConfig;\n\t\t\t//CalculateEndDateArgument(start_date, duration, unit, step, task, id, calendar)\n\t\t\tif (helpers.isDate(config)) {\n\t\t\t\tprocessedConfig = new CalculateEndDateArgument(\n\t\t\t\t\targuments[0],\n\t\t\t\t\targuments[1],\n\t\t\t\t\targuments[2],\n\t\t\t\t\tundefined,\n\t\t\t\t\targuments[3],\n\t\t\t\t\tundefined,\n\t\t\t\t\targuments[4]\n\t\t\t\t);\n\n\t\t\t} else {\n\t\t\t\tprocessedConfig = new CalculateEndDateArgument(\n\t\t\t\t\tconfig.start_date,\n\t\t\t\t\tconfig.duration,\n\t\t\t\t\tconfig.unit,\n\t\t\t\t\tconfig.step,\n\t\t\t\t\tconfig.task,\n\t\t\t\t\tnull,//config.id,\n\t\t\t\t\tconfig.calendar\n\t\t\t\t);\n\t\t\t}\n\t\t\tif(config.id !== null && config.id !== undefined){\n\t\t\t\tprocessedConfig.task = config;\n\n\t\t\t\t// received a task object as an argument\n\t\t\t\t// ignore 'unit' and 'step' properties in this case, since it's likely a part of data model of a task\n\t\t\t\tprocessedConfig.unit = null;\n\t\t\t\tprocessedConfig.step = null;\n\t\t\t}\n\n\t\t\tprocessedConfig.unit = processedConfig.unit || gantt.config.duration_unit;\n\t\t\tprocessedConfig.step = processedConfig.step || gantt.config.duration_step;\n\n\t\t\tif(!helpers.isValidDate(processedConfig.start_date)){\n\t\t\t\tgantt.assert(false, \"Invalid start_date argument for calculateEndDate method\");\n\t\t\t\tthrow new Error(\"Invalid start_date argument for calculateEndDate method\");\n\t\t\t}\n\n\t\t\treturn processedConfig;\n\t\t}\n\t};\n};\n\n\nexport default calendarArgumentsHelper;","import * as utils from \"../../../utils/utils\";\nfunction WorkTimeCalendarMerger(){\n}\n\nWorkTimeCalendarMerger.prototype = {\n\n\n\t/**\n\t * convert hours array items into objects, e.g. [8, 12, 17, 18] -> [{start: 8, end: 12}, {start:17, end:18}]\n\t * @param {Array} hoursArray\n\t */\n\t_getIntervals: function(hoursArray){\n\t\tvar result = [];\n\t\tfor(var i = 0; i < hoursArray.length; i += 2){\n\n\t\t\tresult.push({\n\t\t\t\tstart: hoursArray[i],\n\t\t\t\tend: hoursArray[i+1]\n\t\t\t});\n\t\t}\n\t\treturn result;\n\t},\n\n\t/**\n\t * Convert ranges config into hours array\n\t * [{start: 8, end: 12}, {start:17, end:18}] --> [8, 12, 17, 18]\n\t * @param {*} intervalsArray\n\t */\n\t_toHoursArray: function(intervalsArray){\n\t\tvar result = [];\n\n\t\tfunction toFixed(value){\n\t\t\tvar str = String(value);\n\t\t\tif(str.length < 2){\n\t\t\t\tstr = \"0\" + str;\n\t\t\t}\n\t\t\treturn str;\n\t\t}\n\t\tfunction formatHHMM(secondsValue){\n\t\t\tvar hours = Math.floor(secondsValue / (60*60));\n\t\t\tvar minutePart = secondsValue - hours * 60 * 60;\n\n\t\t\tvar minutes = Math.floor(minutePart / (60));\n\t\t\treturn hours + \":\" + toFixed(minutes);\n\t\t}\n\t\tfor(var i = 0; i < intervalsArray.length; i++){\n\t\t\tresult.push(\n\t\t\t\tformatHHMM(intervalsArray[i].start) +\n\t\t\t\t\"-\" +\n\t\t\t\tformatHHMM(intervalsArray[i].end)\n\t\t\t);\n\t\t}\n\t\treturn result;\n\t},\n\n\t/**\n\t * Build intersection of hour intervals. e.g.\n\t * first: [{start: 8, end: 12}, {start:13, end:18}]\n\t * second: [{start: 10, end: 15}]\n\t * result: [{start: 10, end: 12}, {start: 13, end: 15}]\n\t * @param {Array} first\n\t * @param {Array} second\n\t */\n\t_intersectHourRanges: function(first, second){\n\t\tvar result = [];\n\n\t\tvar baseArray = first.length > second.length ? first : second;\n\t\tvar overridesArray = first === baseArray ? second: first;\n\t\tbaseArray = baseArray.slice();\n\t\toverridesArray = overridesArray.slice();\n\n\t\tvar result = [];\n\t\tfor(var i = 0; i < baseArray.length; i++){\n\t\t\tvar base = baseArray[i];\n\n\t\t\tfor(var j = 0; j < overridesArray.length; j++){\n\t\t\t\tvar current = overridesArray[j];\n\t\t\t\tif(current.start < base.end && current.end > base.start){\n\t\t\t\t\tresult.push({\n\t\t\t\t\t\tstart: Math.max(base.start, current.start),\n\t\t\t\t\t\tend: Math.min(base.end, current.end)\n\t\t\t\t\t});\n\t\t\t\t\tif(base.end > current.end){\n\t\t\t\t\t\toverridesArray.splice(j, 1);\n\t\t\t\t\t\tj--;\n\t\t\t\t\t\ti--;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\treturn result;\n\t},\n\n\t/**\n\t * Reduce the number of ranges in config when possible,\n\t * joins ranges that can be merged\n\t * parts: [{start: 8, end: 12}, {start:12, end:13}, {start: 15, end: 17}]\n\t * result: [{start: 8, end: 13}, {start: 15, end: 17}]\n\t * @param {Array} parts\n\t */\n\t_mergeAdjacentIntervals: function(parts){\n\t\tvar result = parts.slice();\n\t\tresult.sort(function(a, b){\n\t\t\treturn a.start - b.start;\n\t\t});\n\t\tvar base = result[0];\n\t\tfor(var i = 1; i < result.length; i++){\n\t\t\tvar current = result[i];\n\t\t\tif(current.start <= base.end){\n\t\t\t\tif(current.end > base.end){\n\t\t\t\t\tbase.end = current.end;\n\t\t\t\t}\n\t\t\t\tresult.splice(i, 1);\n\t\t\t\ti--;\n\t\t\t}else{\n\t\t\t\tbase = current;\n\t\t\t}\n\t\t}\n\t\treturn result;\n\t},\n\n\t_mergeHoursConfig: function(firstHours, secondHours){\n\t\t//var firstIntervals = this._getIntervals(firstHours);\n\t\t//var secondIntervals = this._getIntervals(secondHours);\n\n\t\treturn this._mergeAdjacentIntervals(\n\t\t\tthis._intersectHourRanges(firstHours, secondHours)\n\t\t);\n\t},\n\n\tmerge: function(first, second){\n\t\tvar firstConfig = utils.copy(first.getConfig().parsed);\n\n\t\tvar secondConfig = utils.copy(second.getConfig().parsed);\n\n\t\tvar mergedSettings = {\n\t\t\thours: this._toHoursArray(this._mergeHoursConfig(firstConfig.hours, secondConfig.hours)),\n\t\t\tdates: {},\n\t\t\tcustomWeeks: {}\n\t\t};\n\n\t\tconst processCalendar = (config1, config2) => {\n\t\t\tfor (let i in config1.dates) {\n\t\t\t\tconst date1 = config1.dates[i];\n\t\n\t\t\t\t// dates contain day-of-week rules [0-7] and rules for specific dates (js date timestamps) - set false date rules initially\n\t\t\t\tif (+i > 1000) {\n\t\t\t\t\tmergedSettings.dates[i] = false;\n\t\t\t\t}\n\t\t\t\t// Check if the key exists in the fisrt calendar object\n\t\t\t\tfor (const key in config2.dates) {\n\t\t\t\t\tconst date2 = config2.dates[key];\n\t\n\t\t\t\t\t// Logical AND for week days\n\t\t\t\t\tif (key == i) {\n\t\t\t\t\t\tmergedSettings.dates[i] = !!(date1 && date2);\n\t\t\t\t\t}\n\t\n\t\t\t\t\t// Handle case where dates are arrays\n\t\t\t\t\tif (Array.isArray(date1)) {\n\t\t\t\t\t\tconst hours2 = Array.isArray(date2) ? date2 : config2.hours;\n\t\t\t\t\t\tmergedSettings.dates[i] = this._toHoursArray(this._mergeHoursConfig(date1, hours2));\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\t\n\t\t// Check both calendars\n\t\tprocessCalendar(firstConfig, secondConfig);\n\t\tprocessCalendar(secondConfig, firstConfig);\n\n\t\t// transfer and overwrite custom week calendars\n\t\tif(firstConfig.customWeeks){\n\t\t\tfor(var i in firstConfig.customWeeks){\n\t\t\t\tmergedSettings.customWeeks[i] = firstConfig.customWeeks[i];\n\t\t\t}\n\t\t}\n\t\tif(secondConfig.customWeeks){\n\t\t\tfor(var i in secondConfig.customWeeks){\n\t\t\t\tmergedSettings.customWeeks[i] = secondConfig.customWeeks[i];\n\t\t\t}\n\t\t}\n\n\t\treturn mergedSettings;\n\n\t}\n\n};\n\nexport default WorkTimeCalendarMerger;","\n\nimport { IWorkUnitCache } from \"./workunit_cache_interface\";\n\nexport class WorkUnitsMapCache implements IWorkUnitCache {\n\tprivate _cache: Map<string, Array<Map<string, boolean>>>;\n\tconstructor() {\n\t\tthis.clear();\n\t}\n\n\tgetItem(unit: string, timestamp: string, value: Date): number|boolean {\n\t\tif (this._cache.has(unit)) {\n\t\t\tconst unitCache = this._cache.get(unit);\n\n\t\t\tconst subCache = unitCache[value.getFullYear()];\n\t\t\tif (subCache && subCache.has(timestamp)) {\n\t\t\t\treturn subCache.get(timestamp);\n\t\t\t}\n\t\t}\n\n\t\treturn -1;\n\t}\n\tsetItem(unit: string, timestamp: string, value: boolean, rawValue: Date): void {\n\t\tif (!unit || !timestamp) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst cache = this._cache;\n\t\tconst year = rawValue.getFullYear();\n\n\t\tlet unitCache;\n\t\tif (!cache.has(unit)) {\n\t\t\tunitCache = [];\n\t\t\tcache.set(unit, unitCache);\n\t\t} else {\n\t\t\tunitCache = cache.get(unit);\n\t\t}\n\n\t\tlet yearCache = unitCache[year];\n\t\tif(!yearCache){\n\t\t\tyearCache = unitCache[year] = new Map<string, boolean>();\n\t\t}\n\n\n\t\tyearCache.set(timestamp, value);\n\t}\n\tclear(): void{\n\t\tthis._cache = new Map<string, Array<Map<string, boolean>>>();\n\t}\n}","import { IWorkUnitCache } from \"./workunit_cache_interface\";\n\nexport class WorkUnitsObjectCache implements IWorkUnitCache {\n\tprivate _cache: any;\n\tconstructor() {\n\t\tthis.clear();\n\t}\n\n\tgetItem(unit: string, timestamp: string, value: Date): number|boolean {\n\t\tconst cache = this._cache;\n\t\tif (cache && cache[unit]) {\n\t\t\tconst units = cache[unit];\n\t\t\tif(units === undefined){\n\t\t\t\treturn -1;\n\t\t\t}\n\t\t\tconst subCache = units[value.getFullYear()];\n\t\t\tif (subCache && subCache[timestamp] !== undefined) {\n\t\t\t\treturn subCache[timestamp];\n\t\t\t}\n\t\t}\n\n\t\treturn -1;\n\t}\n\tsetItem(unit: string, timestamp: string, value: boolean, rawValue: Date): void {\n\t\tif (!unit || !timestamp) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst cache = this._cache;\n\n\t\tif (!cache) {\n\t\t\treturn;\n\t\t}\n\t\tif (!cache[unit]) {\n\t\t\tcache[unit] = [];\n\t\t}\n\t\tconst unitCache = cache[unit];\n\n\t\tconst year = rawValue.getFullYear();\n\t\tlet yearCache = unitCache[year];\n\t\tif(!yearCache){\n\t\t\tyearCache = unitCache[year] = {};\n\t\t}\n\t\tyearCache[timestamp] = value;\n\t}\n\tclear(): void{\n\t\tthis._cache = {};\n\t}\n}","\n\nexport class LargerUnitsCache {\n\tprivate _weekCache: Map<number, number>;\n\tprivate _monthCache: Map<number, number>;\n\tprivate _calendar: any;\n\tconstructor(calendar) {\n\t\tthis.clear();\n\t\tthis._calendar = calendar;\n\t}\n\n\tgetMinutesPerWeek = (weekStart: Date) => {\n\t\tconst key = weekStart.valueOf();\n\n\t\tif(this._weekCache.has(key)){\n\t\t\treturn this._weekCache.get(key);\n\t\t}\n\n\t\tconst calendar = this._calendar;\n\t\tconst gantt = this._calendar.$gantt;\n\n\t\tlet minutesPerWeek = 0;\n\t\tlet start = gantt.date.week_start(new Date(weekStart));\n\t\tfor(let i = 0; i < 7; i++){\n\t\t\tminutesPerWeek += calendar.getHoursPerDay(start) * 60;\n\t\t\tstart = gantt.date.add(start, 1, \"day\");\n\t\t}\n\n\t\tthis._weekCache.set(key, minutesPerWeek);\n\t\treturn minutesPerWeek;\n\t};\n\n\tgetMinutesPerMonth = (monthStart: Date) => {\n\t\tconst key = monthStart.valueOf();\n\n\t\tif(this._monthCache.has(key)){\n\t\t\treturn this._monthCache.get(key);\n\t\t}\n\n\t\tconst calendar = this._calendar;\n\t\tconst gantt = this._calendar.$gantt;\n\n\t\tlet minutesPerMonth = 0;\n\t\tlet start = gantt.date.week_start(new Date(monthStart));\n\t\tconst nextMonth = gantt.date.add(start, 1, \"month\").valueOf();\n\t\twhile(start.valueOf() < nextMonth){\n\t\t\tminutesPerMonth += calendar.getHoursPerDay(start) * 60;\n\t\t\tstart = gantt.date.add(start, 1, \"day\");\n\t\t}\n\n\t\tthis._monthCache.set(key, minutesPerMonth);\n\t\treturn minutesPerMonth;\n\t};\n\n\tclear = (): void => {\n\t\tthis._weekCache = new Map<number, number>();\n\t\tthis._monthCache = new Map<number, number>();\n\t};\n}","export class DateDurationCache  {\n\tprivate _cache: any;\n\tconstructor() {\n\t\tthis.clear();\n\t}\n\n\t_getCacheObject(startDate: Date, unit: string, step:number){\n\t\tconst cache = this._cache;\n\t\tif (!cache[unit]) {\n\t\t\tcache[unit] = [];\n\t\t}\n\t\tlet unitCache = cache[unit];\n\t\tif(!unitCache) {\n\t\t\tunitCache = cache[unit] = {};\n\t\t}\n\n\t\tlet stepCache = unitCache[step];\n\t\tif(!stepCache) {\n\t\t\tstepCache = unitCache[step] = {};\n\t\t}\n\n\t\tconst year = startDate.getFullYear();\n\t\tlet yearCache = stepCache[year];\n\t\tif(!yearCache){\n\t\t\tyearCache = stepCache[year] = {durations: {}, endDates: {}};\n\t\t}\n\n\t\treturn yearCache;\n\t}\n\t_endDateCacheKey(startDate: number, duration: number){\n\t\treturn String(startDate) + \"-\" + String(duration);\n\t}\n\t_durationCacheKey(startDate: number, endDate: number){\n\t\treturn String(startDate) + \"-\" + String(endDate);\n\t}\n\tgetEndDate(startDate: Date, duration: number, unit: string, step: number, compute: () => Date): number|null{\n\t\tconst cache = this._getCacheObject(startDate, unit, step);\n\n\t\tconst startDateTimestamp = startDate.valueOf();\n\t\tconst key = this._endDateCacheKey(startDateTimestamp, duration);\n\t\tlet endDate;\n\t\tif(cache.endDates[key] === undefined){\n\t\t\tconst result = compute();\n\t\t\tconst resultTimestamp = result.valueOf();\n\t\t\tcache.endDates[key] = resultTimestamp;\n\t\t\tcache.durations[this._durationCacheKey(startDateTimestamp, resultTimestamp)] = duration;\n\t\t\tendDate = result;\n\t\t}else{\n\t\t\tendDate = new Date(cache.endDates[key]);\n\t\t}\n\n\t\treturn endDate;\n\t}\n\n\tgetDuration(startDate: Date, endDate: Date, unit: string, step: number, compute: () => number): number|null{\n\t\tconst cache = this._getCacheObject(startDate, unit, step);\n\n\t\tconst startDateTimestamp = startDate.valueOf();\n\t\tconst endDateTimestamp = endDate.valueOf();\n\t\tconst key = this._durationCacheKey(startDateTimestamp, endDateTimestamp);\n\t\tlet duration;\n\t\tif(cache.durations[key] === undefined){\n\t\t\tconst result = compute();\n\t\t\tcache.durations[key] = result.valueOf();\n\n\t\t\t// can't populate end date due to logic of end date calculation, current unit tests capture it\n\t\t\t// cache.endDates[this._endDateCacheKey(startDateTimestamp, result)] = endDateTimestamp;\n\t\t\tduration = result;\n\t\t}else{\n\t\t\tduration = cache.durations[key];\n\t\t}\n\n\t\treturn duration;\n\t}\n\n\tclear(): void{\n\t\tthis._cache = {};\n\t}\n}","import {createCacheObject} from \"./work_unit_cache\";\nimport {LargerUnitsCache} from \"./work_unit_cache\";\nimport * as utils from \"../../../utils/utils\";\nimport {DateDurationCache} from \"./work_unit_cache/date_duration_cache\";\n\nfunction CalendarWorkTimeStrategy(gantt, argumentsHelper) {\n\tthis.argumentsHelper = argumentsHelper;\n\tthis.$gantt = gantt;\n\tthis._workingUnitsCache = createCacheObject();\n\tthis._largeUnitsCache = new LargerUnitsCache(this);\n\tthis._dateDurationCache = new DateDurationCache();\n\tthis._worktime = null;\n\tthis._cached_timestamps = {};\n\tthis._cached_timestamps_count = 0;\n}\n\nCalendarWorkTimeStrategy.prototype = {\n\tunits: [\n\t\t\"year\",\n\t\t\"month\",\n\t\t\"week\",\n\t\t\"day\",\n\t\t\"hour\",\n\t\t\"minute\"\n\t],\n\t_clearCaches: function(){\n\t\tthis._workingUnitsCache.clear();\n\t\tthis._largeUnitsCache.clear();\n\t\tthis._dateDurationCache.clear();\n\t},\n\t// cache previously calculated worktime\n\t_getUnitOrder: function (unit) {\n\t\tfor (var i = 0, len = this.units.length; i < len; i++) {\n\t\t\tif (this.units[i] == unit)\n\t\t\t\treturn i;\n\t\t}\n\t},\n\t_resetTimestampCache: function(){\n\t\tthis._cached_timestamps = {};\n\t\tthis._cached_timestamps_count = 0;\n\t},\n\t_timestamp: function (settings) {\n\t\t// minor optimization, store calculated timestamps to reduce computations\n\t\t// reset cache when number of keys exceeds large number where key lookup may became more expensive than the recalculation\n\t\tif(this._cached_timestamps_count > 1000000){\n\t\t\tthis._resetTimestampCache();\n\t\t}\n\n\t\tvar timestamp = null;\n\t\tif ((settings.day || settings.day === 0)) {\n\t\t\ttimestamp = settings.day;\n\t\t} else if (settings.date) {\n\t\t\tvar value = String(settings.date.valueOf());\n\t\t\tif(this._cached_timestamps[value]){\n\t\t\t\ttimestamp = this._cached_timestamps[value];\n\t\t\t}else{\n\t\t\t\t// store worktime datestamp in utc so it could be recognized in different timezones (e.g. opened locally and sent to the export service in different timezone)\n\t\t\t\ttimestamp = Date.UTC(settings.date.getFullYear(), settings.date.getMonth(), settings.date.getDate());\n\t\t\t\tthis._cached_timestamps[value] = timestamp;\n\t\t\t\tthis._cached_timestamps_count++;\n\t\t\t}\n\n\t\t}\n\t\treturn timestamp;\n\t},\n\t_checkIfWorkingUnit: function (date, unit) {\n\t\t// GS-596: If unit is larger than day or has a custom logic\n\t\tif (!this[\"_is_work_\" + unit]) {\n\t\t\tconst from = this.$gantt.date[`${unit}_start`](new Date(date));\n\t\t\tconst to = this.$gantt.date.add(from, 1, unit);\n\t\t\treturn this.hasDuration(from, to);\n\t\t}\n\t\treturn this[\"_is_work_\" + unit](date);\n\t},\n\t//checkings for particular time units\n\t//methods for month-year-week can be defined, otherwise always return 'true'\n\t_is_work_day: function (date) {\n\t\tvar val = this._getWorkHours(date);\n\n\t\tif (Array.isArray(val)) {\n\t\t\treturn val.length > 0;\n\t\t}\n\t\treturn false;\n\t},\n\t_is_work_hour: function (date) {\n\t\tvar hours = this._getWorkHours(date); // [{start: 8*60*60, end: 12*60*60}, {start: 13*60*60, end: 17*60*60}]\n\t\tvar value = date.getHours();\n\t\tfor (var i = 0; i < hours.length; i++) {\n\t\t\tif(value >= hours[i].startHour && value < hours[i].endHour){\n\t\t\t\treturn true;\n\t\t\t}\n\t\t}\n\t\treturn false;\n\t},\n\n\t_getTimeOfDayStamp: function(date, dayEnd) {\n\t\tvar hours = date.getHours();\n\t\tif(!date.getHours() && !date.getMinutes() && dayEnd){\n\t\t\thours = 24;\n\t\t}\n\t\treturn hours * 60 * 60 + date.getMinutes() * 60;\n\t},\n\n\t_is_work_minute: function(date){\n\t\tvar hours = this._getWorkHours(date); // [{start: 8*60*60, end: 12*60*60}, {start: 13*60*60, end: 17*60*60}]\n\t\tvar checkTime = this._getTimeOfDayStamp(date);\n\t\tfor (var i = 0; i < hours.length; i++) {\n\t\t\tif(checkTime >= hours[i].start && checkTime < hours[i].end){\n\t\t\t\treturn true;\n\t\t\t}\n\t\t}\n\t\treturn false;\n\t},\n\n\t_nextDate: function (start, unit, step) {\n\t\treturn this.$gantt.date.add(start, step, unit);\n\t},\n\t_getWorkUnitsBetweenGeneric: function (from, to, unit, step) {\n\t\tvar dateHelper = this.$gantt.date;\n\t\tvar start = new Date(from),\n\t\t\tend = new Date(to);\n\t\tstep = step || 1;\n\t\tvar units = 0;\n\n\n\t\tvar next = null;\n\t\tvar stepStart,\n\t\t\tstepEnd;\n\n\t\t// calculating decimal durations, i.e. 2016-09-20 00:05:00 - 2016-09-20 01:00:00 ~ 0.95 instead of 1\n\t\t// and also  2016-09-20 00:00:00 - 2016-09-20 00:05:00 ~ 0.05 instead of 1\n\t\t// durations must be rounded later\n\t\tvar checkFirst = false;\n\t\tstepStart = dateHelper[unit + \"_start\"](new Date(start));\n\t\tif (stepStart.valueOf() != start.valueOf()) {\n\t\t\tcheckFirst = true;\n\t\t}\n\t\tvar checkLast = false;\n\t\tstepEnd = dateHelper[unit + \"_start\"](new Date(to));\n\t\tif (stepEnd.valueOf() != to.valueOf()) {\n\t\t\tcheckLast = true;\n\t\t}\n\n\t\tvar isLastStep = false;\n\t\twhile (start.valueOf() < end.valueOf()) {\n\t\t\tnext = this._nextDate(start, unit, step);\n\t\t\tisLastStep = (next.valueOf() > end.valueOf());\n\n\t\t\tif (this._isWorkTime(start, unit)) {\n\t\t\t\tif (checkFirst || (checkLast && isLastStep)) {\n\t\t\t\t\tstepStart = dateHelper[unit + \"_start\"](new Date(start));\n\t\t\t\t\tstepEnd = dateHelper.add(stepStart, step, unit);\n\t\t\t\t}\n\n\t\t\t\tif (checkFirst) {\n\t\t\t\t\tcheckFirst = false;\n\t\t\t\t\tnext = this._nextDate(stepStart, unit, step);\n\t\t\t\t\tunits += ((stepEnd.valueOf() - start.valueOf()) / (stepEnd.valueOf() - stepStart.valueOf()));\n\t\t\t\t} else if (checkLast && isLastStep) {\n\t\t\t\t\tcheckLast = false;\n\t\t\t\t\tunits += ((end.valueOf() - start.valueOf()) / (stepEnd.valueOf() - stepStart.valueOf()));\n\n\t\t\t\t} else {\n\t\t\t\t\tunits++;\n\t\t\t\t}\n\t\t\t}else{\n\t\t\t\tvar unitOrder = this._getUnitOrder(unit);\n\t\t\t\tvar biggerTimeUnit = this.units[unitOrder - 1];\n\t\t\t\tif(biggerTimeUnit && !this._isWorkTime(start, biggerTimeUnit)){\n\t\t\t\t\tnext = this._getClosestWorkTimeFuture(start, biggerTimeUnit);\n\t\t\t\t}\n\t\t\t}\n\t\t\tstart = next;\n\t\t}\n\t\treturn units;\n\t},\n\n\t_getMinutesPerHour: function (date) {\n\t\tvar hourStart = this._getTimeOfDayStamp(date);\n\t\tvar hourEnd = this._getTimeOfDayStamp(this._nextDate(date, \"hour\", 1));\n\t\tif (hourEnd === 0){\n\t\t\thourEnd = 24 * 60 * 60;\n\t\t}\n\t\tvar worktimes = this._getWorkHours(date);\n\n\t\tfor(var i = 0; i < worktimes.length; i++){\n\t\t\tvar interval = worktimes[i];\n\t\t\tif(hourStart >= interval.start && hourEnd <= interval.end){\n\t\t\t\treturn 60;// hour inside a working interval, all hour is a work hour\n\t\t\t}else if(hourStart < interval.end && hourEnd > interval.start){\n\t\t\t\t// hour is partially work time\n\t\t\t\tvar duration = Math.min(hourEnd, interval.end) - Math.max(hourStart, interval.start);\n\t\t\t\treturn duration / 60;\n\t\t\t}\n\t\t}\n\n\t\treturn 0;\n\t},\n\n\t_getMinutesPerDay: function (date) {\n\t\tvar hours = this._getWorkHours(date);\n\t\tvar res = 0;\n\t\thours.forEach(function(interval){\n\t\t\tres+= interval.durationMinutes;\n\t\t});\n\t\treturn res;\n\t},\n\tgetHoursPerDay: function (date) {\n\t\tvar hours = this._getWorkHours(date);\n\t\tvar res = 0;\n\t\thours.forEach(function(interval){\n\t\t\tres+= interval.durationHours;\n\t\t});\n\t\treturn res;\n\t},\n\t_getWorkUnitsForRange: function (from, to, unit, step) {\n\t\tvar total = 0;\n\t\tvar start = new Date(from),\n\t\t\tend = new Date(to);\n\n\t\tvar getUnitsPerDay;\n\t\tif (unit == \"minute\") {\n\t\t\tgetUnitsPerDay = utils.bind(this._getMinutesPerDay, this);\n\t\t} else {\n\t\t\tgetUnitsPerDay = utils.bind(this.getHoursPerDay, this);\n\t\t}\n\n\t\twhile (start.valueOf() < end.valueOf()) {\n\t\t\tif(end - start > 1000*60*60*24*32 && start.getDate() === 0) {\n\t\t\t\tvar units = this._largeUnitsCache.getMinutesPerMonth(start);\n\t\t\t\tif(unit == \"hour\"){\n\t\t\t\t\tunits = units / 60;\n\t\t\t\t}\n\t\t\t\ttotal += units;\n\t\t\t\tstart = this.$gantt.date.add(start, 1, \"month\");\n\t\t\t\tcontinue;\n\t\t\t}else if(end - start > 1000*60*60*24*16) {\n\t\t\t\tvar weekStart = this.$gantt.date.week_start(new Date(start));\n\t\t\t\tif(start.valueOf() === weekStart.valueOf()){\n\t\t\t\t\tvar units = this._largeUnitsCache.getMinutesPerWeek(start);\n\t\t\t\t\tif(unit == \"hour\"){\n\t\t\t\t\t\tunits = units / 60;\n\t\t\t\t\t}\n\t\t\t\t\ttotal += units;\n\t\t\t\t\tstart = this.$gantt.date.add(start, 7, \"day\");\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\t\t\t}\n\n\t\t//\tif (this._isWorkTime(start, \"day\")) {\n\t\t\ttotal += getUnitsPerDay(start);\n\t\t//\t}\n\t\t\tstart = this._nextDate(start, \"day\", 1);\n\t\t}\n\n\t\treturn total / step;\n\t},\n\n\n\t_getMinutesBetweenSingleDay: function(from, to){\n\t\tvar range = this._getIntervalTimestamp(from, to);\n\t\tvar worktimes = this._getWorkHours(from);\n\t\tvar result = 0;\n\n\t\tfor(var i = 0; i < worktimes.length; i++){\n\t\t\tvar interval = worktimes[i];\n\t\t\tif(range.end >= interval.start && range.start <= interval.end){\n\t\t\t\tvar minuteFrom = Math.max(interval.start, range.start);\n\t\t\t\tvar minuteTo = Math.min(interval.end, range.end);\n\n\t\t\t\tresult += (minuteTo - minuteFrom) / 60;\n\t\t\t\trange.start = minuteTo;\n\t\t\t}\n\t\t}\n\n\t\treturn Math.floor(result);\n\t},\n\n\t_getMinutesBetween: function(from, to, unit, step){\n\t\tvar start = new Date(from),\n\t\t\tend = new Date(to);\n\t\tstep = step || 1;\n\n\t\tvar firstDayStart = new Date(start);\n\t\tvar firstDayEnd = this.$gantt.date.add(this.$gantt.date.day_start(new Date(start)), 1, \"day\");\n\n\t\tif (end.valueOf() <= firstDayEnd.valueOf()) {\n\t\t\treturn this._getMinutesBetweenSingleDay(from, to);\n\t\t} else {\n\n\t\t\tvar lastDayStart = this.$gantt.date.day_start(new Date(end));\n\t\t\tvar lastDayEnd = end;\n\n\t\t\tvar startPart = this._getMinutesBetweenSingleDay(firstDayStart, firstDayEnd);\n\t\t\tvar endPart = this._getMinutesBetweenSingleDay(lastDayStart, lastDayEnd);\n\n\t\t\tvar rangePart = this._getWorkUnitsForRange(firstDayEnd, lastDayStart, unit, step);\n\t\t\tvar total = startPart + rangePart + endPart;\n\n\t\t\treturn total;\n\t\t}\n\t},\n\t// optimized method for calculating work units duration of large time spans\n\t// implemented for hours and minutes units, bigger time units don't benefit from the optimization so much\n\t_getHoursBetween: function (from, to, unit, step) {\n\t\tvar start = new Date(from),\n\t\t\tend = new Date(to);\n\t\tstep = step || 1;\n\n\t\tvar firstDayStart = new Date(start);\n\t\tvar firstDayEnd = this.$gantt.date.add(this.$gantt.date.day_start(new Date(start)), 1, \"day\");\n\n\t\tif (end.valueOf() <= firstDayEnd.valueOf()) {\n\t\t\treturn Math.round(this._getMinutesBetweenSingleDay(from, to) / 60);\n\t\t} else {\n\n\t\t\tvar lastDayStart = this.$gantt.date.day_start(new Date(end));\n\t\t\tvar lastDayEnd = end;\n\n\t\t\tvar startPart = this._getMinutesBetweenSingleDay(firstDayStart, firstDayEnd, unit, step) / 60;\n\t\t\tvar endPart = this._getMinutesBetweenSingleDay(lastDayStart, lastDayEnd, unit, step) / 60;\n\n\t\t\tvar rangePart = this._getWorkUnitsForRange(firstDayEnd, lastDayStart, unit, step);\n\t\t\tvar total = startPart + rangePart + endPart;\n\n\t\t\treturn Math.round(total);\n\t\t}\n\t},\n\n\tgetConfig: function () {\n\t\treturn this._worktime;\n\t},\n\t_setConfig: function (settings) {\n\t\tthis._worktime = settings;\n\t\tthis._parseSettings();\n\t\tthis._clearCaches();\n\t},\n\t_parseSettings: function() {\n\t\tvar settings = this.getConfig();\n\t\tsettings.parsed = {\n\t\t\tdates: {},\n\t\t\thours: null,\n\t\t\thaveCustomWeeks: false,\n\t\t\tcustomWeeks: {},\n\t\t\tcustomWeeksRangeStart: null,\n\t\t\tcustomWeeksRangeEnd: null,\n\t\t\tcustomWeeksBoundaries: []\n\t\t};\n\n\t\tsettings.parsed.hours = this._parseHours(settings.hours);\n\t\tfor(var i in settings.dates){\n\t\t\tsettings.parsed.dates[i] = this._parseHours(settings.dates[i]);\n\t\t}\n\n\t\tif(settings.customWeeks) {\n\t\t\tvar minCustomRangeStart = null;\n\t\t\tvar maxCustomRangeEnd = null;\n\t\t\tfor(var i in settings.customWeeks){\n\t\t\t\tvar customTime = settings.customWeeks[i];\n\n\t\t\t\tif(customTime.from && customTime.to){\n\t\t\t\t\tvar rangeStart = customTime.from;\n\t\t\t\t\tvar rangeEnd = customTime.to;\n\t\t\t\t\tif(!minCustomRangeStart || minCustomRangeStart > rangeStart.valueOf()){\n\t\t\t\t\t\tminCustomRangeStart = rangeStart.valueOf();\n\t\t\t\t\t}\n\t\t\t\t\tif(!maxCustomRangeEnd || maxCustomRangeEnd < rangeEnd.valueOf()){\n\t\t\t\t\t\tmaxCustomRangeEnd = rangeEnd.valueOf();\n\t\t\t\t\t}\n\n\t\t\t\t\tsettings.parsed.customWeeksBoundaries.push({\n\t\t\t\t\t\tfrom: rangeStart.valueOf(),\n\t\t\t\t\t\tfromReadable: new Date(rangeStart),\n\t\t\t\t\t\tto: rangeEnd.valueOf(),\n\t\t\t\t\t\ttoReadable: new Date(rangeEnd),\n\t\t\t\t\t\tname: i\n\t\t\t\t\t});\n\n\t\t\t\t\tsettings.parsed.haveCustomWeeks = true;\n\t\t\t\t\tvar currentWeek = settings.parsed.customWeeks[i] = {\n\t\t\t\t\t\tfrom: customTime.from,\n\t\t\t\t\t\tto: customTime.to,\n\t\t\t\t\t\thours: this._parseHours(customTime.hours),\n\t\t\t\t\t\tdates: {}\n\t\t\t\t\t};\n\n\t\t\t\t\tfor(var d in customTime.dates){\n\t\t\t\t\t\tcurrentWeek.dates[d] = this._parseHours(customTime.dates[d]);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tsettings.parsed.customWeeksRangeStart = minCustomRangeStart;\n\t\t\tsettings.parsed.customWeeksRangeEnd = maxCustomRangeEnd;\n\n\t\t}\n\t},\n\n\t_tryChangeCalendarSettings: function (payload) {\n\t\tvar backup = JSON.stringify(this.getConfig());\n\t\tpayload();\n\t\tif (!this.hasWorkTime()) {\n\t\t//\tthis.$gantt.assert(false, \"Invalid calendar settings, no worktime available\");\n\t\t\tthis._setConfig(JSON.parse(backup));\n\t\t\tthis._clearCaches();\n\t\t\treturn false;\n\t\t}\n\t\treturn true;\n\n\t},\n\n\t_arraysEqual: function(a, b){\n\t\tif (a === b) return true;\n\t\tif (!a || !b) return false;\n\t\tif (a.length != b.length) return false;\n\n\t\tfor (var i = 0; i < a.length; ++i) {\n\t\t\tif (a[i] !== b[i]) return false;\n\t\t}\n\t\treturn true;\n\t},\n\n\n\t_compareSettings: function (mySettings, thatSettings) {\n\t\tif (!this._arraysEqual(mySettings.hours, thatSettings.hours)) {\n\t\t\treturn false;\n\t\t}\n\n\t\tvar myDays = Object.keys(mySettings.dates);\n\t\tvar otherDates = Object.keys(thatSettings.dates);\n\t\tmyDays.sort();\n\t\totherDates.sort();\n\n\t\tif (!this._arraysEqual(myDays, otherDates)) {\n\t\t\treturn false;\n\t\t}\n\n\t\tfor(var i = 0; i < myDays.length; i++){\n\t\t\tvar timestamp = myDays[i];\n\t\t\tvar myHours = mySettings.dates[timestamp];\n\t\t\tvar otherHours = mySettings.dates[timestamp];\n\n\t\t\t// day settings not equal\n\t\t\tif(myHours !== otherHours &&\n\t\t\t\t// but still can be two arrays with the equivalent hour settings\n\t\t\t\t!(Array.isArray(myHours) && Array.isArray(otherHours) && this._arraysEqual(myHours, otherHours))\n\t\t\t\t){\n\t\t\t\treturn false;\n\t\t\t}\n\t\t}\n\n\t\treturn true;\n\t},\n\n\tequals: function (calendar) {\n\t\tif(!(calendar instanceof CalendarWorkTimeStrategy)){\n\t\t\treturn false;\n\t\t}\n\n\t\tvar mySettings = this.getConfig();\n\t\tvar thatSettings = calendar.getConfig();\n\n\t\tif(!this._compareSettings(mySettings, thatSettings)){\n\t\t\treturn false;\n\t\t}\n\n\t\tif(mySettings.parsed.haveCustomWeeks && thatSettings.parsed.haveCustomWeeks){\n\t\t\tif(mySettings.parsed.customWeeksBoundaries.length != thatSettings.parsed.customWeeksBoundaries.length){\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tfor(var i in mySettings.parsed.customWeeks){\n\t\t\t\tvar myWeek = mySettings.parsed.customWeeks[i];\n\t\t\t\tvar thatWeek = thatSettings.parsed.customWeeks[i];\n\t\t\t\tif(!thatWeek){\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\n\t\t\t\tif(!this._compareSettings(myWeek, thatWeek)){\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\t\t\t}\n\t\t}else if(mySettings.parse.haveCustomWeeks !== thatSettings.parsed.haveCustomWeeks){\n\t\t\treturn false;\n\t\t}\n\n\t\treturn true;\n\t},\n\n\tgetWorkHours: function () {\n\t\tvar config = this.argumentsHelper.getWorkHoursArguments.apply(this.argumentsHelper, arguments);\n\t\treturn this._getWorkHours(config.date, false);\n\t},\n\t_getWorkHours: function (date, parsed) {\n\t\tvar calendar = this.getConfig();\n\t\tif(parsed !== false){\n\t\t\tcalendar = calendar.parsed;\n\t\t}\n\n\t\tif(!date){\n\t\t\treturn calendar.hours;\n\t\t}\n\n\t\tvar dateValue = this._timestamp({date: date});\n\n\t\tif(calendar.haveCustomWeeks){\n\t\t\tif(calendar.customWeeksRangeStart <= dateValue && calendar.customWeeksRangeEnd > dateValue){\n\t\t\t\tfor(var i = 0; i < calendar.customWeeksBoundaries.length; i++){\n\t\t\t\t\tif(calendar.customWeeksBoundaries[i].from <= dateValue && calendar.customWeeksBoundaries[i].to > dateValue){\n\t\t\t\t\t\tcalendar = calendar.customWeeks[calendar.customWeeksBoundaries[i].name];\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tvar hours = true;\n\n\t\tif (calendar.dates[dateValue] !== undefined) {\n\t\t\thours = calendar.dates[dateValue];//custom day\n\t\t} else if (calendar.dates[date.getDay()] !== undefined) {\n\t\t\thours = calendar.dates[date.getDay()];//week day\n\t\t}\n\t\tif (hours === true) {\n\t\t\treturn calendar.hours;\n\t\t} else if (hours) {\n\t\t\treturn hours;\n\t\t}\n\t\treturn [];\n\t},\n\n\t_getIntervalTimestamp: function(from, to){\n\t\tvar res = {\n\t\t\tstart: 0,\n\t\t\tend: 0\n\t\t};\n\n\t\tres.start = from.getHours() * 60 * 60 + from.getMinutes() * 60 + from.getSeconds();\n\t\tvar endHours = to.getHours();\n\t\tif(!endHours && !to.getMinutes() && !to.getSeconds() && from.valueOf() < to.valueOf()){\n\t\t\tendHours = 24;\n\t\t}\n\t\tres.end = endHours * 60 * 60 + to.getMinutes() * 60 + to.getSeconds();\n\t\treturn res;\n\t},\n\n\t_parseHours: function(hours) {\n\t\tif(Array.isArray(hours)){\n\n\t\t\tvar timestampRanges = [];// worktime as seconds range\n\t\t\thours.forEach(function(hour){\n\t\t\t\tif(typeof hour === \"number\"){\n\t\t\t\t\ttimestampRanges.push(hour*60*60);\n\t\t\t\t}else if(typeof hour === \"string\") {\n\t\t\t\t\t// \"12-13\", or \"12:00-13:00\", or \"12:00:00-13:00:00\"\n\t\t\t\t\thour.split(\"-\").map(function(time){\n\t\t\t\t\t\treturn time.trim();\n\t\t\t\t\t}).forEach(function(part){\n\t\t\t\t\t\tvar parsed = part.split(\":\").map(function(time){\n\t\t\t\t\t\t\treturn time.trim();\n\t\t\t\t\t\t});\n\n\t\t\t\t\t\tvar value = parseInt(parsed[0]*60*60);\n\t\t\t\t\t\tif(parsed[1]){\n\t\t\t\t\t\t\tvalue += parseInt(parsed[1]*60);\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif(parsed[2]){\n\t\t\t\t\t\t\tvalue += parseInt(parsed[2]);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\ttimestampRanges.push(value);\n\t\t\t\t\t});\n\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tvar timerangeConfig = [];\n\t\t\tfor (var i = 0; i < timestampRanges.length; i += 2) {\n\t\t\t\tvar start = timestampRanges[i];\n\t\t\t\tvar end = timestampRanges[i + 1];\n\t\t\t\tvar duration = end - start;\n\n\t\t\t\ttimerangeConfig.push({\n\t\t\t\t\tstart: start,\n\t\t\t\t\tend: end,\n\t\t\t\t\tstartHour: Math.floor(start / (60*60)),\n\t\t\t\t\tstartMinute: Math.floor(start / (60)),\n\t\t\t\t\tendHour: Math.ceil(end / (60*60)),\n\t\t\t\t\tendMinute: Math.ceil(end / (60)),\n\t\t\t\t\tdurationSeconds: duration,\n\t\t\t\t\tdurationMinutes: duration/60,\n\t\t\t\t\tdurationHours: duration/(60 * 60)\n\t\t\t\t});\n\t\t\t}\n\n\t\t\treturn timerangeConfig;\n\t\t} else {\n\t\t\treturn hours;\n\t\t}\n\t},\n\n\tsetWorkTime: function (settings) {\n\t\treturn this._tryChangeCalendarSettings(utils.bind(function () {\n\t\t\tvar hours = settings.hours !== undefined ? settings.hours : true;\n\t\t\tvar timestamp = this._timestamp(settings);\n\t\t\tvar calendarConfig = this.getConfig();\n\t\t\tif (timestamp !== null) {\n\t\t\t\tcalendarConfig.dates[timestamp] = hours;\n\t\t\t} else if(!settings.customWeeks) {\n\t\t\t\tcalendarConfig.hours = hours;\n\t\t\t}\n\n\t\t\tif(settings.customWeeks){\n\t\t\t\tif(!calendarConfig.customWeeks){\n\t\t\t\t\tcalendarConfig.customWeeks = {};\n\t\t\t\t}\n\t\t\t\t// GS-1867. allow setWorkTime to exclude dates in the customWeeks range\n\t\t\t\tif (typeof settings.customWeeks == \"string\"){\n\t\t\t\t\tif (timestamp !== null) {\n\t\t\t\t\t\tcalendarConfig.customWeeks[settings.customWeeks].dates[timestamp] = hours;\n\t\t\t\t\t} else if(!settings.customWeeks) {\n\t\t\t\t\t\tcalendarConfig.customWeeks[settings.customWeeks].hours = hours;\n\t\t\t\t\t}\t\t\n\t\t\t\t} else if (typeof settings.customWeeks === \"object\"\n\t\t\t\t&& Function.prototype.toString.call(settings.customWeeks.constructor) === \"function Object() { [native code] }\"){\n\t\t\t\t\tfor(var i in settings.customWeeks){\n\t\t\t\t\t\tcalendarConfig.customWeeks[i] = settings.customWeeks[i];\n\t\t\t\t\t}\t\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tthis._parseSettings();\n\t\t\tthis._clearCaches();\n\t\t}, this));\n\t},\n\n\tunsetWorkTime: function (settings) {\n\t\treturn this._tryChangeCalendarSettings(utils.bind(function () {\n\t\t\tif (!settings) {\n\t\t\t\tthis.reset_calendar();\n\t\t\t} else {\n\n\t\t\t\tvar timestamp = this._timestamp(settings);\n\n\t\t\t\tif (timestamp !== null) {\n\t\t\t\t\tdelete this.getConfig().dates[timestamp];\n\t\t\t\t}\n\t\t\t}\n\t\t\t// Load updated settings and clear work units cache\n\t\t\tthis._parseSettings();\n\t\t\tthis._clearCaches();\n\t\t}, this));\n\t},\n\n\t_isWorkTime: function (date, unit) {\n\t\t// Check if this item has in the cache\n\n\t\tvar useCache = true;//unit === \"day\"; // use cache only for days. In case of hours/minutes cache size grows too large and the overhead exceeds the gains\n\t\tvar isWorkUnit = -1;\n\t\tvar dateKey = null;\n\n\t\tif(useCache){\n\t\t\t// use string keys\n\t\t\tdateKey = String(date.valueOf());\n\t\t\tisWorkUnit = this._workingUnitsCache.getItem(unit, dateKey, date);\n\t\t}\n\n\t\tif (isWorkUnit == -1) {\n\t\t\t// calculate if not cached\n\t\t\tisWorkUnit = this._checkIfWorkingUnit(date, unit);\n\t\t\tif(useCache){\n\t\t\t\tthis._workingUnitsCache.setItem(unit, dateKey, isWorkUnit, date);\n\t\t\t}\n\t\t}\n\n\t\treturn isWorkUnit;\n\t},\n\n\tisWorkTime: function () {\n\t\tvar config =  this.argumentsHelper.isWorkTimeArguments.apply( this.argumentsHelper, arguments);\n\t\treturn this._isWorkTime(config.date, config.unit);\n\t},\n\n\tcalculateDuration: function () {\n\t\tvar config =  this.argumentsHelper.getDurationArguments.apply( this.argumentsHelper, arguments);\n\n\t\tif (!config.unit) {\n\t\t\treturn false;\n\t\t}\n\t\t//return this._calculateDuration(config.start_date, config.end_date, config.unit, config.step);\n\n\t\tvar self = this;\n\t\treturn this._dateDurationCache.getDuration(config.start_date, config.end_date, config.unit, config.step, function(){ \n\t\t\treturn self._calculateDuration(config.start_date, config.end_date, config.unit, config.step);\n\t\t});\n\t},\n\n\t_calculateDuration: function (from, to, unit, step) {\n\t\tvar res = 0;\n\n\t\tvar sign = 1;\n\t\tif(from.valueOf() > to.valueOf()){\n\t\t\tvar tmp = to;\n\t\t\tto = from;\n\t\t\tfrom = tmp;\n\t\t\tsign = -1;\n\t\t}\n\n\t\tif (unit == \"hour\" && step == 1) {\n\t\t\tres = this._getHoursBetween(from, to, unit, step);\n\t\t} else if(unit == \"minute\" && step == 1){\n\t\t\t// quick calculation for minutes with 1 minute step\n\t\t\tres = this._getMinutesBetween(from, to, unit, step);\n\t\t} else {\n\t\t\tres = this._getWorkUnitsBetweenGeneric(from, to, unit, step);\n\t\t}\n\n\t\t// getWorkUnits.. returns decimal durations\n\t\treturn sign * Math.round(res);\n\t},\n\thasDuration: function () {\n\t\tvar config =  this.argumentsHelper.getDurationArguments.apply( this.argumentsHelper, arguments);\n\n\t\tvar from = config.start_date,\n\t\t\tto = config.end_date,\n\t\t\tunit = config.unit,\n\t\t\tstep = config.step;\n\n\t\tif (!unit) {\n\t\t\treturn false;\n\t\t}\n\t\tvar start = new Date(from),\n\t\t\tend = new Date(to);\n\t\tstep = step || 1;\n\n\t\twhile (start.valueOf() < end.valueOf()) {\n\t\t\tif (this._isWorkTime(start, unit))\n\t\t\t\treturn true;\n\t\t\tstart = this._nextDate(start, unit, step);\n\t\t}\n\t\treturn false;\n\t},\n\n\tcalculateEndDate: function () {\n\t\tvar config =  this.argumentsHelper.calculateEndDateArguments.apply( this.argumentsHelper, arguments);\n\n\t\tvar from = config.start_date,\n\t\t\tduration = config.duration,\n\t\t\tunit = config.unit,\n\t\t\tstep = config.step;\n\n\t\tif (!unit)\n\t\t\treturn false;\n\n\t\tvar mult = (config.duration >= 0) ? 1 : -1;\n\t\tduration = Math.abs(duration * 1);\n\t//\tvar endDate = this._calculateEndDate(from, duration, unit, step * mult);\n\t//\treturn endDate;\n\t\tvar self = this;\n\t\treturn this._dateDurationCache.getEndDate(from, duration, unit, step * mult, function(){ \n\t\t\treturn self._calculateEndDate(from, duration, unit, step * mult);\n\t\t} );\n\t},\n\n\t_calculateEndDate: function (from, duration, unit, step) {\n\t\tif (!unit)\n\t\t\treturn false;\n\n\t\tif (step == 1 && unit == \"minute\") {\n\t\t\treturn this._calculateMinuteEndDate(from, duration, step);\n\t\t} else if(step == -1 && unit == \"minute\") {\n\t\t\treturn this._subtractMinuteDate(from, duration, step);\n\t\t} else if (step == 1 && unit == \"hour\") {\n\t\t\treturn this._calculateHourEndDate(from, duration, step);\n\t\t} else {\n\t\t\tvar interval = this._addInterval(from, duration, unit, step, null);\n\t\t\treturn interval.end;\n\t\t}\n\t},\n\n\t_addInterval: function (start, duration, unit, step, stopAction) {\n\t\tvar added = 0;\n\t\tvar current = start;\n\t\tvar dstShift = false;\n\n\t\twhile (added < duration && !(stopAction && stopAction(current))) {\n\t\t\tvar next = this._nextDate(current, unit, step);\n\n\t\t\t// GS-1501. Correct hours after DST change\n\t\t\tif (unit == \"day\"){\n\t\t\t\tdstShift = dstShift || !current.getHours() && next.getHours();\n\n\t\t\t\tif (dstShift){\n\t\t\t\t\tnext.setHours(0);\n\t\t\t\t\tif (next.getHours()){\n\t\t\t\t\t// the day when the timezone is changed, try to correct hours next time\n\t\t\t\t\t} else {\n\t\t\t\t\t\tdstShift = false;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tvar dateValue = new Date(next.valueOf() + 1);\n\t\t\tif (step > 0) {\n\t\t\t\tdateValue = new Date(next.valueOf() - 1);\n\t\t\t}\n\t\t\tvar workTimeCheck = this._isWorkTime(dateValue, unit);\n\n\t\t\tif (workTimeCheck && !dstShift) {\n\t\t\t\tadded++;\n\t\t\t}\n\t\t\tcurrent = next;\n\t\t}\n\t\treturn {\n\t\t\tend: current,\n\t\t\tstart: start,\n\t\t\tadded: added\n\t\t};\n\t},\n\n\t_addHoursUntilDayEnd: function(from, duration) {\n\t\tvar dayEnd = this.$gantt.date.add(this.$gantt.date.day_start(new Date(from)), 1, \"day\");\n\t\tvar added = 0;\n\t\tvar left = duration;\n\n\t\tvar range = this._getIntervalTimestamp(from, dayEnd);\n\t\tvar worktimes = this._getWorkHours(from);\n\t\tfor(var i = 0; i < worktimes.length && added < duration; i++){\n\t\t\tvar interval = worktimes[i];\n\t\t\tif(range.end >= interval.start && range.start <= interval.end){\n\t\t\t\tvar minuteFrom = Math.max(interval.start, range.start);\n\t\t\t\tvar minuteTo = Math.min(interval.end, range.end);\n\t\t\t\tvar rangeHours = (minuteTo - minuteFrom) / (60 * 60);\n\t\t\t\tif(rangeHours > left){\n\t\t\t\t\trangeHours = left;\n\t\t\t\t\tminuteTo = minuteFrom + (left * 60 * 60);\n\t\t\t\t}\n\n\t\t\t\tvar addHours = Math.round((minuteTo - minuteFrom) / (60 * 60));\n\t\t\t\tadded += addHours;\n\t\t\t\tleft -= addHours;\n\t\t\t\trange.start = minuteTo;\n\t\t\t}\n\t\t}\n\n\t\tvar intervalEnd = dayEnd;\n\t\tif(added === duration){\n\t\t\tintervalEnd = new Date(from.getFullYear(), from.getMonth(), from.getDate(), 0, 0, range.start);\n\t\t}\n\t\treturn {\n\t\t\tadded: added,\n\t\t\tend: intervalEnd\n\t\t};\n\t},\n\n\t_calculateHourEndDate: function (from, duration,  step) {\n\t\tvar start = new Date(from),\n\t\tadded = 0;\n\t\tstep = step || 1;\n\t\tduration = Math.abs(duration * 1);\n\n\t\tvar interval = this._addHoursUntilDayEnd(start, duration);\n\t\tadded = interval.added;\n\t\tstart = interval.end;\n\n\t\tvar durationLeft = duration - added;\n\n\t\tif (durationLeft) {\n\t\t\tvar current = start;\n\t\t\twhile (added < duration) {\n\t\t\t\tvar next = this._nextDate(current, \"day\", step);\n\t\t\t\t// reset to day start in case DST switch happens in the process\n\t\t\t\tnext.setHours(0);\n\t\t\t\tnext.setMinutes(0);\n\t\t\t\tnext.setSeconds(0);\n\n\t\t\t\tvar hoursPerDay = 0;\n\t\t\t\tif(step > 0){\n\t\t\t\t\thoursPerDay = this.getHoursPerDay(new Date(next.valueOf() - 1));\n\t\t\t\t}else{\n\t\t\t\t\thoursPerDay = this.getHoursPerDay(new Date(next.valueOf() + 1));\n\t\t\t\t}\n\n\t\t\t\tif (added + hoursPerDay >= duration) {\n\t\t\t\t\tbreak;\n\t\t\t\t} else {\n\t\t\t\t\tadded += hoursPerDay;\n\t\t\t\t}\n\n\t\t\t\tcurrent = next;\n\t\t\t}\n\t\t\tstart = current;\n\t\t}\n\n\t\tif (added < duration) {\n\t\t\tvar durationLeft = duration - added;\n\t\t\tinterval = this._addHoursUntilDayEnd(start, durationLeft);\n\t\t\tstart = interval.end;\n\t\t}\n\n\t\treturn start;\n\t},\n\n\t_addMinutesUntilHourEnd: function(from, duration){\n\t\tif(from.getMinutes() === 0) {\n\t\t\t// already at hour end\n\t\t\treturn {\n\t\t\t\tadded: 0,\n\t\t\t\tend: new Date(from)\n\t\t\t};\n\t\t}\n\t\tvar hourEnd = this.$gantt.date.add(this.$gantt.date.hour_start(new Date(from)), 1, \"hour\");\n\t\tvar added = 0;\n\t\tvar left = duration;\n\n\t\tvar range = this._getIntervalTimestamp(from, hourEnd);\n\t\tvar worktimes = this._getWorkHours(from);\n\t\tfor(var i = 0; i < worktimes.length && added < duration; i++){\n\t\t\tvar interval = worktimes[i];\n\t\t\tif(range.end >= interval.start && range.start <= interval.end){\n\t\t\t\tvar minuteFrom = Math.max(interval.start, range.start);\n\t\t\t\tvar minuteTo = Math.min(interval.end, range.end);\n\t\t\t\tvar rangeMinutes = (minuteTo - minuteFrom) / 60;\n\t\t\t\tif(rangeMinutes > left){\n\t\t\t\t\trangeMinutes = left;\n\t\t\t\t\tminuteTo = minuteFrom + (left * 60);\n\t\t\t\t}\n\n\t\t\t\t// TODO: verify testcase https://dhtmlxsupport.teamwork.com/desk/tickets/9625700/messages\n\t\t\t\t/*if (rangeMinutes === 0) {\n\t\t\t\t\trangeMinutes = left;\n\t\t\t\t\tminuteTo = minuteFrom + (left * 60);\n\t\t\t\t}*/\n\n\t\t\t\tvar addMinutes = Math.round((minuteTo - minuteFrom) / 60);\n\t\t\t\tleft -= addMinutes;\n\t\t\t\tadded += addMinutes;\n\t\t\t\trange.start = minuteTo;\n\t\t\t}\n\t\t}\n\n\t\tvar intervalEnd = hourEnd;\n\t\tif(added === duration){\n\t\t\tintervalEnd = new Date(from.getFullYear(), from.getMonth(), from.getDate(), 0, 0, range.start);\n\t\t}\n\t\treturn {\n\t\t\tadded: added,\n\t\t\tend: intervalEnd\n\t\t};\n\t},\n\n\t_subtractMinutesUntilHourStart: function(from, duration){\n\t\tvar hourStart = this.$gantt.date.hour_start(new Date(from));\n\t\tvar added = 0;\n\t\tvar left = duration;\n\n\t\tvar hourStartTimestamp = hourStart.getHours() * 60 * 60 + hourStart.getMinutes() * 60 + hourStart.getSeconds();\n\t\tvar initialDateTimestamp = from.getHours() * 60 * 60 + from.getMinutes() * 60 + from.getSeconds();\n\n\t\tvar worktimes = this._getWorkHours(from);\n\t\tfor(var i = worktimes.length - 1; i >= 0 && added < duration; i--){\n\t\t\tvar interval = worktimes[i];\n\t\t\tif(initialDateTimestamp > interval.start && hourStartTimestamp <= interval.end){\n\t\t\t\tvar minuteFrom = Math.min(initialDateTimestamp, interval.end);\n\t\t\t\tvar minuteTo = Math.max(hourStartTimestamp, interval.start);\n\n\t\t\t//\tvar minuteFrom = Math.max(interval.start, currentHour.start);\n\t\t\t//\tvar minuteTo = Math.min(interval.end, currentHour.end);\n\t\t\t\tvar rangeMinutes = (minuteFrom - minuteTo) / 60;\n\t\t\t\tif(rangeMinutes > left){\n\t\t\t\t\trangeMinutes = left;\n\t\t\t\t\tminuteTo = minuteFrom - (left * 60);\n\t\t\t\t}\n\n\t\t\t\t// TODO: verify testcase https://dhtmlxsupport.teamwork.com/desk/tickets/9625700/messages\n\t\t\t\t/*if (rangeMinutes === 0) {\n\t\t\t\t\trangeMinutes = left;\n\t\t\t\t\tminuteTo = minuteFrom - (left * 60);\n\t\t\t\t}*/\n\n\t\t\t\tvar addMinutes = Math.abs(Math.round((minuteFrom - minuteTo) / 60));\n\t\t\t\tleft -= addMinutes;\n\t\t\t\tadded += addMinutes;\n\t\t\t\tinitialDateTimestamp = minuteTo;\n\t\t\t}\n\t\t}\n\n\t\tvar intervalEnd = hourStart;\n\t\tif(added === duration){\n\t\t\tintervalEnd = new Date(from.getFullYear(), from.getMonth(), from.getDate(), 0, 0, initialDateTimestamp);\n\t\t}\n\t\treturn {\n\t\t\tadded: added,\n\t\t\tend: intervalEnd\n\t\t};\n\t},\n\n\t_subtractMinuteDate: function (from, duration, step) {\n\t\tvar start = new Date(from),\n\t\t\tadded = 0;\n\t\tstep = step || -1;\n\t\tduration = Math.abs(duration * 1);\n\t\tduration = Math.round(duration);\n\n\t\tconst minutePrecision = this._isMinutePrecision(start);\n\n\t\tlet addedInterval = this._subtractMinutesUntilHourStart(start, duration);\n\t\tadded += addedInterval.added;\n\n\t\tstart = addedInterval.end;\n\n\t\tvar calculatedDay = 0;\n\t\tvar daySchedule = [];\n\t\tvar minutesInDay = 0;\n\n\t\twhile (added < duration) {\n\t\t\tvar dayStart = this.$gantt.date.day_start(new Date(start));\n\n\t\t\tvar iterateFromDayEnd = false;\n\t\t\tif(start.valueOf() === dayStart.valueOf()){\n\t\t\t\tdayStart = this.$gantt.date.add(dayStart, -1, \"day\");\n\t\t\t\titerateFromDayEnd = true;\n\t\t\t}\n\t\t\t//var dayStartTimestamp = this.$gantt.date.day_start(new Date(start)).valueOf();\n\t\t\tvar dayEnd = new Date(dayStart.getFullYear(), dayStart.getMonth(), dayStart.getDate(), 23, 59,59,999).valueOf();\n\n\t\t\tif(dayEnd !== calculatedDay){\n\t\t\t\tdaySchedule = this._getWorkHours(dayStart);\n\t\t\t\tminutesInDay = this._getMinutesPerDay(dayStart);\n\t\t\t\tcalculatedDay = dayEnd;\n\t\t\t}\n\n\t\t\tvar left = duration - added;\n\t\t\tvar timestamp = this._getTimeOfDayStamp(start, iterateFromDayEnd);\n\n\t\t\tif(!daySchedule.length || !minutesInDay){\n\t\t\t\tstart = this.$gantt.date.add(start, -1, \"day\");\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tif(daySchedule[daySchedule.length - 1].end <= timestamp){\n\t\t\t\tif(left > minutesInDay){\n\t\t\t\t\tadded += minutesInDay;\n\t\t\t\t\tstart = this.$gantt.date.add(start, -1, \"day\");\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tvar isWorkHour = false;\n\t\t\tvar workInterval = null;\n\t\t\tvar prevInterval = null;\n\t\t\tfor(var i = daySchedule.length - 1; i >= 0; i--){\n\t\t\t\tif(daySchedule[i].start < timestamp - 1 && daySchedule[i].end >= timestamp - 1){\n\t\t\t\t\tisWorkHour = true;\n\t\t\t\t\tworkInterval = daySchedule[i];\n\t\t\t\t\tprevInterval = daySchedule[i-1];\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif(isWorkHour){\n\n\t\t\t\t// we're at the end of worktime interval and subtracting more than the duration of the interval\n\t\t\t\t// -> subtract the duration of the interval and move to the start of the interval (we're moving from end)\n\t\t\t\tif(timestamp === workInterval.end && left >= workInterval.durationMinutes){\n\t\t\t\t\tadded += workInterval.durationMinutes;\n\t\t\t\t\tstart = this.$gantt.date.add(start, -workInterval.durationMinutes, \"minute\");\n\t\t\t\t} // worktime is set in whole hours (no intervals like 9:15-10:00)\n\t\t\t\t// the amount we need to subtract lies inside the interval\n\t\t\t\telse if(!minutePrecision && left <= (timestamp/60 - workInterval.startMinute)){\n\t\t\t\t\tadded += left;\n\t\t\t\t\tstart = this.$gantt.date.add(start, -left, \"minute\");\n\t\t\t\t}else if (minutePrecision){\n\t\t\t\t\t// GS-2129. If the working time is set in minutes, we accumulate the working time in minutes from right to left\n\t\t\t\t\t\n\t\t\t\t\t// duration we need to subtract lies completely inside the work interval\n\t\t\t\t\tif(left <= (timestamp/60 - workInterval.startMinute)){\n\t\t\t\t\t\tadded += left;\n\t\t\t\t\t\tstart = this.$gantt.date.add(start, -left, \"minute\");\n\t\t\t\t\t}else {\n\t\t\t\t\t\t// we need to go trough multiple work intervals to subtract needed time\n\t\t\t\t\t\tadded += (timestamp/60 - workInterval.startMinute);\n\t\t\t\t\t\tif(prevInterval){\n\t\t\t\t\t\t\tstart = new Date(start.getFullYear(), start.getMonth(), start.getDate(), 0, 0, prevInterval.end);\n\t\t\t\t\t\t}else{\n\t\t\t\t\t\t\tstart = this.$gantt.date.day_start(start);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\t\n\n\t\t\t\t}else{\n\t\t\t\t\tvar minutesInHour = this._getMinutesPerHour(start);\n\t\t\t\t\tif(minutesInHour <= left){\n\t\t\t\t\t\tadded += minutesInHour;\n\t\t\t\t\t\tstart = this._nextDate(start, \"hour\", step);\n\t\t\t\t\t}else{\n\t\t\t\t\t\taddedInterval = this._subtractMinutesUntilHourStart(start, left);\n\t\t\t\t\t\tadded += addedInterval.added;\n\t\t\t\t\t\tstart = addedInterval.end;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}else{\n\t\t\t\tif(start.getHours() === 0 && start.getMinutes() === 0 && start.getSeconds() === 0){\n\t\t\t\t\tvar prev = this._getClosestWorkTimePast(start, \"hour\");\n\t\t\t\t\tif(prev.valueOf() === start.valueOf()){\n\t\t\t\t\t\tvar prev = this.$gantt.date.add(start, -1, \"day\");\n\t\t\t\t\t\tvar times = this._getWorkHours(prev);\n\t\t\t\t\t\tif(times.length){\n\t\t\t\t\t\t\tvar lastInterval = times[times.length - 1];\n\t\t\t\t\t\t\tprev.setSeconds(lastInterval.durationSeconds);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tstart = prev;\n\n\t\t\t\t} else{\n\t\t\t\t\tstart = this._getClosestWorkTimePast(new Date(start - 1), \"hour\");\n\t\t\t\t}\n\n\t\t\t}\n\t\t}\n\n\t\tif (added < duration) {\n\t\t\tvar durationLeft = duration - added;\n\t\t\taddedInterval = this._subtractMinutesUntilHourStart(start, durationLeft);\n\t\t\tadded += addedInterval.added;\n\t\t\tstart = addedInterval.end;\n\t\t}\n\n\t\treturn start;\n\t},\n\t_calculateMinuteEndDate: function (from, duration, step) {\n\t\tvar start = new Date(from),\n\t\t\tadded = 0;\n\t\tstep = step || 1;\n\t\tduration = Math.abs(duration * 1);\n\t\tduration = Math.round(duration);\n\n\t\tvar addedInterval = this._addMinutesUntilHourEnd(start, duration);\n\t\tadded += addedInterval.added;\n\n\t\tstart = addedInterval.end;\n\n\t\tvar calculatedDay = 0;\n\t\tvar daySchedule = [];\n\t\tvar minutesInDay = 0;\n\n\t\tvar minutePrecision = this._isMinutePrecision(start);\n\n\t\twhile (added < duration) {\n\t\t\tvar dayStart = this.$gantt.date.day_start(new Date(start)).valueOf();\n\t\t\tif(dayStart !== calculatedDay){\n\t\t\t\tdaySchedule = this._getWorkHours(start);\n\t\t\t\tminutesInDay = this._getMinutesPerDay(start);\n\t\t\t\tcalculatedDay = dayStart;\n\n\t\t\t}\n\n\t\t\tvar left = duration - added;\n\t\t\tvar timestamp = this._getTimeOfDayStamp(start);\n\n\t\t\tif(!daySchedule.length || !minutesInDay){\n\t\t\t\tstart = this.$gantt.date.add(this.$gantt.date.day_start(start), 1, \"day\");\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tif(daySchedule[0].start >= timestamp){\n\t\t\t\tif(left >= minutesInDay){\n\t\t\t\t\tadded += minutesInDay;\n\t\t\t\t\tif (left == minutesInDay) {\n\t\t\t\t\t\tstart = new Date(start.getFullYear(), start.getMonth(), start.getDate(), 0, 0, daySchedule[daySchedule.length - 1].end);\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}else{\n\t\t\t\t\t\tstart = this.$gantt.date.add(start, 1, \"day\");\n\t\t\t\t\t\tstart = this.$gantt.date.day_start(start);\n\t\t\t\t\t}\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tvar isWorkHour = false;\n\t\t\tvar workInterval = null;\n\t\t\tfor(var i = 0; i < daySchedule.length; i++){\n\t\t\t\tif(daySchedule[i].start <= timestamp && daySchedule[i].end > timestamp){\n\t\t\t\t\tisWorkHour = true;\n\t\t\t\t\tworkInterval = daySchedule[i];\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\t\t\tif(isWorkHour){\n\n\t\t\t\tif(timestamp === workInterval.start && left >= workInterval.durationMinutes){\n\t\t\t\t\tadded += workInterval.durationMinutes;\n\t\t\t\t\tstart = this.$gantt.date.add(start, workInterval.durationMinutes, \"minute\");\n\t\t\t\t}else if(left <= (workInterval.endMinute - timestamp/60)){\n\t\t\t\t\tadded += left;\n\t\t\t\t\tstart = this.$gantt.date.add(start, left, \"minute\");\n\t\t\t\t}else{\n\t\t\t\t\tvar minutesInHour = this._getMinutesPerHour(start);\n\t\t\t\t\tif(minutesInHour <= left){\n\t\t\t\t\t\tadded += minutesInHour;\n\t\t\t\t\t\t// when the working time settings are set in minutes move to the next minutes\n\t\t\t\t\t\tif (minutePrecision) {\n\t\t\t\t\t\t\tstart = this.$gantt.date.add(start, minutesInHour, \"minute\");\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tstart = this._nextDate(start, \"hour\", step);\n\t\t\t\t\t\t}\n\t\t\t\t\t}else{\n\t\t\t\t\t\taddedInterval = this._addMinutesUntilHourEnd(start, left);\n\t\t\t\t\t\tadded += addedInterval.added;\n\t\t\t\t\t\tstart = addedInterval.end;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}else{\n\t\t\t\tstart = this._getClosestWorkTimeFuture(start, \"hour\");\n\t\t\t}\n\t\t}\n\n\t\tif (added < duration) {\n\t\t\tvar durationLeft = duration - added;\n\t\t\taddedInterval = this._addMinutesUntilHourEnd(start, durationLeft);\n\t\t\tadded += addedInterval.added;\n\t\t\tstart = addedInterval.end;\n\t\t}\n\n\t\treturn start;\n\t},\n\n\tgetClosestWorkTime: function () {\n\t\tvar settings =  this.argumentsHelper.getClosestWorkTimeArguments.apply( this.argumentsHelper, arguments);\n\t\treturn this._getClosestWorkTime(settings.date, settings.unit, settings.dir);\n\t},\n\n\t_getClosestWorkTime: function (inputDate, unit, direction) {\n\t\tvar result = new Date(inputDate);\n\n\t\tif (this._isWorkTime(result, unit)) {\n\t\t\treturn result;\n\t\t}\n\n\t\tresult = this.$gantt.date[unit + '_start'](result);\n\n\t\tif (direction == 'any' || !direction) {\n\t\t\tvar closestFuture = this._getClosestWorkTimeFuture(result, unit);\n\t\t\tvar closestPast = this._getClosestWorkTimePast(result, unit);\n\t\t\tif (Math.abs(closestFuture - inputDate) <= Math.abs(inputDate - closestPast)) {\n\t\t\t\tresult = closestFuture;\n\t\t\t} else {\n\t\t\t\tresult = closestPast;\n\t\t\t}\n\t\t} else if (direction == \"past\") {\n\t\t\tresult = this._getClosestWorkTimePast(result, unit);\n\t\t} else {\n\t\t\tresult = this._getClosestWorkTimeFuture(result, unit);\n\t\t}\n\t\treturn result;\n\t},\n\n\t_getClosestWorkTimeFuture: function (date, unit) {\n\t\treturn this._getClosestWorkTimeGeneric(date, unit, 1);\n\t},\n\n\t_getClosestWorkTimePast: function (date, unit) {\n\t\tvar result = this._getClosestWorkTimeGeneric(date, unit, -1);\n\t\t// should return the end of the closest work interval\n\t\treturn this.$gantt.date.add(result, 1, unit);\n\t},\n\n\t_findClosestTimeInDay: function(date, direction, worktimes) {\n\t\tvar start = new Date(date);\n\t\tvar resultDate = null;\n\t\tvar fromDayEnd = false;\n\t\tif(!this._getWorkHours(start).length){\n\t\t\tstart = this._getClosestWorkTime(start, \"day\", direction < 0 ? \"past\" : \"future\");\n\t\t\tif(direction < 0){\n\t\t\t\tstart = new Date(start.valueOf() - 1);\n\t\t\t\tfromDayEnd = true;\n\t\t\t}\n\t\t\tworktimes = this._getWorkHours(start);\n\t\t}\n\n\t\tvar value = this._getTimeOfDayStamp(start);\n\t\tif(fromDayEnd){\n\t\t\tvalue = this._getTimeOfDayStamp(new Date(start.valueOf() + 1), fromDayEnd);\n\t\t}\n\t\tif(direction > 0){\n\t\t\tfor(var i = 0; i < worktimes.length; i++){\n\t\t\t\tif(worktimes[i].start >= value){\n\t\t\t\t\tresultDate = new Date(start.getFullYear(), start.getMonth(), start.getDate(), 0, 0, worktimes[i].start);\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\t\t}else{\n\t\t\tfor(var i = worktimes.length - 1; i >= 0; i--){\n\t\t\t\tif(worktimes[i].end <= value){\n\t\t\t\t\tresultDate = new Date(start.getFullYear(), start.getMonth(), start.getDate(), 0, 0, worktimes[i].end);\n\t\t\t\t\tbreak;\n\t\t\t\t}else if(worktimes[i].end > value && worktimes[i].start <= value) {\n\t\t\t\t\tresultDate = new Date(start.getFullYear(), start.getMonth(), start.getDate(), 0, 0, value);\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\treturn resultDate;\n\t},\n\t_getClosestWorkMinute: function(date, unit, direction) {\n\t\tvar start = new Date(date);\n\t\tvar worktimes = this._getWorkHours(start);\n\t\tvar resultDate = this._findClosestTimeInDay(start, direction, worktimes);\n\t\tif(!resultDate){\n\t\t\tstart = this.calculateEndDate(start, direction, \"day\");\n\t\t\tif(direction > 0){\n\t\t\t\tstart = this.$gantt.date.day_start(start);\n\t\t\t}else{\n\t\t\t\tstart = this.$gantt.date.day_start(start);\n\t\t\t\tstart = this.$gantt.date.add(start, 1, \"day\");\n\t\t\t\tstart = new Date(start.valueOf() - 1);\n\t\t\t}\n\t\t\tworktimes = this._getWorkHours(start);\n\t\t\tresultDate = this._findClosestTimeInDay(start, direction, worktimes);\n\t\t}\n\t\tif(direction < 0){\n\t\t\t// getClosestWorkTimePast adds one time unit to the result date after this\n\t\t\tresultDate = this.$gantt.date.add(resultDate, -1, unit);\n\t\t}\n\t\treturn resultDate;\n\t},\n\n\t_getClosestWorkTimeGeneric: function (date, unit, increment) {\n\t\tif(unit === \"hour\" || unit === \"minute\"){\n\t\t\treturn this._getClosestWorkMinute(date, unit, increment);\n\t\t}\n\n\t\tvar unitOrder = this._getUnitOrder(unit),\n\t\t\tbiggerTimeUnit = this.units[unitOrder - 1];\n\n\t\tvar result = date;\n\n\t\t// be extra sure we won't fall into infinite loop, 3k seems big enough\n\t\tvar maximumLoop = 3000,\n\t\t\tcount = 0;\n\n\t\twhile (!this._isWorkTime(result, unit)) {\n\t\t\tif (biggerTimeUnit && !this._isWorkTime(result, biggerTimeUnit)) {\n\t\t\t\t// if we look for closest work hour and detect a week-end - first find the closest work day,\n\t\t\t\t// and continue iterations after that\n\t\t\t\tif (increment > 0) {\n\t\t\t\t\tresult = this._getClosestWorkTimeFuture(result, biggerTimeUnit);\n\t\t\t\t} else {\n\t\t\t\t\tresult = this._getClosestWorkTimePast(result, biggerTimeUnit);\n\t\t\t\t}\n\n\t\t\t\tif (this._isWorkTime(result, unit)) {\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tcount++;\n\t\t\tif (count > maximumLoop) {\n\t\t\t\tthis.$gantt.assert(false, \"Invalid working time check\");\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tvar tzOffset = result.getTimezoneOffset();\n\t\t\tresult = this.$gantt.date.add(result, increment, unit);\n\n\t\t\tresult = this.$gantt._correct_dst_change(result, tzOffset, increment, unit);\n\t\t\tif (this.$gantt.date[unit + '_start']) {\n\t\t\t\tresult = this.$gantt.date[unit + '_start'](result);\n\t\t\t}\n\t\t}\n\t\treturn result;\n\t},\n\n\t/**\n\t * Check whether this calendar has working time. Calendar has working time only if there are regular working days of week\n\t *\n\t */\n\thasWorkTime: function () {\n\t\tvar worktime = this.getConfig();\n\t\tvar dates = worktime.dates;\n\n\t\tvar daysOfWeek = [0, 1, 2, 3, 4, 5, 6];\n\t\tvar exceptions = [];\n\t\tfor(var i in worktime.dates){\n\t\t\tif(Number(i) > 6){\n\t\t\t\texceptions.push(Number(i));\n\t\t\t}\n\t\t}\n\n\t\tvar hasRegularHours = this._checkWorkHours(worktime.hours);\n\n\t\tvar result = false;\n\t\tdaysOfWeek.forEach((function(day){\n\t\t\tif(result){\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tvar dayConfig = dates[day];\n\t\t\tif(dayConfig === true){\n\t\t\t\t// workday uses global hours\n\t\t\t\tresult = hasRegularHours;\n\t\t\t}else if(Array.isArray(dayConfig)){\n\t\t\t\t// workday uses custom hours\n\t\t\t\tresult = this._checkWorkHours(dayConfig);\n\t\t\t}\n\t\t}).bind(this));\n\n\t\treturn result;\n\n\t},\n\n\t_checkWorkHours: function(hoursArray) {\n\t\tif (hoursArray.length === 0) {\n\t\t\treturn false;\n\t\t}\n\t\tvar result = false;\n\t\tfor (var i = 0; i < hoursArray.length; i += 2) {\n\t\t\tif (hoursArray[i] !== hoursArray[i + 1]) {\n\t\t\t\tresult = true;\n\t\t\t}\n\t\t}\n\t\treturn result;\n\t},\n\n\t_isMinutePrecision: function (date) {\n\t\tlet minutePrecision = false;\n\t\tthis._getWorkHours(date).forEach(function(interval){\n\t\t\tif (interval.startMinute % 60 || interval.endMinute % 60){\n\t\t\t\tminutePrecision = true;\n\t\t\t}\n\t\t});\n\t\treturn minutePrecision;\n\t}\n};\n\nexport default CalendarWorkTimeStrategy;","import { IWorkUnitCache } from \"./workunit_cache_interface\";\nimport { WorkUnitsMapCache } from \"./workunit_map_cache\";\nimport { WorkUnitsObjectCache } from \"./workunit_object_cache\";\nexport { LargerUnitsCache } from \"./larger_units_helper\";\n\nexport function createCacheObject(): IWorkUnitCache {\n\n\t// worktime hash is on the hot path,\n\t// Map seems to work faster than plain array, use it whenever possible\n\tif (typeof Map !== \"undefined\") {\n\t\treturn new WorkUnitsMapCache();\n\t} else {\n\t\treturn new WorkUnitsObjectCache();\n\t}\n}\n","export default {\n\tisLegacyResourceCalendarFormat: function(resourceCalendarsProperty){\n\t\t// modern format:\n\t\t//gantt.config.resource_calendars = {\n\t\t//\tresourceId: calendarId,\n\t\t//\tresourceId: calendarId,\n\t\t//\tresourceId: calendarId\n\t\t//\t};\n\t\t\n\t\t// legacy format:\n\t\t// gantt.config.resource_calendars = {\n\t\t//\t\"resourceProperty\": {\n\t\t//\t\tresourceId: calendarId,\n\t\t//\t\tresourceId: calendarId,\n\t\t//\t\tresourceId: calendarId\n\t\t//\t\t}\n\t\t//\t};\n\n\t\tif(!resourceCalendarsProperty){\n\t\t\treturn false;\n\t\t}\n\t\tfor(var i in resourceCalendarsProperty){\n\t\t\tif(resourceCalendarsProperty[i] && typeof resourceCalendarsProperty[i] === \"object\"){\n\t\t\t\treturn true;\n\t\t\t}\n\t\t}\n\n\t\treturn false;\n\t},\n\tgetResourceProperty: function(config){\n\t\tvar resourceCalendarsConfig = config.resource_calendars;\n\t\tvar propertyName = config.resource_property;\n\t\tif(this.isLegacyResourceCalendarFormat(resourceCalendarsConfig)){\n\t\t\tfor(var i in config){\n\t\t\t\tpropertyName = i;\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t\treturn propertyName;\n\t},\n\tgetCalendarIdFromLegacyConfig: function(task, config){\n\t\tif (config) {\n\t\t\tfor (var field in config) {\n\t\t\t\tvar resource = config[field];\n\t\t\t\tif (task[field]) {\n\t\t\t\t\tvar calendarId = resource[task[field]];\n\t\t\t\t\tif (calendarId) {\n\t\t\t\t\t\treturn calendarId;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\treturn null;\n\t}\n};","import * as utils from \"../../utils/utils\";\nimport createArgumentsHelper from \"./calendar_arguments_helper\";\nimport CalendarMergeHelper from \"./strategy/work_calendar_merger\";\nimport CalendarWorkTimeStrategy from \"./strategy/calendar_strategy\";\nimport legacyResourceCalendarConfig from \"./legacy_resource_config\";\nimport dynamicResourceCalendarsFactory from \"./dynamic_resource_calendars\";\n\nconst dynamicResourceCalendars = dynamicResourceCalendarsFactory();\n\nfunction CalendarManager (gantt){\n\tthis.$gantt = gantt;\n\tthis._calendars = {};\n\tthis._legacyConfig = undefined;\n\tthis.$gantt.attachEvent(\"onGanttReady\", function(){\n\t\tif(this.$gantt.config.resource_calendars){\n\t\t\tthis._isLegacyConfig = legacyResourceCalendarConfig.isLegacyResourceCalendarFormat(this.$gantt.config.resource_calendars);\n\t\t}\n\t}.bind(this));\n\n\tthis.$gantt.attachEvent(\"onBeforeGanttReady\", function(){\n\t\tthis.createDefaultCalendars();\n\t}.bind(this));\n\tthis.$gantt.attachEvent(\"onBeforeGanttRender\", function(){\n\t\tthis.createDefaultCalendars();\n\t}.bind(this));\n}\n\nCalendarManager.prototype = {\n\t_calendars: {},\n\t_convertWorkTimeSettings: function (settings) {\n\t\tvar days = settings.days;\n\t\tif (days && !settings.dates) {\n\t\t\tsettings.dates = settings.dates || {};\n\t\t\tfor (var i = 0; i < days.length; i++) {\n\t\t\t\tsettings.dates[i] = days[i];\n\t\t\t\tif (!(days[i] instanceof Array)) {\n\t\t\t\t\tsettings.dates[i] = !!days[i];\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tdelete settings.days;\n\t\treturn settings;\n\t},\n\tmergeCalendars: function(){\n\t\tvar calendars = [];\n\t\tvar args = arguments;\n\t\tif(Array.isArray(args[0])){\n\t\t\tcalendars = args[0].slice();\n\t\t}else{\n\t\t\tfor(var i = 0; i < arguments.length; i++){\n\t\t\t\tcalendars.push(arguments[i]);\n\t\t\t}\n\t\t}\n\n\t\tvar mergeHelper = new CalendarMergeHelper();\n\n\t\tvar result;\n\t\tcalendars.forEach(function(calendar){\n\t\t\tif(!result){\n\t\t\t\tresult = calendar;\n\t\t\t} else{\n\t\t\t\tresult = this._createCalendarFromConfig(mergeHelper.merge(result, calendar));\n\t\t\t}\n\n\t\t}.bind(this));\n\t\treturn this.createCalendar(result);\n\t},\n\n\t_createCalendarFromConfig: function(config){\n\t\tvar apiCore = new CalendarWorkTimeStrategy(this.$gantt, createArgumentsHelper(this.$gantt));\n\t\tapiCore.id = String(utils.uid());\n\n\t\tvar preparedConfig = this._convertWorkTimeSettings(config);\n\t\tif(preparedConfig.customWeeks){\n\t\t\tfor(var i in preparedConfig.customWeeks){\n\t\t\t\tpreparedConfig.customWeeks[i] = this._convertWorkTimeSettings(preparedConfig.customWeeks[i]);\n\t\t\t}\n\t\t}\n\t\tapiCore._setConfig(preparedConfig);\n\n\t\treturn apiCore;\n\t},\n\n\tcreateCalendar: function (parentCalendar) {\n\t\tvar settings;\n\n\t\tif (!parentCalendar) {\n\t\t\tparentCalendar = {};\n\t\t}\n\n\t\tif (parentCalendar.getConfig){\n\t\t\tsettings = utils.copy(parentCalendar.getConfig());\n\t\t} else if (parentCalendar.worktime) {\n\t\t\tsettings = utils.copy(parentCalendar.worktime);\n\t\t} else {\n\t\t\tsettings = utils.copy(parentCalendar);\n\t\t}\n\n\t\tvar defaults = utils.copy(this.defaults.fulltime.worktime);\n\t\tutils.mixin(settings, defaults);\n\n\t\treturn this._createCalendarFromConfig(settings);\n\t},\n\n\tgetCalendar: function (id) {\n\t\tid = id || \"global\";\n\t\tvar calendar = this._calendars[id];\n\t\tif(!calendar){\n\t\t\tthis.createDefaultCalendars();\n\t\t\tcalendar = this._calendars[id];\n\t\t}\n\n\t\treturn calendar;\n\t},\n\n\tgetCalendars: function () {\n\t\tvar res = [];\n\t\tfor (var i in this._calendars) {\n\t\t\tres.push(this.getCalendar(i));\n\t\t}\n\t\treturn res;\n\t},\n\n\t_getOwnCalendar: function(task){\n\t\tvar config = this.$gantt.config;\n\t\tif (task[config.calendar_property]) {\n\t\t\treturn this.getCalendar(task[config.calendar_property]);\n\t\t}\n\n\t\tif (config.resource_calendars) {\n\t\t\tvar calendar;\n\t\t\tvar calendarId;\n\t\t\tvar resourceProperty;\n\t\t\tif(this._legacyConfig === false){\n\t\t\t\tresourceProperty = config.resource_property;\n\t\t\t}else{\n\t\t\t\tresourceProperty = legacyResourceCalendarConfig.getResourceProperty(config);\n\t\t\t}\n\t\t\tif(Array.isArray(task[resourceProperty])){\n\t\t\t\t// if multiple resources are attached to the task - merge their calendars\n\t\t\t\tif(config.dynamic_resource_calendars){\n\t\t\t\t\tcalendarId = dynamicResourceCalendars.getCalendarIdFromMultipleResources(task[resourceProperty], this);\n\t\t\t\t} else {\n\t\t\t\t\tcalendar = this.getResourceCalendar(task[resourceProperty]);\n\t\t\t\t}\n\t\t\t}else{\n\t\t\t\tif(this._legacyConfig === undefined){\n\t\t\t\t\tthis._legacyConfig = legacyResourceCalendarConfig.isLegacyResourceCalendarFormat(config.resource_calendars);\n\t\t\t\t}\n\n\t\t\t\tif(this._legacyConfig){\n\t\t\t\t\tvar calendarId = legacyResourceCalendarConfig.getCalendarIdFromLegacyConfig(task, config.resource_calendars);\n\t\t\t\t}else if(resourceProperty && task[resourceProperty] && config.resource_calendars[task[resourceProperty]]){\n\t\t\t\t\tvar calendar = this.getResourceCalendar(task[resourceProperty]);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif(calendarId){\n\t\t\t\tcalendar = this.getCalendar(calendarId);\n\t\t\t}\n\n\t\t\tif(calendar){\n\t\t\t\treturn calendar;\n\t\t\t}\n\t\t}\n\t\treturn null;\n\t},\n\n\t/**\n\t * Returns calendar assigned to the specified resource.\n\t * Returns the global calendar if no custom calendar is associated with the resource.\n\t * @param {(string|number|Object)} resource - resource object or resource id\n\t * @returns {object} Calendar object\n\t */\n\tgetResourceCalendar: function(resource) {\n\t\tif (resource === null || resource === undefined) {\n\t\t\treturn this.getCalendar();\n\t\t}\n\n\t\tvar resourceId = null;\n\t\t// if task id is provided\n\t\tif((typeof resource === \"number\" || typeof resource === \"string\")){\n\t\t\tresourceId = resource;\n\t\t}else{\n\t\t\tresourceId = resource.id || resource.key;\n\t\t}\n\n\t\tvar config = this.$gantt.config;\n\t\tvar calendarsConfig = config.resource_calendars;\n\t\tvar calendarId = null;\n\n\t\t// GS-1714: if resource is specified through array\n\t\tif (Array.isArray(resource)){\n\t\t\tif (resource.length === 1){\n\t\t\t\tif (typeof resource[0] === 'object'){\n\t\t\t\t\tresourceId = resource[0].resource_id; // if resource: [\"resource_id: \"6\", value: \"4\", ...\"]\n\t\t\t\t} else {\n\t\t\t\t\tresourceId = resource[0]; // if resource: [1]\n\t\t\t\t}\n\t\t\t} \n\t\t}\n\t\t\n\t\tif (calendarsConfig) {\n\t\t\tif(this._legacyConfig === undefined){\n\t\t\t\tthis._legacyConfig = legacyResourceCalendarConfig.isLegacyResourceCalendarFormat(config.resource_calendars);\n\t\t\t}\n\n\t\t\tif(this._legacyConfig){\n\t\t\t\tfor(var field in calendarsConfig){\n\t\t\t\t\tif(calendarsConfig[field][resourceId]){\n\t\t\t\t\t\tcalendarId = calendarsConfig[field][resourceId];\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}else{\n\t\t\t\tvar calendarId = calendarsConfig[resourceId];\n\t\t\t}\n\n\t\t\tif(calendarId){\n\t\t\t\treturn this.getCalendar(calendarId);\n\t\t\t}\n\n\t\t}\n\t\treturn this.getCalendar();\n\t},\n\n\t/**\n\t * Returns the calendar assigned to a task.\n\t * - Returns a calendar assigned via task[gantt.config.calendar_property] if specified.\n\t * - Returns a calendar assigned to the task resource if specified.\n\t * - Returns the global calendar otherwise.\n\t * @param {(string|number|Object)} task - task object or task id\n\t * @returns {object} Calendar object\n\t */\n\tgetTaskCalendar: function (task) {\n\t\tvar gantt = this.$gantt;\n\t\tvar taskObject;\n\t\tif (task === null || task === undefined) {\n\t\t\treturn this.getCalendar();\n\t\t}\n\n\t\t// if task id is provided\n\t\tif((typeof task === \"number\" || typeof task === \"string\") && gantt.isTaskExists(task)){\n\t\t\ttaskObject = gantt.getTask(task);\n\t\t}else{\n\t\t\ttaskObject = task;\n\t\t}\n\n\t\tif(!taskObject){\n\t\t\treturn this.getCalendar();\n\t\t}\n\n\t\tvar calendar = this._getOwnCalendar(taskObject);\n\t\tvar groupMode = !!gantt.getState().group_mode;\n\n\t\tif (!calendar && gantt.config.inherit_calendar && gantt.isTaskExists(taskObject.parent)){\n\t\t\t// GS-1579  group mode overrides tree hierarchy, iterate using `.parent` property, instead of using eachParent iterator\n\t\t\tvar currentTask = taskObject;\n\t\t\twhile(gantt.isTaskExists(currentTask.parent)){\n\t\t\t\tcurrentTask = gantt.getTask(currentTask.parent);\n\t\t\t\tif(gantt.isSummaryTask(currentTask)){\n\t\t\t\t\tcalendar = this._getOwnCalendar(currentTask);\n\t\t\t\t\tif(calendar){\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\tif(groupMode && !calendar){\n\t\t\t\t// if group mode and inherit_calendars is enabled - preserve previously applied parent calendar\n\t\t\t\t// we may need it when groupBy parses grouped data, old parent may be not loaded yet\n\t\t\t\tif(task.$effective_calendar){\n\t\t\t\t\tcalendar = this.getCalendar(task.$effective_calendar);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\treturn calendar || this.getCalendar();\n\t},\n\n\taddCalendar: function(calendar) { // puts new calendar to Global Storage - gantt.calendarManager._calendars {}\n\t\tif (!(this.isCalendar(calendar))) {\n\t\t\tvar id = calendar.id;\n\t\t\tcalendar = this.createCalendar(calendar);\n\t\t\tcalendar.id = id;\n\t\t}\n\n\t\t// validate/check if empty calendar\n\t\tif (!calendar._tryChangeCalendarSettings(function () {\n\t\t\t})) {\n\n\t\t\tthis.$gantt.callEvent(\"onCalendarError\", [{message: \"Invalid calendar settings, no worktime available\"}, calendar]);\n\t\t\treturn null;\n\t\t} else {\n\t\t\tvar config = this.$gantt.config;\n\n\t\t\tcalendar.id = calendar.id || utils.uid();\n\t\t\tthis._calendars[calendar.id] = calendar;\n\t\t\tif (!config.worktimes)\n\t\t\t\tconfig.worktimes = {};\n\t\t\tconfig.worktimes[calendar.id] = calendar.getConfig();\n\t\t\treturn calendar.id;\n\t\t}\n\t},\n\n\tdeleteCalendar: function (calendar) {\n\t\tvar config = this.$gantt.config;\n\t\tif (!calendar) return false;\n\t\tif (this._calendars[calendar]) {\n\t\t\tdelete this._calendars[calendar];\n\t\t\tif (config.worktimes && config.worktimes[calendar])\n\t\t\t\tdelete config.worktimes[calendar];\n\t\t\treturn true;\n\t\t} else {\n\t\t\treturn false;\n\t\t}\n\t},\n\n\trestoreConfigCalendars: function (configs) {\n\t\tfor (var i in configs) {\n\t\t\tif (this._calendars[i])\n\t\t\t\tcontinue;\n\n\t\t\tvar settings = configs[i];\n\t\t\tvar calendar = this.createCalendar(settings);\n\t\t\tcalendar.id = i;\n\t\t\tthis.addCalendar(calendar);\n\t\t}\n\t},\n\n\tdefaults: {\n\t\tglobal: {\n\t\t\tid: \"global\",\n\t\t\tworktime: {\n\t\t\t\thours: [8, 12, 13, 17],\n\t\t\t\tdays: [0, 1, 1, 1, 1, 1, 0]\n\t\t\t}\n\t\t},\n\t\tfulltime: {\n\t\t\tid: \"fulltime\",\n\t\t\tworktime: {\n\t\t\t\thours: [0, 24],\n\t\t\t\tdays: [1, 1, 1, 1, 1, 1, 1]\n\t\t\t}\n\t\t}\n\t},\n\n\tcreateDefaultCalendars: function () {\n\t\tvar config = this.$gantt.config;\n\t\tthis.restoreConfigCalendars(this.defaults);\n\t\tthis.restoreConfigCalendars(config.worktimes);\n\t},\n\n\tisCalendar: function(possibleCalendar) {\n\t\t// because we don't have any way to check without dependency to CalendarWorkTimeStrategy\n\t\tvar props = [\n\t\t\tpossibleCalendar.isWorkTime,\n\t\t\tpossibleCalendar.setWorkTime,\n\t\t\tpossibleCalendar.getWorkHours,\n\t\t\tpossibleCalendar.unsetWorkTime,\n\t\t\tpossibleCalendar.getClosestWorkTime,\n\t\t\tpossibleCalendar.calculateDuration,\n\t\t\tpossibleCalendar.hasDuration,\n\t\t\tpossibleCalendar.calculateEndDate\n\t\t];\n\t\treturn props.every(function(entry) {\n\t\t\treturn entry instanceof Function;\n\t\t});\n\t}\n};\n\nexport default CalendarManager;","export default function() {\n\tfunction getResourcesCalendarKey(resourceAssignments){\n\t\treturn resourceAssignments.map(function(res){\n\t\t\tif(res && res.resource_id){\n\t\t\t\treturn res.resource_id;\n\t\t\t} else {\n\t\t\t\treturn res;\n\t\t\t}\n\t\t}).sort().join(\"-\");\n\t}\n\n\tvar dynamicCalendars = {};\n\n\tfunction mergeResourceCalendars(resourceAssignments, manager){\n\t\treturn manager.mergeCalendars(resourceAssignments.map(function(assignment){\n\t\t\tvar resourceId = (assignment && assignment.resource_id) ? assignment.resource_id : assignment;\n\t\t\treturn manager.getResourceCalendar(resourceId);\n\t\t}));\n\t}\n\tfunction getCalendarIdFromMultipleResources(resourceAssignments, manager){\n\t\tvar key = getResourcesCalendarKey(resourceAssignments);\n\t\tif(!resourceAssignments.length){\n\t\t\treturn null;\n\t\t}else if(resourceAssignments.length === 1){\n\t\t\treturn manager.getResourceCalendar(key).id;\n\t\t}else if (dynamicCalendars[key]){\n\t\t\treturn dynamicCalendars[key].id;\n\t\t} else {\n\t\t\tvar tempCalendar = mergeResourceCalendars(resourceAssignments, manager);\n\n\t\t\tdynamicCalendars[key] = tempCalendar;\n\t\t\treturn manager.addCalendar(tempCalendar);\n\t\t}\n\t}\n\n\treturn {\n\t\tgetCalendarIdFromMultipleResources: getCalendarIdFromMultipleResources\n\t};\n};","function CalendarDisabledTimeStrategy(gantt, argumentsHelper){\n\tthis.argumentsHelper = argumentsHelper;\n\tthis.$gantt = gantt;\n}\n\nCalendarDisabledTimeStrategy.prototype = {\n\tgetWorkHours: function () {\n\t\treturn [0, 24];\n\t},\n\tsetWorkTime: function () {\n\t\treturn true;\n\t},\n\tunsetWorkTime: function () {\n\t\treturn true;\n\t},\n\tisWorkTime: function () {\n\t\treturn true;\n\t},\n\tgetClosestWorkTime: function (config) {\n\t\tvar config = this.argumentsHelper.getClosestWorkTimeArguments.apply(this.argumentsHelper, arguments);\n\t\treturn config.date;\n\t},\n\n\tcalculateDuration: function () {\n\t\tvar config = this.argumentsHelper.getDurationArguments.apply(this.argumentsHelper, arguments);\n\t\tvar from = config.start_date,\n\t\t\tto = config.end_date,\n\t\t\tunit = config.unit,\n\t\t\tstep = config.step;\n\n\t\treturn this._calculateDuration(from, to, unit, step);\n\t},\n\t_calculateDuration: function (start, end, unit, step) {\n\t\tvar dateHelper = this.$gantt.date;\n\t\tvar fixedUnits = {\n\t\t\t\"week\": 1000 * 60 * 60 * 24 * 7,\n\t\t\t\"day\": 1000 * 60 * 60 * 24,\n\t\t\t\"hour\": 1000 * 60 * 60,\n\t\t\t\"minute\": 1000 * 60\n\t\t};\n\n\t\tvar res = 0;\n\t\tif (fixedUnits[unit]) {\n\t\t\tres = Math.round((end - start) / (step * fixedUnits[unit]));\n\t\t} else {\n\t\t\tvar from = new Date(start),\n\t\t\t\tto = new Date(end);\n\t\t\twhile (from.valueOf() < to.valueOf()) {\n\t\t\t\tres += 1;\n\t\t\t\tfrom = dateHelper.add(from, step, unit);\n\t\t\t}\n\n\t\t\tif (from.valueOf() != end.valueOf()) {\n\t\t\t\tres += (to - from) / (dateHelper.add(from, step, unit) - from);\n\t\t\t}\n\t\t}\n\n\t\treturn Math.round(res);\n\t},\n\n\thasDuration: function () {\n\t\tvar config = this.argumentsHelper.getDurationArguments.apply(this.argumentsHelper, arguments);\n\t\tvar from = config.start_date,\n\t\t\tto = config.end_date,\n\t\t\tunit = config.unit;\n\n\t\tif (!unit) {\n\t\t\treturn false;\n\t\t}\n\t\tfrom = new Date(from);\n\t\tto = new Date(to);\n\n\t\treturn (from.valueOf() < to.valueOf());\n\t},\n\n\thasWorkTime: function() {\n\t\treturn true;\n\t},\n\n\tequals: function(calendar) {\n\t\tif(!(calendar instanceof CalendarDisabledTimeStrategy)){\n\t\t\treturn false;\n\t\t}\n\t\treturn true;\n\t},\n\n\tcalculateEndDate: function () {\n\t\tvar config = this.argumentsHelper.calculateEndDateArguments.apply(this.argumentsHelper, arguments);\n\n\t\tvar start = config.start_date,\n\t\t\tduration = config.duration,\n\t\t\tunit = config.unit,\n\t\t\tstep = config.step;\n\n\t\treturn this.$gantt.date.add(start, step * duration, unit);\n\t}\n};\n\nexport default CalendarDisabledTimeStrategy;","import createArgumentsHelper from \"./calendar_arguments_helper\";\nimport NoWorkTimeCalendar from \"./strategy/no_work_time\";\n\nfunction TimeCalculator(calendarManager){\n\n\tthis.$gantt = calendarManager.$gantt;\n\tthis.argumentsHelper = createArgumentsHelper(this.$gantt);\n\tthis.calendarManager = calendarManager;\n\tthis.$disabledCalendar = new NoWorkTimeCalendar(this.$gantt, this.argumentsHelper);\n}\n\nTimeCalculator.prototype = {\n\t_getCalendar: function (config) {\n\t\tvar calendar;\n\t\tif (!this.$gantt.config.work_time) {\n\t\t\tcalendar = this.$disabledCalendar;\n\t\t} else {\n\t\t\tvar manager = this.calendarManager;\n\t\t\tif (config.task) {\n\t\t\t\tcalendar = manager.getTaskCalendar(config.task);\n\t\t\t} else if (config.id) {\n\t\t\t\tcalendar = manager.getTaskCalendar(config);\n\t\t\t} else if (config.calendar) {\n\t\t\t\tcalendar = config.calendar;\n\t\t\t}\n\t\t\tif (!calendar) {\n\t\t\t\tcalendar = manager.getTaskCalendar();\n\t\t\t}\n\t\t}\n\t\treturn calendar;\n\t},\n\n\tgetWorkHours: function (config) {\n\t\tconfig = this.argumentsHelper.getWorkHoursArguments.apply(this.argumentsHelper, arguments);\n\n\t\tvar calendar = this._getCalendar(config);\n\n\t\treturn calendar.getWorkHours(config.date);\n\t},\n\n\tsetWorkTime: function (config, calendar) {\n\t\tconfig = this.argumentsHelper.setWorkTimeArguments.apply(this.argumentsHelper, arguments);\n\n\t\tif (!calendar)\n\t\t\tcalendar = this.calendarManager.getCalendar(); // Global\n\t\treturn calendar.setWorkTime(config);\n\t},\n\n\tunsetWorkTime: function (config, calendar) {\n\t\tconfig = this.argumentsHelper.unsetWorkTimeArguments.apply(this.argumentsHelper, arguments);\n\n\t\tif (!calendar)\n\t\t\tcalendar = this.calendarManager.getCalendar(); // Global\n\t\treturn calendar.unsetWorkTime(config);\n\t},\n\tisWorkTime: function (date, unit, task, calendar) {\n\t\tvar config = this.argumentsHelper.isWorkTimeArguments.apply(this.argumentsHelper, arguments);\n\n\t\tcalendar = this._getCalendar(config);\n\t\treturn calendar.isWorkTime(config);\n\t},\n\tgetClosestWorkTime: function (config) {\n\t\tconfig = this.argumentsHelper.getClosestWorkTimeArguments.apply(this.argumentsHelper, arguments);\n\n\t\tvar calendar = this._getCalendar(config);\n\n\t\treturn calendar.getClosestWorkTime(config);\n\t},\n\n\tcalculateDuration: function () { // start_date_date, end_date, task\n\t\tvar config = this.argumentsHelper.getDurationArguments.apply(this.argumentsHelper, arguments);\n\n\n\t\tvar calendar = this._getCalendar(config);\n\t\treturn calendar.calculateDuration(config);\n\t},\n\thasDuration: function () {\n\t\tvar config = this.argumentsHelper.hasDurationArguments.apply(this.argumentsHelper, arguments);\n\n\t\tvar calendar = this._getCalendar(config);\n\n\t\treturn calendar.hasDuration(config);\n\t},\n\tcalculateEndDate: function (config) { // start_date, duration, unit, task\n\t\tvar config = this.argumentsHelper.calculateEndDateArguments.apply(this.argumentsHelper, arguments);\n\n\t\tvar calendar = this._getCalendar(config);\n\t\treturn calendar.calculateEndDate(config);\n\t}\n};\n\nexport default TimeCalculator;\n\n","// TODO: rework public api for date methods\nimport * as utils from \"../../utils/utils\";\n\nvar createWorkTimeFacade = function(calendarManager, timeCalculator){\n\treturn {\n\t\tgetWorkHours: function (date) {\n\t\t\treturn timeCalculator.getWorkHours(date);\n\t\t},\n\n\t\tsetWorkTime: function (config) {\n\t\t\treturn timeCalculator.setWorkTime(config);\n\t\t},\n\n\t\tunsetWorkTime: function (config) {\n\t\t\ttimeCalculator.unsetWorkTime(config);\n\t\t},\n\n\t\tisWorkTime: function (date, unit, task) {\n\t\t\treturn timeCalculator.isWorkTime(date, unit, task);\n\t\t},\n\n\t\tgetClosestWorkTime: function (config) {\n\t\t\treturn timeCalculator.getClosestWorkTime(config);\n\t\t},\n\n\t\tcalculateDuration: function (start_date, end_date, task) {\n\t\t\treturn timeCalculator.calculateDuration(start_date, end_date, task);\n\t\t},\n\t\t_hasDuration: function (start_date, end_date, task) {\n\t\t\treturn timeCalculator.hasDuration(start_date, end_date, task);\n\t\t},\n\n\t\tcalculateEndDate: function (start, duration, unit, task) {\n\t\t\treturn timeCalculator.calculateEndDate(start, duration, unit, task);\n\t\t},\n\n\t\tmergeCalendars: utils.bind(calendarManager.mergeCalendars, calendarManager),\n\t\tcreateCalendar: utils.bind(calendarManager.createCalendar, calendarManager),\n\t\taddCalendar: utils.bind(calendarManager.addCalendar, calendarManager),\n\t\tgetCalendar: utils.bind(calendarManager.getCalendar, calendarManager),\n\t\tgetCalendars: utils.bind(calendarManager.getCalendars, calendarManager),\n\t\tgetResourceCalendar: utils.bind(calendarManager.getResourceCalendar, calendarManager),\n\t\tgetTaskCalendar: utils.bind(calendarManager.getTaskCalendar, calendarManager),\n\t\tdeleteCalendar: utils.bind(calendarManager.deleteCalendar, calendarManager)\n\t};\n};\n\n\nexport default { create: createWorkTimeFacade };","import * as helpers from \"../utils/helpers\";\n\nexport default function(gantt) {\n\n\tgantt.isUnscheduledTask = function (task) {\n\t\tgantt.assert(task && task instanceof Object, \"Invalid argument <b>task</b>=\"+task+\" of gantt.isUnscheduledTask. Task object was expected\");\n\t\treturn (!!task.unscheduled || !task.start_date);\n\t};\n\n\tgantt._isAllowedUnscheduledTask = function (task) {\n\t\treturn !!(task.unscheduled && gantt.config.show_unscheduled);\n\t};\n\n\tgantt._isTaskInTimelineLimits = function(task) {\n\t\tvar taskStart = task.start_date ? task.start_date.valueOf() : null;\n\t\tvar taskEnd = task.end_date ? task.end_date.valueOf() : null;\n\t\treturn !!(taskStart && taskEnd && taskStart <= this._max_date.valueOf() && taskEnd >= this._min_date.valueOf());\n\t};\n\tgantt.isTaskVisible = function (id) {\n\t\tif (!this.isTaskExists(id)) {\n\t\t\treturn false;\n\t\t}\n\n\t\tvar task = this.getTask(id);\n\t\tif (!(this._isAllowedUnscheduledTask(task) || this._isTaskInTimelineLimits(task))) {\n\t\t\treturn false;\n\t\t}\n\n\t\treturn !!(this.getGlobalTaskIndex(id) >= 0);\n\t};\n\n\tgantt._getProjectEnd = function() {\n\t\tif(gantt.config.project_end){\n\t\t\treturn gantt.config.project_end;\n\t\t}else{\n\t\t\tvar tasks = gantt.getTaskByTime();\n\t\t\ttasks = tasks.sort(function (a, b) {\n\t\t\t\treturn +a.end_date > +b.end_date ? 1 : -1;\n\t\t\t});\n\t\t\treturn tasks.length ? tasks[tasks.length - 1].end_date : null;\n\t\t}\n\t};\n\tgantt._getProjectStart = function() {\n\t\tif (gantt.config.project_start) {\n\t\t\treturn gantt.config.project_start;\n\t\t}\n\n\t\t// use timeline start if project start is not specified\n\t\tif (gantt.config.start_date) {\n\t\t\treturn gantt.config.start_date;\n\t\t}\n\t\tif (gantt.getState().min_date) {\n\t\t\treturn gantt.getState().min_date;\n\t\t}\n\n\t\t// earliest task start if neither project start nor timeline are specified\n\t\tvar tasks = gantt.getTaskByTime();\n\t\ttasks = tasks.sort(function (a, b) {\n\t\t\treturn +a.start_date > +b.start_date ? 1 : -1;\n\t\t});\n\t\treturn tasks.length ? tasks[0].start_date : null;\n\t};\n\n\tvar getDefaultTaskDate = function (item, parent_id) {\n\t\tvar parentExists = parent_id && parent_id != gantt.config.root_id && gantt.isTaskExists(parent_id);\n\t\tvar parent = parentExists ? gantt.getTask(parent_id) : false,\n\t\t\tstartDate = null;\n\t\tif (parent) {\n\t\t\tif(gantt.config.schedule_from_end){\n\t\t\t\tstartDate = gantt.calculateEndDate({\n\t\t\t\t\tstart_date: parent.end_date,\n\t\t\t\t\tduration: - gantt.config.duration_step,\n\t\t\t\t\ttask:item\n\t\t\t\t});\n\t\t\t}else{\n\t\t\t\tif(!parent.start_date){\n\t\t\t\t\treturn getDefaultTaskDate(parent, gantt.getParent(parent));\n\t\t\t\t}\n\t\t\t\tstartDate = parent.start_date;\n\t\t\t}\n\n\t\t} else if(gantt.config.schedule_from_end) {\n\t\t\tstartDate = gantt.calculateEndDate({\n\t\t\t\tstart_date: gantt._getProjectEnd(),\n\t\t\t\tduration: - gantt.config.duration_step,\n\t\t\t\ttask:item\n\t\t\t});\n\t\t} else {\n\t\t\tconst first = gantt.getTaskByIndex(0);\n\t\t\tconst minDate = gantt.config.start_date || gantt.getState().min_date;\n\n\t\t\tif (first){\n\t\t\t\tif (first.start_date){\n\t\t\t\t\tstartDate = first.start_date;\n\t\t\t\t}\n\t\t\t\telse if (first.end_date){\n\t\t\t\t\tstartDate = gantt.calculateEndDate({\n\t\t\t\t\t\tstart_date: first.end_date,\n\t\t\t\t\t\tduration: -gantt.config.duration_step,\n\t\t\t\t\t\ttask:item\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\tstartDate = minDate;\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tstartDate = minDate;\n\t\t\t}\n\t\t}\n\t\tgantt.assert(startDate, \"Invalid dates\");\n\t\treturn new Date(startDate);\n\t};\n\n\tgantt._set_default_task_timing = function (task) {\n\t\ttask.start_date = task.start_date || getDefaultTaskDate(task, gantt.getParent(task));\n\t\ttask.duration = task.duration || gantt.config.duration_step;\n\t\ttask.end_date = task.end_date || gantt.calculateEndDate(task);\n\t};\n\n\tgantt.createTask = function (item, parent, index) {\n\t\titem = item || {};\n\n\t\tif (!gantt.defined(item.id))\n\t\t\titem.id = gantt.uid();\n\n\t\tif (!item.start_date) {\n\t\t\titem.start_date = getDefaultTaskDate(item, parent);\n\t\t}\n\t\tif (item.text === undefined) {\n\t\t\titem.text = gantt.locale.labels.new_task;\n\t\t}\n\t\tif (item.duration === undefined) {\n\t\t\titem.duration = 1;\n\t\t}\n\n\t\tif (this.isTaskExists(parent)) {\n\t\t\tthis.setParent(item, parent, true);\n\t\t\tvar parentObj = this.getTask(parent);\n\t\t\tparentObj.$open = true;\n\t\t\t// GS-1583. Save the $open state to the Undo Stack\n\t\t\tif (!this.config.details_on_create){\n\t\t\t\tthis.callEvent(\"onAfterParentExpand\", [parent, parentObj]);\n\t\t\t}\n\t\t}\n\n\t\tif (!this.callEvent(\"onTaskCreated\", [item])) {\n\t\t\treturn null;\n\t\t}\n\t\tif (this.config.details_on_create) {\n\t\t\t//GS-761: assert unique ID\n\t\t\tif (gantt.isTaskExists(item.id)){\n\t\t\t\tvar task = gantt.getTask(item.id);\n\t\t\t\tif (task.$index != item.$index) {\n\t\t\t\t\t// Someone may try to mistakenly add a task with the same ID, and most likely\n\t\t\t\t\t// use the string format for the dates. Gantt shouldn't break in this scenario\n\t\t\t\t\tif (item.start_date && typeof item.start_date === \"string\"){\n\t\t\t\t\t\titem.start_date = this.date.parseDate(item.start_date, \"parse_date\");\n\t\t\t\t\t}\n\t\t\t\t\tif (item.end_date && typeof item.end_date === \"string\"){\n\t\t\t\t\t\titem.end_date = this.date.parseDate(item.end_date, \"parse_date\");\n\t\t\t\t\t}\n\t\t\t\t\tthis.$data.tasksStore.updateItem(item.id, item);\n\t\t\t\t}\n\t\t\t}\n\t\t\telse {\n\t\t\t\titem.$new = true;\n\t\t\t\tthis.silent(function(){\n\t\t\t\t\tgantt.$data.tasksStore.addItem(item, index);\n\t\t\t\t});\t\n\t\t\t}\n\t\t\tthis.selectTask(item.id);\n\t\t\tthis.refreshData();\n\t\t\tthis.showLightbox(item.id);\n\t\t} else {\n\t\t\tif (this.addTask(item, parent, index)) {\n\t\t\t\tthis.showTask(item.id);\n\t\t\t\tthis.selectTask(item.id);\n\t\t\t}\n\t\t}\n\t\treturn item.id;\n\t};\n\n\tgantt._update_flags = function (oldid, newid) {\n\t\t//  TODO: need a proper way to update all possible flags\n\t\tvar store = gantt.$data.tasksStore;\n\t\tif (oldid === undefined) {\n\t\t\tthis._lightbox_id = null;\n\n\t\t\tstore.silent(function(){\n\t\t\t\tstore.unselect();\n\t\t\t});\n\t\t\t// GS-1522. If we have multiselect, unselect all previously selected tasks\n\t\t\tif (this.getSelectedTasks) {\n\t\t\t\tthis._multiselect.reset();\n\t\t\t}\n\n\t\t\tif (this._tasks_dnd && this._tasks_dnd.drag) {\n\t\t\t\tthis._tasks_dnd.drag.id = null;\n\t\t\t}\n\t\t} else {\n\t\t\tif (this._lightbox_id == oldid)\n\t\t\t\tthis._lightbox_id = newid;\n\n\t\t\t// TODO: probably can be removed\n\t\t\tif (store.getSelectedId() == oldid) {\n\t\t\t\tstore.silent(function(){\n\t\t\t\t\tstore.unselect(oldid);\n\t\t\t\t\tstore.select(newid);\n\t\t\t\t});\n\t\t\t}\n\t\t\tif (this._tasks_dnd && this._tasks_dnd.drag && this._tasks_dnd.drag.id == oldid) {\n\t\t\t\tthis._tasks_dnd.drag.id = newid;\n\t\t\t}\n\t\t}\n\t};\n\n\tvar getTaskTimingMode = function (task, force) {\n\t\tvar task_type = gantt.getTaskType(task.type);\n\n\t\tvar state = {\n\t\t\ttype: task_type,\n\t\t\t$no_start: false,\n\t\t\t$no_end: false,\n\t\t\tscheduled_summary: false\n\t\t};\n\n\t\tif(task_type === gantt.config.types.project && task.auto_scheduling === false){\n\t\t\tstate.scheduled_summary = true;\n\t\t}\n\n\t\tif (!force && task_type == task.$rendered_type) {\n\t\t\tstate.$no_start = task.$no_start;\n\t\t\tstate.$no_end = task.$no_end;\n\t\t\treturn state;\n\t\t}\n\n\t\tif (task_type == gantt.config.types.project) {\n\t\t\t//project duration is always defined by children duration\n\t\t\tstate.$no_end = state.$no_start = true;\n\t\t} else if (task_type != gantt.config.types.milestone) {\n\t\t\t//tasks can have fixed duration, children duration(as projects), or one date fixed, and other defined by nested items\n\t\t\tstate.$no_end = !(task.end_date || task.duration);\n\t\t\tstate.$no_start = !task.start_date;\n\n\t\t\tif (gantt._isAllowedUnscheduledTask(task)) {\n\t\t\t\tstate.$no_end = state.$no_start = false;\n\t\t\t}\n\t\t}\n\n\t\treturn state;\n\t};\n\n\tgantt._init_task_timing = function (task) {\n\t\tvar task_mode = getTaskTimingMode(task, true);\n\n\t\tvar dirty = task.$rendered_type != task_mode.type;\n\n\t\tvar task_type = task_mode.type;\n\n\t\tif (dirty) {\n\t\t\ttask.$no_start = task_mode.$no_start;\n\t\t\ttask.$no_end = task_mode.$no_end;\n\t\t\ttask.$rendered_type = task_mode.type;\n\t\t}\n\n\t\tif (dirty && task_type != this.config.types.milestone) {\n\t\t\tif (task_type == this.config.types.project) {\n\t\t\t\t//project duration is always defined by children duration\n\t\t\t\tthis._set_default_task_timing(task);\n\t\t\t\ttask.$calculate_duration = false;// do not recalculate duration below\n\t\t\t}\n\t\t}\n\n\t\tif (task_type == this.config.types.milestone) {\n\t\t\ttask.end_date = task.start_date;\n\t\t}\n\t\tif (task.start_date && task.end_date && task.$calculate_duration !== false) {\n\t\t\ttask.duration = this.calculateDuration(task);\n\t\t}\n\n\t\tif(!task.$calculate_duration){\n\t\t\ttask.$calculate_duration = true;\n\t\t}\n\n\t\tif (!task.end_date) {\n\t\t\ttask.end_date = task.start_date;\n\t\t}\n\n\t\ttask.duration = task.duration || 0;\n\t\t// GS-1145. We should let tasks to have 0 duration if user wants it\n\t\tif (this.config.min_duration === 0 && task.duration === 0){\n\t\t\ttask.$no_end = false;\n\t\t}\n\n\t\t// work calendar of task has changed\n\t\tvar effectiveCalendar = this.getTaskCalendar(task);\n\t\tif(task.$effective_calendar && task.$effective_calendar !== effectiveCalendar.id){\n\t\t\tupdateTaskTiming(task);\n\t\t\tif(this.config.inherit_calendar && this.isSummaryTask(task)){\n\t\t\t\tthis.eachTask(function(child){\n\t\t\t\t\tupdateTaskTiming(child);\n\t\t\t\t}, task.id);\n\t\t\t}\n\t\t}\n\n\t\ttask.$effective_calendar = effectiveCalendar.id;\n\t};\n\n\tfunction updateTaskTiming(task) {\n\t\ttask.$effective_calendar = gantt.getTaskCalendar(task).id;\n\t\ttask.start_date = gantt.getClosestWorkTime({\n\t\t\tdir: \"future\",\n\t\t\tdate: task.start_date,\n\t\t\tunit: gantt.config.duration_unit,\n\t\t\ttask: task\n\t\t});\n\t\ttask.end_date = gantt.calculateEndDate(task);\n\t}\n\n\tgantt.isSummaryTask = function (task) {\n\t\tgantt.assert(task && task instanceof Object, \"Invalid argument <b>task</b>=\"+task+\" of gantt.isSummaryTask. Task object was expected\");\n\n\t\tvar mode = getTaskTimingMode(task);\n\n\t\treturn !!(mode.$no_end || mode.$no_start);\n\t};\n\n// downward calculation of project duration\n\tgantt.resetProjectDates = function (task) {\n\t\tvar taskMode = getTaskTimingMode(task);\n\t\tif (taskMode.$no_end || taskMode.$no_start) {\n\t\t\tvar info = getSubtaskInfo(task.id);\n\t\t\tassignProjectDates.call(this, task, taskMode, info.start_date, info.end_date);\n\t\t\ttask.$rollup = info.rollup;\n\t\t}\n\t};\n\n\tfunction assignProjectDates(task, taskTiming, from, to) {\n\n\t\tconst summaryDateFields = {\n\t\t\tstart: \"start_date\",\n\t\t\tend: \"end_date\"\n\t\t};\n\t\tconst manuallyScheduledSummaryDateFields = {\n\t\t\tstart: \"$auto_start_date\",\n\t\t\tend: \"$auto_end_date\"\n\t\t};\n\n\t\tlet dateFields;\n\t\tif(task.type === gantt.config.types.project && task.auto_scheduling === false){\n\t\t\tdateFields = manuallyScheduledSummaryDateFields;\n\t\t}else{\n\t\t\tdateFields = summaryDateFields;\n\t\t}\n\n\t\tif (taskTiming.$no_start) {\n\t\t\tif (from) {\n\t\t\t\ttask[dateFields.start] = new Date(from);\n\t\t\t} else {\n\t\t\t\ttask[dateFields.start] = getDefaultTaskDate(task, this.getParent(task));\n\t\t\t}\n\t\t}\n\n\t\tif (taskTiming.$no_end) {\n\t\t\tif (to) {\n\t\t\t\ttask[dateFields.end] = new Date(to);\n\t\t\t} else {\n\t\t\t\ttask[dateFields.end] = this.calculateEndDate({\n\t\t\t\t\tstart_date: task[dateFields.start],\n\t\t\t\t\tduration: this.config.duration_step,\n\t\t\t\t\ttask: task\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t\tif (taskTiming.$no_start || taskTiming.$no_end) {\n\t\t\tthis._init_task_timing(task);\n\t\t}\n\t}\n\n\tgantt.getSubtaskDuration = function (taskId) {\n\t\tvar res = 0,\n\t\t\troot = taskId !== undefined ? taskId : gantt.config.root_id;\n\n\t\tthis.eachTask(function (child) {\n\t\t\tif (this.getTaskType(child.type) == gantt.config.types.project || this.isUnscheduledTask(child))\n\t\t\t\treturn;\n\n\t\t\tres += child.duration;\n\t\t}, root);\n\n\t\treturn res;\n\t};\n\n\tfunction getSubtaskInfo (taskId){\n\t\tvar min = null,\n\t\t\tmax = null,\n\t\t\troot = taskId !== undefined ? taskId : gantt.config.root_id,\n\t\t\trollup = [];\n\n\t\tgantt.eachTask(function (child) {\n\t\t\tconst isScheduledSummary = (gantt.getTaskType(child.type) == gantt.config.types.project && (child.auto_scheduling === false));\n\t\t\tif ((gantt.getTaskType(child.type) == gantt.config.types.project && !isScheduledSummary) || gantt.isUnscheduledTask(child))\n\t\t\t\treturn;\n\t\t\t\n\t\t\tif(child.rollup){\n\t\t\t\trollup.push(child.id);\n\t\t\t}\n\n\t\t\tif ((child.start_date && (!child.$no_start || isScheduledSummary)) && (!min || min > child.start_date.valueOf()))\n\t\t\t\tmin = child.start_date.valueOf();\n\t\t\tif ((child.end_date && (!child.$no_end || isScheduledSummary)) && (!max || max < child.end_date.valueOf()))\n\t\t\t\tmax = child.end_date.valueOf();\n\t\t}, root);\n\n\t\treturn {\n\t\t\tstart_date: min ? new Date(min) : null,\n\t\t\tend_date: max ? new Date(max) : null,\n\t\t\trollup: rollup\n\t\t};\n\t}\n\n\tgantt.getSubtaskDates = function (task_id) {\n\t\tvar info = getSubtaskInfo(task_id);\n\t\treturn {\n\t\t\tstart_date: info.start_date,\n\t\t\tend_date: info.end_date\n\t\t};\n\t};\n\n\n// upward calculation of project duration\n\tgantt._update_parents = function (taskId, silent, updateAll) {\n\t\tif (!taskId) return;\n\n\t\tvar task = this.getTask(taskId);\n\t\tif(task.rollup){\n\t\t\tupdateAll = true;\n\t\t}\n\t\tvar pid = this.getParent(task);\n\n\t\tvar taskTiming = getTaskTimingMode(task);\n\n\t\tvar has_changed = true;\n\t\t// GS-761 the dates check is necessary for adding empty tasks: gantt.addTask({id:\"2\"})\n\t\tif (updateAll || (task.start_date && task.end_date && (taskTiming.$no_start || taskTiming.$no_end))) {\n\n\t\t\tconst startDateField = task.$auto_start_date ? \"$auto_start_date\" : \"start_date\";\n\t\t\tconst endDateField = task.$auto_end_date ? \"$auto_end_date\" : \"end_date\";\n\n\t\t\tvar oldStart = task[startDateField].valueOf(),\n\t\t\t\toldEnd = task[endDateField].valueOf();\n\n\t\t\tgantt.resetProjectDates(task);\n\n\t\t\t// not refresh parent projects if dates hasn't changed\n\t\t\tif (!updateAll && oldStart == task[startDateField].valueOf() && oldEnd == task[endDateField].valueOf()) {\n\t\t\t\thas_changed = false;\n\t\t\t}\n\n\t\t\tif (has_changed && !silent) {\n\t\t\t\tthis.refreshTask(task.id, true);\n\t\t\t}\n\n\t\t\tif(taskTiming.scheduled_summary){\n\t\t\t\thas_changed = true;//recalculate upwards from scheduled summaries\n\t\t\t}\n\t\t}\n\n\n\t\tif (has_changed && pid && this.isTaskExists(pid)) {\n\t\t\tthis._update_parents(pid, silent, updateAll);\n\t\t}\n\t};\n\n\tgantt.roundDate = function (config) {\n\t\tvar scale = gantt.getScale();\n\n\t\tif (helpers.isDate(config)) {\n\t\t\tconfig = {\n\t\t\t\tdate: config,\n\t\t\t\tunit: scale ? scale.unit : gantt.config.duration_unit,\n\t\t\t\tstep: scale ?  scale.step : gantt.config.duration_step\n\t\t\t};\n\t\t}\n\t\tvar date = config.date,\n\t\t\tsteps = config.step,\n\t\t\tunit = config.unit;\n\n\t\tif(!scale){\n\t\t\treturn date;\n\t\t}\n\n\t\tvar upper, lower, colIndex;\n\t\tif (unit == scale.unit && steps == scale.step &&\n\t\t\t+date >= +scale.min_date && +date <= +scale.max_date) {\n\t\t\t//find date in time scale config\n\t\t\tcolIndex = Math.floor(gantt.columnIndexByDate(date));\n\n\t\t\tif (!scale.trace_x[colIndex]) {\n\t\t\t\tcolIndex -= 1;// end of time scale\n\t\t\t\tif(scale.rtl){\n\t\t\t\t\tcolIndex = 0;\n\t\t\t\t}\n\t\t\t}\n\t\t\tlower = new Date(scale.trace_x[colIndex]);\n\t\t\tupper = gantt.date.add(lower, steps, unit);\n\t\t} else {\n\t\t\tcolIndex = Math.floor(gantt.columnIndexByDate(date));\n\n\t\t\tupper = gantt.date[unit + \"_start\"](new Date(scale.min_date));\n\t\t\tif (scale.trace_x[colIndex]) {\n\t\t\t\tupper = gantt.date[unit + \"_start\"](scale.trace_x[colIndex]);// end of time scale\n\t\t\t}\n\n\t\t\twhile (+upper < +date) {\n\t\t\t\tupper = gantt.date[unit + \"_start\"](gantt.date.add(upper, steps, unit));\n\n\t\t\t\tvar tzOffset = upper.getTimezoneOffset();\n\n\t\t\t\tupper = gantt._correct_dst_change(upper, tzOffset, upper, unit);\n\t\t\t\tif (gantt.date[unit + '_start'])\n\t\t\t\t\tupper = gantt.date[unit + '_start'](upper);\n\t\t\t}\n\n\t\t\tlower = gantt.date.add(upper, -1 * steps, unit);\n\n\t\t}\n\t\tif (config.dir && config.dir == 'future')\n\t\t\treturn upper;\n\t\tif (config.dir && config.dir == 'past')\n\t\t\treturn lower;\n\n\t\tif (Math.abs(date - lower) < Math.abs(upper - date)) {\n\t\t\treturn lower;\n\t\t} else {\n\t\t\treturn upper;\n\t\t}\n\n\t};\n\n\tgantt.correctTaskWorkTime = function (task) {\n\t\tif (gantt.config.work_time && gantt.config.correct_work_time) {\n\t\t\tif (!this.isWorkTime(task.start_date, undefined, task)) {\n\t\t\t\ttask.start_date = this.getClosestWorkTime({date: task.start_date, dir: 'future', task: task});\n\t\t\t\ttask.end_date = this.calculateEndDate(task);\n\t\t\t} else if (!this.isWorkTime(new Date(+task.end_date - 1), undefined, task)) {\n\t\t\t\ttask.end_date = this.calculateEndDate(task);\n\t\t\t}\n\t\t}\n\t};\n\n\tgantt.attachEvent(\"onBeforeTaskUpdate\", function (id, task) {\n\t\tgantt._init_task_timing(task);\n\t\treturn true;\n\t});\n\tgantt.attachEvent(\"onBeforeTaskAdd\", function (id, task) {\n\t\tgantt._init_task_timing(task);\n\t\treturn true;\n\t});\n\n\tgantt.attachEvent(\"onAfterTaskMove\", function (id, parent, tindex) {\n\t\tgantt._init_task_timing(gantt.getTask(id));\n\t\treturn true;\n\t});\n\n};","function addResizeListener(gantt){\n\tvar containerStyles = window.getComputedStyle(gantt.$root);\n\tif(containerStyles.getPropertyValue(\"position\") == \"static\"){\n\t\tgantt.$root.style.position = \"relative\";\n\t}\n\n\tvar resizeWatcher = document.createElement('iframe');\n\tresizeWatcher.className = \"gantt_container_resize_watcher\";\n\tresizeWatcher.tabIndex = -1;\n\tif(gantt.config.wai_aria_attributes){\n\t\tresizeWatcher.setAttribute(\"role\", \"none\");\n\t\tresizeWatcher.setAttribute(\"aria-hidden\", true);\n\t}\n\n\tvar salesforce_environment = !!window[\"Sfdc\"] || !!window[\"$A\"] || window[\"Aura\"];\n\tif (salesforce_environment){\n\t\tgantt.config.container_resize_method = \"timeout\";\n\t}\n\n\t// in some environments (namely, in SalesForce) iframe.contentWindow is not available\n\tgantt.$root.appendChild(resizeWatcher);\n\tif (resizeWatcher.contentWindow) {\n\t\tlistenWindowResize(gantt, resizeWatcher.contentWindow);\n\t} else {\n\t\t// if so - ditch the iframe and fallback to listening the main window resize\n\t\tgantt.$root.removeChild(resizeWatcher);\n\t\tlistenWindowResize(gantt, window);\n\t}\n}\n\nfunction listenWindowResize(gantt, window){\n\tvar resizeTimeout = gantt.config.container_resize_timeout || 20;\n\tvar resizeDelay;\n\tlet previousSize = getContainerSize(gantt);\n\n\tif (gantt.config.container_resize_method == \"timeout\"){\n\t\tlowlevelResizeWatcher();\n\t}\n\telse {\n\t\ttry {\n\t\t\tgantt.event(window, \"resize\", function () {\n\t\t\t\tif (gantt.$scrollbarRepaint) {\n\t\t\t\t\tgantt.$scrollbarRepaint = null;\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\t// GS-2140. Don't repaint Gantt if it has the same sizes\n\t\t\t\t\tlet currentSize = getContainerSize(gantt);\n\t\t\t\t\tif (previousSize.x == currentSize.x && previousSize.y == currentSize.y){\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t\tpreviousSize = currentSize;\n\t\t\t\t\trepaintGantt();\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t\tcatch (e) {\n\t\t\tlowlevelResizeWatcher();\n\t\t}\n\t}\n\n\tfunction repaintGantt(){\n\t\tclearTimeout(resizeDelay);\n\t\tresizeDelay = setTimeout(function(){\n\t\t\tif(!gantt.$destroyed){\n\t\t\t\tgantt.render();\n\t\t\t}\n\t\t}, resizeTimeout);\n\t}\n\n\tvar previousHeight = gantt.$root.offsetHeight;\n\tvar previousWidth = gantt.$root.offsetWidth;\t\n\n\tfunction lowlevelResizeWatcher(){\n\t\tif (gantt.$root.offsetHeight != previousHeight ||\n\t\t\t\tgantt.$root.offsetWidth != previousWidth){\n\t\t\t\trepaintGantt();\n\t\t}\n\n\t\tpreviousHeight = gantt.$root.offsetHeight;\n\t\tpreviousWidth = gantt.$root.offsetWidth;\n\n\t\tsetTimeout(lowlevelResizeWatcher, resizeTimeout);\n\t}\n}\n\nfunction getContainerSize(gantt){\n\treturn {\n\t\tx: gantt.$root.offsetWidth,\n\t\ty: gantt.$root.offsetHeight\n\t};\n}\n\nexport default addResizeListener;","import * as domHelpers from \"./ui/utils/dom_helpers\";\nimport * as helpers from \"../utils/helpers\";\nimport isHeadless from \"../utils/is_headless\";\nimport addResizeListener from \"./ui/resize_listener\";\nimport calculateScaleRange from \"./gantt_data_range\";\nimport assert from \"./common/assert\";\n\nexport default function(gantt){\n\t\n\n\tgantt.assert = assert(gantt);\n\n\tfunction isHTMLElement(node){\n\t\ttry {\n\t\t\tnode.cloneNode(false);\n\t\t}\n\t\tcatch (e){\n\t\t\treturn false;\n\t\t}\n\n\t\treturn true;\n\n\t}\n\n\tvar invalidContainerMessage = \"Invalid value of the first argument of `gantt.init`. Supported values: HTMLElement, String (element id).\" +\n\t\"This error means that either invalid object is passed into `gantt.init` or that the element with the specified ID doesn't exist on the page when `gantt.init` is called.\";\n\n\tfunction validateNode(node){\n\t\tif (!node || (typeof node == 'string' && document.getElementById(node))) return true;\n\t\tif (isHTMLElement(node)) return true;\n\n\t\tgantt.assert(false, invalidContainerMessage);\n\t\tthrow new Error(invalidContainerMessage);\n\t}\n\n//initial initialization\n\tgantt.init = function(node, from, to){\n\t\tif (gantt.env.isNode) { \n\t\t\tnode = null; // for the nodejs version\n\t\t} else {\n\t\t\tvalidateNode(node); // for the web version\n\t\t}\n\n\t\tif(from && to){\n\t\t\tthis.config.start_date = this._min_date = new Date(from);\n\t\t\tthis.config.end_date = this._max_date = new Date(to);\n\t\t}\n\t\tthis.date.init();\n\n\t\t//can be called only once\n\t\tthis.init = function(node){\n\t\t\tif (gantt.env.isNode) { \n\t\t\t\tnode = null; // for the nodejs version\n\t\t\t} else {\n\t\t\t\tvalidateNode(node); // for the web version\n\t\t\t}\n\n\t\t\tif (this.$container && this.$container.parentNode){\n\t\t\t\tthis.$container.parentNode.removeChild(this.$container);\n\t\t\t\tthis.$container = null;\n\t\t\t}\n\n\t\t\tif(this.$layout){\n\t\t\t\tthis.$layout.clear();\n\t\t\t}\n\t\t\tthis._reinit(node);\n\t\t};\n\t\tthis._reinit(node);\n\t};\n\n\tgantt._quickRefresh = function(code){\n\t\tvar stores = this._getDatastores.call(this);\n\t\tfor(var i = 0; i < stores.length; i++){\n\t\t\tstores[i]._quick_refresh = true;\n\t\t}\n\n\t\tcode();\n\n\t\tfor(var i = 0; i < stores.length; i++){\n\t\t\tstores[i]._quick_refresh = false;\n\t\t}\n\t};\n\n\tvar dropLayout = (function dropLayout(){\n\t\tif(this._clearTaskLayers){\n\t\t\tthis._clearTaskLayers();\n\t\t}\n\n\t\tif(this._clearLinkLayers){\n\t\t\tthis._clearLinkLayers();\n\t\t}\n\n\t\tif(this.$layout){\n\t\t\tthis.$layout.destructor();\n\t\t\tthis.$layout = null;\n\t\t\tthis.$ui.reset();\n\t\t}\n\t}).bind(gantt);\n\n\tvar rebuildLayout = (function rebuildLayout(){\n\t\tif(isHeadless(gantt)){\n\t\t\treturn;\n\t\t}\n\n\t\tthis.$root.innerHTML = \"\";\n\n\t\tthis.$root.gantt = this;\n\t\tcalculateScaleRange(this);\n\t\tthis.config.layout.id = \"main\";\n\t\tthis.$layout = this.$ui.createView(\"layout\", this.$root, this.config.layout);\n\n\t\tthis.$layout.attachEvent(\"onBeforeResize\", function(){\n\t\t\tvar storeNames = gantt.$services.getService(\"datastores\");\n\t\t\tfor(var i = 0; i < storeNames.length; i++){\n\t\t\t\tgantt.getDatastore(storeNames[i]).filter();\n\t\t\t\tif (gantt.$data.tasksStore._skipTaskRecalculation){\n\t\t\t\t\t// do not repaint items, they will be repainted later in the onStoreUpdate event\n\t\t\t\t\tif (gantt.$data.tasksStore._skipTaskRecalculation != \"lightbox\"){\n\t\t\t\t\t\tgantt.$data.tasksStore._skipTaskRecalculation = false;\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t} else {\n\t\t\t\t\tgantt.getDatastore(storeNames[i]).callEvent(\"onBeforeRefreshAll\", []);\t\t\t\t\t\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n\t\tthis.$layout.attachEvent(\"onResize\", function(){\n\t\t\tgantt._quickRefresh(function(){\n\t\t\t\tgantt.refreshData();\n\t\t\t});\n\t\t});\n\n\t\tthis.callEvent(\"onGanttLayoutReady\", []);\n\t\tthis.$layout.render();\n\n\t\tthis.$container = this.$layout.$container.firstChild;\n\n\t\taddResizeListener(this);\n\t}).bind(gantt);\n\n\tgantt.resetLayout = function(){\n\t\tdropLayout();\n\t\trebuildLayout();\n\t\tthis.render();\n\t};\n\n\tgantt._reinit = function(node){\n\t\tthis.callEvent(\"onBeforeGanttReady\", []);\n\t\tthis._update_flags();\n\n\t\tvar config = this.$services.getService(\"templateLoader\");\n\t\tconfig.initTemplates(this);\n\n\t\tdropLayout();\n\n\t\tthis.$root = null;\n\t\tif(node){\n\t\t\tthis.$root = domHelpers.toNode(node);\n\t\t\trebuildLayout();\n\t\t\tthis.$mouseEvents.reset(this.$root);\n\t\t\taddMinimalSizes(gantt);\n\t\t}\n\n\t\tthis.callEvent(\"onTemplatesReady\",[]);\n\n\t\tthis.callEvent(\"onGanttReady\", []);\n\n\t\tthis.render();\n\t};\n\n\tfunction addMinimalSizes(gantt) {\n\t\tif (gantt.$container && !gantt.config.autosize) {\n\t\t\tif (gantt.$root.offsetHeight < 50) {\n\t\t\t\t// eslint-disable-next-line no-console\n\t\t\t\tconsole.warn(`The Gantt container has a small height, so you cannot see its content. If it is not intended, you need to set the 'height' style rule to the container:\nhttps://docs.dhtmlx.com/gantt/faq.html#theganttchartisntrenderedcorrectly`);\n\t\t\t}\n\t\t}\n\t}\n\n\tgantt.$click={\n\t\tbuttons:{\n\t\t\t\"edit\": function(id) {\n\t\t\t\tif (gantt.isReadonly(gantt.getTask(id))) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tgantt.showLightbox(id);\n\t\t\t},\n\t\t\t\"delete\": function(id) {\n\t\t\t\tvar task = gantt.getTask(id);\n\t\t\t\tif (gantt.isReadonly(task)) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tvar question = gantt.locale.labels.confirm_deleting;\n\t\t\t\tvar title = gantt.locale.labels.confirm_deleting_title;\n\n\t\t\t\tgantt._simple_confirm(question, title, function(){\n\t\t\t\t\tif(!gantt.isTaskExists(id)){\n\t\t\t\t\t\tgantt.hideLightbox();\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tif(task.$new){\n\t\t\t\t\t\t// GS-2170. Do not recalculate the indexes and dates of other tasks\n\t\t\t\t\t\t// as they will be recalculated in the `refreshData`\n\t\t\t\t\t\tgantt.$data.tasksStore._skipTaskRecalculation = \"lightbox\";\n\t\t\t\t\t\tgantt.silent(function(){\n\t\t\t\t\t\t\tgantt.deleteTask(id, true);\n\t\t\t\t\t\t});\n\t\t\t\t\t\tgantt.$data.tasksStore._skipTaskRecalculation = false;\n\t\t\t\t\t\tgantt.refreshData();\n\t\t\t\t\t}else{\n\t\t\t\t\t\tgantt.$data.tasksStore._skipTaskRecalculation = true;\n\t\t\t\t\t\tgantt.deleteTask(id);\n\t\t\t\t\t}\n\n\t\t\t\t\tgantt.hideLightbox();\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t};\n\n//renders self\n\tgantt.render = function(){\n\t\tthis.callEvent(\"onBeforeGanttRender\", []);\n\n\t\tvar visibleDate;\n\t\tif(!isHeadless(gantt)){\n\t\t\tif (!this.config.sort && this._sort) {\n\t\t\t\tthis._sort = undefined;\n\t\t\t}\n\n\t\t\tif(this.$root){\n\t\t\t\tif(this.config.rtl){\n\t\t\t\t\tthis.$root.classList.add(\"gantt_rtl\");\n\t\t\t\t\tthis.$root.firstChild.classList.add(\"gantt_rtl\"); // GS-1499\n\t\t\t\t}else{\n\t\t\t\t\tthis.$root.classList.remove(\"gantt_rtl\");\n\t\t\t\t\tthis.$root.firstChild.classList.remove(\"gantt_rtl\"); // GS-1499\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tvar pos = this.getScrollState();\n\t\t\tvar posX = pos ? pos.x : 0;\n\t\t\tif(this._getHorizontalScrollbar()){\n\t\t\t\tvar scrollbar = this._getHorizontalScrollbar();\n\t\t\t\tposX = scrollbar.$config.codeScrollLeft || posX || 0;\n\t\t\t}\n\n\n\t\t\tvisibleDate = null;\n\t\t\tif(posX){\n\t\t\t\tvisibleDate = gantt.dateFromPos(posX + this.config.task_scroll_offset);\n\t\t\t}\n\t\t}\n\n\t\tcalculateScaleRange(this);\n\n\t\tif(!isHeadless(gantt)){\n\t\t\tthis.$layout.$config.autosize = this.config.autosize;\n\t\t\tvar preserveScroll = this.config.preserve_scroll;\n\t\t\tthis.config.preserve_scroll = false; // prevent scrolling from layout resize, scroll will be called here later on\n\t\t\tthis.$layout.resize();\n\t\t\tthis.config.preserve_scroll = preserveScroll;\n\n\t\t\tif(this.config.preserve_scroll && pos){\n\n\t\t\t\t// GS-1640: We need pos.y, otherwise part of the timeline won't be rendered if the scrollbar disappeared\n\t\t\t\tif (posX || pos.y) {\n\t\t\t\t\tvar new_pos = gantt.getScrollState();\n\t\t\t\t\tvar new_date = gantt.dateFromPos(new_pos.x);\n\t\t\t\t\tif(!(+visibleDate == +new_date && new_pos.y == pos.y)){\n\t\t\t\t\t\tvar posX = null;\n\t\t\t\t\t\tvar posY = null;\n\t\t\t\t\t\tif(visibleDate){\n\t\t\t\t\t\t\tvar posX = Math.max(gantt.posFromDate(visibleDate) - gantt.config.task_scroll_offset, 0);\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif(pos.y){\n\t\t\t\t\t\t\tposY = pos.y;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tgantt.scrollTo(posX, posY);\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\t// GS-1640: We need to reset the scroll position for the grid if the scrollbar disappeared and\n\t\t\t\t// the grid and timeline have different scrollbars\n\t\t\t\tvar gridCell = gantt.$ui.getView(\"grid\");\n\t\t\t\tif (gridCell) {\n\t\t\t\t\tvar attachedScrollbar = gridCell.$config.scrollY;\n\t\t\t\t\tvar verticalScrollbar = gantt.$ui.getView(attachedScrollbar);\n\t\t\t\t\tif (verticalScrollbar) {\n\t\t\t\t\t\tvar scrollbarNodeVisible = gantt.utils.dom.isChildOf(verticalScrollbar.$view, gantt.$container);\n\t\t\t\t\t\tif (!scrollbarNodeVisible) {\n\t\t\t\t\t\t\tgridCell.scrollTo(undefined, 0);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t}else{\n\t\t\tgantt.refreshData();\n\t\t}\n\t\tthis.callEvent(\"onGanttRender\", []);\n\t};\n\n\t//TODO: add layout.resize method that wouldn't trigger data repaint\n\tgantt.setSizes = gantt.render;\n\n\n\tgantt.getTaskRowNode = function(id) {\n\t\tvar els = this.$grid_data.childNodes;\n\t\tvar attribute = this.config.task_attribute;\n\t\tfor (var i = 0; i < els.length; i++) {\n\t\t\tif (els[i].getAttribute) {\n\t\t\t\tvar value = els[i].getAttribute(attribute);\n\t\t\t\tif (value == id) return els[i];\n\t\t\t}\n\t\t}\n\t\treturn null;\n\t};\n\n\tgantt.changeLightboxType = function(type){\n\t\tif(this.getLightboxType() == type)\n\t\t\treturn true;\n\t\tgantt._silent_redraw_lightbox(type);\n\t};\n\n\tgantt._get_link_type = function (from_start, to_start) {\n\t\tvar type = null;\n\t\tif (from_start && to_start) {\n\t\t\ttype = gantt.config.links.start_to_start;\n\t\t} else if (!from_start && to_start) {\n\t\t\ttype = gantt.config.links.finish_to_start;\n\t\t} else if (!from_start && !to_start) {\n\t\t\ttype = gantt.config.links.finish_to_finish;\n\t\t} else if (from_start && !to_start) {\n\t\t\ttype = gantt.config.links.start_to_finish;\n\t\t}\n\t\treturn type;\n\t};\n\n\tgantt.isLinkAllowed = function (from, to, from_start, to_start) {\n\t\tvar link = null;\n\t\tif (typeof(from) == \"object\") {\n\t\t\tlink = from;\n\t\t} else {\n\t\t\tlink = {source: from, target: to, type: this._get_link_type(from_start, to_start)};\n\t\t}\n\n\t\tif (!link) return false;\n\t\tif (!(link.source && link.target && link.type)) return false;\n\t\tif (link.source == link.target) return false;\n\n\t\tvar res = true;\n\t\t//any custom rules\n\t\tif (this.checkEvent(\"onLinkValidation\"))\n\t\t\tres = this.callEvent(\"onLinkValidation\", [link]);\n\n\t\treturn res;\n\t};\n\n\n\tgantt._correct_dst_change = function(date, prevOffset, step, unit){\n\t\tvar time_unit = helpers.getSecondsInUnit(unit) * step;\n\t\tif(time_unit > 60*60 && time_unit < 60*60*24){\n\t\t\t//correct dst change only if current unit is more than one hour and less than day (days have own checking), e.g. 12h\n\t\t\tvar offsetChanged = date.getTimezoneOffset() - prevOffset;\n\t\t\tif(offsetChanged){\n\t\t\t\tdate = gantt.date.add(date, offsetChanged, \"minute\");\n\t\t\t}\n\t\t}\n\t\treturn date;\n\t};\n\n\tgantt.isSplitTask = function(task){\n\t\tgantt.assert(task && task instanceof Object, \"Invalid argument <b>task</b>=\"+task+\" of gantt.isSplitTask. Task object was expected\");\n\t\treturn this.$data.tasksStore._isSplitItem(task);\n\t};\n\n\tgantt._is_icon_open_click = function(e) {\n\t\tif (!e)\n\t\t\treturn false;\n\t\tvar target = e.target || e.srcElement;\n\t\tif (!(target && target.className))\n\t\t\treturn false;\n\t\tvar className = domHelpers.getClassName(target);\n\t\tif (className.indexOf(\"gantt_tree_icon\") !== -1 && (className.indexOf(\"gantt_close\") !== -1 || className.indexOf(\"gantt_open\") !== -1))\n\t\t\treturn true;\n\t\treturn false;\n\t};\n\n};","/*\n \tasserts will be removed in final code, so you can place them anythere\n\twithout caring about performance impacts\n*/\n\nexport default function(gantt){\n\treturn function assert(check, message){\n\t\tif (!check){\n\t\t\tif(gantt.config.show_errors && gantt.callEvent(\"onError\",[message]) !== false) {\n\t\t\t\tif (gantt.message) {\n\t\t\t\t\tgantt.message({type: \"error\", text: message, expire: -1});\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\t// eslint-disable-next-line\n\t\t\t\t\tconsole.log(message);\n\t\t\t\t}\n\n\t\t\t\t// eslint-disable-next-line no-debugger\n\t\t\t\tdebugger;\n\t\t\t}\n\t\t}\n\t};\n};","const locale: IGanttLocale = {\n\tdate: {\n\t\tmonth_full: [\"كانون الثاني\", \"شباط\", \"آذار\", \"نيسان\", \"أيار\", \"حزيران\", \"تموز\", \"آب\", \"أيلول\", \"تشرين الأول\", \"تشرين الثاني\", \"كانون الأول\"],\n\t\tmonth_short: [\"يناير\", \"فبراير\", \"مارس\", \"أبريل\", \"مايو\", \"يونيو\", \"يوليو\", \"أغسطس\", \"سبتمبر\", \"أكتوبر\", \"نوفمبر\", \"ديسمبر\"],\n\t\tday_full: [\"الأحد\", \"الأثنين\", \"ألثلاثاء\", \"الأربعاء\", \"ألحميس\", \"ألجمعة\", \"السبت\"],\n\t\tday_short: [\"احد\", \"اثنين\", \"ثلاثاء\", \"اربعاء\", \"خميس\", \"جمعة\", \"سبت\"]\n\t},\n\tlabels: {\n\t\tnew_task: \"مهمة جديد\",\n\t\ticon_save: \"اخزن\",\n\t\ticon_cancel: \"الغاء\",\n\t\ticon_details: \"تفاصيل\",\n\t\ticon_edit: \"تحرير\",\n\t\ticon_delete: \"حذف\",\n\t\tconfirm_closing: \"التغييرات سوف تضيع, هل انت متأكد؟\", // Your changes will be lost, are your sure ?\n\t\tconfirm_deleting: \"الحدث سيتم حذفها نهائيا ، هل أنت متأكد؟\",\n\t\tsection_description: \"الوصف\",\n\t\tsection_time: \"الفترة الزمنية\",\n\t\tsection_type: \"Type\",\n\t\tsection_deadline: \"Deadline\",\n\t\tsection_baselines: \"Baselines\",\n\t\t/* grid columns */\n\n\t\tcolumn_wbs: \"WBS\",\n\t\tcolumn_text: \"Task name\",\n\t\tcolumn_start_date: \"Start time\",\n\t\tcolumn_duration: \"Duration\",\n\t\tcolumn_add: \"\",\n\n\t\t/* link confirmation */\n\t\tlink: \"Link\",\n\t\tconfirm_link_deleting: \"will be deleted\",\n\t\tlink_start: \" (start)\",\n\t\tlink_end: \" (end)\",\n\n\t\ttype_task: \"Task\",\n\t\ttype_project: \"Project\",\n\t\ttype_milestone: \"Milestone\",\n\n\t\tminutes: \"Minutes\",\n\t\thours: \"Hours\",\n\t\tdays: \"Days\",\n\t\tweeks: \"Week\",\n\t\tmonths: \"Months\",\n\t\tyears: \"Years\",\n\n\t\t/* message popup */\n\t\tmessage_ok: \"OK\",\n\t\tmessage_cancel: \"الغاء\",\n\n\t\t/* constraints */\n\t\tsection_constraint: \"Constraint\",\n\t\tconstraint_type: \"Constraint type\",\n\t\tconstraint_date: \"Constraint date\",\n\t\tasap: \"As Soon As Possible\",\n\t\talap: \"As Late As Possible\",\n\t\tsnet: \"Start No Earlier Than\",\n\t\tsnlt: \"Start No Later Than\",\n\t\tfnet: \"Finish No Earlier Than\",\n\t\tfnlt: \"Finish No Later Than\",\n\t\tmso: \"Must Start On\",\n\t\tmfo: \"Must Finish On\",\n\n\t\t/* resource control */\n\t\tresources_filter_placeholder: \"type to filter\",\n\t\tresources_filter_label: \"hide empty\",\n\n\t\t/* empty state screen */\n\t\tempty_state_text_link: \"Click here\",\n\t\tempty_state_text_description: \"to create your first task\",\n\n\t\t/* baselines control */\n\t\tbaselines_section_placeholder: \"Start adding a new baseline\",\n\t\tbaselines_add_button: \"Add Baseline\",\n\t\tbaselines_remove_button: \"Remove\",\n\t\tbaselines_remove_all_button: \"Remove All\",\n\n\t\t/* deadline control */\n\t\tdeadline_enable_button: \"Set\",\n\t\tdeadline_disable_button: \"Remove\"\n\t}\n};\n\nexport default locale;\n","const locale: IGanttLocale = {\n\tdate: {\n\t\tmonth_full: [\"Студзень\", \"Люты\", \"Сакавік\", \"Красавік\", \"Maй\", \"Чэрвень\", \"Ліпень\", \"Жнівень\", \"Верасень\", \"Кастрычнік\", \"Лістапад\", \"Снежань\"],\n\t\tmonth_short: [\"Студз\", \"Лют\", \"Сак\", \"Крас\", \"Maй\", \"Чэр\", \"Ліп\", \"Жнів\", \"Вер\", \"Каст\", \"Ліст\", \"Снеж\"],\n\t\tday_full: [\"Нядзеля\", \"Панядзелак\", \"Аўторак\", \"Серада\", \"Чацвер\", \"Пятніца\", \"Субота\"],\n\t\tday_short: [\"Нд\", \"Пн\", \"Аўт\", \"Ср\", \"Чцв\", \"Пт\", \"Сб\"]\n\t},\n\tlabels: {\n\t\tnew_task: \"Новае заданне\",\n\t\ticon_save: \"Захаваць\",\n\t\ticon_cancel: \"Адмяніць\",\n\t\ticon_details: \"Дэталі\",\n\t\ticon_edit: \"Змяніць\",\n\t\ticon_delete: \"Выдаліць\",\n\t\tconfirm_closing: \"\", // Унесеныя змены будуць страчаны, працягнуць?\n\t\tconfirm_deleting: \"Падзея будзе выдалена незваротна, працягнуць?\",\n\t\tsection_description: \"Апісанне\",\n\t\tsection_time: \"Перыяд часу\",\n\t\tsection_type: \"Тып\",\n\t\tsection_deadline: \"Deadline\",\n\t\tsection_baselines: \"Baselines\",\n\t\t/* grid columns */\n\n\t\tcolumn_wbs: \"ІСР\",\n\t\tcolumn_text: \"Задача\",\n\t\tcolumn_start_date: \"Пачатак\",\n\t\tcolumn_duration: \"Працяг\",\n\t\tcolumn_add: \"\",\n\n\t\t/* link confirmation */\n\t\tlink: \"Сувязь\",\n\t\tconfirm_link_deleting: \"будзе выдалена\",\n\t\tlink_start: \"(пачатак)\",\n\t\tlink_end: \"(канец)\",\n\n\t\ttype_task: \"Task\",\n\t\ttype_project: \"Project\",\n\t\ttype_milestone: \"Milestone\",\n\n\n\t\tminutes: \"Хвiлiна\",\n\t\thours: \"Гадзiна\",\n\t\tdays: \"Дзень\",\n\t\tweeks: \"Тыдзень\",\n\t\tmonths: \"Месяц\",\n\t\tyears: \"Год\",\n\n\t\t/* message popup */\n\t\tmessage_ok: \"OK\",\n\t\tmessage_cancel: \"Адмяніць\",\n\n\t\t/* constraints */\n\t\tsection_constraint: \"Constraint\",\n\t\tconstraint_type: \"Constraint type\",\n\t\tconstraint_date: \"Constraint date\",\n\t\tasap: \"As Soon As Possible\",\n\t\talap: \"As Late As Possible\",\n\t\tsnet: \"Start No Earlier Than\",\n\t\tsnlt: \"Start No Later Than\",\n\t\tfnet: \"Finish No Earlier Than\",\n\t\tfnlt: \"Finish No Later Than\",\n\t\tmso: \"Must Start On\",\n\t\tmfo: \"Must Finish On\",\n\n\t\t/* resource control */\n\t\tresources_filter_placeholder: \"type to filter\",\n\t\tresources_filter_label: \"hide empty\",\n\n\t\t/* empty state screen */\n\t\tempty_state_text_link: \"Click here\",\n\t\tempty_state_text_description: \"to create your first task\",\n\n\t\t/* baselines control */\n\t\tbaselines_section_placeholder: \"Start adding a new baseline\",\n\t\tbaselines_add_button: \"Add Baseline\",\n\t\tbaselines_remove_button: \"Remove\",\n\t\tbaselines_remove_all_button: \"Remove All\",\n\n\t\t/* deadline control */\n\t\tdeadline_enable_button: \"Set\",\n\t\tdeadline_disable_button: \"Remove\"\n\t}\n};\n\nexport default locale;\n","/*\n @Traducido por Vicente Adria Bohigues - vicenteadria@hotmail.com\n */\n\nconst locale: IGanttLocale = {\n\tdate: {\n\t\tmonth_full: [\"Gener\", \"Febrer\", \"Març\", \"Abril\", \"Maig\", \"Juny\", \"Juliol\", \"Agost\", \"Setembre\", \"Octubre\", \"Novembre\", \"Desembre\"],\n\t\tmonth_short: [\"Gen\", \"Feb\", \"Mar\", \"Abr\", \"Mai\", \"Jun\", \"Jul\", \"Ago\", \"Set\", \"Oct\", \"Nov\", \"Des\"],\n\t\tday_full: [\"Diumenge\", \"Dilluns\", \"Dimarts\", \"Dimecres\", \"Dijous\", \"Divendres\", \"Dissabte\"],\n\t\tday_short: [\"Dg\", \"Dl\", \"Dm\", \"Dc\", \"Dj\", \"Dv\", \"Ds\"]\n\t},\n\tlabels: {\n\t\tnew_task: \"Nova tasca\",\n\t\ticon_save: \"Guardar\",\n\t\ticon_cancel: \"Cancel·lar\",\n\t\ticon_details: \"Detalls\",\n\t\ticon_edit: \"Editar\",\n\t\ticon_delete: \"Esborrar\",\n\t\tconfirm_closing: \"\", // \"Els seus canvis es perdràn, continuar ?\"\n\t\tconfirm_deleting: \"L'esdeveniment s'esborrarà definitivament, continuar ?\",\n\t\tsection_description: \"Descripció\",\n\t\tsection_time: \"Periode de temps\",\n\t\tsection_type: \"Type\",\n\t\tsection_deadline: \"Deadline\",\n\t\tsection_baselines: \"Baselines\",\n\t\t/* grid columns */\n\n\t\tcolumn_wbs: \"WBS\",\n\t\tcolumn_text: \"Task name\",\n\t\tcolumn_start_date: \"Start time\",\n\t\tcolumn_duration: \"Duration\",\n\t\tcolumn_add: \"\",\n\n\t\t/* link confirmation */\n\t\tlink: \"Link\",\n\t\tconfirm_link_deleting: \"will be deleted\",\n\t\tlink_start: \" (start)\",\n\t\tlink_end: \" (end)\",\n\n\t\ttype_task: \"Task\",\n\t\ttype_project: \"Project\",\n\t\ttype_milestone: \"Milestone\",\n\n\n\t\tminutes: \"Minutes\",\n\t\thours: \"Hours\",\n\t\tdays: \"Days\",\n\t\tweeks: \"Week\",\n\t\tmonths: \"Months\",\n\t\tyears: \"Years\",\n\n\t\t/* message popup */\n\t\tmessage_ok: \"OK\",\n\t\tmessage_cancel: \"Cancel·lar\",\n\n\t\t/* constraints */\n\t\tsection_constraint: \"Constraint\",\n\t\tconstraint_type: \"Constraint type\",\n\t\tconstraint_date: \"Constraint date\",\n\t\tasap: \"As Soon As Possible\",\n\t\talap: \"As Late As Possible\",\n\t\tsnet: \"Start No Earlier Than\",\n\t\tsnlt: \"Start No Later Than\",\n\t\tfnet: \"Finish No Earlier Than\",\n\t\tfnlt: \"Finish No Later Than\",\n\t\tmso: \"Must Start On\",\n\t\tmfo: \"Must Finish On\",\n\n\t\t/* resource control */\n\t\tresources_filter_placeholder: \"type to filter\",\n\t\tresources_filter_label: \"hide empty\",\n\n\t\t/* empty state screen */\n\t\tempty_state_text_link: \"Click here\",\n\t\tempty_state_text_description: \"to create your first task\",\n\n\t\t/* baselines control */\n\t\tbaselines_section_placeholder: \"Start adding a new baseline\",\n\t\tbaselines_add_button: \"Add Baseline\",\n\t\tbaselines_remove_button: \"Remove\",\n\t\tbaselines_remove_all_button: \"Remove All\",\n\n\t\t/* deadline control */\n\t\tdeadline_enable_button: \"Set\",\n\t\tdeadline_disable_button: \"Remove\"\n\t}\n};\n\nexport default locale;\n","/*\nTranslation by FreezeSoul\n\nUpdate 26/10/2015:\nTranslation of new labels by zwh8800\n https://github.com/DHTMLX/gantt/pull/7\n\n*/\n\nconst locale: IGanttLocale = {\n\tdate: {\n\t\tmonth_full: [\"一月\", \"二月\", \"三月\", \"四月\", \"五月\", \"六月\", \"七月\", \"八月\", \"九月\", \"十月\", \"十一月\", \"十二月\"],\n\t\tmonth_short: [\"1月\", \"2月\", \"3月\", \"4月\", \"5月\", \"6月\", \"7月\", \"8月\", \"9月\", \"10月\", \"11月\", \"12月\"],\n\t\tday_full: [\"星期日\", \"星期一\", \"星期二\", \"星期三\", \"星期四\", \"星期五\", \"星期六\"],\n\t\tday_short: [\"日\", \"一\", \"二\", \"三\", \"四\", \"五\", \"六\"]\n\t},\n\tlabels: {\n\t\tnew_task: \"新任務\",\n\t\ticon_save: \"保存\",\n\t\ticon_cancel: \"关闭\",\n\t\ticon_details: \"详细\",\n\t\ticon_edit: \"编辑\",\n\t\ticon_delete: \"删除\",\n\t\tconfirm_closing: \"请确认是否撤销修改!\", // Your changes will be lost, are your sure?\n\t\tconfirm_deleting: \"是否删除日程?\",\n\t\tsection_description: \"描述\",\n\t\tsection_time: \"时间范围\",\n\t\tsection_type: \"类型\",\n\t\tsection_deadline: \"Deadline\",\n\t\tsection_baselines: \"Baselines\",\n\n\t\t/* grid columns */\n\n\t\tcolumn_wbs: \"工作分解结构\",\n\t\tcolumn_text: \"任务名\",\n\t\tcolumn_start_date: \"开始时间\",\n\t\tcolumn_duration: \"持续时间\",\n\t\tcolumn_add: \"\",\n\n\t\t/* link confirmation */\n\n\t\tlink: \"关联\",\n\t\tconfirm_link_deleting: \"将被删除\",\n\t\tlink_start: \" (开始)\",\n\t\tlink_end: \" (结束)\",\n\n\t\ttype_task: \"任务\",\n\t\ttype_project: \"项目\",\n\t\ttype_milestone: \"里程碑\",\n\n\t\tminutes: \"分钟\",\n\t\thours: \"小时\",\n\t\tdays: \"天\",\n\t\tweeks: \"周\",\n\t\tmonths: \"月\",\n\t\tyears: \"年\",\n\n\t\t/* message popup */\n\t\tmessage_ok: \"OK\",\n\t\tmessage_cancel: \"关闭\",\n\n\t\t/* constraints */\n\t\tsection_constraint: \"Constraint\",\n\t\tconstraint_type: \"Constraint type\",\n\t\tconstraint_date: \"Constraint date\",\n\t\tasap: \"As Soon As Possible\",\n\t\talap: \"As Late As Possible\",\n\t\tsnet: \"Start No Earlier Than\",\n\t\tsnlt: \"Start No Later Than\",\n\t\tfnet: \"Finish No Earlier Than\",\n\t\tfnlt: \"Finish No Later Than\",\n\t\tmso: \"Must Start On\",\n\t\tmfo: \"Must Finish On\",\n\n\t\t/* resource control */\n\t\tresources_filter_placeholder: \"type to filter\",\n\t\tresources_filter_label: \"hide empty\",\n\n\t\t/* empty state screen */\n\t\tempty_state_text_link: \"Click here\",\n\t\tempty_state_text_description: \"to create your first task\",\n\n\t\t/* baselines control */\n\t\tbaselines_section_placeholder: \"Start adding a new baseline\",\n\t\tbaselines_add_button: \"Add Baseline\",\n\t\tbaselines_remove_button: \"Remove\",\n\t\tbaselines_remove_all_button: \"Remove All\",\n\n\t\t/* deadline control */\n\t\tdeadline_enable_button: \"Set\",\n\t\tdeadline_disable_button: \"Remove\"\n\t}\n};\n\nexport default locale;\n","const locale: IGanttLocale = {\n\tdate: {\n\t\tmonth_full: [\"Leden\", \"Únor\", \"Březen\", \"Duben\", \"Květen\", \"Červen\", \"Červenec\", \"Srpen\", \"Září\", \"Říjen\", \"Listopad\", \"Prosinec\"],\n\t\tmonth_short: [\"Led\", \"Ún\", \"Bře\", \"Dub\", \"Kvě\", \"Čer\", \"Čec\", \"Srp\", \"Září\", \"Říj\", \"List\", \"Pro\"],\n\t\tday_full: [\"Neděle\", \"Pondělí\", \"Úterý\", \"Středa\", \"Čtvrtek\", \"Pátek\", \"Sobota\"],\n\t\tday_short: [\"Ne\", \"Po\", \"Út\", \"St\", \"Čt\", \"Pá\", \"So\"]\n\t},\n\tlabels: {\n\t\tnew_task: \"Nová práce\",\n\t\ticon_save: \"Uložit\",\n\t\ticon_cancel: \"Zpět\",\n\t\ticon_details: \"Detail\",\n\t\ticon_edit: \"Edituj\",\n\t\ticon_delete: \"Smazat\",\n\t\tconfirm_closing: \"\", // Vaše změny budou ztraceny, opravdu ?\n\t\tconfirm_deleting: \"Událost bude trvale smazána, opravdu?\",\n\t\tsection_description: \"Poznámky\",\n\t\tsection_time: \"Doba platnosti\",\n\t\tsection_type: \"Type\",\n\t\tsection_deadline: \"Deadline\",\n\t\tsection_baselines: \"Baselines\",\n\t\t/* grid columns */\n\n\t\tcolumn_wbs: \"WBS\",\n\t\tcolumn_text: \"Task name\",\n\t\tcolumn_start_date: \"Start time\",\n\t\tcolumn_duration: \"Duration\",\n\t\tcolumn_add: \"\",\n\n\t\t/* link confirmation */\n\t\tlink: \"Link\",\n\t\tconfirm_link_deleting: \"will be deleted\",\n\t\tlink_start: \" (start)\",\n\t\tlink_end: \" (end)\",\n\n\t\ttype_task: \"Task\",\n\t\ttype_project: \"Project\",\n\t\ttype_milestone: \"Milestone\",\n\n\n\t\tminutes: \"Minutes\",\n\t\thours: \"Hours\",\n\t\tdays: \"Days\",\n\t\tweeks: \"Week\",\n\t\tmonths: \"Months\",\n\t\tyears: \"Years\",\n\n\t\t/* message popup */\n\t\tmessage_ok: \"OK\",\n\t\tmessage_cancel: \"Zpět\",\n\n\t\t/* constraints */\n\t\tsection_constraint: \"Constraint\",\n\t\tconstraint_type: \"Constraint type\",\n\t\tconstraint_date: \"Constraint date\",\n\t\tasap: \"As Soon As Possible\",\n\t\talap: \"As Late As Possible\",\n\t\tsnet: \"Start No Earlier Than\",\n\t\tsnlt: \"Start No Later Than\",\n\t\tfnet: \"Finish No Earlier Than\",\n\t\tfnlt: \"Finish No Later Than\",\n\t\tmso: \"Must Start On\",\n\t\tmfo: \"Must Finish On\",\n\n\t\t/* resource control */\n\t\tresources_filter_placeholder: \"type to filter\",\n\t\tresources_filter_label: \"hide empty\",\n\n\t\t/* empty state screen */\n\t\tempty_state_text_link: \"Click here\",\n\t\tempty_state_text_description: \"to create your first task\",\n\n\t\t/* baselines control */\n\t\tbaselines_section_placeholder: \"Start adding a new baseline\",\n\t\tbaselines_add_button: \"Add Baseline\",\n\t\tbaselines_remove_button: \"Remove\",\n\t\tbaselines_remove_all_button: \"Remove All\",\n\n\t\t/* deadline control */\n\t\tdeadline_enable_button: \"Set\",\n\t\tdeadline_disable_button: \"Remove\"\n\t}\n};\n\nexport default locale;\n","const locale: IGanttLocale = {\n\tdate: {\n\t\tmonth_full: [\"Januar\", \"Februar\", \"Marts\", \"April\", \"Maj\", \"Juni\", \"Juli\", \"August\", \"September\", \"Oktober\", \"November\", \"December\"],\n\t\tmonth_short: [\"Jan\", \"Feb\", \"Mar\", \"Apr\", \"Maj\", \"Jun\", \"Jul\", \"Aug\", \"Sep\", \"Okt\", \"Nov\", \"Dec\"],\n\t\tday_full: [\"Søndag\", \"Mandag\", \"Tirsdag\", \"Onsdag\", \"Torsdag\", \"Fredag\", \"Lørdag\"],\n\t\tday_short: [\"Søn\", \"Man\", \"Tir\", \"Ons\", \"Tor\", \"Fre\", \"Lør\"]\n\t},\n\tlabels: {\n\t\tnew_task: \"Ny opgave\",\n\t\ticon_save: \"Gem\",\n\t\ticon_cancel: \"Fortryd\",\n\t\ticon_details: \"Detaljer\",\n\t\ticon_edit: \"Tilret\",\n\t\ticon_delete: \"Slet\",\n\t\tconfirm_closing: \"Dine rettelser vil gå tabt.. Er dy sikker?\", // Your changes will be lost, are your sure ?\n\t\tconfirm_deleting: \"Bigivenheden vil blive slettet permanent. Er du sikker?\",\n\t\tsection_description: \"Beskrivelse\",\n\t\tsection_time: \"Tidsperiode\",\n\t\tsection_type: \"Type\",\n\t\tsection_deadline: \"Deadline\",\n\t\tsection_baselines: \"Baselines\",\n\t\t/* grid columns */\n\n\t\tcolumn_wbs: \"WBS\",\n\t\tcolumn_text: \"Task name\",\n\t\tcolumn_start_date: \"Start time\",\n\t\tcolumn_duration: \"Duration\",\n\t\tcolumn_add: \"\",\n\n\t\t/* link confirmation */\n\t\tlink: \"Link\",\n\t\tconfirm_link_deleting: \"will be deleted\",\n\t\tlink_start: \" (start)\",\n\t\tlink_end: \" (end)\",\n\n\t\ttype_task: \"Task\",\n\t\ttype_project: \"Project\",\n\t\ttype_milestone: \"Milestone\",\n\n\n\t\tminutes: \"Minutes\",\n\t\thours: \"Hours\",\n\t\tdays: \"Days\",\n\t\tweeks: \"Week\",\n\t\tmonths: \"Months\",\n\t\tyears: \"Years\",\n\n\t\t/* message popup */\n\t\tmessage_ok: \"OK\",\n\t\tmessage_cancel: \"Fortryd\",\n\n\t\t/* constraints */\n\t\tsection_constraint: \"Constraint\",\n\t\tconstraint_type: \"Constraint type\",\n\t\tconstraint_date: \"Constraint date\",\n\t\tasap: \"As Soon As Possible\",\n\t\talap: \"As Late As Possible\",\n\t\tsnet: \"Start No Earlier Than\",\n\t\tsnlt: \"Start No Later Than\",\n\t\tfnet: \"Finish No Earlier Than\",\n\t\tfnlt: \"Finish No Later Than\",\n\t\tmso: \"Must Start On\",\n\t\tmfo: \"Must Finish On\",\n\n\t\t/* resource control */\n\t\tresources_filter_placeholder: \"type to filter\",\n\t\tresources_filter_label: \"hide empty\",\n\n\t\t/* empty state screen */\n\t\tempty_state_text_link: \"Click here\",\n\t\tempty_state_text_description: \"to create your first task\",\n\n\t\t/* baselines control */\n\t\tbaselines_section_placeholder: \"Start adding a new baseline\",\n\t\tbaselines_add_button: \"Add Baseline\",\n\t\tbaselines_remove_button: \"Remove\",\n\t\tbaselines_remove_all_button: \"Remove All\",\n\n\t\t/* deadline control */\n\t\tdeadline_enable_button: \"Set\",\n\t\tdeadline_disable_button: \"Remove\"\n\t}\n};\n\nexport default locale;\n","const locale: IGanttLocale = {\n\tdate: {\n\t\tmonth_full: [\" Januar\", \" Februar\", \" März \", \" April\", \" Mai\", \" Juni\", \" Juli\", \" August\", \" September \", \" Oktober\", \" November \", \" Dezember\"],\n\t\tmonth_short: [\"Jan\", \"Feb\", \"Mär\", \"Apr\", \"Mai\", \"Jun\", \"Jul\", \"Aug\", \"Sep\", \"Okt\", \"Nov\", \"Dez\"],\n\t\tday_full: [\"Sonntag\", \"Montag\", \"Dienstag\", \" Mittwoch\", \" Donnerstag\", \"Freitag\", \"Samstag\"],\n\t\tday_short: [\"So\", \"Mo\", \"Di\", \"Mi\", \"Do\", \"Fr\", \"Sa\"]\n\t},\n\tlabels: {\n\t\tnew_task: \"Neue Aufgabe\",\n\t\ticon_save: \"Speichern\",\n\t\ticon_cancel: \"Abbrechen\",\n\t\ticon_details: \"Details\",\n\t\ticon_edit: \"Ändern\",\n\t\ticon_delete: \"Löschen\",\n\t\tconfirm_closing: \"\", // \"Ihre Veränderungen werden verloren sein, wollen Sie ergänzen? \"\n\t\tconfirm_deleting: \"Der Eintrag wird gelöscht\",\n\t\tsection_description: \"Beschreibung\",\n\t\tsection_time: \"Zeitspanne\",\n\t\tsection_type: \"Type\",\n\t\tsection_deadline: \"Deadline\",\n\t\tsection_baselines: \"Baselines\",\n\t\t/* grid columns */\n\n\t\tcolumn_wbs: \"PSP\",\n\t\tcolumn_text: \"Task-Namen\",\n\t\tcolumn_start_date: \"Startzeit\",\n\t\tcolumn_duration: \"Dauer\",\n\t\tcolumn_add: \"\",\n\n\t\t/* link confirmation */\n\t\tlink: \"Link\",\n\t\tconfirm_link_deleting: \"werden gelöscht\",\n\t\tlink_start: \"(starten)\",\n\t\tlink_end: \"(ende)\",\n\n\t\ttype_task: \"Task\",\n\t\ttype_project: \"Project\",\n\t\ttype_milestone: \"Milestone\",\n\n\n\t\tminutes: \"Minuten\",\n\t\thours: \"Stunden\",\n\t\tdays: \"Tage\",\n\t\tweeks: \"Wochen\",\n\t\tmonths: \"Monate\",\n\t\tyears: \"Jahre\",\n\n\t\t/* message popup */\n\t\tmessage_ok: \"OK\",\n\t\tmessage_cancel: \"Abbrechen\",\n\n\t\t/* constraints */\n\t\tsection_constraint: \"Regel\",\n\t\tconstraint_type: \"Regel\",\n\t\tconstraint_date: \"Regel - Datum\",\n\t\tasap: \"So bald wie möglich\",\n\t\talap: \"So spät wie möglich\",\n\t\tsnet: \"Beginn nicht vor\",\n\t\tsnlt: \"Beginn nicht später als\",\n\t\tfnet: \"Fertigstellung nicht vor\",\n\t\tfnlt: \"Fertigstellung nicht später als\",\n\t\tmso: \"Muss beginnen am\",\n\t\tmfo: \"Muss fertig sein am\",\n\n\t\t/* resource control */\n\t\tresources_filter_placeholder: \"type to filter\",\n\t\tresources_filter_label: \"hide empty\",\n\n\t\t/* empty state screen */\n\t\tempty_state_text_link: \"Click here\",\n\t\tempty_state_text_description: \"to create your first task\",\n\n\t\t/* baselines control */\n\t\tbaselines_section_placeholder: \"Start adding a new baseline\",\n\t\tbaselines_add_button: \"Add Baseline\",\n\t\tbaselines_remove_button: \"Remove\",\n\t\tbaselines_remove_all_button: \"Remove All\",\n\n\t\t/* deadline control */\n\t\tdeadline_enable_button: \"Set\",\n\t\tdeadline_disable_button: \"Remove\"\n\t}\n};\n\nexport default locale;\n","const locale: IGanttLocale = {\n\tdate: {\n\t\tmonth_full: [\"Ιανουάριος\", \"Φεβρουάριος\", \"Μάρτιος\", \"Απρίλιος\", \"Μάϊος\", \"Ιούνιος\", \"Ιούλιος\", \"Αύγουστος\", \"Σεπτέμβριος\", \"Οκτώβριος\", \"Νοέμβριος\", \"Δεκέμβριος\"],\n\t\tmonth_short: [\"ΙΑΝ\", \"ΦΕΒ\", \"ΜΑΡ\", \"ΑΠΡ\", \"ΜΑΙ\", \"ΙΟΥΝ\", \"ΙΟΥΛ\", \"ΑΥΓ\", \"ΣΕΠ\", \"ΟΚΤ\", \"ΝΟΕ\", \"ΔΕΚ\"],\n\t\tday_full: [\"Κυριακή\", \"Δευτέρα\", \"Τρίτη\", \"Τετάρτη\", \"Πέμπτη\", \"Παρασκευή\", \"Κυριακή\"],\n\t\tday_short: [\"ΚΥ\", \"ΔΕ\", \"ΤΡ\", \"ΤΕ\", \"ΠΕ\", \"ΠΑ\", \"ΣΑ\"]\n\t},\n\tlabels: {\n\t\tnew_task: \"Νέα εργασία\",\n\t\ticon_save: \"Αποθήκευση\",\n\t\ticon_cancel: \"Άκυρο\",\n\t\ticon_details: \"Λεπτομέρειες\",\n\t\ticon_edit: \"Επεξεργασία\",\n\t\ticon_delete: \"Διαγραφή\",\n\t\tconfirm_closing: \"\", // Your changes will be lost, are your sure ?\n\t\tconfirm_deleting: \"Το έργο θα διαγραφεί οριστικά. Θέλετε να συνεχίσετε;\",\n\t\tsection_description: \"Περιγραφή\",\n\t\tsection_time: \"Χρονική περίοδος\",\n\t\tsection_type: \"Type\",\n\t\tsection_deadline: \"Deadline\",\n\t\tsection_baselines: \"Baselines\",\n\t\t/* grid columns */\n\n\t\tcolumn_wbs: \"WBS\",\n\t\tcolumn_text: \"Task name\",\n\t\tcolumn_start_date: \"Start time\",\n\t\tcolumn_duration: \"Duration\",\n\t\tcolumn_add: \"\",\n\n\t\t/* link confirmation */\n\t\tlink: \"Link\",\n\t\tconfirm_link_deleting: \"will be deleted\",\n\t\tlink_start: \" (start)\",\n\t\tlink_end: \" (end)\",\n\n\t\ttype_task: \"Task\",\n\t\ttype_project: \"Project\",\n\t\ttype_milestone: \"Milestone\",\n\n\n\t\tminutes: \"Minutes\",\n\t\thours: \"Hours\",\n\t\tdays: \"Days\",\n\t\tweeks: \"Week\",\n\t\tmonths: \"Months\",\n\t\tyears: \"Years\",\n\n\t\t/* message popup */\n\t\tmessage_ok: \"OK\",\n\t\tmessage_cancel: \"Άκυρο\",\n\n\t\t/* constraints */\n\t\tsection_constraint: \"Constraint\",\n\t\tconstraint_type: \"Constraint type\",\n\t\tconstraint_date: \"Constraint date\",\n\t\tasap: \"As Soon As Possible\",\n\t\talap: \"As Late As Possible\",\n\t\tsnet: \"Start No Earlier Than\",\n\t\tsnlt: \"Start No Later Than\",\n\t\tfnet: \"Finish No Earlier Than\",\n\t\tfnlt: \"Finish No Later Than\",\n\t\tmso: \"Must Start On\",\n\t\tmfo: \"Must Finish On\",\n\n\t\t/* resource control */\n\t\tresources_filter_placeholder: \"type to filter\",\n\t\tresources_filter_label: \"hide empty\",\n\n\t\t/* empty state screen */\n\t\tempty_state_text_link: \"Click here\",\n\t\tempty_state_text_description: \"to create your first task\",\n\n\t\t/* baselines control */\n\t\tbaselines_section_placeholder: \"Start adding a new baseline\",\n\t\tbaselines_add_button: \"Add Baseline\",\n\t\tbaselines_remove_button: \"Remove\",\n\t\tbaselines_remove_all_button: \"Remove All\",\n\n\t\t/* deadline control */\n\t\tdeadline_enable_button: \"Set\",\n\t\tdeadline_disable_button: \"Remove\"\n\t}\n};\n\nexport default locale;\n","const locale: IGanttLocale = {\n\tdate: {\n\t\tmonth_full: [\"January\", \"February\", \"March\", \"April\", \"May\", \"June\", \"July\", \"August\", \"September\", \"October\", \"November\", \"December\"],\n\t\tmonth_short: [\"Jan\", \"Feb\", \"Mar\", \"Apr\", \"May\", \"Jun\", \"Jul\", \"Aug\", \"Sep\", \"Oct\", \"Nov\", \"Dec\"],\n\t\tday_full: [\"Sunday\", \"Monday\", \"Tuesday\", \"Wednesday\", \"Thursday\", \"Friday\", \"Saturday\"],\n\t\tday_short: [\"Sun\", \"Mon\", \"Tue\", \"Wed\", \"Thu\", \"Fri\", \"Sat\"]\n\t},\n\tlabels: {\n\t\tnew_task: \"New task\",\n\t\ticon_save: \"Save\",\n\t\ticon_cancel: \"Cancel\",\n\t\ticon_details: \"Details\",\n\t\ticon_edit: \"Edit\",\n\t\ticon_delete: \"Delete\",\n\t\tconfirm_closing: \"\",// Your changes will be lost, are you sure?\n\t\tconfirm_deleting: \"Task will be deleted permanently, are you sure?\",\n\t\tsection_description: \"Description\",\n\t\tsection_time: \"Time period\",\n\t\tsection_type: \"Type\",\n\t\tsection_deadline: \"Deadline\",\n\t\tsection_baselines: \"Baselines\",\n\n\t\t/* grid columns */\n\t\tcolumn_wbs: \"WBS\",\n\t\tcolumn_text: \"Task name\",\n\t\tcolumn_start_date: \"Start time\",\n\t\tcolumn_duration: \"Duration\",\n\t\tcolumn_add: \"\",\n\n\t\t/* link confirmation */\n\t\tlink: \"Link\",\n\t\tconfirm_link_deleting: \"will be deleted\",\n\t\tlink_start: \" (start)\",\n\t\tlink_end: \" (end)\",\n\n\t\ttype_task: \"Task\",\n\t\ttype_project: \"Project\",\n\t\ttype_milestone: \"Milestone\",\n\n\t\tminutes: \"Minutes\",\n\t\thours: \"Hours\",\n\t\tdays: \"Days\",\n\t\tweeks: \"Week\",\n\t\tmonths: \"Months\",\n\t\tyears: \"Years\",\n\n\t\t/* message popup */\n\t\tmessage_ok: \"OK\",\n\t\tmessage_cancel: \"Cancel\",\n\n\t\t/* constraints */\n\t\tsection_constraint: \"Constraint\",\n\t\tconstraint_type: \"Constraint type\",\n\t\tconstraint_date: \"Constraint date\",\n\t\tasap: \"As Soon As Possible\",\n\t\talap: \"As Late As Possible\",\n\t\tsnet: \"Start No Earlier Than\",\n\t\tsnlt: \"Start No Later Than\",\n\t\tfnet: \"Finish No Earlier Than\",\n\t\tfnlt: \"Finish No Later Than\",\n\t\tmso: \"Must Start On\",\n\t\tmfo: \"Must Finish On\",\n\n\t\t/* resource control */\n\t\tresources_filter_placeholder: \"type to filter\",\n\t\tresources_filter_label: \"hide empty\",\n\n\t\t/* empty state screen */\n\t\tempty_state_text_link: \"Click here\",\n\t\tempty_state_text_description: \"to create your first task\",\n\n\t\t/* baselines control */\n\t\tbaselines_section_placeholder: \"Start adding a new baseline\",\n\t\tbaselines_add_button: \"Add Baseline\",\n\t\tbaselines_remove_button: \"Remove\",\n\t\tbaselines_remove_all_button: \"Remove All\",\n\n\t\t/* deadline control */\n\t\tdeadline_enable_button: \"Set\",\n\t\tdeadline_disable_button: \"Remove\"\n\t}\n};\n\nexport default locale;","/*\n @Autor Manuel Fernandez Panzuela - www.mfernandez.es\n\n Update 30/10/2015:\n Translation of new labels by Jorge Macias\n https://disqus.com/by/disqus_bTuZk1voC7/\n */\n\nconst locale: IGanttLocale = {\n\tdate: {\n\t\tmonth_full: [\"Enero\", \"Febrero\", \"Marzo\", \"Abril\", \"Mayo\", \"Junio\", \"Julio\", \"Agosto\", \"Septiembre\", \"Octubre\", \"Noviembre\", \"Diciembre\"],\n\t\tmonth_short: [\"Ene\", \"Feb\", \"Mar\", \"Abr\", \"May\", \"Jun\", \"Jul\", \"Ago\", \"Sep\", \"Oct\", \"Nov\", \"Dic\"],\n\t\tday_full: [\"Domingo\", \"Lunes\", \"Martes\", \"Miércoles\", \"Jueves\", \"Viernes\", \"Sábado\"],\n\t\tday_short: [\"Dom\", \"Lun\", \"Mar\", \"Mié\", \"Jue\", \"Vie\", \"Sáb\"]\n\t},\n\tlabels: {\n\t\tnew_task: \"Nueva tarea\",\n\t\ticon_save: \"Guardar\",\n\t\ticon_cancel: \"Cancelar\",\n\t\ticon_details: \"Detalles\",\n\t\ticon_edit: \"Editar\",\n\t\ticon_delete: \"Eliminar\",\n\t\tconfirm_closing: \"\", // \"Sus cambios se perderán, continuar ?\"\n\t\tconfirm_deleting: \"El evento se borrará definitivamente, ¿continuar?\",\n\t\tsection_description: \"Descripción\",\n\t\tsection_time: \"Período\",\n\t\tsection_type: \"Tipo\",\n\t\tsection_deadline: \"Deadline\",\n\t\tsection_baselines: \"Baselines\",\n\t\t/* grid columns */\n\n\t\tcolumn_wbs: \"EDT\",\n\t\tcolumn_text: \"Tarea\",\n\t\tcolumn_start_date: \"Inicio\",\n\t\tcolumn_duration: \"Duración\",\n\t\tcolumn_add: \"\",\n\n\t\t/* link confirmation */\n\t\tlink: \"Enlace\",\n\t\tconfirm_link_deleting: \"será borrada\",\n\t\tlink_start: \" (inicio)\",\n\t\tlink_end: \" (fin)\",\n\n\t\ttype_task: \"Tarea\",\n\t\ttype_project: \"Proyecto\",\n\t\ttype_milestone: \"Hito\",\n\n\n\t\tminutes: \"Minutos\",\n\t\thours: \"Horas\",\n\t\tdays: \"Días\",\n\t\tweeks: \"Semanas\",\n\t\tmonths: \"Meses\",\n\t\tyears: \"Años\",\n\n\t\t/* message popup */\n\t\tmessage_ok: \"OK\",\n\t\tmessage_cancel: \"Cancelar\",\n\n\t\t/* constraints */\n\t\tsection_constraint: \"Constraint\",\n\t\tconstraint_type: \"Constraint type\",\n\t\tconstraint_date: \"Constraint date\",\n\t\tasap: \"As Soon As Possible\",\n\t\talap: \"As Late As Possible\",\n\t\tsnet: \"Start No Earlier Than\",\n\t\tsnlt: \"Start No Later Than\",\n\t\tfnet: \"Finish No Earlier Than\",\n\t\tfnlt: \"Finish No Later Than\",\n\t\tmso: \"Must Start On\",\n\t\tmfo: \"Must Finish On\",\n\n\t\t/* resource control */\n\t\tresources_filter_placeholder: \"type to filter\",\n\t\tresources_filter_label: \"hide empty\",\n\n\t\t/* empty state screen */\n\t\tempty_state_text_link: \"Click here\",\n\t\tempty_state_text_description: \"to create your first task\",\n\n\t\t/* baselines control */\n\t\tbaselines_section_placeholder: \"Start adding a new baseline\",\n\t\tbaselines_add_button: \"Add Baseline\",\n\t\tbaselines_remove_button: \"Remove\",\n\t\tbaselines_remove_all_button: \"Remove All\",\n\n\t\t/* deadline control */\n\t\tdeadline_enable_button: \"Set\",\n\t\tdeadline_disable_button: \"Remove\"\n\t}\n};\n\nexport default locale;\n","/*\n dhtmlxGantt Persian (Farsi, fa_IR) locale by Mohammad Shokri http://slashsbin.com/\n */\n\nconst locale: IGanttLocale = {\n\tdate: {\n\t\tmonth_full: [\n\t\t\t\"ژانویه\",\n\t\t\t\"فوریه\",\n\t\t\t\"مارس\",\n\t\t\t\"آوریل\",\n\t\t\t\"مه\",\n\t\t\t\"ژوئن\",\n\t\t\t\"ژوئیه\",\n\t\t\t\"اوت\",\n\t\t\t\"سپتامبر\",\n\t\t\t\"اکتبر\",\n\t\t\t\"نوامبر\",\n\t\t\t\"دسامبر\"\n\t\t],\n\t\tmonth_short: [\"1\", \"2\", \"3\", \"4\", \"5\", \"6\", \"7\", \"8\", \"9\", \"10\", \"11\", \"12\"],\n\t\tday_full: [\n\t\t\t\"يکشنبه\",\n\t\t\t\"دوشنبه\",\n\t\t\t\"سه‌شنبه\",\n\t\t\t\"چهارشنبه\",\n\t\t\t\"پنجشنبه\",\n\t\t\t\"جمعه\",\n\t\t\t\"شنبه\"\n\t\t],\n\t\tday_short: [\n\t\t\t\"ی\",\n\t\t\t\"د\",\n\t\t\t\"س\",\n\t\t\t\"چ\",\n\t\t\t\"پ\",\n\t\t\t\"ج\",\n\t\t\t\"ش\"\n\t\t]\n\t},\n\tlabels: {\n\t\tnew_task: \"وظیفه جدید\",\n\t\ticon_save: \"ذخیره\",\n\t\ticon_cancel: \"لغو\",\n\t\ticon_details: \"جزییات\",\n\t\ticon_edit: \"ویرایش\",\n\t\ticon_delete: \"حذف\",\n\t\tconfirm_closing: \"تغییرات شما ازدست خواهد رفت، آیا مطمئن هستید؟\",\n\t\tconfirm_deleting: \"این مورد برای همیشه حذف خواهد شد، آیا مطمئن هستید؟\",\n\t\tsection_description: \"توضیحات\",\n\t\tsection_time: \"مدت زمان\",\n\t\tsection_type: \"نوع\",\n\t\tsection_deadline: \"Deadline\",\n\t\tsection_baselines: \"Baselines\",\n\n\t\t/* grid columns */\n\n\t\tcolumn_wbs: \"WBS\",\n\t\tcolumn_text: \"عنوان\",\n\t\tcolumn_start_date: \"زمان شروع\",\n\t\tcolumn_duration: \"مدت\",\n\t\tcolumn_add: \"\",\n\n\t\t/* link confirmation */\n\t\tlink: \"ارتباط\",\n\t\tconfirm_link_deleting: \"حذف خواهد شد\",\n\t\tlink_start: \" (آغاز)\",\n\t\tlink_end: \" (پایان)\",\n\n\t\ttype_task: \"وظیفه\",\n\t\ttype_project: \"پروژه\",\n\t\ttype_milestone: \"نگارش\",\n\n\t\tminutes: \"دقایق\",\n\t\thours: \"ساعات\",\n\t\tdays: \"روزها\",\n\t\tweeks: \"هفته\",\n\t\tmonths: \"ماه‌ها\",\n\t\tyears: \"سال‌ها\",\n\n\t\t/* message popup */\n\t\tmessage_ok: \"تایید\",\n\t\tmessage_cancel: \"لغو\",\n\n\t\t/* constraints */\n\t\tsection_constraint: \"Constraint\",\n\t\tconstraint_type: \"Constraint type\",\n\t\tconstraint_date: \"Constraint date\",\n\t\tasap: \"As Soon As Possible\",\n\t\talap: \"As Late As Possible\",\n\t\tsnet: \"Start No Earlier Than\",\n\t\tsnlt: \"Start No Later Than\",\n\t\tfnet: \"Finish No Earlier Than\",\n\t\tfnlt: \"Finish No Later Than\",\n\t\tmso: \"Must Start On\",\n\t\tmfo: \"Must Finish On\",\n\n\t\t/* resource control */\n\t\tresources_filter_placeholder: \"type to filter\",\n\t\tresources_filter_label: \"hide empty\",\n\n\t\t/* empty state screen */\n\t\tempty_state_text_link: \"Click here\",\n\t\tempty_state_text_description: \"to create your first task\",\n\n\t\t/* baselines control */\n\t\tbaselines_section_placeholder: \"Start adding a new baseline\",\n\t\tbaselines_add_button: \"Add Baseline\",\n\t\tbaselines_remove_button: \"Remove\",\n\t\tbaselines_remove_all_button: \"Remove All\",\n\n\t\t/* deadline control */\n\t\tdeadline_enable_button: \"Set\",\n\t\tdeadline_disable_button: \"Remove\"\n\n\t}\n};\n\nexport default locale;\n","const locale: IGanttLocale = {\n\tdate: {\n\t\tmonth_full: [\"Tammikuu\", \"Helmikuu\", \"Maaliskuu\", \"Huhtikuu\", \"Toukokuu\", \"Kes&auml;kuu\", \"Hein&auml;kuu\", \"Elokuu\", \"Syyskuu\", \"Lokakuu\", \"Marraskuu\", \"Joulukuu\"],\n\t\tmonth_short: [\"Tam\", \"Hel\", \"Maa\", \"Huh\", \"Tou\", \"Kes\", \"Hei\", \"Elo\", \"Syy\", \"Lok\", \"Mar\", \"Jou\"],\n\t\tday_full: [\"Sunnuntai\", \"Maanantai\", \"Tiistai\", \"Keskiviikko\", \"Torstai\", \"Perjantai\", \"Lauantai\"],\n\t\tday_short: [\"Su\", \"Ma\", \"Ti\", \"Ke\", \"To\", \"Pe\", \"La\"]\n\t},\n\tlabels: {\n\t\tnew_task: \"Uusi tehtävä\",\n\t\ticon_save: \"Tallenna\",\n\t\ticon_cancel: \"Peru\",\n\t\ticon_details: \"Tiedot\",\n\t\ticon_edit: \"Muokkaa\",\n\t\ticon_delete: \"Poista\",\n\t\tconfirm_closing: \"\", // Your changes will be lost, are your sure ?\n\t\tconfirm_deleting: \"Haluatko varmasti poistaa tapahtuman?\",\n\t\tsection_description: \"Kuvaus\",\n\t\tsection_time: \"Aikajakso\",\n\t\tsection_type: \"Type\",\n\t\tsection_deadline: \"Deadline\",\n\t\tsection_baselines: \"Baselines\",\n\t\t/* grid columns */\n\n\t\tcolumn_wbs: \"WBS\",\n\t\tcolumn_text: \"Task name\",\n\t\tcolumn_start_date: \"Start time\",\n\t\tcolumn_duration: \"Duration\",\n\t\tcolumn_add: \"\",\n\n\t\t/* link confirmation */\n\t\tlink: \"Link\",\n\t\tconfirm_link_deleting: \"will be deleted\",\n\t\tlink_start: \" (start)\",\n\t\tlink_end: \" (end)\",\n\n\t\ttype_task: \"Task\",\n\t\ttype_project: \"Project\",\n\t\ttype_milestone: \"Milestone\",\n\n\n\t\tminutes: \"Minutes\",\n\t\thours: \"Hours\",\n\t\tdays: \"Days\",\n\t\tweeks: \"Week\",\n\t\tmonths: \"Months\",\n\t\tyears: \"Years\",\n\n\t\t/* message popup */\n\t\tmessage_ok: \"OK\",\n\t\tmessage_cancel: \"Peru\",\n\n\t\t/* constraints */\n\t\tsection_constraint: \"Constraint\",\n\t\tconstraint_type: \"Constraint type\",\n\t\tconstraint_date: \"Constraint date\",\n\t\tasap: \"As Soon As Possible\",\n\t\talap: \"As Late As Possible\",\n\t\tsnet: \"Start No Earlier Than\",\n\t\tsnlt: \"Start No Later Than\",\n\t\tfnet: \"Finish No Earlier Than\",\n\t\tfnlt: \"Finish No Later Than\",\n\t\tmso: \"Must Start On\",\n\t\tmfo: \"Must Finish On\",\n\n\t\t/* resource control */\n\t\tresources_filter_placeholder: \"type to filter\",\n\t\tresources_filter_label: \"hide empty\",\n\n\t\t/* empty state screen */\n\t\tempty_state_text_link: \"Click here\",\n\t\tempty_state_text_description: \"to create your first task\",\n\n\t\t/* baselines control */\n\t\tbaselines_section_placeholder: \"Start adding a new baseline\",\n\t\tbaselines_add_button: \"Add Baseline\",\n\t\tbaselines_remove_button: \"Remove\",\n\t\tbaselines_remove_all_button: \"Remove All\",\n\n\t\t/* deadline control */\n\t\tdeadline_enable_button: \"Set\",\n\t\tdeadline_disable_button: \"Remove\"\n\t}\n};\n\nexport default locale;\n","const locale: IGanttLocale = {\n\tdate: {\n\t\tmonth_full: [\"Janvier\", \"Février\", \"Mars\", \"Avril\", \"Mai\", \"Juin\", \"Juillet\", \"Août\", \"Septembre\", \"Octobre\", \"Novembre\", \"Décembre\"],\n\t\tmonth_short: [\"Jan\", \"Fév\", \"Mar\", \"Avr\", \"Mai\", \"Juin\", \"Juil\", \"Aoû\", \"Sep\", \"Oct\", \"Nov\", \"Déc\"],\n\t\tday_full: [\"Dimanche\", \"Lundi\", \"Mardi\", \"Mercredi\", \"Jeudi\", \"Vendredi\", \"Samedi\"],\n\t\tday_short: [\"Dim\", \"Lun\", \"Mar\", \"Mer\", \"Jeu\", \"Ven\", \"Sam\"]\n\t},\n\tlabels: {\n\t\tnew_task: \"Nouvelle tâche\",\n\t\ticon_save: \"Enregistrer\",\n\t\ticon_cancel: \"Annuler\",\n\t\ticon_details: \"Détails\",\n\t\ticon_edit: \"Modifier\",\n\t\ticon_delete: \"Effacer\",\n\t\tconfirm_closing: \"\",// Vos modifications seront perdus, êtes-vous sûr ?\n\t\tconfirm_deleting: \"L'événement sera effacé sans appel, êtes-vous sûr ?\",\n\n\t\tsection_description: \"Description\",\n\t\tsection_time: \"Période\",\n\t\tsection_type: \"Type\",\n\t\tsection_deadline: \"Deadline\",\n\t\tsection_baselines: \"Baselines\",\n\n\t\t/* grid columns */\n\n\t\tcolumn_wbs: \"OTP\",\n\t\tcolumn_text: \"Nom de la tâche\",\n\t\tcolumn_start_date: \"Date initiale\",\n\t\tcolumn_duration: \"Durée\",\n\t\tcolumn_add: \"\",\n\n\n\t\t/* link confirmation */\n\t\tlink: \"Le lien\",\n\t\tconfirm_link_deleting: \"sera supprimé\",\n\t\tlink_start: \"(début)\",\n\t\tlink_end: \"(fin)\",\n\n\t\ttype_task: \"Task\",\n\t\ttype_project: \"Project\",\n\t\ttype_milestone: \"Milestone\",\n\n\n\t\tminutes: \"Minutes\",\n\t\thours: \"Heures\",\n\t\tdays: \"Jours\",\n\t\tweeks: \"Semaines\",\n\t\tmonths: \"Mois\",\n\t\tyears: \"Années\",\n\n\t\t/* message popup */\n\t\tmessage_ok: \"OK\",\n\t\tmessage_cancel: \"Annuler\",\n\n\t\t/* constraints */\n\t\tsection_constraint: \"Constraint\",\n\t\tconstraint_type: \"Constraint type\",\n\t\tconstraint_date: \"Constraint date\",\n\t\tasap: \"As Soon As Possible\",\n\t\talap: \"As Late As Possible\",\n\t\tsnet: \"Start No Earlier Than\",\n\t\tsnlt: \"Start No Later Than\",\n\t\tfnet: \"Finish No Earlier Than\",\n\t\tfnlt: \"Finish No Later Than\",\n\t\tmso: \"Must Start On\",\n\t\tmfo: \"Must Finish On\",\n\n\t\t/* resource control */\n\t\tresources_filter_placeholder: \"type to filter\",\n\t\tresources_filter_label: \"hide empty\",\n\n\t\t/* empty state screen */\n\t\tempty_state_text_link: \"Click here\",\n\t\tempty_state_text_description: \"to create your first task\",\n\n\t\t/* baselines control */\n\t\tbaselines_section_placeholder: \"Start adding a new baseline\",\n\t\tbaselines_add_button: \"Add Baseline\",\n\t\tbaselines_remove_button: \"Remove\",\n\t\tbaselines_remove_all_button: \"Remove All\",\n\n\t\t/* deadline control */\n\t\tdeadline_enable_button: \"Set\",\n\t\tdeadline_disable_button: \"Remove\"\n\t}\n};\n\nexport default locale;\n","const locale: IGanttLocale = {\n\tdate: {\n\t\tmonth_full: [\"ינואר\", \"פברואר\", \"מרץ\", \"אפריל\", \"מאי\", \"יוני\", \"יולי\", \"אוגוסט\", \"ספטמבר\", \"אוקטובר\", \"נובמבר\", \"דצמבר\"],\n\t\tmonth_short: [\"ינו\", \"פבר\", \"מרץ\", \"אפר\", \"מאי\", \"יונ\", \"יול\", \"אוג\", \"ספט\", \"אוק\", \"נוב\", \"דצמ\"],\n\t\tday_full: [\"ראשון\", \"שני\", \"שלישי\", \"רביעי\", \"חמישי\", \"שישי\", \"שבת\"],\n\t\tday_short: [\"א\", \"ב\", \"ג\", \"ד\", \"ה\", \"ו\", \"ש\"]\n\t},\n\tlabels: {\n\t\tnew_task: \"משימה חדש\",\n\t\ticon_save: \"שמור\",\n\t\ticon_cancel: \"בטל\",\n\t\ticon_details: \"פרטים\",\n\t\ticon_edit: \"ערוך\",\n\t\ticon_delete: \"מחק\",\n\t\tconfirm_closing: \"\", // Your changes will be lost, are your sure ?\n\t\tconfirm_deleting: \"ארוע ימחק סופית.להמשיך?\",\n\t\tsection_description: \"הסבר\",\n\t\tsection_time: \"תקופה\",\n\t\tsection_type: \"Type\",\n\t\tsection_deadline: \"Deadline\",\n\t\tsection_baselines: \"Baselines\",\n\t\t/* grid columns */\n\n\t\tcolumn_wbs: \"WBS\",\n\t\tcolumn_text: \"Task name\",\n\t\tcolumn_start_date: \"Start time\",\n\t\tcolumn_duration: \"Duration\",\n\t\tcolumn_add: \"\",\n\n\t\t/* link confirmation */\n\t\tlink: \"Link\",\n\t\tconfirm_link_deleting: \"will be deleted\",\n\t\tlink_start: \" (start)\",\n\t\tlink_end: \" (end)\",\n\n\t\ttype_task: \"Task\",\n\t\ttype_project: \"Project\",\n\t\ttype_milestone: \"Milestone\",\n\n\n\t\tminutes: \"Minutes\",\n\t\thours: \"Hours\",\n\t\tdays: \"Days\",\n\t\tweeks: \"Week\",\n\t\tmonths: \"Months\",\n\t\tyears: \"Years\",\n\n\t\t/* message popup */\n\t\tmessage_ok: \"OK\",\n\t\tmessage_cancel: \"בטל\",\n\n\t\t/* constraints */\n\t\tsection_constraint: \"Constraint\",\n\t\tconstraint_type: \"Constraint type\",\n\t\tconstraint_date: \"Constraint date\",\n\t\tasap: \"As Soon As Possible\",\n\t\talap: \"As Late As Possible\",\n\t\tsnet: \"Start No Earlier Than\",\n\t\tsnlt: \"Start No Later Than\",\n\t\tfnet: \"Finish No Earlier Than\",\n\t\tfnlt: \"Finish No Later Than\",\n\t\tmso: \"Must Start On\",\n\t\tmfo: \"Must Finish On\",\n\n\t\t/* resource control */\n\t\tresources_filter_placeholder: \"type to filter\",\n\t\tresources_filter_label: \"hide empty\",\n\n\t\t/* empty state screen */\n\t\tempty_state_text_link: \"Click here\",\n\t\tempty_state_text_description: \"to create your first task\",\n\n\t\t/* baselines control */\n\t\tbaselines_section_placeholder: \"Start adding a new baseline\",\n\t\tbaselines_add_button: \"Add Baseline\",\n\t\tbaselines_remove_button: \"Remove\",\n\t\tbaselines_remove_all_button: \"Remove All\",\n\n\t\t/* deadline control */\n\t\tdeadline_enable_button: \"Set\",\n\t\tdeadline_disable_button: \"Remove\"\n\t}\n};\n\nexport default locale;\n","/*\n  Translation by Davor\n http://docs.dhtmlx.com/gantt/desktop__localization.html#comment-2569116291\n */\n\nconst locale: IGanttLocale = {\n\tdate: {\n\t\tmonth_full: [\"Siječanj\", \"Veljača\", \"Ožujak\", \"Travanj\", \"Svibanj\", \"Lipanj\", \"Srpanj\", \"Kolovoz\", \"Rujan\", \"Listopad\", \"Studeni\", \"Prosinac\"],\n\t\tmonth_short: [\"Sij\", \"Velj\", \"Ožu\", \"Tra\", \"Svi\", \"Lip\", \"Srp\", \"Kol\", \"Ruj\", \"Lis\", \"Stu\", \"Pro\"],\n\t\tday_full: [\"Nedjelja\", \"Ponedjeljak\", \"Utorak\", \"Srijeda\", \"Četvrtak\", \"Petak\", \"Subota\"],\n\t\tday_short: [\"Ned\", \"Pon\", \"Uto\", \"Sri\", \"Čet\", \"Pet\", \"Sub\"]\n\t},\n\tlabels: {\n\t\tnew_task: \"Novi Zadatak\",\n\t\ticon_save: \"Spremi\",\n\t\ticon_cancel: \"Odustani\",\n\t\ticon_details: \"Detalji\",\n\t\ticon_edit: \"Izmjeni\",\n\t\ticon_delete: \"Obriši\",\n\t\tconfirm_closing: \"\",\n\t\tconfirm_deleting: \"Zadatak će biti trajno izbrisan, jeste li sigurni?\",\n\t\tsection_description: \"Opis\",\n\t\tsection_time: \"Vremenski Period\",\n\t\tsection_type: \"Tip\",\n\t\tsection_deadline: \"Deadline\",\n\t\tsection_baselines: \"Baselines\",\n\n\t\t/* grid columns */\n\t\tcolumn_wbs: \"WBS\",\n\t\tcolumn_text: \"Naziv Zadatka\",\n\t\tcolumn_start_date: \"Početno Vrijeme\",\n\t\tcolumn_duration: \"Trajanje\",\n\t\tcolumn_add: \"\",\n\n\t\t/* link confirmation */\n\t\tlink: \"Poveznica\",\n\t\tconfirm_link_deleting: \"će biti izbrisan\",\n\t\tlink_start: \" (početak)\",\n\t\tlink_end: \" (kraj)\",\n\n\t\ttype_task: \"Zadatak\",\n\t\ttype_project: \"Projekt\",\n\t\ttype_milestone: \"Milestone\",\n\n\t\tminutes: \"Minute\",\n\t\thours: \"Sati\",\n\t\tdays: \"Dani\",\n\t\tweeks: \"Tjedni\",\n\t\tmonths: \"Mjeseci\",\n\t\tyears: \"Godine\",\n\n\t\t/* message popup */\n\t\tmessage_ok: \"OK\",\n\t\tmessage_cancel: \"Odustani\",\n\n\t\t/* constraints */\n\t\tsection_constraint: \"Constraint\",\n\t\tconstraint_type: \"Constraint type\",\n\t\tconstraint_date: \"Constraint date\",\n\t\tasap: \"As Soon As Possible\",\n\t\talap: \"As Late As Possible\",\n\t\tsnet: \"Start No Earlier Than\",\n\t\tsnlt: \"Start No Later Than\",\n\t\tfnet: \"Finish No Earlier Than\",\n\t\tfnlt: \"Finish No Later Than\",\n\t\tmso: \"Must Start On\",\n\t\tmfo: \"Must Finish On\",\n\n\t\t/* resource control */\n\t\tresources_filter_placeholder: \"type to filter\",\n\t\tresources_filter_label: \"hide empty\",\n\n\t\t/* empty state screen */\n\t\tempty_state_text_link: \"Click here\",\n\t\tempty_state_text_description: \"to create your first task\",\n\n\t\t/* baselines control */\n\t\tbaselines_section_placeholder: \"Start adding a new baseline\",\n\t\tbaselines_add_button: \"Add Baseline\",\n\t\tbaselines_remove_button: \"Remove\",\n\t\tbaselines_remove_all_button: \"Remove All\",\n\n\t\t/* deadline control */\n\t\tdeadline_enable_button: \"Set\",\n\t\tdeadline_disable_button: \"Remove\"\n\t}\n};\n\nexport default locale;\n","const locale: IGanttLocale = {\n\tdate: {\n\t\tmonth_full: [\"Január\", \"Február\", \"Március\", \"Április\", \"Május\", \"Június\", \"Július\", \"Augusztus\", \"Szeptember\", \"Október\", \"November\", \"December\"],\n\t\tmonth_short: [\"Jan\", \"Feb\", \"Már\", \"Ápr\", \"Máj\", \"Jún\", \"Júl\", \"Aug\", \"Sep\", \"Okt\", \"Nov\", \"Dec\"],\n\t\tday_full: [\"Vasárnap\", \"Hétfõ\", \"Kedd\", \"Szerda\", \"Csütörtök\", \"Péntek\", \"szombat\"],\n\t\tday_short: [\"Va\", \"Hé\", \"Ke\", \"Sze\", \"Csü\", \"Pé\", \"Szo\"]\n\t},\n\tlabels: {\n\t\tnew_task: \"Új feladat\",\n\t\ticon_save: \"Mentés\",\n\t\ticon_cancel: \"Mégse\",\n\t\ticon_details: \"Részletek\",\n\t\ticon_edit: \"Szerkesztés\",\n\t\ticon_delete: \"Törlés\",\n\t\tconfirm_closing: \"\", // A változások elvesznek, biztosan folytatja? \"\n\t\tconfirm_deleting: \"Az esemény törölve lesz, biztosan folytatja?\",\n\t\tsection_description: \"Leírás\",\n\t\tsection_time: \"Idõszak\",\n\t\tsection_type: \"Type\",\n\t\tsection_deadline: \"Deadline\",\n\t\tsection_baselines: \"Baselines\",\n\t\t/* grid columns */\n\n\t\tcolumn_wbs: \"WBS\",\n\t\tcolumn_text: \"Task name\",\n\t\tcolumn_start_date: \"Start time\",\n\t\tcolumn_duration: \"Duration\",\n\t\tcolumn_add: \"\",\n\n\t\t/* link confirmation */\n\t\tlink: \"Link\",\n\t\tconfirm_link_deleting: \"will be deleted\",\n\t\tlink_start: \" (start)\",\n\t\tlink_end: \" (end)\",\n\n\t\ttype_task: \"Task\",\n\t\ttype_project: \"Project\",\n\t\ttype_milestone: \"Milestone\",\n\n\n\t\tminutes: \"Minutes\",\n\t\thours: \"Hours\",\n\t\tdays: \"Days\",\n\t\tweeks: \"Week\",\n\t\tmonths: \"Months\",\n\t\tyears: \"Years\",\n\n\t\t/* message popup */\n\t\tmessage_ok: \"OK\",\n\t\tmessage_cancel: \"Mégse\",\n\n\t\t/* constraints */\n\t\tsection_constraint: \"Constraint\",\n\t\tconstraint_type: \"Constraint type\",\n\t\tconstraint_date: \"Constraint date\",\n\t\tasap: \"As Soon As Possible\",\n\t\talap: \"As Late As Possible\",\n\t\tsnet: \"Start No Earlier Than\",\n\t\tsnlt: \"Start No Later Than\",\n\t\tfnet: \"Finish No Earlier Than\",\n\t\tfnlt: \"Finish No Later Than\",\n\t\tmso: \"Must Start On\",\n\t\tmfo: \"Must Finish On\",\n\n\t\t/* resource control */\n\t\tresources_filter_placeholder: \"type to filter\",\n\t\tresources_filter_label: \"hide empty\",\n\n\t\t/* empty state screen */\n\t\tempty_state_text_link: \"Click here\",\n\t\tempty_state_text_description: \"to create your first task\",\n\n\t\t/* baselines control */\n\t\tbaselines_section_placeholder: \"Start adding a new baseline\",\n\t\tbaselines_add_button: \"Add Baseline\",\n\t\tbaselines_remove_button: \"Remove\",\n\t\tbaselines_remove_all_button: \"Remove All\",\n\n\t\t/* deadline control */\n\t\tdeadline_enable_button: \"Set\",\n\t\tdeadline_disable_button: \"Remove\"\n\t}\n};\n\nexport default locale;\n","const locale: IGanttLocale = {\n\tdate: {\n\t\tmonth_full: [\"Januari\", \"Februari\", \"Maret\", \"April\", \"Mei\", \"Juni\", \"Juli\", \"Agustus\", \"September\", \"Oktober\", \"November\", \"Desember\"],\n\t\tmonth_short: [\"Jan\", \"Feb\", \"Mar\", \"Apr\", \"Mei\", \"Jun\", \"Jul\", \"Ags\", \"Sep\", \"Okt\", \"Nov\", \"Des\"],\n\t\tday_full: [\"Minggu\", \"Senin\", \"Selasa\", \"Rabu\", \"Kamis\", \"Jumat\", \"Sabtu\"],\n\t\tday_short: [\"Ming\", \"Sen\", \"Sel\", \"Rab\", \"Kam\", \"Jum\", \"Sab\"]\n\t},\n\tlabels: {\n\t\tnew_task: \"Tugas baru\",\n\t\ticon_save: \"Simpan\",\n\t\ticon_cancel: \"Batal\",\n\t\ticon_details: \"Detail\",\n\t\ticon_edit: \"Edit\",\n\t\ticon_delete: \"Hapus\",\n\t\tconfirm_closing: \"\", /* Perubahan tidak akan disimpan ? */\n\t\tconfirm_deleting: \"Acara akan dihapus\",\n\t\tsection_description: \"Keterangan\",\n\t\tsection_time: \"Periode\",\n\t\tsection_type: \"Type\",\n\t\tsection_deadline: \"Deadline\",\n\t\tsection_baselines: \"Baselines\",\n\t\t/* grid columns */\n\n\t\tcolumn_wbs: \"WBS\",\n\t\tcolumn_text: \"Task name\",\n\t\tcolumn_start_date: \"Start time\",\n\t\tcolumn_duration: \"Duration\",\n\t\tcolumn_add: \"\",\n\n\t\t/* link confirmation */\n\t\tlink: \"Link\",\n\t\tconfirm_link_deleting: \"will be deleted\",\n\t\tlink_start: \" (start)\",\n\t\tlink_end: \" (end)\",\n\n\t\ttype_task: \"Task\",\n\t\ttype_project: \"Project\",\n\t\ttype_milestone: \"Milestone\",\n\n\n\t\tminutes: \"Minutes\",\n\t\thours: \"Hours\",\n\t\tdays: \"Days\",\n\t\tweeks: \"Week\",\n\t\tmonths: \"Months\",\n\t\tyears: \"Years\",\n\n\t\t/* message popup */\n\t\tmessage_ok: \"OK\",\n\t\tmessage_cancel: \"Batal\",\n\n\t\t/* constraints */\n\t\tsection_constraint: \"Constraint\",\n\t\tconstraint_type: \"Constraint type\",\n\t\tconstraint_date: \"Constraint date\",\n\t\tasap: \"As Soon As Possible\",\n\t\talap: \"As Late As Possible\",\n\t\tsnet: \"Start No Earlier Than\",\n\t\tsnlt: \"Start No Later Than\",\n\t\tfnet: \"Finish No Earlier Than\",\n\t\tfnlt: \"Finish No Later Than\",\n\t\tmso: \"Must Start On\",\n\t\tmfo: \"Must Finish On\",\n\n\t\t/* resource control */\n\t\tresources_filter_placeholder: \"type to filter\",\n\t\tresources_filter_label: \"hide empty\",\n\n\t\t/* empty state screen */\n\t\tempty_state_text_link: \"Click here\",\n\t\tempty_state_text_description: \"to create your first task\",\n\n\t\t/* baselines control */\n\t\tbaselines_section_placeholder: \"Start adding a new baseline\",\n\t\tbaselines_add_button: \"Add Baseline\",\n\t\tbaselines_remove_button: \"Remove\",\n\t\tbaselines_remove_all_button: \"Remove All\",\n\n\t\t/* deadline control */\n\t\tdeadline_enable_button: \"Set\",\n\t\tdeadline_disable_button: \"Remove\"\n\t}\n};\n\nexport default locale;\n","/*\n Update 29/12/2015:\n New labels translation by ARCANGELI CLAUDIO\n\n */\n\nconst locale: IGanttLocale = {\n\tdate: {\n\t\tmonth_full: [\"Gennaio\", \"Febbraio\", \"Marzo\", \"Aprile\", \"Maggio\", \"Giugno\", \"Luglio\", \"Agosto\", \"Settembre\", \"Ottobre\", \"Novembre\", \"Dicembre\"],\n\t\tmonth_short: [\"Gen\", \"Feb\", \"Mar\", \"Apr\", \"Mag\", \"Giu\", \"Lug\", \"Ago\", \"Set\", \"Ott\", \"Nov\", \"Dic\"],\n\t\tday_full: [\"Domenica\", \"Lunedì\", \"Martedì\", \"Mercoledì\", \"Giovedì\", \"Venerdì\", \"Sabato\"],\n\t\tday_short: [\"Dom\", \"Lun\", \"Mar\", \"Mer\", \"Gio\", \"Ven\", \"Sab\"]\n\t},\n\tlabels: {\n\t\tnew_task: \"Nuovo compito\",\n\t\ticon_save: \"Salva\",\n\t\ticon_cancel: \"Chiudi\",\n\t\ticon_details: \"Dettagli\",\n\t\ticon_edit: \"Modifica\",\n\t\ticon_delete: \"Elimina\",\n\t\tconfirm_closing: \"\",// \"Sei sicuro di confermare la chiusura?\",\n\t\tconfirm_deleting: \"Sei sicuro di confermare l'eliminazione?\",\n\t\tsection_description: \"Descrizione\",\n\t\tsection_time: \"Periodo di tempo\",\n\t\tsection_type: \"Tipo\",\n\t\tsection_deadline: \"Deadline\",\n\t\tsection_baselines: \"Baselines\",\n\t\t/* grid columns */\n\n\t\tcolumn_wbs: \"WBS\",\n\t\tcolumn_text: \"Nome Attività\",\n\t\tcolumn_start_date: \"Inizio\",\n\t\tcolumn_duration: \"Durata\",\n\t\tcolumn_add: \"\",\n\n\t\t/* link confirmation */\n\t\tlink: \"Link\",\n\t\tconfirm_link_deleting: \"sarà eliminato\",\n\t\tlink_start: \" (inizio)\",\n\t\tlink_end: \" (fine)\",\n\n\t\ttype_task: \"Task\",\n\t\ttype_project: \"Project\",\n\t\ttype_milestone: \"Milestone\",\n\n\n\t\tminutes: \"Minuti\",\n\t\thours: \"Ore\",\n\t\tdays: \"Giorni\",\n\t\tweeks: \"Settimane\",\n\t\tmonths: \"Mesi\",\n\t\tyears: \"Anni\",\n\n\t\t/* message popup */\n\t\tmessage_ok: \"OK\",\n\t\tmessage_cancel: \"Chiudi\",\n\n\t\t/* constraints */\n\t\tsection_constraint: \"Constraint\",\n\t\tconstraint_type: \"Constraint type\",\n\t\tconstraint_date: \"Constraint date\",\n\t\tasap: \"As Soon As Possible\",\n\t\talap: \"As Late As Possible\",\n\t\tsnet: \"Start No Earlier Than\",\n\t\tsnlt: \"Start No Later Than\",\n\t\tfnet: \"Finish No Earlier Than\",\n\t\tfnlt: \"Finish No Later Than\",\n\t\tmso: \"Must Start On\",\n\t\tmfo: \"Must Finish On\",\n\n\t\t/* resource control */\n\t\tresources_filter_placeholder: \"type to filter\",\n\t\tresources_filter_label: \"hide empty\",\n\n\t\t/* empty state screen */\n\t\tempty_state_text_link: \"Click here\",\n\t\tempty_state_text_description: \"to create your first task\",\n\n\t\t/* baselines control */\n\t\tbaselines_section_placeholder: \"Start adding a new baseline\",\n\t\tbaselines_add_button: \"Add Baseline\",\n\t\tbaselines_remove_button: \"Remove\",\n\t\tbaselines_remove_all_button: \"Remove All\",\n\n\t\t/* deadline control */\n\t\tdeadline_enable_button: \"Set\",\n\t\tdeadline_disable_button: \"Remove\"\n\t}\n};\n\nexport default locale;\n","/*\n Translation by Genexus Japan Inc.\n */\n\nconst locale: IGanttLocale = {\n\tdate: {\n\t\tmonth_full: [\"1月\", \"2月\", \"3月\", \"4月\", \"5月\", \"6月\", \"7月\", \"8月\", \"9月\", \"10月\", \"11月\", \"12月\"],\n\t\tmonth_short: [\"1月\", \"2月\", \"3月\", \"4月\", \"5月\", \"6月\", \"7月\", \"8月\", \"9月\", \"10月\", \"11月\", \"12月\"],\n\t\tday_full: [\"日曜日\", \"月曜日\", \"火曜日\", \"水曜日\", \"木曜日\", \"金曜日\", \"土曜日\"],\n\t\tday_short: [\"日\", \"月\", \"火\", \"水\", \"木\", \"金\", \"土\"]\n\t},\n\tlabels: {\n\t\tnew_task: \"新しい仕事\",\n\t\ticon_save: \"保存\",\n\t\ticon_cancel: \"キャンセル\",\n\t\ticon_details: \"詳細\",\n\t\ticon_edit: \"編集\",\n\t\ticon_delete: \"削除\",\n\t\tconfirm_closing: \"\", // 変更が取り消されます、宜しいですか？\n\t\tconfirm_deleting: \"イベント完全に削除されます、宜しいですか？\",\n\t\tsection_description: \"デスクリプション\",\n\t\tsection_time: \"期間\",\n\t\tsection_type: \"Type\",\n\t\tsection_deadline: \"Deadline\",\n\t\tsection_baselines: \"Baselines\",\n\t\t/* grid columns */\n\n\t\tcolumn_wbs: \"WBS\",\n\t\tcolumn_text: \"Task name\",\n\t\tcolumn_start_date: \"Start time\",\n\t\tcolumn_duration: \"Duration\",\n\t\tcolumn_add: \"\",\n\n\t\t/* link confirmation */\n\t\tlink: \"Link\",\n\t\tconfirm_link_deleting: \"will be deleted\",\n\t\tlink_start: \" (start)\",\n\t\tlink_end: \" (end)\",\n\n\t\ttype_task: \"Task\",\n\t\ttype_project: \"Project\",\n\t\ttype_milestone: \"Milestone\",\n\n\n\t\tminutes: \"Minutes\",\n\t\thours: \"Hours\",\n\t\tdays: \"Days\",\n\t\tweeks: \"Week\",\n\t\tmonths: \"Months\",\n\t\tyears: \"Years\",\n\n\t\t/* message popup */\n\t\tmessage_ok: \"OK\",\n\t\tmessage_cancel: \"キャンセル\",\n\n\t\t/* constraints */\n\t\tsection_constraint: \"Constraint\",\n\t\tconstraint_type: \"Constraint type\",\n\t\tconstraint_date: \"Constraint date\",\n\t\tasap: \"As Soon As Possible\",\n\t\talap: \"As Late As Possible\",\n\t\tsnet: \"Start No Earlier Than\",\n\t\tsnlt: \"Start No Later Than\",\n\t\tfnet: \"Finish No Earlier Than\",\n\t\tfnlt: \"Finish No Later Than\",\n\t\tmso: \"Must Start On\",\n\t\tmfo: \"Must Finish On\",\n\n\t\t/* resource control */\n\t\tresources_filter_placeholder: \"type to filter\",\n\t\tresources_filter_label: \"hide empty\",\n\n\t\t/* empty state screen */\n\t\tempty_state_text_link: \"Click here\",\n\t\tempty_state_text_description: \"to create your first task\",\n\n\t\t/* baselines control */\n\t\tbaselines_section_placeholder: \"Start adding a new baseline\",\n\t\tbaselines_add_button: \"Add Baseline\",\n\t\tbaselines_remove_button: \"Remove\",\n\t\tbaselines_remove_all_button: \"Remove All\",\n\n\t\t/* deadline control */\n\t\tdeadline_enable_button: \"Set\",\n\t\tdeadline_disable_button: \"Remove\"\n\t}\n};\n\nexport default locale;\n","/*\n\tTranslated by cjkim@dbvalley.com\n*/\n\nconst locale: IGanttLocale = {\n\tdate: {\n\t\tmonth_full: [\"1월\", \"2월\", \"3월\", \"4월\", \"5월\", \"6월\", \"7월\", \"8월\", \"9월\", \"10월\", \"11월\", \"12월\"],\n\t\tmonth_short: [\"1월\", \"2월\", \"3월\", \"4월\", \"5월\", \"6월\", \"7월\", \"8월\", \"9월\", \"10월\", \"11월\", \"12월\"],\n\t\tday_full: [\"일요일\", \"월요일\", \"화요일\", \"수요일\", \"목요일\", \"금요일\", \"토요일\"],\n\t\tday_short: [\"일\", \"월\", \"화\", \"수\", \"목\", \"금\", \"토\"]\n\t},\n\tlabels: {\n\t\tnew_task: \"이름없는 작업\",\n\t\ticon_save: \"저장\",\n\t\ticon_cancel: \"취소\",\n\t\ticon_details: \"세부 사항\",\n\t\ticon_edit: \"수정\",\n\t\ticon_delete: \"삭제\",\n\t\tconfirm_closing: \"\",\n\t\tconfirm_deleting: \"작업을 삭제하시겠습니까?\",\n\t\tsection_description: \"설명\",\n\t\tsection_time: \"기간\",\n\t\tsection_type: \"Type\",\n\t\tsection_deadline: \"Deadline\",\n\t\tsection_baselines: \"Baselines\",\n\t\tcolumn_wbs: \"WBS\",\n\t\tcolumn_text: \"작업명\",\n\t\tcolumn_start_date: \"시작일\",\n\t\tcolumn_duration: \"기간\",\n\t\tcolumn_add: \"\",\n\t\tlink: \"전제\",\n\t\tconfirm_link_deleting: \"삭제 하시겠습니까?\",\n\t\tlink_start: \" (start)\",\n\t\tlink_end: \" (end)\",\n\t\ttype_task: \"작업\",\n\t\ttype_project: \"프로젝트\",\n\t\ttype_milestone: \"마일스톤\",\n\t\tminutes: \"분\",\n\t\thours: \"시간\",\n\t\tdays: \"일\",\n\t\tweeks: \"주\",\n\t\tmonths: \"달\",\n\t\tyears: \"년\",\n\n\t\t/* message popup */\n\t\tmessage_ok: \"OK\",\n\t\tmessage_cancel: \"취소\",\n\n\t\t/* constraints */\n\t\tsection_constraint: \"Constraint\",\n\t\tconstraint_type: \"Constraint type\",\n\t\tconstraint_date: \"Constraint date\",\n\t\tasap: \"As Soon As Possible\",\n\t\talap: \"As Late As Possible\",\n\t\tsnet: \"Start No Earlier Than\",\n\t\tsnlt: \"Start No Later Than\",\n\t\tfnet: \"Finish No Earlier Than\",\n\t\tfnlt: \"Finish No Later Than\",\n\t\tmso: \"Must Start On\",\n\t\tmfo: \"Must Finish On\",\n\n\t\t/* resource control */\n\t\tresources_filter_placeholder: \"type to filter\",\n\t\tresources_filter_label: \"hide empty\",\n\n\t\t/* empty state screen */\n\t\tempty_state_text_link: \"Click here\",\n\t\tempty_state_text_description: \"to create your first task\",\n\n\t\t/* baselines control */\n\t\tbaselines_section_placeholder: \"Start adding a new baseline\",\n\t\tbaselines_add_button: \"Add Baseline\",\n\t\tbaselines_remove_button: \"Remove\",\n\t\tbaselines_remove_all_button: \"Remove All\",\n\n\t\t/* deadline control */\n\t\tdeadline_enable_button: \"Set\",\n\t\tdeadline_disable_button: \"Remove\"\n\t}\n};\n\nexport default locale;\n","export default class LocaleManager{\n\tprivate _locales:{[key:string]: IGanttLocale };\n\n\tconstructor(config: {[key:string]: IGanttLocale }){\n\t\tthis._locales = {};\n\t\tfor(const i in config){\n\t\t\tthis._locales[i] = config[i];\n\t\t}\n\t}\n\n\taddLocale = (name: string, locale: IGanttLocale) => {\n\t\tthis._locales[name] = locale;\n\t};\n\n\tgetLocale = (name: string): IGanttLocale => {\n\t\treturn this._locales[name];\n\t};\n}","const locale: IGanttLocale = {\n\tdate: {\n\t\tmonth_full: [\"Januar\", \"Februar\", \"Mars\", \"April\", \"Mai\", \"Juni\", \"Juli\", \"August\", \"September\", \"Oktober\", \"November\", \"Desember\"],\n\t\tmonth_short: [\"Jan\", \"Feb\", \"Mar\", \"Apr\", \"Mai\", \"Jun\", \"Jul\", \"Aug\", \"Sep\", \"Okt\", \"Nov\", \"Des\"],\n\t\tday_full: [\"Søndag\", \"Mandag\", \"Tirsdag\", \"Onsdag\", \"Torsdag\", \"Fredag\", \"Lørdag\"],\n\t\tday_short: [\"Søn\", \"Mon\", \"Tir\", \"Ons\", \"Tor\", \"Fre\", \"Lør\"]\n\t},\n\tlabels: {\n\t\tnew_task: \"Ny oppgave\",\n\t\ticon_save: \"Lagre\",\n\t\ticon_cancel: \"Avbryt\",\n\t\ticon_details: \"Detaljer\",\n\t\ticon_edit: \"Rediger\",\n\t\ticon_delete: \"Slett\",\n\t\tconfirm_closing: \"\", // Your changes will be lost, are your sure ?\n\t\tconfirm_deleting: \"Hendelsen vil bli slettet permanent. Er du sikker?\",\n\t\tsection_description: \"Beskrivelse\",\n\t\tsection_time: \"Tidsperiode\",\n\t\tsection_type: \"Type\",\n\t\tsection_deadline: \"Deadline\",\n\t\tsection_baselines: \"Baselines\",\n\t\t/* grid columns */\n\n\t\tcolumn_wbs: \"WBS\",\n\t\tcolumn_text: \"Task name\",\n\t\tcolumn_start_date: \"Start time\",\n\t\tcolumn_duration: \"Duration\",\n\t\tcolumn_add: \"\",\n\n\t\t/* link confirmation */\n\t\tlink: \"Link\",\n\t\tconfirm_link_deleting: \"will be deleted\",\n\t\tlink_start: \" (start)\",\n\t\tlink_end: \" (end)\",\n\n\t\ttype_task: \"Task\",\n\t\ttype_project: \"Project\",\n\t\ttype_milestone: \"Milestone\",\n\n\n\t\tminutes: \"Minutes\",\n\t\thours: \"Hours\",\n\t\tdays: \"Days\",\n\t\tweeks: \"Week\",\n\t\tmonths: \"Months\",\n\t\tyears: \"Years\",\n\n\t\t/* message popup */\n\t\tmessage_ok: \"OK\",\n\t\tmessage_cancel: \"Avbryt\",\n\n\t\t/* constraints */\n\t\tsection_constraint: \"Constraint\",\n\t\tconstraint_type: \"Constraint type\",\n\t\tconstraint_date: \"Constraint date\",\n\t\tasap: \"As Soon As Possible\",\n\t\talap: \"As Late As Possible\",\n\t\tsnet: \"Start No Earlier Than\",\n\t\tsnlt: \"Start No Later Than\",\n\t\tfnet: \"Finish No Earlier Than\",\n\t\tfnlt: \"Finish No Later Than\",\n\t\tmso: \"Must Start On\",\n\t\tmfo: \"Must Finish On\",\n\n\t\t/* resource control */\n\t\tresources_filter_placeholder: \"type to filter\",\n\t\tresources_filter_label: \"hide empty\",\n\n\t\t/* empty state screen */\n\t\tempty_state_text_link: \"Click here\",\n\t\tempty_state_text_description: \"to create your first task\",\n\n\t\t/* baselines control */\n\t\tbaselines_section_placeholder: \"Start adding a new baseline\",\n\t\tbaselines_add_button: \"Add Baseline\",\n\t\tbaselines_remove_button: \"Remove\",\n\t\tbaselines_remove_all_button: \"Remove All\",\n\n\t\t/* deadline control */\n\t\tdeadline_enable_button: \"Set\",\n\t\tdeadline_disable_button: \"Remove\"\n\t}\n};\n\nexport default locale;\n","const locale: IGanttLocale = {\n\tdate: {\n\t\tmonth_full: [\"Januari\", \"Februari\", \"Maart\", \"April\", \"Mei\", \"Juni\", \"Juli\", \"Augustus\", \"September\", \"Oktober\", \"November\", \"December\"],\n\t\tmonth_short: [\"Jan\", \"Feb\", \"mrt\", \"Apr\", \"Mei\", \"Jun\", \"Jul\", \"Aug\", \"Sep\", \"Okt\", \"Nov\", \"Dec\"],\n\t\tday_full: [\"Zondag\", \"Maandag\", \"Dinsdag\", \"Woensdag\", \"Donderdag\", \"Vrijdag\", \"Zaterdag\"],\n\t\tday_short: [\"Zo\", \"Ma\", \"Di\", \"Wo\", \"Do\", \"Vr\", \"Za\"]\n\t},\n\tlabels: {\n\t\tnew_task: \"Nieuwe taak\",\n\t\ticon_save: \"Opslaan\",\n\t\ticon_cancel: \"Annuleren\",\n\t\ticon_details: \"Details\",\n\t\ticon_edit: \"Bewerken\",\n\t\ticon_delete: \"Verwijderen\",\n\t\tconfirm_closing: \"\", // Your changes will be lost, are your sure ?\n\t\tconfirm_deleting: \"Item zal permanent worden verwijderd, doorgaan?\",\n\t\tsection_description: \"Beschrijving\",\n\t\tsection_time: \"Tijd periode\",\n\t\tsection_type: \"Type\",\n\t\tsection_deadline: \"Deadline\",\n\t\tsection_baselines: \"Baselines\",\n\t\t/* grid columns */\n\n\t\tcolumn_wbs: \"WBS\",\n\t\tcolumn_text: \"Taak omschrijving\",\n\t\tcolumn_start_date: \"Startdatum\",\n\t\tcolumn_duration: \"Duur\",\n\t\tcolumn_add: \"\",\n\n\t\t/* link confirmation */\n\t\tlink: \"Koppeling\",\n\t\tconfirm_link_deleting: \"zal worden verwijderd\",\n\t\tlink_start: \" (start)\",\n\t\tlink_end: \" (eind)\",\n\n\t\ttype_task: \"Task\",\n\t\ttype_project: \"Project\",\n\t\ttype_milestone: \"Milestone\",\n\n\n\t\tminutes: \"minuten\",\n\t\thours: \"uren\",\n\t\tdays: \"dagen\",\n\t\tweeks: \"weken\",\n\t\tmonths: \"maanden\",\n\t\tyears: \"jaren\",\n\n\t\t/* message popup */\n\t\tmessage_ok: \"OK\",\n\t\tmessage_cancel: \"Annuleren\",\n\n\t\t/* constraints */\n\t\tsection_constraint: \"Constraint\",\n\t\tconstraint_type: \"Constraint type\",\n\t\tconstraint_date: \"Constraint date\",\n\t\tasap: \"As Soon As Possible\",\n\t\talap: \"As Late As Possible\",\n\t\tsnet: \"Start No Earlier Than\",\n\t\tsnlt: \"Start No Later Than\",\n\t\tfnet: \"Finish No Earlier Than\",\n\t\tfnlt: \"Finish No Later Than\",\n\t\tmso: \"Must Start On\",\n\t\tmfo: \"Must Finish On\",\n\n\t\t/* resource control */\n\t\tresources_filter_placeholder: \"type to filter\",\n\t\tresources_filter_label: \"hide empty\",\n\n\t\t/* empty state screen */\n\t\tempty_state_text_link: \"Click here\",\n\t\tempty_state_text_description: \"to create your first task\",\n\n\t\t/* baselines control */\n\t\tbaselines_section_placeholder: \"Start adding a new baseline\",\n\t\tbaselines_add_button: \"Add Baseline\",\n\t\tbaselines_remove_button: \"Remove\",\n\t\tbaselines_remove_all_button: \"Remove All\",\n\n\t\t/* deadline control */\n\t\tdeadline_enable_button: \"Set\",\n\t\tdeadline_disable_button: \"Remove\"\n\t}\n};\n\nexport default locale;\n","const locale: IGanttLocale = {\n\tdate: {\n\t\tmonth_full: [\"Januar\", \"Februar\", \"Mars\", \"April\", \"Mai\", \"Juni\", \"Juli\", \"August\", \"September\", \"Oktober\", \"November\", \"Desember\"],\n\t\tmonth_short: [\"Jan\", \"Feb\", \"Mar\", \"Apr\", \"Mai\", \"Jun\", \"Jul\", \"Aug\", \"Sep\", \"Okt\", \"Nov\", \"Des\"],\n\t\tday_full: [\"Søndag\", \"Mandag\", \"Tirsdag\", \"Onsdag\", \"Torsdag\", \"Fredag\", \"Lørdag\"],\n\t\tday_short: [\"Søn\", \"Man\", \"Tir\", \"Ons\", \"Tor\", \"Fre\", \"Lør\"]\n\t},\n\tlabels: {\n\t\tnew_task: \"Ny oppgave\",\n\t\ticon_save: \"Lagre\",\n\t\ticon_cancel: \"Avbryt\",\n\t\ticon_details: \"Detaljer\",\n\t\ticon_edit: \"Endre\",\n\t\ticon_delete: \"Slett\",\n\t\tconfirm_closing: \"Endringer blir ikke lagret, er du sikker?\", // Endringer blir ikke lagret, er du sikker?\n\t\tconfirm_deleting: \"Oppføringen vil bli slettet, er du sikker?\",\n\t\tsection_description: \"Beskrivelse\",\n\t\tsection_time: \"Tidsperiode\",\n\t\tsection_type: \"Type\",\n\t\tsection_deadline: \"Deadline\",\n\t\tsection_baselines: \"Baselines\",\n\t\t/* grid columns */\n\n\t\tcolumn_wbs: \"WBS\",\n\t\tcolumn_text: \"Task name\",\n\t\tcolumn_start_date: \"Start time\",\n\t\tcolumn_duration: \"Duration\",\n\t\tcolumn_add: \"\",\n\n\t\t/* link confirmation */\n\t\tlink: \"Link\",\n\t\tconfirm_link_deleting: \"will be deleted\",\n\t\tlink_start: \" (start)\",\n\t\tlink_end: \" (end)\",\n\n\t\ttype_task: \"Task\",\n\t\ttype_project: \"Project\",\n\t\ttype_milestone: \"Milestone\",\n\n\n\t\tminutes: \"Minutes\",\n\t\thours: \"Hours\",\n\t\tdays: \"Days\",\n\t\tweeks: \"Week\",\n\t\tmonths: \"Months\",\n\t\tyears: \"Years\",\n\n\t\t/* message popup */\n\t\tmessage_ok: \"OK\",\n\t\tmessage_cancel: \"Avbryt\",\n\n\t\t/* constraints */\n\t\tsection_constraint: \"Constraint\",\n\t\tconstraint_type: \"Constraint type\",\n\t\tconstraint_date: \"Constraint date\",\n\t\tasap: \"As Soon As Possible\",\n\t\talap: \"As Late As Possible\",\n\t\tsnet: \"Start No Earlier Than\",\n\t\tsnlt: \"Start No Later Than\",\n\t\tfnet: \"Finish No Earlier Than\",\n\t\tfnlt: \"Finish No Later Than\",\n\t\tmso: \"Must Start On\",\n\t\tmfo: \"Must Finish On\",\n\n\t\t/* resource control */\n\t\tresources_filter_placeholder: \"type to filter\",\n\t\tresources_filter_label: \"hide empty\",\n\n\t\t/* empty state screen */\n\t\tempty_state_text_link: \"Click here\",\n\t\tempty_state_text_description: \"to create your first task\",\n\n\t\t/* baselines control */\n\t\tbaselines_section_placeholder: \"Start adding a new baseline\",\n\t\tbaselines_add_button: \"Add Baseline\",\n\t\tbaselines_remove_button: \"Remove\",\n\t\tbaselines_remove_all_button: \"Remove All\",\n\n\t\t/* deadline control */\n\t\tdeadline_enable_button: \"Set\",\n\t\tdeadline_disable_button: \"Remove\"\n\t}\n};\n\nexport default locale;\n","const locale: IGanttLocale = {\n\tdate: {\n\t\tmonth_full: [\"Styczeń\", \"Luty\", \"Marzec\", \"Kwiecień\", \"Maj\", \"Czerwiec\", \"Lipiec\", \"Sierpień\", \"Wrzesień\", \"Październik\", \"Listopad\", \"Grudzień\"],\n\t\tmonth_short: [\"Sty\", \"Lut\", \"Mar\", \"Kwi\", \"Maj\", \"Cze\", \"Lip\", \"Sie\", \"Wrz\", \"Paź\", \"Lis\", \"Gru\"],\n\t\tday_full: [\"Niedziela\", \"Poniedziałek\", \"Wtorek\", \"Środa\", \"Czwartek\", \"Piątek\", \"Sobota\"],\n\t\tday_short: [\"Nie\", \"Pon\", \"Wto\", \"Śro\", \"Czw\", \"Pią\", \"Sob\"]\n\t},\n\tlabels: {\n\t\tnew_task: \"Nowe zadanie\",\n\t\ticon_save: \"Zapisz\",\n\t\ticon_cancel: \"Anuluj\",\n\t\ticon_details: \"Szczegóły\",\n\t\ticon_edit: \"Edytuj\",\n\t\ticon_delete: \"Usuń\",\n\t\tconfirm_closing: \"\", // Zmiany zostaną usunięte, jesteś pewien?\n\t\tconfirm_deleting: \"Zdarzenie zostanie usunięte na zawsze, kontynuować?\",\n\t\tsection_description: \"Opis\",\n\t\tsection_time: \"Okres czasu\",\n\t\tsection_type: \"Typ\",\n\t\tsection_deadline: \"Deadline\",\n\t\tsection_baselines: \"Baselines\",\n\t\t/* grid columns */\n\n\t\tcolumn_wbs: \"WBS\",\n\t\tcolumn_text: \"Nazwa zadania\",\n\t\tcolumn_start_date: \"Początek\",\n\t\tcolumn_duration: \"Czas trwania\",\n\t\tcolumn_add: \"\",\n\n\t\t/* link confirmation */\n\t\tlink: \"Link\",\n\t\tconfirm_link_deleting: \"zostanie usunięty\",\n\t\tlink_start: \" (początek)\",\n\t\tlink_end: \" (koniec)\",\n\n\t\ttype_task: \"Zadanie\",\n\t\ttype_project: \"Projekt\",\n\t\ttype_milestone: \"Milestone\",\n\n\n\t\tminutes: \"Minuty\",\n\t\thours: \"Godziny\",\n\t\tdays: \"Dni\",\n\t\tweeks: \"Tydzień\",\n\t\tmonths: \"Miesiące\",\n\t\tyears: \"Lata\",\n\n\t\t/* message popup */\n\t\tmessage_ok: \"OK\",\n\t\tmessage_cancel: \"Anuluj\",\n\n\t\t/* constraints */\n\t\tsection_constraint: \"Constraint\",\n\t\tconstraint_type: \"Constraint type\",\n\t\tconstraint_date: \"Constraint date\",\n\t\tasap: \"As Soon As Possible\",\n\t\talap: \"As Late As Possible\",\n\t\tsnet: \"Start No Earlier Than\",\n\t\tsnlt: \"Start No Later Than\",\n\t\tfnet: \"Finish No Earlier Than\",\n\t\tfnlt: \"Finish No Later Than\",\n\t\tmso: \"Must Start On\",\n\t\tmfo: \"Must Finish On\",\n\n\t\t/* resource control */\n\t\tresources_filter_placeholder: \"type to filter\",\n\t\tresources_filter_label: \"hide empty\",\n\n\t\t/* empty state screen */\n\t\tempty_state_text_link: \"Click here\",\n\t\tempty_state_text_description: \"to create your first task\",\n\n\t\t/* baselines control */\n\t\tbaselines_section_placeholder: \"Start adding a new baseline\",\n\t\tbaselines_add_button: \"Add Baseline\",\n\t\tbaselines_remove_button: \"Remove\",\n\t\tbaselines_remove_all_button: \"Remove All\",\n\n\t\t/* deadline control */\n\t\tdeadline_enable_button: \"Set\",\n\t\tdeadline_disable_button: \"Remove\"\n\t}\n};\n\nexport default locale;\n","/*\n\n TRANSLATION BY MATTHEUS PIROVANI RORIZ GONЗALVES\n\n mattheusroriz@hotmail.com / mattheus.pirovani@gmail.com /\n\n www.atrixian.com.br\n\n\n Updated by Jorge Albernaz Martins\n\n jorgefox@hotmail.com\n\n www.redfox.inf.br\n\n JorgeFox\n\n*/\n\nconst locale: IGanttLocale = {\n\tdate: {\n\t\tmonth_full: [\"Janeiro\", \"Fevereiro\", \"Março\", \"Abril\", \"Maio\", \"Junho\", \"Julho\", \"Agosto\", \"Setembro\", \"Outubro\", \"Novembro\", \"Dezembro\"],\n\t\tmonth_short: [\"Jan\", \"Fev\", \"Mar\", \"Abr\", \"Mai\", \"Jun\", \"Jul\", \"Ago\", \"Set\", \"Out\", \"Nov\", \"Dez\"],\n\t\tday_full: [\"Domingo\", \"Segunda\", \"Terça\", \"Quarta\", \"Quinta\", \"Sexta\", \"Sábado\"],\n\t\tday_short: [\"Dom\", \"Seg\", \"Ter\", \"Qua\", \"Qui\", \"Sex\", \"Sab\"]\n\t},\n\tlabels: {\n\t\tnew_task: \"Nova tarefa\",\n\t\ticon_save: \"Salvar\",\n\t\ticon_cancel: \"Cancelar\",\n\t\ticon_details: \"Detalhes\",\n\t\ticon_edit: \"Editar\",\n\t\ticon_delete: \"Excluir\",\n\t\tconfirm_closing: \"\",// Suas alterações serão perdidas, confirme?\n\t\tconfirm_deleting: \"As tarefas serão excluidas permanentemente, confirme?\",\n\t\tsection_description: \"Descrição\",\n\t\tsection_time: \"Período\",\n\t\tsection_type: \"Tipo\",\n\t\tsection_deadline: \"Deadline\",\n\t\tsection_baselines: \"Baselines\",\n\t\t/* grid columns */\n\n\t\tcolumn_wbs: \"EAP\",\n\t\tcolumn_text: \"Nome tarefa\",\n\t\tcolumn_start_date: \"Data início\",\n\t\tcolumn_duration: \"Duração\",\n\t\tcolumn_add: \"\",\n\n\t\t/* link confirmation */\n\t\tlink: \"Link\",\n\t\tconfirm_link_deleting: \"Será excluído!\",\n\t\tlink_start: \" (início)\",\n\t\tlink_end: \" (fim)\",\n\n\t\ttype_task: \"Task\",\n\t\ttype_project: \"Projeto\",\n\t\ttype_milestone: \"Marco\",\n\n\n\t\tminutes: \"Minutos\",\n\t\thours: \"Horas\",\n\t\tdays: \"Dias\",\n\t\tweeks: \"Semanas\",\n\t\tmonths: \"Meses\",\n\t\tyears: \"Anos\",\n\n\t\t/* message popup */\n\t\tmessage_ok: \"OK\",\n\t\tmessage_cancel: \"Cancelar\",\n\n\t\t/* constraints */\n\t\tsection_constraint: \"Restrição\",\n\t\tconstraint_type: \"Tipo Restrição\",\n\t\tconstraint_date: \"Data restrição\",\n\t\tasap: \"Mais breve possível\",\n\t\talap: \"Mais tarde possível\",\n\t\tsnet: \"Não começar antes de\",\n\t\tsnlt: \"Não começar depois de\",\n\t\tfnet: \"Não terminar antes de\",\n\t\tfnlt: \"Não terminar depois de\",\n\t\tmso: \"Precisa começar em\",\n\t\tmfo: \"Precisa terminar em\",\n\n\t\t/* resource control */\n\t\tresources_filter_placeholder: \"Tipo de filtros\",\n\t\tresources_filter_label: \"Ocultar vazios\",\n\n\t\t/* empty state screen */\n\t\tempty_state_text_link: \"Click here\",\n\t\tempty_state_text_description: \"to create your first task\",\n\n\t\t/* baselines control */\n\t\tbaselines_section_placeholder: \"Start adding a new baseline\",\n\t\tbaselines_add_button: \"Add Baseline\",\n\t\tbaselines_remove_button: \"Remove\",\n\t\tbaselines_remove_all_button: \"Remove All\",\n\n\t\t/* deadline control */\n\t\tdeadline_enable_button: \"Set\",\n\t\tdeadline_disable_button: \"Remove\"\n\t}\n};\n\nexport default locale;\n","/*\n\tTraducere de Ovidiu Lixandru: http://www.madball.ro\n */\n\nconst locale: IGanttLocale = {\n\tdate: {\n\t\tmonth_full: [\"Ianuarie\", \"Februarie\", \"Martie\", \"Aprilie\", \"Mai\", \"Iunie\", \"Iulie\", \"August\", \"Septembrie\", \"Octombrie\", \"November\", \"December\"],\n\t\tmonth_short: [\"Ian\", \"Feb\", \"Mar\", \"Apr\", \"Mai\", \"Iun\", \"Iul\", \"Aug\", \"Sep\", \"Oct\", \"Nov\", \"Dec\"],\n\t\tday_full: [\"Duminica\", \"Luni\", \"Marti\", \"Miercuri\", \"Joi\", \"Vineri\", \"Sambata\"],\n\t\tday_short: [\"Du\", \"Lu\", \"Ma\", \"Mi\", \"Jo\", \"Vi\", \"Sa\"]\n\t},\n\tlabels: {\n\t\tnew_task: \"Sarcina noua\",\n\t\ticon_save: \"Salveaza\",\n\t\ticon_cancel: \"Anuleaza\",\n\t\ticon_details: \"Detalii\",\n\t\ticon_edit: \"Editeaza\",\n\t\ticon_delete: \"Sterge\",\n\t\tconfirm_closing: \"Schimbarile nu vor fi salvate, esti sigur?\",// Your changes will be lost, are your sure ?\n\t\tconfirm_deleting: \"Evenimentul va fi sters permanent, esti sigur?\",\n\t\tsection_description: \"Descriere\",\n\t\tsection_time: \"Interval\",\n\t\tsection_type: \"Type\",\n\t\tsection_deadline: \"Deadline\",\n\t\tsection_baselines: \"Baselines\",\n\t\t/* grid columns */\n\n\t\tcolumn_wbs: \"WBS\",\n\t\tcolumn_text: \"Task name\",\n\t\tcolumn_start_date: \"Start time\",\n\t\tcolumn_duration: \"Duration\",\n\t\tcolumn_add: \"\",\n\n\t\t/* link confirmation */\n\t\tlink: \"Link\",\n\t\tconfirm_link_deleting: \"will be deleted\",\n\t\tlink_start: \" (start)\",\n\t\tlink_end: \" (end)\",\n\n\t\ttype_task: \"Task\",\n\t\ttype_project: \"Project\",\n\t\ttype_milestone: \"Milestone\",\n\n\n\t\tminutes: \"Minutes\",\n\t\thours: \"Hours\",\n\t\tdays: \"Days\",\n\t\tweeks: \"Week\",\n\t\tmonths: \"Months\",\n\t\tyears: \"Years\",\n\n\t\t/* message popup */\n\t\tmessage_ok: \"OK\",\n\t\tmessage_cancel: \"Anuleaza\",\n\n\t\t/* constraints */\n\t\tsection_constraint: \"Constraint\",\n\t\tconstraint_type: \"Constraint type\",\n\t\tconstraint_date: \"Constraint date\",\n\t\tasap: \"As Soon As Possible\",\n\t\talap: \"As Late As Possible\",\n\t\tsnet: \"Start No Earlier Than\",\n\t\tsnlt: \"Start No Later Than\",\n\t\tfnet: \"Finish No Earlier Than\",\n\t\tfnlt: \"Finish No Later Than\",\n\t\tmso: \"Must Start On\",\n\t\tmfo: \"Must Finish On\",\n\n\t\t/* resource control */\n\t\tresources_filter_placeholder: \"type to filter\",\n\t\tresources_filter_label: \"hide empty\",\n\n\t\t/* empty state screen */\n\t\tempty_state_text_link: \"Click here\",\n\t\tempty_state_text_description: \"to create your first task\",\n\n\t\t/* baselines control */\n\t\tbaselines_section_placeholder: \"Start adding a new baseline\",\n\t\tbaselines_add_button: \"Add Baseline\",\n\t\tbaselines_remove_button: \"Remove\",\n\t\tbaselines_remove_all_button: \"Remove All\",\n\n\t\t/* deadline control */\n\t\tdeadline_enable_button: \"Set\",\n\t\tdeadline_disable_button: \"Remove\"\n\t}\n};\n\nexport default locale;\n","const locale: IGanttLocale = {\n\tdate: {\n\t\tmonth_full: [\"Январь\", \"Февраль\", \"Март\", \"Апрель\", \"Maй\", \"Июнь\", \"Июль\", \"Август\", \"Сентябрь\", \"Oктябрь\", \"Ноябрь\", \"Декабрь\"],\n\t\tmonth_short: [\"Янв\", \"Фев\", \"Maр\", \"Aпр\", \"Maй\", \"Июн\", \"Июл\", \"Aвг\", \"Сен\", \"Окт\", \"Ноя\", \"Дек\"],\n\t\tday_full: [\"Воскресенье\", \"Понедельник\", \"Вторник\", \"Среда\", \"Четверг\", \"Пятница\", \"Суббота\"],\n\t\tday_short: [\"Вс\", \"Пн\", \"Вт\", \"Ср\", \"Чт\", \"Пт\", \"Сб\"]\n\t},\n\tlabels: {\n\t\tnew_task: \"Новое задание\",\n\t\ticon_save: \"Сохранить\",\n\t\ticon_cancel: \"Отменить\",\n\t\ticon_details: \"Детали\",\n\t\ticon_edit: \"Изменить\",\n\t\ticon_delete: \"Удалить\",\n\t\tconfirm_closing: \"\", // Ваши изменения будут потеряны, продолжить?\n\t\tconfirm_deleting: \"Событие будет удалено безвозвратно, продолжить?\",\n\t\tsection_description: \"Описание\",\n\t\tsection_time: \"Период времени\",\n\t\tsection_type: \"Тип\",\n\t\tsection_deadline: \"Deadline\",\n\t\tsection_baselines: \"Baselines\",\n\t\t/* grid columns */\n\n\t\tcolumn_wbs: \"ИСР\",\n\t\tcolumn_text: \"Задача\",\n\t\tcolumn_start_date: \"Начало\",\n\t\tcolumn_duration: \"Длительность\",\n\t\tcolumn_add: \"\",\n\n\t\t/* link confirmation */\n\t\tlink: \"Связь\",\n\t\tconfirm_link_deleting: \"будет удалена\",\n\t\tlink_start: \" (начало)\",\n\t\tlink_end: \" (конец)\",\n\n\t\ttype_task: \"Task\",\n\t\ttype_project: \"Project\",\n\t\ttype_milestone: \"Milestone\",\n\n\n\t\tminutes: \"Минута\",\n\t\thours: \"Час\",\n\t\tdays: \"День\",\n\t\tweeks: \"Неделя\",\n\t\tmonths: \"Месяц\",\n\t\tyears: \"Год\",\n\n\t\t/* message popup */\n\t\tmessage_ok: \"OK\",\n\t\tmessage_cancel: \"Отменить\",\n\n\t\t/* constraints */\n\t\tsection_constraint: \"Constraint\",\n\t\tconstraint_type: \"Constraint type\",\n\t\tconstraint_date: \"Constraint date\",\n\t\tasap: \"As Soon As Possible\",\n\t\talap: \"As Late As Possible\",\n\t\tsnet: \"Start No Earlier Than\",\n\t\tsnlt: \"Start No Later Than\",\n\t\tfnet: \"Finish No Earlier Than\",\n\t\tfnlt: \"Finish No Later Than\",\n\t\tmso: \"Must Start On\",\n\t\tmfo: \"Must Finish On\",\n\n\t\t/* resource control */\n\t\tresources_filter_placeholder: \"начните вводить слово для фильтрации\",\n\t\tresources_filter_label: \"спрятать не установленные\",\n\n\t\t/* empty state screen */\n\t\tempty_state_text_link: \"Click here\",\n\t\tempty_state_text_description: \"to create your first task\",\n\n\t\t/* baselines control */\n\t\tbaselines_section_placeholder: \"Start adding a new baseline\",\n\t\tbaselines_add_button: \"Add Baseline\",\n\t\tbaselines_remove_button: \"Remove\",\n\t\tbaselines_remove_all_button: \"Remove All\",\n\n\t\t/* deadline control */\n\t\tdeadline_enable_button: \"Set\",\n\t\tdeadline_disable_button: \"Remove\"\n\t}\n};\n\nexport default locale;\n","const locale: IGanttLocale = {\n\tdate: {\n\t\tmonth_full: [\"Januar\", \"Februar\", \"Marec\", \"April\", \"Maj\", \"Junij\", \"Julij\", \"Avgust\", \"September\", \"Oktober\", \"November\", \"December\"],\n\t\tmonth_short: [\"Jan\", \"Feb\", \"Mar\", \"Apr\", \"Maj\", \"Jun\", \"Jul\", \"Aug\", \"Sep\", \"Okt\", \"Nov\", \"Dec\"],\n\t\tday_full: [\"Nedelja\", \"Ponedeljek\", \"Torek\", \"Sreda\", \"Četrtek\", \"Petek\", \"Sobota\"],\n\t\tday_short: [\"Ned\", \"Pon\", \"Tor\", \"Sre\", \"Čet\", \"Pet\", \"Sob\"]\n\t},\n\tlabels: {\n\t\tnew_task: \"Nova naloga\",\n\t\ticon_save: \"Shrani\",\n\t\ticon_cancel: \"Prekliči\",\n\t\ticon_details: \"Podrobnosti\",\n\t\ticon_edit: \"Uredi\",\n\t\ticon_delete: \"Izbriši\",\n\t\tconfirm_closing: \"\", // Spremembe ne bodo shranjene. Želite nadaljevati ?\n\t\tconfirm_deleting: \"Dogodek bo izbrisan. Želite nadaljevati?\",\n\t\tsection_description: \"Opis\",\n\t\tsection_time: \"Časovni okvir\",\n\t\tsection_type: \"Type\",\n\t\tsection_deadline: \"Deadline\",\n\t\tsection_baselines: \"Baselines\",\n\t\t/* grid columns */\n\n\t\tcolumn_wbs: \"WBS\",\n\t\tcolumn_text: \"Task name\",\n\t\tcolumn_start_date: \"Start time\",\n\t\tcolumn_duration: \"Duration\",\n\t\tcolumn_add: \"\",\n\n\t\t/* link confirmation */\n\t\tlink: \"Link\",\n\t\tconfirm_link_deleting: \"will be deleted\",\n\t\tlink_start: \" (start)\",\n\t\tlink_end: \" (end)\",\n\n\t\ttype_task: \"Task\",\n\t\ttype_project: \"Project\",\n\t\ttype_milestone: \"Milestone\",\n\n\n\t\tminutes: \"Minutes\",\n\t\thours: \"Hours\",\n\t\tdays: \"Days\",\n\t\tweeks: \"Week\",\n\t\tmonths: \"Months\",\n\t\tyears: \"Years\",\n\n\t\t/* message popup */\n\t\tmessage_ok: \"OK\",\n\t\tmessage_cancel: \"Prekliči\",\n\n\t\t/* constraints */\n\t\tsection_constraint: \"Constraint\",\n\t\tconstraint_type: \"Constraint type\",\n\t\tconstraint_date: \"Constraint date\",\n\t\tasap: \"As Soon As Possible\",\n\t\talap: \"As Late As Possible\",\n\t\tsnet: \"Start No Earlier Than\",\n\t\tsnlt: \"Start No Later Than\",\n\t\tfnet: \"Finish No Earlier Than\",\n\t\tfnlt: \"Finish No Later Than\",\n\t\tmso: \"Must Start On\",\n\t\tmfo: \"Must Finish On\",\n\n\t\t/* resource control */\n\t\tresources_filter_placeholder: \"type to filter\",\n\t\tresources_filter_label: \"hide empty\",\n\n\t\t/* empty state screen */\n\t\tempty_state_text_link: \"Click here\",\n\t\tempty_state_text_description: \"to create your first task\",\n\n\t\t/* baselines control */\n\t\tbaselines_section_placeholder: \"Start adding a new baseline\",\n\t\tbaselines_add_button: \"Add Baseline\",\n\t\tbaselines_remove_button: \"Remove\",\n\t\tbaselines_remove_all_button: \"Remove All\",\n\n\t\t/* deadline control */\n\t\tdeadline_enable_button: \"Set\",\n\t\tdeadline_disable_button: \"Remove\"\n\t}\n};\n\nexport default locale;\n","const locale: IGanttLocale = {\n\tdate: {\n\t\tmonth_full: [\"Január\", \"Február\", \"Marec\", \"Apríl\", \"Máj\", \"Jún\", \"Júl\", \"August\", \"September\", \"Október\", \"November\", \"December\"],\n\t\tmonth_short: [\"Jan\", \"Feb\", \"Mar\", \"Apr\", \"Máj\", \"Jún\", \"Júl\", \"Aug\", \"Sept\", \"Okt\", \"Nov\", \"Dec\"],\n\t\tday_full: [\"Nedeľa\", \"Pondelok\", \"Utorok\", \"Streda\", \"Štvrtok\", \"Piatok\", \"Sobota\"],\n\t\tday_short: [\"Ne\", \"Po\", \"Ut\", \"St\", \"Št\", \"Pi\", \"So\"]\n\t},\n\tlabels: {\n\t\tnew_task: \"Nová úloha\",\n\t\ticon_save: \"Uložiť\",\n\t\ticon_cancel: \"Späť\",\n\t\ticon_details: \"Detail\",\n\t\ticon_edit: \"Edituj\",\n\t\ticon_delete: \"Zmazať\",\n\t\tconfirm_closing: \"Vaše zmeny nebudú uložené. Skutočne?\", // Vaše změny budou ztraceny, opravdu ?\n\t\tconfirm_deleting: \"Udalosť bude natrvalo vymazaná. Skutočne?\",\n\t\tsection_description: \"Poznámky\",\n\t\tsection_time: \"Doba platnosti\",\n\t\tsection_type: \"Type\",\n\t\tsection_deadline: \"Deadline\",\n\t\tsection_baselines: \"Baselines\",\n\t\t/* grid columns */\n\n\t\tcolumn_wbs: \"WBS\",\n\t\tcolumn_text: \"Task name\",\n\t\tcolumn_start_date: \"Start time\",\n\t\tcolumn_duration: \"Duration\",\n\t\tcolumn_add: \"\",\n\n\t\t/* link confirmation */\n\t\tlink: \"Link\",\n\t\tconfirm_link_deleting: \"will be deleted\",\n\t\tlink_start: \" (start)\",\n\t\tlink_end: \" (end)\",\n\n\t\ttype_task: \"Task\",\n\t\ttype_project: \"Project\",\n\t\ttype_milestone: \"Milestone\",\n\n\n\t\tminutes: \"Minutes\",\n\t\thours: \"Hours\",\n\t\tdays: \"Days\",\n\t\tweeks: \"Week\",\n\t\tmonths: \"Months\",\n\t\tyears: \"Years\",\n\n\t\t/* message popup */\n\t\tmessage_ok: \"OK\",\n\t\tmessage_cancel: \"Späť\",\n\n\t\t/* constraints */\n\t\tsection_constraint: \"Constraint\",\n\t\tconstraint_type: \"Constraint type\",\n\t\tconstraint_date: \"Constraint date\",\n\t\tasap: \"As Soon As Possible\",\n\t\talap: \"As Late As Possible\",\n\t\tsnet: \"Start No Earlier Than\",\n\t\tsnlt: \"Start No Later Than\",\n\t\tfnet: \"Finish No Earlier Than\",\n\t\tfnlt: \"Finish No Later Than\",\n\t\tmso: \"Must Start On\",\n\t\tmfo: \"Must Finish On\",\n\n\t\t/* resource control */\n\t\tresources_filter_placeholder: \"type to filter\",\n\t\tresources_filter_label: \"hide empty\",\n\n\t\t/* empty state screen */\n\t\tempty_state_text_link: \"Click here\",\n\t\tempty_state_text_description: \"to create your first task\",\n\n\t\t/* baselines control */\n\t\tbaselines_section_placeholder: \"Start adding a new baseline\",\n\t\tbaselines_add_button: \"Add Baseline\",\n\t\tbaselines_remove_button: \"Remove\",\n\t\tbaselines_remove_all_button: \"Remove All\",\n\n\t\t/* deadline control */\n\t\tdeadline_enable_button: \"Set\",\n\t\tdeadline_disable_button: \"Remove\"\n\t}\n};\n\nexport default locale;\n","/*\n\tTranslation by Peter Eriksson\n */\nconst locale: IGanttLocale = {\n\tdate: {\n\t\tmonth_full: [\"Januari\", \"Februari\", \"Mars\", \"April\", \"Maj\", \"Juni\", \"Juli\", \"Augusti\", \"September\", \"Oktober\", \"November\", \"December\"],\n\t\tmonth_short: [\"Jan\", \"Feb\", \"Mar\", \"Apr\", \"Maj\", \"Jun\", \"Jul\", \"Aug\", \"Sep\", \"Okt\", \"Nov\", \"Dec\"],\n\t\tday_full: [\"Söndag\", \"Måndag\", \"Tisdag\", \"Onsdag\", \"Torsdag\", \"Fredag\", \"Lördag\"],\n\t\tday_short: [\"Sön\", \"Mån\", \"Tis\", \"Ons\", \"Tor\", \"Fre\", \"Lör\"]\n\t},\n\tlabels: {\n\t\tnew_task: \"Ny uppgift\",\n\t\ticon_save: \"Spara\",\n\t\ticon_cancel: \"Avbryt\",\n\t\ticon_details: \"Detajer\",\n\t\ticon_edit: \"Ändra\",\n\t\ticon_delete: \"Ta bort\",\n\t\tconfirm_closing: \"\",\n\t\tconfirm_deleting: \"Är du säker på att du vill ta bort händelsen permanent?\",\n\t\tsection_description: \"Beskrivning\",\n\t\tsection_time: \"Tid\",\n\t\tsection_type: \"Typ\",\n\t\tsection_deadline: \"Deadline\",\n\t\tsection_baselines: \"Baselines\",\n\n\t\t/* grid columns */\n\n\t\tcolumn_wbs: \"WBS\",\n\t\tcolumn_text: \"Uppgiftsnamn\",\n\t\tcolumn_start_date: \"Starttid\",\n\t\tcolumn_duration: \"Varaktighet\",\n\t\tcolumn_add: \"\",\n\n\t\t/* link confirmation */\n\n\t\tlink: \"Länk\",\n\t\tconfirm_link_deleting: \"kommer tas bort\",\n\t\tlink_start: \" (start)\",\n\t\tlink_end: \" (slut)\",\n\t\ttype_task: \"Uppgift\",\n\t\ttype_project: \"Projekt\",\n\t\ttype_milestone: \"Milstolpe\",\n\n\t\tminutes: \"Minuter\",\n\t\thours: \"Timmar\",\n\t\tdays: \"Dagar\",\n\t\tweeks: \"Veckor\",\n\t\tmonths: \"Månader\",\n\t\tyears: \"År\",\n\n\t\t/* message popup */\n\t\tmessage_ok: \"OK\",\n\t\tmessage_cancel: \"Avbryt\",\n\n\t\t/* constraints */\n\t\tsection_constraint: \"Constraint\",\n\t\tconstraint_type: \"Constraint type\",\n\t\tconstraint_date: \"Constraint date\",\n\t\tasap: \"As Soon As Possible\",\n\t\talap: \"As Late As Possible\",\n\t\tsnet: \"Start No Earlier Than\",\n\t\tsnlt: \"Start No Later Than\",\n\t\tfnet: \"Finish No Earlier Than\",\n\t\tfnlt: \"Finish No Later Than\",\n\t\tmso: \"Must Start On\",\n\t\tmfo: \"Must Finish On\",\n\n\t\t/* resource control */\n\t\tresources_filter_placeholder: \"type to filter\",\n\t\tresources_filter_label: \"hide empty\",\n\n\t\t/* empty state screen */\n\t\tempty_state_text_link: \"Click here\",\n\t\tempty_state_text_description: \"to create your first task\",\n\n\t\t/* baselines control */\n\t\tbaselines_section_placeholder: \"Start adding a new baseline\",\n\t\tbaselines_add_button: \"Add Baseline\",\n\t\tbaselines_remove_button: \"Remove\",\n\t\tbaselines_remove_all_button: \"Remove All\",\n\n\t\t/* deadline control */\n\t\tdeadline_enable_button: \"Set\",\n\t\tdeadline_disable_button: \"Remove\"\n\t}\n};\n\nexport default locale;\n","/*\n * updated by @levkar at https://github.com/DHTMLX/gantt/pull/10\n */\nconst locale: IGanttLocale = {\n\tdate: {\n\t\tmonth_full: [\"Ocak\", \"Şubat\", \"Mart\", \"Nisan\", \"Mayıs\", \"Haziran\", \"Temmuz\", \"Ağustos\", \"Eylül\", \"Ekim\", \"Kasım\", \"Aralık\"],\n\t\tmonth_short: [\"Oca\", \"Şub\", \"Mar\", \"Nis\", \"May\", \"Haz\", \"Tem\", \"Ağu\", \"Eyl\", \"Eki\", \"Kas\", \"Ara\"],\n\t\tday_full: [\"Pazar\", \"Pazartesi\", \"Salı\", \"Çarşamba\", \"Perşembe\", \"Cuma\", \"Cumartesi\"],\n\t\tday_short: [\"Paz\", \"Pzt\", \"Sal\", \"Çar\", \"Per\", \"Cum\", \"Cmt\"]\n\t},\n\tlabels: {\n\t\tnew_task: \"Yeni görev\",\n\t\ticon_save: \"Kaydet\",\n\t\ticon_cancel: \"İptal\",\n\t\ticon_details: \"Detaylar\",\n\t\ticon_edit: \"Düzenle\",\n\t\ticon_delete: \"Sil\",\n\t\tconfirm_closing: \"\", // Your changes will be lost, are your sure ?\n\t\tconfirm_deleting: \"Görev silinecek, emin misiniz?\",\n\t\tsection_description: \"Açıklama\",\n\t\tsection_time: \"Zaman Aralığı\",\n\t\tsection_type: \"Tip\",\n\t\tsection_deadline: \"Deadline\",\n\t\tsection_baselines: \"Baselines\",\n\t\t/* grid columns */\n\n\t\tcolumn_wbs: \"WBS\",\n\t\tcolumn_text: \"Görev Adı\",\n\t\tcolumn_start_date: \"Başlangıç\",\n\t\tcolumn_duration: \"Süre\",\n\t\tcolumn_add: \"\",\n\n\t\t/* link confirmation */\n\t\tlink: \"Bağlantı\",\n\t\tconfirm_link_deleting: \"silinecek\",\n\t\tlink_start: \" (başlangıç)\",\n\t\tlink_end: \" (bitiş)\",\n\n\t\ttype_task: \"Görev\",\n\t\ttype_project: \"Proje\",\n\t\ttype_milestone: \"Kilometretaşı\",\n\n\n\t\tminutes: \"Dakika\",\n\t\thours: \"Saat\",\n\t\tdays: \"Gün\",\n\t\tweeks: \"Hafta\",\n\t\tmonths: \"Ay\",\n\t\tyears: \"Yıl\",\n\n\t\t/* message popup */\n\t\tmessage_ok: \"OK\",\n\t\tmessage_cancel: \"Ýptal\",\n\n\t\t/* constraints */\n\t\tsection_constraint: \"Constraint\",\n\t\tconstraint_type: \"Constraint type\",\n\t\tconstraint_date: \"Constraint date\",\n\t\tasap: \"As Soon As Possible\",\n\t\talap: \"As Late As Possible\",\n\t\tsnet: \"Start No Earlier Than\",\n\t\tsnlt: \"Start No Later Than\",\n\t\tfnet: \"Finish No Earlier Than\",\n\t\tfnlt: \"Finish No Later Than\",\n\t\tmso: \"Must Start On\",\n\t\tmfo: \"Must Finish On\",\n\n\t\t/* resource control */\n\t\tresources_filter_placeholder: \"type to filter\",\n\t\tresources_filter_label: \"hide empty\",\n\n\t\t/* empty state screen */\n\t\tempty_state_text_link: \"Click here\",\n\t\tempty_state_text_description: \"to create your first task\",\n\n\t\t/* baselines control */\n\t\tbaselines_section_placeholder: \"Start adding a new baseline\",\n\t\tbaselines_add_button: \"Add Baseline\",\n\t\tbaselines_remove_button: \"Remove\",\n\t\tbaselines_remove_all_button: \"Remove All\",\n\n\t\t/* deadline control */\n\t\tdeadline_enable_button: \"Set\",\n\t\tdeadline_disable_button: \"Remove\"\n\t}\n};\n\nexport default locale;\n","const locale: IGanttLocale = {\n\tdate: {\n\t\tmonth_full: [\"Січень\", \"Лютий\", \"Березень\", \"Квітень\", \"Травень\", \"Червень\", \"Липень\", \"Серпень\", \"Вересень\", \"Жовтень\", \"Листопад\", \"Грудень\"],\n\t\tmonth_short: [\"Січ\", \"Лют\", \"Бер\", \"Кві\", \"Тра\", \"Чер\", \"Лип\", \"Сер\", \"Вер\", \"Жов\", \"Лис\", \"Гру\"],\n\t\tday_full: [\"Неділя\", \"Понеділок\", \"Вівторок\", \"Середа\", \"Четвер\", \"П'ятниця\", \"Субота\"],\n\t\tday_short: [\"Нед\", \"Пон\", \"Вів\", \"Сер\", \"Чет\", \"Птн\", \"Суб\"]\n\t},\n\tlabels: {\n\t\tnew_task: \"Нове завдання\",\n\t\ticon_save: \"Зберегти\",\n\t\ticon_cancel: \"Відміна\",\n\t\ticon_details: \"Деталі\",\n\t\ticon_edit: \"Редагувати\",\n\t\ticon_delete: \"Вилучити\",\n\t\tconfirm_closing: \"\", // Ваші зміни втратяться. Ви впевнені ?\n\t\tconfirm_deleting: \"Подія вилучиться назавжди. Ви впевнені?\",\n\t\tsection_description: \"Опис\",\n\t\tsection_time: \"Часовий проміжок\",\n\t\tsection_type: \"Тип\",\n\t\tsection_deadline: \"Deadline\",\n\t\tsection_baselines: \"Baselines\",\n\t\t/* grid columns */\n\n\t\tcolumn_wbs: \"WBS\",\n\t\tcolumn_text: \"Task name\",\n\t\tcolumn_start_date: \"Start time\",\n\t\tcolumn_duration: \"Duration\",\n\t\tcolumn_add: \"\",\n\n\t\t/* link confirmation */\n\t\tlink: \"Link\",\n\t\tconfirm_link_deleting: \"will be deleted\",\n\t\tlink_start: \" (start)\",\n\t\tlink_end: \" (end)\",\n\n\t\ttype_task: \"Task\",\n\t\ttype_project: \"Project\",\n\t\ttype_milestone: \"Milestone\",\n\n\n\t\tminutes: \"Minutes\",\n\t\thours: \"Hours\",\n\t\tdays: \"Days\",\n\t\tweeks: \"Week\",\n\t\tmonths: \"Months\",\n\t\tyears: \"Years\",\n\n\t\t/* message popup */\n\t\tmessage_ok: \"OK\",\n\t\tmessage_cancel: \"Відміна\",\n\n\t\t/* constraints */\n\t\tsection_constraint: \"Constraint\",\n\t\tconstraint_type: \"Constraint type\",\n\t\tconstraint_date: \"Constraint date\",\n\t\tasap: \"As Soon As Possible\",\n\t\talap: \"As Late As Possible\",\n\t\tsnet: \"Start No Earlier Than\",\n\t\tsnlt: \"Start No Later Than\",\n\t\tfnet: \"Finish No Earlier Than\",\n\t\tfnlt: \"Finish No Later Than\",\n\t\tmso: \"Must Start On\",\n\t\tmfo: \"Must Finish On\",\n\n\t\t/* resource control */\n\t\tresources_filter_placeholder: \"type to filter\",\n\t\tresources_filter_label: \"hide empty\",\n\n\t\t/* empty state screen */\n\t\tempty_state_text_link: \"Click here\",\n\t\tempty_state_text_description: \"to create your first task\",\n\n\t\t/* baselines control */\n\t\tbaselines_section_placeholder: \"Start adding a new baseline\",\n\t\tbaselines_add_button: \"Add Baseline\",\n\t\tbaselines_remove_button: \"Remove\",\n\t\tbaselines_remove_all_button: \"Remove All\",\n\n\t\t/* deadline control */\n\t\tdeadline_enable_button: \"Set\",\n\t\tdeadline_disable_button: \"Remove\"\n\t}\n};\n\nexport default locale;\n","import * as utils from \"../utils/utils\";\nimport constants from \"../constants\";\nimport ExtensionManager from \"../ext/extension_manager\";\n\nimport services from \"../core/common/services\";\nimport config from \"../core/common/config\";\nimport ajax from \"../core/common/ajax\";\nimport date from \"../core/common/date\";\nimport {remoteEvents} from \"../core/remote/remote_events\";\n\nimport DnD from \"../core/common/dnd\";\nimport templates from \"../core/common/templates\";\nimport eventable from \"../utils/eventable\";\n\nimport StateService from \"../core/common/state\";\n\nimport Promise from \"../utils/promise\";\nimport env from \"../utils/env\";\nimport datastoreHooks from \"../core/datastore/datastore_hooks\";\nimport DataProcessor from \"../core/dataprocessor\";\n\nimport plugins from \"../core/plugins\";\n\nimport grid_column_api from \"../core/grid_column_api\";\nimport tasks from \"../core/tasks\";\nimport parsing from \"../core/loading/parsing\";\nimport work_time from \"../core/worktime/work_time\";\nimport data from \"../core/data\";\n\nimport void_script_second from \"../publish_helpers/void_script_second\";\n\nimport data_task_types from \"../core/data_task_types\";\nimport cached_functions from \"../core/cached_functions\";\n\nimport gantt_core from \"../core/gantt_core\";\nimport destructor from \"../core/destructor\";\nimport void_script_third from \"../publish_helpers/void_script_third\";\n\nimport i18nFactory from \"../locale\";\n\nfunction DHXGantt(){\n\tthis.constants = constants;\n\tthis.version = VERSION;\n\tthis.license = LICENSE;\n\tthis.templates = {};\n\tthis.ext = {};\n\tthis.keys = {\n\t\tedit_save: this.constants.KEY_CODES.ENTER,\n\t\tedit_cancel: this.constants.KEY_CODES.ESC\n\t};\n}\n\nexport default function(supportedExtensions) {\n\t// use a named constructor to make gantt instance discoverable in heap snapshots\n\tvar gantt = new DHXGantt();\n\n\tvar extensionManager = new ExtensionManager(supportedExtensions);\n\tvar activePlugins = {};\n\tgantt.plugins = function(config){\n\t\tfor(var i in config){\n\t\t\tif(config[i] && !activePlugins[i]){\n\t\t\t\tvar plugin = extensionManager.getExtension(i);\n\t\t\t\tif(plugin){\n\t\t\t\t\tplugin(gantt);\n\t\t\t\t\tactivePlugins[i] = true;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\treturn activePlugins;\n\t};\n\n\tgantt.$services = services();\n\tgantt.config = config();\n\tgantt.ajax =  ajax(gantt);\n\tgantt.date = date(gantt);\n\tgantt.RemoteEvents = remoteEvents;\n\n\tvar dnd = DnD(gantt);\n\tgantt.$services.setService(\"dnd\", function(){return dnd;});\n\n\tvar templatesLoader = templates(gantt);\n\tgantt.$services.setService(\"templateLoader\", function () {\n\t\treturn templatesLoader;\n\t});\n\n\teventable(gantt);\n\n\t\n\tvar stateService = new StateService();\n\n\tstateService.registerProvider(\"global\", function () {\n\t\tvar res = {\n\t\t\tmin_date: gantt._min_date,\n\t\t\tmax_date: gantt._max_date,\n\t\t\tselected_task: null\n\t\t};\n\n\t\t// do not throw error if getState called from non-initialized gantt\n\t\tif(gantt.$data && gantt.$data.tasksStore){\n\t\t\tres.selected_task = gantt.$data.tasksStore.getSelectedId();\n\t\t}\n\t\treturn res;\n\t});\n\tgantt.getState = stateService.getState;\n\tgantt.$services.setService(\"state\", function () {\n\t\treturn stateService;\n\t});\n\n\tutils.mixin(gantt, utils);\n\n\tgantt.Promise = Promise;\n\tgantt.env = env;\n\n\tdatastoreHooks(gantt);\n\n\tgantt.dataProcessor = DataProcessor.DEPRECATED_api;\n\tgantt.createDataProcessor = DataProcessor.createDataProcessor;\n\n\tplugins(gantt);\n\n\tgrid_column_api(gantt);\n\ttasks(gantt);\n\tparsing(gantt);\n\twork_time(gantt);\n\tdata(gantt);\n\n\tvoid_script_second(gantt);\n\n\tdata_task_types(gantt);\n\tcached_functions(gantt);\n\n\tgantt_core(gantt);\n\tdestructor(gantt);\n\tvoid_script_third(gantt);\n\n\tvar i18n = i18nFactory();\n\tgantt.i18n = {\n\t\taddLocale: i18n.addLocale,\n\t\tsetLocale: function(locale){\n\t\t\tif(typeof locale === \"string\"){\n\t\t\t\tvar localeObject = i18n.getLocale(locale);\n\t\t\t\tif(!localeObject){\n\t\t\t\t\tlocaleObject = i18n.getLocale(\"en\");\n\t\t\t\t}\n\n\t\t\t\tgantt.locale = localeObject;\n\t\t\t}else if(locale){\n\t\t\t\tif(!gantt.locale){\n\t\t\t\t\tgantt.locale = locale;\n\t\t\t\t}else{\n\t\t\t\t\tfor(var i in locale){\n\t\t\t\t\t\tif(locale[i] && typeof locale[i] === \"object\"){\n\t\t\t\t\t\t\tif(!gantt.locale[i]){\n\t\t\t\t\t\t\t\tgantt.locale[i] = {};\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tgantt.mixin(gantt.locale[i], locale[i], true);\n\t\t\t\t\t\t}else{\n\t\t\t\t\t\t\tgantt.locale[i] = locale[i];\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t\tgetLocale: i18n.getLocale\n\t};\n\tgantt.i18n.setLocale(\"en\");\n\treturn gantt;\n};","export default function(){\n\tvar services = {};\n\tfunction register (name, getter){\n\t\tservices[name] = getter;\n\t}\n\n\tfunction getService(name){\n\t\tif(!services[name]){\n\t\t\treturn null;\n\t\t}\n\t\treturn services[name]();\n\t}\n\n\tfunction dropService(name) {\n\t\tif (services[name]) {\n\t\t\tdelete services[name];\n\t\t}\n\t}\n\n\tvar servicesEnum = {};\n\n\treturn {\n\t\tservices: servicesEnum,\n\t\tsetService: register,\n\t\tgetService: getService,\n\t\tdropService: dropService,\n\t\tdestructor: function(){\n\t\t\tfor(var i in services){\n\t\t\t\tif(services[i]){\n\t\t\t\t\tvar service = services[i];\n\t\t\t\t\tif(service && service.destructor){\n\t\t\t\t\t\tservice.destructor();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\tservices = null;\n\t\t}\n\t};\n};\n","import eventable from \"../../utils/eventable\";\nimport * as utils from \"../../utils/utils\";\nimport timeout from \"../../utils/timeout\";\nimport global from \"../../utils/global\";\nimport * as domHelpers from \"../ui/utils/dom_helpers\";\n\nexport default function(gantt){\n\n\tfunction copyDomEvent(e){\n\t\treturn {\n\t\t\ttarget: e.target || e.srcElement,\n\t\t\tpageX: e.pageX,\n\t\t\tpageY: e.pageY,\n\t\t\tclientX: e.clientX,\n\t\t\tclientY: e.clientY,\n\t\t\tmetaKey: e.metaKey,\n\t\t\tshiftKey: e.shiftKey,\n\t\t\tctrlKey: e.ctrlKey,\n\t\t\taltKey: e.altKey\n\t\t};\n\t}\n\n\tfunction DnD(obj, config) {\n\t\tthis._obj = obj;\n\t\tthis._settings = config || {};\n\t\teventable(this);\n\n\t\tvar inputMethods = this.getInputMethods();\n\n\t\tthis._drag_start_timer = null;\n\t\tgantt.attachEvent(\"onGanttScroll\", utils.bind(function (left, top) {\n\t\t\tthis.clearDragTimer();\n\t\t}, this));\n\n\t\tvar lastDown = 0;\n\t\tvar eventParams = {passive: false};\n\t\tfor(var i = 0; i < inputMethods.length; i++){\n\t\t\t(utils.bind(function(input){\n\n\t\t\t\tgantt.event(obj, input.down, utils.bind(function (e) {\n\t\t\t\t\tif(!input.accessor(e)){\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (typeof e.button !== 'undefined' && e.button !== 0) {\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tif(config.preventDefault && config.selector && domHelpers.closest(e.target, config.selector)){\n\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t}\n\n\t\t\t\t\tif (gantt.config.touch && e.timeStamp && e.timeStamp - lastDown < 300) {\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tthis._settings.original_target = copyDomEvent(e);\n\n\t\t\t\t\tthis._settings.original_element_sizes = {\n\t\t\t\t\t\t...domHelpers.getRelativeEventPosition(e, domHelpers.getClosestSizedElement(obj)), \n\t\t\t\t\t\twidth: e.target.offsetWidth,\n\t\t\t\t\t\theight: e.target.offsetHeight\n\t\t\t\t\t};\n\n\t\t\t\t\tif (gantt.config.touch) {\n\t\t\t\t\t\tthis.clearDragTimer();\n\t\t\t\t\t\tthis._drag_start_timer = setTimeout(utils.bind(function () {\n\t\t\t\t\t\t\tif(gantt.getState().lightbox){\n\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tthis.dragStart(obj, e, input);\n\t\t\t\t\t\t}, this), gantt.config.touch_drag);\n\t\t\t\t\t}\n\t\t\t\t\telse {\n\t\t\t\t\t\tthis.dragStart(obj, e, input);\n\t\t\t\t\t}\n\t\t\t\t}, this), eventParams);\n\t\t\t\tvar eventElement = document.body;\n\t\t\t\tgantt.event(eventElement, input.up, utils.bind(function (e) {\n\t\t\t\t\tif(!input.accessor(e)){\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t\tthis.clearDragTimer();\n\t\t\t\t}, this), eventParams);\n\n\t\t\t}, this))(inputMethods[i]);\n\t\t}\n\t}\n\n\tDnD.prototype = {\n\t\ttraceDragEvents: function (domElement, inputMethod) {\n\t\t\tvar mousemove = utils.bind(function (e) {\n\t\t\t\treturn this.dragMove(domElement, e, inputMethod.accessor);\n\t\t\t}, this);\n\t\t\tutils.bind(function (e) {\n\t\t\t\treturn this.dragScroll(domElement, e);\n\t\t\t}, this);\n\n\t\t\tvar limited_mousemove = utils.bind(function (e) {\n\t\t\t\tif (this.config.started && utils.defined(this.config.updates_per_second)) {\n\t\t\t\t\tif (!timeout(this, this.config.updates_per_second))\n\t\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tvar dndActive = mousemove(e);\n\n\t\t\t\tif (dndActive) {\n\t\t\t\t\ttry{\n\t\t\t\t\t\tif (e && e.preventDefault && e.cancelable){//e.cancelable condition - because navigator.vibrate is blocked by Chrome\n\t\t\t\t\t\t\te.preventDefault();//Cancel default action on DND\n\t\t\t\t\t\t} //Cancel default action on DND\n\t\t\t\t\t}catch (e){\n\t\t\t\t\t\t// just suppress the exception, nothing needed to be done here\n\t\t\t\t\t}\n\n\t\t\t\t\t//e.cancelBubble = true;\n\t\t\t\t}\n\n\t\t\t\treturn dndActive;\n\t\t\t}, this);\n\t\t\tvar eventElement = domHelpers.getRootNode(gantt.$root);\n\t\t\tvar mousemoveContainer = this.config.mousemoveContainer || domHelpers.getRootNode(gantt.$root);\n\n\t\t\tvar eventParams = {passive: false};\n\t\t\tvar mouseup = utils.bind(function (e) {\n\t\t\t\tgantt.eventRemove(mousemoveContainer, inputMethod.move, limited_mousemove);\n\t\t\t\tgantt.eventRemove(eventElement, inputMethod.up, mouseup, eventParams);\n\t\t\t\treturn this.dragEnd(domElement);\n\t\t\t}, this);\n\n\t\t\tgantt.event(mousemoveContainer, inputMethod.move, limited_mousemove, eventParams);\n\t\t\tgantt.event(eventElement, inputMethod.up, mouseup, eventParams);\n\t\t},\n\t\tcheckPositionChange: function (pos) {\n\t\t\tvar diff_x = pos.x - this.config.pos.x;\n\t\t\tvar diff_y = pos.y - this.config.pos.y;\n\t\t\tvar distance = Math.sqrt(Math.pow(Math.abs(diff_x), 2) + Math.pow(Math.abs(diff_y), 2));\n\n\t\t\tif (distance > this.config.sensitivity) {\n\t\t\t\treturn true;\n\t\t\t} else {\n\t\t\t\treturn false;\n\t\t\t}\n\t\t},\n\t\tinitDnDMarker: function () {\n\t\t\t// create dnd placeholder and put it in dom\n\t\t\tvar marker = this.config.marker = document.createElement(\"div\");\n\t\t\tmarker.className = \"gantt_drag_marker\";\n\t\t\t// GS-1333: don't show any message when we resize grid columns\n\t\t\tmarker.innerHTML = \"\";\n\t\t\tdocument.body.appendChild(marker);\n\t\t},\n\t\tbackupEventTarget: function (domEvent, getEvent) {\n\t\t\tif (!gantt.config.touch) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t// keep original event target in DOM in order to keep dnd on touchmove event\n\t\t\tvar e = getEvent(domEvent);\n\n\t\t\tvar el = e.target || e.srcElement;\n\t\t\tvar copy = el.cloneNode(true);\n\t\t\t//this.config.target.target = copy;\n\t\t\tthis.config.original_target = copyDomEvent(e);\n\t\t\tthis.config.original_target.target = copy;\n\t\t\tthis.config.backup_element = el;\n\t\t\tel.parentNode.appendChild(copy);\n\n\t\t\tel.style.display = \"none\";\n\t\t\tvar mousemoveContainer = this.config.mousemoveContainer || document.body;\n\t\t\tmousemoveContainer.appendChild(el);\n\t\t},\n\t\tgetInputMethods: function () {\n\t\t\t// bind actions to browser events\n\t\t\tvar inputMethods = [];\n\n\t\t\tinputMethods.push({\n\t\t\t\t\"move\": \"mousemove\",\n\t\t\t\t\"down\": \"mousedown\",\n\t\t\t\t\"up\": \"mouseup\",\n\t\t\t\t\"accessor\": function (e) {\n\t\t\t\t\treturn e;\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tif (gantt.config.touch) {\n\n\t\t\t\tvar touchEventsSupported = true;\n\t\t\t\ttry{\n\t\t\t\t\tdocument.createEvent(\"TouchEvent\");\n\t\t\t\t}catch (e){\n\t\t\t\t\ttouchEventsSupported = false;\n\t\t\t\t}\n\n\t\t\t\tif(touchEventsSupported){\n\t\t\t\t\tinputMethods.push({\n\t\t\t\t\t\t\"move\": \"touchmove\",\n\t\t\t\t\t\t\"down\": \"touchstart\",\n\t\t\t\t\t\t\"up\": \"touchend\",\n\t\t\t\t\t\t\"accessor\": function (ev) {\n\t\t\t\t\t\t\tif (ev.touches && ev.touches.length > 1) return null;\n\t\t\t\t\t\t\tif (ev.touches[0])\n\t\t\t\t\t\t\t\treturn {\n\t\t\t\t\t\t\t\t\ttarget: document.elementFromPoint(ev.touches[0].clientX, ev.touches[0].clientY),\n\t\t\t\t\t\t\t\t\tpageX: ev.touches[0].pageX,\n\t\t\t\t\t\t\t\t\tpageY: ev.touches[0].pageY,\n\t\t\t\t\t\t\t\t\tclientX: ev.touches[0].clientX,\n\t\t\t\t\t\t\t\t\tclientY: ev.touches[0].clientY\n\t\t\t\t\t\t\t\t};\n\t\t\t\t\t\t\telse\n\t\t\t\t\t\t\t\treturn ev;\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t}else if(global.navigator.pointerEnabled){\n\t\t\t\t\tinputMethods.push({\n\t\t\t\t\t\t\"move\": \"pointermove\",\n\t\t\t\t\t\t\"down\": \"pointerdown\",\n\t\t\t\t\t\t\"up\": \"pointerup\",\n\t\t\t\t\t\t\"accessor\": function (ev) {\n\t\t\t\t\t\t\tif (ev.pointerType == \"mouse\") return null;\n\t\t\t\t\t\t\treturn ev;\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\n\t\t\t\t}else if (global.navigator.msPointerEnabled){\n\t\t\t\t\tinputMethods.push({\n\t\t\t\t\t\t\"move\": \"MSPointerMove\",\n\t\t\t\t\t\t\"down\": \"MSPointerDown\",\n\t\t\t\t\t\t\"up\": \"MSPointerUp\",\n\t\t\t\t\t\t\"accessor\": function (ev) {\n\t\t\t\t\t\t\tif (ev.pointerType == ev.MSPOINTER_TYPE_MOUSE) return null;\n\t\t\t\t\t\t\treturn ev;\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn inputMethods;\n\t\t},\n\t\tclearDragTimer: function () {\n\t\t\tif (this._drag_start_timer) {\n\t\t\t\tclearTimeout(this._drag_start_timer);\n\t\t\t\tthis._drag_start_timer = null;\n\t\t\t}\n\t\t},\n\t\tdragStart: function (obj, e, inputMethod) {\n\t\t\tif (this.config && this.config.started) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tthis.config = {\n\t\t\t\tobj: obj,\n\t\t\t\tmarker: null,\n\t\t\t\tstarted: false,\n\t\t\t\tpos: this.getPosition(e),\n\t\t\t\tsensitivity: 4\n\t\t\t};\n\t\t\tif (this._settings)\n\t\t\t\tutils.mixin(this.config, this._settings, true);\n\n\n\t\t\tthis.traceDragEvents(obj, inputMethod);\n\n\t\t\tgantt._prevent_touch_scroll = true;\n\t\t\tdocument.body.classList.add(\"gantt_noselect\");\n\n\t\t\tif (gantt.config.touch) {\n\t\t\t\tthis.dragMove(obj, e, inputMethod.accessor);\n\t\t\t}\n\n\t\t},\n\t\tdragMove: function (obj, e, getEvent) {\n\t\t\tvar source = getEvent(e);\n\t\t\tif (!source) return false;\n\n\t\t\tif (!this.config.marker && !this.config.started) {\n\t\t\t\tvar pos = this.getPosition(source);\n\n\t\t\t\tif (gantt.config.touch || this.checkPositionChange(pos)) {\n\t\t\t\t\t// real drag starts here,\n\t\t\t\t\t// when user moves mouse at first time after onmousedown\n\t\t\t\t\tthis.config.started = true;\n\t\t\t\t\tthis.config.ignore = false;\n\t\t\t\t\tgantt._touch_drag = true;\n\t\t\t\t\tif (this.callEvent(\"onBeforeDragStart\", [obj, this.config.original_target]) === false) {\n\t\t\t\t\t\tthis.config.ignore = true;\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\t\t\t\t\tthis.backupEventTarget(e, getEvent);\n\t\t\t\t\tthis.initDnDMarker();\n\t\t\t\t\tgantt._touch_feedback();\n\t\t\t\t\tthis.callEvent(\"onAfterDragStart\", [obj, this.config.original_target]);\n\t\t\t\t} else {\n\t\t\t\t\tthis.config.ignore = true;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (!this.config.ignore) {\n\t\t\t\t// GS-1279 Gantt crashes on Mobile Firefox after starting to create a link and moving finger outisde the page.\n\t\t\t\tif (e.targetTouches && !source.target) return;\n\t\t\t\t\n\t\t\t\tsource.pos = this.getPosition(source);\n\t\t\t\tthis.config.marker.style.left = source.pos.x + \"px\";\n\t\t\t\tthis.config.marker.style.top = source.pos.y + \"px\";\n\t\t\t\tthis.callEvent(\"onDragMove\", [obj, source]);\n\t\t\t\treturn true;\n\t\t\t}\n\t\t\treturn false;\n\t\t},\n\n\t\tdragEnd: function (obj) {\n\t\t\tvar target = this.config.backup_element;\n\t\t\tif (target && target.parentNode) {\n\t\t\t\ttarget.parentNode.removeChild(target);\n\t\t\t}\n\t\t\tgantt._prevent_touch_scroll = false;\n\t\t\tif (this.config.marker) {\n\t\t\t\tthis.config.marker.parentNode.removeChild(this.config.marker);\n\t\t\t\tthis.config.marker = null;\n\n\t\t\t\tthis.callEvent(\"onDragEnd\", []);\n\t\t\t}\n\t\t\tthis.config.started = false;\n\t\t\tgantt._touch_drag = false;\n\t\t\tdocument.body.classList.remove(\"gantt_noselect\");\n\t\t},\n\n\t\tgetPosition: function (e) {\n\t\t\tvar x = 0, y = 0;\n\t\t\tif (e.pageX || e.pageY) {\n\t\t\t\tx = e.pageX;\n\t\t\t\ty = e.pageY;\n\t\t\t} else if (e.clientX || e.clientY) {\n\t\t\t\tx = e.clientX + document.body.scrollLeft + document.documentElement.scrollLeft;\n\t\t\t\ty = e.clientY + document.body.scrollTop + document.documentElement.scrollTop;\n\t\t\t}\n\t\t\treturn {x: x, y: y};\n\t\t}\n\t};\n\n\treturn DnD;\n};\n","export default function(gantt) {\n\n\tvar regTemplates = {};\n\n\tfunction initTemplate(name, initial, template_name) {\n\t\ttemplate_name = template_name || name;\n\t\tvar config = gantt.config,\n\t\t\ttemplates = gantt.templates;\n\n\t\tif (gantt.config[name] && regTemplates[template_name] != config[name]) {\n\t\t\tif (!(initial && templates[template_name])) {\n\t\t\t\ttemplates[template_name] = gantt.date.date_to_str(config[name]);\n\t\t\t\tregTemplates[template_name] = config[name];\n\t\t\t}\n\t\t}\n\t}\n\n\tfunction initTemplates() {\n\t\tvar labels = gantt.locale.labels;\n\t\tlabels.gantt_save_btn = labels.icon_save;\n\t\tlabels.gantt_cancel_btn = labels.icon_cancel;\n\t\tlabels.gantt_delete_btn = labels.icon_delete;\n\n\n\t\tvar date = gantt.date;\n\n\t\t//build configuration based templates\n\t\tvar d = date.date_to_str;\n\t\tvar c = gantt.config;\n\t\tvar format_date = d(c.xml_date || c.date_format, c.server_utc);\n\t\tvar parse_date = date.str_to_date(c.xml_date || c.date_format, c.server_utc);\n\n\t\tinitTemplate(\"date_scale\", true, undefined, gantt.config, gantt.templates);\n\t\tinitTemplate(\"date_grid\", true, \"grid_date_format\", gantt.config, gantt.templates);\n\t\tinitTemplate(\"task_date\", true, undefined, gantt.config, gantt.templates);\n\n\t\tgantt.mixin(gantt.templates, {\n\t\t\txml_format: undefined, // deprecated\n\t\t\tformat_date: format_date,\n\n\t\t\txml_date: undefined, // deprecated\n\t\t\tparse_date: parse_date,\n\n\t\t\tprogress_text: function (start, end, task) {\n\t\t\t\treturn \"\";\n\t\t\t},\n\t\t\tgrid_header_class: function (column, config) {\n\t\t\t\treturn \"\";\n\t\t\t},\n\n\t\t\ttask_text: function (start, end, task) {\n\t\t\t\treturn task.text;\n\t\t\t},\n\t\t\ttask_class: function (start, end, task) {\n\t\t\t\treturn \"\";\n\t\t\t},\n\t\t\ttask_end_date: function (date) {\n\t\t\t\treturn gantt.templates.task_date(date);\n\t\t\t},\n\t\t\tgrid_row_class: function (start, end, task) {\n\t\t\t\treturn \"\";\n\t\t\t},\n\t\t\ttask_row_class: function (start, end, task) {\n\t\t\t\treturn \"\";\n\t\t\t},\n\t\t\ttimeline_cell_class: function (item, date) {\n\t\t\t\treturn \"\";\n\t\t\t},\n\t\t\ttimeline_cell_content: function (item, date) {\n\t\t\t\treturn \"\";\n\t\t\t},\n\t\t\tscale_cell_class: function (date) {\n\t\t\t\treturn \"\";\n\t\t\t},\n\t\t\tscale_row_class: function (date) {\n\t\t\t\treturn \"\";\n\t\t\t},\n\n\t\t\tgrid_indent: function (item) {\n\t\t\t\treturn \"<div class='gantt_tree_indent'></div>\";\n\t\t\t},\n\t\t\tgrid_folder: function (item) {\n\t\t\t\treturn \"<div class='gantt_tree_icon gantt_folder_\" + (item.$open ? \"open\" : \"closed\") + \"'></div>\";\n\t\t\t},\n\t\t\tgrid_file: function (item) {\n\t\t\t\treturn \"<div class='gantt_tree_icon gantt_file'></div>\";\n\t\t\t},\n\t\t\tgrid_open: function (item) {\n\t\t\t\treturn \"<div class='gantt_tree_icon gantt_\" + (item.$open ? \"close\" : \"open\") + \"'></div>\";\n\t\t\t},\n\t\t\tgrid_blank: function (item) {\n\t\t\t\treturn \"<div class='gantt_tree_icon gantt_blank'></div>\";\n\t\t\t},\n\t\t\tdate_grid: function (date, item, column) {\n\t\t\t\tif (item && gantt.isUnscheduledTask(item) && gantt.config.show_unscheduled) {\n\t\t\t\t\treturn gantt.templates.task_unscheduled_time(item);\n\t\t\t\t} else {\n\t\t\t\t\treturn gantt.templates.grid_date_format(date, column);\n\t\t\t\t}\n\t\t\t},\n\n\t\t\ttask_time: function (start, end, ev) {\n\t\t\t\tif (gantt.isUnscheduledTask(ev) && gantt.config.show_unscheduled) {\n\t\t\t\t\treturn gantt.templates.task_unscheduled_time(ev);\n\t\t\t\t} else {\n\t\t\t\t\treturn gantt.templates.task_date(start) + \" - \" + gantt.templates.task_end_date(end);\n\t\t\t\t}\n\t\t\t},\n\n\t\t\ttask_unscheduled_time: function (task) {\n\t\t\t\treturn \"\";\n\t\t\t},\n\n\t\t\ttime_picker: d(c.time_picker),\n\t\t\tlink_class: function (link) {\n\t\t\t\treturn \"\";\n\t\t\t},\n\t\t\tlink_description: function (link) {\n\t\t\t\tvar from = gantt.getTask(link.source),\n\t\t\t\t\tto = gantt.getTask(link.target);\n\n\t\t\t\treturn \"<b>\" + from.text + \"</b> &ndash;  <b>\" + to.text + \"</b>\";\n\t\t\t},\n\n\t\t\tdrag_link: function (from, from_start, to, to_start) {\n\t\t\t\tfrom = gantt.getTask(from);\n\t\t\t\tvar labels = gantt.locale.labels;\n\n\t\t\t\tvar text = \"<b>\" + from.text + \"</b> \" + (from_start ? labels.link_start : labels.link_end) + \"<br/>\";\n\t\t\t\tif (to) {\n\t\t\t\t\tto = gantt.getTask(to);\n\t\t\t\t\ttext += \"<b> \" + to.text + \"</b> \" + (to_start ? labels.link_start : labels.link_end) + \"<br/>\";\n\t\t\t\t}\n\t\t\t\treturn text;\n\t\t\t},\n\t\t\tdrag_link_class: function (from, from_start, to, to_start) {\n\t\t\t\tvar add = \"\";\n\n\t\t\t\tif (from && to) {\n\t\t\t\t\tvar allowed = gantt.isLinkAllowed(from, to, from_start, to_start);\n\t\t\t\t\tadd = \" \" + (allowed ? \"gantt_link_allow\" : \"gantt_link_deny\");\n\t\t\t\t}\n\n\t\t\t\treturn \"gantt_link_tooltip\" + add;\n\t\t\t},\n\n\t\t\t/* used for aria-labels of bar elements and for tooltip.js */\n\t\t\ttooltip_date_format: date.date_to_str(\"%Y-%m-%d\"),\n\t\t\ttooltip_text: function (start, end, event) {\n\t\t\t\treturn `<div>Task: ${event.text}</div>\n\t\t\t\t<div>Start date: ${gantt.templates.tooltip_date_format(start)}</div>\n\t\t\t\t<div>End date: ${gantt.templates.tooltip_date_format(end)}</div>`;\n\t\t\t},\n\t\t\tbaseline_text: function (task, baseline, index) {\n\t\t\t\treturn \"\";\n\t\t\t}\n\t\t});\n\t}\n\n\treturn {\n\t\tinitTemplates: initTemplates,\n\t\tinitTemplate: initTemplate\n\t};\n\n};","import * as utils from \"../../utils/utils\";\nimport facadeFactory from \"./../facades/datastore\";\nimport calculateScaleRange from \"../gantt_data_range\";\nimport isPlaceholderTask from \"../../utils/placeholder_task\";\n\nimport treeHelper from \"../../utils/task_tree_helpers\";\n\nfunction initDataStores(gantt){\n\n\tvar facade = facadeFactory.create();\n\tutils.mixin(gantt, facade);\n\tvar tasksStore = gantt.createDatastore({\n\t\tname: \"task\",\n\t\ttype: \"treeDatastore\",\n\t\trootId: function() { return gantt.config.root_id; },\n\t\tinitItem: utils.bind(_init_task, gantt),\n\t\tgetConfig: function() { return gantt.config; }\n\t});\n\n\tvar linksStore = gantt.createDatastore({\n\t\tname: \"link\",\n\t\tinitItem: utils.bind(_init_link, gantt)\n\t});\n\n\tgantt.attachEvent(\"onDestroy\", function(){\n\t\ttasksStore.destructor();\n\t\tlinksStore.destructor();\n\t});\n\n\tgantt.attachEvent(\"onLinkValidation\", function(link){\n\t\tif(gantt.isLinkExists(link.id) || link.id === \"predecessor_generated\"){\n\t\t\t// link was already added into gantt\n\t\t\treturn true;\n\t\t}\n\t\tvar source = gantt.getTask(link.source);\n\t\tvar taskLinks = source.$source;\n\t\tfor (var i = 0; i < taskLinks.length; i++) {\n\t\t\tvar existingLink = gantt.getLink(taskLinks[i]);\n\n\t\t\tvar sourceMatch = link.source == existingLink.source;\n\t\t\tvar targetMatch = link.target == existingLink.target;\n\t\t\tvar typeMatch = link.type == existingLink.type;\n\n\t\t\t// prevent creating duplicated links from the UI\n\t\t\tif (sourceMatch && targetMatch && typeMatch) {\n\t\t\t\treturn false;\n\t\t\t}\n\t\t}\n\n\t\treturn true;\n\t});\n\n\ttasksStore.attachEvent(\"onBeforeRefreshAll\", function(){\n\n\t\t// GS-2170 do not recalculate indexes and dates as the event will be called later in the onStoreUpdate event\n\t\tif (tasksStore._skipTaskRecalculation){\n\t\t\treturn;\n\t\t}\n\n\t\tvar order = tasksStore.getVisibleItems();\n\n\t\tfor(var i=0; i < order.length; i++){\n\t\t\tvar item = order[i];\n\t\t\titem.$index = i;\n\t\t\titem.$local_index = gantt.getTaskIndex(item.id);\n\t\t\tgantt.resetProjectDates(item);\n\t\t}\n\n\t});\n\n\ttasksStore.attachEvent(\"onFilterItem\", function(id, task) {\n\t\tif (gantt.config.show_tasks_outside_timescale) {\n\t\t\treturn true;\n\t\t}\n\t\tvar min = null, max = null;\n\t\tif (gantt.config.start_date && gantt.config.end_date) {\n\t\t\tif (gantt._isAllowedUnscheduledTask(task)) return true;\n\t\t\tmin = gantt.config.start_date.valueOf();\n\t\t\tmax = gantt.config.end_date.valueOf();\n\n\t\t\tif (+task.start_date > max || +task.end_date < +min)\n\t\t\t\treturn false;\n\t\t}\n\t\treturn true;\n\t});\n\n\ttasksStore.attachEvent(\"onIdChange\", function(oldId, newId){\n\t\tgantt._update_flags(oldId, newId);\n\n\t\tvar changedTask = gantt.getTask(newId);\n\t\tif(!tasksStore.isSilent()){\n\t\t\tif(changedTask.$split_subtask || changedTask.rollup){\n\t\t\t\tgantt.eachParent(function(parent){\n\t\t\t\t\tgantt.refreshTask(parent.id);\n\t\t\t\t}, newId);\n\t\t\t}\n\t\t}\n\t});\n\n\ttasksStore.attachEvent(\"onAfterUpdate\", function(id){\n\t\tgantt._update_parents(id);\n\t\tif(gantt.getState(\"batchUpdate\").batch_update){\n\t\t\treturn true;\n\t\t}\n\n\t\tvar task = tasksStore.getItem(id);\n\t\tif (!task.$source) task.$source = [];\n\t\tfor (var i = 0; i < task.$source.length; i++) {\n\t\t\tlinksStore.refresh(task.$source[i]);\n\t\t}\n\t\tif (!task.$target) task.$target = [];\n\t\tfor (var i = 0; i < task.$target.length; i++) {\n\t\t\tlinksStore.refresh(task.$target[i]);\n\t\t}\n\t});\n\n\ttasksStore.attachEvent(\"onBeforeItemMove\", function(sid, parent, tindex){\n\t\t// GS-125. Don't allow users to move the placeholder task\n\t\tif (isPlaceholderTask(sid, gantt, tasksStore)){\n\t\t\t//eslint-disable-next-line\n\t\t\tconsole.log(\"The placeholder task cannot be moved to another position.\");\n\t\t\treturn false;\n\t\t}\n\n\t\treturn true;\n\t});\n\n\ttasksStore.attachEvent(\"onAfterItemMove\", function(sid, parent, tindex){\n\t\tvar source = gantt.getTask(sid);\n\n\t\tif(this.getNextSibling(sid) !== null){\n\t\t\tsource.$drop_target = this.getNextSibling(sid);\n\t\t} else if(this.getPrevSibling(sid) !== null){\n\t\t\tsource.$drop_target = \"next:\" + this.getPrevSibling(sid);\n\t\t}else{\n\t\t\tsource.$drop_target = \"next:null\";\n\t\t}\n\n\t});\n\n\ttasksStore.attachEvent(\"onStoreUpdated\", function(id, item, action){\n\t\tif(action == \"delete\"){\n\t\t\tgantt._update_flags(id, null);\n\t\t}\n\n\t\tvar state = gantt.$services.getService(\"state\");\n\t\tif(state.getState(\"batchUpdate\").batch_update){\n\t\t\treturn;\n\t\t}\n\n\t\tif(gantt.config.fit_tasks && action !== \"paint\"){\n\t\t\tvar oldState = gantt.getState();\n\t\t\tcalculateScaleRange(gantt);\n\t\t\tvar newState = gantt.getState();\n\n\t\t\t//this._init_tasks_range();\n\t\t\tif (+oldState.min_date != +newState.min_date || +oldState.max_date != +newState.max_date) {\n\t\t\t\tgantt.render();\n\n\t\t\t\tgantt.callEvent(\"onScaleAdjusted\", []);\n\t\t\t\treturn true;\n\t\t\t}\n\n\t\t}\n\n\t\tif(action == \"add\" || action == \"move\" || action == \"delete\"){\n\t\t\tif(gantt.$layout){\n\t\t\t\t// GS-2170. Do not recalculate the indexes and dates of other tasks in the\n\t\t\t\t// onBeforeResize layout event, but do it later. If lightbox is opened, it will\n\t\t\t\t// trigger the refreshData, so the indexes and dates will be recalculated there\n\t\t\t\tif (this.$config.name == \"task\" && (action == \"add\" || action == \"delete\")){\n\t\t\t\t\tif (this._skipTaskRecalculation != \"lightbox\"){\n\t\t\t\t\t\tthis._skipTaskRecalculation = true;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tgantt.$layout.resize();\n\t\t\t}\n\n\t\t}else if(!id){\n\t\t\tlinksStore.refresh();\n\t\t}\n\n\t});\n\n\tlinksStore.attachEvent(\"onAfterAdd\", function(id, link){\n\t\tsync_link(link);\n\t});\n\tlinksStore.attachEvent(\"onAfterUpdate\", function(id, link){\n\t\tsync_links();\n\t});\n\tlinksStore.attachEvent(\"onAfterDelete\", function(id, link){\n\t\tsync_link_delete(link);\n\t});\n\tlinksStore.attachEvent(\"onAfterSilentDelete\", function(id, link){\n\t\tsync_link_delete(link);\n\t});\n\tlinksStore.attachEvent(\"onBeforeIdChange\", function(oldId, newId){\n\t\tsync_link_delete(gantt.mixin({id:oldId}, gantt.$data.linksStore.getItem(newId)));\n\t\tsync_link(gantt.$data.linksStore.getItem(newId));\n\t});\n\n\tfunction checkLinkedTaskVisibility(taskId){\n\t\tvar isVisible = gantt.isTaskVisible(taskId);\n\t\tif(!isVisible && gantt.isTaskExists(taskId)){\n\t\t\tvar parent = gantt.getParent(taskId);\n\t\t\tif(gantt.isTaskExists(parent) && gantt.isTaskVisible(parent)){\n\t\t\t\tparent = gantt.getTask(parent);\n\t\t\t\tif(gantt.isSplitTask(parent)){\n\t\t\t\t\tisVisible = true;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\treturn isVisible;\n\t}\n\n\tlinksStore.attachEvent(\"onFilterItem\", function(id, link){\n\t\tif (!gantt.config.show_links) {\n\t\t\treturn false;\n\t\t}\n\n\t\tvar sourceVisible = checkLinkedTaskVisibility(link.source);\n\t\tvar targetVisible = checkLinkedTaskVisibility(link.target);\n\n\t\tif (!(sourceVisible && targetVisible) ||\n\t\t\tgantt._isAllowedUnscheduledTask(gantt.getTask(link.source)) || gantt._isAllowedUnscheduledTask(gantt.getTask(link.target)))\n\t\t\treturn false;\n\n\t\treturn gantt.callEvent(\"onBeforeLinkDisplay\", [id, link]);\n\t});\n\n\n\t(function(){\n\t\t// delete all connected links after task is deleted\n\t\tvar deletedLinks = {};\n\n\t\tgantt.attachEvent(\"onBeforeTaskDelete\", function(id, item){\n\t\t\tdeletedLinks[id] = treeHelper.getSubtreeLinks(gantt, id);\n\t\t\treturn true;\n\t\t});\n\n\t\tgantt.attachEvent(\"onAfterTaskDelete\", function(id, item) {\n\t\t\tif(deletedLinks[id]){\n\t\t\t\tgantt.$data.linksStore.silent(function(){\n\t\t\t\t\tfor(var i in deletedLinks[id]){\n\t\t\t\t\t\tif (gantt.isLinkExists(i)){\n\t\t\t\t\t\t\tgantt.$data.linksStore.removeItem(i);\n\t\t\t\t\t\t}\n\t\t\t\t\t\tsync_link_delete(deletedLinks[id][i]);\n\t\t\t\t\t}\n\n\t\t\t\t\tdeletedLinks[id] = null;\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\t})();\n\n\tgantt.attachEvent(\"onAfterLinkDelete\", function(id, link) {\n\t\tgantt.refreshTask(link.source);\n\t\tgantt.refreshTask(link.target);\n\t});\n\n\tgantt.attachEvent(\"onParse\", sync_links);\n\n\tmapEvents({\n\t\tsource: linksStore,\n\t\ttarget: gantt,\n\t\tevents:{\n\t\t\t\"onItemLoading\":\"onLinkLoading\",\n\t\t\t\"onBeforeAdd\":\"onBeforeLinkAdd\",\n\t\t\t\"onAfterAdd\":\"onAfterLinkAdd\",\n\t\t\t\"onBeforeUpdate\":\"onBeforeLinkUpdate\",\n\t\t\t\"onAfterUpdate\":\"onAfterLinkUpdate\",\n\t\t\t\"onBeforeDelete\":\"onBeforeLinkDelete\",\n\t\t\t\"onAfterDelete\":\"onAfterLinkDelete\",\n\t\t\t\"onIdChange\":\"onLinkIdChange\"\n\t\t}\n\t});\n\n\tmapEvents({\n\t\tsource: tasksStore,\n\t\ttarget: gantt,\n\t\tevents:{\n\t\t\t\"onItemLoading\":\"onTaskLoading\",\n\t\t\t\"onBeforeAdd\":\"onBeforeTaskAdd\",\n\t\t\t\"onAfterAdd\":\"onAfterTaskAdd\",\n\t\t\t\"onBeforeUpdate\":\"onBeforeTaskUpdate\",\n\t\t\t\"onAfterUpdate\":\"onAfterTaskUpdate\",\n\t\t\t\"onBeforeDelete\":\"onBeforeTaskDelete\",\n\t\t\t\"onAfterDelete\":\"onAfterTaskDelete\",\n\t\t\t\"onIdChange\":\"onTaskIdChange\",\n\t\t\t\"onBeforeItemMove\":\"onBeforeTaskMove\",\n\t\t\t\"onAfterItemMove\":\"onAfterTaskMove\",\n\t\t\t\"onFilterItem\":\"onBeforeTaskDisplay\",\n\t\t\t\"onItemOpen\":\"onTaskOpened\",\n\t\t\t\"onItemClose\":\"onTaskClosed\",\n\t\t\t\"onBeforeSelect\":\"onBeforeTaskSelected\",\n\t\t\t\"onAfterSelect\":\"onTaskSelected\",\n\t\t\t\"onAfterUnselect\":\"onTaskUnselected\"\n\t\t}\n\t});\n\n\tgantt.$data = {\n\t\ttasksStore: tasksStore,\n\t\tlinksStore: linksStore\n\t};\n\n\tfunction sync_link(link){\n\t\tif(gantt.isTaskExists(link.source)){\n\t\t\tvar sourceTask = gantt.getTask(link.source);\n\t\t\tsourceTask.$source = sourceTask.$source || [];\n\t\t\tsourceTask.$source.push(link.id);\n\t\t}\n\t\tif(gantt.isTaskExists(link.target)){\n\t\t\tvar targetTask = gantt.getTask(link.target);\n\t\t\ttargetTask.$target = targetTask.$target || [];\n\t\t\ttargetTask.$target.push(link.id);\n\t\t}\n\t}\n\n\tfunction sync_link_delete(link){\n\t\tif(gantt.isTaskExists(link.source)){\n\t\t\tvar sourceTask = gantt.getTask(link.source);\n\t\t\tfor(var i = 0; i < sourceTask.$source.length; i++){\n\t\t\t\tif(sourceTask.$source[i] == link.id){\n\t\t\t\t\tsourceTask.$source.splice(i, 1);\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tif(gantt.isTaskExists(link.target)){\n\t\t\tvar targetTask = gantt.getTask(link.target);\n\t\t\tfor(var i = 0; i < targetTask.$target.length; i++){\n\t\t\t\tif(targetTask.$target[i] == link.id){\n\t\t\t\t\ttargetTask.$target.splice(i, 1);\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\tfunction sync_links() {\n\t\tvar task = null;\n\t\tvar tasks = gantt.$data.tasksStore.getItems();\n\n\t\tfor(var i = 0, len = tasks.length; i < len; i++){\n\t\t\ttask = tasks[i];\n\t\t\ttask.$source = [];\n\t\t\ttask.$target = [];\n\t\t}\n\n\t\tvar links = gantt.$data.linksStore.getItems();\n\t\tfor (var i = 0, len = links.length; i < len; i++) {\n\n\t\t\tvar link = links[i];\n\t\t\tsync_link(link);\n\t\t}\n\t}\n\n\tfunction mapEvents(conf){\n\t\tvar mapFrom = conf.source;\n\t\tvar mapTo = conf.target;\n\t\tfor(var i in conf.events){\n\t\t\t(function(sourceEvent, targetEvent){\n\t\t\t\tmapFrom.attachEvent(sourceEvent, function(){\n\t\t\t\t\treturn mapTo.callEvent(targetEvent, Array.prototype.slice.call(arguments));\n\t\t\t\t}, targetEvent);\n\t\t\t})(i, conf.events[i]);\n\t\t}\n\t}\n\n\tfunction _init_task(task) {\n\t\tif (!this.defined(task.id))\n\t\t\ttask.id = this.uid();\n\n\t\tif (task.start_date)\n\t\t\ttask.start_date = gantt.date.parseDate(task.start_date, \"parse_date\");\n\t\tif (task.end_date)\n\t\t\ttask.end_date = gantt.date.parseDate(task.end_date, \"parse_date\");\n\n\n\t\tvar duration = null;\n\t\tif (task.duration || task.duration === 0) {\n\t\t\ttask.duration = duration = task.duration * 1;\n\t\t}\n\n\t\tif (duration) {\n\t\t\tif (task.start_date && !task.end_date) {\n\t\t\t\ttask.end_date = this.calculateEndDate(task);\n\t\t\t} else if (!task.start_date && task.end_date) {\n\t\t\t\ttask.start_date = this.calculateEndDate({\n\t\t\t\t\tstart_date: task.end_date,\n\t\t\t\t\tduration: -task.duration,\n\t\t\t\t\ttask: task\n\t\t\t\t});\n\t\t\t}\n\t\t\t//task.$calculate_duration = false;\n\t\t}\n\n\t\tif (gantt.config.deadlines !== false && task.deadline){\n\t\t\ttask.deadline = gantt.date.parseDate(task.deadline, \"parse_date\");\n\t\t}\n\n\t\ttask.progress = Number(task.progress) || 0;\n\n\t\tif (this._isAllowedUnscheduledTask(task)) {\n\t\t\tthis._set_default_task_timing(task);\n\t\t}\n\t\tthis._init_task_timing(task);\n\t\tif (task.start_date && task.end_date)\n\t\t\tthis.correctTaskWorkTime(task);\n\n\t\ttask.$source = [];\n\t\ttask.$target = [];\n\n\t\tvar originalTask = this.$data.tasksStore.getItem(task.id);\n\t\tif (originalTask && !utils.defined(task.open)) {\n\t\t\t// if a task with the same id is already in the gantt and the new object doesn't specify the `open` state -\n\t\t\t// restore the `open` state we already have in the chart\n\t\t\ttask.$open = originalTask.$open;\n\t\t}\n\n\t\tif (task.parent === undefined) {\n\t\t\ttask.parent = this.config.root_id;\n\t\t}\n\t\tif(task.open){\n\t\t\ttask.$open = true;\n\t\t}\n\t\treturn task;\n\t}\n\n\tfunction _init_link(link) {\n\t\tif (!this.defined(link.id))\n\t\t\tlink.id = this.uid();\n\t\treturn link;\n\t}\n}\n\n\nexport default initDataStores;\n","import batch_update from \"./batch_update\";\nimport wbs from \"./wbs\";\nimport resources from \"./resources\";\nimport resource_assignments from \"./resource_assignments\";\nimport new_task_placeholder from \"./new_task_placeholder\";\nimport auto_task_types from \"./auto_task_types\";\nimport formatters from \"./formatters\";\nimport empty_state_screen from \"./empty_state_screen\";\nimport baselines from \"./baselines\";\n\nexport default function(gantt){\n\tif(!gantt.ext){\n\t\tgantt.ext = {};\n\t}\n\n\tvar modules = [\n\t\tbatch_update,\n\t\twbs,\n\t\tresources,\n\t\tresource_assignments,\n\t\tnew_task_placeholder,\n\t\tauto_task_types,\n\t\tformatters,\n\t\tempty_state_screen,\n\t\tbaselines\n\t];\n\n\tfor(var i = 0; i < modules.length; i++){\n\t\tif(modules[i])\n\t\t\tmodules[i](gantt);\n\t}\n};","export default function(gantt) {\n\tgantt.getGridColumn = function(name) {\n\t\tvar columns = gantt.config.columns;\n\n\t\tfor (var i = 0; i < columns.length; i++) {\n\t\t\tif (columns[i].name == name)\n\t\t\t\treturn columns[i];\n\t\t}\n\n\t\treturn null;\n\t};\n\n\tgantt.getGridColumns = function() {\n\t\treturn gantt.config.columns.slice();\n\t};\n};","export default function(gantt) {\n\tgantt.isReadonly = function (item) {\n\n\t\tif((typeof item == \"number\" || typeof item == \"string\") && gantt.isTaskExists(item)){\n\t\t\titem = gantt.getTask(item);\n\t\t}\n\t\tif (item && item[this.config.editable_property]) {\n\t\t\treturn false;\n\t\t} else {\n\t\t\treturn (item && item[this.config.readonly_property]) || this.config.readonly;\n\t\t}\n\t};\n};","import CalendarManager from \"./calendar_manager\";\nimport TimeCalculator from \"./time_calculator\";\nimport worktimeFacadeFactory from \"../facades/worktime_calendars\";\nimport * as utils from \"../../utils/utils\";\n\nexport default function (gantt) {\n\tvar manager = new CalendarManager(gantt),\n\ttimeCalculator = new TimeCalculator(manager);\n\tvar facade = worktimeFacadeFactory.create(manager, timeCalculator);\n\tutils.mixin(gantt, facade);\n};\n","export default function(gantt) {\n\n\tgantt.getTaskType = function (type) {\n\t\treturn \"task\";\n\t};\n};","/*\n reuse results of functions that can be recalculated during rendering\n greatly increases the rendering speed when critical path enabled\n Sample - 94_dev/critical_path.html\n\n */\nexport default function(gantt){\n\ngantt._cached_functions = {\n\tcache: {},\n\tmode: false,\n\tcritical_path_mode: false,\n\twrap_methods : function(methods, object){\n\t\tif(object._prefetch_originals){\n\t\t\tfor(var i in object._prefetch_originals){\n\t\t\t\tobject[i] = object._prefetch_originals[i];\n\t\t\t}\n\t\t}\n\t\tobject._prefetch_originals = {};\n\t\tfor(var i = 0; i < methods.length; i++)\n\t\t\tthis.prefetch(methods[i], object);\n\n\t},\n\tprefetch : function(methodname, host){\n\t\tvar original = host[methodname];\n\t\tif(original){\n\t\t\tvar optimizer = this;\n\n\t\t\thost._prefetch_originals[methodname] = original;\n\t\t\thost[methodname] = function get_prefetched_value(){\n\n\t\t\t\tvar argumentsArray = new Array(arguments.length);\n\t\t\t\tfor (var i = 0, l = arguments.length; i < l; i++) {\n\t\t\t\t\targumentsArray[i] = arguments[i];\n\t\t\t\t}\n\n\t\t\t\tif(optimizer.active){\n\t\t\t\t\tvar args = optimizer.get_arguments_hash(Array.prototype.slice.call(argumentsArray));\n\t\t\t\t\tif(!optimizer.cache[methodname]){\n\t\t\t\t\t\toptimizer.cache[methodname] = {};\n\t\t\t\t\t}\n\n\t\t\t\t\tvar cached_values = optimizer.cache[methodname];\n\n\t\t\t\t\tif(optimizer.has_cached_value(cached_values, args)){\n\t\t\t\t\t\treturn optimizer.get_cached_value(cached_values, args);\n\t\t\t\t\t}else{\n\t\t\t\t\t\tvar value = original.apply(this, argumentsArray);\n\t\t\t\t\t\toptimizer.cache_value(cached_values, args, value);\n\t\t\t\t\t\treturn value;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\treturn original.apply(this, argumentsArray);\n\t\t\t};\n\t\t}\n\t\treturn original;\n\t},\n\tcache_value: function(cache, arguments_hash, value){\n\t\tif(this.is_date(value))\n\t\t\tvalue = new Date(value);\n\t\tcache[arguments_hash] = value;\n\t},\n\thas_cached_value: function(cache, arguments_hash){\n\t\treturn cache.hasOwnProperty(arguments_hash);\n\t},\n\tget_cached_value: function(cache, arguments_hash){\n\t\tvar data = cache[arguments_hash];\n\n\t\t//for cached dates - return copy\n\t\tif(this.is_date(data)){\n\t\t\tdata = new Date(data);\n\t\t}\n\t\treturn data;\n\t},\n\tis_date: function(value){\n\t\treturn (value && value.getUTCDate);\n\t},\n\tget_arguments_hash:function(args){\n\t\tvar values = [];\n\t\tfor(var i = 0; i < args.length; i++){\n\t\t\tvalues.push(this.stringify_argument(args[i]));\n\t\t}\n\t\treturn \"(\" + values.join(\";\") + \")\";\n\t},\n\tstringify_argument: function(value){\n\t\t//expecting task or link, or any other data entries, dates and primitive values\n\t\tvar ret = \"\";\n\t\tif(value.id){\n\t\t\tret = value.id;\n\t\t}else if(this.is_date(value)){\n\t\t\tret = value.valueOf();\n\t\t}else{\n\t\t\tret = value;\n\t\t}\n\t\treturn ret + \"\";\n\t},\n\tactivate: function(){\n\t\tthis.clear();\n\t\tthis.active = true;\n\t},\n\tdeactivate: function(){\n\t\tthis.clear();\n\t\tthis.active = false;\n\t},\n\tclear: function(){\n\t\tthis.cache = {};\n\t},\n\n\tsetup: function(gantt){\n\t\tvar override_gantt = [];\n\n\t\tvar gantt_methods  = [\n\t\t\t'_isProjectEnd',\n\t\t\t'_getProjectEnd',\n\t\t\t'_getSlack'\n\t\t];\n\n\n\n\t\tif(this.mode == 'auto'){\n\t\t\tif(gantt.config.highlight_critical_path){\n\t\t\t\toverride_gantt = gantt_methods;\n\t\t\t}\n\t\t}else if(this.mode === true){\n\t\t\toverride_gantt = gantt_methods;\n\t\t}\n\n\t\tthis.wrap_methods(override_gantt, gantt);\n\n\t},\n\tupdate_if_changed: function(gantt){\n\t\tvar changed = (this.critical_path_mode != gantt.config.highlight_critical_path ||\n\t\t\t\t\t\tthis.mode !== gantt.config.optimize_render);\n\t\tif(changed){\n\t\t\tthis.critical_path_mode = gantt.config.highlight_critical_path;\n\t\t\tthis.mode = gantt.config.optimize_render;\n\t\t\tthis.setup(gantt);\n\t\t}\n\t}\n};\n\nfunction activate(){\n\tgantt._cached_functions.update_if_changed(gantt);\n\tif(!gantt._cached_functions.active){\n\t\tgantt._cached_functions.activate();\n\t}\n\treturn true;\n}\ngantt.attachEvent(\"onBeforeGanttRender\", activate);\ngantt.attachEvent(\"onBeforeDataRender\", activate);\ngantt.attachEvent(\"onBeforeSmartRender\",  function(){\n\tactivate();\n});\ngantt.attachEvent(\"onBeforeParse\", activate);\ngantt.attachEvent(\"onDataRender\", function(){\n\tgantt._cached_functions.deactivate();\n});\nvar deactivTimeout = null;\ngantt.attachEvent(\"onSmartRender\", function(){\n\tif(deactivTimeout)\n\t\tclearTimeout(deactivTimeout);\n\tdeactivTimeout = setTimeout(function(){\n\t\tgantt._cached_functions.deactivate();\n\t}, 1000);\n});\n\ngantt.attachEvent(\"onBeforeGanttReady\", function(){\n\tgantt._cached_functions.update_if_changed(gantt);\n\treturn true;\n});\n\n};","function extend(gantt){\n\n\tgantt.destructor = function(){\n\t\tthis.clearAll();\n\t\tthis.callEvent(\"onDestroy\", []);\n\n\t\tif(this.$root){\n\t\t\tdelete this.$root.gantt;\n\t\t}\n\n\t\tif(this._eventRemoveAll){\n\t\t\tthis._eventRemoveAll();\n\t\t}\n\n\t\tif(this.$layout){\n\t\t\tthis.$layout.destructor();\n\t\t}\n\n\t\tif(this.resetLightbox){\n\t\t\tthis.resetLightbox();\n\t\t}\n\n\t\t// GS-99. Call this here to detach the events\n\t\tif (this.ext.inlineEditors) {\n\t\t\tthis.ext.inlineEditors.destructor();\n\t\t}\n\n\t\tif(this._dp && this._dp.destructor){\n\t\t\tthis._dp.destructor();\n\t\t}\n\t\tthis.$services.destructor();\n\n\t\t// detachAllEvents should be called last, because in components may be attached events\n\t\tthis.detachAllEvents();\n\n\t\tfor(var i in this){\n\t\t\tif(i.indexOf(\"$\") === 0){\n\t\t\t\tdelete this[i];\n\t\t\t}\n\t\t}\n\t\tthis.$destroyed = true;\n\t};\n}\n\nexport default extend;\n","import ar from \"./locale_ar\";\nimport be from \"./locale_be\";\nimport ca from \"./locale_ca\";\nimport cn from \"./locale_cn\";\nimport cs from \"./locale_cs\";\nimport da from \"./locale_da\";\nimport de from \"./locale_de\";\nimport el from \"./locale_el\";\nimport en from \"./locale_en\";\nimport es from \"./locale_es\";\nimport fa from \"./locale_fa\";\nimport fi from \"./locale_fi\";\nimport fr from \"./locale_fr\";\nimport he from \"./locale_he\";\nimport hr from \"./locale_hr\";\nimport hu from \"./locale_hu\";\nimport id from \"./locale_id\";\nimport it from \"./locale_it\";\nimport jp from \"./locale_jp\";\nimport kr from \"./locale_kr\";\n\nimport LocaleManager from \"./locale_manager\";\n\nimport nb from \"./locale_nb\";\nimport nl from \"./locale_nl\";\nimport no from \"./locale_no\";\nimport pl from \"./locale_pl\";\nimport pt from \"./locale_pt\";\nimport ro from \"./locale_ro\";\nimport ru from \"./locale_ru\";\nimport si from \"./locale_si\";\nimport sk from \"./locale_sk\";\nimport sv from \"./locale_sv\";\nimport tr from \"./locale_tr\";\nimport ua from \"./locale_ua\";\n\nexport default function(){\n\treturn new LocaleManager({\n\t\ten,\n\t\tar,\n\t\tbe,\n\t\tca,\n\t\tcn,\n\t\tcs,\n\t\tda,\n\t\tde,\n\t\tel,\n\t\tes,\n\t\tfa,\n\t\tfi,\n\t\tfr,\n\t\the,\n\t\thr,\n\t\thu,\n\t\tid,\n\t\tit,\n\t\tjp,\n\t\tkr,\n\t\tnb,\n\t\tnl,\n\t\tno,\n\t\tpl,\n\t\tpt,\n\t\tro,\n\t\tru,\n\t\tsi,\n\t\tsk,\n\t\tsv,\n\t\ttr,\n\t\tua\n\t});\n}","import * as utils from \"../../utils/utils\";\nimport * as domHelpers from \"./utils/dom_helpers\";\n\nexport default function(gantt) {\n\n\tvar boxAttribute = \"data-dhxbox\";\n\n\tvar _dhx_msg_cfg = null;\n\n\tfunction callback(config, result) {\n\t\tvar usercall = config.callback;\n\t\tmodalBox.hide(config.box);\n\n\t\t_dhx_msg_cfg = config.box = null;\n\t\tif (usercall)\n\t\t\tusercall(result);\n\t}\n\n\tfunction modal_key(event) {\n\t\tif (_dhx_msg_cfg) {\n\n\t\t\tvar code = event.which || event.keyCode;\n\t\t\tvar preventDefault = false;\n\n\t\t\tif (messageBox.keyboard) {\n\t\t\t\tif (code == 13 || code == 32) {\n\t\t\t\t\t// default behavior is to confirm/submit popup on space/enter\n\t\t\t\t\t// if browser focus is set on button element - do button click instead of default behavior\n\t\t\t\t\tvar target = event.target || event.srcElement;\n\t\t\t\t\tif (domHelpers.getClassName(target).indexOf(\"gantt_popup_button\") > -1 && target.click) {\n\t\t\t\t\t\ttarget.click();\n\t\t\t\t\t} else {\n\t\t\t\t\t\tcallback(_dhx_msg_cfg, true);\n\t\t\t\t\t\tpreventDefault = true;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tif (code == 27) {\n\t\t\t\t\tcallback(_dhx_msg_cfg, false);\n\t\t\t\t\tpreventDefault = true;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (preventDefault) {\n\t\t\t\tif (event.preventDefault){\n\t\t\t\t\tevent.preventDefault();\n\t\t\t\t}\n\t\t\t\treturn !(event.cancelBubble = true);\n\t\t\t}\n\t\t\treturn;\n\t\t}\n\t}\n\tvar eventElement = domHelpers.getRootNode(gantt.$root) || document;\n\tgantt.event(eventElement, \"keydown\", modal_key, true);\n\n\tfunction modality(mode) {\n\t\tif (!modality.cover) {\n\t\t\tmodality.cover = document.createElement(\"div\");\n\t\t\t//necessary for IE only\n\t\t\tmodality.cover.onkeydown = modal_key;\n\t\t\tmodality.cover.className = \"dhx_modal_cover\";\n\t\t\tdocument.body.appendChild(modality.cover);\n\t\t}\n\n\t\tmodality.cover.style.display = mode ? \"inline-block\" : \"none\";\n\t}\n\n\tfunction button(text, className, result) {\n\t\tvar buttonAriaAttrs = gantt._waiAria.messageButtonAttrString(text);\n\t\tvar name = className.toLowerCase().replace(/ /g, \"_\");\n\t\tvar button_css = \"gantt_\" + name + \"_button\";\n\t\treturn \"<div \" + buttonAriaAttrs + \" class='gantt_popup_button \" + button_css + \"' data-result='\" + result + \"' result='\" + result + \"' ><div>\" + text + \"</div></div>\";\n\t}\n\n\tfunction info(text) {\n\t\tif (!messageBox.area) {\n\t\t\tmessageBox.area = document.createElement(\"div\");\n\t\t\tmessageBox.area.className = \"gantt_message_area\";\n\t\t\tmessageBox.area.style[messageBox.position] = \"5px\";\n\t\t\tdocument.body.appendChild(messageBox.area);\n\t\t}\n\n\t\tmessageBox.hide(text.id);\n\t\tvar message = document.createElement(\"div\");\n\t\tmessage.innerHTML = \"<div>\" + text.text + \"</div>\";\n\t\tmessage.className = \"gantt-info gantt-\" + text.type;\n\t\tmessage.onclick = function () {\n\t\t\tmessageBox.hide(text.id);\n\t\t\ttext = null;\n\t\t};\n\n\t\tgantt._waiAria.messageInfoAttr(message);\n\n\t\tif (messageBox.position == \"bottom\" && messageBox.area.firstChild)\n\t\t\tmessageBox.area.insertBefore(message, messageBox.area.firstChild);\n\t\telse\n\t\t\tmessageBox.area.appendChild(message);\n\n\t\tif (text.expire > 0)\n\t\t\tmessageBox.timers[text.id] = window.setTimeout(function () {\n\t\t\t\t// GS-1213: We need that when Gantt is destroyed\n\t\t\t\tif (messageBox) messageBox.hide(text.id);\n\t\t\t}, text.expire);\n\n\t\tmessageBox.pull[text.id] = message;\n\t\tmessage = null;\n\n\t\treturn text.id;\n\t}\n\n\tfunction getFirstDefined() {\n\t\tvar values = [].slice.apply(arguments, [0]);\n\n\t\tfor (var i = 0; i < values.length; i++) {\n\t\t\tif (values[i]) {\n\t\t\t\treturn values[i];\n\t\t\t}\n\t\t}\n\n\t}\n\n\tfunction _boxStructure(config, ok, cancel) {\n\t\tvar box = document.createElement(\"div\");\n\n\t\tvar contentId = utils.uid();\n\t\tgantt._waiAria.messageModalAttr(box, contentId);\n\n\n\t\tbox.className = \" gantt_modal_box gantt-\" + config.type;\n\t\tbox.setAttribute(boxAttribute, 1);\n\n\t\tvar inner = '';\n\n\t\tif (config.width)\n\t\t\tbox.style.width = config.width;\n\t\tif (config.height)\n\t\t\tbox.style.height = config.height;\n\t\tif (config.title)\n\t\t\tinner += '<div class=\"gantt_popup_title\">' + config.title + '</div>';\n\t\tinner += '<div class=\"gantt_popup_text\" id=\"' + contentId + '\"><span>' + (config.content ? '' : config.text) + '</span></div><div  class=\"gantt_popup_controls\">';\n\t\tif (ok)\n\t\t\tinner += button(getFirstDefined(config.ok, gantt.locale.labels.message_ok, \"OK\"), \"ok\", true);\n\t\tif (cancel)\n\t\t\tinner += button(getFirstDefined(config.cancel, gantt.locale.labels.message_cancel, \"Cancel\"), \"cancel\", false);\n\n\t\tif (config.buttons) {\n\t\t\tfor (var i = 0; i < config.buttons.length; i++) {\n\t\t\t\tvar btn = config.buttons[i];\n\t\t\t\tif (typeof btn == \"object\") {\n\t\t\t\t\t// Support { label:\"Save\", css:\"main_button\", value:\"save\" }\n\t\t\t\t\tvar label = btn.label;\n\t\t\t\t\tvar css = btn.css || (\"gantt_\" + btn.label.toLowerCase() + \"_button\");\n\t\t\t\t\tvar value = btn.value || i;\n\t\t\t\t\tinner += button(label, css, value);\n\t\t\t\t} else {\n\t\t\t\t\tinner += button(btn, btn, i);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tinner += '</div>';\n\t\tbox.innerHTML = inner;\n\n\t\tif (config.content) {\n\t\t\tvar node = config.content;\n\t\t\tif (typeof node == \"string\")\n\t\t\t\tnode = document.getElementById(node);\n\t\t\tif (node.style.display == 'none')\n\t\t\t\tnode.style.display = \"\";\n\t\t\tbox.childNodes[config.title ? 1 : 0].appendChild(node);\n\t\t}\n\n\t\tbox.onclick = function (event) {\n\t\t\tvar source = event.target || event.srcElement;\n\t\t\tif (!source.className) source = source.parentNode;\n\t\t\tif (domHelpers.closest(source, \".gantt_popup_button\")) {\n\t\t\t\tvar result = source.getAttribute(\"data-result\");\n\t\t\t\tresult = (result == \"true\") || (result == \"false\" ? false : result);\n\t\t\t\tcallback(config, result);\n\t\t\t}\n\t\t};\n\t\tconfig.box = box;\n\t\tif (ok || cancel)\n\t\t\t_dhx_msg_cfg = config;\n\n\t\treturn box;\n\t}\n\n\tfunction _createBox(config, ok, cancel) {\n\t\tvar box = config.tagName ? config : _boxStructure(config, ok, cancel);\n\n\t\tif (!config.hidden)\n\t\t\tmodality(true);\n\t\tdocument.body.appendChild(box);\n\t\tvar x = Math.abs(Math.floor(((window.innerWidth || document.documentElement.offsetWidth) - box.offsetWidth) / 2));\n\t\tvar y = Math.abs(Math.floor(((window.innerHeight || document.documentElement.offsetHeight) - box.offsetHeight) / 2));\n\t\tif (config.position == \"top\")\n\t\t\tbox.style.top = \"-3px\";\n\t\telse\n\t\t\tbox.style.top = y + 'px';\n\t\tbox.style.left = x + 'px';\n\t\t//necessary for IE only\n\t\tbox.onkeydown = modal_key;\n\n\t\tmodalBox.focus(box);\n\n\t\tif (config.hidden)\n\t\t\tmodalBox.hide(box);\n\n\t\tgantt.callEvent(\"onMessagePopup\", [box]);\n\t\treturn box;\n\t}\n\n\tfunction alertPopup(config) {\n\t\treturn _createBox(config, true, false);\n\t}\n\n\tfunction confirmPopup(config) {\n\t\treturn _createBox(config, true, true);\n\t}\n\n\tfunction boxPopup(config) {\n\t\treturn _createBox(config);\n\t}\n\n\tfunction box_params(text, type, callback) {\n\t\tif (typeof text != \"object\") {\n\t\t\tif (typeof type == \"function\") {\n\t\t\t\tcallback = type;\n\t\t\t\ttype = \"\";\n\t\t\t}\n\t\t\ttext = {text: text, type: type, callback: callback};\n\t\t}\n\t\treturn text;\n\t}\n\n\tfunction params(text, type, expire, id) {\n\t\tif (typeof text != \"object\")\n\t\t\ttext = {text: text, type: type, expire: expire, id: id};\n\t\ttext.id = text.id || utils.uid();\n\t\ttext.expire = text.expire || messageBox.expire;\n\t\treturn text;\n\t}\n\n\tvar alertBox = function () {\n\t\tvar text = box_params.apply(this, arguments);\n\t\ttext.type = text.type || \"confirm\";\n\t\treturn alertPopup(text);\n\t};\n\tvar confirmBox = function () {\n\t\tvar text = box_params.apply(this, arguments);\n\t\ttext.type = text.type || \"alert\";\n\t\treturn confirmPopup(text);\n\t};\n\tvar modalBox = function () {\n\t\tvar text = box_params.apply(this, arguments);\n\t\ttext.type = text.type || \"alert\";\n\t\treturn boxPopup(text);\n\t};\n\tmodalBox.hide = function (node) {\n\t\twhile (node && node.getAttribute && !node.getAttribute(boxAttribute))\n\t\t\tnode = node.parentNode;\n\t\tif (node) {\n\t\t\tnode.parentNode.removeChild(node);\n\t\t\tmodality(false);\n\n\t\t\tgantt.callEvent(\"onAfterMessagePopup\", [node]);\n\t\t}\n\t};\n\n\tmodalBox.focus = function (node) {\n\t\tsetTimeout(function () {\n\t\t\tvar focusable = domHelpers.getFocusableNodes(node);\n\t\t\tif (focusable.length) {\n\t\t\t\tif (focusable[0].focus) focusable[0].focus();\n\t\t\t}\n\t\t}, 1);\n\t};\n\n\tvar messageBox = function (text, type, expire, id) {\n\t\ttext = params.apply(this, arguments);\n\t\ttext.type = text.type || \"info\";\n\n\t\tvar subtype = text.type.split(\"-\")[0];\n\t\tswitch (subtype) {\n\t\t\tcase \"alert\":\n\t\t\t\treturn alertPopup(text);\n\t\t\tcase \"confirm\":\n\t\t\t\treturn confirmPopup(text);\n\t\t\tcase \"modalbox\":\n\t\t\t\treturn boxPopup(text);\n\t\t\tdefault:\n\t\t\t\treturn info(text);\n\t\t}\n\t};\n\n\tmessageBox.seed = (new Date()).valueOf();\n\tmessageBox.uid = utils.uid;\n\tmessageBox.expire = 4000;\n\tmessageBox.keyboard = true;\n\tmessageBox.position = \"top\";\n\tmessageBox.pull = {};\n\tmessageBox.timers = {};\n\n\tmessageBox.hideAll = function () {\n\t\tfor (var key in messageBox.pull)\n\t\t\tmessageBox.hide(key);\n\t};\n\tmessageBox.hide = function (id) {\n\t\tvar obj = messageBox.pull[id];\n\t\tif (obj && obj.parentNode) {\n\t\t\twindow.setTimeout(function () {\n\t\t\t\tobj.parentNode.removeChild(obj);\n\t\t\t\tobj = null;\n\t\t\t}, 2000);\n\t\t\tobj.className += \" hidden\";\n\n\t\t\tif (messageBox.timers[id])\n\t\t\t\twindow.clearTimeout(messageBox.timers[id]);\n\t\t\tdelete messageBox.pull[id];\n\t\t}\n\t};\n\n\tvar popups = [];\n\tgantt.attachEvent(\"onMessagePopup\", function(box){\n\t\tpopups.push(box);\n\t});\n\tgantt.attachEvent(\"onAfterMessagePopup\", function(box){\n\t\tfor(var i = 0; i < popups.length; i++){\n\t\t\tif(popups[i] === box){\n\t\t\t\tpopups.splice(i, 1);\n\t\t\t\ti--;\n\t\t\t}\n\t\t}\n\t});\n\n\tgantt.attachEvent(\"onDestroy\", function(){\n\t\tif(modality.cover && modality.cover.parentNode){\n\t\t\tmodality.cover.parentNode.removeChild(modality.cover);\n\t\t}\n\n\t\tfor(var i = 0; i < popups.length; i++){\n\t\t\tif(popups[i].parentNode){\n\t\t\t\tpopups[i].parentNode.removeChild(popups[i]);\n\t\t\t}\n\t\t}\n\t\tpopups = null;\n\n\t\tif(messageBox.area && messageBox.area.parentNode){\n\t\t\tmessageBox.area.parentNode.removeChild(messageBox.area);\n\t\t}\n\t\tmessageBox = null;\n\t});\n\n\treturn {\n\t\talert: alertBox,\n\t\tconfirm: confirmBox,\n\t\tmessage: messageBox,\n\t\tmodalbox: modalBox\n\t};\n};","import * as utils from \"../../utils/utils\";\n\nfunction extendSettings (store, parentSettings){\n\tvar own = this.$config[store];\n\n\tif(own){\n\t\tif(!own.$extendedConfig){\n\t\t\town.$extendedConfig = true;\n\t\t\tObject.setPrototypeOf(own, parentSettings);\n\t\t}\n\t\treturn own;\n\t}else{\n\t\treturn parentSettings;\n\t}\n}\n\nvar configurable = function(parentView){\n\tvar parentConfig,\n\t\tparentTemplates;\n\n\treturn {\n\t\t$getConfig: function(){\n\t\t\tif(!parentConfig){\n\t\t\t\tparentConfig = parentView ? parentView.$getConfig() : this.$gantt.config;\n\t\t\t}\n\t\t\tif(!this.$config.config){\n\t\t\t\treturn parentConfig;\n\t\t\t}else{\n\t\t\t\treturn extendSettings.call(this, \"config\", parentConfig);\n\t\t\t}\n\t\t},\n\t\t$getTemplates: function(){\n\t\t\tif(!parentTemplates){\n\t\t\t\tparentTemplates = parentView ? parentView.$getTemplates() : this.$gantt.templates;\n\t\t\t}\n\t\t\tif(!this.$config.templates){\n\t\t\t\treturn parentTemplates;\n\t\t\t}else{\n\t\t\t\treturn extendSettings.call(this, \"templates\", parentTemplates);\n\t\t\t}\n\t\t}\n\t};\n};\n\nexport default function(obj, parent){\n\tutils.mixin(obj, configurable(parent));\n};","import * as utils from \"../../utils/utils\";\nimport configurable from \"./configurable\";\n\nvar uiFactory = function createFactory(gantt){\n\tvar views = {};\n\n\tfunction ui(cell, parentView) {\n\t\tvar content;\n\t\tvar view = \"cell\";\n\t\tif (cell.view){\n\t\t\tview = \"viewcell\";\n\t\t}else if (cell.resizer) {\n\t\t\tview = \"resizer\";\n\t\t}\n\t\telse if (cell.rows || cell.cols) {\n\t\t\tview = \"layout\";\n\t\t}\n\t\telse if (cell.views) {\n\t\t\tview = \"multiview\";\n\t\t}\n\n\t\tcontent = createView.call(this, view, null, cell, parentView);\n\t\treturn content;\n\t}\n\t\n\tvar createdViews = {};\n\n\tfunction createView(name, parent, config, parentView) {\n\t\tvar creator = views[name];\n\n\t\tif(!creator || !creator.create)\n\t\t\treturn false;\n\n\t\tif(name == \"resizer\" && !config.mode){\n\t\t\tif(parentView.$config.cols){\n\t\t\t\tconfig.mode = \"x\";\n\t\t\t}else{\n\t\t\t\tconfig.mode = \"y\";\n\t\t\t}\n\t\t}\n\n\t\tif(name == \"viewcell\" && config.view == \"scrollbar\" && !config.scroll){\n\t\t\tif(parentView.$config.cols){\n\t\t\t\tconfig.scroll = \"y\";\n\t\t\t}else{\n\t\t\t\tconfig.scroll = \"x\";\n\t\t\t}\n\t\t}\n\n\t\tvar config = utils.copy(config);\n\n\t\tif(!config.id && !createdViews[config.view]){\n\t\t\tconfig.id = config.view;\n\t\t}\n\n\t\tif(config.id && !config.css){\n\t\t\tconfig.css = config.id+\"_cell\";\n\t\t}\n\n\t\tvar view = new creator.create(parent, config, this, gantt);\n\n\t\tif(creator.configure){\n\t\t\tcreator.configure(view);\n\t\t}\n\n\t\tconfigurable(view, parentView);\n\t\tif(!view.$id){\n\t\t\tview.$id = config.id || gantt.uid();\n\t\t}\n\n\t\tif(!view.$parent && typeof parent == \"object\"){\n\t\t\tview.$parent = parent;\n\t\t}\n\t\tif(!view.$config){\n\t\t\tview.$config = config;\n\t\t}\n\n\t\tif(createdViews[view.$id]){\n\t\t\tview.$id = gantt.uid();\n\t\t}\n\n\t\tcreatedViews[view.$id] = view;\n\n\t\treturn view;\n\t}\n\n\tfunction reset(){\n\t\tcreatedViews = {};\n\t}\n\n\tfunction register(name, viewConstructor, configure){\n\t\tviews[name] = {create: viewConstructor, configure: configure};\n\t}\n\n\tfunction getView(id){\n\t\treturn createdViews[id];\n\t}\n\n\tvar factory = {\n\t\tinitUI:ui,\n\t\treset: reset,\n\t\tregisterView: register,\n\t\tcreateView: createView,\n\t\tgetView: getView\n\t};\n\n\treturn factory;\n};\n\nexport default {\n\tcreateFactory: uiFactory\n};\n\n","import * as domHelpers from \"./utils/dom_helpers\";\n\nvar createMouseHandler = (function(domHelpers) {\n\treturn function (gantt) {\n\t\tvar eventHandlers = {\n\t\t\t\"click\": {},\n\t\t\t\"doubleclick\": {},\n\t\t\t\"contextMenu\": {}\n\t\t};\n\n\t\tfunction addEventTarget(event, className, handler, root) {\n\t\t\tif(!eventHandlers[event][className]){\n\t\t\t\teventHandlers[event][className] = [];\n\t\t\t}\n\n\t\t\teventHandlers[event][className].push({\n\t\t\t\thandler: handler,\n\t\t\t\troot: root\n\t\t\t});\n\t\t}\n\n\t\tfunction callHandler(eventName, className, root, args) {\n\t\t\tvar handlers = eventHandlers[eventName][className];\n\t\t\tif(handlers){\n\t\t\t\tfor(var i = 0; i < handlers.length; i++){\n\t\t\t\t\tif(!(root || handlers[i].root) || handlers[i].root === root){\n\t\t\t\t\t\thandlers[i].handler.apply(this, args);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tfunction onClick(e) {\n\t\t\te = e || window.event;\n\t\t\tvar id = gantt.locate(e);\n\n\t\t\tvar handlers = findEventHandlers(e, eventHandlers.click);\n\t\t\tvar res = true;\n\t\t\tif (id !== null) {\n\t\t\t\tres = !gantt.checkEvent(\"onTaskClick\") || gantt.callEvent(\"onTaskClick\", [id, e]);\n\t\t\t} else {\n\t\t\t\tgantt.callEvent(\"onEmptyClick\", [e]);\n\t\t\t}\n\n\t\t\tif (res) {\n\t\t\t\tvar default_action = callEventHandlers(handlers, e, id);\n\t\t\t\tif (!default_action)\n\t\t\t\t\treturn;\n\n\t\t\t\t// GS-1025: if we don't do that, the dropdown or date select will be closed for unselected tasks\n\t\t\t\t// GS-1078: or for the built-in select inline editor\n\t\t\t\tswitch(e.target.nodeName) {\n\t\t\t\t\tcase \"SELECT\":\n\t\t\t\t\tcase 'INPUT':\n\t\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\t//allow task selection when the multiselect plugin is not enabled\n\t\t\t\tif (id && gantt.getTask(id) && !gantt._multiselect && gantt.config.select_task) {\n\t\t\t\t\tgantt.selectTask(id);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tfunction onContextMenu(e) {\n\t\t\te = e || window.event;\n\t\t\tvar src = e.target || e.srcElement,\n\t\t\t\ttaskId = gantt.locate(src),\n\t\t\t\tlinkId = gantt.locate(src, gantt.config.link_attribute);\n\n\t\t\tvar res = !gantt.checkEvent(\"onContextMenu\") || gantt.callEvent(\"onContextMenu\", [taskId, linkId, e]);\n\t\t\tif (!res) {\n\t\t\t\tif (e.preventDefault)\n\t\t\t\t\te.preventDefault();\n\t\t\t\telse\n\t\t\t\t\te.returnValue = false;\n\t\t\t}\n\t\t\treturn res;\n\t\t}\n\n\t\tfunction findEventHandlers(e, hash){\n\t\t\tvar trg = e.target || e.srcElement;\n\t\t\tvar handlers = [];\n\t\t\twhile (trg) {\n\t\t\t\tvar css = domHelpers.getClassName(trg);\n\t\t\t\tif (css) {\n\t\t\t\t\tcss = css.split(\" \");\n\t\t\t\t\tfor (var i = 0; i < css.length; i++) {\n\t\t\t\t\t\tif (!css[i]) continue;\n\t\t\t\t\t\tif (hash[css[i]]) {\n\t\t\t\t\t\t\tvar delegateHandlers = hash[css[i]];\n\n\t\t\t\t\t\t\tfor(var h = 0; h < delegateHandlers.length; h++){\n\t\t\t\t\t\t\t\tif(delegateHandlers[h].root){\n\t\t\t\t\t\t\t\t\tif(!domHelpers.isChildOf(trg, delegateHandlers[h].root)){\n\t\t\t\t\t\t\t\t\t\tcontinue;\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\thandlers.push(delegateHandlers[h].handler);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\ttrg = trg.parentNode;\n\t\t\t}\n\t\t\treturn handlers;\n\t\t}\n\n\t\tfunction callEventHandlers(handlers, e, id){\n\t\t\tvar res = true;\n\n\t\t\tfor(var i = 0; i < handlers.length; i++){\n\t\t\t\tvar handlerResult =  handlers[i].call(gantt, e, id, e.target || e.srcElement);\n\t\t\t\tres = res && !(typeof handlerResult != \"undefined\" && handlerResult !== true);\n\t\t\t}\n\n\t\t\treturn res;\n\t\t}\n\n\n\t\tfunction onDoubleClick(e) {\n\t\t\te = e || window.event;\n\t\t\tvar id = gantt.locate(e);\n\n\t\t\tvar handlers = findEventHandlers(e, eventHandlers.doubleclick);\n\t\t\t// when doubleclick fired not on task, id === null\n\t\t\tvar res = !gantt.checkEvent(\"onTaskDblClick\") || id === null || gantt.callEvent(\"onTaskDblClick\", [id, e]);\n\t\t\tif (res) {\n\t\t\t\tvar default_action = callEventHandlers(handlers, e, id);\n\t\t\t\tif (!default_action)\n\t\t\t\t\treturn;\n\n\t\t\t\tif (id !== null && gantt.getTask(id)) {\n\t\t\t\t\tif (res && gantt.config.details_on_dblclick && !gantt.isReadonly(id)) {\n\t\t\t\t\t\tgantt.showLightbox(id);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tfunction onMouseMove(e) {\n\t\t\tif (gantt.checkEvent(\"onMouseMove\")) {\n\t\t\t\tvar id = gantt.locate(e);\n\t\t\t\tgantt._last_move_event = e;\n\t\t\t\tgantt.callEvent(\"onMouseMove\", [id, e]);\n\t\t\t}\n\t\t}\n\n\t\tfunction detach(eventName, className, handler, root) {\n\t\t\tif (eventHandlers[eventName] && eventHandlers[eventName][className]) {\n\t\t\t\tvar handlers = eventHandlers[eventName];\n\t\t\t\tvar elementHandlers = handlers[className];\n\t\t\t\tfor(var i = 0; i < elementHandlers.length; i++){\n\t\t\t\t\tif(elementHandlers[i].root == root){\n\t\t\t\t\t\telementHandlers.splice(i, 1);\n\t\t\t\t\t\ti--;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tif(!elementHandlers.length){\n\t\t\t\t\tdelete handlers[className];\n\t\t\t\t}\n\n\t\t\t}\n\t\t}\n\n\t\tvar domEvents = gantt._createDomEventScope();\n\n\t\tfunction reset(node){\n\n\t\t\tdomEvents.detachAll();\n\n\t\t\tif(node){\n\t\t\t\tdomEvents.attach(node, \"click\", onClick);\n\t\t\t\tdomEvents.attach(node, \"dblclick\", onDoubleClick);\n\t\t\t\tdomEvents.attach(node, \"mousemove\", onMouseMove);\n\t\t\t\tdomEvents.attach(node, \"contextmenu\", onContextMenu);\n\t\t\t}\n\t\t}\n\n\n\n\t\treturn {\n\t\t\treset: reset,\n\t\t\tglobal: function(event, classname, handler){\n\t\t\t\taddEventTarget(event, classname, handler, null);\n\t\t\t},\n\t\t\tdelegate: addEventTarget,\n\t\t\tdetach: detach,\n\t\t\tcallHandler: callHandler,\n\t\t\tonDoubleClick: onDoubleClick,\n\t\t\tonMouseMove: onMouseMove,\n\t\t\tonContextMenu: onContextMenu,\n\t\t\tonClick: onClick,\n\t\t\tdestructor: function(){\n\t\t\t\treset();\n\t\t\t\teventHandlers = null;\n\t\t\t\tdomEvents = null;\n\t\t\t}\n\n\t\t};\n\t};\n\n})(domHelpers);\n\n\nexport default {\n\tinit:createMouseHandler\n};","export default function(viewport, box, gantt){\n\tif(!box){\n\t\treturn false;\n\t}\n\n\tif(box.left > viewport.x_end || box.left + box.width < viewport.x){\n\t\treturn false;\n\t}\n\n\tif(box.top > viewport.y_end || box.top + box.height < viewport.y){\n\t\treturn false;\n\t}\n\t\n\treturn true;\n};","export default function(gantt){\n\treturn gantt.config.smart_rendering && gantt._smart_render;\n};","export default function(item, view, config){\n\treturn {\n\t\ttop: view.getItemTop(item.id),\n\t\theight: view.getItemHeight(item.id),\n\t\tleft: 0,\n\t\tright: Infinity\n\t};\n};","export default function getVisibleTasksRange(gantt, view, config, datastore, viewport){\n\tvar buffer = 1;\n\tvar start = view.getItemIndexByTopPosition(viewport.y) || 0;\n\tvar end = view.getItemIndexByTopPosition(viewport.y_end) || datastore.count();\n\tvar indexStart = Math.max(0, start - buffer);\n\tvar indexEnd =  Math.min(datastore.count(), end + buffer);\n\t// GS-2481 and GS-1715, need to take into account selected task when using keyboard shortcuts and when the inline editor is opened \n\tconst extraTasksIds= [];\n\tif (gantt.config.keyboard_navigation && gantt.getSelectedId()) {\n\t\textraTasksIds.push(gantt.getSelectedId());\n\t}\n\tif (gantt.$ui.getView(\"grid\") && gantt.ext.inlineEditors && gantt.ext.inlineEditors.getState().id) {\n\t\tlet inlineEditorId = gantt.ext.inlineEditors.getState().id;\n\t\tif (datastore.exists(inlineEditorId)){\n\t\t\textraTasksIds.push(inlineEditorId);\n\t\t}\n\t}\n\treturn {\n\t\tstart: indexStart,\n\t\tend: indexEnd,\n\t\tids: extraTasksIds \n\t};\n};","import genericViewPortChecker from \"./viewport/is_in_viewport\";\nimport isLegacyRender from \"./is_legacy_smart_render\";\nimport basicGetRectangle from \"./viewport/get_grid_row_rectangle\";\nimport basicGetRange from \"./viewport/get_visible_bars_range\";\nvar rendererFactory = function(gantt){\n\n\t//hash of dom elements is needed to redraw single bar/link\n\tvar task_area_pulls = {},\n\t\ttask_area_renderers = {};\n\n\tfunction getView(layer){\n\t\tvar view = null;\n\t\tif (typeof layer.view === \"string\") {\n\t\t\tview = gantt.$ui.getView(layer.view);\n\t\t} else if (layer.view) {\n\t\t\tview = layer.view;\n\t\t}\n\t\treturn view;\n\t}\n\n\tfunction getRenderer(id, layer, node) {\n\t\t\n\t\tif (task_area_renderers[id])\n\t\t\treturn task_area_renderers[id];\n\n\t\tif (!layer.renderer)\n\t\t\tgantt.assert(false, \"Invalid renderer call\");\n\n\t\tvar renderMethod = null;\n\t\tvar updateMethod = null;\n\t\tvar getRectangle = null;\n\t\tvar renderCallbackMethod = null;\n\t\tvar specializedViewPortChecker = null;\n\n\t\tif(typeof layer.renderer === \"function\"){\n\t\t\trenderMethod = layer.renderer;\n\t\t\tgetRectangle = basicGetRectangle;\n\t\t}else{\n\t\t\trenderMethod = layer.renderer.render;\n\t\t\tupdateMethod = layer.renderer.update;\n\t\t\trenderCallbackMethod = layer.renderer.onrender;\n\t\t\t\n\t\t\tif(layer.renderer.isInViewPort){\n\t\t\t\tspecializedViewPortChecker = layer.renderer.isInViewPort;\n\t\t\t}else{\n\t\t\t\tgetRectangle = layer.renderer.getRectangle;\n\t\t\t}\n\n\t\t\tif (!getRectangle && getRectangle !== null) {\n\t\t\t\tgetRectangle = basicGetRectangle;\n\t\t\t}\n\t\t}\n\n\t\tvar filter = layer.filter;\n\n\t\tif (node)\n\t\t\tnode.setAttribute(gantt.config.layer_attribute, true);\n\n\t\ttask_area_renderers[id] = {\n\t\t\trender_item: function (item, container, viewPort, layerView, viewConfig) {\n\t\t\t\tcontainer = container || node;\n\t\t\t\tif (filter) {\n\t\t\t\t\tif (!filter(item)) {\n\t\t\t\t\t\tthis.remove_item(item.id);\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tvar view = layerView || getView(layer);\n\t\t\t\tvar config = viewConfig || (view ? view.$getConfig() : null);\n\t\t\t\tvar rendererViewPort = viewPort;\n\t\t\t\tif(!rendererViewPort && config && config.smart_rendering){\n\t\t\t\t\trendererViewPort = view.getViewPort();\n\t\t\t\t}\n\n\t\t\t\tvar dom = null;\n\t\t\t\tif(!isLegacyRender(gantt) && (getRectangle || specializedViewPortChecker) && rendererViewPort){\n\t\t\t\t\tvar isVisible = false;\n\t\t\t\t\tif(specializedViewPortChecker){\n\t\t\t\t\t\tisVisible = specializedViewPortChecker(item, rendererViewPort, view, config, gantt);\n\t\t\t\t\t}else{\n\t\t\t\t\t\tisVisible = genericViewPortChecker(rendererViewPort, getRectangle(item, view, config, gantt), gantt);\n\t\t\t\t\t}\n\t\t\t\t\tif(isVisible){\n\t\t\t\t\t\tdom = renderMethod.call(gantt, item, view, config, rendererViewPort);\n\t\t\t\t\t}\n\t\t\t\t}else{\n\t\t\t\t\tdom = renderMethod.call(gantt, item, view, config, rendererViewPort);\n\t\t\t\t}\n\t\t\t\tthis.append(item, dom, container);\n\n\t\t\t\tvar useBuffer = container.nodeType == 11;//DocumentFragment\n\t\t\t\tif(renderCallbackMethod && !useBuffer && dom) {\n\t\t\t\t\trenderCallbackMethod.call(gantt, item, dom, view);\n\t\t\t\t} \n\t\t\t},\n\n\t\t\tclear: function (container) {\n\n\t\t\t\tthis.rendered = task_area_pulls[id] = {};\n\t\t\t\tif(!layer.append)\n\t\t\t\t\tthis.clear_container(container);\n\t\t\t},\n\t\t\tclear_container: function (container) {\n\t\t\t\tcontainer = container || node;\n\t\t\t\tif (container){\n\t\t\t\t\tcontainer.innerHTML = \"\";\n\t\t\t\t}\n\t\t\t},\n\t\t\tget_visible_range: function(datastore){\n\t\t\t\tvar view = getView(layer);\n\t\t\t\tvar viewport;\n\t\t\t\tvar viewConfig = view ? view.$getConfig() : null;\n\t\t\t\tif(viewConfig && viewConfig.smart_rendering){\n\t\t\t\t\tviewport = view.getViewPort();\n\t\t\t\t}\n\n\t\t\t\tvar range;\n\t\t\t\tif(view && viewport){\n\t\t\t\t\tif(typeof layer.renderer === \"function\"){\n\t\t\t\t\t\trange = basicGetRange(gantt, view, viewConfig, datastore, viewport);\n\t\t\t\t\t}else if(layer.renderer && layer.renderer.getVisibleRange){\n\t\t\t\t\t\trange = layer.renderer.getVisibleRange(gantt, view, viewConfig, datastore, viewport);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tif(!range){\n\t\t\t\t\trange = {\n\t\t\t\t\t\tstart: 0,\n\t\t\t\t\t\tend: datastore.count()\n\t\t\t\t\t};\n\t\t\t\t}\n\n\t\t\t\treturn range;\n\t\t\t},\n\t\t\tprepare_data: function(items){\n\t\t\t\tif(layer.renderer && layer.renderer.prepareData){\n\t\t\t\t\treturn layer.renderer.prepareData(items, gantt, layer);\n\t\t\t\t}\n\t\t\t},\n\t\t\trender_items: function (items, container) {\n\t\t\t\tcontainer = container || node;\n\n\t\t\t\tvar buffer = document.createDocumentFragment();\n\t\t\t\tthis.clear(container);\n\n\t\t\t\tvar viewPort = null;\n\t\t\t\tvar view = getView(layer);\n\t\t\t\tvar viewConfig = view ? view.$getConfig() : null;\n\t\t\t\tif(viewConfig && viewConfig.smart_rendering){\n\t\t\t\t\tviewPort = view.getViewPort();\n\t\t\t\t}\n\n\t\t\t\tfor (var i = 0, vis = items.length; i < vis; i++) {\n\t\t\t\t\tthis.render_item(items[i], buffer, viewPort, view, viewConfig);\n\t\t\t\t}\n\n\t\t\t\tcontainer.appendChild(buffer, container);\n\n\t\t\t\tvar itemsSearch = {};\n\t\t\t\titems.forEach(function(item){\n\t\t\t\t\titemsSearch[item.id] = item;\n\t\t\t\t});\n\t\t\t\tvar renderedItems = {};\n\t\t\t\tif (renderCallbackMethod) {\n\t\t\t\t\tvar newElements = {};\n\t\t\t\t\tfor(var i in this.rendered) {\n\t\t\t\t\t\tif(!renderedItems[i]){\n\t\t\t\t\t\t\tnewElements[i] = this.rendered[i];\n\t\t\t\t\t\t\trenderCallbackMethod.call(gantt, itemsSearch[i], this.rendered[i], view);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t}\n\t\t\t},\n\t\t\tupdate_items: function (items, container) {\n\t\t\t\tvar view = getView(layer);\n\t\t\t\tvar viewConfig = view ? view.$getConfig() : null;\n\t\t\t\tif(!view || !view.$getConfig().smart_rendering || isLegacyRender(gantt)){\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tif(!this.rendered){\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tif(!(getRectangle || specializedViewPortChecker)){\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tcontainer = container || node;\n\n\t\t\t\tvar buffer = document.createDocumentFragment();\n\n\t\t\t\tvar viewPort = null;\n\t\t\t\tif(view){\n\t\t\t\t\tviewPort = view.getViewPort();\n\t\t\t\t}\n\n\t\t\t\tvar itemsSearch = {};\n\t\t\t\titems.forEach(function(item){\n\t\t\t\t\titemsSearch[item.id] = item;\n\t\t\t\t});\n\t\t\t\tvar renderedItems = {};\n\n\t\t\t\tvar nodesToRemove = {};\n\t\t\t\tfor(var i in this.rendered){\n\t\t\t\t\tnodesToRemove[i] = true;\n\t\t\t\t\trenderedItems[i] = true;\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\tvar renderCalledFor = {};\n\t\t\t\tfor (var i = 0, vis = items.length; i < vis; i++) {\n\t\t\t\t\tvar item = items[i];\n\t\t\t\t\tvar itemNode = this.rendered[item.id];\n\t\t\t\t\tnodesToRemove[item.id] = false;\n\t\t\t\t\tif (itemNode && itemNode.parentNode) {\n\t\t\t\t\t\tvar isVisible = false;\n\t\t\t\t\t\tif(specializedViewPortChecker){\n\t\t\t\t\t\t\tisVisible = specializedViewPortChecker(item, viewPort, view, viewConfig, gantt);\n\t\t\t\t\t\t}else{\n\t\t\t\t\t\t\tisVisible = genericViewPortChecker(viewPort, getRectangle(item, view, viewConfig, gantt), gantt);\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (!isVisible) {\n\t\t\t\t\t\t\tnodesToRemove[item.id] = true;\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tif(updateMethod){\n\t\t\t\t\t\t\t\tupdateMethod.call(gantt, item, itemNode, view, viewConfig, viewPort);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tthis.restore(item, buffer);\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\t\t\trenderCalledFor[items[i].id] = true;\n\t\t\t\t\t\tthis.render_item(items[i], buffer, viewPort, view, viewConfig);\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tfor(var i in nodesToRemove){\n\t\t\t\t\tif(nodesToRemove[i]){\n\t\t\t\t\t\tthis.hide(i);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tif(buffer.childNodes.length){\n\t\t\t\t\tcontainer.appendChild(buffer, container);\n\t\t\t\t}\n\n\t\t\t\tif (renderCallbackMethod) {\n\t\t\t\t\tvar newElements = {};\n\t\t\t\t\tfor(var i in this.rendered) {\n\t\t\t\t\t\tif(!renderedItems[i] || renderCalledFor[i]){\n\t\t\t\t\t\t\tnewElements[i] = this.rendered[i];\n\t\t\t\t\t\t\trenderCallbackMethod.call(gantt, itemsSearch[i], this.rendered[i], view);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t}\n\t\t\t},\n\t\t\tappend: function (item, node, container) {\n\t\t\t\tif(!this.rendered){\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tif (!node) {\n\t\t\t\t\tif (this.rendered[item.id]) {\n\t\t\t\t\t\tthis.remove_item(item.id);\n\t\t\t\t\t}\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tif (this.rendered[item.id] && this.rendered[item.id].parentNode) {\n\t\t\t\t\tthis.replace_item(item.id, node);\n\t\t\t\t} else {\n\t\t\t\t\tcontainer.appendChild(node);\n\t\t\t\t}\n\t\t\t\tthis.rendered[item.id] = node;\n\t\t\t},\n\t\t\treplace_item: function (item_id, newNode) {\n\t\t\t\tvar item = this.rendered[item_id];\n\t\t\t\tif (item && item.parentNode) {\n\t\t\t\t\titem.parentNode.replaceChild(newNode, item);\n\n\t\t\t\t}\n\t\t\t\tthis.rendered[item_id] = newNode;\n\t\t\t},\n\t\t\tremove_item: function (item_id) {\n\t\t\t\tthis.hide(item_id);\n\t\t\t\tdelete this.rendered[item_id];\n\t\t\t},\n\t\t\thide: function (item_id) {\n\t\t\t\tvar item = this.rendered[item_id];\n\t\t\t\tif (item && item.parentNode) {\n\t\t\t\t\titem.parentNode.removeChild(item);\n\t\t\t\t}\n\t\t\t},\n\t\t\trestore: function (item, container) {\n\t\t\t\tvar dom = this.rendered[item.id];\n\t\t\t\tif (dom) {\n\t\t\t\t\tif (!dom.parentNode) {\n\t\t\t\t\t\tthis.append(item, dom, container || node);\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tthis.render_item(item, container || node);\n\t\t\t\t}\n\t\t\t},\n\t\t\tchange_id: function (oldid, newid) {\n\t\t\t\tthis.rendered[newid] = this.rendered[oldid];\n\t\t\t\tdelete this.rendered[oldid];\n\t\t\t},\n\t\t\trendered: task_area_pulls[id],\n\t\t\tnode: node,\n\t\t\tdestructor: function () {\n\t\t\t\tthis.clear();\n\t\t\t\tdelete task_area_renderers[id];\n\t\t\t\tdelete task_area_pulls[id];\n\t\t\t}\n\t\t};\n\n\t\treturn task_area_renderers[id];\n\t}\n\n\n\tfunction clearRenderers() {\n\t\tfor (var i in task_area_renderers) {\n\t\t\tgetRenderer(i).destructor();\n\t\t}\n\t}\n\n\treturn {\n\t\tgetRenderer: getRenderer,\n\t\tclearRenderers: clearRenderers\n\t};\n\n};\n\nexport default rendererFactory;","import renderFactoryProvider from \"./render_factory\";\nimport * as utils from \"../../../utils/utils\";\nimport * as domHelpers from \"../utils/dom_helpers\";\nimport isLegacyRender from \"./is_legacy_smart_render\";\n\nvar layerFactory = function(gantt){\n\n\tvar renderFactory = renderFactoryProvider(gantt);\n\treturn {\n\tcreateGroup: function (getContainer, relativeRoot, defaultFilters, initLayer) {\n\n\t\tvar renderGroup = {\n\t\t\ttempCollection: [],\n\t\t\trenderers: {},\n\t\t\tcontainer: getContainer,\n\t\t\tfilters: [],\n\t\t\tgetLayers: function () {\n\t\t\t\tthis._add();// add pending layers\n\n\t\t\t\tvar res = [];\n\t\t\t\tfor (var i in this.renderers) {\n\t\t\t\t\tres.push(this.renderers[i]);\n\t\t\t\t}\n\t\t\t\treturn res;\n\t\t\t},\n\t\t\tgetLayer: function (id) {\n\t\t\t\treturn this.renderers[id];\n\t\t\t},\n\t\t\t_add: function (layer) {\n\t\t\t\tif (layer) {\n\t\t\t\t\tlayer.id = layer.id || utils.uid();\n\t\t\t\t\tthis.tempCollection.push(layer);\n\t\t\t\t}\n\n\t\t\t\tvar container = this.container();\n\n\t\t\t\tvar pending = this.tempCollection;\n\t\t\t\tfor (var i = 0; i < pending.length; i++) {\n\t\t\t\t\tlayer = pending[i];\n\n\t\t\t\t\tif (!this.container() && !(layer && layer.container && domHelpers.isChildOf(layer.container, document.body))) continue;\n\n\t\t\t\t\tvar node = layer.container,\n\t\t\t\t\t\tid = layer.id,\n\t\t\t\t\t\ttopmost = layer.topmost;\n\t\t\t\t\tif (!node.parentNode) {\n\t\t\t\t\t\t//insert on top or below the tasks\n\t\t\t\t\t\tif (topmost) {\n\t\t\t\t\t\t\tcontainer.appendChild(node);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tvar rel = relativeRoot ? relativeRoot() : container.firstChild;\n\t\t\t\t\t\t\t// GS-1274: if we don't add the second check, Gantt stops working if\n\t\t\t\t\t\t\t// we add the task layer without the timeline and switch to a layout with the timeline\n\t\t\t\t\t\t\tif (rel && rel.parentNode == container)\n\t\t\t\t\t\t\t\tcontainer.insertBefore(node, rel);\n\t\t\t\t\t\t\telse\n\t\t\t\t\t\t\t\tcontainer.appendChild(node);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tthis.renderers[id] = renderFactory.getRenderer(\n\t\t\t\t\t\tid,\n\t\t\t\t\t\tlayer,\n\t\t\t\t\t\tnode\n\t\t\t\t\t);\n\n\t\t\t\t\tif (initLayer) {\n\t\t\t\t\t\tinitLayer(layer, gantt);\n\t\t\t\t\t}\n\n\t\t\t\t\tthis.tempCollection.splice(i, 1);\n\t\t\t\t\ti--;\n\t\t\t\t}\n\t\t\t},\n\t\t\taddLayer: function (config) {\n\t\t\t\tif(config){\n\t\t\t\t\tif(typeof config == \"function\"){\n\t\t\t\t\t\tconfig = {renderer: config};\n\t\t\t\t\t}\n\n\t\t\t\t\tif(config.filter === undefined){\n\t\t\t\t\t\tconfig.filter = mergeFilters(defaultFilters || []);\n\t\t\t\t\t}else if(config.filter instanceof Array){\n\t\t\t\t\t\tconfig.filter.push(defaultFilters);\n\t\t\t\t\t\tconfig.filter = mergeFilters(config.filter);\n\t\t\t\t\t}\n\n\t\t\t\t\tif(!config.container){\n\t\t\t\t\t\tconfig.container = document.createElement(\"div\");\n\t\t\t\t\t}\n\t\t\t\t\tvar self = this;\n\t\t\t\t\tconfig.requestUpdate = function(){\n\t\t\t\t\t\tif(gantt.config.smart_rendering && !isLegacyRender(gantt)){\n\t\t\t\t\t\t\tif(self.renderers[config.id]){\n\t\t\t\t\t\t\t\tself.onUpdateRequest(self.renderers[config.id]);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t\t\n\t\t\t\t\t};\n\t\t\t\t}\n\n\t\t\t\tthis._add(config);\n\t\t\t\treturn (config ? config.id : undefined);\n\t\t\t},\n\t\t\tonUpdateRequest: function(layer){\n\n\t\t\t},\n\n\t\t\teachLayer: function(code){\n\t\t\t\tfor (var i in this.renderers) {\n\t\t\t\t\tcode(this.renderers[i]);\n\t\t\t\t}\n\t\t\t},\n\t\t\tremoveLayer: function (id) {\n\t\t\t\tif(!this.renderers[id])\n\t\t\t\t\treturn;\n\t\t\t\tthis.renderers[id].destructor();\n\t\t\t\tdelete this.renderers[id];\n\t\t\t},\n\t\t\tclear: function () {\n\t\t\t\tfor (var i in this.renderers) {\n\t\t\t\t\tthis.renderers[i].destructor();\n\t\t\t\t}\n\t\t\t\tthis.renderers = {};\n\t\t\t}//,\n\t\t\t//prepareConfig: prepareConfig\n\t\t};\n\n\t\tgantt.attachEvent(\"onDestroy\", function(){\n\t\t\trenderGroup.clear();\n\t\t\trenderGroup = null;\n\t\t});\n\n\t\treturn renderGroup;\n\t}\n};};\n\n\nfunction mergeFilters(filter_methods){\n\tif(!(filter_methods instanceof Array)){\n\t\tfilter_methods = Array.prototype.slice.call(arguments, 0);\n\t}\n\n\treturn function(obj){\n\t\tvar res = true;\n\t\tfor(var i = 0, len = filter_methods.length; i < len; i++){\n\t\t\tvar filter_method = filter_methods[i];\n\t\t\tif(filter_method){\n\t\t\t\tres = res && (filter_method(obj.id, obj) !== false);\n\t\t\t}\n\t\t}\n\n\t\treturn res;\n\t};\n}\n\n\nexport default layerFactory;\n","export default function(item, view, config){\n\tif(!item.start_date || !item.end_date){\n\t\treturn null;\n\t}\n\tvar padding = 200;\n\tvar startCoord = view.posFromDate(item.start_date);\n\tvar endCoord = view.posFromDate(item.end_date);\n\tvar left = Math.min(startCoord, endCoord) - padding;\n\tvar right = Math.max(startCoord, endCoord) + padding;\n\treturn {\n\t\ttop: view.getItemTop(item.id),\n\t\theight: view.getItemHeight(item.id),\n\t\tleft: left,\n\t\twidth: right - left\n\t};\n};","import getLinkRectangle from \"../get_link_rectangle\";\n\nexport default function(){\n\tvar coordinates = [];\n\tvar calculated = false;\n\n\tfunction clearCache(){\n\t\tcoordinates = [];\n\t\tcalculated = false;\n\t}\n\n\tfunction buildCache(datastore, view, gantt){\n\t\tvar config = view.$getConfig();\n\t\tvar visibleItems = datastore.getVisibleItems();\n\t\t//datastore.eachItem(function(link){\n\t\tvisibleItems.forEach(function(link){\n\t\t\tvar rec = getLinkRectangle(link, view, config, gantt);\n\t\t\tif(!rec){\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tcoordinates.push({id: link.id, rec: rec});\n\t\t});\n\n\t\tcoordinates.sort(function(a, b){\n\t\t\tif(a.rec.right < b.rec.right){\n\t\t\t\treturn -1;\n\t\t\t}else {\n\t\t\t\treturn 1;\n\t\t\t}\n\t\t});\n\n\t\tcalculated = true;\n\t}\n\n\tvar initialized = false;\n\tfunction init(datastore){\n\t\tif(initialized){\n\t\t\treturn;\n\t\t}\n\t\tinitialized = true;\n\t\tdatastore.attachEvent(\"onPreFilter\", clearCache);\n\t\tdatastore.attachEvent(\"onStoreUpdated\", clearCache);\n\t\tdatastore.attachEvent(\"onClearAll\", clearCache);\n\t\tdatastore.attachEvent(\"onBeforeStoreUpdate\", clearCache);\n\t}\n\n\treturn function getVisibleLinksRange(gantt, view, config, datastore, viewport){\n\t\tinit(datastore);\n\t\tif(!calculated){\n\t\t\tbuildCache(datastore, view, gantt);\n\t\t}\n\n\t\tvar visibleBoxes = [];\n\t\tfor(var i = 0; i < coordinates.length; i++){\n\t\t\tvar item = coordinates[i];\n\t\t\tvar box = item.rec;\n\t\t\tif(box.right < viewport.x){\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t\tif(box.left < viewport.x_end && box.right > viewport.x && box.top < viewport.y_end && box.bottom > viewport.y){\n\t\t\t\tvisibleBoxes.push(item.id);\n\t\t\t}\n\t\t}\n\t\t\n\t\treturn {\n\t\t\tids: visibleBoxes\n\t\t};\n\t};\n};","\n\nimport barRectangle from \"./get_bar_rectangle\";\n\nexport default function getLinkBox(item, view, config, gantt){\n\tif(!gantt.isTaskExists(item.source)){\n\t\treturn null;\n\t}\n\n\tif(!gantt.isTaskExists(item.target)){\n\t\treturn null;\n\t}\n\tvar sourceBox = barRectangle(gantt.getTask(item.source), view, gantt);\n\tvar targetBox = barRectangle(gantt.getTask(item.target), view, gantt);\n\n\tif(!sourceBox || !targetBox){\n\t\treturn null;\n\t}\n\n\tvar padding = 100;\n\tvar left = Math.min(sourceBox.left, targetBox.left) - padding;\n\tvar right = Math.max(sourceBox.left + sourceBox.width, targetBox.left + targetBox.width) + padding;\n\tvar top = Math.min(sourceBox.top, targetBox.top) - padding;\n\tvar bottom = Math.max(sourceBox.top + sourceBox.height, targetBox.top + targetBox.height) + padding;\n\n\treturn {\n\t\ttop: top,\n\t\theight: bottom - top,\n\t\tbottom,\n\t\tleft: left,\n\t\twidth: right - left,\n\t\tright\n\t};\n};\n","\n// optimized checker for links smart rendering\n\n// first check the vertical position since it's easier to calculate\n\nexport default function isLinkInViewPort(item, viewport, view, config, gantt){\n\tvar source = view.$gantt.getTask(item.source);\n\tvar target = view.$gantt.getTask(item.target);\n\t// check vertical visibility first since it's a lighter check\n\tvar sourceTop = view.getItemTop(source.id);\n\tvar sourceHeight = view.getItemHeight(source.id);\n\n\tvar targetTop = view.getItemTop(target.id);\n\tvar targetHeight = view.getItemHeight(target.id);\n\n\tif(viewport.y > sourceTop + sourceHeight &&\n\t\tviewport.y > targetTop + targetHeight){\n\t\treturn false;\n\t}\n\n\tif(viewport.y_end < targetTop &&\n\t\tviewport.y_end < sourceTop){\n\t\treturn false;\n\t}\n\n\tvar padding = 100;\n\tvar sourceLeft = view.posFromDate(source.start_date);\n\tvar sourceRight = view.posFromDate(source.end_date);\n\tvar targetLeft = view.posFromDate(target.start_date);\n\tvar targetRight = view.posFromDate(target.end_date);\n\n\tif(sourceLeft > sourceRight){\n\t\t// rtl\n\t\tvar tmp = sourceRight;\n\t\tsourceRight = sourceLeft;\n\t\tsourceLeft = tmp;\n\t}\n\tif(targetLeft > targetRight){\n\t\t// rtl\n\t\tvar tmp = targetRight;\n\t\ttargetRight = targetLeft;\n\t\ttargetLeft = tmp;\n\t}\n\tsourceLeft += -padding; // add buffer for custom elements\n\tsourceRight += padding;\n\ttargetLeft += -padding; // add buffer for custom elements\n\ttargetRight += padding;\n\n\tif(viewport.x > sourceRight &&\n\t\tviewport.x > targetRight){\n\t\treturn false;\n\t}\n\n\tif(viewport.x_end < sourceLeft &&\n\t\tviewport.x_end < targetLeft){\n\t\treturn false;\n\t}\n\treturn true;\n};\n","import createLayerFactory from \"./render/layer_engine\";\n\nimport getVisibleTaskRange from \"./render/viewport/get_visible_bars_range\";\nimport getVisibleLinksRangeFactory from \"./render/viewport/factory/get_visible_link_range\";\n\nimport isLinkInViewport from \"./render/viewport/is_link_in_viewport\";\n\nfunction initLayer(layer, gantt){\n\tif(!layer.view){\n\t\treturn;\n\t}\n\n\tvar view = layer.view;\n\tif(typeof view === \"string\"){\n\t\tview = gantt.$ui.getView(view);\n\t}\n\n\tif(view && view.attachEvent){\n\t\tview.attachEvent(\"onScroll\", function(){\n\t\t\tvar state = gantt.$services.getService(\"state\");\n\t\t\t// don't repaint if we're inside batchUpdate, a complete repaint will be called afterwards\n\t\t\tif(!state.getState(\"batchUpdate\").batch_update && !view.$config.$skipSmartRenderOnScroll){\n\t\t\t\tif(layer.requestUpdate){\n\t\t\t\t\tlayer.requestUpdate();\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t}\n}\n\nvar createLayerEngine = function(gantt){\n\tvar factory = createLayerFactory(gantt);\n\treturn {\n\t\tgetDataRender: function(name){\n\t\t\treturn gantt.$services.getService(\"layer:\" + name) || null;\n\t\t},\n\t\tcreateDataRender: function(config){\n\t\t\tvar name = config.name,\n\t\t\t\tdefaultContainer = config.defaultContainer,\n\t\t\t\tpreviusSiblingContainer = config.defaultContainerSibling;\n\n\t\t\tvar layers = factory.createGroup(\n\t\t\t\tdefaultContainer,\n\t\t\t\tpreviusSiblingContainer,\n\t\t\t\tfunction(itemId, item){\n\t\t\t\t\tif(layers.filters){\n\t\t\t\t\t\tfor(var i = 0; i < layers.filters.length; i++){\n\t\t\t\t\t\t\tif(layers.filters[i](itemId, item) === false){\n\t\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}else{\n\t\t\t\t\t\treturn true;\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tinitLayer\n\t\t\t);\n\n\t\t\tgantt.$services.setService(\"layer:\" + name, function(){\n\t\t\t\treturn layers;\n\t\t\t});\n\n\t\t\tgantt.attachEvent(\"onGanttReady\", function () {\n\t\t\t\tlayers.addLayer();// init layers on start\n\t\t\t});\n\n\t\t\treturn layers;\n\t\t},\n\t\tinit: function(){\n\t\t\tvar taskLayers = this.createDataRender({\n\t\t\t\tname: \"task\",\n\t\t\t\tdefaultContainer: function(){\n\t\t\t\t\tif(gantt.$task_data){\n\t\t\t\t\t\treturn gantt.$task_data;\n\t\t\t\t\t}else if(gantt.$ui.getView(\"timeline\")){\n\t\t\t\t\t\treturn gantt.$ui.getView(\"timeline\").$task_data;\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tdefaultContainerSibling: function(){\n\t\t\t\t\tif(gantt.$task_links){\n\t\t\t\t\t\treturn gantt.$task_links;\n\t\t\t\t\t}else if(gantt.$ui.getView(\"timeline\")){\n\t\t\t\t\t\treturn gantt.$ui.getView(\"timeline\").$task_links;\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tfilter: function(item){\n\n\t\t\t\t}\n\t\t\t}, gantt);\n\n\t\t\tvar linkLayers = this.createDataRender({\n\t\t\t\tname: \"link\",\n\t\t\t\tdefaultContainer: function(){\n\t\t\t\t\tif(gantt.$task_data){\n\t\t\t\t\t\treturn gantt.$task_data;\n\t\t\t\t\t}else if(gantt.$ui.getView(\"timeline\")){\n\t\t\t\t\t\treturn gantt.$ui.getView(\"timeline\").$task_data;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}, gantt);\n\n\t\t\treturn {\n\t\t\t\taddTaskLayer: function(config){\n\t\t\t\t\tconst rangeFunction = getVisibleTaskRange;\n\t\t\t\t\tif(typeof config === \"function\"){\n\t\t\t\t\t\tconfig = {\n\t\t\t\t\t\t\trenderer: {\n\t\t\t\t\t\t\t\trender: config,\n\t\t\t\t\t\t\t\tgetVisibleRange: rangeFunction\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t};\n\t\t\t\t\t}else{\n\t\t\t\t\t\tif(config.renderer && !config.renderer.getVisibleRange){\n\t\t\t\t\t\t\tconfig.renderer.getVisibleRange = rangeFunction;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tconfig.view = \"timeline\";\n\n\t\t\t\t\treturn taskLayers.addLayer(config);\n\t\t\t\t},\n\n\t\t\t\t_getTaskLayers: function(){\n\t\t\t\t\treturn taskLayers.getLayers();\n\t\t\t\t},\n\t\t\t\tremoveTaskLayer: function(id){\n\t\t\t\t\ttaskLayers.removeLayer(id);\n\t\t\t\t},\n\n\t\t\t\t_clearTaskLayers: function(){\n\t\t\t\t\ttaskLayers.clear();\n\t\t\t\t},\n\t\t\t\taddLinkLayer: function(config){\n\t\t\t\t\tconst rangeFunction = getVisibleLinksRangeFactory();\n\t\t\t\t\tif(typeof config === \"function\"){\n\t\t\t\t\t\tconfig = {\n\t\t\t\t\t\t\trenderer: {\n\t\t\t\t\t\t\t\trender: config,\n\t\t\t\t\t\t\t\tgetVisibleRange: rangeFunction\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t};\n\t\t\t\t\t}else{\n\t\t\t\t\t\tif(config.renderer && !config.renderer.getVisibleRange){\n\t\t\t\t\t\t\tconfig.renderer.getVisibleRange = rangeFunction;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tconfig.view = \"timeline\";\n\t\t\t\t\tif(config && config.renderer){\n\t\t\t\t\t\tif(!config.renderer.getRectangle && !config.renderer.isInViewPort){\n\t\t\t\t\t\t\tconfig.renderer.isInViewPort = isLinkInViewport;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\treturn linkLayers.addLayer(config);\n\t\t\t\t},\n\n\t\t\t\t_getLinkLayers: function(){\n\t\t\t\t\treturn linkLayers.getLayers();\n\t\t\t\t},\n\t\t\t\tremoveLinkLayer: function(id){\n\t\t\t\t\tlinkLayers.removeLayer(id);\n\t\t\t\t},\n\n\t\t\t\t_clearLinkLayers: function(){\n\t\t\t\t\tlinkLayers.clear();\n\t\t\t\t}\n\t\t\t};\n\t\t}\n\t};\n};\n\nexport default createLayerEngine;","import * as utils from \"../../../utils/utils\";\nimport eventable from \"../../../utils/eventable\";\nimport * as domHelpers from \"../utils/dom_helpers\";\n\nvar Cell = (function () {\n\t\"use strict\";\n\n\tfunction Cell(parent, config, factory, gantt) {\n\t\tif (parent) {\n\t\t\tthis.$container = domHelpers.toNode(parent);\n\t\t\tthis.$parent = parent;\n\t\t}\n\t\t// save config\n\t\tthis.$config = utils.mixin(config, {\n\t\t\theaderHeight: 33\n\t\t});\n\t\tthis.$gantt = gantt;\n\t\tthis.$domEvents = gantt._createDomEventScope();\n\t\t// set id\n\t\tthis.$id = config.id || \"c\" + utils.uid();\n\n\t\tthis.$name = \"cell\";\n\t\tthis.$factory = factory;\n\n\t\teventable(this);\n\n\t}\n\n\tCell.prototype.destructor = function () {\n\t\tthis.$parent = this.$container = this.$view = null;\n\t\tvar mouse = this.$gantt.$services.getService(\"mouseEvents\");\n\t\tmouse.detach(\"click\", \"gantt_header_arrow\", this._headerClickHandler);\n\t\tthis.$domEvents.detachAll();\n\t\tthis.callEvent(\"onDestroy\", []);\n\t\tthis.detachAllEvents();\n\t};\n\tCell.prototype.cell = function (id) {\n\t\treturn null;\n\t};\n\n\tCell.prototype.scrollTo = function(left, top){\n\n\t\t//GS-333 Add a way to scroll the HTML views:\n\t\tvar cell = this.$view;\n\t\tif (this.$config.html) cell = this.$view.firstChild;\n\n\t\tif (left*1 == left){\n\t\t\tcell.scrollLeft = left;\n\t\t}\n\t\tif(top*1 == top){\n\t\t\tcell.scrollTop = top;\n\t\t}\n\t};\n\n\tCell.prototype.clear = function(){\n\t\tthis.getNode().innerHTML = \"\";\n\t\tthis.getNode().className = \"gantt_layout_content\";\n\t\tthis.getNode().style.padding = \"0\";\n\t};\n\n\tCell.prototype.resize = function (final) {\n\t\tif (this.$parent) {\n\t\t\treturn this.$parent.resize(final);\n\t\t}\n\n\t\tif(final === false){\n\t\t\tthis.$preResize = true;\n\t\t}\n\n\t\tvar topCont = this.$container;\n\t\tvar x = topCont.offsetWidth;\n\t\tvar y = topCont.offsetHeight;\n\t\tvar topSize = this.getSize();\n\t\tif (topCont === document.body) {\n\t\t\tx = document.body.offsetWidth;\n\t\t\ty = document.body.offsetHeight;\n\t\t}\n\t\tif (x < topSize.minWidth) {\n\t\t\tx = topSize.minWidth;\n\t\t}\n\t\tif (x > topSize.maxWidth) {\n\t\t\tx = topSize.maxWidth;\n\t\t}\n\t\tif (y < topSize.minHeight) {\n\t\t\ty = topSize.minHeight;\n\t\t}\n\t\tif (y > topSize.maxHeight) {\n\t\t\ty = topSize.maxHeight;\n\t\t}\n\t\tthis.setSize(x, y);\n\n\t\tif(!this.$preResize){\n\t\t//\tself.callEvent(\"onResize\", [x, y]);\n\t\t}\n\t\tthis.$preResize = false;\n\t};\n\n\tCell.prototype.hide = function () {\n\t\tthis._hide(true);\n\t\tthis.resize();\n\t};\n\tCell.prototype.show = function (force) {\n\t\tthis._hide(false);\n\t\tif (force && this.$parent) {\n\t\t\tthis.$parent.show();\n\t\t}\n\t\tthis.resize();\n\t};\n\tCell.prototype._hide = function (mode) {\n\t\tif (mode === true && this.$view.parentNode) {\n\t\t\tthis.$view.parentNode.removeChild(this.$view);\n\t\t}\n\t\telse if (mode === false && !this.$view.parentNode) {\n\t\t\tvar index = this.$parent.cellIndex(this.$id);\n\t\t\tthis.$parent.moveView(this, index);\n\t\t}\n\t\tthis.$config.hidden = mode;\n\t};\n\tCell.prototype.$toHTML = function (content, css) {\n\t\tif (content === void 0) { content = \"\"; }\n\t\tcss = [(css || \"\"), (this.$config.css || \"\")].join(\" \");\n\t\tvar obj = this.$config;\n\t\tvar header = \"\";\n\t\tif (obj.raw) {\n\t\t\tcontent = typeof obj.raw === \"string\" ? obj.raw : \"\";\n\t\t}\n\t\telse {\n\t\t\tif (!content) {\n\t\t\t\tcontent = \"<div class='gantt_layout_content' \"+(css ? \" class='\"+css+\"' \" : \"\")+\" >\" + (obj.html || \"\") + \"</div>\";\n\t\t\t}\n\t\t\tif (obj.header) {\n\t\t\t\tvar collapseIcon = obj.canCollapse ? \"<div class='gantt_layout_header_arrow'></div>\" : \"\";\n\t\t\t\theader = \"<div class='gantt_layout_header'>\" + collapseIcon + \"<div class='gantt_layout_header_content'>\" + obj.header + \"</div></div>\";\n\t\t\t}\n\t\t}\n\t\treturn \"<div class='gantt_layout_cell \" + css + \"' data-cell-id='\" + this.$id + \"'>\" + header + content + \"</div>\";\n\t};\n\tCell.prototype.$fill = function (node, parent) {\n\t\tthis.$view = node;\n\t\tthis.$parent = parent;\n\t\tthis.init();\n\t};\n\tCell.prototype.getNode = function () {\n\t\treturn (this.$view.querySelector(\"gantt_layout_cell\") || this.$view);\n\t};\n\tCell.prototype.init = function () {\n\t\t// [NOT-GOOD] code is executed for each component, while it still has only one handler, it is no good\n\n\t\tvar self = this;\n\n\t\tthis._headerClickHandler = function(e){\n\t\t\tvar cellId = domHelpers.locateAttribute(e, \"data-cell-id\");\n\t\t\tif(cellId == self.$id){\n\t\t\t\tself.toggle();\n\t\t\t}\n\t\t};\n\n\t\tvar mouse = this.$gantt.$services.getService(\"mouseEvents\");\n\t\tmouse.delegate(\"click\", \"gantt_header_arrow\", this._headerClickHandler);\n\n\t\tthis.callEvent(\"onReady\", []);\n\t};\n\tCell.prototype.toggle = function () {\n\t\tthis.$config.collapsed = !this.$config.collapsed;\n\t\tthis.resize();\n\t};\n\tCell.prototype.getSize = function () {\n\t\tvar size = {\n\t\t\theight: this.$config.height || 0,\n\t\t\twidth: this.$config.width || 0,\n\t\t\tgravity: this.$config.gravity || 1,\n\t\t\tminHeight: this.$config.minHeight || 0,\n\t\t\tminWidth: this.$config.minWidth || 0,\n\t\t\tmaxHeight: this.$config.maxHeight || 100000000000,\n\t\t\tmaxWidth: this.$config.maxWidth || 100000000000\n\t\t};\n\t\tif (this.$config.collapsed) {\n\t\t\tvar mode = this.$config.mode === \"x\";\n\t\t\tsize[mode ? \"width\" : \"height\"] = size[mode ? \"maxWidth\" : \"maxHeight\"] = this.$config.headerHeight;\n\t\t}\n\t\treturn size;\n\t};\n\n\tCell.prototype.getContentSize = function(){\n\n\t\tvar width = this.$lastSize.contentX;\n\t\tif(width !== width*1){\n\t\t\twidth = this.$lastSize.width;\n\t\t}\n\n\t\tvar height = this.$lastSize.contentY;\n\t\tif(height !== height*1){\n\t\t\theight = this.$lastSize.height;\n\t\t}\n\n\t\treturn {\n\t\t\twidth: width,\n\t\t\theight: height\n\t\t};\n\t};\n\n\tCell.prototype._getBorderSizes = function(){\n\t\tvar borders = {\n\t\t\ttop: 0,\n\t\t\tright: 0,\n\t\t\tbottom: 0,\n\t\t\tleft: 0,\n\t\t\thorizontal: 0,\n\t\t\tvertical: 0\n\t\t};\n\t\tif(this._currentBorders){\n\t\t\tif(this._currentBorders[this._borders.left]){\n\t\t\t\tborders.left = 1;\n\t\t\t\tborders.horizontal++;\n\t\t\t}\n\n\t\t\tif(this._currentBorders[this._borders.right]){\n\t\t\t\tborders.right = 1;\n\t\t\t\tborders.horizontal++;\n\t\t\t}\n\n\t\t\tif(this._currentBorders[this._borders.top]){\n\t\t\t\tborders.top = 1;\n\t\t\t\tborders.vertical++;\n\t\t\t}\n\n\t\t\tif(this._currentBorders[this._borders.bottom]){\n\t\t\t\tborders.bottom = 1;\n\t\t\t\tborders.vertical++;\n\t\t\t}\n\t\t}\n\n\t\treturn borders;\n\n\t};\n\n\tCell.prototype.setSize = function (x, y) {\n\t\tthis.$view.style.width = x + \"px\";\n\t\tthis.$view.style.height = y + \"px\";\n\n\t\tvar borders = this._getBorderSizes();\n\t\tvar contentY = y - borders.vertical;\n\t\tvar contentX = x - borders.horizontal;\n\n\t\tthis.$lastSize = { x: x, y: y, contentX: contentX, contentY: contentY };\n\t\tif (this.$config.header) {\n\t\t\tthis._sizeHeader();\n\t\t}else{\n\t\t\tthis._sizeContent();\n\t\t}\n\t};\n\n\tCell.prototype._borders = {\n\t\t\"left\":\"gantt_layout_cell_border_left\",\n\t\t\"right\":\"gantt_layout_cell_border_right\",\n\t\t\"top\":\"gantt_layout_cell_border_top\",\n\t\t\"bottom\":\"gantt_layout_cell_border_bottom\"\n\t};\n\n\tCell.prototype._setBorders = function(css, view){\n\t\tif(!view) {\n\t\t\tview = this;\n\t\t}\n\t\tvar node = view.$view;\n\n\t\tfor( var i in this._borders){\n\t\t\tdomHelpers.removeClassName(node, this._borders[i]);\n\t\t}\n\n\t\tif(typeof css == \"string\"){\n\t\t\tcss = [css];\n\t\t}\n\n\t\tvar cssHash = {};\n\n\t\tfor(var i = 0; i < css.length; i++){\n\t\t\tdomHelpers.addClassName(node, css[i]);\n\t\t\tcssHash[css[i]] = true;\n\t\t}\n\n\t\tview._currentBorders = cssHash;\n\t};\n\n\n\tCell.prototype._sizeContent = function(){\n\t\tvar content = this.$view.childNodes[0];\n\t\tif(content && content.className == \"gantt_layout_content\"){\n\t\t\tcontent.style.height = this.$lastSize.contentY + \"px\";\n\t\t}\n\t};\n\n\tCell.prototype._sizeHeader = function () {\n\t\tvar size = this.$lastSize;\n\t\tsize.contentY -= this.$config.headerHeight;\n\t\tvar header = this.$view.childNodes[0];\n\t\tvar content = this.$view.childNodes[1];\n\t\tvar xLayout = this.$config.mode === \"x\";\n\t\tif (this.$config.collapsed) {\n\t\t\tcontent.style.display = \"none\";\n\t\t\tif (xLayout) {\n\t\t\t\theader.className = \"gantt_layout_header collapsed_x\";\n\t\t\t\theader.style.width = size.y + \"px\";\n\t\t\t\tvar d = Math.floor(size.y / 2 - size.x / 2);\n\t\t\t\theader.style.transform = \"rotate(90deg) translate(\" + d + \"px, \" + d + \"px)\";\n\t\t\t\tcontent.style.display = \"none\";\n\t\t\t}\n\t\t\telse {\n\t\t\t\theader.className = \"gantt_layout_header collapsed_y\";\n\t\t\t}\n\t\t}\n\t\telse {\n\t\t\tif (xLayout) {\n\t\t\t\theader.className = \"gantt_layout_header\";\n\t\t\t}\n\t\t\telse {\n\t\t\t\theader.className = \"gantt_layout_header vertical\";\n\t\t\t}\n\t\t\theader.style.width = 'auto';\n\t\t\theader.style.transform = '';\n\t\t\tcontent.style.display = \"\";\n\t\t\tcontent.style.height = size.contentY + \"px\";\n\t\t}\n\t\theader.style.height = this.$config.headerHeight + \"px\";\n\t};\n\treturn Cell;\n}());\n\nexport default Cell;\n","export default function (d, b) {\n\tfor (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];\n\tfunction __() { this.constructor = d; }\n\td.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n};","import __extends from \"../../../utils/extends\";\nimport * as domHelpers from \"../utils/dom_helpers\";\nimport Cell from \"./cell\";\n\nvar Layout = (function (_super) {\n\t\"use strict\";\n\n\t__extends(Layout, _super);\n\tfunction Layout(parent, config, factory) {\n\t\tvar _this = _super.apply(this, arguments) || this;\n\n\t\tif(parent)\n\t\t\t_this.$root = true;\n\n\t\t_this._parseConfig(config);\n\t\t_this.$name = \"layout\";\n\t\treturn _this;\n\t}\n\n\tLayout.prototype.destructor = function () {\n\t\tif (this.$container && this.$view) {\n\t\t\tdomHelpers.removeNode(this.$view);\n\t\t}\n\n\t\tfor (var i = 0; i < this.$cells.length; i++) {\n\t\t\tvar child = this.$cells[i];\n\t\t\tchild.destructor();\n\t\t}\n\t\tthis.$cells = [];\n\n\t\t_super.prototype.destructor.call(this);\n\t};\n\n\tLayout.prototype._resizeScrollbars = function(autosize, scrollbars){\n\t\tvar scrollChanged = false;\n\t\tvar visibleScrollbars = [],\n\t\t\thiddenScrollbars = [];\n\n\t\tconst scrollbarsToHide = [];\n\n\t\tfunction showScrollbar(scrollbar){\n\t\t\tscrollbar.$parent.show();\n\t\t\tscrollChanged = true;\n\t\t\tvisibleScrollbars.push(scrollbar);\n\t\t}\n\t\tfunction hideScrollbar(scrollbar){\n\t\t\tscrollbar.$parent.hide();\n\t\t\tscrollChanged = true;\n\t\t\thiddenScrollbars.push(scrollbar);\n\t\t}\n\n\t\tvar scrollbar;\n\t\tfor(var i = 0; i < scrollbars.length; i++){\n\t\t\tscrollbar = scrollbars[i];\n\n\t\t\tif(autosize[scrollbar.$config.scroll]) {\n\t\t\t\thideScrollbar(scrollbar);\n\t\t\t}else if(scrollbar.shouldHide()){\n\t\t\t\t//hideScrollbar(scrollbar);\n\t\t\t\tscrollbarsToHide.push(scrollbar);\n\t\t\t}else if(scrollbar.shouldShow()){\n\t\t\t\tshowScrollbar(scrollbar);\n\t\t\t}else{\n\t\t\t\tif(scrollbar.isVisible()){\n\t\t\t\t\tvisibleScrollbars.push(scrollbar);\n\t\t\t\t}else{\n\t\t\t\t\thiddenScrollbars.push(scrollbar);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tvar visibleGroups = {};\n\t\tfor(var i = 0; i < visibleScrollbars.length; i++){\n\t\t\tif(visibleScrollbars[i].$config.group){\n\t\t\t\tvisibleGroups[visibleScrollbars[i].$config.group] = true;\n\t\t\t}\n\t\t}\n\n\t\t// GS-2220\n\t\tscrollbarsToHide.forEach(function(scrollbar){\n\t\t\tif(!(scrollbar.$config.group && visibleGroups[scrollbar.$config.group])){\n\t\t\t\thideScrollbar(scrollbar);\n\t\t\t}\n\t\t});\n\n\t\tfor(var i = 0; i < hiddenScrollbars.length; i++){\n\t\t\tscrollbar = hiddenScrollbars[i];\n\n\t\t\tif(scrollbar.$config.group && visibleGroups[scrollbar.$config.group]){\n\t\t\t\tshowScrollbar(scrollbar);\n\t\t\t\t// GS-707 If the scrollbar was hidden then showed, the container resize shouldn't happen because of that\n\t\t\t\tfor(var j = 0; j < visibleScrollbars.length; j++){\n\t\t\t\t\tif(visibleScrollbars[j] == scrollbar){\n\t\t\t\t\t\tthis.$gantt.$scrollbarRepaint = true;\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\treturn scrollChanged;\n\t};\n\n\tLayout.prototype._syncCellSizes = function(groupName, newSize){\n\t\tif(!groupName)\n\t\t\treturn;\n\n\t\tvar groups = {};\n\n\t\tthis._eachChild(function(cell){\n\t\t\tif(cell.$config.group && cell.$name != \"scrollbar\" && cell.$name != \"resizer\"){\n\t\t\t\tif(!groups[cell.$config.group]){\n\t\t\t\t\tgroups[cell.$config.group] = [];\n\t\t\t\t}\n\t\t\t\tgroups[cell.$config.group].push(cell);\n\t\t\t}\n\t\t});\n\n\t\tif(groups[groupName]){\n\t\t\tthis._syncGroupSize(groups[groupName], newSize);\n\t\t}\n\t\treturn groups[groupName];\n\t};\n\n\tLayout.prototype._syncGroupSize = function(cells, newSize){\n\t\tif(!cells.length) return;\n\n\t\tvar property = cells[0].$parent._xLayout ? \"width\" : \"height\";\n\t\tvar direction = cells[0].$parent.getNextSibling(cells[0].$id) ? 1 : -1;\n\n\t\tvar newSizeValue = newSize.value;\n\t\tvar isGravity = newSize.isGravity;\n\t\tfor(var i = 0; i < cells.length; i++){\n\t\t\tvar ownSize = cells[i].getSize();\n\n\t\t\tvar resizeSibling = direction > 0 ? cells[i].$parent.getNextSibling(cells[i].$id) : cells[i].$parent.getPrevSibling(cells[i].$id);\n\t\t\tif(resizeSibling.$name == \"resizer\"){\n\t\t\t\tresizeSibling = direction > 0 ? resizeSibling.$parent.getNextSibling(resizeSibling.$id) : resizeSibling.$parent.getPrevSibling(resizeSibling.$id);\n\t\t\t}\n\t\t\tvar siblingSize = resizeSibling.getSize();\n\n\t\t\tif(!isGravity) {\n\t\t\t\tif(resizeSibling[property]){\n\t\t\t\t\tvar totalGravity = ownSize.gravity + siblingSize.gravity;\n\t\t\t\t\tvar totalSize = ownSize[property] + siblingSize[property];\n\t\t\t\t\tvar k = totalGravity / totalSize;\n\t\t\t\t\tcells[i].$config.gravity = k * newSizeValue;\n\n\t\t\t\t\tresizeSibling.$config[property] = totalSize - newSizeValue;\n\t\t\t\t\tresizeSibling.$config.gravity = totalGravity - k * newSizeValue;\n\t\t\t\t}else{\n\t\t\t\t\tcells[i].$config[property] = newSizeValue;\n\t\t\t\t}\n\t\t\t}else{\n\t\t\t\tcells[i].$config.gravity = newSizeValue;\n\t\t\t}\n\n\t\t\tvar mainGrid = this.$gantt.$ui.getView(\"grid\");\n\t\t\tif(mainGrid && cells[i].$content === mainGrid && !mainGrid.$config.scrollable && !isGravity){\n\t\t\t\tthis.$gantt.config.grid_width = newSizeValue;\n\t\t\t}\n\t\t}\n\t};\n\n\tLayout.prototype.resize = function(startStage){\n\t\tvar mainCall = false;\n\t\tif(this.$root && !this._resizeInProgress){\n\t\t\tthis.callEvent(\"onBeforeResize\", []);\n\t\t\tmainCall = true;\n\t\t\tthis._resizeInProgress = true;\n\t\t}\n\n\t\t_super.prototype.resize.call(this, true);\n\t\t_super.prototype.resize.call(this, false);\n\n\t\tif(mainCall){\n\n\t\t\tvar contentViews = [];\n\t\t\tcontentViews = contentViews.concat(this.getCellsByType(\"viewCell\"));\n\t\t\tcontentViews = contentViews.concat(this.getCellsByType(\"viewLayout\"));\n\t\t\tcontentViews = contentViews.concat(this.getCellsByType(\"hostCell\"));\n\n\t\t\tvar scrollbars = this.getCellsByType(\"scroller\");\n\n\t\t\tfor(var i = 0; i < contentViews.length; i++){\n\t\t\t\tif(!contentViews[i].$config.hidden)\n\t\t\t\t\tcontentViews[i].setContentSize();\n\t\t\t}\n\n\t\t\tvar autosize = this._getAutosizeMode(this.$config.autosize);\n\n\t/* // possible to rollback set content size when autisize is disabled, not sure if need to\n\t\t\tcontentViews.forEach(function(view){\n\t\t\t\tconst parent = view.$parent;\n\t\t\t\tif(!autosize.x){\n\t\t\t\t\tif(parent.$config.$originalWidthStored){\n\t\t\t\t\t\tparent.$config.$originalWidthStored = false;\n\t\t\t\t\t\tparent.$config.width = parent.$config.$originalWidth;\n\t\t\t\t\t\tparent.$config.$originalWidth = undefined;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tif(!autosize.y){\n\t\t\t\t\tif(parent.$config.$originalHeightStored){\n\t\t\t\t\t\tparent.$config.$originalHeightStored = false;\n\t\t\t\t\t\tparent.$config.height = parent.$config.$originalHeight;\n\t\t\t\t\t\tparent.$config.$originalHeight = undefined;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});*/\n\t\t\t\n\t\t\tvar scrollChanged = this._resizeScrollbars(autosize, scrollbars);\n\n\t\t\tif(this.$config.autosize){\n\t\t\t\tthis.autosize(this.$config.autosize);\n\t\t\t\tcontentViews.forEach(function(view){\n\t\t\t\t\tconst parent = view.$parent;\n\t\t\t\t\tconst sizes = parent.getContentSize(autosize);\n\t\t\t\t\tif(autosize.x){\n\t\t\t\t\t\tif(!parent.$config.$originalWidthStored){\n\t\t\t\t\t\t\tparent.$config.$originalWidthStored = true;\n\t\t\t\t\t\t\tparent.$config.$originalWidth = parent.$config.width;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tparent.$config.width = sizes.width;\n\t\t\t\t\t}\n\t\t\t\t\tif(autosize.y){\n\t\t\t\t\t\tif(!parent.$config.$originalHeightStored){\n\t\t\t\t\t\t\tparent.$config.$originalHeightStored = true;\n\t\t\t\t\t\t\tparent.$config.$originalHeight = parent.$config.height;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tparent.$config.height = sizes.height;\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t\tscrollChanged = true;\n\t\t\t}\n\n\t\t\tif(scrollChanged){\n\t\t\t\tthis.resize();\n\t\t\t\tfor(var i = 0; i < contentViews.length; i++){\n\t\t\t\t\tif(!contentViews[i].$config.hidden)\n\t\t\t\t\t\tcontentViews[i].setContentSize();\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tthis.callEvent(\"onResize\", []);\n\t\t}\n\t\tif(mainCall){\n\t\t\tthis._resizeInProgress = false;\n\t\t}\n\t};\n\n\tLayout.prototype._eachChild = function(code, cell){\n\t\tcell = cell || this;\n\t\tcode(cell);\n\t\tif(cell.$cells){\n\t\t\tfor(var i = 0; i < cell.$cells.length; i++){\n\t\t\t\tthis._eachChild(code, cell.$cells[i]);\n\t\t\t}\n\t\t}\n\t};\n\n\tLayout.prototype.isChild = function(view){\n\t\tvar res = false;\n\t\tthis._eachChild(function(child){\n\t\t\tif(child === view || child.$content === view){\n\t\t\t\tres = true;\n\t\t\t}\n\t\t});\n\t\treturn res;\n\t};\n\n\tLayout.prototype.getCellsByType = function(type){\n\t\tvar res = [];\n\t\tif(type === this.$name){\n\t\t\tres.push(this);\n\t\t}\n\n\t\tif(this.$content && this.$content.$name == type){\n\t\t\tres.push(this.$content);\n\t\t}\n\n\t\tif(this.$cells){\n\t\t\tfor(var i = 0; i < this.$cells.length; i++){\n\t\t\t\tvar children = Layout.prototype.getCellsByType.call(this.$cells[i], type);\n\t\t\t\tif(children.length){\n\t\t\t\t\tres.push.apply(res, children);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\treturn res;\n\t};\n\n\tLayout.prototype.getNextSibling = function(cellId){\n\t\tvar index = this.cellIndex(cellId);\n\t\tif(index >= 0 && this.$cells[index + 1]){\n\t\t\treturn this.$cells[index + 1];\n\t\t}else{\n\t\t\treturn null;\n\t\t}\n\t};\n\n\tLayout.prototype.getPrevSibling = function(cellId){\n\t\tvar index = this.cellIndex(cellId);\n\t\tif(index >= 0 && this.$cells[index - 1]){\n\t\t\treturn this.$cells[index - 1];\n\t\t}else{\n\t\t\treturn null;\n\t\t}\n\t};\n\n\n\tLayout.prototype.cell = function (id) {\n\t\tfor (var i = 0; i < this.$cells.length; i++) {\n\t\t\tvar child = this.$cells[i];\n\t\t\tif (child.$id === id) {\n\t\t\t\treturn child;\n\t\t\t}\n\t\t\tvar sub = child.cell(id);\n\t\t\tif (sub) {\n\t\t\t\treturn sub;\n\t\t\t}\n\t\t}\n\t};\n\tLayout.prototype.cellIndex = function (id) {\n\t\tfor (var i = 0; i < this.$cells.length; i++) {\n\t\t\tif (this.$cells[i].$id === id) {\n\t\t\t\treturn i;\n\t\t\t}\n\t\t}\n\t\treturn -1;\n\t};\n\tLayout.prototype.moveView = function (view, ind) {\n\t\tif (this.$cells[ind] !== view) {\n\t\t\treturn window.alert(\"Not implemented\");\n\t\t}\n\t\telse {\n\t\t\tind += this.$config.header ? 1 : 0;\n\t\t\tvar node = this.$view;\n\t\t\tif (ind >= node.childNodes.length) {\n\t\t\t\tnode.appendChild(view.$view);\n\t\t\t}\n\t\t\telse {\n\t\t\t\tnode.insertBefore(view.$view, node.childNodes[ind]);\n\t\t\t}\n\t\t}\n\t};\n\tLayout.prototype._parseConfig = function (config) {\n\t\tthis.$cells = [];\n\t\tthis._xLayout = !config.rows;\n\t\tvar cells = config.rows || config.cols || config.views;\n\t\tfor (var i = 0; i < cells.length; i++) {\n\t\t\tvar cell = cells[i];\n\t\t\tcell.mode = this._xLayout ? \"x\" : \"y\";\n\t\t\tvar $content = this.$factory.initUI(cell, this);\n\t\t\tif(!$content){\n\t\t\t\tcells.splice(i, 1);\n\t\t\t\ti--;\n\t\t\t}else{\n\t\t\t\t$content.$parent = this;\n\t\t\t\tthis.$cells.push($content);\n\t\t\t}\n\t\t}\n\t};\n\tLayout.prototype.getCells = function () {\n\t\treturn this.$cells;\n\t};\n\tLayout.prototype.render = function () {\n\t\tvar view = domHelpers.insertNode(this.$container, this.$toHTML());\n\t\tthis.$fill(view, null);\n\t\tthis.callEvent(\"onReady\", []);\n\t\tthis.resize();\n\n\t\t// do simple repaint after the first call\n\t\tthis.render = this.resize;\n\t};\n\tLayout.prototype.$fill = function (node, parent) {\n\t\tthis.$view = node;\n\t\tthis.$parent = parent;\n\t\tvar cells = domHelpers.getChildNodes(node, \"gantt_layout_cell\");\n\t\tfor (var i = cells.length - 1; i >= 0; i--) {\n\t\t\tvar sub = this.$cells[i];\n\t\t\tsub.$fill(cells[i], this);\n\t\t\t// initially hidden cell\n\t\t\tif (sub.$config.hidden) {\n\t\t\t\tsub.$view.parentNode.removeChild(sub.$view);\n\t\t\t}\n\t\t}\n\t};\n\tLayout.prototype.$toHTML = function () {\n\t\tvar mode = this._xLayout ? \"x\" : \"y\";\n\t\tvar html = [];\n\t\tfor (var i = 0; i < this.$cells.length; i++) {\n\t\t\thtml.push(this.$cells[i].$toHTML());\n\t\t}\n\t\treturn _super.prototype.$toHTML.call(this, html.join(\"\"), (this.$root ? \"gantt_layout_root \" : \"\") + \"gantt_layout gantt_layout_\" + mode);\n\t};\n\n\tLayout.prototype.getContentSize = function(mode){\n\t\tvar contentWidth = 0,\n\t\t\tcontentHeight = 0;\n\n\t\tvar cellSize, cell, borders;\n\t\tfor (var i = 0; i < this.$cells.length; i++) {\n\t\t\tcell = this.$cells[i];\n\t\t\tif(cell.$config.hidden)\n\t\t\t\tcontinue;\n\n\t\t\tcellSize = cell.getContentSize(mode);\n\n\t\t\tif(cell.$config.view === \"scrollbar\" && mode[cell.$config.scroll]){\n\t\t\t\tcellSize.height = 0;\n\t\t\t\tcellSize.width = 0;\n\t\t\t}\n\n\t\t\tif(cell.$config.resizer){\n\t\t\t\tif(this._xLayout){\n\t\t\t\t\tcellSize.height = 0;\n\t\t\t\t}else{\n\t\t\t\t\tcellSize.width = 0;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tborders = cell._getBorderSizes();\n\n\t\t\tif(this._xLayout){\n\t\t\t\tcontentWidth += (cellSize.width + borders.horizontal);\n\t\t\t\tcontentHeight = Math.max(contentHeight, (cellSize.height + borders.vertical));\n\t\t\t}else{\n\t\t\t\tcontentWidth = Math.max(contentWidth, cellSize.width + borders.horizontal);\n\t\t\t\tcontentHeight += cellSize.height + borders.vertical;\n\t\t\t}\n\t\t}\n\n\t\tborders = this._getBorderSizes();\n\t\tcontentWidth += borders.horizontal;\n\t\tcontentHeight += borders.vertical;\n\n\t\t// GS-149 & GS-150: By default this code only increases the container sizes, because of that, the cell sizes\n\t\t// are also increased. Keep this code here in the case if something goes wrong\n\t\t/*\n\t\tif(this.$root){\n\t\t\tcontentWidth += 1;\n\t\t\tcontentHeight += 1;\n\t\t}\n\t\t*/\n\t\treturn {\n\t\t\twidth: contentWidth,\n\t\t\theight: contentHeight\n\t\t};\n\t};\n\n\tLayout.prototype._cleanElSize = function(value){\n\t\treturn ((value || \"\").toString().replace(\"px\", \"\") * 1 || 0);\n\t};\n\tLayout.prototype._getBoxStyles = function(div){\n\t\tvar computed = null;\n\t\tif(window.getComputedStyle){\n\t\t\tcomputed = window.getComputedStyle(div, null);\n\t\t}else{\n\t\t\t//IE with elem.currentStyle does not calculate sizes from %, so will use the default approach\n\t\t\tcomputed = {\n\t\t\t\t\"width\":div.clientWidth,\n\t\t\t\t\"height\":div.clientHeight\n\t\t\t};\n\t\t}\n\t\tvar properties = [\n\t\t\t\"width\",\n\t\t\t\"height\",\n\n\t\t\t\"paddingTop\",\n\t\t\t\"paddingBottom\",\n\t\t\t\"paddingLeft\",\n\t\t\t\"paddingRight\",\n\n\t\t\t\"borderLeftWidth\",\n\t\t\t\"borderRightWidth\",\n\t\t\t\"borderTopWidth\",\n\t\t\t\"borderBottomWidth\"\n\t\t];\n\t\tvar styles = {\n\t\t\tboxSizing:(computed.boxSizing == \"border-box\")\n\t\t};\n\n\t\tif(computed.MozBoxSizing){\n\t\t\tstyles.boxSizing = (computed.MozBoxSizing == \"border-box\");\n\t\t}\n\t\tfor(var i =0; i < properties.length; i++){\n\t\t\tstyles[properties[i]] = computed[properties[i]] ? this._cleanElSize(computed[properties[i]]) : 0;\n\t\t}\n\n\n\t\tvar box = {\n\t\t\thorPaddings : (styles.paddingLeft + styles.paddingRight + styles.borderLeftWidth + styles.borderRightWidth),\n\t\t\tvertPaddings : (styles.paddingTop + styles.paddingBottom + styles.borderTopWidth + styles.borderBottomWidth),\n\t\t\tborderBox: styles.boxSizing,\n\t\t\tinnerWidth : styles.width,\n\t\t\tinnerHeight : styles.height,\n\t\t\touterWidth : styles.width,\n\t\t\touterHeight : styles.height\n\t\t};\n\n\n\t\tif(box.borderBox){\n\t\t\tbox.innerWidth -= box.horPaddings;\n\t\t\tbox.innerHeight -= box.vertPaddings;\n\t\t}else{\n\t\t\tbox.outerWidth += box.horPaddings;\n\t\t\tbox.outerHeight += box.vertPaddings;\n\t\t}\n\n\t\treturn box;\n\t};\n\n\tLayout.prototype._getAutosizeMode = function(config){\n\t\tvar res = {x:false, y:false};\n\t\tif(config === \"xy\"){\n\t\t\tres.x = res.y = true;\n\t\t}else if(config === \"y\" || config === true){\n\t\t\tres.y = true;\n\t\t}else if(config === \"x\"){\n\t\t\tres.x = true;\n\t\t}\n\t\treturn res;\n\t};\n\n\tLayout.prototype.autosize = function(mode) {\n\t\tvar res = this._getAutosizeMode(mode);\n\t\tvar boxSizes = this._getBoxStyles(this.$container);\n\t\tvar contentSizes = this.getContentSize(mode);\n\n\t\tvar node = this.$container;\n\t\tif(res.x){\n\t\t\tif(boxSizes.borderBox){\n\t\t\t\tcontentSizes.width += boxSizes.horPaddings;\n\t\t\t}\n\t\t\tnode.style.width = contentSizes.width + \"px\";\n\t\t}\n\t\tif(res.y){\n\t\t\tif(boxSizes.borderBox){\n\t\t\t\tcontentSizes.height += boxSizes.vertPaddings;\n\t\t\t}\n\t\t\tnode.style.height = contentSizes.height + \"px\";\n\t\t}\n\t};\n\n\tLayout.prototype.getSize = function () {\n\t\tthis._sizes = [];\n\t\tvar width = 0;\n\t\tvar minWidth = 0;\n\t\tvar maxWidth = 100000000000;\n\t\tvar height = 0;\n\t\tvar maxHeight = 100000000000;\n\t\tvar minHeight = 0;\n\n\t\tfor (var i = 0; i < this.$cells.length; i++) {\n\n\t\t\tvar size = this._sizes[i] = this.$cells[i].getSize();\n\t\t\tif (this.$cells[i].$config.hidden) {\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t\tif (this._xLayout) {\n\t\t\t\tif (!size.width && size.minWidth) {\n\t\t\t\t\twidth += size.minWidth;\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\twidth += size.width;\n\t\t\t\t}\n\t\t\t\tmaxWidth += size.maxWidth;\n\t\t\t\tminWidth += size.minWidth;\n\t\t\t\theight = Math.max(height, size.height);\n\t\t\t\tmaxHeight = Math.min(maxHeight, size.maxHeight); // min of maxHeight\n\t\t\t\tminHeight = Math.max(minHeight, size.minHeight); // max of minHeight\n\t\t\t}\n\t\t\telse {\n\t\t\t\tif (!size.height && size.minHeight) {\n\t\t\t\t\theight += size.minHeight;\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\theight += size.height;\n\t\t\t\t}\n\t\t\t\tmaxHeight += size.maxHeight;\n\t\t\t\tminHeight += size.minHeight;\n\t\t\t\twidth = Math.max(width, size.width);\n\t\t\t\tmaxWidth = Math.min(maxWidth, size.maxWidth); // min of maxWidth\n\t\t\t\tminWidth = Math.max(minWidth, size.minWidth); // max of minWidth\n\t\t\t}\n\t\t}\n\t\tvar self = _super.prototype.getSize.call(this);\n\t\t// maxWidth\n\t\tif (self.maxWidth >= 100000) {\n\t\t\tself.maxWidth = maxWidth;\n\t\t}\n\t\t// maxHeight\n\t\tif (self.maxHeight >= 100000) {\n\t\t\tself.maxHeight = maxHeight;\n\t\t}\n\t\t// minWidth\n\t\tself.minWidth = self.minWidth !== self.minWidth ? 0 : self.minWidth;// || self.width || Math.max(minWidth, width);\n\t\t// minHeight\n\t\tself.minHeight = self.minHeight !== self.minHeight ? 0 : self.minHeight;//self.minHeight || self.height || Math.max(minHeight, height);\n\t\t// sizes with paddings and margins\n\t\tif (this._xLayout) {\n\t\t\tself.minWidth += this.$config.margin * (this.$cells.length) || 0;\n\t\t\tself.minWidth += this.$config.padding * 2 || 0;\n\t\t\tself.minHeight += (this.$config.padding * 2) || 0;\n\t\t}\n\t\telse {\n\t\t\tself.minHeight += this.$config.margin * (this.$cells.length) || 0;\n\t\t\tself.minHeight += (this.$config.padding * 2) || 0;\n\t\t}\n\t\t\n\t\treturn self;\n\t};\n\t// calc total gravity and free space\n\tLayout.prototype._calcFreeSpace = function (s, cell, xLayout) {\n\t\tvar min = xLayout ? cell.minWidth : cell.minHeight;\n\t\tvar max = xLayout ? cell.maxWidth : cell.maxWidth;\n\t\tvar side = s;\n\t\tif (!side) {\n\t\t\tside = Math.floor(this._free / this._gravity * cell.gravity);\n\t\t\tif (side > max) {\n\t\t\t\tside = max;\n\t\t\t\tthis._free -= side;\n\t\t\t\tthis._gravity -= cell.gravity;\n\t\t\t}\n\t\t\tif (side < min) {\n\t\t\t\tside = min;\n\t\t\t\tthis._free -= side;\n\t\t\t\tthis._gravity -= cell.gravity;\n\t\t\t}\n\t\t}\n\t\telse {\n\t\t\tif (side > max) {\n\t\t\t\tside = max;\n\t\t\t}\n\t\t\tif (side < min) {\n\t\t\t\tside = min;\n\t\t\t}\n\t\t\tthis._free -= side;\n\t\t}\n\t\treturn side;\n\t};\n\tLayout.prototype._calcSize = function (s, size, xLayout) {\n\t\tvar side = s;\n\t\tvar min = xLayout ? size.minWidth : size.minHeight;\n\t\tvar max = xLayout ? size.maxWidth : size.maxHeight;\n\t\tif (!side) {\n\t\t\tside = Math.floor(this._free / this._gravity * size.gravity);\n\t\t}\n\t\tif (side > max) {\n\t\t\tside = max;\n\t\t}\n\t\tif (side < min) {\n\t\t\tside = min;\n\t\t}\n\t\treturn side;\n\t};\n\n\tLayout.prototype._configureBorders = function(){\n\t\tif(this.$root){\n\t\t\tthis._setBorders([\n\t\t\t\tthis._borders.left,\n\t\t\t\tthis._borders.top,\n\t\t\t\tthis._borders.right,\n\t\t\t\tthis._borders.bottom\n\t\t\t],\n\t\t\tthis);\n\t\t}\n\n\t\tvar borderClass = this._xLayout ? this._borders.right : this._borders.bottom;\n\n\t\tvar cells = this.$cells;\n\n\t\tvar lastVisibleIndex = cells.length - 1;\n\t\tfor(var i = lastVisibleIndex; i >= 0; i--){\n\t\t\tif (!cells[i].$config.hidden) {\n\t\t\t\tlastVisibleIndex = i;\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\n\t\tfor (var i = 0; i < cells.length; i++) {\n\t\t\tif (cells[i].$config.hidden) {\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tvar lastCell = i >= lastVisibleIndex;\n\t\t\tvar borderColorClass = \"\";\n\t\t\tif(!lastCell && cells[i + 1]){\n\t\t\t\tif(cells[i + 1].$config.view == \"scrollbar\"){\n\t\t\t\t\tif(this._xLayout){\n\t\t\t\t\t\tlastCell = true;\n\t\t\t\t\t}else{\n\t\t\t\t\t\tborderColorClass = \"gantt_layout_cell_border_transparent\";\n\t\t\t\t\t}\n\n\t\t\t\t}\n\t\t\t}\n\n\n\t\t\tthis._setBorders(lastCell ? [] : [borderClass, borderColorClass], cells[i]);\n\t\t}\n\t};\n\n\tLayout.prototype._updateCellVisibility = function(){\n\t\tvar oldVisibleCells = this._visibleCells || {};\n\t\tvar firstCall = !this._visibleCells;\n\t\tvar visibleCells = {};\n\t\tvar cell = null;\n\t\tvar parentVisibility = [];\n\t\tfor (var i = 0; i < this._sizes.length; i++) {\n\t\t\tcell = this.$cells[i];\n\t\t\tif (cell.$config.hide_empty){\n\t\t\t\tparentVisibility.push(cell);\n\t\t\t}\n\n\t\t\tif (!firstCall && cell.$config.hidden && oldVisibleCells[cell.$id]) {\n\t\t\t\tcell._hide(true);\n\t\t\t}else if(!cell.$config.hidden && !oldVisibleCells[cell.$id]){\n\t\t\t\tcell._hide(false);\n\t\t\t}\n\n\t\t\tif(!cell.$config.hidden){\n\t\t\t\tvisibleCells[cell.$id] = true;\n\t\t\t}\n\t\t}\n\t\tthis._visibleCells = visibleCells;\n\n\t\t// GS-27. A way to hide the whole cell if all its children are hidden\n\t\tfor (var i = 0; i < parentVisibility.length; i++) {\n\t\t\tvar cell = parentVisibility[i];\n\t\t\tvar children = cell.$cells;\n\t\t\tvar hideCell = true;\n\t\t\tchildren.forEach(function(child){\n\t\t\t\tif (!child.$config.hidden && !child.$config.resizer){\n\t\t\t\t\thideCell = false;\n\t\t\t\t}\n\t\t\t});\n\t\t\t\n\t\t\tcell.$config.hidden = hideCell;\n\t\t}\n\t};\n\n\tLayout.prototype.setSize = function (x, y) {\n\t\tthis._configureBorders();\n\t\t_super.prototype.setSize.call(this, x, y);\n\t\ty = this.$lastSize.contentY;\n\t\tx = this.$lastSize.contentX;\n\n\t\tvar padding = (this.$config.padding || 0);\n\t\tthis.$view.style.padding = padding + \"px\";\n\t\tthis._gravity = 0;\n\t\tthis._free = this._xLayout ? x : y;\n\t\tthis._free -= padding * 2;\n\t\t// calc all gravity\n\n\t\tvar cell,\n\t\t\tsize;\n\n\t\tthis._updateCellVisibility();\n\n\t\tfor (var i = 0; i < this._sizes.length; i++) {\n\t\t\tcell = this.$cells[i];\n\n\t\t\tif (cell.$config.hidden) {\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t\tvar margin = (this.$config.margin || 0);\n\t\t\tif(cell.$name == \"resizer\" && !margin){\n\t\t\t\tmargin = -1;\n\t\t\t}\n\n\t\t\t// set margins to child cell\n\t\t\tvar cellView = cell.$view;\n\n\t\t\tvar marginSide = this._xLayout ? \"marginRight\" : \"marginBottom\";\n\t\t\tif (i !== this.$cells.length - 1) {\n\t\t\t\tcellView.style[marginSide] = margin + \"px\";\n\t\t\t\tthis._free -= margin; // calc free space without margin\n\t\t\t}\n\t\t\tsize = this._sizes[i];\n\t\t\tif (this._xLayout) {\n\t\t\t\tif (!size.width) {\n\t\t\t\t\tthis._gravity += size.gravity;\n\t\t\t\t}\n\t\t\t}\n\t\t\telse {\n\t\t\t\tif (!size.height) {\n\t\t\t\t\tthis._gravity += size.gravity;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tfor (var i = 0; i < this._sizes.length; i++) {\n\t\t\tcell = this.$cells[i];\n\n\t\t\tif (cell.$config.hidden) {\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t\tsize = this._sizes[i];\n\t\t\tvar width = size.width;\n\t\t\tvar height = size.height;\n\t\t\tif (this._xLayout) {\n\t\t\t\tthis._calcFreeSpace(width, size, true);\n\t\t\t}\n\t\t\telse {\n\t\t\t\tthis._calcFreeSpace(height, size, false);\n\t\t\t}\n\t\t}\n\t\tfor (var i = 0; i < this.$cells.length; i++) {\n\t\t\tcell = this.$cells[i];\n\n\t\t\tif (cell.$config.hidden) {\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t\tsize = this._sizes[i];\n\t\t\tvar dx = void 0;\n\t\t\tvar dy = void 0;\n\t\t\tif (this._xLayout) {\n\t\t\t\tdx = this._calcSize(size.width, size, true);\n\t\t\t\tdy = y - padding * 2; // layout height without paddings\n\t\t\t}\n\t\t\telse {\n\t\t\t\tdx = x - padding * 2; // layout width without paddings\n\t\t\t\tdy = this._calcSize(size.height, size, false);\n\t\t\t}\n\n\t\t\tcell.setSize(dx, dy);\n\t\t}\n\n\t};\n\n\treturn Layout;\n}(Cell));\n\nexport default Layout;","import __extends from \"../../../utils/extends\";\nimport Layout from \"./layout\";\nimport Cell from \"./cell\";\n\nvar ViewLayout = (function (_super) {\n\t\"use strict\";\n\n\t__extends(ViewLayout, _super);\n\tfunction ViewLayout(parent, config, factory) {\n\t\tvar _this = _super.apply(this, arguments) || this;\n\t\tfor (var i = 0; i < _this.$cells.length; i++) {\n\t\t\t_this.$cells[i].$config.hidden = (i !== 0);\n\t\t}\n\t\t_this.$cell = _this.$cells[0];\n\t\t_this.$name = \"viewLayout\";\n\n\t\treturn _this;\n\t}\n\tViewLayout.prototype.cell = function (id) {\n\t\tvar cell = _super.prototype.cell.call(this, id);\n\t\tif (!cell.$view) {\n\t\t\tthis.$fill(null, this);\n\t\t}\n\t\treturn cell;\n\t};\n\tViewLayout.prototype.moveView = function (view) {\n\t\tvar body = this.$view;\n\t\tif (this.$cell) {\n\t\t\tthis.$cell.$config.hidden = true;\n\t\t\tbody.removeChild(this.$cell.$view);\n\t\t}\n\t\tthis.$cell = view;\n\t\tbody.appendChild(view.$view);\n\t};\n\tViewLayout.prototype.setSize = function (x, y) {\n\t\tCell.prototype.setSize.call(this, x, y);\n\t};\n\n\tViewLayout.prototype.setContentSize = function(){\n\t\tvar size = this.$lastSize;\n\t\tthis.$cell.setSize(size.contentX, size.contentY);\n\t};\n\n\tViewLayout.prototype.getSize = function () {\n\t\tvar sizes = _super.prototype.getSize.call(this);\n\t\tif (this.$cell) {\n\t\t\tvar cellSize = this.$cell.getSize();\n\t\t\tif (this.$config.byMaxSize) {\n\t\t\t\tfor (var i = 0; i < this.$cells.length; i++) {\n\t\t\t\t\tvar otherCell = this.$cells[i].getSize();\n\t\t\t\t\tfor (var cell in cellSize) {\n\t\t\t\t\t\tcellSize[cell] = Math.max(cellSize[cell], otherCell[cell]);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\tfor (var size in sizes) {\n\t\t\t\tsizes[size] = sizes[size] || cellSize[size];\n\t\t\t}\n\t\t\tsizes.gravity = Math.max(sizes.gravity, cellSize.gravity);\n\t\t}\n\t\treturn sizes;\n\t};\n\treturn ViewLayout;\n}(Layout));\n\nexport default ViewLayout;","import __extends from \"../../../utils/extends\";\nimport * as utils from \"../../../utils/utils\";\nimport Cell from \"./cell\";\n\nvar ViewCell = (function (_super) {\n\t\"use strict\";\n\n\t__extends(ViewCell, _super);\n\tfunction ViewCell(parent, config, factory) {\n\n\t\tvar _this = _super.apply(this, arguments) || this;\n\n\t\tif(config.view){\n\t\t\tif(config.id){\n\t\t\t\t// pass id to the nested view\n\t\t\t\tthis.$id = utils.uid();\n\t\t\t}\n\t\t\tvar childConfig = utils.copy(config);\n\t\t\tdelete childConfig.config;\n\t\t\tdelete childConfig.templates;\n\n\t\t\tthis.$content = this.$factory.createView(config.view, this, childConfig, this);\n\t\t\tif(!this.$content)\n\t\t\t\treturn false;\n\t\t}\n\n\t\t_this.$name = \"viewCell\";\n\t\treturn _this;\n\t}\n\n\tViewCell.prototype.destructor = function(){\n\t\tthis.clear();\n\t\t_super.prototype.destructor.call(this);\n\t};\n\n\tViewCell.prototype.clear = function(){\n\n\t\tthis.$initialized = false;\n\n\t\t// call destructor\n\t\tif (this.$content){\n\t\t\tvar method = this.$content.unload || this.$content.destructor;\n\t\t\tif (method){\n\t\t\t\tmethod.call(this.$content);\n\t\t\t}\n\t\t}\n\n\t\t_super.prototype.clear.call(this);\n\n\t};\n\n\tViewCell.prototype.scrollTo = function(left, top){\n\n\t\tif(this.$content && this.$content.scrollTo){\n\t\t\tthis.$content.scrollTo(left, top);\n\t\t}else{\n\t\t\t_super.prototype.scrollTo.call(this, left, top);\n\t\t}\n\t};\n\n\tViewCell.prototype._setContentSize = function(x, y){\n\t\tvar borders = this._getBorderSizes();\n\t\tif(typeof x === \"number\"){\n\t\t\tvar outerX = x + borders.horizontal;\n\t\t\tthis.$config.width = outerX;\n\t\t}\n\t\tif(typeof y === \"number\"){\n\t\t\tvar outerY = y + borders.vertical;\n\t\t\tthis.$config.height = outerY;\n\t\t}\n\t};\n\n\tViewCell.prototype.setSize = function(x, y){\n\t\t_super.prototype.setSize.call(this, x, y);\n\n\t\tif(!this.$preResize && this.$content) {\n\t\t\tif (!this.$initialized) {\n\t\t\t\tthis.$initialized = true;\n\t\t\t\tvar header = this.$view.childNodes[0];\n\t\t\t\tvar content = this.$view.childNodes[1];\n\t\t\t\tif(!content) content = header;\n\n\t\t\t\t/*if(this.$content.$config){\n\t\t\t\t\tthis.$content.$config.width = this.$lastSize.contentX;\n\t\t\t\t\tthis.$content.$config.height = this.$lastSize.contentY;\n\t\t\t\t}*/\n\t\t\t\tthis.$content.init(content);\n\t\t\t}\n\t\t}\n\t};\n\n\tViewCell.prototype.setContentSize = function(){\n\t\tif(!this.$preResize && this.$content) {\n\t\t\tif (this.$initialized) {\n\t\t\t\tthis.$content.setSize(this.$lastSize.contentX, this.$lastSize.contentY);\n\t\t\t}\n\t\t}\n\t};\n\n\n\tViewCell.prototype.getContentSize = function(){\n\t\tvar size = _super.prototype.getContentSize.call(this);\n\n\t\tif(this.$content && this.$initialized){\n\t\t\tvar childSize = this.$content.getSize();\n\t\t\tsize.width = childSize.contentX === undefined ? childSize.width : childSize.contentX;\n\t\t\tsize.height = childSize.contentY === undefined ? childSize.height : childSize.contentY;\n\t\t}\n\n\t\tvar borders = this._getBorderSizes();\n\t\tsize.width += borders.horizontal;\n\t\tsize.height += borders.vertical;\n\n\t\treturn size;\n\t};\n\n\treturn ViewCell;\n}(Cell));\n\nexport default ViewCell;","import __extends from \"../../../utils/extends\";\nimport * as domHelpers from \"../utils/dom_helpers\";\nimport * as utils from \"../../../utils/utils\";\nimport env from \"../../../utils/env\";\nimport Cell from \"./cell\";\n\nvar ScrollbarCell = (function (_super) {\n\t\"use strict\";\n\n\tvar SCROLL_MODIFIER_KEYS = [\"altKey\", \"shiftKey\", \"metaKey\"]; // it's no way to disable ctrl+wheel\n\t__extends(ScrollbarCell, _super);\n\tfunction ScrollbarCell(parent, config, factory, gantt) {\n\n\t\tvar _this = _super.apply(this, arguments) || this;\n\t\tthis.$config = utils.mixin(config, {scroll: \"x\"});\n\t\t_this._scrollHorizontalHandler = utils.bind(_this._scrollHorizontalHandler, _this);\n\t\t_this._scrollVerticalHandler = utils.bind(_this._scrollVerticalHandler, _this);\n\t\t_this._outerScrollVerticalHandler = utils.bind(_this._outerScrollVerticalHandler, _this);\n\t\t_this._outerScrollHorizontalHandler = utils.bind(_this._outerScrollHorizontalHandler, _this);\n\t\t_this._mouseWheelHandler = utils.bind(_this._mouseWheelHandler, _this);\n\n\t\tthis.$config.hidden = true;\n\t\tvar size = gantt.config.scroll_size;\n\n\t\tif(gantt.env.isIE){\n\t\t\t// full element height/width must be bigger than just a browser scrollbar,\n\t\t\t// otherwise the scrollbar element won't be scrolled on click\n\t\t\tsize += 1;\n\t\t}\n\n\t\tif(this._isHorizontal()){\n\t\t\t_this.$config.height = size;\n\t\t\t_this.$parent.$config.height = size;\n\t\t}else{\n\t\t\t_this.$config.width = size;\n\t\t\t_this.$parent.$config.width = size;\n\t\t}\n\n\t\tthis.$config.scrollPosition = 0;\n\n\t\t_this.$name = \"scroller\";\n\t\treturn _this;\n\t}\n\n\tScrollbarCell.prototype.init = function(container){\n\t\tcontainer.innerHTML = this.$toHTML();\n\t\tthis.$view = container.firstChild;\n\n\t\tif(!this.$view){\n\t\t\tthis.init();\n\t\t}\n\t\tif(this._isVertical()){\n\t\t\tthis._initVertical();\n\t\t}else{\n\t\t\tthis._initHorizontal();\n\t\t}\n\t\tthis._initMouseWheel();\n\t\tthis._initLinkedViews();\n\t};\n\n\tScrollbarCell.prototype.$toHTML = function () {\n\t\tvar className = this._isHorizontal() ? \"gantt_hor_scroll\" : \"gantt_ver_scroll\";\n\t\treturn \"<div class='gantt_layout_cell \"+className+\"'><div style='\"+(this._isHorizontal() ? \"width:2000px\" : \"height:2000px\")+\"'></div></div>\";\n\t};\n\n\tScrollbarCell.prototype._getRootParent = function(){\n\t\tvar parent = this.$parent;\n\t\twhile(parent && parent.$parent){\n\t\t\tparent = parent.$parent;\n\t\t}\n\t\tif(parent){\n\t\t\treturn parent;\n\t\t}\n\t};\n\n\n\tfunction eachCell(root, res){\n\t\tres.push(root);\n\t\tif(root.$cells){\n\t\t\tfor(var i = 0; i < root.$cells.length; i++){\n\t\t\t\teachCell(root.$cells[i], res);\n\t\t\t}\n\t\t}\n\t}\n\tScrollbarCell.prototype._eachView = function(){\n\t\tvar res = [];\n\t\teachCell(this._getRootParent(), res);\n\t\treturn res;\n\t};\n\n\tScrollbarCell.prototype._getLinkedViews = function(){\n\t\tvar views = this._eachView();\n\t\tvar res = [];\n\t\tfor(var i = 0; i < views.length; i++){\n\t\t\tif(views[i].$config && ((this._isVertical() && views[i].$config.scrollY == this.$id) || (this._isHorizontal() && views[i].$config.scrollX == this.$id)) ){\n\t\t\t\tres.push(views[i]);\n\t\t\t}\n\t\t}\n\t\treturn res;\n\t};\n\n\n\tScrollbarCell.prototype._initHorizontal = function(){\n\t\tthis.$scroll_hor = this.$view;\n\t\tthis.$domEvents.attach(this.$view, \"scroll\", this._scrollHorizontalHandler);\n\n\t};\n\n\tScrollbarCell.prototype._initLinkedViews = function(){\n\t\tvar views = this._getLinkedViews();\n\t\tvar css = this._isVertical() ?\"gantt_layout_outer_scroll gantt_layout_outer_scroll_vertical\" : \"gantt_layout_outer_scroll gantt_layout_outer_scroll_horizontal\";\n\t\tfor(var i = 0; i < views.length; i++){\n\t\t\t//views[i].$config.css = [views[i].$config.css || \"\", css].join(\" \");\n\t\t\tdomHelpers.addClassName(views[i].$view || views[i].getNode(), css);\n\t\t}\n\t};\n\n\tScrollbarCell.prototype._initVertical = function(){\n\t\tthis.$scroll_ver = this.$view;\n\t\tthis.$domEvents.attach(this.$view, \"scroll\", this._scrollVerticalHandler);\n\t};\n\n\tScrollbarCell.prototype._updateLinkedViews = function(){\n\t};\n\n\tScrollbarCell.prototype._initMouseWheel = function(){\n\t\tvar ff = env.isFF;\n\t\tif (ff)\n\t\t\tthis.$domEvents.attach(this._getRootParent().$view, \"wheel\", this._mouseWheelHandler, {passive: false});\n\t\telse\n\t\t\tthis.$domEvents.attach(this._getRootParent().$view, \"mousewheel\", this._mouseWheelHandler, {passive: false});\n\t};\n\n\n\n\n\tScrollbarCell.prototype.scrollHorizontally = function(left){\n\t\tif(this._scrolling) return;\n\t\tthis._scrolling = true;\n\n\t\tthis.$scroll_hor.scrollLeft = left;\n\t\tthis.$config.codeScrollLeft = left;\n\t\tleft = this.$scroll_hor.scrollLeft;\n\n\t\tvar views = this._getLinkedViews();\n\t\tfor(var i = 0; i < views.length; i++){\n\t\t\tif(views[i].scrollTo){\n\t\t\t\tviews[i].scrollTo(left, undefined);\n\t\t\t}\n\t\t}\n\t\tvar oldSize = this.$config.scrollPosition;\n\t\tthis.$config.scrollPosition = left;\n\t\tthis.callEvent(\"onScroll\", [oldSize, left, this.$config.scroll]);\n\t\tthis._scrolling = false;\n\t};\n\tScrollbarCell.prototype.scrollVertically = function(top){\n\t\tif(this._scrolling) return;\n\t\tthis._scrolling = true;\n\n\t\tthis.$scroll_ver.scrollTop = top;\n\t\ttop = this.$scroll_ver.scrollTop;\n\n\t\tvar views = this._getLinkedViews();\n\n\t\tfor(var i = 0; i < views.length; i++){\n\t\t\tif(views[i].scrollTo){\n\t\t\t\tviews[i].scrollTo(undefined, top);\n\t\t\t}\n\t\t}\n\t\tvar oldSize = this.$config.scrollPosition;\n\t\tthis.$config.scrollPosition = top;\n\t\tthis.callEvent(\"onScroll\", [oldSize, top, this.$config.scroll]);\n\t\tthis._scrolling = false;\n\t};\n\n\tScrollbarCell.prototype._isVertical = function(){\n\t\treturn this.$config.scroll == \"y\";\n\t};\n\tScrollbarCell.prototype._isHorizontal = function(){\n\t\treturn this.$config.scroll == \"x\";\n\t};\n\tScrollbarCell.prototype._scrollHorizontalHandler = function (e) {\n\t\tif(this._isVertical() || this._scrolling){\n\t\t\treturn;\n\t\t}\n\n\t\t//in safari we can catch previous onscroll after setting new value from mouse-wheel event\n\t\t//set delay to prevent value drifiting\n\t\tif ((new Date()) - ( this._wheel_time || 0 ) < 100) return true;\n\t\t//if (this.$gantt._touch_scroll_active) return;\n\t\tvar left = this.$scroll_hor.scrollLeft;\n\n\t\tthis.scrollHorizontally(left);\n\n\t\tthis._oldLeft = this.$scroll_hor.scrollLeft;\n\t};\n\tScrollbarCell.prototype._outerScrollHorizontalHandler = function(e){\n\t\tif(this._isVertical()){\n\t\t\treturn;\n\t\t}\n\t};\n\n\tScrollbarCell.prototype.show = function(){\n\t\tthis.$parent.show();\n\t};\n\tScrollbarCell.prototype.hide = function(){\n\t\tthis.$parent.hide();\n\t};\n\n\tScrollbarCell.prototype._getScrollSize = function(){\n\t\tvar scrollSize = 0;\n\t\tvar outerSize = 0;\n\t\tvar isHorizontal = this._isHorizontal();\n\n\t\tvar linked = this._getLinkedViews();\n\t\tvar view;\n\t\tvar scrollProperty = isHorizontal ? \"scrollWidth\" : \"scrollHeight\",\n\t\t\tinnerSizeProperty = isHorizontal ? \"contentX\" : \"contentY\";\n\t\tvar outerProperty = isHorizontal ? \"x\" : \"y\";\n\t\tvar offset = this._getScrollOffset();\n\n\t\tfor(var i = 0; i < linked.length; i++){\n\t\t\tview = linked[i];\n\t\t\tif(!(view && view.$content && view.$content.getSize && !view.$config.hidden)) continue;\n\n\t\t\tvar sizes = view.$content.getSize();\n\t\t\tvar cellScrollSize;\n\t\t\tif(sizes.hasOwnProperty(scrollProperty)){\n\t\t\t\tcellScrollSize = sizes[scrollProperty];\n\t\t\t}else{\n\t\t\t\tcellScrollSize = sizes[innerSizeProperty];\n\t\t\t}\n\n\t\t\tif(offset){\n\t\t\t\t// precalculated vertical/horizontal offsets of scrollbar to emulate 4.x look\n\t\t\t\tif(sizes[innerSizeProperty] > sizes[outerProperty] && sizes[innerSizeProperty] > scrollSize && (cellScrollSize > (sizes[outerProperty] - offset + 2))){\n\t\t\t\t\tscrollSize = cellScrollSize + (isHorizontal ? 0 : 2);\n\t\t\t\t\touterSize = sizes[outerProperty];\n\t\t\t\t}\n\t\t\t}else{\n\t\t\t\tvar nonScrollableSize = Math.max(sizes[innerSizeProperty] - cellScrollSize, 0);\n\t\t\t\tvar scrollableViewPortSize = Math.max(sizes[outerProperty] - nonScrollableSize, 0);\n\t\t\t\tcellScrollSize = cellScrollSize + nonScrollableSize;\n\n\t\t\t\tif(cellScrollSize > scrollableViewPortSize && (cellScrollSize > scrollSize) ){\n\t\t\t\t\t//|| (cellScrollSize === scrollSize && sizes[outerProperty] < outerSize) // same scroll width but smaller scrollable view port\n\n\t\t\t\t\tscrollSize = cellScrollSize;\n\t\t\t\t\touterSize = sizes[outerProperty];\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\treturn {\n\t\t\touterScroll: outerSize,\n\t\t\tinnerScroll: scrollSize\n\t\t};\n\t};\n\n\tScrollbarCell.prototype.scroll = function(position){\n\t\tif(this._isHorizontal()){\n\t\t\tthis.scrollHorizontally(position);\n\t\t}else{\n\t\t\tthis.scrollVertically(position);\n\t\t}\n\t};\n\n\tScrollbarCell.prototype.getScrollState = function(){\n\t\treturn {\n\t\t\tvisible: this.isVisible(),\n\t\t\tdirection: this.$config.scroll,\n\t\t\tsize: this.$config.outerSize,\n\t\t\tscrollSize: this.$config.scrollSize || 0,\n\t\t\tposition: this.$config.scrollPosition || 0\n\t\t};\n\t};\n\n\tScrollbarCell.prototype.setSize = function(width, height){\n\t\t_super.prototype.setSize.apply(this, arguments);\n\n\t\tvar scrollSizes = this._getScrollSize();\n\n\t\tvar ownSize = (this._isVertical() ? height : width) - this._getScrollOffset() + (this._isHorizontal() ? 1 : 0);\n\n\t\tif(scrollSizes.innerScroll && ownSize > scrollSizes.outerScroll){\n\t\t\tscrollSizes.innerScroll += (ownSize - scrollSizes.outerScroll);\n\t\t}\n\t\tthis.$config.scrollSize = scrollSizes.innerScroll;\n\n\t\tthis.$config.width = width;\n\t\tthis.$config.height = height;\n\t\tthis._setScrollSize(scrollSizes.innerScroll);\n\t};\n\n\tScrollbarCell.prototype.isVisible = function(){\n\t\treturn !!(this.$parent && this.$parent.$view.parentNode);\n\t};\n\n\tScrollbarCell.prototype.shouldShow = function(){\n\t\tvar scrollSizes = this._getScrollSize();\n\t\tif(!scrollSizes.innerScroll && (this.$parent && this.$parent.$view.parentNode)){\n\t\t\treturn false;\n\t\t}else if(scrollSizes.innerScroll && !(this.$parent && this.$parent.$view.parentNode)){\n\t\t\treturn true;\n\t\t}else{\n\t\t\treturn false;\n\t\t}\n\t};\n\n\tScrollbarCell.prototype.shouldHide = function(){\n\t\tvar scrollSizes = this._getScrollSize();\n\t\tif(!scrollSizes.innerScroll && (this.$parent && this.$parent.$view.parentNode)){\n\t\t\treturn true;\n\t\t}else{\n\t\t\treturn false;\n\t\t}\n\t};\n\n\n\tScrollbarCell.prototype.toggleVisibility = function(){\n\t\tif(this.shouldHide()){\n\t\t\tthis.hide();\n\t\t}else if(this.shouldShow()){\n\t\t\tthis.show();\n\t\t}\n\t};\n\n\tScrollbarCell.prototype._getScaleOffset = function(view){\n\t\tvar offset = 0;\n\t\tif(view && (view.$config.view == \"timeline\" || view.$config.view == \"grid\")){\n\t\t\toffset = view.$content.$getConfig().scale_height;\n\t\t}\n\t\treturn offset;\n\t};\n\n\tScrollbarCell.prototype._getScrollOffset = function(){\n\t\tvar offset = 0;\n\t\tif(this._isVertical()){\n\t\t\tvar parentLayout = this.$parent.$parent;\n\t\t\toffset = Math.max(\n\t\t\t\tthis._getScaleOffset(parentLayout.getPrevSibling(this.$parent.$id)),\n\t\t\t\tthis._getScaleOffset(parentLayout.getNextSibling(this.$parent.$id))\n\t\t\t\t);\n\t\t}else{\n\t\t\tvar linked = this._getLinkedViews();\n\n\t\t\tfor (var i = 0; i < linked.length; i++) {\n\t\t\t\tvar view = linked[i],\n\t\t\t\t\tvparent = view.$parent;\n\t\t\t\tvar cells = vparent.$cells;\n\n\t\t\t\tvar last = cells[cells.length - 1];\n\n\t\t\t\tif (last && last.$config.view == \"scrollbar\" && last.$config.hidden === false) {\n\t\t\t\t\toffset = last.$config.width;\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\n\t\t\t}\n\t\t}\n\t\treturn offset || 0;\n\t};\n\n\tScrollbarCell.prototype._setScrollSize = function(size){\n\t\tvar property = this._isHorizontal() ? \"width\" : \"height\";\n\t\tvar scrollbar = this._isHorizontal() ? this.$scroll_hor : this.$scroll_ver;\n\n\t\tvar offset = this._getScrollOffset();\n\n\t\tvar node = scrollbar.firstChild;\n\n\t\tif(offset){\n\t\t\tif(this._isVertical()){\n\n\t\t\t\tthis.$config.outerSize = (this.$config.height - offset + 3);\n\t\t\t\tscrollbar.style.height = this.$config.outerSize + \"px\";\n\t\t\t\tscrollbar.style.top = (offset-1) + \"px\";\n\t\t\t\tdomHelpers.addClassName(scrollbar, this.$parent._borders.top);\n\t\t\t\tdomHelpers.addClassName(scrollbar.parentNode, \"gantt_task_vscroll\");\n\t\t\t}else{\n\t\t\t\tthis.$config.outerSize = (this.$config.width - offset + 1);\n\t\t\t\tscrollbar.style.width = this.$config.outerSize + \"px\";\n\t\t\t\t//domHelpers.addClassName(scrollbar, this.$parent._borders.right);\n\t\t\t}\n\t\t}else{\n\t\t\tscrollbar.style.top = \"auto\";\n\t\t\tdomHelpers.removeClassName(scrollbar, this.$parent._borders.top);\n\t\t\tdomHelpers.removeClassName(scrollbar.parentNode, \"gantt_task_vscroll\");\n\t\t\tthis.$config.outerSize = this.$config.height;\n\t\t}\n\n\t\tnode.style[property] = size + \"px\";\n\t};\n\n\tScrollbarCell.prototype._scrollVerticalHandler = function (e) {\n\t\tif(this._scrollHorizontalHandler() || this._scrolling){\n\t\t\treturn;\n\t\t}\n\n\t\t//if (this.$gantt._touch_scroll_active) return;\n\t\tvar top = this.$scroll_ver.scrollTop;\n\t\tvar prev = this._oldTop;\n\t\tif(top == prev) return;\n\n\t\tthis.scrollVertically(top);\n\n\t\tthis._oldTop = this.$scroll_ver.scrollTop;\n\n\t};\n\tScrollbarCell.prototype._outerScrollVerticalHandler = function(e){\n\t\tif(this._scrollHorizontalHandler()){\n\t\t\treturn;\n\t\t}\n\t};\n\n\tScrollbarCell.prototype._checkWheelTarget = function(targetNode){\n\t\tvar connectedViews = this._getLinkedViews().concat(this);\n\n\t\tfor(var i = 0; i < connectedViews.length; i++){\n\t\t\tvar node = connectedViews[i].$view;\n\t\t\tif(domHelpers.isChildOf(targetNode, node)){\n\t\t\t\treturn true;\n\t\t\t}\n\t\t}\n\n\t\treturn false;\n\t};\n\n\tScrollbarCell.prototype._mouseWheelHandler = function(e){\n\t\tvar target = e.target || e.srcElement;\n\n\t\tif(!this._checkWheelTarget(target))\n\t\t\treturn;\n\n\t\tthis._wheel_time = new Date();\n\n\t\tvar res = {};\n\n\t\tvar wheelSpeed = {x: 1, y: 1};\n\t\tvar wheelSpeedConfig = this.$gantt.config.wheel_scroll_sensitivity;\n\n\t\tif (typeof wheelSpeedConfig == \"number\" && !!wheelSpeedConfig) {\n\t\t\twheelSpeed = {x: wheelSpeedConfig, y: wheelSpeedConfig};\n\t\t}\n\t\telse if (({}).toString.apply(wheelSpeedConfig) == \"[object Object]\") {\n\t\t\twheelSpeed = {x: wheelSpeedConfig.x, y: wheelSpeedConfig.y};\n\t\t}\n\n\t\tvar ff = env.isFF;\n\t\tvar deltaX = ff ? (e.deltaX) : e.wheelDeltaX;\n\t\tvar deltaY = ff ? (e.deltaY) : e.wheelDelta;\n\n\t\tvar multiplier = -20;\n\t\tif (ff) {\n\t\t\tif (e.deltaMode !== 0) {\n\t\t\t\tmultiplier = -40;\n\t\t\t} else {\n\t\t\t\tmultiplier = -10;\n\t\t\t}\n\t\t}\n\n\t\tvar wx = ff ? (deltaX * multiplier * wheelSpeed.x) : deltaX * 2 * wheelSpeed.x;\n\t\tvar wy = ff ? (deltaY * multiplier * wheelSpeed.y) : deltaY * wheelSpeed.y;\n\n\t\tvar horizontalScrollModifier = this.$gantt.config.horizontal_scroll_key;\n\n\t\tif (horizontalScrollModifier !== false) {\n\t\t\tif (SCROLL_MODIFIER_KEYS.indexOf(horizontalScrollModifier) >= 0) {\n\t\t\t\tif(e[horizontalScrollModifier] && !(e.deltaX || e.wheelDeltaX)){\n\t\t\t\t\t// shift+mousewheel for horizontal scroll\n\t\t\t\t\twx = wy*2;\n\t\t\t\t\twy = 0;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\n\t\tif (wx && Math.abs(wx) > Math.abs(wy)){\n\t\t\tif(this._isVertical()){\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif(res.x) return true;//no horisontal scroll, must not block scrolling\n\t\t\tif(!this.$scroll_hor || !this.$scroll_hor.offsetWidth) return true;\n\n\t\t\tvar dir  = wx/-40;\n\t\t\tvar oldLeft = this._oldLeft;\n\t\t\tvar left = oldLeft+dir*30;\n\t\t\tthis.scrollHorizontally(left);\n\t\t\tthis.$scroll_hor.scrollLeft = left;\n\t\t\t// not block scroll if position hasn't changed\n\t\t\tif(oldLeft == this.$scroll_hor.scrollLeft){\n\t\t\t\treturn true;\n\t\t\t}\n\n\t\t\tthis._oldLeft = this.$scroll_hor.scrollLeft;\n\t\t} else {\n\t\t\tif(this._isHorizontal()){\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif(res.y) return true;//no vertical scroll, must not block scrolling\n\t\t\tif(!this.$scroll_ver || !this.$scroll_ver.offsetHeight) return true;\n\n\t\t\tvar dir  = wy/-40;\n\t\t\tif (typeof wy == \"undefined\")\n\t\t\t\tdir = e.detail;\n\n\t\t\tvar oldTop = this._oldTop;\n\t\t\tvar top = this.$scroll_ver.scrollTop+dir*30;\n\n\t\t\t//if(!this.$gantt.config.prevent_default_scroll &&\n\t\t\t//\t(this.$gantt._cached_scroll_pos && ((this.$gantt._cached_scroll_pos.y == top) || (this.$gantt._cached_scroll_pos.y <= 0 && top <= 0)))) return true;\n\n\n\t\t\tthis.scrollVertically(top);\n\t\t\tthis.$scroll_ver.scrollTop = top;\n\n\t\t\t// not block scroll if position hasn't changed\n\t\t\tif(oldTop == this.$scroll_ver.scrollTop){\n\t\t\t\treturn true;\n\t\t\t}\n\t\t\tthis._oldTop = this.$scroll_ver.scrollTop;\n\t\t}\n\n\t\tif (e.preventDefault)\n\t\t\te.preventDefault();\n\t\te.cancelBubble=true;\n\t\treturn false;\n\t};\n\n\treturn ScrollbarCell;\n})(Cell);\n\nexport default ScrollbarCell;","import quickPositionHelperFactory from \"./row_position_fixed_height\";\n\nfunction createMixin(view){\n\tvar getItemTopCache = {};\n\tvar getRowTopCache = {};\n\tvar getItemHeightCache = null;\n\tvar totalHeightCache = -1;\n\tvar getItemHeightCacheState = null;\n\n\tvar quickPosition = quickPositionHelperFactory(view);\n\n\treturn {\n\t\t_resetTopPositionHeight: function(){\n\t\t\tgetItemTopCache = {};\n\t\t\tgetRowTopCache = {};\n\t\t\tquickPosition.resetCache();\n\t\t},\n\t\t_resetHeight: function(){\n\t\t\tvar store = this.$config.rowStore;\n\t\t\tvar newState = this.getCacheStateTotalHeight(store);\n\t\t\tif(!getItemHeightCacheState){\n\t\t\t\tgetItemHeightCacheState = newState;\n\t\t\t}else if(this.shouldClearHeightCache(getItemHeightCacheState, newState)){\n\t\t\t\tgetItemHeightCacheState = newState;\n\t\t\t\tgetItemHeightCache = null;\n\t\t\t}\n\n\t\t\ttotalHeightCache = -1;\n\t\t\tquickPosition.resetCache();\n\t\t},\n\n\t\t/**\n\t\t * Get top coordinate by row index (order)\n\t\t * @param {number} index\n\t\t */\n\t\tgetRowTop: function(index){\n\t\t\tif(quickPosition.canUseSimpleCalculation()){\n\t\t\t\treturn quickPosition.getRowTop(index);\n\t\t\t}\n\n\t\t\tvar store = this.$config.rowStore;\n\t\t\tif(!store){\n\t\t\t\treturn 0;\n\t\t\t}\n\t\t\tif(getRowTopCache[index] !== undefined){\n\t\t\t\treturn getRowTopCache[index];\n\t\t\t}else {\n\t\t\t\tvar all = store.getIndexRange();\n\t\t\t\tvar top = 0;\n\t\t\t\tvar result = 0;\n\t\t\t\tfor(var i = 0; i < all.length; i++){\n\t\t\t\t\tgetRowTopCache[i] = top;\n\t\t\t\t\ttop += this.getItemHeight(all[i].id);\n\t\t\t\t\tif(i < index){\n\t\t\t\t\t\tresult = top;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\treturn result;\n\t\t\t}\n\t\t},\n\n\t\t/**\n\t\t * Get top coordinate by item id\n\t\t * @param {*} task_id\n\t\t */\n\t\tgetItemTop: function (taskId) {\n\t\t\tif(this.$config.rowStore){\n\t\t\t\tif(getItemTopCache[taskId] !== undefined){\n\t\t\t\t\treturn getItemTopCache[taskId];\n\t\t\t\t}\n\t\t\t\tvar store = this.$config.rowStore;\n\t\t\t\tif(!store) return 0;\n\n\t\t\t\tvar itemIndex = store.getIndexById(taskId);\n\n\t\t\t\tif (itemIndex === -1 && store.getParent && store.exists(taskId)) {\n\t\t\t\t\tvar parentId = store.getParent(taskId);\n\t\t\t\t\tif (store.exists(parentId)) {\n\t\t\t\t\t\t// if task is not found in list - maybe it's parent is a split task and we should use parents index instead\n\t\t\t\t\t\tvar parent = store.getItem(parentId);\n\t\t\t\t\t\tif (this.$gantt.isSplitTask(parent)) {\n\t\t\t\t\t\t\treturn this.getItemTop(parentId);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tgetItemTopCache[taskId] = this.getRowTop(itemIndex);\n\t\t\t\treturn getItemTopCache[taskId];\n\t\t\t}else{\n\t\t\t\treturn 0;\n\t\t\t}\n\n\t\t},\n\n\t\t/**\n\t\t * Get height of the item by item id\n\t\t * @param {*} itemId\n\t\t */\n\t\tgetItemHeight: function (itemId) {\n\t\t\tif(quickPosition.canUseSimpleCalculation()){\n\t\t\t\treturn quickPosition.getItemHeight(itemId);\n\t\t\t}\n\n\t\t\tif(!getItemHeightCache && this.$config.rowStore){\n\t\t\t\tthis._fillHeightCache(this.$config.rowStore);\n\t\t\t}\n\n\t\t\tif(getItemHeightCache[itemId] !== undefined){\n\t\t\t\treturn getItemHeightCache[itemId];\n\t\t\t}\n\n\t\t\tvar defaultHeight = this.$getConfig().row_height;\n\n\t\t\tif(this.$config.rowStore){\n\t\t\t\tvar store = this.$config.rowStore;\n\t\t\t\tif(!store) return defaultHeight;\n\n\t\t\t\tvar item = store.getItem(itemId);\n\n\t\t\t\treturn getItemHeightCache[itemId] = item && item.row_height || defaultHeight;\n\t\t\t}else{\n\t\t\t\treturn defaultHeight;\n\t\t\t}\n\t\t},\n\n\t\t_fillHeightCache: function(store){\n\t\t\tif(!store){\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tgetItemHeightCache = {};\n\t\t\tvar defaultHeight = this.$getConfig().row_height;\n\t\t\tstore.eachItem(function(item){\n\t\t\t\treturn getItemHeightCache[item.id] = item && item.row_height || defaultHeight;\n\t\t\t});\n\t\t},\n\n\t\tgetCacheStateTotalHeight: function(store){\n\n\t\t\tvar globalHeight = this.$getConfig().row_height;\n\t\t\tvar itemHeightCache = {};\n\t\t\tvar items = [];\n\t\t\tvar sumHeight = 0;\n\t\t\tif(store){\n\t\t\t\tstore.eachItem(function(item){\n\t\t\t\t\titems.push(item);\n\t\t\t\t\titemHeightCache[item.id] = item.row_height;\n\t\t\t\t\tsumHeight += item.row_height || globalHeight;\n\t\t\t\t});\n\t\t\t}\n\n\n\t\t\treturn {\n\t\t\t\tglobalHeight: globalHeight,\n\t\t\t\titems: items,\n\t\t\t\tcount: items.length,\n\t\t\t\tsumHeight: sumHeight\n\t\t\t};\n\t\t},\n\t\tshouldClearHeightCache: function(oldState, newState){\n\n\t\t\tif(oldState.count != newState.count){\n\t\t\t\treturn true;\n\t\t\t}\n\t\t\tif(oldState.globalHeight != newState.globalHeight){\n\t\t\t\treturn true;\n\t\t\t}\n\n\t\t\tif(oldState.sumHeight != newState.sumHeight){\n\t\t\t\treturn true;\n\t\t\t}\n\n\t\t\tfor(var i in oldState.items){\n\t\t\t\tvar newValue = newState.items[i];\n\t\t\t\tif(newValue !== undefined && newValue != oldState.items[i]){\n\t\t\t\t\treturn true;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn false;\n\t\t},\n\t\t/**\n\t\t * Get total height of items\n\t\t */\n\t\tgetTotalHeight: function () {\n\t\t\tif(quickPosition.canUseSimpleCalculation()){\n\t\t\t\treturn quickPosition.getTotalHeight();\n\t\t\t}\n\n\t\t\tif(totalHeightCache != -1){\n\t\t\t\treturn totalHeightCache;\n\t\t\t}\n\n\t\t\tif(this.$config.rowStore){\n\t\t\t\tvar store = this.$config.rowStore;\n\t\t\t\tthis._fillHeightCache(store);\n\t\t\t\tvar getHeight = this.getItemHeight.bind(this);\n\t\t\t\tvar visibleItems = store.getVisibleItems();\n\t\t\t\tvar totalHeight = 0;\n\n\t\t\t\tvisibleItems.forEach(function(item){\n\t\t\t\t\ttotalHeight += getHeight(item.id);\n\t\t\t\t});\n\n\t\t\t\ttotalHeightCache = totalHeight;\n\t\t\t\treturn totalHeight;\n\t\t\t}else{\n\t\t\t\treturn 0;\n\t\t\t}\n\t\t},\n\n\t\t/**\n\t\t * Get item by top position\n\t\t * @param {*} top\n\t\t */\n\t\tgetItemIndexByTopPosition: function (top) {\n\t\t\tif(this.$config.rowStore){\n\t\t\t\tif(quickPosition.canUseSimpleCalculation()){\n\t\t\t\t\treturn quickPosition.getItemIndexByTopPosition(top);\n\t\t\t\t}\n\n\t\t\t\tvar store = this.$config.rowStore;\n\t\t\t\tfor(var i = 0; i < store.countVisible(); i++){\n\t\t\t\t\tvar current = this.getRowTop(i);\n\t\t\t\t\tvar next = this.getRowTop(i+1);\n\t\t\t\t\tif(!next){\n\t\t\t\t\t\tvar taskId = store.getIdByIndex(i);\n\t\t\t\t\t\tnext = current + this.getItemHeight(taskId);\n\t\t\t\t\t}\n\t\t\t\t\tif(top >= current && top < next){\n\t\t\t\t\t\treturn i;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\t// GS-1723: If we iterated all tasks and didn't find the position, the target is below all other tasks\n\t\t\t\treturn store.countVisible() + 2;\n\t\t\t}else{\n\t\t\t\treturn 0;\n\t\t\t}\n\t\t}\n\t};\n}\n\nexport default createMixin;","function createHelper(view){\n\tvar cachedRowHeight = -1;\n\tvar canUseSimpleCalc = -1;\n\treturn {\n\t\tresetCache: function(){\n\t\t\tcachedRowHeight = -1;\n\t\t\tcanUseSimpleCalc = -1;\n\t\t},\n\t\t_getRowHeight: function(){\n\t\t\tif(cachedRowHeight === -1){\n\t\t\t\tcachedRowHeight = view.$getConfig().row_height;\n\t\t\t}\n\t\t\treturn cachedRowHeight;\n\t\t},\n\t\t_refreshState: function(){\n\t\t\tthis.resetCache();\n\t\t\tcanUseSimpleCalc = true;\n\t\t\tvar store = view.$config.rowStore;\n\t\t\tif(!store){\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tvar globalRowHeight = this._getRowHeight();\n\t\t\tfor (var i=0; i<store.fullOrder.length; i++) {\n\t\t\t\tvar item = store.getItem(store.fullOrder[i]);\n\t\t\t\t// GS-1491: ignore the task when it is filtered:\n\t\t\t\tif (!item) {\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\t\t\t\tif(item.row_height && item.row_height !== globalRowHeight){\n\t\t\t\t\tcanUseSimpleCalc = false;\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\n\n\t\t},\n\t\tcanUseSimpleCalculation: function(){\n\t\t\tif(canUseSimpleCalc === -1){\n\t\t\t\tthis._refreshState();\n\t\t\t}\n\t\t\treturn canUseSimpleCalc;\n\t\t},\n\n\t\t/**\n\t\t * Get top coordinate by row index (order)\n\t\t * @param {number} index\n\t\t */\n\t\tgetRowTop: function(index){\n\t\t\tvar store = view.$config.rowStore;\n\t\t\tif(!store){\n\t\t\t\treturn 0;\n\t\t\t}\n\t\t\treturn index * this._getRowHeight();\n\t\t},\n\n\t\t/**\n\t\t * Get height of the item by item id\n\t\t * @param {*} itemId\n\t\t */\n\t\tgetItemHeight: function (itemId) {\n\t\t\treturn this._getRowHeight();\n\t\t},\n\n\t\t/**\n\t\t * Get total height of items\n\t\t */\n\t\tgetTotalHeight: function () {\n\t\t\tif(view.$config.rowStore){\n\t\t\t\tvar store = view.$config.rowStore;\n\t\t\t\treturn store.countVisible() * this._getRowHeight();\n\t\t\t}else{\n\t\t\t\treturn 0;\n\t\t\t}\n\t\t},\n\n\t\t/**\n\t\t * Get item by top position\n\t\t * @param {*} top\n\t\t */\n\t\tgetItemIndexByTopPosition: function (top) {\n\t\t\tif(view.$config.rowStore){\n\t\t\t\treturn Math.floor(top / this._getRowHeight());\n\t\t\t}else{\n\t\t\t\treturn 0;\n\t\t\t}\n\t\t}\n\t};\n}\n\nexport default createHelper;","var createStaticBgHelper = function(){\n\treturn {\n\t\trender: function () { },\n\t\tdestroy: function () { }\n\t};\n};\n\nexport default {\n\tcreate: function(){\n\t\treturn createStaticBgHelper();\n\t}\n};\n\n","import ScaleHelper from \"./scales_ignore\";\nimport eventable from \"../../../utils/eventable\";\nimport * as utils from \"../../../utils/utils\";\nimport * as helpers from \"../../../utils/helpers\";\nimport topPositionMixin from \"../row_position_mixin\";\nimport canvasRender from \"./tasks_canvas_render\";\nimport createLayerConfig from \"./timeline_layers\";\n\nvar Timeline = function(parent, config, factory, gantt){\n\tthis.$config = utils.mixin({}, config || {});\n\tthis.$scaleHelper = new ScaleHelper(gantt);\n\tthis.$gantt = gantt;\n\tthis._posFromDateCache = {};\n\tthis._timelineDragScroll = null;\n\tutils.mixin(this, topPositionMixin(this));\n\teventable(this);\n};\n\nTimeline.prototype = {\n\tinit: function(container) {\n\t\tcontainer.innerHTML += \"<div class='gantt_task' style='width:inherit;height:inherit;'></div>\";\n\t\tthis.$task = container.childNodes[0];\n\n\t\tthis.$task.innerHTML = \"<div class='gantt_task_scale'></div><div class='gantt_data_area'></div>\";\n\t\tthis.$task_scale = this.$task.childNodes[0];\n\n\t\tthis.$task_data = this.$task.childNodes[1];\n\t\tconst taskBg = \"<div class='gantt_task_bg'></div>\";\n\t\tconst links = \"<div class='gantt_links_area'></div>\";\n\t\tconst taskBars = \"<div class='gantt_bars_area'></div>\";\n\n\t\tconst taskConstraints = \"<div class='gantt_task_constraints'></div>\";\n\t\tconst taskDeadlines = \"<div class='gantt_task_deadlines'></div>\";\n\t\tconst taskBaselines = \"<div class='gantt_task_baselines'></div>\";\n\n\t\tthis.$task_data.innerHTML = taskBg + taskBaselines + links + taskBars + taskConstraints + taskDeadlines;\n\n\t\tthis.$task_bg = this.$task_data.childNodes[0];\n\t\tthis.$task_baselines = this.$task_data.childNodes[1];\n\t\tthis.$task_links = this.$task_data.childNodes[2];\n\t\tthis.$task_bars = this.$task_data.childNodes[3];\n\t\tthis.$task_constraints = this.$task_data.childNodes[4];\n\t\tthis.$task_deadlines = this.$task_data.childNodes[5];\n\n\t\tthis._tasks = {\n\t\t\tcol_width: 0,\n\t\t\twidth: [], // width of each column\n\t\t\tfull_width: 0, // width of all columns\n\t\t\ttrace_x: [],\n\t\t\trendered: {}\n\t\t};\n\n\t\tvar config = this.$getConfig();\n\t\tvar attr = config[this.$config.bind + \"_attribute\"];\n\t\tvar linksAttr = config[this.$config.bindLinks + \"_attribute\"];\n\t\tif(!attr && this.$config.bind){\n\t\t\tattr = \"data-\" + this.$config.bind + \"-id\";\n\t\t}\n\t\tif(!linksAttr && this.$config.bindLinks){\n\t\t\tlinksAttr = \"data-\" + this.$config.bindLinks + \"-id\";\n\t\t}\n\t\tthis.$config.item_attribute = attr || null;\n\t\tthis.$config.link_attribute = linksAttr || null;\n\n\t\tvar layers = this._createLayerConfig();\n\t\tif(!this.$config.layers){\n\t\t\tthis.$config.layers = layers.tasks;\n\t\t}\n\t\tif(!this.$config.linkLayers){\n\t\t\tthis.$config.linkLayers = layers.links;\n\t\t}\n\n\t\tthis._attachLayers(this.$gantt);\n\n\t\tthis.callEvent(\"onReady\", []);\n\t\t//this.refresh();\n\t\tif (this.$gantt.ext.dragTimeline) {\n\t\t\tthis._timelineDragScroll = this.$gantt.ext.dragTimeline.create();\n\t\t\tthis._timelineDragScroll.attach(this);\n\t\t}\n\t},\n\n\tsetSize: function(width, height){\n\t\tvar config = this.$getConfig();\n\n\t\tif(width*1 === width){\n\t\t\tthis.$config.width = width;\n\t\t}\n\t\tif(height*1 === height){\n\n\t\t\tthis.$config.height = height;\n\t\t\tvar dataHeight = Math.max(this.$config.height - config.scale_height);\n\t\t\tthis.$task_data.style.height = dataHeight + 'px';\n\t\t}\n\n\t\tthis.refresh();\n\t\tthis.$task_bg.style.backgroundImage = \"\";\n\n\t\tif(config.smart_rendering && this.$config.rowStore){\n\t\t\tthis.$task_bg.style.height = this.getTotalHeight() +\"px\";\n\t\t}else{\n\t\t\tthis.$task_bg.style.height = \"\";\n\t\t}\n\n\t\tvar scale = this._tasks;\n\t\t//timeline area layers\n\t\tvar data_els = this.$task_data.childNodes;\n\t\tfor(var i= 0, len = data_els.length; i < len; i++){\n\t\t\tvar el = data_els[i];\n\t\t\tif(el.hasAttribute(\"data-layer\") && el.style)\n\t\t\t\tel.style.width = scale.full_width + \"px\";\n\t\t}\n\t},\n\n\tisVisible: function(){\n\t\tif(this.$parent && this.$parent.$config){\n\t\t\treturn !this.$parent.$config.hidden;\n\t\t}else{\n\t\t\treturn this.$task.offsetWidth;\n\t\t}\n\t},\n\n\tgetSize: function(){\n\t\tvar config = this.$getConfig();\n\t\tvar store = this.$config.rowStore;\n\n\t\tvar contentHeight = store ? this.getTotalHeight() : 0,\n\t\t\tcontentWidth = this.isVisible() ? this._tasks.full_width : 0;\n\n\t\treturn {\n\t\t\tx: this.isVisible() ? this.$config.width : 0,\n\t\t\ty: this.isVisible() ? this.$config.height : 0,\n\t\t\tcontentX: this.isVisible() ? contentWidth : 0,\n\t\t\tcontentY: this.isVisible() ? (config.scale_height + contentHeight) : 0,\n\t\t\tscrollHeight: this.isVisible() ? contentHeight : 0,\n\t\t\tscrollWidth: this.isVisible() ? contentWidth : 0\n\t\t};\n\t},\n\n\tscrollTo: function(left, top){\n\t\tif(!this.isVisible())\n\t\t\treturn;\n\n\t\tvar scrolled = false;\n\n\t\tthis.$config.scrollTop = this.$config.scrollTop || 0;\n\t\tthis.$config.scrollLeft = this.$config.scrollLeft || 0;\n\t\tif(top*1 === top){\n\t\t\tthis.$config.scrollTop = top;\n\t\t\tthis.$task_data.scrollTop = this.$config.scrollTop;\n\t\t\tscrolled = true;\n\t\t}\n\t\tif (left*1 === left){\n\t\t\tthis.$task.scrollLeft = left;\n\t\t\tthis.$config.scrollLeft = this.$task.scrollLeft;\n\t\t\tthis._refreshScales();\n\t\t\tscrolled = true;\n\t\t}\n\n\t\tif(scrolled){\n\t\t\tthis.callEvent(\"onScroll\", [this.$config.scrollLeft, this.$config.scrollTop]);\n\t\t}\n\t},\n\n\t_refreshScales: function _refreshScales() {\n\t\tif(!this.isVisible())\n\t\t\treturn;\n\n\t\tvar config = this.$getConfig();\n\t\tif (!config.smart_scales) return;\n\n\t\tvar viewPort = this.getViewPort();\n\n\t\tvar scales = this._scales;\n\t\tthis.$task_scale.innerHTML = this._getScaleChunkHtml(scales, viewPort.x, viewPort.x_end);\n\t},\n\n\tgetViewPort: function(){\n\t\tvar scrollLeft = this.$config.scrollLeft || 0;\n\t\tvar scrollTop = this.$config.scrollTop || 0;\n\t\tvar height = this.$config.height || 0;\n\t\tvar width = this.$config.width || 0;\n\t\treturn {\n\t\t\ty: scrollTop,\n\t\t\ty_end: scrollTop + height,\n\t\t\tx: scrollLeft,\n\t\t\tx_end: scrollLeft + width,\n\t\t\theight: height,\n\t\t\twidth: width\n\t\t};\n\t},\n\n\t_createLayerConfig: createLayerConfig,\n\n\t_attachLayers: function(gantt){\n\t\tthis._taskLayers = [];\n\t\tthis._linkLayers = [];\n\n\t\tvar self = this;\n\n\t\tvar layers = this.$gantt.$services.getService(\"layers\");\n\n\t\tif(this.$config.bind){\n\n\t\t\tthis._bindStore();\n\t\t\tvar taskRenderer = layers.getDataRender(this.$config.bind);\n\n\t\t\tif(!taskRenderer){\n\t\t\t\ttaskRenderer = layers.createDataRender({\n\t\t\t\t\tname: this.$config.bind,\n\t\t\t\t\tdefaultContainer: function(){ return self.$task_data;}\n\t\t\t\t});\n\t\t\t}\n\n\t\t\ttaskRenderer.container = function(){ return self.$task_data;};\n\n\t\t\tvar taskLayers = this.$config.layers;\n\t\t\tfor(var i = 0; taskLayers && i < taskLayers.length; i++){\n\t\t\t\tvar layer = taskLayers[i];\n\n\t\t\t\tif(typeof layer == \"string\"){\n\t\t\t\t\tlayer = this.$gantt.$ui.layers[layer]();\n\t\t\t\t}\n\n\t\t\t\tif(typeof layer == \"function\" || (layer && layer.render && layer.update)){\n\t\t\t\t\tlayer = {renderer: layer};\n\t\t\t\t}\n\n\t\t\t\tlayer.view = this;\n\n\t\t\t\tvar bar_layer = taskRenderer.addLayer(layer);\n\t\t\t\tthis._taskLayers.push(bar_layer);\n\t\t\t\tif(layer.expose){\n\t\t\t\t\tthis._taskRenderer = taskRenderer.getLayer(bar_layer);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tthis._initStaticBackgroundRender();\n\t\t}\n\n\t\tif(this.$config.bindLinks){\n\t\t\tself.$config.linkStore = self.$gantt.getDatastore(self.$config.bindLinks);\n\n\t\t\tvar linkRenderer = layers.getDataRender(this.$config.bindLinks);\n\n\t\t\tif(!linkRenderer){\n\t\t\t\tlinkRenderer = layers.createDataRender({\n\t\t\t\t\tname: this.$config.bindLinks,\n\t\t\t\t\tdefaultContainer: function(){ return self.$task_data;}\n\t\t\t\t});\n\t\t\t}\n\t\t\tvar linkLayers = this.$config.linkLayers;\n\t\t\tfor(var i = 0; linkLayers && i < linkLayers.length; i++){\n\n\t\t\t\tif(typeof layer == \"string\"){\n\t\t\t\t\tlayer = this.$gantt.$ui.layers[layer]();\n\t\t\t\t}\n\n\t\t\t\tvar layer = linkLayers[i];\n\t\t\t\tlayer.view = this;\n\t\t\t//\tlayer.getViewPort = getViewPort;\n\t\t\t//\tsubscribeSmartRender(layer);\n\t\t\t\tvar linkLayer = linkRenderer.addLayer(layer);\n\t\t\t\tthis._taskLayers.push(linkLayer);\n\t\t\t\tif(linkLayers[i].expose){\n\t\t\t\t\tthis._linkRenderer = linkRenderer.getLayer(linkLayer);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t},\n\n\t_initStaticBackgroundRender: function(){\n\t\tvar self = this;\n\t\tvar staticRender = canvasRender.create();\n\t\tvar store = self.$config.rowStore;\n\t\tif(!store) return;\n\n\t\tthis._staticBgHandler = store.attachEvent(\"onStoreUpdated\", function(id, item, mode){\n\t\t\tif(id !== null) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif(!self.isVisible())\n\t\t\t\treturn;\n\t\t\tvar config = self.$getConfig();\n\t\t\tif(config.static_background || config.timeline_placeholder) {\n\t\t\t\tvar store = self.$gantt.getDatastore(self.$config.bind);\n\t\t\t\tvar staticBgContainer = self.$task_bg_static;\n\t\t\t\tif(!staticBgContainer){\n\t\t\t\t\tstaticBgContainer = document.createElement(\"div\");\n\t\t\t\t\tstaticBgContainer.className = \"gantt_task_bg\";\n\t\t\t\t\tself.$task_bg_static = staticBgContainer;\n\t\t\t\t\tif(self.$task_bg.nextSibling){\n\t\t\t\t\t\tself.$task_data.insertBefore(staticBgContainer, self.$task_bg.nextSibling);\n\t\t\t\t\t}else{\n\t\t\t\t\t\tself.$task_data.appendChild(staticBgContainer);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tif (store) {\n\t\t\t\t\tvar staticBackgroundHeight = self.getTotalHeight();\n\t\t\t\t\tif (config.timeline_placeholder){\n\t\t\t\t\t\tstaticBackgroundHeight = config.timeline_placeholder.height || self.$task_data.offsetHeight || 99999;\n\t\t\t\t\t}\n\t\t\t\t\tstaticRender.render(staticBgContainer, config, self.getScale(), staticBackgroundHeight, self.getItemHeight(item ? item.id : null));\n\t\t\t\t}\n\t\t\t}else if(config.static_background){\n\t\t\t\tif(self.$task_bg_static && self.$task_bg_static.parentNode){\n\t\t\t\t\tself.$task_bg_static.parentNode.removeChild(self.$task_bg_static);\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t\tthis.attachEvent(\"onDestroy\", function () {\n\t\t\tstaticRender.destroy();\n\t\t});\n\t\tthis._initStaticBackgroundRender = function(){};//init once\n\t},\n\n\t_clearLayers: function(gantt){\n\t\tvar layers = this.$gantt.$services.getService(\"layers\");\n\t\tvar taskRenderer = layers.getDataRender(this.$config.bind);\n\t\tvar linkRenderer = layers.getDataRender(this.$config.bindLinks);\n\n\t\tif (this._taskLayers) {\n\t\t\tfor(var i = 0; i < this._taskLayers.length; i++){\n\t\t\t\ttaskRenderer.removeLayer(this._taskLayers[i]);\n\t\t\t}\n\t\t}\n\t\tif (this._linkLayers) {\n\t\t\tfor(var i = 0; i < this._linkLayers.length; i++){\n\t\t\t\tlinkRenderer.removeLayer(this._linkLayers[i]);\n\t\t\t}\n\t\t}\n\n\t\tthis._linkLayers = [];\n\t\tthis._taskLayers = [];\n\t},\n\n\t_render_tasks_scales: function _render_tasks_scales() {\n\t\tvar config = this.$getConfig();\n\n\t\tvar scales_html = \"\",\n\t\t\touter_width = 0,\n\t\t\tscale_height = 0;\n\n\t\tvar state = this.$gantt.getState();\n\n\t\tif (this.isVisible()) {\n\t\t\tvar helpers = this.$scaleHelper;\n\t\t\tvar scales = this._getScales();\n\t\t\tscale_height = config.scale_height;\n\n\t\t\tvar availWidth = this.$config.width;\n\t\t\tif(config.autosize == \"x\" || config.autosize == \"xy\"){\n\t\t\t\tavailWidth = Math.max(config.autosize_min_width, 0);\n\t\t\t}\n\n\t\t\tvar cfgs = helpers.prepareConfigs(scales, config.min_column_width, availWidth, scale_height - 1, state.min_date, state.max_date, config.rtl);\n\t\t\tvar cfg = this._tasks = cfgs[cfgs.length - 1];\n\t\t\tthis._scales = cfgs;\n\t\t\tthis._posFromDateCache = {};\n\n\t\t\tscales_html = this._getScaleChunkHtml(cfgs, 0, this.$config.width);\n\n\t\t\touter_width = cfg.full_width + \"px\";//cfg.full_width + (this._scroll_sizes().y ? scrollSizes.scroll_size : 0) + \"px\";\n\t\t\tscale_height += \"px\";\n\t\t}\n\n\t\tthis.$task_scale.style.height = scale_height;\n\n\t\tthis.$task_data.style.width =\n\t\t\tthis.$task_scale.style.width = outer_width;\n\n\t\tthis.$task_scale.innerHTML = scales_html;\n\n\t},\n\n\t_getScaleChunkHtml: function _get_scale_chunk_html (scales, fromPos, toPos) {\n\t\tvar templates = this.$gantt.templates;\n\t\tvar html = [];\n\n\t\tvar css = templates.scale_row_class;\n\t\tfor (var i = 0; i < scales.length; i++) {\n\t\t\tvar cssClass = \"gantt_scale_line\";\n\t\t\tvar tplClass = css(scales[i]);\n\t\t\tif (tplClass) {\n\t\t\t\tcssClass += \" \" + tplClass;\n\t\t\t}\n\n\t\t\thtml.push(\"<div class=\\\"\" + cssClass + \"\\\" style=\\\"height:\" + (scales[i].height) +\n\t\t\t\t\"px;position:relative;line-height:\" + (scales[i].height) + \"px\\\">\" + this._prepareScaleHtml(scales[i], fromPos, toPos, i) + \"</div>\");\n\t\t}\n\n\t\treturn html.join(\"\");\n\t},\n\t_prepareScaleHtml: function _prepare_scale_html(config, fromPos, toPos, index) {\n\t\tvar globalConfig = this.$getConfig();\n\t\tvar globalTemplates = this.$gantt.templates;\n\n\t\tvar cells = [];\n\t\tvar date = null, css = null;\n\n\t\tvar content = config.format || config.template || config.date;\n\n\t\tif(typeof content === \"string\"){\n\t\t\tcontent = this.$gantt.date.date_to_str(content);\n\t\t}\n\n\t\tvar startIndex = 0,\n\t\t\tendIndex = config.count;\n\n\t\tif (globalConfig.smart_scales && (!isNaN(fromPos) && !isNaN(toPos))) {\n\t\t\tstartIndex = helpers.findBinary(config.left, fromPos);\n\t\t\tendIndex = helpers.findBinary(config.left, toPos) + 1;\n\t\t}\n\n\t\tcss = config.css || function () {\n\t\t\t};\n\t\tif (!config.css && globalConfig.inherit_scale_class) {\n\t\t\tcss = globalTemplates.scale_cell_class;\n\t\t}\n\n\t\tfor (var i = startIndex; i < endIndex; i++) {\n\t\t\tif (!config.trace_x[i]) break;\n\n\t\t\tdate = new Date(config.trace_x[i]);\n\t\t\tvar value = content.call(this, date),\n\t\t\t\twidth = config.width[i],\n\t\t\t\theight = config.height,\n\t\t\t\tleft = config.left[i],\n\t\t\t\tstyle = \"\",\n\t\t\t\ttemplate = \"\",\n\t\t\t\tcssclass = \"\";\n\n\t\t\tif (width) {\n\t\t\t\tvar position = globalConfig.smart_scales ? (\"position:absolute;left:\" + left + \"px\") : \"\";\n\n\t\t\t\tstyle = \"width:\" + (width) + \"px;\" + position;\n\t\t\t\t// GS-1188: Display the scale value in the viewport for long cells\n\t\t\t\tconst viewPort = this.getViewPort();\n\t\t\t\tconst floatConfig = (globalConfig.scales[index] || {}).sticky; // for old scale settings\n\n\t\t\t\tlet labelPosition = '';\n\t\t\t\tconst approxLabelWidth = 70;\n\t\t\t\t// if sticky config is not specified - sticky labels are enabled for long cells only\n\t\t\t\tif ((floatConfig !== false && width > approxLabelWidth) || floatConfig === true) {\n\t\t\t\t\t\n\t\t\t\t\tif (left < viewPort.x && left + width/2 - approxLabelWidth/2 < viewPort.x){\n\t\t\t\t\t\tlabelPosition = ` style='position:absolute;left: ${viewPort.x  - left + 10}px;' `;\n\t\t\t\t\t} else if(left + width/2 + approxLabelWidth/2 > viewPort.x_end && width > approxLabelWidth){\n\t\t\t\t\t\tlet labelPos = viewPort.x_end - left - 10;\n\t\t\t\t\t\tlet translateValue = \"-100%\";\n\t\t\t\t\t\tif(labelPos < approxLabelWidth) {\n\t\t\t\t\t\t\tlabelPos = approxLabelWidth;\n\t\t\t\t\t\t\ttranslateValue = `-${labelPos}px`;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tlabelPosition = ` style='position:absolute;left: ${labelPos}px;transform: translate(${translateValue},0);' `;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tcssclass = \"gantt_scale_cell\" + (i == config.count - 1 ? \" gantt_last_cell\" : \"\");\n\n\t\t\t\ttemplate = css.call(this, date);\n\t\t\t\tif (template) cssclass += \" \" + template;\n\n\t\t\t\tvar ariaAttr = this.$gantt._waiAria.getTimelineCellAttr(value);\n\t\t\t\tvar cell = `<div class='${cssclass}' ${ariaAttr} style='${style}'><span ${labelPosition}>${value}</span></div>`;\n\t\t\t\tcells.push(cell);\n\t\t\t} else {\n\t\t\t\t//do not render ignored cells\n\t\t\t}\n\n\t\t}\n\t\treturn cells.join(\"\");\n\t},\n\tdateFromPos: function dateFromPos(x) {\n\t\tvar scale = this._tasks;\n\t\tif (x < 0 || x > scale.full_width || !scale.full_width) {\n\t\t\treturn null;\n\t\t}\n\n\t\tvar ind = helpers.findBinary(this._tasks.left, x);\n\t\tvar summ = this._tasks.left[ind];\n\n\t\tvar col_width = scale.width[ind] || scale.col_width;\n\t\tvar part = 0;\n\t\tif (col_width) {\n\t\t\tpart = (x - summ) / col_width;\n\t\t\tif(scale.rtl){\n\t\t\t\tpart = 1 - part;\n\t\t\t}\n\n\t\t}\n\n\t\tvar unit = 0;\n\t\tif (part) {\n\t\t\tunit = this._getColumnDuration(scale, scale.trace_x[ind]);\n\t\t}\n\n\t\tvar date = new Date(scale.trace_x[ind].valueOf() + Math.round(part * unit));\n\t\treturn date;\n\t},\n\tposFromDate: function posFromDate(date) {\n\t\tif (!this.isVisible())\n\t\t\treturn 0;\n\n\t\tif(!date){\n\t\t\treturn 0;\n\t\t}\n\n\t\tvar dateValue = String(date.valueOf());\n\n\t\tif(this._posFromDateCache[dateValue] !== undefined){\n\t\t\treturn this._posFromDateCache[dateValue];\n\t\t}\n\t\tvar ind = this.columnIndexByDate(date);\n\t\tthis.$gantt.assert(ind >= 0, \"Invalid day index\");\n\n\t\tvar wholeCells = Math.floor(ind);\n\t\tvar partCell = ind % 1;\n\n\t\tvar pos = this._tasks.left[Math.min(wholeCells, this._tasks.width.length - 1)];\n\t\tif (wholeCells == this._tasks.width.length)\n\t\t\tpos += this._tasks.width[this._tasks.width.length - 1];\n\t\t//for(var i=1; i <= wholeCells; i++)\n\t\t//\tpos += gantt._tasks.width[i-1];\n\n\t\tif (partCell) {\n\t\t\tif (wholeCells < this._tasks.width.length) {\n\t\t\t\tpos += this._tasks.width[wholeCells] * (partCell % 1);\n\t\t\t} else {\n\t\t\t\tpos += 1;\n\t\t\t}\n\n\t\t}\n\n\t\tvar roundPos = Math.round(pos);\n\t\tthis._posFromDateCache[dateValue] = roundPos;\n\t\treturn Math.round(roundPos);\n\t},\n\n\t_getNextVisibleColumn: function (startIndex, columns, ignores) {\n\t\t// iterate columns to the right\n\t\tvar date = +columns[startIndex];\n\t\tvar visibleDateIndex = startIndex;\n\t\twhile (ignores[date]) {\n\t\t\tvisibleDateIndex++;\n\t\t\tdate = +columns[visibleDateIndex];\n\t\t}\n\n\t\treturn visibleDateIndex;\n\t},\n\t_getPrevVisibleColumn: function (startIndex, columns, ignores) {\n\t\t// iterate columns to the left\n\t\tvar date = +columns[startIndex];\n\t\tvar visibleDateIndex = startIndex;\n\t\twhile (ignores[date]) {\n\t\t\tvisibleDateIndex--;\n\t\t\tdate = +columns[visibleDateIndex];\n\t\t}\n\t\treturn visibleDateIndex;\n\t},\n\t_getClosestVisibleColumn: function (startIndex, columns, ignores) {\n\t\tvar visibleDateIndex = this._getNextVisibleColumn(startIndex, columns, ignores);\n\t\tif (!columns[visibleDateIndex]) {\n\t\t\tvisibleDateIndex =  this._getPrevVisibleColumn(startIndex, columns, ignores);\n\t\t}\n\t\treturn visibleDateIndex;\n\t},\n\tcolumnIndexByDate: function columnIndexByDate(date) {\n\t\tvar pos = new Date(date).valueOf();\n\t\tvar days = this._tasks.trace_x_ascending,\n\t\t\tignores = this._tasks.ignore_x;\n\n\t\tvar state = this.$gantt.getState();\n\n\t\tif (pos <= state.min_date) {\n\t\t\tif(this._tasks.rtl){\n\t\t\t\treturn days.length;\n\t\t\t}else{\n\t\t\t\treturn 0;\n\t\t\t}\n\n\t\t}\n\n\t\tif (pos >= state.max_date) {\n\t\t\tif(this._tasks.rtl){\n\t\t\t\treturn 0;\n\t\t\t}else{\n\t\t\t\treturn days.length;\n\t\t\t}\n\t\t}\n\n\t\tvar dateIndex = helpers.findBinary(days, pos);\n\n\t\tvar visibleIndex = this._getClosestVisibleColumn(dateIndex, days, ignores);\n\t\tvar visibleDate = days[visibleIndex];\n\t\tvar transition = this._tasks.trace_index_transition;\n\n\t\tif(!visibleDate){\n\t\t\tif(transition){\n\t\t\t\treturn transition[0];\n\t\t\t}else{\n\t\t\t\treturn 0;\n\t\t\t}\n\t\t}\n\n\t\tvar part = ((date - days[visibleIndex]) / this._getColumnDuration(this._tasks, days[visibleIndex]));\n\t\tif(transition){\n\t\t\treturn transition[visibleIndex] + (1 - part);\n\t\t}else{\n\t\t\treturn visibleIndex + part;\n\t\t}\n\t},\n\tgetItemPosition:function (task, start_date, end_date) {\n\t\tvar xLeft, xRight, width;\n\n\t\tlet displayStart = start_date || task.start_date || task.$auto_start_date;\n\t\tlet displayEnd = end_date || task.end_date || task.$auto_end_date;\n\t\tif(this._tasks.rtl){\n\t\t\txRight = this.posFromDate(displayStart);\n\t\t\txLeft = this.posFromDate(displayEnd);\n\t\t}else{\n\t\t\txLeft = this.posFromDate(displayStart);\n\t\t\txRight = this.posFromDate(displayEnd);\n\t\t}\n\t\twidth =  Math.max((xRight - xLeft), 0);\n\n\t\tvar y = this.getItemTop(task.id);\n\n\t\tvar height = this.getBarHeight(task.id);\n\t\tvar rowHeight = this.getItemHeight(task.id);\n\t\treturn {\n\t\t\tleft: xLeft,\n\t\t\ttop: y,\n\t\t\theight: height,\n\t\t\twidth: width,\n\t\t\trowHeight: rowHeight\n\t\t};\n\t},\n\n\tgetBarHeight: function(taskId, isMilestoneRender){\n\t\tvar config = this.$getConfig();\n\n\t\tvar task = this.$config.rowStore.getItem(taskId);\n\t\t// height of the bar item\n\t\tvar height = task.task_height || task.bar_height || config.bar_height || config.task_height;\n\t\tvar rowHeight = this.getItemHeight(taskId);\n\n\t\tif (height == \"full\") {\n\t\t\tvar offset = config.bar_height_padding || 3;\n\t\t\theight = rowHeight - offset;\n\t\t}\n\t\t//item height cannot be bigger than row height\n\t\theight = Math.min(height, rowHeight);\n\t\tif (isMilestoneRender) { // to get correct height for addapting Milestone to the row\n\t\t\theight = Math.round(height / Math.sqrt(2));\n\t\t}\n\t\treturn Math.max(height, 0);\n\t},\n\n\tgetScale: function(){\n\t\treturn this._tasks;\n\t},\n\n\t_getScales: function _get_scales() {\n\t\tvar config = this.$getConfig();\n\t\tvar helpers = this.$scaleHelper;\n\t\tvar scales = [helpers.primaryScale(config)].concat(helpers.getSubScales(config));\n\n\t\thelpers.sortScales(scales);\n\t\treturn scales;\n\t},\n\n\t_getColumnDuration: function _get_coll_duration(scale, date) {\n\t\treturn this.$gantt.date.add(date, scale.step, scale.unit) - date;\n\t},\n\t_bindStore: function () {\n\t\tif (this.$config.bind){\n\t\t\tvar rowStore = this.$gantt.getDatastore(this.$config.bind);\n\t\t\tthis.$config.rowStore = rowStore;\n\t\t\tif(rowStore && !rowStore._timelineCacheAttached){\n\t\t\t\tvar self = this;\n\t\t\t\trowStore._timelineCacheAttached = rowStore.attachEvent(\"onBeforeFilter\", function(){\n\t\t\t\t\tself._resetTopPositionHeight();\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t},\n\t_unbindStore: function(){\n\t\tif (this.$config.bind){\n\t\t\tvar rowStore = this.$gantt.getDatastore(this.$config.bind);\n\t\t\tif(rowStore && rowStore._timelineCacheAttached){\n\t\t\t\trowStore.detachEvent(rowStore._timelineCacheAttached);\n\t\t\t\trowStore._timelineCacheAttached = false;\n\t\t\t}\n\t\t}\n\t},\n\trefresh: function(){\n\t\tthis._bindStore();\n\n\t\tif(this.$config.bindLinks) {\n\t\t\tthis.$config.linkStore = this.$gantt.getDatastore(this.$config.bindLinks);\n\t\t}\n\n\t\tthis._resetTopPositionHeight();\n\t\tthis._resetHeight();\n\t\tthis._initStaticBackgroundRender();\n\t\tthis._render_tasks_scales();\n\t},\n\n\tdestructor: function(){\n\t\tvar gantt = this.$gantt;\n\t\tthis._clearLayers(gantt);\n\t\tthis._unbindStore();\n\t\tthis.$task = null;\n\t\tthis.$task_scale = null;\n\t\tthis.$task_data = null;\n\t\tthis.$task_bg = null;\n\t\tthis.$task_links = null;\n\t\tthis.$task_bars = null;\n\n\t\tthis.$gantt = null;\n\n\t\tif(this.$config.rowStore){\n\t\t\tthis.$config.rowStore.detachEvent(this._staticBgHandler);\n\t\t\tthis.$config.rowStore = null;\n\t\t}\n\t\tif(this.$config.linkStore){\n\t\t\tthis.$config.linkStore = null;\n\t\t}\n\n\t\tif(this._timelineDragScroll) {\n\t\t\tthis._timelineDragScroll.destructor();\n\t\t\tthis._timelineDragScroll = null;\n\t\t}\n\n\t\tthis.callEvent(\"onDestroy\", []);\n\t\tthis.detachAllEvents();\n\n\t}\n};\n\nexport default Timeline;","\nexport default function(){\n\tvar self = this;\n\tvar taskFilter = function(){\n\t\treturn self.isVisible();\n\t};\n\n\tvar barVisible = function(id, task){\n\t\treturn !task.hide_bar;\n\t};\n\n\tconst gantt = this.$gantt;\n\n\tvar taskLayers = [\n\t\t{\n\t\t\texpose: true,\n\t\t\trenderer: this.$gantt.$ui.layers.taskBar(),\n\t\t\tcontainer: this.$task_bars,\n\t\t\tfilter: [taskFilter, barVisible]\n\t\t}\n\t];\n\n\ttaskLayers.push({\n\t\trenderer: this.$gantt.$ui.layers.taskBg(),\n\t\tcontainer: this.$task_bg,\n\t\tfilter: [\n\t\t\t//function(){\n\t\t\t//\treturn !self.$getConfig().static_background;\n\t\t\t//},\n\t\t\ttaskFilter\n\t\t]\n\t});\n\n\tvar linkLayers = [\n\t\t{\n\t\t\texpose: true,\n\t\t\trenderer: this.$gantt.$ui.layers.link(),\n\t\t\tcontainer: this.$task_links,\n\t\t\tfilter: [taskFilter]\n\t\t}\n\t];\n\n\treturn {\n\t\ttasks: taskLayers,\n\t\tlinks: linkLayers\n\t};\n\n};","const SENSITIVITY = 20;\nconst TIMEOUT = 50;\nconst SCROLLSTEP = 10;\n\nexport default class ScrollableGrid {\n\tpublic getCurrentX;\n\tprivate $gantt;\n\tprivate $grid;\n\tprivate _dnd;\n\tprivate _scrollView;\n\tprivate _scrollOrder: 0 | 1 | -1 = 0;\n\n\tconstructor(params) {\n\t\tconst {gantt, grid, dnd, getCurrentX} = params;\n\t\tthis.$gantt = gantt;\n\t\tthis.$grid = grid;\n\t\tthis._dnd = dnd;\n\t\tthis.getCurrentX = getCurrentX;\n\t\tthis._scrollView = this.$gantt.$ui.getView(this.$grid.$config.scrollX);\n\t\tthis.attachEvents();\n\t}\n\tattachEvents() {\n\t\tif (this.isScrollable()) {\n\t\t\tthis._dnd.attachEvent(\"onDragMove\", (obj, e) => {\n\t\t\t\tconst gridBoundingRect = this.$grid.$grid.getBoundingClientRect();\n\t\t\t\tconst maxLeft = gridBoundingRect.right;\n\t\t\t\tconst minLeft = gridBoundingRect.left;\n\t\t\t\tconst currentX = this.getCurrentX(e.clientX);\n\n\t\t\t\tif (currentX >= maxLeft - SENSITIVITY) {\n\t\t\t\t\tthis.autoscrollRight();\n\t\t\t\t\tthis.autoscrollStart();\n\t\t\t\t}\n\t\t\t\tif (currentX <= minLeft + SENSITIVITY) {\n\t\t\t\t\tthis.autoscrollLeft();\n\t\t\t\t\tthis.autoscrollStart();\n\t\t\t\t}\n\t\t\t\tif (currentX < maxLeft - SENSITIVITY && currentX > minLeft + SENSITIVITY) {\n\t\t\t\t\tthis.autoscrollStop();\n\t\t\t\t}\n\t\t\t\treturn true;\n\t\t\t});\n\t\t\tthis._dnd.attachEvent(\"onDragEnd\", () => {\n\t\t\t\tthis.autoscrollStop();\n\t\t\t});\n\t\t}\n\t}\n\tautoscrollStart() {\n\t\tif (this._scrollOrder === 0) {\n\t\t\treturn;\n\t\t}\n\t\tconst scrollStep = SCROLLSTEP * this._scrollOrder;\n\t\tconst scrollState = this._scrollView.getScrollState();\n\t\tthis._scrollView.scrollTo(scrollState.position + scrollStep);\n\t\tsetTimeout(() => { this.autoscrollStart(); }, TIMEOUT);\n\t}\n\tautoscrollRight() {\n\t\tthis._scrollOrder = 1;\n\t}\n\tautoscrollLeft() {\n\t\tthis._scrollOrder = -1;\n\t}\n\tautoscrollStop() {\n\t\tthis._scrollOrder = 0;\n\t}\n\tgetCorrection() {\n\t\tif (!this.isScrollable()) {\n\t\t\treturn 0;\n\t\t}\n\t\treturn this._scrollView.getScrollState().position;\n\t}\n\tisScrollable() {\n\t\treturn !!this.$grid.$config.scrollable;\n\t}\n}","import * as domHelpers from \"../../utils/dom_helpers\";\nimport ScrollableGrid from \"./scrollable_grid\";\n\nconst COLUMN_ID_ATTR_NAME = \"data-column-id\";\n\nexport class ColumnsGridDnd {\n\tprivate $gantt;\n\tprivate $grid;\n\tprivate _dragX;\n\tprivate _dnd;\n\tprivate _originAutoscroll;\n\tprivate _scrollableGrid: ScrollableGrid;\n\tprivate _draggedCell;\n\tprivate _targetMarker = null;\n\tprivate _gridConfig;\n\tconstructor(gantt, grid) {\n\t\tthis.$gantt = gantt;\n\t\tthis.$grid = grid;\n\t}\n\tinit() {\n\t\tconst DND = this.$gantt.$services.getService(\"dnd\");\n\t\tthis._dnd = new DND(this.$grid.$grid_scale, { updates_per_second: 60 });\n\t\tthis._scrollableGrid = new ScrollableGrid({\n\t\t\tgantt: this.$gantt,\n\t\t\tgrid: this.$grid,\n\t\t\tdnd: this._dnd,\n\t\t\tgetCurrentX: this.calculateCurrentPosition\n\t\t});\n\t\tthis.attachEvents();\n\t}\n\tattachEvents() {\n\t\tthis._dnd.attachEvent(\"onBeforeDragStart\", (obj, e) => {\n\t\t\tthis._draggedCell = this.$gantt.utils.dom.closest(e.target, \".gantt_grid_head_cell\");\n\t\t\tif(!this._draggedCell){\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst columns = this.$grid.$getConfig().columns;\n\t\t\tconst columnName = this._draggedCell.getAttribute(COLUMN_ID_ATTR_NAME);\n\t\t\tlet draggedColumn;\n\t\t\tlet draggedIndex;\n\t\t\tcolumns.map(function(column, index){\n\t\t\t\tif(column.name === columnName){\n\t\t\t\t\tdraggedColumn = column;\n\t\t\t\t\tdraggedIndex = index;\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tif (this.$grid.callEvent(\"onBeforeColumnDragStart\", [{ draggedColumn, draggedIndex}]) === false) {\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tif (!this._draggedCell || !draggedColumn) {\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tthis._gridConfig = this.$grid.$getConfig();\n\t\t\tthis._originAutoscroll = this.$gantt.config.autoscroll;\n\t\t\tthis.$gantt.config.autoscroll = false;\n\t\t\treturn true;\n\t\t});\n\n\t\tthis._dnd.attachEvent(\"onAfterDragStart\", (obj, e) => {\n\t\t\tif (!this._draggedCell) {\n\t\t\t\treturn; // GS-1333: don't try to reorder a column when we resize it\n\t\t\t}\n\t\t\tthis._dnd.config.column = this._draggedCell.getAttribute(COLUMN_ID_ATTR_NAME);\n\t\t\tthis._dnd.config.marker.innerHTML = this._draggedCell.outerHTML;\n\t\t\tthis._dnd.config.marker.classList.add(\"gantt_column_drag_marker\");\n\t\t\tthis._dnd.config.marker.style.height = this._gridConfig.scale_height + \"px\";\n\t\t\tthis._dnd.config.marker.style.lineHeight = this._gridConfig.scale_height + \"px\";\n\t\t\tthis._draggedCell.classList.add(\"gantt_grid_head_cell_dragged\");\n\t\t});\n\n\t\tthis._dnd.attachEvent(\"onDragMove\", (obj, e) => {\n\t\t\tif(!this._draggedCell){\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis._dragX = e.clientX;\n\t\t\tconst x = this.calculateCurrentPosition(e.clientX);\n\t\t\tconst columnIndexes = this.findColumnsIndexes();\n\t\t\tconst targetIndex = columnIndexes.targetIndex;\n\t\t\tconst draggedIndex = columnIndexes.draggedIndex;\n\t\t\tconst columns = this.$grid.$getConfig().columns;\n\n\t\t\tconst draggedColumn = columns[draggedIndex];\n\t\t\tconst targetColumn = columns[targetIndex];\n\t\t\tif (this.$grid.callEvent(\"onColumnDragMove\", [{ draggedColumn, targetColumn, draggedIndex, targetIndex }]) === false) {\n\t\t\t\tthis.cleanTargetMarker();\n\t\t\t\treturn false;\n\t\t\t}\n\t\t\tthis.setMarkerPosition(x);\n\t\t\tthis.drawTargetMarker(columnIndexes);\n\t\t\treturn true;\n\t\t});\n\n\t\tthis._dnd.attachEvent(\"onDragEnd\", () => {\n\t\t\tif (!this._draggedCell) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tthis.$gantt.config.autoscroll = this._originAutoscroll;\n\t\t\tthis._draggedCell.classList.remove(\"gantt_grid_head_cell_dragged\");\n\t\t\tthis.cleanTargetMarker();\n\t\t\tthis.reorderColumns();\n\t\t});\n\n\t}\n\treorderColumns() {\n\t\tconst { targetIndex, draggedIndex } = this.findColumnsIndexes();\n\n\t\tconst columns = this.$grid.$getConfig().columns;\n\t\tconst draggedColumn = columns[draggedIndex];\n\t\tconst targetColumn = columns[targetIndex];\n\n\t\tif (this.$grid.callEvent(\"onBeforeColumnReorder\", [{ draggedColumn, targetColumn, draggedIndex, targetIndex }]) === false) {\n\t\t\treturn;\n\t\t}\n\t\tif (targetIndex === draggedIndex) {\n\t\t\treturn;\n\t\t}\n\t\tcolumns.splice(draggedIndex, 1);\n\t\tcolumns.splice(targetIndex, 0, draggedColumn);\n\t\tthis.$gantt.render();\n\t\tthis.$grid.callEvent(\"onAfterColumnReorder\", [{ draggedColumn, targetColumn, draggedIndex, targetIndex }]);\n\t}\n\tfindColumnsIndexes() {\n\t\tconst draggedId = this._dnd.config.column;\n\t\tconst columns = this.$grid.$getConfig().columns;\n\t\tlet targetIndex: number;\n\t\tlet draggedIndex: number;\n\t\tlet xBefore: number;\n\t\tlet xAfter: number;\n\t\tconst currentColumn = { startX: 0, endX: 0 };\n\n\t\tlet start = 0;\n\t\tlet end = columns.length - 1;\n\t\tlet compare = (a, b) => a <= b;\n\t\tlet next = (index) => ++index;\n\t\tif (this.$gantt.config.rtl) {\n\t\t\tstart = columns.length - 1;\n\t\t\tend = 0;\n\t\t\tcompare = (a, b) => a >= b;\n\t\t\tnext = (index) => --index;\n\t\t}\n\n\t\tlet columnRelativePos: number;\n\n\t\tconst relativeX = this._dragX - this.$grid.$grid.getBoundingClientRect().left + this._scrollableGrid.getCorrection();\n\t\tfor (let i = start; compare(i, end); i = next(i)) {\n\t\t\tif (targetIndex !== undefined && draggedIndex !== undefined) {\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tif(!columns[i].hide) {\n\t\t\t\tcurrentColumn.startX = currentColumn.endX;\n\t\t\t\tcurrentColumn.endX += columns[i].width;\n\n\t\t\t\t// if drop on a column or drop after the last column\n\t\t\t\tif (relativeX >= currentColumn.startX && (relativeX <= currentColumn.endX || !compare(next(i), end))) {\n\t\t\t\t\ttargetIndex = i;\n\t\t\t\t\txBefore = currentColumn.startX;\n\t\t\t\t\txAfter = currentColumn.endX;\n\t\t\t\t\tcolumnRelativePos = (relativeX - currentColumn.startX) / (currentColumn.endX - currentColumn.startX);\n\t\t\t\t}\n\t\t\t\tif (draggedId === columns[i].name) {\n\t\t\t\t\tdraggedIndex = i;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\treturn {\n\t\t\ttargetIndex,\n\t\t\tdraggedIndex,\n\t\t\txBefore,\n\t\t\txAfter,\n\t\t\tcolumnRelativePos\n\t\t};\n\t}\n\tsetMarkerPosition(x: number, y: number = 10) {\n\t\tconst { marker } = this._dnd.config;\n\t\tconst gridOffset = this._dnd._obj.getBoundingClientRect();\n\t\tmarker.style.top = `${gridOffset.y + y}px`;\n\t\tmarker.style.left = `${x}px`;\n\t}\n\tcalculateCurrentPosition = (eventX: number) => {\n\t\tconst gridBoundingRect = this.$grid.$grid.getBoundingClientRect();\n\t\tconst maxLeft = gridBoundingRect.right;\n\t\tconst minLeft = gridBoundingRect.left;\n\t\tlet x = eventX;\n\t\tif (x > maxLeft) {\n\t\t\tx = maxLeft;\n\t\t}\n\t\tif (x < minLeft) {\n\t\t\tx = minLeft;\n\t\t}\n\t\treturn x;\n\t};\n\tdrawTargetMarker({ targetIndex, draggedIndex, xBefore, xAfter, columnRelativePos }) {\n\t\tif (!this._targetMarker) {\n\t\t\tthis._targetMarker = document.createElement(\"div\");\n\t\t\tdomHelpers.addClassName(this._targetMarker, \"gantt_grid_target_marker\");\n\t\t\tthis._targetMarker.style.display = \"none\";\n\t\t\tthis._targetMarker.style.height = `${this._gridConfig.scale_height}px`;\n\t\t}\n\n\t\t// marker can be detached after gantt.render\n\t\tif(!this._targetMarker.parentNode){\n\t\t\tthis.$grid.$grid_scale.appendChild(this._targetMarker);\n\t\t}\n\n\t\tlet nextPosition: number;\n\t\tif (targetIndex > draggedIndex) {\n\t\t\tnextPosition = xAfter;\n\t\t} else if (targetIndex < draggedIndex) {\n\t\t\tnextPosition = xBefore;\n\t\t} else {\n\t\t\tif(columnRelativePos > 0.5){\n\t\t\t\tnextPosition = xAfter;\n\t\t\t}else{\n\t\t\t\tnextPosition = xBefore;\n\t\t\t}\n\t\t}\n\n\t\tthis._targetMarker.style.left = `${nextPosition}px`;\n\t\tthis._targetMarker.style.display = \"block\";\n\t}\n\tcleanTargetMarker() {\n\t\tif (this._targetMarker && this._targetMarker.parentNode) {\n\t\t\tthis.$grid.$grid_scale.removeChild(this._targetMarker);\n\t\t}\n\t\tthis._targetMarker = null;\n\t}\n}","function create(gantt){\n\tvar events = [];\n\n\treturn {\n\t\tdelegate:function(event, className, handler, root) {\n\t\t\tevents.push([event, className, handler, root]);\n\n\t\t\tvar helper = gantt.$services.getService(\"mouseEvents\");\n\t\t\thelper.delegate(event, className, handler, root);\n\t\t},\n\t\tdestructor: function(){\n\t\t\tvar mouseEvents = gantt.$services.getService(\"mouseEvents\");\n\t\t\tfor(var i = 0; i < events.length; i++){\n\t\t\t\tvar h = events[i];\n\t\t\t\tmouseEvents.detach(h[0], h[1], h[2], h[3]);\n\t\t\t}\n\t\t\tevents = [];\n\t\t}\n\t};\n}\n\nexport default create;","import * as domHelpers from \"../utils/dom_helpers\";\nimport * as utils from \"../../../utils/utils\";\nimport eventable from \"../../../utils/eventable\";\nimport gridResize from \"./grid_resize\";\nimport topPositionMixin from \"../row_position_mixin\";\nimport rowResize from \"./task_grid_row_resize\";\n\nimport ColumnDnd from \"../plugins/column_grid_dnd\";\n\nimport mouseEventContainer from \"../mouse_event_container\";\n\nvar Grid = function (parent, config, factory, gantt) {\n\tthis.$config = utils.mixin({}, config || {});\n\tthis.$gantt = gantt;\n\tthis.$parent = parent;\n\teventable(this);\n\tthis.$state = {};\n\tutils.mixin(this, topPositionMixin(this));\n};\n\n\nGrid.prototype = {\n\tinit: function(container) {\n\t\tvar gantt = this.$gantt;\n\t\tvar gridAriaAttr = gantt._waiAria.gridAttrString();\n\t\tvar gridDataAriaAttr = gantt._waiAria.gridDataAttrString();\n\t\tvar _ganttConfig = this.$getConfig();\n\t\tvar reorderColumns = _ganttConfig.reorder_grid_columns || false;\n\t\tif (this.$config.reorder_grid_columns !== undefined) {\n\t\t\treorderColumns = this.$config.reorder_grid_columns;\n\t\t}\n\n\n\t\tcontainer.innerHTML = \"<div class='gantt_grid' style='height:inherit;width:inherit;' \" + gridAriaAttr + \"></div>\";\n\t\tthis.$grid = container.childNodes[0];\n\n\t\tthis.$grid.innerHTML = \"<div class='gantt_grid_scale' \" +\n\t\t\tgantt._waiAria.gridScaleRowAttrString() + \"></div><div class='gantt_grid_data' \" + gridDataAriaAttr + \"></div>\";\n\n\t\tthis.$grid_scale = this.$grid.childNodes[0];\n\t\tthis.$grid_data = this.$grid.childNodes[1];\n\n\t\tvar attr = _ganttConfig[this.$config.bind + \"_attribute\"];\n\t\tif (!attr && this.$config.bind) {\n\t\t\tattr = \"data-\" + this.$config.bind + \"-id\";\n\t\t}\n\t\tthis.$config.item_attribute = attr || null;\n\n\t\tif (!this.$config.layers) {\n\t\t\tvar layers = this._createLayerConfig();\n\t\t\tthis.$config.layers = layers;\n\t\t}\n\n\t\tvar resizer = gridResize(gantt, this);\n\t\tresizer.init();\n\t\tthis._renderHeaderResizers = resizer.doOnRender;\n\t\tthis._mouseDelegates = mouseEventContainer(gantt);\n\n\t\tvar resizerrow = rowResize(gantt, this);\n\t\tresizerrow.init();\n\n\t\tthis._addLayers(this.$gantt);\n\t\tthis._initEvents();\n\n\t\tif (reorderColumns) {\n\t\t\tthis._columnDND = new ColumnDnd(gantt, this);\n\t\t\tthis._columnDND.init();\n\t\t}\n\n\t\tthis.callEvent(\"onReady\", []);\n\t\t//this.refresh();\n\t},\n\n\t_validateColumnWidth: function (column, property) {\n\t\t// user can set {name:\"text\", width:\"200\",...} for some reason,\n\t\t// check and convert it to number when possible\n\t\tvar value = column[property];\n\t\tif (value && value != \"*\") {\n\t\t\tvar gantt = this.$gantt;\n\t\t\tvar numericWidth = value * 1;\n\t\t\tif (isNaN(numericWidth)) {\n\t\t\t\tgantt.assert(false, \"Wrong \" + property + \" value of column \" + column.name);\n\t\t\t} else {\n\t\t\t\tcolumn[property] = numericWidth;\n\t\t\t}\n\t\t}\n\t},\n\n\tsetSize: function (width, height) {\n\t\tthis.$config.width = this.$state.width = width;\n\t\tthis.$config.height = this.$state.height = height;\n\n\t\t// TODO: maybe inherit and override in a subclass instead of extending here\n\n\t\tvar columns = this.getGridColumns(),\n\t\t\tinnerWidth = 0;\n\n\t\tvar config = this.$getConfig();\n\t\tvar elasticColumns = config.grid_elastic_columns;\n\n\t\tfor (var i = 0, l = columns.length; i < l; i++) {\n\t\t\tthis._validateColumnWidth(columns[i], \"min_width\");\n\t\t\tthis._validateColumnWidth(columns[i], \"max_width\");\n\t\t\tthis._validateColumnWidth(columns[i], \"width\");\n\n\t\t\tinnerWidth += columns[i].width * 1;\n\t\t}\n\n\t\tvar outerWidth;\n\t\tif (isNaN(innerWidth) || !this.$config.scrollable) {\n\t\t\touterWidth = this._setColumnsWidth(width + 1);\n\t\t\tinnerWidth = outerWidth;\n\t\t}\n\n\t\tif(this.$config.scrollable && elasticColumns && !isNaN(innerWidth)){\n\t\t\t// GS-1352: Allow resizing the grid columns, then the grid width is increased\n\t\t\t// or keep the grid width, but don't allow column resize to affect the grid width\n\t\t\tlet columnProperty = \"width\";\n\t\t\tif (elasticColumns == \"min_width\"){\n\t\t\t\tcolumnProperty = \"min_width\";\n\t\t\t}\n\t\t\tlet newColumnWidth = 0;\n\t\t\tcolumns.forEach(function(col){\n\t\t\t\tnewColumnWidth += col[columnProperty] || config.min_grid_column_width;\n\t\t\t});\n\t\t\t//newColumnWidth--; // the total column width shouldn't match the outerWidth // GS-2190 reducing width seems to be not needed\n\t\t\tvar columnsWidth = Math.max(newColumnWidth, width);\n\t\t\tinnerWidth = this._setColumnsWidth(columnsWidth);\n\t\t\touterWidth = width;\n\t\t}\n\n\t\tif (this.$config.scrollable) {\n\t\t\tthis.$grid_scale.style.width = innerWidth + \"px\";\n\t\t\tthis.$grid_data.style.width = innerWidth + \"px\";\n\t\t} else {\n\t\t\tthis.$grid_scale.style.width = \"inherit\";\n\t\t\tthis.$grid_data.style.width = \"inherit\";\n\t\t}\n\t\tthis.$config.width -= 1;\n\n\t\tvar config = this.$getConfig();\n\t\tif (outerWidth !== width) {\n\t\t\tif(outerWidth !== undefined){\n\t\t\t\tconfig.grid_width = outerWidth;\n\t\t\t\tthis.$config.width = outerWidth - 1;\n\t\t\t}else{\n\t\t\t\tif(!isNaN(innerWidth)){\n\t\t\t\t\tthis._setColumnsWidth(innerWidth);\n\t\t\t\t\tconfig.grid_width = innerWidth;\n\t\t\t\t\tthis.$config.width = innerWidth - 1;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tvar dataHeight = Math.max(this.$state.height - config.scale_height, 0);\n\t\tthis.$grid_data.style.height = dataHeight + \"px\";\n\t\tthis.refresh();\n\t},\n\tgetSize: function () {\n\n\t\tvar config = this.$getConfig();\n\n\t\tvar store = this.$config.rowStore;\n\n\t\tvar contentHeight = store ? this.getTotalHeight() : 0,\n\t\t\tcontentWidth = this._getGridWidth();\n\n\t\tvar size = {\n\t\t\tx: this.$state.width,\n\t\t\ty: this.$state.height,\n\t\t\tcontentX: this.isVisible() ? contentWidth : 0,\n\t\t\tcontentY: this.isVisible() ? (config.scale_height + contentHeight) : 0,\n\t\t\tscrollHeight: this.isVisible() ? contentHeight : 0,\n\t\t\tscrollWidth: this.isVisible() ? contentWidth : 0\n\t\t};\n\n\t\treturn size;\n\t},\n\n\t_bindStore: function () {\n\t\tif (this.$config.bind){\n\t\t\tvar rowStore = this.$gantt.getDatastore(this.$config.bind);\n\t\t\tthis.$config.rowStore = rowStore;\n\t\t\tif(rowStore && !rowStore._gridCacheAttached){\n\t\t\t\tvar self = this;\n\t\t\t\trowStore._gridCacheAttached = rowStore.attachEvent(\"onBeforeFilter\", function(){\n\t\t\t\t\tself._resetTopPositionHeight();\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t},\n\t_unbindStore: function(){\n\t\tif (this.$config.bind){\n\t\t\tvar rowStore = this.$gantt.getDatastore(this.$config.bind);\n\t\t\tif(rowStore && rowStore._gridCacheAttached){\n\t\t\t\trowStore.detachEvent(rowStore._gridCacheAttached);\n\t\t\t\trowStore._gridCacheAttached = false;\n\t\t\t}\n\t\t}\n\t},\n\n\trefresh: function () {\n\t\tthis._bindStore();\n\n\t\tthis._resetTopPositionHeight();\n\t\tthis._resetHeight();\n\t\tthis._initSmartRenderingPlaceholder();\n\n\t\tthis._calculateGridWidth();\n\t\tthis._renderGridHeader();\n\t},\n\n\tgetViewPort: function(){\n\t\tvar scrollLeft = this.$config.scrollLeft || 0;\n\t\tvar scrollTop = this.$config.scrollTop || 0;\n\t\tvar height = this.$config.height || 0;\n\t\tvar width = this.$config.width || 0;\n\t\treturn {\n\t\t\ty: scrollTop,\n\t\t\ty_end: scrollTop + height,\n\t\t\tx: scrollLeft,\n\t\t\tx_end: scrollLeft + width,\n\t\t\theight: height,\n\t\t\twidth: width\n\t\t};\n\t},\n\n\tscrollTo: function (left, top) {\n\t\tif (!this.isVisible())\n\t\t\treturn;\n\n\t\tvar scrolled = false;\n\n\t\tthis.$config.scrollTop = this.$config.scrollTop || 0;\n\t\tthis.$config.scrollLeft = this.$config.scrollLeft || 0;\n\n\t\tif (left * 1 == left) {\n\t\t\tthis.$config.scrollLeft = this.$state.scrollLeft = this.$grid.scrollLeft = left;\n\t\t\tscrolled = true;\n\t\t}\n\n\t\t// var config = this.$getConfig();\n\t\tif (top * 1 == top) {\n\t\t\tthis.$config.scrollTop = this.$state.scrollTop = this.$grid_data.scrollTop = top;\n\t\t\tscrolled = true;\n\t\t}\n\n\t\tif(scrolled){\n\t\t\tthis.callEvent(\"onScroll\", [this.$config.scrollLeft, this.$config.scrollTop]);\n\t\t}\n\t},\n\n\tgetColumnIndex: function (name, excludeHidden) {\n\t\tvar columns = this.$getConfig().columns;\n\t\tvar hiddenIndexShift = 0;\n\n\t\tfor (var i = 0; i < columns.length; i++) {\n\t\t\t// GS-1257. If the cell is hidden, the target column index should be correct\n\t\t\tif (excludeHidden && columns[i].hide){\n\t\t\t\thiddenIndexShift++;\n\t\t\t}\n\t\t\tif (columns[i].name == name) {\n\t\t\t\treturn i - hiddenIndexShift;\n\t\t\t}\n\t\t}\n\t\treturn null;\n\t},\n\n\tgetColumn: function (name) {\n\t\tvar index = this.getColumnIndex(name);\n\t\tif (index === null) {\n\t\t\treturn null;\n\t\t}\n\t\treturn this.$getConfig().columns[index];\n\t},\n\n\tgetGridColumns: function () {\n\t\tvar config = this.$getConfig();\n\t\treturn config.columns.slice();\n\t},\n\tisVisible: function () {\n\t\tif (this.$parent && this.$parent.$config) {\n\t\t\treturn !this.$parent.$config.hidden;\n\t\t} else {\n\t\t\treturn this.$grid.offsetWidth;\n\t\t}\n\t},\n\n\t// getItemHeight: function () {\n\t// \tvar config = this.$getConfig();\n\t// \treturn config.row_height;\n\t// },\n\n\t_createLayerConfig: function () {\n\t\tvar gantt = this.$gantt;\n\t\tvar self = this;\n\t\tvar layers = [\n\t\t\t{\n\t\t\t\trenderer: gantt.$ui.layers.gridLine(),\n\t\t\t\tcontainer: this.$grid_data,\n\t\t\t\tfilter: [function () {\n\t\t\t\t\treturn self.isVisible();\n\t\t\t\t}]\n\t\t\t},\n\t\t\t{\n\t\t\t\trenderer: gantt.$ui.layers.gridTaskRowResizer(),\n\t\t\t\tcontainer: this.$grid_data,\n\t\t\t\tappend: true,\n\t\t\t\tfilter: [function () {\n\t\t\t\t\treturn gantt.config.resize_rows;\n\t\t\t\t}]\n\t\t\t}\n\t\t];\n\t\treturn layers;\n\t},\n\n\t_addLayers: function (gantt) {\n\t\tif (!this.$config.bind)\n\t\t\treturn;\n\n\t\tthis._taskLayers = [];\n\n\t\tvar self = this;\n\n\t\tvar layers = this.$gantt.$services.getService(\"layers\");\n\t\tvar taskRenderer = layers.getDataRender(this.$config.bind);\n\n\t\tif (!taskRenderer) {\n\t\t\ttaskRenderer = layers.createDataRender({\n\t\t\t\tname: this.$config.bind,\n\t\t\t\tdefaultContainer: function () { return self.$grid_data; }\n\t\t\t});\n\t\t}\n\n\t\tvar taskLayers = this.$config.layers;\n\t\tfor (var i = 0; taskLayers && i < taskLayers.length; i++) {\n\t\t\tvar layer = taskLayers[i];\n\t\t\tlayer.view = this;\n\n\t\t\tvar bar_layer = taskRenderer.addLayer(layer);\n\t\t\tthis._taskLayers.push(bar_layer);\n\t\t}\n\n\t\tthis._bindStore();\n\n\t\tthis._initSmartRenderingPlaceholder();\n\t},\n\n\t_refreshPlaceholderOnStoreUpdate: function (id) {\n\t\tvar config = this.$getConfig(),\n\t\t\tstore = this.$config.rowStore;\n\n\t\tif (!store || id !== null || !this.isVisible() || !config.smart_rendering) {\n\t\t\treturn;\n\t\t}\n\n\t\tvar contentHeight;\n\t\tif (this.$config.scrollY) {\n\t\t\tvar scroll = this.$gantt.$ui.getView(this.$config.scrollY);\n\t\t\tif (scroll)\n\t\t\t\tcontentHeight = scroll.getScrollState().scrollSize;\n\t\t}\n\n\t\tif (!contentHeight) {\n\t\t\tcontentHeight = store ? this.getTotalHeight() : 0;\n\t\t}\n\n\t\tif (contentHeight) {\n\t\t\tif (this.$rowsPlaceholder && this.$rowsPlaceholder.parentNode) {\n\t\t\t\tthis.$rowsPlaceholder.parentNode.removeChild(this.$rowsPlaceholder);\n\t\t\t}\n\n\t\t\tvar placeholder = this.$rowsPlaceholder = document.createElement(\"div\");\n\t\t\tplaceholder.style.visibility = \"hidden\";\n\t\t\tplaceholder.style.height = contentHeight + \"px\";\n\t\t\tplaceholder.style.width = \"1px\";\n\t\t\tthis.$grid_data.appendChild(placeholder);\n\t\t}\n\t},\n\n\t_initSmartRenderingPlaceholder: function () {\n\t\tvar store = this.$config.rowStore;\n\t\tif (!store) {\n\t\t\treturn;\n\t\t} else {\n\t\t\tthis._initSmartRenderingPlaceholder = function () { };\n\t\t}\n\t\tthis._staticBgHandler = store.attachEvent(\"onStoreUpdated\", utils.bind(this._refreshPlaceholderOnStoreUpdate, this));\n\t},\n\n\t_initEvents: function () {\n\t\tvar gantt = this.$gantt;\n\t\tthis._mouseDelegates.delegate(\"click\", \"gantt_close\", gantt.bind(function (e, id, trg) {\n\t\t\tvar store = this.$config.rowStore;\n\t\t\tif (!store) return true;\n\n\t\t\tvar target = domHelpers.locateAttribute(e, this.$config.item_attribute);\n\t\t\tif (target) {\n\t\t\t\tstore.close(target.getAttribute(this.$config.item_attribute));\n\n\t\t\t}\n\t\t\treturn false;\n\t\t}, this), this.$grid);\n\n\t\tthis._mouseDelegates.delegate(\"click\", \"gantt_open\", gantt.bind(function (e, id, trg) {\n\t\t\tvar store = this.$config.rowStore;\n\t\t\tif (!store) return true;\n\n\t\t\tvar target = domHelpers.locateAttribute(e, this.$config.item_attribute);\n\t\t\tif (target) {\n\t\t\t\tstore.open(target.getAttribute(this.$config.item_attribute));\n\n\t\t\t}\n\t\t\treturn false;\n\t\t}, this), this.$grid);\n\t},\n\n\t_clearLayers: function (gantt) {\n\t\tvar layers = this.$gantt.$services.getService(\"layers\");\n\t\tvar taskRenderer = layers.getDataRender(this.$config.bind);\n\n\t\tif (this._taskLayers) {\n\t\t\tfor (var i = 0; i < this._taskLayers.length; i++) {\n\t\t\t\ttaskRenderer.removeLayer(this._taskLayers[i]);\n\t\t\t}\n\t\t}\n\n\t\tthis._taskLayers = [];\n\t},\n\n\t_getColumnWidth: function (column, config, width) {\n\t\tvar min_width = column.min_width || config.min_grid_column_width;\n\t\tvar new_width = Math.max(width, min_width || 10);\n\t\tif (column.max_width)\n\t\t\tnew_width = Math.min(new_width, column.max_width);\n\t\treturn new_width;\n\t},\n\t// set min width only if width < than config.min_grid_column_width\n\t_checkGridColumnMinWidthLimits: function (columns, config) {\n\t\tfor (var i = 0, l = columns.length; i < l; i++) {\n\t\t\tvar width = columns[i].width * 1;\n\t\t\tif (!columns[i].min_width && width < config.min_grid_column_width){\n\t\t\t\tcolumns[i].min_width = width;\n\t\t\t}\n\t\t}\n\t},\n\t// return min and max possible grid width according to restricts\n\t_getGridWidthLimits: function () {\n\t\tvar config = this.$getConfig(),\n\t\t\tcolumns = this.getGridColumns(),\n\t\t\tmin_limit = 0,\n\t\t\tmax_limit = 0;\n\n\t\tfor (var i = 0; i < columns.length; i++) {\n\t\t\tmin_limit += columns[i].min_width ? columns[i].min_width : config.min_grid_column_width;\n\t\t\tif (max_limit !== undefined) {\n\t\t\t\tmax_limit = columns[i].max_width ? (max_limit + columns[i].max_width) : undefined;\n\t\t\t}\n\t\t}\n\t\tthis._checkGridColumnMinWidthLimits(columns, config); // FIX ME: should it be before calculating limits?\n\t\treturn [min_limit, max_limit];\n\t},\n\t// resize columns to get total newWidth, starting from columns[start_index]\n\t_setColumnsWidth: function (newWidth, start_index) {\n\t\tvar config = this.$getConfig();\n\t\tvar columns = this.getGridColumns(),\n\t\t\tcolumns_width = 0,\n\t\t\tfinal_width = newWidth;\n\n\t\tstart_index = !window.isNaN(start_index) ? start_index : -1;\n\n\t\tfor (var i = 0, l = columns.length; i < l; i++) {\n\t\t\tcolumns_width += columns[i].width * 1;\n\t\t}\n\n\t\tif (window.isNaN(columns_width)) {\n\t\t\tthis._calculateGridWidth();\n\t\t\tcolumns_width = 0;\n\t\t\tfor (var i = 0, l = columns.length; i < l; i++) {\n\t\t\t\tcolumns_width += columns[i].width * 1;\n\t\t\t}\n\t\t}\n\n\t\tvar extra_width = final_width - columns_width;\n\n\t\tvar start_width = 0;\n\t\tfor (var i = 0; i < start_index + 1; i++) {\n\t\t\tstart_width += columns[i].width;\n\t\t}\n\n\t\tcolumns_width -= start_width;\n\n\t\tfor (var i = start_index + 1; i < columns.length; i++) {\n\n\t\t\tvar col = columns[i];\n\t\t\tvar share = Math.round(extra_width * (col.width / columns_width));\n\n\t\t\t// columns have 2 additional restrict fields - min_width & max_width that are set by user\n\t\t\tif (extra_width < 0) {\n\t\t\t\tif (col.min_width && col.width + share < col.min_width)\n\t\t\t\t\tshare = col.min_width - col.width;\n\t\t\t\telse if (!col.min_width && config.min_grid_column_width && col.width + share < config.min_grid_column_width)\n\t\t\t\t\tshare = config.min_grid_column_width - col.width;\n\t\t\t} else if (col.max_width && col.width + share > col.max_width)\n\t\t\t\tshare = col.max_width - col.width;\n\n\t\t\tcolumns_width -= col.width;\n\t\t\tcol.width += share;\n\t\t\textra_width -= share;\n\n\t\t}\n\n\t\tvar iterator = extra_width > 0 ? 1 : -1;\n\t\twhile ((extra_width > 0 && iterator === 1) || (extra_width < 0 && iterator === -1)) {\n\t\t\tvar curExtra = extra_width;\n\t\t\tfor (i = start_index + 1; i < columns.length; i++) {\n\t\t\t\tvar new_width = columns[i].width + iterator;\n\n\t\t\t\tif (new_width == this._getColumnWidth(columns[i], config, new_width)) {\n\t\t\t\t\textra_width -= iterator;\n\t\t\t\t\tcolumns[i].width = new_width;\n\t\t\t\t}\n\n\t\t\t\tif (!extra_width)\n\t\t\t\t\tbreak;\n\n\t\t\t}\n\n\t\t\tif (curExtra == extra_width)\n\t\t\t\tbreak;\n\t\t}\n\n\t\t// if impossible to resize the right-side columns, resize the start column\n\t\tif (extra_width && start_index > -1) {\n\t\t\tvar new_width = columns[start_index].width + extra_width;\n\t\t\tif (new_width == this._getColumnWidth(columns[start_index], config, new_width))\n\t\t\t\tcolumns[start_index].width = new_width;\n\t\t}\n\n\t\t//if (this.callEvent(\"onGridResizeEnd\", [config.grid_width, final_width]) === false)\n\t\t//\treturn;\n\n\t\treturn this._getColsTotalWidth();\n\t},\n\n\t_getColsTotalWidth: function () {\n\t\tvar columns = this.getGridColumns();\n\t\tvar cols_width = 0;\n\n\t\tfor (var i = 0; i < columns.length; i++) {\n\t\t\tvar v = parseFloat(columns[i].width);\n\t\t\tif (window.isNaN(v)) {\n\t\t\t\treturn false;\n\t\t\t}\n\t\t\tcols_width += v;\n\t\t}\n\t\treturn cols_width;\n\t},\n\t_calculateGridWidth: function () {\n\t\tvar config = this.$getConfig();\n\t\tvar columns = this.getGridColumns();\n\t\tvar cols_width = 0;\n\t\tvar unknown = [];\n\t\tvar width = [];\n\n\t\tfor (var i = 0; i < columns.length; i++) {\n\t\t\tvar v = parseFloat(columns[i].width);\n\t\t\tif (window.isNaN(v)) {\n\t\t\t\tv = config.min_grid_column_width || 10;\n\t\t\t\tunknown.push(i);\n\t\t\t}\n\t\t\twidth[i] = v;\n\t\t\tcols_width += v;\n\t\t}\n\t\tvar gridWidth = this._getGridWidth() + 1;\n\t\tif (config.autofit || unknown.length) {\n\t\t\tvar diff = gridWidth - cols_width;\n\t\t\t// TODO: logic may be improved for proportional changing of width\n\n\t\t\t// autofit adjusts columns widths to the outer grid width\n\t\t\t// it doesn't makes sense if grid has inner scroll with elastic columns\n\t\t\tif (config.autofit && !config.grid_elastic_columns) {\n\t\t\t\t// delta must be added for all columns\n\t\t\t\tfor (var i = 0; i < width.length; i++) {\n\t\t\t\t\tvar delta = Math.round(diff / (width.length - i));\n\t\t\t\t\twidth[i] += delta;\n\t\t\t\t\tvar new_width = this._getColumnWidth(columns[i], config, width[i]);\n\n\t\t\t\t\tif (new_width != width[i]) {\n\t\t\t\t\t\tdelta = new_width - width[i];\n\t\t\t\t\t\twidth[i] = new_width;\n\t\t\t\t\t}\n\t\t\t\t\tdiff -= delta;\n\t\t\t\t}\n\t\t\t} else if (unknown.length) {\n\t\t\t\t// there are several columns with undefined width\n\t\t\t\tfor (var i = 0; i < unknown.length; i++) {\n\t\t\t\t\tvar delta = Math.round(diff / (unknown.length - i)); // no float values, just integer\n\t\t\t\t\tvar index = unknown[i];\n\t\t\t\t\twidth[index] += delta;\n\t\t\t\t\tvar new_width = this._getColumnWidth(columns[index], config, width[index]);\n\t\t\t\t\tif (new_width != width[index]) {\n\t\t\t\t\t\tdelta = new_width - width[index];\n\t\t\t\t\t\twidth[index] = new_width;\n\t\t\t\t\t}\n\t\t\t\t\tdiff -= delta;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tfor (var i = 0; i < width.length; i++) {\n\t\t\t\tcolumns[i].width = width[i];\n\t\t\t}\n\t\t} else {\n\t\t\tvar changed = (gridWidth != cols_width);\n\t\t\tthis.$config.width = cols_width - 1;\n\t\t\tconfig.grid_width = cols_width;\n\t\t\tif (changed) {\n\t\t\t\tthis.$parent._setContentSize(this.$config.width, null);\n\t\t\t}\n\t\t}\n\n\t},\n\n\t_renderGridHeader: function () {\n\t\tvar gantt = this.$gantt;\n\t\tvar config = this.$getConfig();\n\t\tvar locale = this.$gantt.locale;\n\t\tvar templates = this.$gantt.templates;\n\n\t\tvar columns = this.getGridColumns();\n\t\tif (config.rtl) {\n\t\t\tcolumns = columns.reverse();\n\t\t}\n\t\tvar cells = [];\n\t\tvar width = 0,\n\t\t\tlabels = locale.labels;\n\n\t\tvar lineHeigth = config.scale_height - 1;\n\n\t\tfor (var i = 0; i < columns.length; i++) {\n\t\t\tvar last = i == columns.length - 1;\n\t\t\tvar col = columns[i];\n\n\t\t\t// ensure columns have non-empty names\n\t\t\tif (!col.name) {\n\t\t\t\tcol.name = gantt.uid() + \"\";\n\t\t\t}\n\n\t\t\tvar colWidth = col.width * 1;\n\n\t\t\tvar gridWidth = this._getGridWidth();\n\t\t\tif (last && gridWidth > width + colWidth)\n\t\t\t\tcol.width = colWidth = gridWidth - width;\n\t\t\twidth += colWidth;\n\t\t\tvar sort = (gantt._sort && col.name == gantt._sort.name) ? (`<div data-column-id=\"${col.name}\" class=\"gantt_sort gantt_${gantt._sort.direction}\"></div>`) : \"\";\n\t\t\tvar cssClass = [\"gantt_grid_head_cell\",\n\t\t\t\t(\"gantt_grid_head_\" + col.name),\n\t\t\t\t(last ? \"gantt_last_cell\" : \"\"),\n\t\t\t\ttemplates.grid_header_class(col.name, col)].join(\" \");\n\n\t\t\tvar style = \"width:\" + (colWidth - (last ? 1 : 0)) + \"px;\";\n\t\t\tvar label = (col.label || labels[\"column_\" + col.name] || labels[col.name]);\n\t\t\tlabel = label || \"\";\n\n\t\t\tvar ariaAttrs = gantt._waiAria.gridScaleCellAttrString(col, label);\n\n\t\t\tvar cell = \"<div class='\" + cssClass + \"' style='\" + style + \"' \" + ariaAttrs + \n\t\t\t\t\" data-column-id='\" + col.name + \"' column_id='\" + col.name + \"'\" +\n\t\t\t\t\" data-column-name='\" + col.name + \"' data-column-index='\" + i + \"'\" +\n\t\t\t\t\">\" + label + sort + \"</div>\";\n\t\t\tcells.push(cell);\n\t\t}\n\t\tthis.$grid_scale.style.height = (config.scale_height) + \"px\";\n\t\tthis.$grid_scale.style.lineHeight = lineHeigth + \"px\";\n\t\t//this.$grid_scale.style.width = \"inherit\";\n\t\tthis.$grid_scale.innerHTML = cells.join(\"\");\n\n\t\tif (this._renderHeaderResizers) {\n\t\t\tthis._renderHeaderResizers();\n\t\t}\n\t},\n\n\t_getGridWidth: function () {\n\t\t// TODO: refactor/remove/comment some of _getGridWidth/this.$config.width/this.$state.width, it's not clear what they do\n\t\treturn this.$config.width;\n\t},\n\n\tdestructor: function () {\n\t\tthis._clearLayers(this.$gantt);\n\t\tif (this._mouseDelegates) {\n\t\t\tthis._mouseDelegates.destructor();\n\t\t\tthis._mouseDelegates = null;\n\t\t}\n\t\tthis._unbindStore();\n\t\tthis.$grid = null;\n\t\tthis.$grid_scale = null;\n\t\tthis.$grid_data = null;\n\t\tthis.$gantt = null;\n\t\tif (this.$config.rowStore) {\n\t\t\tthis.$config.rowStore.detachEvent(this._staticBgHandler);\n\t\t\tthis.$config.rowStore = null;\n\t\t}\n\n\t\tthis.callEvent(\"onDestroy\", []);\n\t\tthis.detachAllEvents();\n\t}\n};\n\nexport default Grid;\n","function createResizer(gantt, grid){\n\treturn {\n\t\tinit: function(){},\n\t\tdoOnRender: function(){}\n\t};\n}\n\nexport default createResizer;","import * as domHelpers from \"../utils/dom_helpers\";\n\nfunction createRowResizer(gantt, grid){\n\n\tvar _task_grid_row_resize = {\n\t\trow_before_start: gantt.bind(function (dnd, obj, e) {\n\t\t\tvar config = grid.$getConfig();\n\t\t\tvar store = grid.$config.rowStore;\n\n\t\t\tvar el = domHelpers.locateAttribute(e, config.task_grid_row_resizer_attribute);\n\t\t\tif (!el) return false;\n\n\t\t\tvar row_id = this.locate(e, config.task_grid_row_resizer_attribute),\n\t\t\t\trow = store.getItem(row_id);\n\n\t\t\tif (grid.callEvent(\"onBeforeRowResize\", [row]) === false)\n\t\t\t\treturn false;\n\t\t}, gantt),\n\n\t\trow_after_start: gantt.bind(function (dnd, obj, e) {\n\t\t\tvar config = grid.$getConfig();\n\n\t\t\tvar row_id = this.locate(e, config.task_grid_row_resizer_attribute);\n\t\t\tdnd.config.marker.innerHTML = \"\";\n\n\t\t\tdnd.config.marker.className += \" gantt_row_grid_resize_area\";\n\t\t\tdnd.config.marker.style.width = grid.$grid.offsetWidth + \"px\";\n\t\t\tdnd.config.drag_id = row_id;\n\n\t\t}, gantt),\n\n\t\trow_drag_move: gantt.bind(function (dnd, obj, e) {\n\t\t\tvar store = grid.$config.rowStore;\n\t\t\tvar config = grid.$getConfig();\n\t\t\tvar dd = dnd.config;\n\t\t\tvar id = dd.drag_id,\n\t\t\t\titemHeight = grid.getItemHeight(id),\n\t\t\t\titemTop = grid.getItemTop(id) - obj.scrollTop;\n\t\t\tvar pos = domHelpers.getNodePosition(grid.$grid_data),\n\t\t\t\tpointerPosition = parseInt(dd.marker.style.top, 10),\n\t\t\t\tmarkerStartPosition = itemTop + pos.y,\n\t\t\t\tmarker_height = 0,\n\t\t\t\tminPointerPosition = config.min_task_grid_row_height;\n\n\t\t\tmarker_height = pointerPosition - markerStartPosition;\n\t\t\tif(marker_height < minPointerPosition){\n\t\t\t\tmarker_height = minPointerPosition;\n\t\t\t}\n\n\t\t\tdd.marker.style.left = pos.x + \"px\";\n\t\t\tdd.marker.style.top = markerStartPosition - 1 + \"px\";\n\t\t\tdd.marker.style.height = Math.abs(marker_height) + 1 + \"px\";\n\n\t\t\tdd.marker_height = marker_height;\n\t\t\t\n\t\t\tgrid.callEvent(\"onRowResize\", [id, store.getItem(id), marker_height + itemHeight]);\n\t\t\treturn true;\n\t\t}, gantt),\n\n\t\trow_drag_end: gantt.bind(function (dnd, obj, e) {\n\t\t\tvar store = grid.$config.rowStore;\n\t\t\tvar dd = dnd.config;\n\t\t\tvar id = dd.drag_id,\n\t\t\t\titem = store.getItem(id),\n\t\t\t\toldItemHeight = grid.getItemHeight(id);\n\n\t\t\tvar finalHeight = dd.marker_height;\n\n\t\t\tif (grid.callEvent(\"onBeforeRowResizeEnd\", [id, item, finalHeight]) === false)\n\t\t\t\treturn;\n\n\t\t\tif (item.row_height == finalHeight)\n\t\t\t\treturn;\n\n\t\t\titem.row_height = finalHeight;\n\t\t\tgantt.updateTask(id);\n\n\t\t\tgrid.callEvent(\"onAfterRowResize\", [id, item, oldItemHeight, finalHeight]);\n\n\t\t\tthis.render();\n\t\t}, gantt)\n\t};\n\n\t// calls the initialization of the D'n'D events for resize elements\n\tvar _init_resize = function () {\n\n\t\tvar DnD = gantt.$services.getService(\"dnd\");\n\n\t\tvar config = grid.$getConfig();\n\n\t\tvar dnd = new DnD(grid.$grid_data, {updates_per_second: 60});\n\t\tif (gantt.defined(config.dnd_sensitivity))\n\t\t\tdnd.config.sensitivity = config.dnd_sensitivity;\n\n\t\tdnd.attachEvent(\"onBeforeDragStart\", function (obj, e) {\n\t\t\treturn _task_grid_row_resize.row_before_start(dnd, obj, e);\n\t\t});\n\t\tdnd.attachEvent(\"onAfterDragStart\", function (obj, e) {\n\t\t\treturn _task_grid_row_resize.row_after_start(dnd, obj, e);\n\t\t});\n\t\tdnd.attachEvent(\"onDragMove\", function (obj, e) {\n\t\t\treturn _task_grid_row_resize.row_drag_move(dnd, obj, e);\n\t\t});\n\t\tdnd.attachEvent(\"onDragEnd\", function (obj, e) {\n\t\t\treturn _task_grid_row_resize.row_drag_end(dnd, obj, e);\n\t\t});\n\n\t};\n\n\treturn {\n\t\tinit: _init_resize\n\t};\n}\n\nexport default createRowResizer;","export default {\n\tinit: function (controller, grid) {\n\t\tvar gantt = grid.$gantt;\n\n\t\tgantt.attachEvent(\"onTaskClick\", function (id, e) {\n\t\t\tif (gantt._is_icon_open_click(e))\n\t\t\t\treturn true;\n\t\t\tvar state = controller.getState();\n\t\t\tvar cell = controller.locateCell(e.target);\n\n\t\t\tif (cell && controller.getEditorConfig(cell.columnName)) {\n\t\t\t\tif (controller.isVisible() && state.id == cell.id && state.columnName == cell.columnName) {\n\t\t\t\t\t// do nothing if editor is already active in this cell\n\t\t\t\t} else {\n\t\t\t\t\tcontroller.startEdit(cell.id, cell.columnName);\n\t\t\t\t}\n\t\t\t\treturn false;\n\t\t\t}\n\t\t\treturn true;\n\t\t});\n\n\t\tgantt.attachEvent(\"onEmptyClick\", function () {\n\t\t\tif (controller.isVisible() && controller.isChanged()) {\n\t\t\t\tcontroller.save();\n\t\t\t} else {\n\t\t\t\tcontroller.hide();\n\t\t\t}\n\t\t\treturn true;\n\t\t});\n\n\t\tgantt.attachEvent(\"onTaskDblClick\", function (id, e) {\n\t\t\tvar state = controller.getState();\n\t\t\tvar cell = controller.locateCell(e.target);\n\t\t\tif (cell && controller.isVisible() && cell.columnName == state.columnName) {\n\t\t\t\t//GS-933 probably, we don't need to hide the inline editor because the lightbox cannot be opened if you double-click on an inline editor\n\t\t\t\t//remove this code later if people don't complain\n\t\t\t\t//controller.hide();\n\t\t\t\treturn false;\n\t\t\t}\n\t\t\treturn true;\n\t\t});\n\t},\n\n\tonShow: function (controller, placeholder, grid) {\n\t\tvar gantt = grid.$gantt;\n\t\t\n\n\t\tif(gantt.ext && gantt.ext.keyboardNavigation){\n\t\t\tvar keyNav = gantt.ext.keyboardNavigation;\n\t\t\tkeyNav.attachEvent(\"onKeyDown\", function(command, e){\n\t\t\t\tvar keyboard = gantt.constants.KEY_CODES;\n\t\t\t\tvar keyCode = e.keyCode;\n\t\t\t\tvar preventKeyNav = false;\n\n\t\t\t\tswitch (keyCode){\n\t\t\t\t\tcase keyboard.SPACE:\n\t\t\t\t\t\tif(controller.isVisible()){\n\t\t\t\t\t\t\tpreventKeyNav = true;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t\tif (preventKeyNav){\n\t\t\t\t\treturn false;\n\t\t\t\t} else{\n\t\t\t\t\treturn true;\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t\t\n\t\tplaceholder.onkeydown = function (e) {\n\t\t\te = e || window.event;\n\n\t\t\tvar keyboard = gantt.constants.KEY_CODES;\n\t\t\tif (e.defaultPrevented || (e.shiftKey && e.keyCode != keyboard.TAB)) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tvar shouldPrevent = true;\n\t\t\tswitch (e.keyCode) {\n\t\t\t\tcase gantt.keys.edit_save:\n\t\t\t\t\tcontroller.save();\n\t\t\t\t\tbreak;\n\t\t\t\tcase gantt.keys.edit_cancel:\n\t\t\t\t\tcontroller.hide();\n\t\t\t\t\tbreak;\n\t\t\t\tcase keyboard.UP:\n\t\t\t\tcase keyboard.DOWN:\n\t\t\t\t\tif (controller.isVisible()) {\n\t\t\t\t\t\tcontroller.hide();\n\t\t\t\t\t\tshouldPrevent = false;\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\t\t\t\tcase keyboard.TAB:\n\t\t\t\t\tif (e.shiftKey) {\n\t\t\t\t\t\tcontroller.editPrevCell(true);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tcontroller.editNextCell(true);\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\t\t\t\tdefault:\n\t\t\t\t\tshouldPrevent = false;\n\t\t\t\t\tbreak;\n\t\t\t}\n\n\t\t\tif (shouldPrevent) {\n\t\t\t\te.preventDefault();\n\t\t\t}\n\t\t};\n\t},\n\tonHide: function () {\n\n\t},\n\n\tdestroy: function () {\n\n\t}\n};\n\n","export default {\n\tinit: function(controller, grid){\n\t\tvar self = controller;\n\t\tvar gantt = grid.$gantt;\n\n\t\tvar onBlurDelay = null;\n\t\tvar keyNav = gantt.ext.keyboardNavigation;\n\t\tkeyNav.attachEvent(\"onBeforeFocus\", function (node) {\n\t\t\tvar activeCell = controller.locateCell(node);\n\t\t\tclearTimeout(onBlurDelay);\n\t\t\tif (activeCell) {\n\t\t\t\tvar columnName = activeCell.columnName;\n\t\t\t\tvar id = activeCell.id;\n\n\t\t\t\tvar editorState = self.getState();\n\t\t\t\tif(self.isVisible()){\n\t\t\t\t\tif(editorState.id == id && editorState.columnName === columnName) {\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn true;\n\t\t});\n\n\t\tkeyNav.attachEvent(\"onFocus\", function (node) {\n\t\t\tvar activeCell = controller.locateCell(node);\n\t\t\tvar state = controller.getState();\n\t\t\tclearTimeout(onBlurDelay);\n\t\t\tif (activeCell && !(activeCell.id == state.id && activeCell.columnName == state.columnName)) {\n\t\t\t\tif(self.isVisible()){\n\t\t\t\t\tself.save();\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn true;\n\t\t});\n\n\t\tcontroller.attachEvent(\"onHide\", function(){\n\t\t\tclearTimeout(onBlurDelay);\n\t\t});\n\n\t\tkeyNav.attachEvent(\"onBlur\", function () {\n\t\t\tonBlurDelay = setTimeout(function(){\n\t\t\t\tself.save();\n\t\t\t});\n\n\t\t\treturn true;\n\t\t});\n\n\t\tgantt.attachEvent(\"onTaskDblClick\", function(id,e){\n\t\t\t// block lightbox on double click inside editor\n\t\t\tvar state = controller.getState();\n\t\t\tvar cell = controller.locateCell(e.target);\n\t\t\tif(cell && controller.isVisible() && cell.columnName == state.columnName){\n\t\t\t\treturn false;\n\t\t\t}\n\t\t\treturn true;\n\t\t});\n\n\t\tgantt.attachEvent(\"onTaskClick\", function (id, e) {\n\t\t\tif(gantt._is_icon_open_click(e))\n\t\t\t\treturn true;\n\n\t\t\tvar state = controller.getState();\n\t\t\tvar cell = controller.locateCell(e.target);\n\n\t\t\tif (cell && controller.getEditorConfig(cell.columnName)) {\n\t\t\t\tif(controller.isVisible() && state.id == cell.id && state.columnName == cell.columnName){\n\t\t\t\t\t// do nothing if editor is already active in this cell\n\t\t\t\t}else{\n\t\t\t\t\tcontroller.startEdit(cell.id, cell.columnName);\n\t\t\t\t}\n\t\t\t\treturn false;\n\t\t\t}\n\t\t\treturn true;\n\t\t});\n\t\tgantt.attachEvent(\"onEmptyClick\", function () {\n\t\t\tself.save();\n\t\t\treturn true;\n\t\t});\n\n\t\tkeyNav.attachEvent(\"onKeyDown\", function(command, e){\n\t\t\tvar activeCell = controller.locateCell(e.target);\n\t\t\tvar hasEditor = activeCell ? controller.getEditorConfig(activeCell.columnName) : false;\n\n\t\t\tvar state = controller.getState();\n\t\t\tvar keyboard = gantt.constants.KEY_CODES;\n\t\t\tvar keyCode = e.keyCode;\n\t\t\tvar preventKeyNav = false;\n\n\t\t\tswitch (keyCode){\n\t\t\t\tcase keyboard.ENTER:\n\t\t\t\t\tif(controller.isVisible()){\n\t\t\t\t\t\tcontroller.save();\n\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t\tpreventKeyNav = true;\n\t\t\t\t\t}else if(hasEditor && !(e.ctrlKey || e.metaKey || e.shiftKey)){\n\t\t\t\t\t\tself.startEdit(activeCell.id, activeCell.columnName);\n\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t\tpreventKeyNav = true;\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\t\t\t\tcase keyboard.ESC:\n\t\t\t\t\tif(controller.isVisible()){\n\t\t\t\t\t\tcontroller.hide();\n\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t\tpreventKeyNav = true;\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\t\t\t\tcase keyboard.UP:\n\t\t\t\tcase keyboard.DOWN:\n\t\t\t\t\tbreak;\n\t\t\t\tcase keyboard.LEFT:\n\t\t\t\tcase keyboard.RIGHT:\n\t\t\t\t\tif((hasEditor && controller.isVisible()) || state.editorType === \"date\"){\n\t\t\t\t\t\tpreventKeyNav = true;\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\t\t\t\tcase keyboard.SPACE:\n\t\t\t\t\tif(controller.isVisible()){\n\t\t\t\t\t\tpreventKeyNav = true;\n\t\t\t\t\t}\n\n\t\t\t\t\tif(hasEditor && !controller.isVisible()){\n\t\t\t\t\t\tself.startEdit(activeCell.id, activeCell.columnName);\n\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t\tpreventKeyNav = true;\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\t\t\t\tcase keyboard.DELETE:\n\t\t\t\t\tif(hasEditor && !controller.isVisible()){\n\t\t\t\t\t\tself.startEdit(activeCell.id, activeCell.columnName);\n\t\t\t\t\t\tpreventKeyNav = true;\n\t\t\t\t\t} else if(hasEditor && controller.isVisible()){\n\t\t\t\t\t\tpreventKeyNav = true;\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\t\t\t\tcase keyboard.TAB:\n\t\t\t\t\tif(controller.isVisible()){\n\n\t\t\t\t\t\tif(e.shiftKey){\n\t\t\t\t\t\t\tcontroller.editPrevCell(true);\n\t\t\t\t\t\t}else{\n\t\t\t\t\t\t\tcontroller.editNextCell(true);\n\t\t\t\t\t\t}\n\t\t\t\t\t\tvar newState = controller.getState();\n\t\t\t\t\t\tif(newState.id){\n\t\t\t\t\t\t\tkeyNav.focus({type:\"taskCell\", id: newState.id, column:newState.columnName});\n\t\t\t\t\t\t}\n\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t\tpreventKeyNav = true;\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\t\t\t\tdefault:\n\t\t\t\t\tif(controller.isVisible())\n\t\t\t\t\t\tpreventKeyNav = true;\n\t\t\t\t\telse{\n\n\t\t\t\t\t\t// start editing on character key\n\t\t\t\t\t\tif((keyCode >= 48 && keyCode <= 57) || // [0-9]\n\t\t\t\t\t\t\t(keyCode > 95 && keyCode < 112) || // numpad\n\t\t\t\t\t\t\t(keyCode >= 64 && keyCode <= 91) || // [a-z]\n\t\t\t\t\t\t\t(keyCode > 185 && keyCode < 193) || //;=-,etc\n\t\t\t\t\t\t\t(keyCode > 218  && keyCode < 223)\n\t\t\t\t\t\t){\n\t\t\t\t\t\t\tvar modifiers = command.modifiers;\n\n\t\t\t\t\t\t\tvar anyModifier = modifiers.alt || modifiers.ctrl || modifiers.meta || modifiers.shift;\n\t\t\t\t\t\t\tif(modifiers.alt){\n\t\t\t\t\t\t\t\t// don't start editing on alt+key\n\t\t\t\t\t\t\t}else if (anyModifier && keyNav.getCommandHandler(command, \"taskCell\")){\n\t\t\t\t\t\t\t\t// don't start editing if command already have a keyboard shortcut\n\t\t\t\t\t\t\t}else if(hasEditor && !controller.isVisible()){\n\t\t\t\t\t\t\t\tself.startEdit(activeCell.id, activeCell.columnName);\n\t\t\t\t\t\t\t\tpreventKeyNav = true;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tbreak;\n\t\t\t}\n\n\t\t\tif (preventKeyNav){\n\t\t\t\treturn false;\n\t\t\t} else{\n\t\t\t\treturn true;\n\t\t\t}\n\n\t\t});\n\t},\n\tonShow: function(controller, placeholder, grid){},\n\tonHide: function(controller, placeholder, grid){\n\t\tconst gantt = grid.$gantt;\n\t\tif (gantt){\n\t\t\tgantt.focus();\n\t\t}\n\n\t},\n\tdestroy: function(){}\n};\n\n","export default function (gantt) {\n\n\tvar BaseEditor = function () {\n\t};\n\n\tBaseEditor.prototype = {\n\t\tshow: function (id, column, config, placeholder) {\n\t\t},\n\t\thide: function () {\n\t\t},\n\t\tset_value: function (value, id, column, node) {\n\t\t\tthis.get_input(node).value = value;\n\t\t},\n\t\tget_value: function (id, column, node) {\n\t\t\treturn this.get_input(node).value || \"\";\n\t\t},\n\t\tis_changed: function (value, id, column, node) {\n\t\t\tvar currentValue = this.get_value(id, column, node);\n\t\t\tif (currentValue && value && currentValue.valueOf && value.valueOf) {\n\t\t\t\treturn currentValue.valueOf() != value.valueOf();\n\t\t\t} else {\n\t\t\t\treturn currentValue != value;\n\t\t\t}\n\t\t},\n\t\tis_valid: function (value, id, column, node) {\n\t\t\treturn true;\n\t\t},\n\n\t\tsave: function (id, column, node) {\n\n\t\t},\n\t\tget_input: function (node) {\n\t\t\treturn node.querySelector(\"input\");\n\t\t},\n\t\tfocus: function (node) {\n\t\t\tvar input = this.get_input(node);\n\t\t\tif (!input) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tif (input.focus) {\n\t\t\t\tinput.focus();\n\t\t\t}\n\n\t\t\tif (input.select) {\n\t\t\t\tinput.select();\n\t\t\t}\n\t\t}\n\t};\n\treturn BaseEditor;\n};","import BaseFactory from \"./base\";\nimport * as utils from \"../../../../../utils/utils\";\nimport __extends from \"../../../../../utils/extends\";\n\n\nexport default function(gantt) {\n\n\tvar BaseEditor = BaseFactory(gantt);\n\n\tfunction TextEditor() {\n\t\tvar self = BaseEditor.apply(this, arguments) || this;\n\t\treturn self;\n\t}\n\n\t__extends(TextEditor, BaseEditor);\n\n\tutils.mixin(TextEditor.prototype, {\n\t\tshow: function (id, column, config, placeholder) {\n\t\t\tvar html = `<div role='cell'><input type='text' name='${column.name}' title='${column.name}'></div>`;\n\t\t\tplaceholder.innerHTML = html;\n\t\t}\n\t}, true);\n\n\treturn TextEditor;\n};","import BaseFactory from \"./base\";\nimport * as utils from \"../../../../../utils/utils\";\nimport __extends from \"../../../../../utils/extends\";\n\n\nexport default function(gantt) {\n\n\tvar BaseEditor = BaseFactory(gantt);\n\n\tfunction NumberEditor() {\n\t\tvar self = BaseEditor.apply(this, arguments) || this;\n\t\treturn self;\n\t}\n\n\t__extends(NumberEditor, BaseEditor);\n\n\tutils.mixin(NumberEditor.prototype, {\n\t\tshow: function (id, column, config, placeholder) {\n\t\t\tvar min = config.min || 0,\n\t\t\t\tmax = config.max || 100;\n\n\t\t\tvar html = `<div role='cell'><input type='number' min='${min}' max='${max}' name='${column.name}' title='${column.name}'></div>`;\n\t\t\tplaceholder.innerHTML = html;\n\n\t\t\t// GS-1914. Do not allow entering alues beyond min and max via keyboard\n\t\t\tplaceholder.oninput = function (e) {\n\t\t\t\tif (+e.target.value < min) {\n\t\t\t\t\te.target.value = min;\n\t\t\t\t}\n\t\t\t\tif (+e.target.value > max) {\n\t\t\t\t\te.target.value = max;\n\t\t\t\t}\n\t\t\t};\n\t\t},\n\t\tget_value: function (id, column, node) {\n\t\t\treturn this.get_input(node).value || \"\";\n\t\t},\n\t\tis_valid: function (value, id, column, node) {\n\t\t\treturn !isNaN(parseInt(value, 10));\n\t\t}\n\t}, true);\n\n\treturn NumberEditor;\n};","import BaseFactory from \"./base\";\nimport * as utils from \"../../../../../utils/utils\";\nimport __extends from \"../../../../../utils/extends\";\n\n\nexport default function(gantt) {\n\n\tvar BaseEditor = BaseFactory(gantt);\n\n\tfunction SelectEditor() {\n\t\tvar self = BaseEditor.apply(this, arguments) || this;\n\t\treturn self;\n\t}\n\n\t__extends(SelectEditor, BaseEditor);\n\n\tutils.mixin(SelectEditor.prototype, {\n\t\tshow: function (id, column, config, placeholder) {\n\t\t\tvar html = `<div role='cell'><select name='${column.name}' title='${column.name}'>`;\n\t\t\tvar optionsHtml = [],\n\t\t\t\toptions = config.options || [];\n\n\t\t\tfor (var i = 0; i < options.length; i++) {\n\t\t\t\toptionsHtml.push(\"<option value='\" + config.options[i].key + \"'>\" + options[i].label + \"</option>\");\n\t\t\t}\n\n\t\t\thtml += optionsHtml.join(\"\") + \"</select></div>\";\n\t\t\tplaceholder.innerHTML = html;\n\t\t},\n\t\tget_input: function (node) {\n\t\t\treturn node.querySelector(\"select\");\n\t\t}\n\t}, true);\n\n\treturn SelectEditor;\n};","import * as utils from \"../../../../../utils/utils\";\nimport __extends from \"../../../../../utils/extends\";\nimport BaseFactory from \"./base\";\n\nexport default function (gantt) {\n\tvar BaseEditor = BaseFactory(gantt);\n\t\n\t\n\n\tvar html5DateFormat = \"%Y-%m-%d\";\n\n\tvar dateToStr = null;\n\tvar strToDate = null;\n\n\tfunction init() {\n\t\tif (!dateToStr) {\n\t\t\tdateToStr = gantt.date.date_to_str(html5DateFormat);\n\t\t}\n\t\tif (!strToDate) {\n\t\t\tstrToDate = gantt.date.str_to_date(html5DateFormat);\n\t\t}\n\t}\n\n\tfunction DateEditor() {\n\t\tvar self = BaseEditor.apply(this, arguments) || this;\n\n\t\treturn self;\n\t}\n\n\t__extends(DateEditor, BaseEditor);\n\n\tutils.mixin(DateEditor.prototype, {\n\t\tshow: function (id, column, config, placeholder) {\n\t\t\tinit();\n\t\t\tvar minValue = null;\n\t\t\tvar maxValue = null;\n\n\t\t\tif(typeof config.min === \"function\"){\n\t\t\t\tminValue = config.min(id, column);\n\t\t\t}else{\n\t\t\t\tminValue = config.min;\n\t\t\t}\n\n\t\t\tif(typeof config.max === \"function\"){\n\t\t\t\tmaxValue = config.max(id, column);\n\t\t\t}else{\n\t\t\t\tmaxValue = config.max;\n\t\t\t}\n\n\t\t\tvar minAttr = minValue ? \" min='\" + dateToStr(minValue)+\"' \"  : \"\";\n\t\t\tvar maxAttr = maxValue ? \" max='\" + dateToStr(maxValue)+\"' \"  : \"\";\n\t\t\tvar html = `<div style='width:140px' role='cell'><input type='date' ${minAttr} ${maxAttr} name='${column.name}' title='${column.name}'></div>`;\n\t\t\tplaceholder.innerHTML = html;\n\n\t\t\t// GS-1914. Do not allow entering alues beyond min and max via keyboard\n\t\t\tplaceholder.oninput = function (e) {\n\t\t\t\tif (+gantt.date.str_to_date(\"%Y-%m-%d\")(e.target.value) < +minValue) {\n\t\t\t\t\te.target.value = gantt.date.date_to_str(\"%Y-%m-%d\")(minValue);\n\t\t\t\t}\n\t\t\t\tif (+gantt.date.str_to_date(\"%Y-%m-%d\")(e.target.value) > +maxValue) {\n\t\t\t\t\te.target.value = gantt.date.date_to_str(\"%Y-%m-%d\")(maxValue);\n\t\t\t\t}\n\t\t\t};\n\t\t},\n\t\tset_value: function (value, id, column, node) {\n\t\t\tif (value && value.getFullYear) {\n\t\t\t\tthis.get_input(node).value = dateToStr(value);\n\t\t\t} else {\n\t\t\t\tthis.get_input(node).value = value;\n\t\t\t}\n\t\t},\n\t\tis_valid: function (value, id, column, node) {\n\t\t\tif (!value || isNaN(value.getTime()))\n\t\t\t\treturn false;\n\t\t\treturn true;\n\t\t},\n\t\tget_value: function (id, column, node) {\n\t\t\tvar parsed;\n\t\t\ttry {\n\t\t\t\tparsed = strToDate(this.get_input(node).value || \"\");\n\t\t\t} catch (e) {\n\t\t\t\tparsed = null;// return null will cancel changes\n\t\t\t}\n\n\t\t\treturn parsed;\n\t\t}\n\t}, true);\n\n\treturn DateEditor;\n};\n","import BaseFactory from \"./base\";\nimport * as utils from \"../../../../../utils/utils\";\nimport __extends from \"../../../../../utils/extends\";\n\n\nexport default function(gantt) {\n\n\tvar BaseEditor = BaseFactory(gantt);\n\n\tfunction PredecessorEditor() {\n\t\tvar self = BaseEditor.apply(this, arguments) || this;\n\t\treturn self;\n\t}\n\n\t__extends(PredecessorEditor, BaseEditor);\n\n\tfunction getFormatter(config) {\n\t\treturn config.formatter || gantt.ext.formatters.linkFormatter();\n\t}\n\n\tfunction parseInputString(value, config) {\n\t\tvar predecessors = (value || \"\").split(config.delimiter || \",\");\n\t\tfor (var i = 0; i < predecessors.length; i++) {\n\t\t\tvar val = predecessors[i].trim();\n\t\t\tif (val) {\n\t\t\t\tpredecessors[i] = val;\n\t\t\t} else {\n\t\t\t\tpredecessors.splice(i, 1);\n\t\t\t\ti--;\n\t\t\t}\n\t\t}\n\t\tpredecessors.sort();\n\t\treturn predecessors;\n\t}\n\n\tfunction formatPredecessors(task, config, gantt) {\n\t\tvar links = task.$target;\n\t\tvar labels = [];\n\t\tfor (var i = 0; i < links.length; i++) {\n\t\t\tvar link = gantt.getLink(links[i]);\n\t\t\tlabels.push(getFormatter(config).format(link));\n\t\t}\n\t\treturn labels.join((config.delimiter || \",\") + \" \");\n\t}\n\n\tfunction getSelectedLinks(taskId, predecessorCodes, config) {\n\t\tvar links = [];\n\t\t// select only unique codes GS-1439\n\t\t[...new Set(predecessorCodes)].forEach(function (code) {\n\t\t\tvar link = getFormatter(config).parse(code);\n\t\t\tif(link){\n\t\t\t\tlink.target = taskId;\n\t\t\t\t// GS-1290 A way to preserve the link. Otherwise validation will return false\n\t\t\t\t// because the existing link ID is not passed there\n\t\t\t\tlink.id = \"predecessor_generated\";\n\t\t\t\tif (gantt.isLinkAllowed(link)) {\n\t\t\t\t\tlink.id = undefined;\n\t\t\t\t\tlinks.push(link);\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t\treturn links;\n\t}\n\n\tfunction formatLinkKey(link){\n\t\treturn link.source + \"_\" + link.target + \"_\" + link.type + \"_\" + (link.lag||0);\n\t}\n\n\tfunction getLinksDiff(task, predecessorCodes, config) {\n\t\tvar selectedLinks = getSelectedLinks(task.id, predecessorCodes, config);\n\t\tvar existingLinksSearch = {};\n\t\ttask.$target.forEach(function (linkId) {\n\t\t\tvar link = gantt.getLink(linkId);\n\t\t\texistingLinksSearch[formatLinkKey(link)] = link.id;\n\t\t});\n\n\t\tvar linksToAdd = [];\n\t\tselectedLinks.forEach(function (link) {\n\t\t\tvar linkKey = formatLinkKey(link);\n\t\t\tif (!existingLinksSearch[linkKey]) {\n\t\t\t\tlinksToAdd.push(link);\n\t\t\t} else {\n\t\t\t\tdelete existingLinksSearch[linkKey];\n\t\t\t}\n\t\t});\n\n\t\tvar linksToDelete = [];\n\t\tfor (var i in existingLinksSearch) {\n\t\t\tlinksToDelete.push(existingLinksSearch[i]);\n\t\t}\n\n\t\treturn {\n\t\t\tadd: linksToAdd,\n\t\t\tremove: linksToDelete\n\t\t};\n\t}\n\n\tutils.mixin(PredecessorEditor.prototype, {\n\t\tshow: function (id, column, config, placeholder) {\n\t\t\tvar html = `<div role='cell'><input type='text' name='${column.name}' title='${column.name}'></div>`;\n\t\t\tplaceholder.innerHTML = html;\n\t\t},\n\t\thide: function () {\n\t\t},\n\t\tset_value: function (value, id, column, node) {\n\t\t\tthis.get_input(node).value = formatPredecessors(value, column.editor, gantt);\n\t\t},\n\t\tget_value: function (id, column, node) {\n\t\t\treturn parseInputString((this.get_input(node).value || \"\"), column.editor);\n\t\t},\n\t\tsave: function (id, column, node) {\n\t\t\tvar task = gantt.getTask(id);\n\n\t\t\tvar linksDiff = getLinksDiff(task, this.get_value(id, column, node), column.editor);\n\n\t\t\tif (linksDiff.add.length || linksDiff.remove.length) {\n\t\t\t\tgantt.batchUpdate(function () {\n\t\t\t\t\tlinksDiff.add.forEach(function (link) {\n\t\t\t\t\t\tgantt.addLink(link);\n\t\t\t\t\t});\n\t\t\t\t\tlinksDiff.remove.forEach(function (linkId) {\n\t\t\t\t\t\tgantt.deleteLink(linkId);\n\t\t\t\t\t});\n\n\t\t\t\t\tif (gantt.autoSchedule)\n\t\t\t\t\t\tgantt.autoSchedule();\n\t\t\t\t});\n\t\t\t}\n\t\t},\n\t\tis_changed: function (value, id, column, node) {\n\t\t\tvar inputPredecessors = this.get_value(id, column, node);\n\t\t\tvar taskPredecessors = parseInputString(formatPredecessors(value, column.editor, gantt), column.editor);\n\n\t\t\treturn inputPredecessors.join() !== taskPredecessors.join();\n\t\t}\n\t}, true);\n\n\treturn PredecessorEditor;\n};","import BaseFactory from \"./base\";\nimport * as utils from \"../../../../../utils/utils\";\nimport __extends from \"../../../../../utils/extends\";\n\n\nexport default function(gantt) {\n\n\tvar BaseEditor = BaseFactory(gantt);\n\n\tfunction TextEditor() {\n\t\tvar self = BaseEditor.apply(this, arguments) || this;\n\t\treturn self;\n\t}\n\n\t__extends(TextEditor, BaseEditor);\n\n\tfunction getFormatter(config) {\n\t\treturn config.formatter || gantt.ext.formatters.durationFormatter();\n\t}\n\tutils.mixin(TextEditor.prototype, {\n\t\tshow: function (id, column, config, placeholder) {\n\t\t\tvar html = `<div role='cell'><input type='text' name='${column.name}' title='${column.name}'></div>`;\n\t\t\tplaceholder.innerHTML = html;\n\t\t},\n\t\tset_value: function (value, id, column, node) {\n\t\t\tthis.get_input(node).value = getFormatter(column.editor).format(value);\n\t\t},\n\t\tget_value: function (id, column, node) {\n\t\t\treturn getFormatter(column.editor).parse(this.get_input(node).value || \"\");\n\t\t}\n\t}, true);\n\n\treturn TextEditor;\n};","export default function (gantt) {\n\treturn function processTaskDateProperties(item, mapTo, mode) {\n\t\tif (mode == \"keepDates\") {\n\t\t\tkeepDatesOnEdit(item, mapTo);\n\t\t} else if (mode == \"keepDuration\") {\n\t\t\tkeepDurationOnEdit(item, mapTo);\n\t\t} else {\n\t\t\tdefaultActionOnEdit(item, mapTo);\n\t\t}\n\t};\n\n\t// resize task\n\t// resize task when start/end/duration changes\n\tfunction keepDatesOnEdit(item, mapTo) {\n\t\tif (mapTo == \"duration\") {\n\t\t\titem.end_date = gantt.calculateEndDate(item);\n\t\t} else if (mapTo == \"end_date\" || mapTo == \"start_date\") {\n\t\t\titem.duration = gantt.calculateDuration(item);\n\t\t}\n\t}\n\n\t// move task(before 6.2)\n\t// move task when start/end dates changes\n\t// resize task when duration changes\n\tfunction keepDurationOnEdit(item, mapTo) {\n\t\tif (mapTo == \"end_date\") {\n\t\t\titem.start_date = decreaseStartDate(item);\n\t\t} else if (mapTo == \"start_date\" || mapTo == \"duration\") {\n\t\t\titem.end_date = gantt.calculateEndDate(item);\n\t\t}\n\t}\n\n\t// default behavior\n\t// move task when start date changes\n\t// resize task when end date/duration changes\n\tfunction defaultActionOnEdit(item, mapTo) {\n\t\tif (gantt.config.schedule_from_end){\n\t\t\tif (mapTo == \"end_date\" || mapTo == \"duration\") {\n\t\t\t\titem.start_date = decreaseStartDate(item);\n\t\t\t} else if (mapTo == \"start_date\") {\n\t\t\t\titem.duration = gantt.calculateDuration(item);\n\t\t\t}\n\t\t} else {\n\t\t\tif (mapTo == \"start_date\" || mapTo == \"duration\") {\n\t\t\t\titem.end_date = gantt.calculateEndDate(item);\n\t\t\t} else if (mapTo == \"end_date\") {\n\t\t\t\titem.duration = gantt.calculateDuration(item);\n\t\t\t}\n\t\t}\n\t}\n\n\tfunction decreaseStartDate(item){\n\t\treturn gantt.calculateEndDate({\n\t\t\tstart_date: item.end_date,\n\t\t\tduration: -item.duration,\n\t\t\ttask: item\n\t\t});\n\t}\n};","import getKeyboardMapping from \"./keyboard_mappings\";\nimport textEditorFactory from \"./editors/text\";\nimport numberEditorFactory from \"./editors/number\";\nimport selectEditorFactory from \"./editors/select\";\nimport dateEditorFactory from \"./editors/date\";\nimport predecessorEditorFactory from \"./editors/predecessor\";\nimport durationEditorFactory from \"./editors/duration\";\nimport * as utils from \"../../../../utils/utils\";\nimport * as domHelpers from \"../../utils/dom_helpers\";\nimport eventable from \"../../../../utils/eventable\";\nimport linkedPropertiesProcessor from \"./linked_properties\";\n\nfunction initConfigs(gantt){\n\tgantt.config.editor_types = {\n\t\ttext: new (textEditorFactory(gantt))(),\n\t\tnumber: new (numberEditorFactory(gantt))(),\n\t\tselect: new (selectEditorFactory(gantt))(),\n\t\tdate: new (dateEditorFactory(gantt))(),\n\t\tpredecessor: new (predecessorEditorFactory(gantt))(),\n\t\tduration: new (durationEditorFactory(gantt))()\n\t};\n}\n\nfunction create(gantt){\n\tvar keyboardMapping = getKeyboardMapping(gantt);\n\n\tvar eventBus = {};\n\teventable(eventBus);\n\n\tfunction createGridEditors(grid) {\n\n\t\tfunction _getGridCellFromNode(node){\n\t\t\tif(!domHelpers.isChildOf(node, grid.$grid)){\n\t\t\t\treturn null;\n\t\t\t}\n\n\t\t\tvar row = domHelpers.locateAttribute(node, grid.$config.item_attribute);\n\t\t\tvar cell = domHelpers.locateAttribute(node, \"data-column-name\");\n\t\t\tif(row && cell){\n\t\t\t\tvar columnName = cell.getAttribute(\"data-column-name\");\n\t\t\t\tvar id = row.getAttribute(grid.$config.item_attribute);\n\t\t\t\treturn {\n\t\t\t\t\tid: id,\n\t\t\t\t\tcolumnName: columnName\n\t\t\t\t};\n\t\t\t}\n\t\t\treturn null;\n\n\t\t}\n\n\t\tfunction _getEditorPosition(itemId, columnName) {\n\t\t\tvar config = grid.$getConfig();\n\t\t\tvar top = grid.getItemTop(itemId);\n\t\t\tvar height = grid.getItemHeight(itemId);\n\t\t\tvar cols = grid.getGridColumns();\n\t\t\tvar left = 0,\n\t\t\t\tright = 0,\n\t\t\t\twidth = 0;\n\n\t\t\tfor (var i = 0; i < cols.length; i++) {\n\t\t\t\tif (cols[i].name == columnName) {\n\t\t\t\t\twidth = cols[i].width;\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t\tif (config.rtl) {\n\t\t\t\t\tright += cols[i].width;\n\t\t\t\t}\telse {\n\t\t\t\t\tleft += cols[i].width;\n\t\t\t\t}\n\n\t\t\t}\n\t\t\tif (config.rtl) {\n\t\t\t\treturn {\n\t\t\t\t\ttop: top,\n\t\t\t\t\tright: right,\n\t\t\t\t\theight: height,\n\t\t\t\t\twidth: width\n\t\t\t\t};\n\t\t\t} else {\n\t\t\t\treturn {\n\t\t\t\t\ttop: top,\n\t\t\t\t\tleft: left,\n\t\t\t\t\theight: height,\n\t\t\t\t\twidth: width\n\t\t\t\t};\n\t\t\t}\n\n\t\t}\n\n\t\tfunction findVisibleIndex(grid, columnName) {\n\t\t\tvar columns = grid.getGridColumns();\n\t\t\tfor (var i = 0; i < columns.length; i++){\n\t\t\t\tif(columns[i].name == columnName){\n\t\t\t\t\treturn i;\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn 0;\n\t\t}\n\n\t\tfunction _createPlaceholder(itemId, columnName) {\n\t\t\tvar config = grid.$getConfig();\n\t\t\tvar pos = _getEditorPosition(itemId, columnName);\n\t\t\tvar el = document.createElement(\"div\");\n\t\t\tel.className = \"gantt_grid_editor_placeholder\";\n\t\t\tel.setAttribute(grid.$config.item_attribute, itemId);\n\t\t\tel.setAttribute(grid.$config.bind + \"_id\", itemId);// for backward compatibility\n\n\t\t\tel.setAttribute(\"data-column-name\", columnName);\n\n\t\t\tvar visibleIndex = findVisibleIndex(grid, columnName);\n\t\t\tel.setAttribute(\"data-column-index\", visibleIndex);\n\n\t\t\tgantt._waiAria.inlineEditorAttr(el);\n\n\t\t\tif (config.rtl) {\n\t\t\t\tel.style.cssText = [\n\t\t\t\t\t\"top:\" + pos.top + \"px\",\n\t\t\t\t\t\"right:\" + pos.right + \"px\",\n\t\t\t\t\t\"width:\" + pos.width + \"px\",\n\t\t\t\t\t\"height:\" + pos.height + \"px\"\n\t\t\t\t].join(\";\");\n\t\t\t} else {\n\t\t\t\tel.style.cssText = [\n\t\t\t\t\t\"top:\" + pos.top + \"px\",\n\t\t\t\t\t\"left:\" + pos.left + \"px\",\n\t\t\t\t\t\"width:\" + pos.width + \"px\",\n\t\t\t\t\t\"height:\" + pos.height + \"px\"\n\t\t\t\t].join(\";\");\n\t\t\t}\n\n\t\t\treturn el;\n\t\t}\n\n\t\tvar updateTaskDateProperties = linkedPropertiesProcessor(gantt);\n\n\t\tvar handlers = [];\n\t\tvar ganttHandlers = [];\n\t\tvar store = null;\n\t\tvar controller = {\n\t\t\t_itemId: null,\n\t\t\t_columnName: null,\n\t\t\t_editor: null,\n\t\t\t_editorType: null,\n\t\t\t_placeholder: null,\n\n\t\t\tlocateCell: _getGridCellFromNode,\n\t\t\tgetEditorConfig: function (columnName) {\n\t\t\t\tvar column = grid.getColumn(columnName);\n\t\t\t\treturn column.editor;\n\t\t\t},\n\n\t\t\tinit: function () {\n\t\t\t\tvar mapping = keyboardMapping.getMapping();\n\t\t\t\tif(mapping.init){\n\t\t\t\t\tmapping.init(this, grid);\n\t\t\t\t}\n\n\t\t\t\tstore = grid.$gantt.getDatastore(grid.$config.bind);\n\n\t\t\t\tvar self = this;\n\n\t\t\t\thandlers.push(store.attachEvent(\"onIdChange\", function(oldId, newId){\n\t\t\t\t\tif(self._itemId == oldId){\n\t\t\t\t\t\tself._itemId = newId;\n\t\t\t\t\t}\n\t\t\t\t}));\n\t\t\t\thandlers.push(store.attachEvent(\"onStoreUpdated\", function(){\n\t\t\t\t\tif(grid.$gantt.getState(\"batchUpdate\").batch_update){\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tif(self.isVisible() && !store.isVisible(self._itemId)){\n\t\t\t\t\t\tself.hide();\n\t\t\t\t\t}\n\t\t\t\t}));\n\n\t\t\t\tganttHandlers.push(gantt.attachEvent(\"onDataRender\", function(){\n\t\t\t\t\tif(self._editor && self._placeholder && !domHelpers.isChildOf(self._placeholder, gantt.$root)){\n\t\t\t\t\t\tgrid.$grid_data.appendChild(self._placeholder);\n\t\t\t\t\t}\n\t\t\t\t}));\n\n\t\t\t\tthis.init = function(){};\n\t\t\t},\n\n\t\t\tgetState: function(){\n\t\t\t\treturn {\n\t\t\t\t\teditor: this._editor,\n\t\t\t\t\teditorType: this._editorType,\n\t\t\t\t\tplaceholder: this._placeholder,\n\t\t\t\t\tid: this._itemId,\n\t\t\t\t\tcolumnName: this._columnName\n\t\t\t\t};\n\t\t\t},\n\n\t\t\tstartEdit: function(itemId, columnName) {\n\t\t\t\tif (this.isVisible()) {\n\t\t\t\t\tthis.save();\n\t\t\t\t}\n\n\t\t\t\tif(!store.exists(itemId)){\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tvar editorState = {id: itemId, columnName: columnName};\n\t\t\t\tif (gantt.isReadonly(store.getItem(itemId))) {\n\t\t\t\t\tthis.callEvent(\"onEditPrevent\", [editorState]);\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tif (this.callEvent(\"onBeforeEditStart\", [editorState]) === false) {\n\t\t\t\t\tthis.callEvent(\"onEditPrevent\", [editorState]);\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tthis.show(editorState.id, editorState.columnName);\n\t\t\t\tthis.setValue();\n\n\t\t\t\tthis.callEvent(\"onEditStart\", [editorState]);\n\t\t\t},\n\t\t\tisVisible: function(){\n\t\t\t\treturn !!(this._editor && domHelpers.isChildOf(this._placeholder, gantt.$root));\n\t\t\t},\n\t\t\tshow: function (itemId, columnName) {\n\t\t\t\tif (this.isVisible()) {\n\t\t\t\t\tthis.save();\n\t\t\t\t}\n\t\t\t\tvar editorState = {id: itemId, columnName: columnName};\n\n\t\t\t\tvar column = grid.getColumn(editorState.columnName);\n\t\t\t\tvar editorConfig = this.getEditorConfig(column.name);\n\t\t\t\tif(!editorConfig)\n\t\t\t\t\treturn;\n\n\t\t\t\tvar editor = grid.$getConfig().editor_types[editorConfig.type];\n\n\t\t\t\tvar placeholder = _createPlaceholder(editorState.id, editorState.columnName);\n\t\t\t\tgrid.$grid_data.appendChild(placeholder);\n\t\t\t\teditor.show(editorState.id, column, editorConfig, placeholder);\n\t\t\t\tthis._editor = editor;\n\t\t\t\tthis._placeholder = placeholder;\n\t\t\t\tthis._itemId = editorState.id;\n\t\t\t\tthis._columnName = editorState.columnName;\n\t\t\t\tthis._editorType = editorConfig.type;\n\n\t\t\t\tvar mapping = keyboardMapping.getMapping();\n\t\t\t\tif(mapping.onShow){\n\t\t\t\t\tmapping.onShow(this, placeholder, grid);\n\t\t\t\t}\n\t\t\t},\n\n\t\t\tsetValue: function () {\n\t\t\t\tvar state = this.getState();\n\t\t\t\tvar itemId = state.id,\n\t\t\t\t\tcolumnName = state.columnName;\n\n\t\t\t\tvar column = grid.getColumn(columnName);\n\t\t\t\tvar item = store.getItem(itemId);\n\t\t\t\tvar editorConfig = this.getEditorConfig(columnName);\n\n\t\t\t\tif(!editorConfig)\n\t\t\t\t\treturn;\n\n\t\t\t\tvar value = item[editorConfig.map_to];\n\t\t\t\tif(editorConfig.map_to == \"auto\"){\n\t\t\t\t\tvalue = store.getItem(itemId);\n\t\t\t\t}\n\n\t\t\t\tthis._editor.set_value(value, itemId, column, this._placeholder);\n\t\t\t\tthis.focus();\n\t\t\t},\n\n\t\t\tfocus: function(){\n\t\t\t\tthis._editor.focus(this._placeholder);\n\t\t\t},\n\n\t\t\tgetValue: function () {\n\t\t\t\tvar column = grid.getColumn(this._columnName);\n\t\t\t\treturn this._editor.get_value(this._itemId, column, this._placeholder);\n\t\t\t},\n\n\t\t\t_getItemValue: function() {\n\t\t\t\tvar editorConfig = this.getEditorConfig(this._columnName);\n\n\t\t\t\tif(!editorConfig)\n\t\t\t\t\treturn;\n\n\t\t\t\tvar item = gantt.getTask(this._itemId);\n\t\t\t\tvar value = item[editorConfig.map_to];\n\t\t\t\tif(editorConfig.map_to == \"auto\"){\n\t\t\t\t\tvalue = store.getItem(this._itemId);\n\t\t\t\t}\n\t\t\t\treturn value;\n\t\t\t},\n\n\t\t\tisChanged: function(){\n\n\t\t\t\tvar column = grid.getColumn(this._columnName);\n\n\t\t\t\tvar value = this._getItemValue();\n\n\t\t\t\treturn this._editor.is_changed(value, this._itemId, column, this._placeholder);\n\t\t\t},\n\n\t\t\thide: function () {\n\t\t\t\tif(!this._itemId)\n\t\t\t\t\treturn;\n\n\t\t\t\tvar itemId = this._itemId,\n\t\t\t\t\tcolumnName = this._columnName;\n\n\t\t\t\tvar mapping = keyboardMapping.getMapping();\n\t\t\t\tif(mapping.onHide){\n\t\t\t\t\tmapping.onHide(this, this._placeholder, grid);\n\t\t\t\t}\n\n\t\t\t\tthis._itemId = null;\n\t\t\t\tthis._columnName = null;\n\t\t\t\tthis._editorType = null;\n\t\t\t\tif (!this._placeholder) return;\n\n\t\t\t\tif (this._editor && this._editor.hide) {\n\t\t\t\t\tthis._editor.hide(this._placeholder);\n\t\t\t\t}\n\t\t\t\tthis._editor = null;\n\t\t\t\tif (this._placeholder.parentNode) {\n\t\t\t\t\tthis._placeholder.parentNode.removeChild(this._placeholder);\n\t\t\t\t}\n\t\t\t\tthis._placeholder = null;\n\n\t\t\t\tthis.callEvent(\"onEditEnd\", [{id: itemId, columnName: columnName}]);\n\t\t\t},\n\t\t\tsave: function () {\n\t\t\t\tif(!(this.isVisible() && store.exists(this._itemId) && this.isChanged())) {\n\t\t\t\t\tthis.hide();\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tvar itemId = this._itemId,\n\t\t\t\t\tcolumnName = this._columnName;\n\n\t\t\t\tif(!store.exists(itemId)) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tvar item = store.getItem(itemId);\n\t\t\t\tvar editorConfig = this.getEditorConfig(columnName);\n\t\t\t\tvar editorState = {\n\t\t\t\t\tid: itemId,\n\t\t\t\t\tcolumnName: columnName,\n\t\t\t\t\tnewValue: this.getValue(),\n\t\t\t\t\toldValue: this._getItemValue()\n\t\t\t\t};\n\t\t\t\tif (this.callEvent(\"onBeforeSave\", [editorState]) !== false) {\n\t\t\t\t\tif (!this._editor.is_valid || this._editor.is_valid(editorState.newValue, editorState.id, grid.getColumn(columnName), this._placeholder)) {\n\n\t\t\t\t\t\tvar mapTo = editorConfig.map_to;\n\t\t\t\t\t\tvar value = editorState.newValue;\n\t\t\t\t\t\tif (mapTo != \"auto\") {\n\t\t\t\t\t\t\titem[mapTo] = value;\n\t\t\t\t\t\t\tupdateTaskDateProperties(item, mapTo, gantt.config.inline_editors_date_processing);\n\n\t\t\t\t\t\t\tstore.updateItem(itemId);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tthis._editor.save(itemId, grid.getColumn(columnName), this._placeholder);\n\t\t\t\t\t\t}\n\t\t\t\t\t\tthis.callEvent(\"onSave\", [editorState]);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tthis.hide();\n\t\t\t},\n\n\t\t\t_findEditableCell: function findEditableCell(start, direction){\n\t\t\t\tvar nextIndex = start;\n\t\t\t\tvar columns = grid.getGridColumns();\n\t\t\t\tvar nextColumn = columns[nextIndex];\n\n\t\t\t\tvar columnName = nextColumn ? nextColumn.name : null;\n\t\t\t\tif(columnName){\n\t\t\t\t\twhile(columnName && !this.getEditorConfig(columnName)){\n\t\t\t\t\t\tcolumnName = this._findEditableCell(start + direction, direction);\n\t\t\t\t\t}\n\t\t\t\t\treturn columnName;\n\t\t\t\t}\n\t\t\t\treturn null;\n\t\t\t},\n\n\t\t\tgetNextCell: function moveCell(dir){\n\t\t\t\t// GS-1257. true means to exclude hidden columns\n\t\t\t\treturn this._findEditableCell(grid.getColumnIndex(this._columnName, true) + dir, dir);\n\t\t\t},\n\n\t\t\tgetFirstCell: function getFirstCell(){\n\t\t\t\treturn this._findEditableCell(0, 1);\n\t\t\t},\n\n\t\t\tgetLastCell: function getLastCell(){\n\t\t\t\treturn this._findEditableCell(grid.getGridColumns().length - 1, -1);\n\t\t\t},\n\n\t\t\teditNextCell: function nextCell(canChangeRow){\n\t\t\t\tvar cell = this.getNextCell(1);\n\t\t\t\tif(cell){\n\t\t\t\t\tvar nextColumn = this.getNextCell(1);\n\t\t\t\t\tif(nextColumn && this.getEditorConfig(nextColumn)){\n\t\t\t\t\t\tthis.startEdit(this._itemId, nextColumn);\n\t\t\t\t\t}\n\t\t\t\t}else if(canChangeRow && this.moveRow(1)){\n\t\t\t\t\tvar task = this.moveRow(1);\n\t\t\t\t\tcell = this.getFirstCell();\n\t\t\t\t\tif(cell && this.getEditorConfig(cell)){\n\t\t\t\t\t\tthis.startEdit(task, cell);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t},\n\n\t\t\teditPrevCell: function prevCell(canChangeRow){\n\t\t\t\tvar cell = this.getNextCell(-1);\n\t\t\t\tif(cell){\n\t\t\t\t\tvar nextColumn = this.getNextCell(-1);\n\t\t\t\t\tif(nextColumn && this.getEditorConfig(nextColumn)){\n\t\t\t\t\t\tthis.startEdit(this._itemId, nextColumn);\n\t\t\t\t\t}\n\t\t\t\t}else if(canChangeRow && this.moveRow(-1)){\n\t\t\t\t\tvar task = this.moveRow(-1);\n\t\t\t\t\tcell = this.getLastCell();\n\t\t\t\t\tif(cell && this.getEditorConfig(cell)){\n\t\t\t\t\t\tthis.startEdit(task, cell);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t},\n\n\t\t\tmoveRow: function moveRow(dir) {\n\t\t\t\tvar moveTask = dir > 0 ? gantt.getNext : gantt.getPrev;\n\t\t\t\tmoveTask = gantt.bind(moveTask, gantt);\n\n\t\t\t\tvar nextItem = moveTask(this._itemId);\n\t\t\t\t// skip readonly rows\n\t\t\t\twhile (gantt.isTaskExists(nextItem) && gantt.isReadonly(gantt.getTask(nextItem))) {\n\t\t\t\t\tnextItem = moveTask(nextItem);\n\t\t\t\t}\n\t\t\t\treturn nextItem;\n\t\t\t},\n\n\t\t\teditNextRow: function nextRow(skipReadonly){\n\t\t\t\tvar id = this.getState().id;\n\t\t\t\tif (!gantt.isTaskExists(id)) return;\n\n\t\t\t\tvar next = null;\n\t\t\t\tif (skipReadonly){\n\t\t\t\t\tnext = this.moveRow(1);\n\t\t\t\t}\n\t\t\t\telse{\n\t\t\t\t\tnext = gantt.getNext(id);\n\t\t\t\t}\n\n\t\t\t\tif (gantt.isTaskExists(next)){\n\t\t\t\t\tthis.startEdit(next, this._columnName);\n\t\t\t\t}\n\t\t\t},\n\n\t\t\teditPrevRow: function prevRow(skipReadonly){\n\t\t\t\tvar id = this.getState().id;\n\t\t\t\tif (!gantt.isTaskExists(id)) return;\n\n\t\t\t\tvar prev = null;\n\t\t\t\tif (skipReadonly){\n\t\t\t\t\tprev = this.moveRow(-1);\n\t\t\t\t}\n\t\t\t\telse{\n\t\t\t\t\tprev = gantt.getPrev(id);\n\t\t\t\t}\n\n\t\t\t\tif (gantt.isTaskExists(prev)){\n\t\t\t\t\tthis.startEdit(prev, this._columnName);\n\t\t\t\t}\n\t\t\t},\n\t\t\tdetachStore: function(){\n\t\t\t\thandlers.forEach(function(handlerId){\n\t\t\t\t\tstore.detachEvent(handlerId);\n\t\t\t\t});\n\n\t\t\t\tganttHandlers.forEach(function(handlerId){\n\t\t\t\t\tgantt.detachEvent(handlerId);\n\t\t\t\t});\n\t\t\t\thandlers = [];\n\t\t\t\tganttHandlers = [];\n\n\t\t\t\tstore = null;\n\t\t\t\tthis.hide();\n\t\t\t},\n\t\t\tdestructor: function(){\n\t\t\t\tthis.detachStore();\n\t\t\t\tthis.detachAllEvents();\n\t\t\t}\n\t\t};\n\n\t\tutils.mixin(controller, keyboardMapping);\n\t\tutils.mixin(controller, eventBus);\n\n\t\treturn controller;\n\t}\n\n\n\tvar inlineEditController = {\n\t\tinit: initConfigs,\n\t\tcreateEditors: createGridEditors\n\t};\n\n\tutils.mixin(inlineEditController, keyboardMapping);\n\tutils.mixin(inlineEditController, eventBus);\n\n\treturn inlineEditController;\n}\n\n\n\n\nexport default create;","import defaultMapping from \"./keyboard_mappings/default\";\nimport keyNavMappings from \"./keyboard_mappings/keyboard_navigation\";\n\nexport default function(gantt){\n\n\tvar mapping = null;\n\n\treturn {\n\t\tsetMapping: function(map){\n\t\t\tmapping = map;\n\t\t},\n\t\tgetMapping: function(){\n\n\t\t\tif(mapping){\n\t\t\t\treturn mapping;\n\t\t\t}else if(gantt.config.keyboard_navigation_cells && gantt.ext.keyboardNavigation){\n\t\t\t\treturn keyNavMappings;\n\t\t\t}else{\n\t\t\t\treturn defaultMapping;\n\t\t\t}\n\t\t}\n\t};\n};\n","// optimized checker for task bars smart rendering\n\n// first check the vertical position since it's easier to calculate\nexport default function isBarInViewport(item, viewport, view, config, gantt){\n\tif(!item.start_date || !item.end_date){\n\t\treturn null;\n\t}\n\n\tvar top = view.getItemTop(item.id);\n\tvar height = view.getItemHeight(item.id);\n\n\tif(top > viewport.y_end || top + height < viewport.y){\n\t\treturn false;\n\t}\n\n\tvar padding = 200;\n\tvar startCoord = view.posFromDate(item.start_date);\n\tvar endCoord = view.posFromDate(item.end_date);\n\tvar left = Math.min(startCoord, endCoord) - padding;\n\tvar right = Math.max(startCoord, endCoord) + padding;\n\n\tif(left > viewport.x_end || right < viewport.x){\n\t\treturn false;\n\t}\n\n\treturn true;\n};","function createTaskRenderer(gantt) {\n\n\tfunction _render_task_element(task, view, config) {\n\t\tvar config = view.$getConfig();\n\t\tvar painters = config.type_renderers;\n\t\tvar renderer = painters[gantt.getTaskType(task.type)],\n\t\t\tdefaultRenderer = _task_default_render;\n\n\t\tif (!renderer) {\n\t\t\treturn defaultRenderer.call(gantt, task, view, config);\n\t\t}else{\n\t\t\treturn renderer.call(gantt, task, function(task){ return defaultRenderer.call(gantt, task, view, config);}, view);\n\t\t}\n\t}\n\n\tfunction _task_default_render(task, view, config) {\n\t\tif (gantt._isAllowedUnscheduledTask(task))\n\t\t\treturn;\n\n\t\tif (!gantt._isTaskInTimelineLimits(task)) {\n\t\t\treturn;\n\t\t}\n\n\t\tvar pos = view.getItemPosition(task);\n\n\t\tvar cfg = config,\n\t\t\ttemplates = view.$getTemplates();\n\n\t\tvar taskType = gantt.getTaskType(task.type);\n\t\tvar height = view.getBarHeight(task.id, taskType == cfg.types.milestone);\n\n\t\tvar controlsMargin = 0;\n\t\tif (taskType == cfg.types.milestone) {\n\t\t\tcontrolsMargin = (height - pos.height)/2;\n\t\t}\n\n\t\tvar padd = Math.floor((view.getItemHeight(task.id) - height) / 2);\n\t\tconst hasBaselines = gantt.config.baselines !== false && task.baselines && task.baselines.length;\n\t\tconst baselinesOnDifferentRow = gantt.config.baselines !== false && (gantt.config.baselines.render_mode == \"separateRow\" || gantt.config.baselines.render_mode == \"individualRow\");\n\t\tif (hasBaselines && baselinesOnDifferentRow){\n\t\t\tif (task.bar_height !== \"full\" && task.bar_height < task.row_height){\n\t\t\t\tif (taskType === cfg.types.milestone){\n\t\t\t\t\tlet milestoneHeight = view.getBarHeight(task.id, true);\n\t\t\t\t\tlet milestoneWidth = Math.sqrt(2 * milestoneHeight * milestoneHeight);\n\t\t\t\t\tpadd = Math.floor((milestoneWidth - height) / 2) + 2;\n\t\t\t\t} else {\n\t\t\t\t\tpadd = 2;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t//\tif(task.type == cfg.types.milestone){\n\t//\t\tpadd -= 1;\n\t//\t}\n\t//\tif (taskType == cfg.types.milestone && cfg.link_line_width > 1) {\n\t//\t\t//little adjust milestone position, so horisontal corners would match link arrow when thickness of link line is more than 1px\n\t//\t\tpadd += 1;\n\t//\t}\n\n\t\tif (taskType == cfg.types.milestone) {\n\t\t\tpos.left -= Math.round(height / 2);\n\t\t\tpos.width = height;\n\t\t}\n\n\t\tvar div = document.createElement(\"div\");\n\n\t\tvar width = Math.round(pos.width);\n\n\t\tif(view.$config.item_attribute) {\n\t\t\tdiv.setAttribute(view.$config.item_attribute, task.id);\n\t\t\tdiv.setAttribute(view.$config.bind + \"_id\", task.id); // 'task_id'/'resource_id' for backward compatibility\n\t\t}\n\n\t\tif (cfg.show_progress && taskType != cfg.types.milestone) {\n\t\t\t_render_task_progress(task, div, width, cfg, templates);\n\t\t}\n\n\t\t//use separate div to display content above progress bar\n\t\tvar content = _render_task_content(task, width, templates);\n\n\t\tdiv.appendChild(content);\n\n\t\tvar css = _combine_item_class(\"gantt_task_line\",\n\t\t\ttemplates.task_class(task.start_date, task.end_date, task),\n\t\t\ttask.id,\n\t\t\tview);\n\t\tif (task.color || task.progressColor || task.textColor) {\n\t\t\tcss += \" gantt_task_inline_color\";\n\t\t}\n\t\tif (pos.width < 20){\n\t\t\tcss += \" gantt_thin_task\";\n\t\t}\n\t\tdiv.className = css;\n\n\t\tvar styles = [\n\t\t\t\"left:\" + pos.left + \"px\",\n\t\t\t\"top:\" + (padd + pos.top) + 'px',\n\t\t\t\"height:\" + (height) + 'px',\n\t\t\t\"line-height:\" + (Math.max(height < 30 ? height - 2 : height, 0)) + 'px',\n\t\t\t\"width:\" + width + 'px'\n\t\t];\n\n\t\tdiv.style.cssText = styles.join(\";\");\n\t\tif (task.color) {\n\t\t\tdiv.style.setProperty(\"--dhx-gantt-task-background\", task.color);\n\t\t}\n\t\tif (task.textColor) {\n\t\t\tdiv.style.setProperty(\"--dhx-gantt-task-color\", task.textColor);\n\t\t}\n\n\t\tif (task.progressColor) {\n\t\t\tdiv.style.setProperty(\"--dhx-gantt-task-progress-color\", task.progressColor);\n\t\t}\n\n\t\t\n\t\tvar side = _render_leftside_content(task, cfg, templates, controlsMargin);\n\t\tif (side) div.appendChild(side);\n\n\t\tside = _render_rightside_content(task, cfg, templates, controlsMargin);\n\t\tif (side) div.appendChild(side);\n\n\t\tgantt._waiAria.setTaskBarAttr(task, div);\n\n\t\tvar state = gantt.getState();\n\n\t\tif (!gantt.isReadonly(task)) {\n\t\t\tif (cfg.drag_resize && !gantt.isSummaryTask(task) && taskType != cfg.types.milestone) {\n\t\t\t\t_render_pair(div, \"gantt_task_drag\", task, function (css) {\n\t\t\t\t\tvar el = document.createElement(\"div\");\n\t\t\t\t\tel.className = css;\n\t\t\t\t\treturn el;\n\t\t\t\t}, cfg);\n\t\t\t}\n\t\t\tif (cfg.drag_links && cfg.show_links) {\n\t\t\t\t_render_pair(div, \"gantt_link_control\", task, function (css) {\n\t\t\t\t\tvar outer = document.createElement(\"div\");\n\t\t\t\t\touter.className = css;\n\t\t\t\t\touter.style.cssText = [\n\t\t\t\t\t\t\"height:\" + height + 'px',\n\t\t\t\t\t\t\"line-height:\" + height + 'px'\n\t\t\t\t\t].join(\";\");\n\t\t\t\t\tvar inner = document.createElement(\"div\");\n\t\t\t\t\tinner.className = \"gantt_link_point\";\n\n\t\t\t\t\tvar showLinkPoints = false;\n\t\t\t\t\tif(state.link_source_id && cfg.touch){\n\t\t\t\t\t\tshowLinkPoints = true;\n\t\t\t\t\t}\n\n\t\t\t\t\tinner.style.display = showLinkPoints ? \"block\" : \"\";\n\t\t\t\t\touter.appendChild(inner);\n\t\t\t\t\treturn outer;\n\t\t\t\t}, cfg, controlsMargin);\n\t\t\t}\n\t\t}\n\t\treturn div;\n\t}\n\n\tfunction _render_side_content(task, template, cssClass, marginStyle) {\n\t\tif (!template) return null;\n\n\t\tvar text = template(task.start_date, task.end_date, task);\n\t\tif (!text) return null;\n\t\tvar content = document.createElement(\"div\");\n\t\tcontent.className = \"gantt_side_content \" + cssClass;\n\t\tcontent.innerHTML = text;\n\t\tif(marginStyle){\n\t\t\tcontent.style[marginStyle.type] = Math.abs(marginStyle.value) + \"px\";\n\t\t}\n\t\treturn content;\n\t}\n\n\tfunction _render_leftside_content(task, cfg, templates, margin) {\n\t\tvar css = \"gantt_left \" + _get_link_crossing_css(!cfg.rtl ? true : false, task, cfg);\n\t\tvar marginStyle = null;\n\t\tif(margin){\n\t\t\tmarginStyle = { type: \"marginRight\", value: margin };\n\t\t}\n\t\treturn _render_side_content(task, templates.leftside_text, css, marginStyle);\n\t}\n\n\tfunction _render_rightside_content(task, cfg, templates, margin) {\n\t\tvar css = \"gantt_right \" + _get_link_crossing_css(!cfg.rtl ? false : true, task, cfg);\n\t\tvar marginStyle = null;\n\t\tif(margin){\n\t\t\tmarginStyle = { type: \"marginLeft\", value: margin };\n\t\t}\n\t\treturn _render_side_content(task, templates.rightside_text, css, marginStyle);\n\t}\n\n\tfunction _get_link_crossing_css(left, task) {\n\t\tvar cond = _get_conditions(left);\n\n\t\tfor (var i in cond) {\n\t\t\tvar links = task[i];\n\t\t\tfor (var ln = 0; ln < links.length; ln++) {\n\t\t\t\tvar link = gantt.getLink(links[ln]);\n\n\t\t\t\tfor (var tp = 0; tp < cond[i].length; tp++) {\n\t\t\t\t\tif (link.type == cond[i][tp]) {\n\t\t\t\t\t\treturn \"gantt_link_crossing\";\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\treturn \"\";\n\t}\n\n\n\tfunction _render_task_content(task, width, templates) {\n\t\tvar content = document.createElement(\"div\");\n\t\tif (gantt.getTaskType(task.type) != gantt.config.types.milestone){\n\t\t\tcontent.innerHTML = templates.task_text(task.start_date, task.end_date, task);\n\t\t} else if(gantt.getTaskType(task.type) == gantt.config.types.milestone && width) {\n\t\t\tcontent.style.height = content.style.width = width + \"px\";\n\t\t}\n\t\tcontent.className = \"gantt_task_content\";\n\t\t//content.style.width = width + 'px';\n\t\treturn content;\n\t}\n\n\tfunction _render_task_progress(task, element, maxWidth, cfg, templates) {\n\t\tvar done = task.progress * 1 || 0;\n\n\t\tmaxWidth = Math.max(maxWidth - 2, 0);//2px for borders\n\t\tvar pr = document.createElement(\"div\");\n\t\tvar width = Math.round(maxWidth * done);\n\n\t\twidth = Math.min(maxWidth, width);\n\n\t\tpr.style.width = width + 'px';\n\t\tpr.className = \"gantt_task_progress\";\n\t\tpr.innerHTML = templates.progress_text(task.start_date, task.end_date, task);\n\n\t\tif(cfg.rtl){\n\t\t\tpr.style.position = \"absolute\";\n\t\t\tpr.style.right = \"0px\";\n\t\t}\n\n\t\tvar wrapper = document.createElement(\"div\");\n\t\twrapper.className = \"gantt_task_progress_wrapper\";\n\t\twrapper.appendChild(pr);\n\t\telement.appendChild(wrapper);\n\n\t\tif (gantt.config.drag_progress && !gantt.isReadonly(task)) {\n\t\t\tvar drag = document.createElement(\"div\");\n\n\t\t\tvar markerPos = width;\n\t\t\tif(cfg.rtl){\n\t\t\t\tmarkerPos = maxWidth - width;\n\t\t\t}\n\n\t\t\tdrag.style.left = markerPos + 'px';\n\t\t\tdrag.className = \"gantt_task_progress_drag\";\n\t\t\tdrag.innerHTML = `<svg xmlns=\"http://www.w3.org/2000/svg\" width=\"12\" height=\"9\" viewBox=\"0 0 12 9\" fill=\"none\">\n<path d=\"M5.58397 1.52543C5.78189 1.22856 6.21811 1.22856 6.41602 1.52543L10.5475 7.72265C10.769 8.05493 10.5308 8.5 10.1315 8.5L1.86852 8.5C1.46917 8.5 1.23097 8.05493 1.45249 7.72265L5.58397 1.52543Z\" fill=\"var(--dhx-gantt-progress-handle-background)\" stroke=\"var(--dhx-gantt-progress-handle-border)\"/>\n</svg>`;\n\t\t\tpr.appendChild(drag);\n\t\t\telement.appendChild(drag);\n\t\t}\n\t}\n\n\tfunction _get_conditions(leftside) {\n\t\tif (leftside) {\n\t\t\treturn {\n\t\t\t\t$source: [\n\t\t\t\t\tgantt.config.links.start_to_start\n\t\t\t\t],\n\t\t\t\t$target: [\n\t\t\t\t\tgantt.config.links.start_to_start,\n\t\t\t\t\tgantt.config.links.finish_to_start\n\t\t\t\t]\n\t\t\t};\n\t\t} else {\n\t\t\treturn {\n\t\t\t\t$source: [\n\t\t\t\t\tgantt.config.links.finish_to_start,\n\t\t\t\t\tgantt.config.links.finish_to_finish\n\t\t\t\t],\n\t\t\t\t$target: [\n\t\t\t\t\tgantt.config.links.finish_to_finish\n\t\t\t\t]\n\t\t\t};\n\t\t}\n\t}\n\n\tfunction _combine_item_class(basic, template, itemId, view) {\n\t\tvar cfg = view.$getConfig();\n\t\tvar css = [basic];\n\t\tif (template)\n\t\t\tcss.push(template);\n\n\t\tvar state = gantt.getState();\n\n\t\tvar task = gantt.getTask(itemId);\n\n\t\tif (gantt.getTaskType(task.type) == cfg.types.milestone) {\n\t\t\tcss.push(\"gantt_milestone\");\n\t\t}else if (gantt.getTaskType(task.type) == cfg.types.project) {\n\t\t\tcss.push(\"gantt_project\");\n\t\t}\n\n\t\tcss.push(\"gantt_bar_\" + gantt.getTaskType(task.type));\n\n\n\t\tif (gantt.isSummaryTask(task))\n\t\t\tcss.push(\"gantt_dependent_task\");\n\n\t\tif (gantt.isSplitTask(task) && ((cfg.open_split_tasks && !task.$open) || !cfg.open_split_tasks)) {\n\t\t\tcss.push(\"gantt_split_parent\");\n\t\t}\n\n\t\tif (cfg.select_task && gantt.isSelectedTask(itemId)) {\n\t\t\tcss.push(\"gantt_selected\");\n\t\t}\n\n\t\tif (itemId == state.drag_id) {\n\t\t\tcss.push(\"gantt_drag_\" + state.drag_mode);\n\t\t\tif (state.touch_drag) {\n\t\t\t\tcss.push(\"gantt_touch_\" + state.drag_mode);\n\t\t\t}\n\t\t}\n\n\t\tif (state.link_source_id == itemId){\n\t\t\tcss.push(\"gantt_link_source\");\n\t\t\tif(state.link_from_start) {\n\t\t\t\tcss.push(\"gantt_link_from_start\");\n\t\t\t}else{\n\t\t\t\tcss.push(\"gantt_link_from_end\");\n\t\t\t}\n\t\t}\n\n\t\tif (state.link_target_id == itemId)\n\t\t\tcss.push(\"gantt_link_target\");\n\n\n\t\tif (cfg.highlight_critical_path && gantt.isCriticalTask) {\n\t\t\tif (gantt.isCriticalTask(task))\n\t\t\t\tcss.push(\"gantt_critical_task\");\n\t\t}\n\n\t\tif (state.link_landing_area &&\n\t\t\t(state.link_target_id && state.link_source_id) &&\n\t\t\t(state.link_target_id != state.link_source_id) &&\n\t\t\t(state.link_target_id == itemId || state.link_source_id == itemId)) {\n\n\t\t\tvar from_id = state.link_source_id;\n\t\t\tvar from_start = state.link_from_start;\n\t\t\tvar to_start = state.link_to_start;\n\n\t\t\tvar allowDrag = gantt.isLinkAllowed(from_id, itemId, from_start, to_start);\n\n\t\t\tvar dragClass = \"\";\n\t\t\tif (allowDrag) {\n\t\t\t\tif (to_start)\n\t\t\t\t\tdragClass = \"link_start_allow\";\n\t\t\t\telse\n\t\t\t\t\tdragClass = \"link_finish_allow\";\n\t\t\t} else {\n\t\t\t\tif (to_start)\n\t\t\t\t\tdragClass = \"link_start_deny\";\n\t\t\t\telse\n\t\t\t\t\tdragClass = \"link_finish_deny\";\n\t\t\t}\n\t\t\tcss.push(dragClass);\n\t\t}\n\t\treturn css.join(\" \");\n\t}\n\n\tfunction _render_pair(parent, css, task, content, config, margin) {\n\t\tvar state = gantt.getState();\n\t\tvar className, element;\n\t\tif (+task.start_date >= +state.min_date) {\n\t\t\tclassName = [css, config.rtl ? \"task_right\" : \"task_left\", \"task_start_date\"];\n\t\t\telement = content(className.join(\" \"));\n\t\t\telement.setAttribute(\"data-bind-property\", \"start_date\");\n\t\t\tif(margin){\n\t\t\t\telement.style.marginLeft = margin + \"px\";\n\t\t\t}\n\t\t\tparent.appendChild(element);\n\t\t}\n\n\t\tif (+task.end_date <= +state.max_date){\n\t\t\tclassName = [css, config.rtl ? \"task_left\" : \"task_right\", \"task_end_date\"];\n\t\t\telement = content(className.join(\" \"));\n\t\t\telement.setAttribute(\"data-bind-property\", \"end_date\");\n\t\t\tif(margin){\n\t\t\t\telement.style.marginRight = margin + \"px\";\n\t\t\t}\n\t\t\tparent.appendChild(element);\n\t\t}\n\n\t}\n\n\treturn _render_task_element;\n}\n\nexport default createTaskRenderer;","import isInViewPort from \"./viewport/is_bar_in_viewport\";\nimport getVisibleRange from \"./viewport/get_visible_bars_range\";\nimport createBaseBarRender from \"./task_bar_render\";\n\nexport default function createTaskRenderer(gantt){\n\tvar defaultRender = createBaseBarRender(gantt);\n\treturn {\n\t\trender: defaultRender,\n\t\tupdate: null,\n\t\t//getRectangle: getBarRectangle\n\t\tisInViewPort: isInViewPort,\n\t\tgetVisibleRange: getVisibleRange\n\t};\n};","export default function () {\n  // eslint-disable-next-line no-console\n  console.error(\"You are trying to use a Pro feature that is not available in the GPL version.\");\n  return {\n    render: function (){},\n    isInViewPort: function (){},\n    getVisibleRange: function (){}\n  };\n};\n","export default function(item, view, config){\n\treturn {\n\t\ttop: view.getItemTop(item.id),\n\t\theight: view.getItemHeight(item.id),\n\t\tleft: 0,\n\t\tright: Infinity\n\t};\n};","export default function getVisibleCellsRange(scale, viewport){\n\tvar firstCellIndex = 0;\n\tvar lastCellIndex = scale.left.length - 1;\n\tif(viewport){\n\t\tfor(var i = 0; i < scale.left.length; i++){\n\t\t\tvar left = scale.left[i];\n\t\t\tif(left < viewport.x){\n\t\t\t\tfirstCellIndex = i;\n\t\t\t}\n\t\t\tif(left > viewport.x_end){\n\t\t\t\tlastCellIndex = i;\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t}\n\n\treturn {\n\t\tstart: firstCellIndex,\n\t\tend: lastCellIndex\n\t};\n};","import isLegacyRender from \"../is_legacy_smart_render\";\n\nexport default function isColumnVisible(columnIndex, scale, viewPort, gantt){\n\tvar width = scale.width[columnIndex];\n\tif(width <= 0){\n\t\treturn false;\n\t}\n\tif(!gantt.config.smart_rendering || isLegacyRender(gantt)){\n\t\treturn true;\n\t}\n\tvar cellLeftCoord = scale.left[columnIndex] - width;\n\tvar cellRightCoord = scale.left[columnIndex] + width;\n\treturn (cellLeftCoord <= viewPort.x_end && cellRightCoord >= viewPort.x);//do not render skipped columns\n};","export default function (items, gantt){\n\tvar placeholderConfig = gantt.config.timeline_placeholder;\n\titems = items || [];\n\tif (placeholderConfig && items.filter(e => e.id === 'timeline_placeholder_task').length === 0){\n\t\tvar state = gantt.getState();\n\t\tvar lastTaskId = null;\n\t\tvar start_date = state.min_date;\n\t\tvar end_date = state.max_date;\n\t\tif (items.length){\n\t\t\tlastTaskId = items[items.length -1].id;\n\t\t}\n\t\tvar placeholderTask = {\n\t\t\tstart_date: start_date, \n\t\t\tend_date: end_date, \n\t\t\trow_height: placeholderConfig.height || 0,\n\t\t\tid: \"timeline_placeholder_task\", \n\t\t\tunscheduled: true,\n\t\t\tlastTaskId: lastTaskId, \n\t\t\tcalendar_id: placeholderConfig.calendar || \"global\",\n\t\t\t$source:[], \n\t\t\t$target: []\n\t\t};\n\t\titems.push(placeholderTask);\n\t}\n};","import isInViewPort from \"./viewport/is_link_in_viewport\";\nimport getVisibleRange from \"./viewport/factory/get_visible_link_range\";\nimport { childrenHaveBaselines, getMaxParentHeight } from \"./baseline_helper\";\n\n\nfunction createLinkRender(gantt){\n\nfunction _render_link_element(link, view, config) {\n\tvar source = gantt.getTask(link.source);\n\tif(source.hide_bar){\n\t\treturn;\n\t}\n\n\tvar target = gantt.getTask(link.target);\n\tif(target.hide_bar){\n\t\treturn;\n\t}\n\n\tvar pt = path_builder.get_endpoint(link, view, source, target);\n\tvar dy = pt.e_y - pt.y;\n\tvar dx = pt.e_x - pt.x;\n\tif(!dx && !dy){\n\t\treturn null;\n\t}\n\n\n\tvar dots = path_builder.get_points(link, view, source, target);\n\tconst lines = drawer.get_lines(dots, view);\n\n\tconst shapes = transform_lines_to_shapes(lines.filter(l => l.size > 0), config);\n  \n\tconst div = render_shapes(shapes, view, link, config);\n\n\n\tvar css = \"gantt_task_link\";\n\n\tif (link.color) {\n\t\tcss += \" gantt_link_inline_color\";\n\t}\n\tvar cssTemplate = gantt.templates.link_class ? gantt.templates.link_class(link) : \"\";\n\tif (cssTemplate) {\n\t\tcss += \" \" + cssTemplate;\n\t}\n\n\tif (config.highlight_critical_path && gantt.isCriticalLink) {\n\t\tif (gantt.isCriticalLink(link))\n\t\t\tcss += \" gantt_critical_link\";\n\t}\n\n\tdiv.className = css;\n\n\tif(view.$config.link_attribute){\n\t\tdiv.setAttribute(view.$config.link_attribute, link.id);\n\t\tdiv.setAttribute(\"link_id\", link.id);\n\t}\n\tif (link.color) {\n\t\tdiv.style.setProperty(\"--dhx-gantt-link-background\", link.color);\n\t}\n\n\tgantt._waiAria.linkAttr(link, div);\n\n\treturn div;\n}\n\n\tfunction render_shapes(shapes, view, link, config) {\n\t\tconst container = document.createElement(\"div\");\n\n\t\tshapes.forEach(shape => {\n\t\t\tlet element;\n\t\t\tif (shape.type === 'line') {\n\t\t\t\telement = drawer.render_line(shape.data, null, view, link.source);\n\t\t\t} else if (shape.type === 'corner') {\n\t\t\t\telement = drawer.render_corner(shape.data, view);\n\t\t\t}else if (shape.type === 'arrow') {\n\t\t\t\telement = drawer.render_arrow(shape.data, config);\n\t\t\t}\n\n\t\t\tcontainer.appendChild(element);\n\t\t});\n\n\t\treturn container;\n\t}\n\n\tfunction transform_lines_to_shapes(lines, config) {\n\t\tconst radius = config.link_radius || 4;\n\t\tconst arrowSize = config.link_arrow_size || 6; // Arrow size from config\n\t\tconst shapes = [];\n\t\n\t\tfor (let i = 0; i < lines.length; i++) {\n\t\t\tconst line = lines[i];\n\t\t\tconst nextLine = lines[i + 1];\n\t\n\t\t\tif (!nextLine || config.link_radius <= 1) {\n\t\t\t\tshapes.push({ type: 'line', data: line });\n\t\t\t\tcontinue;\n\t\t\t}\n\t\n\t\t\tif (line.direction !== nextLine.direction) {\n\t\t\t\tif(line.size < radius || nextLine.size < radius){\n\t\t\t\t\tshapes.push({ type: 'line', data: line });\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\t\t\t\tline.size -= radius;\n\t\t\t\tshapes.push({ type: 'line', data: line });\n\t\n\t\t\t\tlet cornerX = line.x;\n\t\t\t\tlet cornerY = line.y - config.link_line_width / 2;\n\t\n\t\t\t\tswitch (line.direction) {\n\t\t\t\t\tcase 'right':\n\t\t\t\t\t\tcornerX += line.size;\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 'left':\n\t\t\t\t\t\tcornerX -= line.size;\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 'down':\n\t\t\t\t\t\tcornerY += line.size;\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 'up':\n\t\t\t\t\t\tcornerY -= line.size;\n\t\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\n\t\t\t\tconst corner = {\n\t\t\t\t\tx: cornerX,\n\t\t\t\t\ty: cornerY,\n\t\t\t\t\tdirection: { from: line.direction, to: nextLine.direction },\n\t\t\t\t\tradius\n\t\t\t\t};\n\t\t\t\tshapes.push({ type: 'corner', data: corner });\n\t\n\t\t\t\tswitch (nextLine.direction) {\n\t\t\t\t\tcase 'right':\n\t\t\t\t\t\tnextLine.x += radius;\n\t\t\t\t\t\tnextLine.size -= radius;\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 'left':\n\t\t\t\t\t\tnextLine.x -= radius;\n\t\t\t\t\t\tnextLine.size -= radius;\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 'down':\n\t\t\t\t\t\tnextLine.y += radius;\n\t\t\t\t\t\tnextLine.size -= radius;\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 'up':\n\t\t\t\t\t\tnextLine.y -= radius;\n\t\t\t\t\t\tnextLine.size -= radius;\n\t\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tshapes.push({ type: 'line', data: line });\n\t\t\t}\n\t\t}\n\t\n\t\tconst lastLine = lines[lines.length - 1];\n\t\n\t\tif (lastLine.direction === 'right' || lastLine.direction === 'left') {\n\t\t\tlastLine.size -= arrowSize*3/4; \n\t\n\t\t\tlet arrowX = lastLine.direction === 'right' ? (lastLine.x + lastLine.size) : lastLine.x - lastLine.size - arrowSize/2;\n\t\t\tlet arrowY = lastLine.y - (config.link_line_width / 2) - (arrowSize / 2) + 1;\n\t\n\t\t\tif(lastLine.direction === 'left'){\n\t\t\t\tarrowY -= 1;// left pointing arrows for some reason need adjustments\n\t\t\t\tarrowX -= 2;\n\t\t\t}else{\n\t\t\t\tarrowX -= 1;\n\t\t\t}\n\t\t\tconst arrow = {\n\t\t\t\tx: arrowX,\n\t\t\t\ty: arrowY,\n\t\t\t\tsize: arrowSize,\n\t\t\t\tdirection: lastLine.direction\n\t\t\t};\n\t\n\t\t\tshapes.push({ type: 'line', data: lastLine });\n\t\t\tshapes.push({ type: 'arrow', data: arrow });\n\t\t} else {\n\t\t\tshapes.push({ type: 'line', data: lastLine });\n\t\t}\n\t\n\t\treturn shapes;\n\t}\n\t\n\n\nvar drawer = {\n\tcurrent_pos: null,\n\tdirs: {\"left\": 'left', \"right\": 'right', \"up\": 'up', \"down\": 'down'},\n\tpath: [],\n\tclear: function () {\n\t\tthis.current_pos = null;\n\t\tthis.path = [];\n\t},\n\tpoint: function (pos) {\n\t\tthis.current_pos = gantt.copy(pos);\n\t},\n\tget_lines: function (dots) {\n\t\tthis.clear();\n\t\tthis.point(dots[0]);\n\t\tfor (var i = 1; i < dots.length; i++) {\n\t\t\tthis.line_to(dots[i]);\n\t\t}\n\t\treturn this.get_path();\n\t},\n\tline_to: function (pos) {\n\t\tvar next = gantt.copy(pos);\n\t\tvar prev = this.current_pos;\n\n\t\tvar line = this._get_line(prev, next);\n\t\tthis.path.push(line);\n\t\tthis.current_pos = next;\n\t},\n\tget_path: function () {\n\t\treturn this.path;\n\t},\n\tget_wrapper_sizes: function (v, view, itemId) {\n\t\tvar config = view.$getConfig();\n\t\tvar res,\n\t\t\twrapper_size = config.link_wrapper_width,\n\t\t\ty = v.y - (wrapper_size) / 2;\n\t\tswitch (v.direction) {\n\t\t\tcase this.dirs.left:\n\t\t\t\tres = {\n\t\t\t\t\ttop: y,\n\t\t\t\t\theight: wrapper_size,\n\t\t\t\t\tlineHeight: wrapper_size,\n\t\t\t\t\tleft: v.x - v.size - wrapper_size / 2,\n\t\t\t\t\twidth: v.size + wrapper_size\n\t\t\t\t};\n\t\t\t\tbreak;\n\t\t\tcase this.dirs.right:\n\t\t\t\tres = {\n\t\t\t\t\ttop: y,\n\t\t\t\t\tlineHeight: wrapper_size,\n\t\t\t\t\theight: wrapper_size,\n\t\t\t\t\tleft: v.x - wrapper_size / 2,\n\t\t\t\t\twidth: v.size + wrapper_size\n\t\t\t\t};\n\t\t\t\tbreak;\n\t\t\tcase this.dirs.up:\n\t\t\t\tres = {\n\t\t\t\t\ttop: y - v.size,\n\t\t\t\t\tlineHeight: v.size + wrapper_size,\n\t\t\t\t\theight: v.size + wrapper_size,\n\t\t\t\t\tleft: v.x - wrapper_size / 2,\n\t\t\t\t\twidth: wrapper_size\n\t\t\t\t};\n\t\t\t\tbreak;\n\t\t\tcase this.dirs.down:\n\t\t\t\tres = {\n\t\t\t\t\ttop: y /*- wrapper_size/2*/,\n\t\t\t\t\tlineHeight: v.size + wrapper_size,\n\t\t\t\t\theight: v.size + wrapper_size,\n\t\t\t\t\tleft: v.x - wrapper_size / 2,\n\t\t\t\t\twidth: wrapper_size\n\t\t\t\t};\n\t\t\t\tbreak;\n\t\t\tdefault:\n\t\t\t\tbreak;\n\t\t}\n\n\t\treturn res;\n\t},\n\tget_line_sizes: function (v, view) {\n\t\tvar config = view.$getConfig();\n\t\tvar res,\n\t\t\tline_size = config.link_line_width,\n\t\t\twrapper_size = config.link_wrapper_width,\n\t\t\tsize = v.size + line_size;\n\t\tswitch (v.direction) {\n\t\t\tcase this.dirs.left:\n\t\t\tcase this.dirs.right:\n\t\t\t\tres = {\n\t\t\t\t\theight: line_size,\n\t\t\t\t\twidth: size,\n\t\t\t\t\tmarginTop: (wrapper_size - line_size) / 2,\n\t\t\t\t\tmarginLeft: (wrapper_size - line_size) / 2\n\t\t\t\t};\n\t\t\t\tbreak;\n\t\t\tcase this.dirs.up:\n\t\t\tcase this.dirs.down:\n\t\t\t\tres = {\n\t\t\t\t\theight: size,\n\t\t\t\t\twidth: line_size,\n\t\t\t\t\tmarginTop: (wrapper_size - line_size) / 2,\n\t\t\t\t\tmarginLeft: (wrapper_size - line_size) / 2\n\t\t\t\t};\n\t\t\t\tbreak;\n\t\t\tdefault:\n\t\t\t\tbreak;\n\t\t}\n\n\n\t\treturn res;\n\t},\n\trender_line: function (v, end, view, itemId) {\n\t\tvar pos = this.get_wrapper_sizes(v, view, itemId);\n\t\tvar wrapper = document.createElement(\"div\");\n\t\twrapper.style.cssText = [\n\t\t\t\"top:\" + pos.top + \"px\",\n\t\t\t\"left:\" + pos.left + \"px\",\n\t\t\t\"height:\" + pos.height + \"px\",\n\t\t\t\"width:\" + pos.width + \"px\"\n\t\t].join(';');\n\t\twrapper.className = \"gantt_line_wrapper\";\n\n\t\tvar innerPos = this.get_line_sizes(v, view);\n\t\tvar inner = document.createElement(\"div\");\n\t\tinner.style.cssText = [\n\t\t\t\"height:\" + innerPos.height + \"px\",\n\t\t\t\"width:\" + innerPos.width + \"px\",\n\t\t\t\"margin-top:\" + innerPos.marginTop + \"px\",\n\t\t\t\"margin-left:\" + innerPos.marginLeft + \"px\"\n\t\t].join(\";\");\n\n\t\tinner.className = \"gantt_link_line_\" + v.direction;\n\t\twrapper.appendChild(inner);\n\n\t\treturn wrapper;\n\t},\n\n\trender_corner: function (corner, view) {\n\t\tconst radius = corner.radius;\n\t\tconst config = view.$getConfig();\n\t\tconst lineWidth = config.link_line_width || 2;\n\t\tconst cornerDiv = document.createElement(\"div\");\n\t\n\t\tcornerDiv.classList.add(\"gantt_link_corner\");\n\t\tcornerDiv.classList.add(`gantt_link_corner_${corner.direction.from}_${corner.direction.to}`);\n\t\n\t\tcornerDiv.style.width = `${radius}px`;\n\t\tcornerDiv.style.height = `${radius}px`;\n\t\n\t\tlet borderVertical;\n\t\tlet borderHorizontal;\n\n\t\tif (corner.direction.from === 'right' && corner.direction.to === 'down') {\n\t\t\tborderVertical = \"Right\";\n\t\t\tborderHorizontal = \"Top\";\n\t\t\tcornerDiv.style.left = `${corner.x - config.link_line_width/2}px`;\n\t\t\tcornerDiv.style.top = `${corner.y}px`;\n\t\t} else if (corner.direction.from === 'down' && corner.direction.to === 'right') {\n\t\t\tborderVertical = \"Left\";\n\t\t\tborderHorizontal = \"Bottom\";\n\t\t\tcornerDiv.style.left = `${corner.x - config.link_line_width/2}px`;\n\t\t\tcornerDiv.style.top = `${corner.y}px`;\n\t\t} else if (corner.direction.from === 'right' && corner.direction.to === 'up') {\n\t\t\tborderVertical = \"Right\";\n\t\t\tborderHorizontal = \"Bottom\";\n\t\t\tcornerDiv.style.left = `${corner.x - config.link_line_width/2}px`;\n\t\t\tcornerDiv.style.top = `${corner.y - radius}px`;\n\t\t} else if (corner.direction.from === 'up' && corner.direction.to === 'right') {\n\t\t\tborderVertical = \"Left\";\n\t\t\tborderHorizontal = \"Top\";\n\t\t\tcornerDiv.style.left = `${corner.x - config.link_line_width/2}px`;\n\t\t\tcornerDiv.style.top = `${corner.y - radius}px`;\n\t\t} else if (corner.direction.from === 'left' && corner.direction.to === 'down') {\n\t\t\tborderVertical = \"Left\";\n\t\t\tborderHorizontal = \"Top\";\n\t\t\tcornerDiv.style.left = `${corner.x - radius - config.link_line_width/2}px`;\n\t\t\tcornerDiv.style.top = `${corner.y}px`;\n\t\t} else if (corner.direction.from === 'down' && corner.direction.to === 'left') {\n\t\t\tborderVertical = \"Right\";\n\t\t\tborderHorizontal = \"Bottom\";\n\t\t\tcornerDiv.style.left = `${corner.x - radius - config.link_line_width/2}px`;\n\t\t\tcornerDiv.style.top = `${corner.y}px`;\n\t\t} else if (corner.direction.from === 'left' && corner.direction.to === 'up') {\n\t\t\tborderVertical = \"Left\";\n\t\t\tborderHorizontal = \"Bottom\";\n\t\t\tcornerDiv.style.left = `${corner.x - radius - config.link_line_width/2}px`;\n\t\t\tcornerDiv.style.top = `${corner.y - radius}px`;\n\t\t} else if (corner.direction.from === 'up' && corner.direction.to === 'left') {\n\t\t\tborderVertical = \"Right\";\n\t\t\tborderHorizontal = \"Top\";\n\t\t\tcornerDiv.style.left = `${corner.x - radius - config.link_line_width/2}px`;\n\t\t\tcornerDiv.style.top = `${corner.y - radius}px`;\n\t\t}\n\n\t\tcornerDiv.style[`border${borderHorizontal}Width`] = `${lineWidth}px`;\n\t\tcornerDiv.style[`border${borderVertical}Width`] = `${lineWidth}px`;\n\t\tcornerDiv.style[`border${borderVertical}Style`] = `solid`;\n\t\tcornerDiv.style[`border${borderHorizontal}Style`] = `solid`;\n\t\tcornerDiv.style[`border${borderHorizontal}${borderVertical}Radius`] = `${radius}px`;\n\n\t\n\t\treturn cornerDiv;\n\t},\n\n\trender_arrow(arrow, config) {\n\t\tvar div = document.createElement(\"div\");\n\t\tvar top = arrow.y;\n\t\tvar left = arrow.x;\n\t\n\t\tvar size = config.link_arrow_size;\n\t\tdiv.style.setProperty(\"--dhx-gantt-icon-size\", `${size}px`);\n\t\n\t\tvar className = \"gantt_link_arrow gantt_link_arrow_\" + arrow.direction;\n\n\t\tdiv.style.top = top + \"px\";\n\t\tdiv.style.left = left + 'px';\n\t\tdiv.className = className;\n\t\n\t\treturn div;\n\t},\n\t\n\t_get_line: function (from, to) {\n\t\tvar direction = this.get_direction(from, to);\n\t\tvar vect = {\n\t\t\tx: from.x,\n\t\t\ty: from.y,\n\t\t\tdirection: this.get_direction(from, to)\n\t\t};\n\t\tif (direction == this.dirs.left || direction == this.dirs.right) {\n\t\t\tvect.size = Math.abs(from.x - to.x);\n\t\t} else {\n\t\t\tvect.size = Math.abs(from.y - to.y);\n\t\t}\n\t\treturn vect;\n\t},\n\tget_direction: function (from, to) {\n\t\tvar direction = 0;\n\t\tif (to.x < from.x) {\n\t\t\tdirection = this.dirs.left;\n\t\t} else if (to.x > from.x) {\n\t\t\tdirection = this.dirs.right;\n\t\t} else if (to.y > from.y) {\n\t\t\tdirection = this.dirs.down;\n\t\t} else {\n\t\t\tdirection = this.dirs.up;\n\t\t}\n\t\treturn direction;\n\t}\n\n};\n\nvar path_builder = {\n\n\tpath: [],\n\tclear: function () {\n\t\tthis.path = [];\n\t},\n\tcurrent: function () {\n\t\treturn this.path[this.path.length - 1];\n\t},\n\tpoint: function (next) {\n\t\tif (!next)\n\t\t\treturn this.current();\n\n\t\tthis.path.push(gantt.copy(next));\n\t\treturn next;\n\t},\n\tpoint_to: function (direction, diff, point) {\n\t\tif (!point)\n\t\t\tpoint = gantt.copy(this.point());\n\t\telse\n\t\t\tpoint = {x: point.x, y: point.y};\n\t\tvar dir = drawer.dirs;\n\t\tswitch (direction) {\n\t\t\tcase (dir.left):\n\t\t\t\tpoint.x -= diff;\n\t\t\t\tbreak;\n\t\t\tcase (dir.right):\n\t\t\t\tpoint.x += diff;\n\t\t\t\tbreak;\n\t\t\tcase (dir.up):\n\t\t\t\tpoint.y -= diff;\n\t\t\t\tbreak;\n\t\t\tcase (dir.down):\n\t\t\t\tpoint.y += diff;\n\t\t\t\tbreak;\n\t\t\tdefault:\n\t\t\t\tbreak;\n\t\t}\n\t\treturn this.point(point);\n\t},\n\tget_points: function (link, view, source, target) {\n\t\tvar pt = this.get_endpoint(link, view, source, target);\n\t\tvar xy = gantt.config;\n\n\t\tvar dy = pt.e_y - pt.y;\n\t\tvar dx = pt.e_x - pt.x;\n\n\t\tvar dir = drawer.dirs;\n\n\t\tvar rowHeight = view.getItemHeight(link.source);\n\n\t\tthis.clear();\n\t\tthis.point({x: pt.x, y: pt.y});\n\n\t\tvar shiftX = 2 * xy.link_arrow_size;//just random size for first line\n\t\tvar lineType = this.get_line_type(link, view.$getConfig());\n\n\t\tvar forward = (pt.e_x > pt.x);\n\t\tif (lineType.from_start && lineType.to_start) {\n\t\t\tthis.point_to(dir.left, shiftX);\n\t\t\tif (forward) {\n\t\t\t\tthis.point_to(dir.down, dy);\n\t\t\t\tthis.point_to(dir.right, dx);\n\t\t\t} else {\n\t\t\t\tthis.point_to(dir.right, dx);\n\t\t\t\tthis.point_to(dir.down, dy);\n\t\t\t}\n\t\t\tthis.point_to(dir.right, shiftX);\n\n\t\t} else if (!lineType.from_start && lineType.to_start) {\n\t\t\t// GS-2619. No need to add loops for the split tasks (zero dy means the tasks are on the same line)\n\t\t\tif (dy !== 0){\n\t\t\t\tforward = (pt.e_x > (pt.x + 2 * shiftX));\n\t\t\t}\n\t\t\tthis.point_to(dir.right, shiftX);\n\t\t\tif (forward) {\n\t\t\t\tdx -= shiftX;\n\t\t\t\tthis.point_to(dir.down, dy);\n\t\t\t\tthis.point_to(dir.right, dx);\n\t\t\t} else {\n\t\t\t\tdx -= 2 * shiftX;\n\t\t\t\tvar sign = dy > 0 ? 1 : -1;\n\n\t\t\t\tthis.point_to(dir.down, sign * (rowHeight / 2));\n\t\t\t\tthis.point_to(dir.right, dx);\n\t\t\t\tthis.point_to(dir.down, sign * ( Math.abs(dy) - (rowHeight / 2)));\n\t\t\t\tthis.point_to(dir.right, shiftX);\n\t\t\t}\n\n\t\t} else if (!lineType.from_start && !lineType.to_start) {\n\t\t\tthis.point_to(dir.right, shiftX);\n\t\t\tif (forward) {\n\t\t\t\tthis.point_to(dir.right, dx);\n\t\t\t\tthis.point_to(dir.down, dy);\n\t\t\t} else {\n\t\t\t\tthis.point_to(dir.down, dy);\n\t\t\t\tthis.point_to(dir.right, dx);\n\t\t\t}\n\t\t\tthis.point_to(dir.left, shiftX);\n\t\t} else if (lineType.from_start && !lineType.to_start) {\n\t\t\t// GS-2619. No need to add loops for the split tasks (zero dy means the tasks are on the same line)\n\t\t\tif (dy !== 0){\n\t\t\t\tforward = (pt.e_x > (pt.x - 2 * shiftX));\n\t\t\t}\n\t\t\tthis.point_to(dir.left, shiftX);\n\n\t\t\tif (!forward) {\n\t\t\t\tdx += shiftX;\n\t\t\t\tthis.point_to(dir.down, dy);\n\t\t\t\tthis.point_to(dir.right, dx);\n\t\t\t} else {\n\t\t\t\tdx += 2 * shiftX;\n\t\t\t\tvar sign = dy > 0 ? 1 : -1;\n\t\t\t\tthis.point_to(dir.down, sign * (rowHeight / 2));\n\t\t\t\tthis.point_to(dir.right, dx);\n\t\t\t\tthis.point_to(dir.down, sign * ( Math.abs(dy) - (rowHeight / 2)));\n\t\t\t\tthis.point_to(dir.left, shiftX);\n\t\t\t}\n\n\t\t}\n\n\t\treturn this.path;\n\t},\n\tget_line_type: function(link, config){\n\t\tvar types = config.links;\n\t\tvar from_start = false, to_start = false;\n\t\tif (link.type == types.start_to_start) {\n\t\t\tfrom_start = to_start = true;\n\t\t} else if (link.type == types.finish_to_finish) {\n\t\t\tfrom_start = to_start = false;\n\t\t} else if (link.type == types.finish_to_start) {\n\t\t\tfrom_start = false;\n\t\t\tto_start = true;\n\t\t} else if (link.type == types.start_to_finish) {\n\t\t\tfrom_start = true;\n\t\t\tto_start = false;\n\t\t} else {\n\t\t\tgantt.assert(false, \"Invalid link type\");\n\t\t}\n\n\t\tif(config.rtl){\n\t\t\tfrom_start = !from_start;\n\t\t\tto_start = !to_start;\n\t\t}\n\n\t\treturn {from_start: from_start, to_start: to_start};\n\t},\n\n\tget_endpoint: function (link, view, source, target) {\n\t\tvar config = view.$getConfig();\n\n\t\tvar lineType = this.get_line_type(link, config);\n\t\tvar from_start = lineType.from_start,\n\t\t\tto_start = lineType.to_start;\n\n\t\tvar from = getMilestonePosition(source, view, config),\n\t\t\tto = getMilestonePosition(target, view, config);\n\n\t\treturn {\n\t\t\tx: from_start ? from.left : (from.left + from.width),\n\t\t\te_x: to_start ? to.left : (to.left + to.width),\n\t\t\ty: from.top + (from.rowHeight/2) - 1,\n\t\t\te_y: to.top + (to.rowHeight/2) - 1\n\t\t};\n\t}\n};\n\nfunction getMilestonePosition(task, view, config){\n\tvar pos = view.getItemPosition(task);\n\n\t// GS-2270: Link to the split children shouldn't exceed the parent row height\n\tlet splitParams = getMaxParentHeight(gantt, view, task);\n\tlet maxHeight = splitParams.maxHeight;\n\n\tlet splitChild = splitParams.splitChild;\n\tconst baselinesOnDifferentRow = gantt.config.baselines !== false && (gantt.config.baselines.render_mode == \"separateRow\" || gantt.config.baselines.render_mode == \"individualRow\");\n\tconst baselines = baselinesOnDifferentRow && task.baselines && task.baselines.length;\n\n\tif (splitParams.shrinkHeight){\n\t\tpos.rowHeight = maxHeight;\n\t}\n\n\tlet milestoneWidth;\n\tlet milestoneTask = gantt.getTaskType(task.type) == config.types.milestone;\n\tif(milestoneTask){\n\t\tlet milestoneHeight = view.getBarHeight(task.id, true);\n\t\tmilestoneWidth = Math.sqrt(2*milestoneHeight*milestoneHeight);\n\t\tif (splitParams.shrinkHeight && maxHeight < milestoneHeight){\n\t\t\tmilestoneHeight = maxHeight;\n\t\t\tmilestoneWidth = maxHeight;\n\t\t}\n\t\tpos.left -= milestoneWidth / 2;\n\t\tpos.width = milestoneWidth;\n\t} \n\tif (splitChild){\n\t\tif (maxHeight >= pos.height) {\n\t\t\tconst siblingBaselines = childrenHaveBaselines(gantt, task.parent);\n\t\t\tif (baselines || siblingBaselines){\n\t\t\t\tif (milestoneTask){\n\t\t\t\t\tpos.rowHeight = pos.height + 4;\n\t\t\t\t\tpos.left += (pos.width - pos.rowHeight + 4) / 2;\n\t\t\t\t\tpos.width = pos.rowHeight - 3;\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\tpos.rowHeight = pos.height + 6;\n\t\t\t\t}\n\t\t\t} else if (milestoneTask) {\n\t\t\t\tpos.left += (milestoneWidth - pos.height) / 2;\n\t\t\t}\n\t\t} else {\n\t\t\tpos.rowHeight = maxHeight + 2;\n\t\t\tif (milestoneTask){\n\t\t\t\tpos.left += (pos.width - pos.rowHeight + 4) / 2;\n\t\t\t\tpos.width = pos.rowHeight - 3;\n\t\t\t}\n\t\t}\n\t} else if (baselines){\n\t\tpos.rowHeight = pos.height + 4;\n\t}\n\n\treturn pos;\n}\n\n\nreturn {\n\trender: _render_link_element,\n\tupdate: null,\n\t//getRectangle: getLinkRectangle\n\tisInViewPort: isInViewPort,\n\tgetVisibleRange: getVisibleRange()\n};\n}\n\nexport default createLinkRender;","export default function(item, viewport, view, config, gantt){\n    // GS-2481 and GS-1715, don't remove selected task when using keyboard shortcuts and when the inline editor is opened\n    if(gantt.$ui.getView(\"grid\") && ((gantt.config.keyboard_navigation && gantt.getSelectedId()) || (gantt.ext.inlineEditors && gantt.ext.inlineEditors.getState().id))) {\n\t\treturn true;\n\t}\n    var top = view.getItemTop(item.id);\n\tvar height = view.getItemHeight(item.id);\n\n\tif(top > viewport.y_end || top + height < viewport.y){\n\t\treturn false;\n\t}\n\n\treturn true;\n};","import * as helpers from \"../utils/helpers\";\n\nexport default function createResourceTimelineBuilder(gantt){\n\n\tlet resourceTaskCache = {};\n\n\tgantt.$data.tasksStore.attachEvent(\"onStoreUpdated\", function(){\n\t\tresourceTaskCache = {};\n\t});\n\n\tfunction getResourceLoad(resource, resourceProperty, scale, timeline){\n\t\tconst cacheKey = resource.id + \"_\" + resourceProperty  + \"_\" + scale.unit + \"_\" + scale.step;\n\t\tlet res;\n\t\tif (!resourceTaskCache[cacheKey]) {\n\t\t\tres = resourceTaskCache[cacheKey] = calculateResourceLoad(resource, resourceProperty, scale, timeline);\n\n\t\t} else {\n\t\t\tres = resourceTaskCache[cacheKey];\n\t\t}\n\t\treturn res;\n\t}\n\n\tfunction calculateResourceLoadFromAssignments(items, scale, assignmentsPassed){\n\t\tconst scaleUnit = scale.unit;\n\t\tconst scaleStep = scale.step;\n\t\tconst timegrid = {};\n\n\t\tconst precalculatedTimes = {};\n\t\tfor (let i = 0; i < items.length; i++) {\n\t\t\tconst item = items[i];\n\t\t\tlet task = item;\n\t\t\tif(assignmentsPassed){\n\t\t\t\ttask = gantt.getTask(item.task_id);\n\t\t\t}\n\t\t\tif (task.unscheduled){\n\t\t\t\tcontinue; // do not process assignments for unscheduled tasks\n\t\t\t}\n\t\t\tlet minDate = (item.start_date || task.start_date);\n\t\t\tlet maxDate = (item.end_date || task.end_date);\n\t\t\tif(assignmentsPassed){\n\t\t\t\tif(item.start_date){\n\t\t\t\t\tminDate = new Date(Math.max(item.start_date.valueOf(), task.start_date.valueOf()));\n\t\t\t\t}\n\t\t\t\tif(item.end_date){\n\t\t\t\t\tmaxDate = new Date(Math.min(item.end_date.valueOf(), task.end_date.valueOf()));\n\t\t\t\t}\n\t\t\t\t// GS-2063: handle case with fixedDates mode\n\t\t\t\tif(item.mode && item.mode == \"fixedDates\"){\n\t\t\t\t\tminDate = item.start_date;\n\t\t\t\t\tmaxDate = item.end_date;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tlet firstColumn = helpers.findBinary(scale.trace_x, minDate.valueOf());\n\t\t\tlet minScaleDate = new Date(scale.trace_x[firstColumn] || gantt.date[scaleUnit + \"_start\"](new Date(minDate)));\n\t\t\t// GS-2307: need to take into account that task could start before the min scale date\n\t\t\t// so the task would be added to timegrid\n\t\t\tlet currDate = new Date(Math.min(minDate.valueOf(), minScaleDate.valueOf())); \n\n\t\t\tlet calendar = gantt.config.work_time ? gantt.getTaskCalendar(task) : gantt;\n\t\t\tprecalculatedTimes[calendar.id] = {};\n\t\t\twhile (currDate < maxDate) {\n\t\t\t\tconst cachedTimes = precalculatedTimes[calendar.id];\n\n\t\t\t\tlet date = currDate;\n\t\t\t\tconst timestamp = date.valueOf();\n\n\t\t\t\tcurrDate = gantt.date.add(currDate, scaleStep, scaleUnit);\n\n\t\t\t\tif(cachedTimes[timestamp] === false){\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\n\t\t\t\tif (!timegrid[timestamp]){\n\t\t\t\t\ttimegrid[timestamp] = {tasks: [], assignments: []};\n\t\t\t\t}\n\n\t\t\t\ttimegrid[timestamp].tasks.push(task);\n\t\t\t\tif(assignmentsPassed){\n\t\t\t\t\ttimegrid[timestamp].assignments.push(item);\n\t\t\t\t}\n\n\t\t\t}\n\t\t}\n\t\treturn timegrid;\n\t}\n\n\tfunction calculateResourceLoad(resource, resourceProperty, scale, timeline) {\n\n\t\tlet items;\n\t\tlet assignmentsPassed = false;\n\t\tlet timegrid = {};\n\n\t\tif(gantt.config.process_resource_assignments && resourceProperty === gantt.config.resource_property){\n\t\t\tif(resource.$role == \"task\"){\n\t\t\t\titems = gantt.getResourceAssignments(resource.$resource_id, resource.$task_id);\n\t\t\t}else{\n\t\t\t\titems = gantt.getResourceAssignments(resource.id);\n\t\t\t}\n\n\t\t\tassignmentsPassed = true;\n\t\t}else if(resource.$role == \"task\"){\n\t\t\titems = [];\n\t\t}else{\n\t\t\titems = gantt.getTaskBy(resourceProperty, resource.id);\n\t\t}\n\n\t\ttimegrid = calculateResourceLoadFromAssignments(items, scale, assignmentsPassed);\n\t\tconst scaleUnit = scale.unit;\n\t\tconst scaleStep = scale.step;\n\n\t\tconst timetable = [];\n\t\tlet start, end, tasks, assignments, cell;\n\t\tconst config = timeline.$getConfig();\n\n\t\tfor(let i = 0; i < scale.trace_x.length; i++){\n\t\t\tstart = new Date(scale.trace_x[i]);\n\t\t\tend = gantt.date.add(start, scaleStep, scaleUnit);\n\t\t\tcell = timegrid[start.valueOf()] || {};\n\t\t\ttasks = cell.tasks || [];\n\t\t\tassignments = cell.assignments || [];\n\t\t\tif(tasks.length || config.resource_render_empty_cells){\n\t\t\t\ttimetable.push({\n\t\t\t\t\tstart_date: start,\n\t\t\t\t\tend_date: end,\n\t\t\t\t\ttasks: tasks,\n\t\t\t\t\tassignments: assignments\n\t\t\t\t});\n\t\t\t}else{\n\t\t\t\ttimetable.push(null);\n\t\t\t}\n\t\t}\n\n\t\treturn timetable;\n\t}\n\n\n\n\treturn getResourceLoad;\n};","import * as domHelpers from \"../utils/dom_helpers\";\nimport isPlaceholderTask from \"../../../utils/placeholder_task\";\n\nfunction _init_dnd(gantt, grid) {\n\tvar DnD = gantt.$services.getService(\"dnd\");\n\n\tif(!grid.$config.bind || !gantt.getDatastore(grid.$config.bind)){\n\t\treturn;\n\t}\n\n\tfunction locate(e){\n\t\treturn domHelpers.locateAttribute(e, grid.$config.item_attribute);\n\t}\n\n\tfunction getStore(){\n\t\treturn gantt.getDatastore(grid.$config.bind);\n\t}\n\n\tfunction checkPlaceholderTask(id){\n\t\treturn isPlaceholderTask(id, gantt, getStore());\n\t}\n\n\tvar dnd = new DnD(grid.$grid_data, {updates_per_second: 60});\n\tif (gantt.defined(grid.$getConfig().dnd_sensitivity))\n\t\tdnd.config.sensitivity = grid.$getConfig().dnd_sensitivity;\n\n\tdnd.attachEvent(\"onBeforeDragStart\", gantt.bind(function (obj, e) {\n\t\tvar el = locate(e);\n\t\tif (!el) return false;\n\t\tif (gantt.hideQuickInfo) gantt.hideQuickInfo();\n\n\t\tif (domHelpers.closest(e.target, \".gantt_grid_editor_placeholder\")){\n\t\t\treturn false;\n\t\t}\n\n\t\tvar id = el.getAttribute(grid.$config.item_attribute);\n\t\tif (checkPlaceholderTask(id)) return false;\n\n\t\tvar datastore = getStore();\n\n\t\tvar task = datastore.getItem(id);\n\n\t\tif (gantt.isReadonly(task))\n\t\t\treturn false;\n\n\t\tdnd.config.initial_open_state = task.$open;\n\t\tif (!gantt.callEvent(\"onRowDragStart\", [id, e.target || e.srcElement, e])) {\n\t\t\treturn false;\n\t\t}\n\n\t}, gantt));\n\n\tdnd.attachEvent(\"onAfterDragStart\", gantt.bind(function (obj, e) {\n\t\tvar el = locate(e);\n\t\tdnd.config.marker.innerHTML = el.outerHTML;\n\t\tvar element = dnd.config.marker.firstChild;\n\t\tif(element){\n\t\t\telement.style.position = \"static\";\n\t\t}\n\n\t\tdnd.config.id = el.getAttribute(grid.$config.item_attribute);\n\n\t\tvar store = getStore();\n\n\t\tvar task = store.getItem(dnd.config.id);\n\t\tdnd.config.index = store.getBranchIndex(dnd.config.id);\n\t\tdnd.config.parent = task.parent;\n\t\ttask.$open = false;\n\t\ttask.$transparent = true;\n\t\tthis.refreshData();\n\t}, gantt));\n\n\tdnd.lastTaskOfLevel = function (level) {\n\t\tvar last_item = null;\n\t\tvar store = getStore();\n\t\tvar tasks = store.getItems();\n\t\tfor (var i = 0, len = tasks.length; i < len; i++) {\n\t\t\tif (tasks[i].$level == level) {\n\t\t\t\tlast_item = tasks[i];\n\t\t\t}\n\t\t}\n\t\treturn last_item ? last_item.id : null;\n\t};\n\tdnd._getGridPos = gantt.bind(function (e) {\n\t\tvar pos = domHelpers.getNodePosition(grid.$grid_data);\n\t\t// row offset\n\t\tvar x = pos.x + grid.$grid.scrollLeft;\n\t\tvar y = e.pos.y - 10;\n\n\t\tvar rowHeight = grid.getItemHeight(dnd.config.id);\n\t\t// prevent moving row out of grid_data container\n\t\tif (y < pos.y) y = pos.y;\n\t\tvar gridHeight = grid.getTotalHeight();\n\t\tif (y > pos.y + gridHeight - rowHeight) y = pos.y + gridHeight - rowHeight;\n\t\tconst maxBottom = pos.y + pos.height;\n\t\tif (y > maxBottom - rowHeight) {\n\t\t\ty = maxBottom - rowHeight;\n\t\t}\n\n\t\tpos.x = x;\n\t\tpos.y = y;\n\t\treturn pos;\n\t}, gantt);\n\tdnd._getTargetY = gantt.bind(function (e) {\n\t\tvar pos = domHelpers.getNodePosition(grid.$grid_data);\n\t\tvar scrollPos = grid.$state.scrollTop || 0;\n\t\tvar maxBottom = gantt.$grid_data.getBoundingClientRect().height + scrollPos;\n\n\t\tvar y = e.pageY - pos.y + scrollPos;\n\t\tif (y > maxBottom) {\n\t\t\ty = maxBottom;\n\t\t} else if (y < scrollPos) {\n\t\t\ty = scrollPos;\n\t\t}\n\t\treturn y;\n\t}, gantt);\n\tdnd._getTaskByY = gantt.bind(function (y, dropIndex) {\n\n\t\tvar store = getStore();\n\n\t\ty = y || 0;\n\n\t\tvar index = grid.getItemIndexByTopPosition(y);\n\t\tindex = dropIndex < index ? index - 1 : index;\n\n\t\tif (index > store.countVisible() - 1)\n\t\t\treturn null;\n\n\t\treturn store.getIdByIndex(index);\n\t}, gantt);\n\tdnd.attachEvent(\"onDragMove\", gantt.bind(function (obj, e) {\n\t\tvar gridDataSizes = gantt.$grid_data.getBoundingClientRect();\n\t\tvar maxBottom = gridDataSizes.height + gridDataSizes.y + (grid.$state.scrollTop || 0) + window.scrollY;\n\t\tvar dd = dnd.config;\n\t\tvar pos = dnd._getGridPos(e);\n\n\t\tgantt._waiAria.reorderMarkerAttr(dd.marker);\n\n\t\tvar config = grid.$getConfig(),\n\t\t\tstore = getStore();\n\n\t\t// setting position of row\n\t\tif (pos.y < maxBottom) {\n\t\t\tdd.marker.style.top = pos.y + \"px\";\n\t\t} else {\n\t\t\tdd.marker.style.top = maxBottom + \"px\";\n\t\t}\n\t\tdd.marker.style.left = pos.x + 10 + \"px\";\n\t\tconst containerSize = domHelpers.getNodePosition(gantt.$root);\n\t\tif (pos.width > containerSize.width){\n\t\t\tdd.marker.style.width = containerSize.width - 10 - 2 + \"px\";\n\t\t\tdd.marker.style.overflow = \"hidden\";\t\n\t\t}\n\n\t\t// highlight row when mouseover\n\t\tvar item = store.getItem(dnd.config.id);\n\t\tvar targetY = dnd._getTargetY(e);\n\t\tvar el = dnd._getTaskByY(targetY, store.getIndexById(item.id));\n\n\t\tif (!store.exists(el)) {\n\t\t\tel = dnd.lastTaskOfLevel(config.order_branch_free ? item.$level : 0);\n\t\t\tif (el == dnd.config.id) {\n\t\t\t\tel = null;\n\t\t\t}\n\t\t}\n\n\t\tfunction allowedLevel(next, item) {\n\t\t\treturn (!(store.isChildOf(over.id, item.id)) && (next.$level == item.$level || config.order_branch_free));\n\t\t}\n\n\t\tif (store.exists(el)) {\n\t\t\tvar over = store.getItem(el);\n\n\t\t\tvar itemTop = grid.getItemTop(over.id);\n\t\t\tvar itemHeight = grid.getItemHeight(over.id);\n\t\t\tif (itemTop + itemHeight / 2 < targetY) {\n\t\t\t\t//hovering over bottom part of item, check can be drop to bottom\n\t\t\t\tvar index = store.getIndexById(over.id);\n\t\t\t\tvar nextId = store.getNext(over.id);//adds +1 when hovering over placeholder\n\t\t\t\tvar next = store.getItem(nextId);\n\t\t\t\tif (checkPlaceholderTask(nextId)){\n\t\t\t\t\tvar prevId = store.getPrev(next.id);\n\t\t\t\t\tnext = store.getItem(prevId);\n\t\t\t\t}\n\t\t\t\tif (next) {\n\t\t\t\t\tif (next.id != item.id) {\n\t\t\t\t\t\tover = next; //there is a valid target\n\t\t\t\t\t}\n\t\t\t\t\telse {\n\t\t\t\t\t\tif (config.order_branch_free) {\n\t\t\t\t\t\t\tif (!(store.isChildOf(item.id, over.id) && store.getChildren(over.id).length == 1))\n\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\telse {\n\t\t\t\t\t\t\t\tstore.move(item.id, store.getBranchIndex(over.id) + 1, store.getParent(over.id));\n\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse {\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\t//we at end of the list, check and drop at the end of list\n\t\t\t\t\tnextId = store.getIdByIndex(index);\n\t\t\t\t\tnext = store.getItem(nextId);\n\n\t\t\t\t\tif (checkPlaceholderTask(nextId)){\n\t\t\t\t\t\tvar prevId = store.getPrev(next.id);\n\t\t\t\t\t\tnext = store.getItem(prevId);\n\t\t\t\t\t}\n\n\t\t\t\t\tif (allowedLevel(next, item) && next.id != item.id) {\n\t\t\t\t\t\tstore.move(item.id, -1, store.getParent(next.id));\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\telse if (config.order_branch_free) {\n\t\t\t\tif (over.id != item.id && allowedLevel(over, item) && !checkPlaceholderTask(over.id)) {\n\t\t\t\t\tif (!store.hasChild(over.id)) {\n\t\t\t\t\t\tover.$open = true;\n\t\t\t\t\t\tstore.move(item.id, -1, over.id);\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t\tif (store.getIndexById(over.id) || itemHeight / 3 < targetY) return;\n\t\t\t\t}\n\t\t\t}\n\t\t\t//if item is on different level, check the one before it\n\t\t\tvar index = store.getIndexById(over.id),\n\t\t\t\tprevId = store.getIdByIndex(index - 1);\n\n\t\t\tvar prev = store.getItem(prevId);\n\n\t\t\tvar shift = 1;\n\t\t\twhile ((!prev || prev.id == over.id) && index - shift >= 0) {\n\n\t\t\t\tprevId = store.getIdByIndex(index - shift);\n\t\t\t\tprev = store.getItem(prevId);\n\t\t\t\tshift++;\n\t\t\t}\n\n\t\t\tif (item.id == over.id || checkPlaceholderTask(over.id)) return;\n\t\t\t//replacing item under cursor\n\t\t\tif (allowedLevel(over, item) && item.id != over.id) {\n\t\t\t\tstore.move(item.id, 0, 0, over.id);\n\n\t\t\t} else if (over.$level == item.$level - 1 && !store.getChildren(over.id).length) {\n\t\t\t\tstore.move(item.id, 0, over.id);\n\n\t\t\t} else if (prev && (allowedLevel(prev, item)) && (item.id != prev.id)) {\n\t\t\t\tstore.move(item.id, -1, store.getParent(prev.id));\n\n\t\t\t}\n\t\t}\n\t\treturn true;\n\t}, gantt));\n\n\tdnd.attachEvent(\"onDragEnd\", gantt.bind(function () {\n\t\tvar store = getStore();\n\t\tvar task = store.getItem(dnd.config.id);\n\t\ttask.$transparent = false;\n\t\ttask.$open = dnd.config.initial_open_state;\n\n\t\tif (this.callEvent(\"onBeforeRowDragEnd\", [dnd.config.id, dnd.config.parent, dnd.config.index]) === false) {\n\t\t\tstore.move(dnd.config.id, dnd.config.index, dnd.config.parent);\n\t\t\ttask.$drop_target = null;\n\t\t} else {\n\t\t\tthis.callEvent(\"onRowDragEnd\", [dnd.config.id, task.$drop_target]);\n\t\t}\n\t\tgantt.render();\n\t\tthis.refreshData();\n\t}, gantt));\n}\n\nexport default {\n\tinit: _init_dnd\n};","/**\n * The state object for order branch drag and drop\n */\n\nimport * as utils from \"../../../../utils/utils\";\n\nexport default {\n\tcreateDropTargetObject: function createDropTargetObject(parent) {\n\t\tvar res = {\n\t\t\ttargetParent: null,\n\t\t\ttargetIndex: 0,\n\t\t\ttargetId: null,\n\t\t\tchild: false,\n\t\t\tnextSibling: false,\n\t\t\tprevSibling: false\n\t\t};\n\n\t\tif (parent) {\n\t\t\tutils.mixin(res, parent, true);\n\t\t}\n\t\treturn res;\n\t},\n\tnextSiblingTarget: function nextSiblingTarget(dndTaskId, targetTaskId, store) {\n\t\tvar result = this.createDropTargetObject();\n\t\tresult.targetId = targetTaskId;\n\t\tresult.nextSibling = true;\n\t\tresult.targetParent = store.getParent(result.targetId);\n\t\tresult.targetIndex = store.getBranchIndex(result.targetId);\n\t\tif(store.getParent(dndTaskId) != result.targetParent || result.targetIndex < store.getBranchIndex(dndTaskId)){\n\t\t\tresult.targetIndex += 1;\n\t\t}\n\t\treturn result;\n\t},\n\tprevSiblingTarget: function prevSiblingTarget(dndTaskId, targetTaskId, store) {\n\t\tvar result = this.createDropTargetObject();\n\t\tresult.targetId = targetTaskId;\n\t\tresult.prevSibling = true;\n\t\tresult.targetParent = store.getParent(result.targetId);\n\t\tresult.targetIndex = store.getBranchIndex(result.targetId);\n\t\tif(store.getParent(dndTaskId) == result.targetParent && result.targetIndex > store.getBranchIndex(dndTaskId)){\n\t\t\tresult.targetIndex -= 1;\n\t\t}\n\t\treturn result;\n\t},\n\tfirstChildTarget: function firstChildTarget(dndTaskId, targetTaskId, store) {\n\t\tvar result = this.createDropTargetObject();\n\t\tresult.targetId = targetTaskId;\n\t\tresult.targetParent = result.targetId;\n\t\tresult.targetIndex = 0;\n\t\tresult.child = true;\n\t\treturn result;\n\t},\n\tlastChildTarget: function lastChildTarget(dndTaskId, targetTaskId, store) {\n\t\tvar children = store.getChildren(targetTaskId);\n\t\tvar result = this.createDropTargetObject();\n\t\tresult.targetId = children[children.length - 1];\n\t\tresult.targetParent = targetTaskId;\n\t\tresult.targetIndex = children.length;\n\t\tresult.nextSibling = true;\n\t\treturn result;\n\t}\n};","/**\n * resolve dnd position of the task when gantt.config.order_branch_free = false\n */\n\nimport dropTarget from \"./drop_target\";\n\nfunction getLast(store){\n\tvar current = store.getNext();\n\twhile(store.exists(current)){\n\n\t\tvar next = store.getNext(current);\n\t\tif(!store.exists(next)){\n\t\t\treturn current;\n\t\t}else{\n\t\t\tcurrent = next;\n\t\t}\n\t}\n\treturn null;\n}\n\nfunction findClosesTarget(dndTaskId, taskId, allowedLevel, store, up){\n\tvar prev = taskId;\n\twhile(store.exists(prev)){\n\t\tvar targetLevel = store.calculateItemLevel(store.getItem(prev));\n\t\tif((targetLevel === allowedLevel || targetLevel === (allowedLevel - 1)) && store.getBranchIndex(prev) > -1){\n\t\t\tbreak;\n\t\t}else {\n\t\t\tprev = up ? store.getPrev(prev) : store.getNext(prev);\n\t\t}\n\t}\n\n\tif(store.exists(prev)){\n\t\tif(store.calculateItemLevel(store.getItem(prev)) === allowedLevel){\n\t\t\treturn up ? dropTarget.nextSiblingTarget(dndTaskId, prev, store) : dropTarget.prevSiblingTarget(dndTaskId, prev, store);\n\t\t}else{\n\t\t\treturn dropTarget.firstChildTarget(dndTaskId, prev, store);\n\t\t}\n\t}\n\treturn null;\n}\n\nfunction findTargetAbove(dndTaskId, taskId, allowedLevel, store){\n\treturn findClosesTarget(dndTaskId, taskId, allowedLevel, store, true);\n}\nfunction findTargetBelow(dndTaskId, taskId, allowedLevel, store){\n\treturn findClosesTarget(dndTaskId, taskId, allowedLevel, store, false);\n}\n\nexport default function getSameLevelDropPosition(dndTaskId, targetTaskId, relTargetPos, eventTop, store, level){\n\tvar result;\n\tif(targetTaskId !== store.$getRootId()){\n\t\tvar targetTask = store.getItem(targetTaskId);\n\t\tvar targetLevel = store.calculateItemLevel(targetTask);\n\t\tif(targetLevel === level){\n\t\t\tvar prevSibling = store.getPrevSibling(targetTaskId);\n\t\t\tif(relTargetPos < 0.5 && !prevSibling){\n\t\t\t\tresult = dropTarget.prevSiblingTarget(dndTaskId, targetTaskId, store);\n\t\t\t}else{\n\t\t\t\tif(relTargetPos < 0.5){\n\t\t\t\t\ttargetTaskId = prevSibling;\n\t\t\t\t}\n\t\t\t\tresult = dropTarget.nextSiblingTarget(dndTaskId, targetTaskId, store);\n\t\t\t}\n\t\t}else if(targetLevel > level){\n\t\t\tstore.eachParent(function(parent){\n\t\t\t\tif(store.calculateItemLevel(parent) === level){\n\t\t\t\t\ttargetTaskId = parent.id;\n\t\t\t\t}\n\t\t\t}, targetTask); \n\t\t\tresult = findTargetAbove(dndTaskId, targetTaskId, level, store);\n\t\t}else{\n\t\t\tvar targetAbove = findTargetAbove(dndTaskId, targetTaskId, level, store);\n\t\t\tvar targetBelow = findTargetBelow(dndTaskId, targetTaskId, level, store);\n\t\t\tresult = (relTargetPos < 0.5) ? targetAbove : targetBelow;\n\t\t}\n\t}else{\n\t\tvar rootId = store.$getRootId();\n\t\tvar rootLevel = store.getChildren(rootId);\n\t\tresult = dropTarget.createDropTargetObject();\n\t\tif(rootLevel.length && eventTop >= 0){\n\t\t\tresult = findTargetAbove(dndTaskId, getLast(store), level, store);\n\t\t}else{\n\t\t\tresult = findTargetBelow(dndTaskId, rootId, level, store);\n\t\t}\n\t}\n\n\treturn result;\n};\n","import * as domHelpers from \"../../utils/dom_helpers\";\n\n/**\n * methods for highlighting current drag and drop position\n */\n\nfunction highlightPosition(target, root, grid){\n\tvar markerPos = getTaskMarkerPosition(target, grid);\n\t// setting position of row\n\troot.marker.style.left = markerPos.x + 9 + \"px\";\n\troot.marker.style.width = markerPos.width + \"px\";\n\troot.marker.style.overflow = \"hidden\";\n\tvar markerLine = root.markerLine;\n\tif(!markerLine){\n\t\tmarkerLine = document.createElement(\"div\");\n\t\tmarkerLine.className = \"gantt_drag_marker gantt_grid_dnd_marker\";\n\t\tmarkerLine.innerHTML = \"<div class='gantt_grid_dnd_marker_line'></div>\";\n\t\tmarkerLine.style.pointerEvents = \"none\";\n\t}\n\n\tif(target.child){\n\t\thighlightFolder(target, markerLine, grid);\n\t}else{\n\t\thighlightRow(target, markerLine, grid);\n\t}\n\n\tif(!root.markerLine){\n\t\tdocument.body.appendChild(markerLine);\n\t\troot.markerLine = markerLine;\n\t}\n}\n\nfunction removeLineHighlight(root){\n\tif(root.markerLine && root.markerLine.parentNode){\n\t\troot.markerLine.parentNode.removeChild(root.markerLine);\n\t}\n\troot.markerLine = null;\n}\n\nfunction highlightRow(target, markerLine, grid){\n\tvar linePos = getLineMarkerPosition(target, grid);\n\tvar maxBottom = grid.$grid_data.getBoundingClientRect().bottom + window.scrollY;\n\n\tmarkerLine.innerHTML = \"<div class='gantt_grid_dnd_marker_line'></div>\";\n\tmarkerLine.style.left = linePos.x + \"px\";\n\tmarkerLine.style.height = \"4px\";\n\n\tvar markerLineTop = linePos.y - 2;\n\tmarkerLine.style.top = markerLineTop + \"px\";\n\tmarkerLine.style.width = linePos.width + \"px\";\n\n\tif (markerLineTop > maxBottom) {\n\t\tmarkerLine.style.top = maxBottom + 'px';\n\t}\n\n\treturn markerLine;\n}\nfunction highlightFolder(target, markerFolder, grid){\n\tvar id = target.targetParent;\n\tvar pos = gridToPageCoordinates({x: 0, y: grid.getItemTop(id)}, grid);\n\tvar maxBottom = grid.$grid_data.getBoundingClientRect().bottom + window.scrollY;\n\n\tlet folderHighlightWidth = setWidthWithinContainer(grid.$gantt, grid.$grid_data.offsetWidth);\t\n\n\tmarkerFolder.innerHTML = \"<div class='gantt_grid_dnd_marker_folder'></div>\";\n\tmarkerFolder.style.width = folderHighlightWidth + \"px\";\n\tmarkerFolder.style.top = pos.y + \"px\";\n\tmarkerFolder.style.left = pos.x  + \"px\";\n\tmarkerFolder.style.height = grid.getItemHeight(id) + \"px\";\n\tif (pos.y > maxBottom) {\n\t\tmarkerFolder.style.top = maxBottom + 'px';\n\t}\n\n\treturn markerFolder;\n}\n\nfunction getLineMarkerPosition(target, grid){\n\tvar store = grid.$config.rowStore;\n\tvar pos = {x:0, y:0};\n\tvar indentNode = grid.$grid_data.querySelector(\".gantt_tree_indent\");\n\tvar indent = 15;\n\tvar level = 0;\n\tif(indentNode){\n\t\tindent = indentNode.offsetWidth;\n\t}\n\tvar iconWidth = 40;\n\tif(target.targetId !== store.$getRootId()){\n\t\tvar itemTop = grid.getItemTop(target.targetId);\n\t\tvar itemHeight = grid.getItemHeight(target.targetId);\n\t\tlevel = store.exists(target.targetId) ? store.calculateItemLevel(store.getItem(target.targetId)) : 0;\n\n\t\tif(target.prevSibling){\n\t\t\tpos.y = itemTop;\n\t\t}else if(target.nextSibling){\n\t\t\tvar childCount = 0;\n\t\t\tstore.eachItem(function(child){\n\t\t\t\tif(store.getIndexById(child.id) !== -1)\n\t\t\t\t\tchildCount++;\n\t\t\t}, target.targetId);\n\n\t\t\tpos.y = itemTop + itemHeight + childCount*itemHeight;\n\t\t}else {\n\t\t\tpos.y = itemTop + itemHeight;\n\t\t\tlevel += 1;\n\t\t}\n\t}\n\tpos.x = iconWidth + level * indent;\n\tpos.width = setWidthWithinContainer(grid.$gantt, Math.max(grid.$grid_data.offsetWidth - pos.x, 0), pos.x);\n\treturn gridToPageCoordinates(pos, grid);\n}\n\nfunction gridToPageCoordinates(pos, grid){\n\tvar gridPos = domHelpers.getNodePosition(grid.$grid_data);\n\tpos.x += gridPos.x + grid.$grid.scrollLeft;\n\tpos.y += gridPos.y - grid.$grid_data.scrollTop;\n\treturn pos;\n}\n\nfunction getTaskMarkerPosition(e, grid) {\n\tvar pos = domHelpers.getNodePosition(grid.$grid_data);\n\tvar ePos = domHelpers.getRelativeEventPosition(e, grid.$grid_data);\n\t// row offset\n\tvar x = pos.x + grid.$grid.scrollLeft;\n\tvar y = ePos.y - 10;\n\n\tvar rowHeight = grid.getItemHeight(e.targetId);\n\t// prevent moving row out of grid_data container\n\tif (y < pos.y) y = pos.y;\n\tvar gridHeight = grid.getTotalHeight();\n\tif (y > pos.y + gridHeight - rowHeight) y = pos.y + gridHeight - rowHeight;\n\n\tpos.x = x;\n\tpos.y = y;\n\tpos.width = setWidthWithinContainer(grid.$gantt, pos.width, 9);\n\treturn pos;\n}\n\nfunction setWidthWithinContainer(gantt, width, offset = 0){\n\tconst containerSize = domHelpers.getNodePosition(gantt.$root);\n\tif (width > containerSize.width){\n\t\twidth = containerSize.width - offset - 2;\n\t}\n\treturn width;\n}\n\nexport default {\n\tremoveLineHighlight: removeLineHighlight,\n\thighlightPosition: highlightPosition\n};\n","import * as domHelpers from \"../utils/dom_helpers\";\nimport dropTarget from \"./tasks_grid_dnd_marker_helpers/drop_target\";\nimport getLockedLevelTarget from \"./tasks_grid_dnd_marker_helpers/locked_level\";\nimport getMultiLevelTarget from \"./tasks_grid_dnd_marker_helpers/multi_level\";\nimport higlighter from \"./tasks_grid_dnd_marker_helpers/highlight\";\nimport isPlaceholderTask from \"../../../utils/placeholder_task\";\n\nfunction _init_dnd(gantt, grid) {\n\tvar DnD = gantt.$services.getService(\"dnd\");\n\n\tif(!grid.$config.bind || !gantt.getDatastore(grid.$config.bind)){\n\t\treturn;\n\t}\n\n\tfunction locate(e){\n\t\treturn domHelpers.locateAttribute(e, grid.$config.item_attribute);\n\t}\n\n\tfunction getStore(){\n\t\treturn gantt.getDatastore(grid.$config.bind);\n\t}\n\n\tfunction checkPlaceholderTask(id){\n\t\treturn isPlaceholderTask(id, gantt, getStore());\n\t}\n\n\tvar dnd = new DnD(grid.$grid_data, {updates_per_second: 60});\n\tif (gantt.defined(grid.$getConfig().dnd_sensitivity))\n\t\tdnd.config.sensitivity = grid.$getConfig().dnd_sensitivity;\n\n\tdnd.attachEvent(\"onBeforeDragStart\", gantt.bind(function (obj, e) {\n\t\tvar el = locate(e);\n\t\tif (!el) return false;\n\t\tif (gantt.hideQuickInfo) gantt.hideQuickInfo();\n\t\tif (domHelpers.closest(e.target, \".gantt_grid_editor_placeholder\")){\n\t\t\treturn false;\n\t\t}\n\n\t\tvar id = el.getAttribute(grid.$config.item_attribute);\n\t\tvar datastore = grid.$config.rowStore;\n\t\tvar task = datastore.getItem(id);\n\n\t\tif (gantt.isReadonly(task) || checkPlaceholderTask(id))\n\t\t\treturn false;\n\n\t\tdnd.config.initial_open_state = task.$open;\n\t\tif (!gantt.callEvent(\"onRowDragStart\", [id, e.target || e.srcElement, e])) {\n\t\t\treturn false;\n\t\t}\n\n\t}, gantt));\n\n\tdnd.attachEvent(\"onAfterDragStart\", gantt.bind(function (obj, e) {\n\t\tvar el = locate(e);\n\n\t\tdnd.config.marker.innerHTML = el.outerHTML;\n\t\tvar element = dnd.config.marker.firstChild;\n\t\tif(element){\n\t\t\tdnd.config.marker.style.opacity = 0.4;\n\t\t\telement.style.position = \"static\";\n\t\t\telement.style.pointerEvents = \"none\";\n\t\t}\n\n\t\tdnd.config.id = el.getAttribute(grid.$config.item_attribute);\n\n\t\tvar store = grid.$config.rowStore;\n\n\t\tvar task = store.getItem(dnd.config.id);\n\t\tdnd.config.level = store.calculateItemLevel(task);\n\t\tdnd.config.drop_target = dropTarget.createDropTargetObject({\n\t\t\ttargetParent: store.getParent(task.id),\n\t\t\ttargetIndex: store.getBranchIndex(task.id),\n\t\t\ttargetId: task.id,\n\t\t\tnextSibling: true\n\t\t});\n\n\t\ttask.$open = false;\n\t\ttask.$transparent = true;\n\t\tthis.refreshData();\n\t}, gantt));\n\n\tfunction getTargetTaskId(e){\n\t\tvar y = domHelpers.getRelativeEventPosition(e, grid.$grid_data).y;\n\t\tvar store = grid.$config.rowStore;\n\n\t\tif (!document.doctype){\n\t\t\ty += window.scrollY;\n\t\t}\n\t\ty = y || 0;\n\n\t\t// limits for the marker according to the layout layer\n\t\tvar scrollPos = grid.$state.scrollTop || 0;\n\t\tvar maxBottom = gantt.$grid_data.getBoundingClientRect().height + scrollPos + window.scrollY;\n\t\tvar minTop = scrollPos;\n\n\t\tvar firstVisibleTaskIndex = grid.getItemIndexByTopPosition(grid.$state.scrollTop);\n\t\tif (!store.exists(firstVisibleTaskIndex)){\n\t\t\tfirstVisibleTaskIndex = store.countVisible() - 1;\n\t\t}\n\t\tif (firstVisibleTaskIndex < 0) {\n\t\t\treturn store.$getRootId();\n\t\t}\n\n\t\tvar firstVisibleTaskId = store.getIdByIndex(firstVisibleTaskIndex);\n\n\t\tvar firstVisibleTaskPos = grid.$state.scrollTop / grid.getItemHeight(firstVisibleTaskId);\n\t\tvar hiddenTaskPart = firstVisibleTaskPos - Math.floor(firstVisibleTaskPos);\n\t\tif (hiddenTaskPart > 0.1 && hiddenTaskPart < 0.9) {\n\t\t\tmaxBottom = maxBottom - grid.getItemHeight(firstVisibleTaskId) * hiddenTaskPart;\n\t\t\tminTop = minTop + grid.getItemHeight(firstVisibleTaskId) * (1 - hiddenTaskPart);\n\t\t}\n\n\t\t// GS-715. The placeholder task row shouldn't be draggable below the Gantt container\n\t\tconst gridPosition = domHelpers.getNodePosition(grid.$grid_data);\n\t\tconst gridBottom = gridPosition.y + gridPosition.height;\n\t\tconst placeholderRowHeight = dnd.config.marker.offsetHeight;\n\t\tif (y + placeholderRowHeight + window.scrollY >= maxBottom){\n\t\t\tdnd.config.marker.style.top = gridBottom - placeholderRowHeight\t+ \"px\";\n\t\t}\n\n\t\tif (y >= maxBottom) {\n\t\t\ty = maxBottom;\n\t\t} else if (y <= minTop) {\n\t\t\ty = minTop;\n\t\t\tdnd.config.marker.style.top = gridPosition.y + \"px\";\n\t\t}\n\n\t\tvar index = grid.getItemIndexByTopPosition(y);\n\n\t\tif (index > store.countVisible() - 1 || index < 0) {\n\t\t\treturn store.$getRootId();\n\t\t}\n\n\t\tvar targetId = store.getIdByIndex(index);\n\t\tif (checkPlaceholderTask(targetId)) {\n\t\t\treturn store.getPrevSibling(targetId);\n\t\t}\n\n\t\treturn store.getIdByIndex(index);\n\t}\n\n\tfunction getDropPosition(e){\n\t\tvar targetTaskId = getTargetTaskId(e);\n\t\tvar relTargetPos = null;\n\t\tvar store = grid.$config.rowStore;\n\t\tvar config = grid.$getConfig();\n\t\tvar lockLevel = !config.order_branch_free;\n\n\t\tvar eventTop = domHelpers.getRelativeEventPosition(e, grid.$grid_data).y;\n\t\tif (!document.doctype){\n\t\t\teventTop += window.scrollY;\n\t\t}\n\n\t\tif(targetTaskId !== store.$getRootId()) {\n\t\t\tvar rowTop = grid.getItemTop(targetTaskId);\n\t\t\tvar rowHeight = grid.getItemHeight(targetTaskId);\n\t\t\trelTargetPos = (eventTop - rowTop) / rowHeight;\n\t\t}\n\n\t\tvar result;\n\t\tif(!lockLevel){\n\t\t\tresult = getMultiLevelTarget(dnd.config.id, targetTaskId, relTargetPos, eventTop, store);\n\t\t}else{\n\t\t\tresult = getLockedLevelTarget(dnd.config.id, targetTaskId, relTargetPos, eventTop, store, dnd.config.level);\n\t\t\tif(result && result.targetParent && checkPlaceholderTask(result.targetParent)){\n\t\t\t\ttargetTaskId = store.getPrevSibling(result.targetParent);\n\t\t\t\tresult = getLockedLevelTarget(dnd.config.id, targetTaskId, relTargetPos, eventTop, store, dnd.config.level);\n\t\t\t}\n\t\t}\n\n\t\treturn result;\n\t}\n\n\tdnd.attachEvent(\"onDragMove\", gantt.bind(function (obj, e) {\n\t\tvar target = getDropPosition(e);\n\n\t\tif(!target ||\n\t\t\tgantt.callEvent(\"onBeforeRowDragMove\", [dnd.config.id, target.targetParent, target.targetIndex]) === false){\n\t\t\t\ttarget = dropTarget.createDropTargetObject(dnd.config.drop_target);\n\t\t\t}\n\n\t\thiglighter.highlightPosition(target, dnd.config, grid);\n\t\tdnd.config.drop_target = target;\n\t\tgantt._waiAria.reorderMarkerAttr(dnd.config.marker);\n\n\t\tthis.callEvent(\"onRowDragMove\", [dnd.config.id, target.targetParent, target.targetIndex]);\n\t\treturn true;\n\t}, gantt));\n\n\tdnd.attachEvent(\"onDragEnd\", gantt.bind(function () {\n\t\tvar store = grid.$config.rowStore;\n\t\tvar task = store.getItem(dnd.config.id);\n\n\t\thiglighter.removeLineHighlight(dnd.config);\n\n\t\ttask.$transparent = false;\n\t\ttask.$open = dnd.config.initial_open_state;\n\t\tvar target = dnd.config.drop_target;\n\n\t\tif (this.callEvent(\"onBeforeRowDragEnd\", [dnd.config.id, target.targetParent, target.targetIndex]) === false) {\n\t\t\ttask.$drop_target = null;\n\t\t} else {\n\t\t\tstore.move(dnd.config.id, target.targetIndex, target.targetParent);\n\t\t\tgantt.render();\n\t\t\tthis.callEvent(\"onRowDragEnd\", [dnd.config.id, target.targetParent, target.targetIndex]);\n\t\t}\n\t\tstore.refresh(task.id);\n\t}, gantt));\n}\n\nexport default {\n\tinit: _init_dnd\n};","/**\n * resolve dnd position of the task when gantt.config.order_branch_free = true\n */\n\nimport dropTarget from \"./drop_target\";\n\nexport default function getMultiLevelDropPosition(dndTaskId, targetTaskId, relTargetPos, eventTop, store){\n\tvar result;\n\n\tif(targetTaskId !== store.$getRootId()){\n\t\tif(relTargetPos < 0.25){\n\t\t\tresult = dropTarget.prevSiblingTarget(dndTaskId, targetTaskId, store);\n\t\t}else if(relTargetPos > 0.60 && !(store.hasChild(targetTaskId) && store.getItem(targetTaskId).$open)){\n\t\t\tresult = dropTarget.nextSiblingTarget(dndTaskId, targetTaskId, store);\n\t\t}else {\n\t\t\tresult = dropTarget.firstChildTarget(dndTaskId, targetTaskId, store);\n\t\t}\n\t}else{\n\t\tvar rootId = store.$getRootId();\n\t\tif(store.hasChild(rootId) && eventTop >= 0){\n\t\t\tresult = dropTarget.lastChildTarget(dndTaskId, rootId, store);\n\t\t}else{\n\t\t\tresult = dropTarget.firstChildTarget(dndTaskId, rootId, store);\n\t\t}\n\t}\n\n\treturn result;\n};","import * as utils from \"../../../utils/utils\";\nimport rowDnd from \"./tasks_grid_dnd\";\nimport rowDndMarker from \"./tasks_grid_dnd_marker\";\nimport mouseEventContainer from \"../mouse_event_container\";\n\nvar initializer = (function(){\n\treturn function(gantt){\n\t\treturn {\n\t\t\tonCreated: function (grid) {\n\t\t\t\tgrid.$config = utils.mixin(grid.$config, {\n\t\t\t\t\tbind: \"task\"\n\t\t\t\t});\n\t\t\t\tif(grid.$config.id == \"grid\") {\n\t\t\t\t\tthis.extendGantt(grid);\n\t\t\t\t\tgantt.ext.inlineEditors = gantt.ext._inlineEditors.createEditors(grid);\n\t\t\t\t\tgantt.ext.inlineEditors.init();\n\t\t\t\t}\n\n\t\t\t\tthis._mouseDelegates = mouseEventContainer(gantt);\n\t\t\t},\n\t\t\tonInitialized: function (grid) {\n\t\t\t\tvar config = grid.$getConfig();\n\t\t\t\tif (config.order_branch) {\n\t\t\t\t\tif(config.order_branch == \"marker\"){\n\t\t\t\t\t\trowDndMarker.init(grid.$gantt, grid);\n\t\t\t\t\t}else{\n\t\t\t\t\t\trowDnd.init(grid.$gantt, grid);\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tthis.initEvents(grid, gantt);\n\t\t\t\tif(grid.$config.id == \"grid\") {\n\t\t\t\t\tthis.extendDom(grid);\n\t\t\t\t}\n\t\t\t},\n\t\t\tonDestroyed: function (grid) {\n\t\t\t\tif(grid.$config.id == \"grid\") {\n\t\t\t\t\t// GS-1288. We need to only detach the store and its events without detaching the\n\t\t\t\t\t// inline editor's events. Otherwise, we won't be able to access them\n\t\t\t\t\tgantt.ext.inlineEditors.detachStore();\n\t\t\t\t}\n\t\t\t\tthis.clearEvents(grid, gantt);\n\t\t\t},\n\n\t\t\tinitEvents: function (grid, gantt) {\n\t\t\t\tthis._mouseDelegates.delegate(\"click\", \"gantt_row\", gantt.bind(function (e, id, trg) {\n\t\t\t\t\tvar config = grid.$getConfig();\n\t\t\t\t\tif (id !== null) {\n\t\t\t\t\t\tvar task = this.getTask(id);\n\t\t\t\t\t\tif (config.scroll_on_click && !gantt._is_icon_open_click(e))\n\t\t\t\t\t\t\tthis.showDate(task.start_date);\n\t\t\t\t\t\tgantt.callEvent(\"onTaskRowClick\", [id, trg]);\n\t\t\t\t\t}\n\t\t\t\t}, gantt), grid.$grid);\n\n\t\t\t\tthis._mouseDelegates.delegate(\"click\", \"gantt_grid_head_cell\", gantt.bind(function (e, id, trg) {\n\t\t\t\t\tvar column = trg.getAttribute(\"data-column-id\");\n\n\t\t\t\t\tif (!gantt.callEvent(\"onGridHeaderClick\", [column, e]))\n\t\t\t\t\t\treturn;\n\n\t\t\t\t\tvar config = grid.$getConfig();\n\n\t\t\t\t\tif (column == \"add\") {\n\t\t\t\t\t\tvar mouseEvents = gantt.$services.getService(\"mouseEvents\");\n\t\t\t\t\t\tmouseEvents.callHandler(\"click\", \"gantt_add\", grid.$grid, [e, config.root_id]);\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (config.sort && column) { // GS-929: if there is no column name, we cannot sort the column\n\t\t\t\t\t\tvar sorting_method = column,\n\t\t\t\t\t\t\tconf;\n\n\t\t\t\t\t\tfor (var i = 0; i < config.columns.length; i++) {\n\t\t\t\t\t\t\tif (config.columns[i].name == column) {\n\t\t\t\t\t\t\t\tconf = config.columns[i];\n\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (conf && conf.sort !== undefined && conf.sort !== true) {\n\t\t\t\t\t\t\tsorting_method = conf.sort;\n\n\t\t\t\t\t\t\tif (!sorting_method) { // column sort property 'false', no sorting\n\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tvar sort = (this._sort && this._sort.direction && this._sort.name == column) ? this._sort.direction : \"desc\";\n\t\t\t\t\t\t// invert sort direction\n\t\t\t\t\t\tsort = (sort == \"desc\") ? \"asc\" : \"desc\";\n\t\t\t\t\t\tthis._sort = {\n\t\t\t\t\t\t\tname: column,\n\t\t\t\t\t\t\tdirection: sort\n\t\t\t\t\t\t};\n\t\t\t\t\t\tthis.sort(sorting_method, sort == \"desc\");\n\t\t\t\t\t}\n\t\t\t\t}, gantt), grid.$grid);\n\n\t\t\t\tthis._mouseDelegates.delegate(\"click\", \"gantt_add\", gantt.bind(function (e, id, trg) {\n\t\t\t\t\tvar config = grid.$getConfig();\n\t\t\t\t\tif (config.readonly) return;\n\n\t\t\t\t\tvar item = {};\n\t\t\t\t\tthis.createTask(item, id ? id : gantt.config.root_id);\n\n\t\t\t\t\treturn false;\n\t\t\t\t}, gantt), grid.$grid);\n\n\t\t\t},\n\n\t\t\tclearEvents: function(grid, gantt){\n\t\t\t\tthis._mouseDelegates.destructor();\n\t\t\t\tthis._mouseDelegates = null;\n\t\t\t},\n\n\t\t\textendDom: function(grid){\n\t\t\t\tgantt.$grid = grid.$grid;\n\t\t\t\tgantt.$grid_scale = grid.$grid_scale;\n\t\t\t\tgantt.$grid_data = grid.$grid_data;\n\t\t\t},\n\t\t\textendGantt: function(grid){\n\t\t\t\tgantt.getGridColumns = gantt.bind(grid.getGridColumns, grid);\n\n\t\t\t\tgrid.attachEvent(\"onColumnResizeStart\", function(){\n\t\t\t\t\treturn gantt.callEvent(\"onColumnResizeStart\", arguments);\n\t\t\t\t});\n\t\t\t\tgrid.attachEvent(\"onColumnResize\", function(){\n\t\t\t\t\treturn gantt.callEvent(\"onColumnResize\", arguments);\n\t\t\t\t});\n\t\t\t\tgrid.attachEvent(\"onColumnResizeEnd\", function(){\n\t\t\t\t\treturn gantt.callEvent(\"onColumnResizeEnd\", arguments);\n\t\t\t\t});\n\n\t\t\t\tgrid.attachEvent(\"onColumnResizeComplete\", function(columns, totalWidth){\n\t\t\t\t\tgantt.config.grid_width = totalWidth;\n\t\t\t\t});\n\n\t\t\t\tgrid.attachEvent(\"onBeforeRowResize\", function(){\n\t\t\t\t\treturn gantt.callEvent(\"onBeforeRowResize\", arguments);\n\t\t\t\t});\n\t\t\t\tgrid.attachEvent(\"onRowResize\", function(){\n\t\t\t\t\treturn gantt.callEvent(\"onRowResize\", arguments);\n\t\t\t\t});\n\t\t\t\tgrid.attachEvent(\"onBeforeRowResizeEnd\", function(){\n\t\t\t\t\treturn gantt.callEvent(\"onBeforeRowResizeEnd\", arguments);\n\t\t\t\t});\n\t\t\t\tgrid.attachEvent(\"onAfterRowResize\", function(){\n\t\t\t\t\treturn gantt.callEvent(\"onAfterRowResize\", arguments);\n\t\t\t\t});\n\t\t\t}\n\t\t};\n\t};\n})();\n\nexport default initializer;","import * as domHelpers from \"../utils/dom_helpers\";\nimport * as utils from \"../../../utils/utils\";\nimport timeout from \"../../../utils/timeout\";\nimport * as helpers from \"../../../utils/helpers\";\n\nfunction createTaskDND(timeline, gantt) {\n\tvar services = gantt.$services;\n\treturn {\n\t\tdrag: null,\n\t\tdragMultiple: {},\n\t\t_events: {\n\t\t\tbefore_start: {},\n\t\t\tbefore_finish: {},\n\t\t\tafter_finish: {}\n\t\t},\n\t\t_handlers: {},\n\t\tinit: function() {\n\t\t\tthis._domEvents = gantt._createDomEventScope();\n\t\t\tthis.clear_drag_state();\n\t\t\tvar drag = gantt.config.drag_mode;\n\t\t\tthis.set_actions();\n\n\t\t\tvar stateService = services.getService(\"state\");\n\t\t\tstateService.registerProvider(\"tasksDnd\", utils.bind(function() {\n\t\t\t\treturn {\n\t\t\t\t\tdrag_id : this.drag ? this.drag.id : undefined,\n\t\t\t\t\tdrag_mode : this.drag ? this.drag.mode : undefined,\n\t\t\t\t\tdrag_from_start : this.drag ? this.drag.left : undefined\n\t\t\t\t};\n\t\t\t}, this));\n\n\t\t\tvar evs = {\n\t\t\t\t\"before_start\": \"onBeforeTaskDrag\",\n\t\t\t\t\"before_finish\": \"onBeforeTaskChanged\",\n\t\t\t\t\"after_finish\": \"onAfterTaskDrag\"\n\t\t\t};\n\t\t\t//for now, all drag operations will trigger the same events\n\t\t\tfor (var stage in this._events) {\n\t\t\t\tfor (var mode in drag) {\n\t\t\t\t\tthis._events[stage][mode] = evs[stage];\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tthis._handlers[drag.move] = this._move;\n\t\t\tthis._handlers[drag.resize] = this._resize;\n\t\t\tthis._handlers[drag.progress] = this._resize_progress;\n\t\t},\n\t\tset_actions: function() {\n\t\t\tvar data = timeline.$task_data;\n\t\t\tthis._domEvents.attach(data, \"mousemove\", gantt.bind(function(e) {\n\t\t\t\tthis.on_mouse_move(e);\n\t\t\t}, this));\n\t\t\tthis._domEvents.attach(data, \"mousedown\", gantt.bind(function(e) {\n\t\t\t\tthis.on_mouse_down(e);\n\t\t\t}, this));\n\t\t\tthis._domEvents.attach(document.body, \"mouseup\", gantt.bind(function(e) {\n\t\t\t\tthis.on_mouse_up(e);\n\t\t\t}, this));\n\t\t},\n\n\t\tclear_drag_state: function() {\n\t\t\tthis.drag = {\n\t\t\t\tid: null,\n\t\t\t\tmode: null,\n\t\t\t\tpos: null,\n\t\t\t\tstart_x: null,\n\t\t\t\tstart_y: null,\n\t\t\t\tobj: null,\n\t\t\t\tleft: null\n\t\t\t};\n\t\t\tthis.dragMultiple = {};\n\t\t},\n\t\t_resize: function(task, shift, drag) {\n\t\t\tvar cfg = timeline.$getConfig();\n\t\t\tvar coords_x = this._drag_task_coords(task, drag);\n\t\t\tif (drag.left) {\n\t\t\t\ttask.start_date = gantt.dateFromPos(coords_x.start + shift);\n\t\t\t\tif (!task.start_date) {\n\t\t\t\t\ttask.start_date = new Date(gantt.getState().min_date);\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\ttask.end_date = gantt.dateFromPos(coords_x.end + shift);\n\t\t\t\tif (!task.end_date) {\n\t\t\t\t\ttask.end_date = new Date(gantt.getState().max_date);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tvar minDurationInUnits = this._calculateMinDuration(cfg.min_duration, cfg.duration_unit);\n\t\t\tif (task.end_date - task.start_date < cfg.min_duration) {\n\t\t\t\tif (drag.left)\n\t\t\t\t\ttask.start_date = gantt.calculateEndDate(task.end_date, -minDurationInUnits, cfg.duration_unit, task);\n\t\t\t\telse\n\t\t\t\t\ttask.end_date = gantt.calculateEndDate(task.start_date, minDurationInUnits, cfg.duration_unit, task);\n\t\t\t}\n\t\t\tgantt._init_task_timing(task);\n\t\t},\n\t\t_calculateMinDuration: function(duration, unit) {\n\t\t\tvar inMs = {\n\t\t\t\t\"minute\": 60000,\n\t\t\t\t\"hour\": 3600000,\n\t\t\t\t\"day\": 86400000,\n\t\t\t\t\"week\": 604800000,\n\t\t\t\t\"month\": 2419200000,\n\t\t\t\t\"year\": 31356000000\n\t\t\t};\n\t\t\treturn Math.ceil(duration / inMs[unit]);\n\t\t},\n\t\t_resize_progress: function(task, shift, drag) {\n\t\t\tvar coords_x = this._drag_task_coords(task, drag);\n\n\t\t\tvar config = timeline.$getConfig();\n\t\t\tvar diffValue = !config.rtl ? (drag.pos.x - coords_x.start) : (coords_x.start - drag.pos.x);\n\n\t\t\tvar diff = Math.max(0, diffValue);\n\t\t\ttask.progress = Math.min(1, diff / Math.abs(coords_x.end - coords_x.start));\n\t\t},\n\t\t_find_max_shift: function(dragItems, shift) {\n\t\t\tvar correctShift;\n\t\t\tfor (var i in dragItems) {\n\t\t\t\tvar drag = dragItems[i];\n\t\t\t\tvar task = gantt.getTask(drag.id);\n\n\t\t\t\tvar coords_x = this._drag_task_coords(task, drag);\n\t\t\t\tvar minX = gantt.posFromDate(new Date(gantt.getState().min_date));\n\t\t\t\tvar maxX = gantt.posFromDate(new Date(gantt.getState().max_date));\n\n\t\t\t\tif (coords_x.end + shift > maxX) {\n\t\t\t\t\tvar maxShift = maxX - coords_x.end;\n\t\t\t\t\tif (maxShift < correctShift || correctShift === undefined) {\n\t\t\t\t\t\tcorrectShift = maxShift;\n\t\t\t\t\t}\n\t\t\t\t} else if (coords_x.start + shift < minX) {\n\t\t\t\t\tvar minShift = minX - coords_x.start;\n\t\t\t\t\tif (minShift > correctShift || correctShift === undefined) {\n\t\t\t\t\t\tcorrectShift = minShift;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn correctShift;\n\t\t},\n\t\t_move: function(task, shift, drag, multipleDragShift) {\n\t\t\tvar coords_x = this._drag_task_coords(task, drag);\n\t\t\tvar new_start = null,\n\t\t\tnew_end = null;\n\t\t\t// GS-454: If we drag multiple tasks, rely on the dates instead of timeline coordinates\n\t\t\tif (multipleDragShift){\n\t\t\t\tnew_start = new Date(+drag.obj.start_date + multipleDragShift),\n\t\t\t\tnew_end = new Date(+drag.obj.end_date + multipleDragShift);\n\t\t\t} else {\n\t\t\t\tnew_start = gantt.dateFromPos(coords_x.start + shift),\n\t\t\t\tnew_end = gantt.dateFromPos(coords_x.end + shift);\n\t\t\t}\n\t\t\tif (!new_start) {\n\t\t\t\ttask.start_date = new Date(gantt.getState().min_date);\n\t\t\t\ttask.end_date = gantt.dateFromPos(gantt.posFromDate(task.start_date) + (coords_x.end - coords_x.start));\n\t\t\t} else if (!new_end) {\n\t\t\t\ttask.end_date = new Date(gantt.getState().max_date);\n\t\t\t\ttask.start_date = gantt.dateFromPos(gantt.posFromDate(task.end_date) - (coords_x.end - coords_x.start));\n\t\t\t} else {\n\t\t\t\ttask.start_date = new_start;\n\t\t\t\ttask.end_date = new_end;\n\t\t\t}\n\t\t},\n\t\t_drag_task_coords: function(t, drag) {\n\t\t\tvar start = drag.obj_s_x = drag.obj_s_x || gantt.posFromDate(t.start_date);\n\t\t\tvar end = drag.obj_e_x = drag.obj_e_x || gantt.posFromDate(t.end_date);\n\t\t\treturn {\n\t\t\t\tstart: start,\n\t\t\t\tend: end\n\t\t\t};\n\t\t},\n\t\t_mouse_position_change: function(oldPos, newPos) {\n\t\t\tvar dx = oldPos.x - newPos.x,\n\t\t\t\tdy = oldPos.y - newPos.y;\n\t\t\treturn Math.sqrt(dx * dx + dy * dy);\n\t\t},\n\t\t_is_number: function(n) {\n\t\t\treturn !isNaN(parseFloat(n)) && isFinite(n);\n\t\t},\n\n\t\ton_mouse_move: function(e) {\n\t\t\tif (this.drag.start_drag) {\n\t\t\t\tvar pos = domHelpers.getRelativeEventPosition(e, gantt.$task_data);\n\n\t\t\t\tvar sX = this.drag.start_drag.start_x,\n\t\t\t\t\tsY = this.drag.start_drag.start_y;\n\n\t\t\t\tif ((Date.now() - this.drag.timestamp > 50) ||\n\t\t\t\t\t(this._is_number(sX) && this._is_number(sY) && this._mouse_position_change({\n\t\t\t\t\t\tx: sX,\n\t\t\t\t\t\ty: sY\n\t\t\t\t\t}, pos) > 20)) {\n\t\t\t\t\tthis._start_dnd(e);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tvar drag = this.drag;\n\n\t\t\tif (drag.mode) {\n\t\t\t\tif (!timeout(this, 40))//limit update frequency\n\t\t\t\t\treturn;\n\n\t\t\t\tthis._update_on_move(e);\n\n\t\t\t}\n\t\t},\n\n\t\t_update_item_on_move: function(shift, id, mode, drag, e, multipleDragShift) {\n\t\t\tvar task = gantt.getTask(id);\n\t\t\tvar original = gantt.mixin({}, task);\n\t\t\tvar copy = gantt.mixin({}, task);\n\t\t\tthis._handlers[mode].apply(this, [copy, shift, drag, multipleDragShift]);\n\t\t\tgantt.mixin(task, copy, true);\n\t\t\t//gantt._update_parents(drag.id, true);\n\t\t\tgantt.callEvent(\"onTaskDrag\", [task.id, mode, copy, original, e]);\n\t\t\tgantt.mixin(task, copy, true);\n\t\t\tgantt.refreshTask(id);\n\t\t},\n\n\t\t_update_on_move: function(e) {\n\t\t\tvar drag = this.drag;\n\t\t\tvar config = timeline.$getConfig();\n\t\t\tif (drag.mode) {\n\t\t\t\tvar pos = domHelpers.getRelativeEventPosition(e, timeline.$task_data);\n\t\t\t\tif (drag.pos && drag.pos.x == pos.x)\n\t\t\t\t\treturn;\n\n\t\t\t\tdrag.pos = pos;\n\n\t\t\t\tvar curr_date = gantt.dateFromPos(pos.x);\n\t\t\t\tif (!curr_date || isNaN(curr_date.getTime()))\n\t\t\t\t\treturn;\n\n\n\t\t\t\tvar shift = pos.x - drag.start_x;\n\t\t\t\tvar task = gantt.getTask(drag.id);\n\t\t\t\tif (this._handlers[drag.mode]) {\n\t\t\t\t\tif (drag.mode === config.drag_mode.move) {\n\t\t\t\t\t\tvar dragHash = {};\n\n\t\t\t\t\t\tif (this._isMultiselect()) {\n\t\t\t\t\t\t\tvar selectedTasksIds = gantt.getSelectedTasks();\n\t\t\t\t\t\t\tif (selectedTasksIds.indexOf(drag.id) >= 0) {\n\t\t\t\t\t\t\t\tdragHash = this.dragMultiple;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tvar dragProject = false;\n\t\t\t\t\t\tif (gantt.isSummaryTask(task) && gantt.config.drag_project) {\n\t\t\t\t\t\t\tvar initialDrag = {};\n\t\t\t\t\t\t\tinitialDrag[drag.id] = utils.copy(drag);\n\t\t\t\t\t\t\tdragProject = true;\n\t\t\t\t\t\t\tdragHash = utils.mixin(initialDrag, this.dragMultiple);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tvar maxShift = this._find_max_shift(dragHash, shift);\n\t\t\t\t\t\tif (maxShift !== undefined) {\n\t\t\t\t\t\t\tshift = maxShift;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tthis._update_item_on_move(shift, drag.id, drag.mode, drag, e);\n\n\t\t\t\t\t\tfor (var i in dragHash) {\n\t\t\t\t\t\t\tvar childDrag =  dragHash[i];\n\t\t\t\t\t\t\tif(dragProject && childDrag.id != drag.id){\n\t\t\t\t\t\t\t\tgantt._bulk_dnd = true;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t// GS-454: Calculate the date shift in milliseconds instead of pixels\n\t\t\t\t\t\t\tif (maxShift === undefined && (dragProject || Object.keys(dragHash).length > 1)) {\n\t\t\t\t\t\t\t\tvar shiftDate = gantt.dateFromPos(drag.start_x);\n\t\t\t\t\t\t\t\tvar multipleDragShift = curr_date - shiftDate;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tthis._update_item_on_move(shift, childDrag.id, childDrag.mode, childDrag, e, multipleDragShift);\n\t\t\t\t\t\t}\n\t\t\t\t\t\tgantt._bulk_dnd = false;\n\t\t\t\t\t} else {\n\t\t\t\t\t\t// for resize and progress\n\t\t\t\t\t\tthis._update_item_on_move(shift, drag.id, drag.mode, drag, e);\n\t\t\t\t\t}\n\t\t\t\t\tgantt._update_parents(drag.id);\n\t\t\t\t}\n\n\t\t\t}\n\t\t},\n\n\t\ton_mouse_down: function(e, src) {\n\t\t\t// on Mac we do not get onmouseup event when clicking right mouse button leaving us in dnd state\n\t\t\t// let's ignore right mouse button then\n\t\t\tif (e.button == 2 && e.button !== undefined)\n\t\t\t\treturn;\n\n\t\t\tvar config = timeline.$getConfig();\n\t\t\tvar id = gantt.locate(e);\n\t\t\tvar task = null;\n\t\t\tif (gantt.isTaskExists(id)) {\n\t\t\t\ttask = gantt.getTask(id);\n\t\t\t}\n\n\t\t\tif (gantt.isReadonly(task) || this.drag.mode) return;\n\n\t\t\tthis.clear_drag_state();\n\n\t\t\tsrc = src || (e.target || e.srcElement);\n\n\t\t\tvar className = domHelpers.getClassName(src);\n\t\t\tvar drag = this._get_drag_mode(className, src);\n\n\t\t\tif (!className || !drag) {\n\t\t\t\tif (src.parentNode)\n\t\t\t\t\treturn this.on_mouse_down(e, src.parentNode);\n\t\t\t\telse\n\t\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (!drag) {\n\t\t\t\tif (gantt.checkEvent(\"onMouseDown\") && gantt.callEvent(\"onMouseDown\", [className.split(\" \")[0]])) {\n\t\t\t\t\tif (src.parentNode)\n\t\t\t\t\t\treturn this.on_mouse_down(e, src.parentNode);\n\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tif (drag.mode && drag.mode != config.drag_mode.ignore && config[\"drag_\" + drag.mode]) {\n\t\t\t\t\tid = gantt.locate(src);\n\t\t\t\t\ttask = gantt.copy(gantt.getTask(id) || {});\n\n\t\t\t\t\tif (gantt.isReadonly(task)) {\n\t\t\t\t\t\tthis.clear_drag_state();\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\n\t\t\t\t\tif ((gantt.isSummaryTask(task) && !(task.auto_scheduling === false) && !config.drag_project) && drag.mode != config.drag_mode.progress) {//only progress drag is allowed for tasks with flexible duration\n\t\t\t\t\t\tthis.clear_drag_state();\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tdrag.id = id;\n\t\t\t\t\tvar pos = domHelpers.getRelativeEventPosition(e, gantt.$task_data);\n\n\t\t\t\t\tdrag.start_x = pos.x;\n\t\t\t\t\tdrag.start_y = pos.y;\n\t\t\t\t\tdrag.obj = task;\n\t\t\t\t\tthis.drag.start_drag = drag;\n\t\t\t\t\tthis.drag.timestamp = Date.now();\n\n\t\t\t\t} else\n\t\t\t\t\tthis.clear_drag_state();\n\t\t\t}\n\t\t},\n\t\t_fix_dnd_scale_time: function(task, drag) {\n\t\t\tvar config = timeline.$getConfig();\n\t\t\tvar unit = gantt.getScale().unit,\n\t\t\t\tstep = gantt.getScale().step;\n\t\t\tif (!config.round_dnd_dates) {\n\t\t\t\tunit = 'minute';\n\t\t\t\tstep = config.time_step;\n\t\t\t}\n\n\t\t\tfunction fixStart(task) {\n\t\t\t\tif (!gantt.config.correct_work_time)\n\t\t\t\t\treturn;\n\t\t\t\tvar config = timeline.$getConfig();\n\t\t\t\tif (!gantt.isWorkTime(task.start_date, undefined, task))\n\t\t\t\t\ttask.start_date = gantt.calculateEndDate({\n\t\t\t\t\t\tstart_date: task.start_date,\n\t\t\t\t\t\tduration: -1,\n\t\t\t\t\t\tunit: config.duration_unit,\n\t\t\t\t\t\ttask: task\n\t\t\t\t\t});\n\t\t\t}\n\n\t\t\tfunction fixEnd(task) {\n\t\t\t\tif (!gantt.config.correct_work_time)\n\t\t\t\t\treturn;\n\t\t\t\tvar config = timeline.$getConfig();\n\t\t\t\tif (!gantt.isWorkTime(new Date(task.end_date - 1), undefined, task))\n\t\t\t\t\ttask.end_date = gantt.calculateEndDate({\n\t\t\t\t\t\tstart_date: task.end_date,\n\t\t\t\t\t\tduration: 1,\n\t\t\t\t\t\tunit: config.duration_unit,\n\t\t\t\t\t\ttask: task\n\t\t\t\t\t});\n\t\t\t}\n\n\t\t\tif (drag.mode == config.drag_mode.resize) {\n\t\t\t\tif (drag.left) {\n\t\t\t\t\ttask.start_date = gantt.roundDate({date: task.start_date, unit: unit, step: step});\n\t\t\t\t\tfixStart(task);\n\t\t\t\t} else {\n\t\t\t\t\ttask.end_date = gantt.roundDate({date: task.end_date, unit: unit, step: step});\n\t\t\t\t\tfixEnd(task);\n\t\t\t\t}\n\t\t\t} else if (drag.mode == config.drag_mode.move) {\n\t\t\t\ttask.start_date = gantt.roundDate({date: task.start_date, unit: unit, step: step});\n\t\t\t\tfixStart(task);\n\t\t\t\ttask.end_date = gantt.calculateEndDate(task);\n\t\t\t}\n\t\t},\n\t\t_fix_working_times: function(task, drag) {\n\t\t\tvar config = timeline.$getConfig();\n\t\t\tvar drag = drag || {mode: config.drag_mode.move};\n\n\t\t\tif (drag.mode == config.drag_mode.resize) {\n\t\t\t\tif (drag.left) {\n\t\t\t\t\ttask.start_date = gantt.getClosestWorkTime({date: task.start_date, dir: 'future', task: task});\n\t\t\t\t} else {\n\t\t\t\t\ttask.end_date = gantt.getClosestWorkTime({date: task.end_date, dir: 'past', task: task});\n\t\t\t\t}\n\t\t\t} else if (drag.mode == config.drag_mode.move) {\n\t\t\t\tgantt.correctTaskWorkTime(task);\n\t\t\t}\n\t\t},\n\n\t\t_finalize_mouse_up: function(taskId, config, drag, e) {\n\t\t\tvar task = gantt.getTask(taskId);\n\n\t\t\tif (config.work_time && config.correct_work_time) {\n\t\t\t\tthis._fix_working_times(task, drag);\n\t\t\t}\n\n\t\t\tthis._fix_dnd_scale_time(task, drag);\n\n\t\t\tif (!this._fireEvent(\"before_finish\", drag.mode, [taskId, drag.mode, gantt.copy(drag.obj), e])) {\n\t\t\t\t//drag.obj._dhx_changed = false;\n\t\t\t\tthis.clear_drag_state();\n\t\t\t\tif (taskId == drag.id) {\n\t\t\t\t\tdrag.obj._dhx_changed = false;\n\t\t\t\t\tgantt.mixin(task, drag.obj, true);\n\t\t\t\t}\n\n\n\t\t\t\tgantt.refreshTask(task.id);\n\t\t\t} else {\n\t\t\t\tvar drag_id = taskId;\n\n\t\t\t\tgantt._init_task_timing(task);\n\n\t\t\t\tthis.clear_drag_state();\n\t\t\t\tgantt.updateTask(task.id);\n\t\t\t\tthis._fireEvent(\"after_finish\", drag.mode, [drag_id, drag.mode, e]);\n\t\t\t}\n\n\t\t},\n\n\t\ton_mouse_up: function(e) {\n\n\t\t\tvar drag = this.drag;\n\t\t\tif (drag.mode && drag.id) {\n\t\t\t\tvar config = timeline.$getConfig();\n\t\t\t\t//drop\n\t\t\t\tvar task = gantt.getTask(drag.id);\n\t\t\t\tvar dragMultiple = this.dragMultiple;\n\n\t\t\t\tvar finalizingBulkMove = false;\n\t\t\t\tvar moveCount = 0;\n\t\t\t\tif (drag.mode === config.drag_mode.move) {\n\t\t\t\t\tif ((gantt.isSummaryTask(task) && config.drag_project) || (this._isMultiselect())) {\n\t\t\t\t\t\tfinalizingBulkMove = true;\n\t\t\t\t\t\tmoveCount = Object.keys(dragMultiple).length;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tvar doFinalize = function doFinalize(){\n\t\t\t\t\tif(finalizingBulkMove){\n\t\t\t\t\t\tfor (var i in dragMultiple) {\n\t\t\t\t\t\t\t// GS-1057: Don't call drag events for the dragged task as they will be called later\n\t\t\t\t\t\t\tif (dragMultiple[i].id != drag.id){\n\t\t\t\t\t\t\t\tthis._finalize_mouse_up(dragMultiple[i].id, config, dragMultiple[i], e);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tthis._finalize_mouse_up(drag.id, config, drag, e);\n\n\t\t\t\t};\n\n\t\t\t\tif(finalizingBulkMove && moveCount > 10){// 10 - arbitrary threshold for bulk dnd at which we start doing complete repaint to refresh\n\t\t\t\t\tgantt.batchUpdate(function(){\n\t\t\t\t\t\tdoFinalize.call(this);\n\t\t\t\t\t}.bind(this));\n\t\t\t\t}else{\n\t\t\t\t\tdoFinalize.call(this);\n\t\t\t\t}\n\n\t\t\t}\n\t\t\tthis.clear_drag_state();\n\t\t},\n\t\t_get_drag_mode: function(className, el) {\n\t\t\tvar config = timeline.$getConfig();\n\t\t\tvar modes = config.drag_mode;\n\t\t\tvar classes = (className || \"\").split(\" \");\n\t\t\tvar classname = classes[0];\n\t\t\tvar drag = {mode: null, left: null};\n\t\t\tswitch (classname) {\n\t\t\t\tcase \"gantt_task_line\":\n\t\t\t\tcase \"gantt_task_content\":\n\t\t\t\t\tdrag.mode = modes.move;\n\t\t\t\t\tbreak;\n\t\t\t\tcase \"gantt_task_drag\":\n\t\t\t\t\tdrag.mode = modes.resize;\n\n\t\t\t\t\tvar dragProperty = el.getAttribute(\"data-bind-property\");\n\n\t\t\t\t\tif (dragProperty == \"start_date\") {\n\t\t\t\t\t\tdrag.left = true;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tdrag.left = false;\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\t\t\t\tcase \"gantt_task_progress_drag\":\n\t\t\t\t\tdrag.mode = modes.progress;\n\t\t\t\t\tbreak;\n\t\t\t\tcase \"gantt_link_control\":\n\t\t\t\tcase \"gantt_link_point\":\n\t\t\t\t\tdrag.mode = modes.ignore;\n\t\t\t\t\tbreak;\n\t\t\t\tdefault:\n\t\t\t\t\tdrag = null;\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t\treturn drag;\n\n\t\t},\n\n\t\t_start_dnd: function(e) {\n\t\t\tvar drag = this.drag = this.drag.start_drag;\n\t\t\tdelete drag.start_drag;\n\n\t\t\tvar cfg = timeline.$getConfig();\n\t\t\tvar id = drag.id;\n\n\t\t\tif (!cfg[\"drag_\" + drag.mode] || !gantt.callEvent(\"onBeforeDrag\", [id, drag.mode, e]) || !this._fireEvent(\"before_start\", drag.mode, [id, drag.mode, e])) {\n\t\t\t\tthis.clear_drag_state();\n\t\t\t} else {\n\t\t\t\tdelete drag.start_drag;\n\t\t\t\tvar task = gantt.getTask(id);\n\t\t\t\tif (gantt.isReadonly(task)){\n\t\t\t\t\tthis.clear_drag_state();\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tif (this._isMultiselect()) {\n\t\t\t\t\t// for don't move selected tasks when drag unselected task\n\t\t\t\t\tvar selectedTasksIds = gantt.getSelectedTasks();\n\t\t\t\t\tif (selectedTasksIds.indexOf(drag.id) >= 0) {\n\t\t\t\t\t\thelpers.forEach(selectedTasksIds, gantt.bind(function(taskId) {\n\t\t\t\t\t\t\tvar selectedTask = gantt.getTask(taskId);\n\t\t\t\t\t\t\tif (gantt.isSummaryTask(selectedTask) && gantt.config.drag_project && drag.mode == cfg.drag_mode.move) {\n\t\t\t\t\t\t\t\tthis._addSubtasksToDragMultiple(selectedTask.id);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tthis.dragMultiple[taskId] = gantt.mixin({\n\t\t\t\t\t\t\t\tid: selectedTask.id,\n\t\t\t\t\t\t\t\tobj: gantt.copy(selectedTask)\n\t\t\t\t\t\t\t}, this.drag);\n\t\t\t\t\t\t}, this));\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\t// for move unselected summary\n\t\t\t\tif (gantt.isSummaryTask(task) && gantt.config.drag_project && drag.mode == cfg.drag_mode.move) {\n\t\t\t\t\tthis._addSubtasksToDragMultiple(task.id);\n\t\t\t\t}\n\t\t\t\tgantt.callEvent(\"onTaskDragStart\", []);\n\t\t\t}\n\n\t\t},\n\t\t_fireEvent: function(stage, mode, params) {\n\t\t\tgantt.assert(this._events[stage], \"Invalid stage:{\" + stage + \"}\");\n\n\t\t\tvar trigger = this._events[stage][mode];\n\n\t\t\tgantt.assert(trigger, \"Unknown after drop mode:{\" + mode + \"}\");\n\t\t\tgantt.assert(params, \"Invalid event arguments\");\n\n\n\t\t\tif (!gantt.checkEvent(trigger))\n\t\t\t\treturn true;\n\n\t\t\treturn gantt.callEvent(trigger, params);\n\t\t},\n\n\t\tround_task_dates: function(task) {\n\t\t\tvar drag_state = this.drag;\n\t\t\tvar config = timeline.$getConfig();\n\t\t\tif (!drag_state) {\n\t\t\t\tdrag_state = {mode: config.drag_mode.move};\n\t\t\t}\n\t\t\tthis._fix_dnd_scale_time(task, drag_state);\n\t\t},\n\t\tdestructor: function() {\n\t\t\tthis._domEvents.detachAll();\n\t\t},\n\t\t_isMultiselect: function() {\n\t\t\treturn gantt.config.drag_multiple && !!(gantt.getSelectedTasks && gantt.getSelectedTasks().length > 0);\n\t\t},\n\t\t_addSubtasksToDragMultiple: function(summaryId) {\n\t\t\tgantt.eachTask(function(child) {\n\t\t\t\tthis.dragMultiple[child.id] = gantt.mixin({\n\t\t\t\t\tid: child.id,\n\t\t\t\t\tobj: gantt.copy(child)\n\t\t\t\t}, this.drag);\n\t\t\t}, summaryId, this);\n\t\t}\n\t};\n}\n\nfunction initTaskDND() {\n\tvar _tasks_dnd;\n\treturn {\n\t\textend: function(timeline) {\n\t\t\ttimeline.roundTaskDates = function(task) {\n\t\t\t\t_tasks_dnd.round_task_dates(task);\n\t\t\t};\n\n\t\t},\n\t\tinit: function(timeline, gantt) {\n\t\t\t_tasks_dnd = createTaskDND(timeline, gantt);\n\t\t\t// TODO: entry point for touch handlers, move touch to timeline\n\t\t\ttimeline._tasks_dnd = _tasks_dnd;\n\t\t\treturn _tasks_dnd.init(gantt);\n\t\t},\n\t\tdestructor: function() {\n\t\t\tif (_tasks_dnd) {\n\t\t\t\t_tasks_dnd.destructor();\n\t\t\t\t_tasks_dnd = null;\n\t\t\t}\n\t\t}\n\t};\n}\n\nexport default {\n\tcreateTaskDND: initTaskDND\n};","import * as domHelpers from \"../utils/dom_helpers\";\n\nvar initLinksDND = function(timeline, gantt) {\n\tvar _link_landing,\n\t\t_link_target_task,\n\t\t_link_target_task_start,\n\t\t_link_source_task,\n\t\t_link_source_task_start,\n\t\tmarkerDefaultOffset = 10,\n\t\tscrollDefaultSize = 18;\n\n\tfunction getDndState(){\n\t\treturn {\n\t\t\tlink_source_id : _link_source_task,\n\t\t\tlink_target_id : _link_target_task,\n\t\t\tlink_from_start : _link_source_task_start,\n\t\t\tlink_to_start : _link_target_task_start,\n\t\t\tlink_landing_area : _link_landing\n\t\t};\n\t}\n\n\tvar services = gantt.$services;\n\n\tvar state = services.getService(\"state\");\n\tvar DnD = services.getService(\"dnd\");\n\n\tstate.registerProvider(\"linksDnD\", getDndState);\n\n\tvar start_marker = \"task_start_date\",\n\t\tend_marker = \"task_end_date\",\n\t\tlink_edge_marker = \"gantt_link_point\",\n\t\tlink_landing_hover_area = \"gantt_link_control\";\n\n\tvar dnd = new DnD(timeline.$task_bars, {\n\t\tsensitivity : 0,\n\t\tupdates_per_second : 60,\n\t\tmousemoveContainer: gantt.$root,\n\t\tselector: \".\" + link_edge_marker,\n\t\tpreventDefault: true\n\t});\n\n\tdnd.attachEvent(\"onBeforeDragStart\", gantt.bind(function(obj,e) {\n\t\tvar target = (e.target||e.srcElement);\n\t\tresetDndState();\n\t\tif(gantt.getState(\"tasksDnd\").drag_id)\n\t\t\treturn false;\n\n\t\tif(domHelpers.locateClassName(target, link_edge_marker)){\n\t\t\tif(domHelpers.locateClassName(target, start_marker))\n\t\t\t\t_link_source_task_start = true;\n\n\t\t\tvar sid = gantt.locate(e);\n\t\t\t_link_source_task = sid;\n\n\t\t\tvar t = gantt.getTask(sid);\n\t\t\tif(gantt.isReadonly(t)){\n\t\t\t\tresetDndState();\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tthis._dir_start = {\n\t\t\t\tx: dnd.config.original_element_sizes.x + dnd.config.original_element_sizes.width/2,\n\t\t\t\ty: dnd.config.original_element_sizes.y + dnd.config.original_element_sizes.height/2\n\t\t\t};\n\n\t\t\treturn true;\n\t\t}else{\n\t\t\treturn false;\n\t\t}\n\n\t}, this));\n\n\tdnd.attachEvent(\"onAfterDragStart\", gantt.bind(function(obj,e) {\n\t\tif(gantt.config.touch) {\n\t\t\tgantt.refreshData();\n\t\t}\n\t\tupdateMarkedHtml(dnd.config.marker);\n\t}, this));\n\n\tfunction getVieportSize(){\n\t\tvar root = gantt.$root;\n\t\treturn { right: root.offsetWidth, bottom: root.offsetHeight };\n\t}\n\tfunction getMarkerSize (marker){\n\t\tvar width = 0, height = 0;\n\t\tif(marker){\n\t\t\twidth = marker.offsetWidth || 0;\n\t\t\theight = marker.offsetHeight || 0;\n\t\t}\n\t\treturn { width: width, height: height };\n\t}\n\n\tfunction getPosition(e, marker){\n\t\tvar oldPos = dnd.getPosition(e);\n\n\t\tvar markerSize = getMarkerSize(marker);\n\t\tvar viewportSize = getVieportSize();\n\n\t\tvar offsetX = gantt.config.tooltip_offset_x || markerDefaultOffset;\n\t\tvar offsetY = gantt.config.tooltip_offset_y || markerDefaultOffset;\n\n\t\tvar scrollSize = gantt.config.scroll_size || scrollDefaultSize;\n\n\t\t// GS-1315: Add offset if there are elements above Gantt\n\t\tvar ganttOffsetY = gantt.$container.getBoundingClientRect().y + window.scrollY;\n\n\t\tvar position = {\n\t\t\ty: oldPos.y + offsetY,\n\t\t\tx: oldPos.x + offsetX,\n\t\t\tbottom: oldPos.y + markerSize.height + offsetY + scrollSize,\n\t\t\tright: oldPos.x + markerSize.width + offsetX + scrollSize\n\t\t};\n\n\t\tif(position.bottom > viewportSize.bottom + ganttOffsetY){\n\t\t\tposition.y = viewportSize.bottom + ganttOffsetY - markerSize.height - offsetY;\n\t\t}\n\n\t\tif(position.right > viewportSize.right){\n\t\t\tposition.x = viewportSize.right - markerSize.width - offsetX;\n\t\t}\n\t\treturn position;\n\t}\n\n\tdnd.attachEvent(\"onDragMove\", gantt.bind(function(obj,e) {\n\t\tvar dd = dnd.config;\n\t\tvar pos = getPosition(e, dd.marker);\n\t\tadvanceMarker(dd.marker, pos);\n\t\tvar landing = !!domHelpers.locateClassName(e, link_landing_hover_area);\n\n\t\tvar prevTarget = _link_target_task;\n\t\tvar prevLanding = _link_landing;\n\t\tvar prevToStart = _link_target_task_start;\n\n\t\tvar targ = gantt.locate(e),\n\t\t\tto_start = true;\n\n\t\t// can drag and drop link to another gantt on the page, such links are not supported\n\t\tvar eventTarget = domHelpers.getTargetNode(e);\n\n\t\tvar sameGantt = domHelpers.isChildOf(eventTarget, gantt.$root);\n\t\tif(!sameGantt){\n\t\t\tlanding = false;\n\t\t\ttarg = null;\n\t\t}\n\n\t\tif(landing){\n\t\t\t//refreshTask\n\t\t\tto_start = !domHelpers.locateClassName(e, end_marker);\n\t\t\tlanding = !!targ;\n\t\t}\n\n\t\t_link_target_task = targ;\n\t\t_link_landing = landing;\n\t\t_link_target_task_start = to_start;\n\n\t\tif(landing){\n\n\t\t\tvar node = domHelpers.locateClassName(e, link_landing_hover_area);\n\t\t\n\t\t\tconst point = node.querySelector(`.${link_edge_marker}`);\n\t\t\tif(point){\n\t\t\t\tconst absCoords = domHelpers.getRelativeNodePosition(point, timeline.$task_bg);\n\t\t\t\tthis._dir_end = {\n\t\t\t\t\tx: absCoords.x + point.offsetWidth/2,\n\t\t\t\t\ty: absCoords.y + point.offsetHeight/2\n\t\t\t\t};\n\t\t\t}\n\n\t\t}else{\n\t\t\tthis._dir_end = domHelpers.getRelativeEventPosition(e, timeline.$task_data);\n\t\t\tif(gantt.env.isEdge){ // to fix margin collapsing\n\t\t\t\tthis._dir_end.y += window.scrollY;\n\t\t\t}\n\t\t}\n\n\t\tvar targetChanged = !(prevLanding == landing && prevTarget == targ && prevToStart == to_start);\n\t\tif(targetChanged){\n\t\t\tif(prevTarget)\n\t\t\t\tgantt.refreshTask(prevTarget, false);\n\t\t\tif(targ)\n\t\t\t\tgantt.refreshTask(targ, false);\n\t\t}\n\n\t\tif(targetChanged){\n\t\t\tupdateMarkedHtml(dd.marker);\n\t\t}\n\n\t\tshowDirectingLine(this._dir_start.x, this._dir_start.y, this._dir_end.x, this._dir_end.y);\n\n\t\treturn true;\n\t}, this));\n\n\n\tdnd.attachEvent(\"onDragEnd\", gantt.bind(function() {\n\t\tvar drag = getDndState();\n\n\t\tif(drag.link_source_id && drag.link_target_id && drag.link_source_id != drag.link_target_id){\n\t\t\tvar type = gantt._get_link_type(drag.link_from_start, drag.link_to_start);\n\n\t\t\tvar link = {source : drag.link_source_id, target: drag.link_target_id, type:type};\n\t\t\tif(link.type && gantt.isLinkAllowed(link)) {\n\t\t\t\tif(gantt.callEvent(\"onLinkCreated\", [link])){\n\t\t\t\t\tgantt.addLink(link);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tresetDndState();\n\n\t\tif(gantt.config.touch) {\n\t\t\tgantt.refreshData();\n\t\t}\n\t\telse {\n\t\t\tif (drag.link_source_id)\n\t\t\t\tgantt.refreshTask(drag.link_source_id, false);\n\t\t\tif (drag.link_target_id)\n\t\t\t\tgantt.refreshTask(drag.link_target_id, false);\n\t\t}\n\t\tremoveDirectionLine();\n\t}, this));\n\n\tfunction updateMarkedHtml(marker){\n\t\tvar link = getDndState();\n\n\t\tvar css = [\"gantt_link_tooltip\"];\n\t\tif(link.link_source_id && link.link_target_id){\n\t\t\tif(gantt.isLinkAllowed(link.link_source_id, link.link_target_id, link.link_from_start, link.link_to_start)){\n\t\t\t\tcss.push(\"gantt_allowed_link\");\n\t\t\t}else{\n\t\t\t\tcss.push(\"gantt_invalid_link\");\n\t\t\t}\n\t\t}\n\n\t\tvar className = gantt.templates.drag_link_class(link.link_source_id, link.link_from_start, link.link_target_id, link.link_to_start);\n\t\tif(className)\n\t\t\tcss.push(className);\n\n\t\tvar html = \"<div class='\"+className+ \"'>\" +\n\t\t\tgantt.templates.drag_link(link.link_source_id, link.link_from_start, link.link_target_id, link.link_to_start) +\n\t\t\t\"</div>\";\n\t\tmarker.innerHTML = html;\n\t}\n\n\tfunction advanceMarker(marker, pos){\n\t\tmarker.style.left = pos.x + \"px\";\n\t\tmarker.style.top = pos.y + \"px\";\n\t}\n\n\tfunction resetDndState(){\n\t\t_link_source_task =\n\t\t\t_link_source_task_start =\n\t\t\t\t_link_target_task = null;\n\t\t_link_target_task_start = true;\n\t}\n\tfunction showDirectingLine(s_x, s_y, e_x, e_y){\n\t\tvar div = getDirectionLine();\n\n\t\tvar link = getDndState();\n\n\t\tvar css = [\"gantt_link_direction\"];\n\t\tif(gantt.templates.link_direction_class){\n\t\t\tcss.push(gantt.templates.link_direction_class(link.link_source_id, link.link_from_start, link.link_target_id, link.link_to_start));\n\t\t}\n\n\t\tvar dist =Math.sqrt( (Math.pow(e_x - s_x, 2)) + (Math.pow(e_y - s_y, 2)) );\n\t\tdist = Math.max(0, dist - 3);\n\t\tif(!dist)\n\t\t\treturn;\n\n\t\tdiv.className = css.join(\" \");\n\t\tvar tan = (e_y - s_y)/(e_x - s_x),\n\t\t\tangle = Math.atan(tan);\n\n\t\tif(coordinateCircleQuarter(s_x, e_x, s_y, e_y) == 2){\n\t\t\tangle += Math.PI;\n\t\t}else if(coordinateCircleQuarter(s_x, e_x, s_y, e_y) == 3){\n\t\t\tangle -= Math.PI;\n\t\t}\n\n\n\n\t\tvar sin = Math.sin(angle),\n\t\t\tcos = Math.cos(angle),\n\t\t\ttop = Math.round(s_y),\n\t\t\tleft = Math.round(s_x);\n\n\n\t\tvar style = [\n\t\t\t\"-webkit-transform: rotate(\"+angle+\"rad)\",\n\t\t\t\"-moz-transform: rotate(\"+angle+\"rad)\",\n\t\t\t\"-ms-transform: rotate(\"+angle+\"rad)\",\n\t\t\t\"-o-transform: rotate(\"+angle+\"rad)\",\n\t\t\t\"transform: rotate(\"+angle+\"rad)\",\n\t\t\t\"width:\" + Math.round(dist) + \"px\"\n\t\t];\n\n\t\tif(window.navigator.userAgent.indexOf(\"MSIE 8.0\") != -1){\n\t\t\t//ms-filter breaks styles in ie9, so add it only for 8th\n\t\t\tstyle.push(\"-ms-filter: \\\"\" + ieTransform(sin, cos) + \"\\\"\");\n\n\t\t\tvar shiftLeft = Math.abs(Math.round(s_x - e_x)),\n\t\t\t\tshiftTop = Math.abs(Math.round(e_y - s_y));\n\t\t\t//fix rotation axis\n\t\t\tswitch(coordinateCircleQuarter(s_x, e_x, s_y, e_y)){\n\t\t\t\tcase 1:\n\t\t\t\t\ttop -= shiftTop;\n\t\t\t\t\tbreak;\n\t\t\t\tcase 2:\n\t\t\t\t\tleft -= shiftLeft;\n\t\t\t\t\ttop -= shiftTop;\n\t\t\t\t\tbreak;\n\t\t\t\tcase 3:\n\t\t\t\t\tleft -= shiftLeft;\n\t\t\t\t\tbreak;\n\t\t\t\tdefault:\n\t\t\t\t\tbreak;\n\t\t\t}\n\n\t\t}\n\n\t\tstyle.push(\"top:\" +  top + \"px\");\n\t\tstyle.push(\"left:\" +  left + \"px\");\n\n\t\tdiv.style.cssText = style.join(\";\");\n\t}\n\n\tfunction ieTransform(sin, cos){\n\t\treturn \"progid:DXImageTransform.Microsoft.Matrix(\"+\n\t\t\t\"M11 = \"+cos+\",\"+\n\t\t\t\"M12 = -\"+sin+\",\"+\n\t\t\t\"M21 = \"+sin+\",\"+\n\t\t\t\"M22 = \"+cos+\",\"+\n\t\t\t\"SizingMethod = 'auto expand'\"+\n\t\t\")\";\n\t}\n\tfunction coordinateCircleQuarter(sX, eX, sY, eY){\n\t\tif(eX >= sX){\n\t\t\tif(eY <= sY){\n\t\t\t\treturn 1;\n\t\t\t}else{\n\t\t\t\treturn 4;\n\t\t\t}\n\t\t}else{\n\t\t\tif(eY <= sY){\n\t\t\t\treturn 2;\n\t\t\t}else{\n\t\t\t\treturn 3;\n\t\t\t}\n\t\t}\n\n\t}\n\tfunction getDirectionLine(){\n\t\tif(!dnd._direction || !dnd._direction.parentNode){\n\t\t\tdnd._direction = document.createElement(\"div\");\n\t\t\ttimeline.$task_links.appendChild(dnd._direction);\n\t\t}\n\t\treturn dnd._direction;\n\t}\n\tfunction removeDirectionLine(){\n\t\tif(dnd._direction){\n\t\t\tif (dnd._direction.parentNode)\t//the event line can be detached because of data refresh\n\t\t\t\tdnd._direction.parentNode.removeChild(dnd._direction);\n\n\t\t\tdnd._direction = null;\n\t\t}\n\t}\n\tgantt.attachEvent(\"onGanttRender\", gantt.bind(function() {\n\t\tif(dnd._direction){\n\t\t\tshowDirectingLine(this._dir_start.x, this._dir_start.y, this._dir_end.x, this._dir_end.y);\n\t\t}\n\t}, this));\n};\n\nexport default {\n\tcreateLinkDND: function(){\n\t\treturn {\n\t\t\tinit: initLinksDND\n\t\t};\n\t}\n};","import * as utils from \"../../../utils/utils\";\nimport taskDnD from \"./tasks_dnd\";\nimport linkDnD from \"./links_dnd\";\nimport * as domHelpers from \"../utils/dom_helpers\";\nimport MouseDelegates from \"../mouse_event_container\";\n\nvar initializer = (function(){\n\treturn function(gantt){\n\t\tvar services = gantt.$services;\n\t\treturn {\n\t\t\tonCreated: function (timeline) {\n\t\t\t\tvar config = timeline.$config;\n\t\t\t\tconfig.bind = utils.defined(config.bind) ? config.bind : \"task\";\n\t\t\t\tconfig.bindLinks = utils.defined(config.bindLinks) ? config.bindLinks : \"link\";\n\n\t\t\t\ttimeline._linksDnD = linkDnD.createLinkDND();\n\t\t\t\ttimeline._tasksDnD = taskDnD.createTaskDND();\n\t\t\t\ttimeline._tasksDnD.extend(timeline);\n\n\t\t\t\tthis._mouseDelegates = MouseDelegates(gantt);\n\t\t\t},\n\t\t\tonInitialized: function (timeline) {\n\t\t\t\tthis._attachDomEvents(gantt);\n\n\t\t\t\tthis._attachStateProvider(gantt, timeline);\n\n\t\t\t\ttimeline._tasksDnD.init(timeline, gantt);\n\t\t\t\ttimeline._linksDnD.init(timeline, gantt);\n\n\t\t\t\tif(timeline.$config.id == \"timeline\"){\n\t\t\t\t\tthis.extendDom(timeline);\n\t\t\t\t}\n\n\t\t\t},\n\t\t\tonDestroyed: function (timeline) {\n\t\t\t\tthis._clearDomEvents(gantt);\n\t\t\t\tthis._clearStateProvider(gantt);\n\t\t\t\tif (timeline._tasksDnD) {\n\t\t\t\t\ttimeline._tasksDnD.destructor();\n\t\t\t\t}\n\t\t\t},\n\t\t\textendDom: function(timeline){\n\t\t\t\tgantt.$task = timeline.$task;\n\t\t\t\tgantt.$task_scale = timeline.$task_scale;\n\t\t\t\tgantt.$task_data = timeline.$task_data;\n\t\t\t\tgantt.$task_bg = timeline.$task_bg;\n\t\t\t\tgantt.$task_links = timeline.$task_links;\n\t\t\t\tgantt.$task_bars = timeline.$task_bars;\n\t\t\t},\n\n\t\t\t_clearDomEvents: function(){\n\t\t\t\tthis._mouseDelegates.destructor();\n\t\t\t\tthis._mouseDelegates = null;\n\t\t\t},\n\n\t\t\t_attachDomEvents: function(gantt){\n\t\t\t\tfunction _delete_link_handler(id, e) {\n\t\t\t\t\tif (id && this.callEvent(\"onLinkDblClick\", [id, e])) {\n\n\t\t\t\t\t\tvar link = this.getLink(id);\n\t\t\t\t\t\tif (this.isReadonly(link)) return;\n\n\t\t\t\t\t\tvar title = \"\";\n\t\t\t\t\t\tvar question = this.locale.labels.link + \" \" + this.templates.link_description(this.getLink(id)) + \" \" + this.locale.labels.confirm_link_deleting;\n\n\t\t\t\t\t\twindow.setTimeout(function () {\n\t\t\t\t\t\t\tgantt._simple_confirm(question, title, function () {\n\t\t\t\t\t\t\t\tgantt.deleteLink(id);\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}, (this.config.touch ? 300 : 1));\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tthis._mouseDelegates.delegate(\"click\", \"gantt_task_link\", gantt.bind(function (e, trg) {\n\t\t\t\t\tvar id = this.locate(e, this.config.link_attribute);\n\t\t\t\t\tif (id) {\n\t\t\t\t\t\tthis.callEvent(\"onLinkClick\", [id, e]);\n\t\t\t\t\t}\n\t\t\t\t}, gantt), this.$task);\n\n\t\t\t\tthis._mouseDelegates.delegate(\"click\", \"gantt_scale_cell\", gantt.bind(function (e, trg) {\n\t\t\t\t\tvar pos = domHelpers.getRelativeEventPosition(e, gantt.$task_data);\n\t\t\t\t\tvar date = gantt.dateFromPos(pos.x);\n\t\t\t\t\tvar coll = Math.floor(gantt.columnIndexByDate(date));\n\n\t\t\t\t\tvar coll_date = gantt.getScale().trace_x[coll];\n\n\t\t\t\t\tgantt.callEvent(\"onScaleClick\", [e, coll_date]);\n\t\t\t\t}, gantt), this.$task);\n\n\t\t\t\tthis._mouseDelegates.delegate(\"doubleclick\", \"gantt_task_link\", gantt.bind(function (e, id, trg) {\n\t\t\t\t\tvar id = this.locate(e, gantt.config.link_attribute);\n\t\t\t\t\t_delete_link_handler.call(this, id, e);\n\t\t\t\t}, gantt), this.$task);\n\n\t\t\t\tthis._mouseDelegates.delegate(\"doubleclick\", \"gantt_link_point\", gantt.bind(function (e, id, trg) {\n\t\t\t\t\tvar id = this.locate(e),\n\t\t\t\t\t\ttask = this.getTask(id);\n\n\t\t\t\t\tvar link = null;\n\t\t\t\t\tif (trg.parentNode && domHelpers.getClassName(trg.parentNode)) {\n\t\t\t\t\t\tif (domHelpers.getClassName(trg.parentNode).indexOf(\"_left\") > -1) {\n\t\t\t\t\t\t\tlink = task.$target[0];\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tlink = task.$source[0];\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tif (link)\n\t\t\t\t\t\t_delete_link_handler.call(this, link, e);\n\t\t\t\t\treturn false;\n\t\t\t\t}, gantt), this.$task);\n\t\t\t},\n\n\t\t\t_attachStateProvider: function(gantt, timeline){\n\t\t\t\tvar self = timeline;\n\t\t\t\tvar state = services.getService(\"state\");\n\t\t\t\tstate.registerProvider(\"tasksTimeline\", function(){\n\t\t\t\t\treturn {\n\t\t\t\t\t\tscale_unit: self._tasks ? self._tasks.unit : undefined,\n\t\t\t\t\t\tscale_step:  self._tasks ? self._tasks.step  : undefined\n\t\t\t\t\t};\n\t\t\t\t});\n\t\t\t},\n\n\t\t\t_clearStateProvider: function(){\n\t\t\t\tvar state = services.getService(\"state\");\n\t\t\t\tstate.unregisterProvider(\"tasksTimeline\");\n\t\t\t}\n\t\t};\n\t};\n\n})();\n\nexport default initializer;","import * as domHelpers from \"./utils/dom_helpers\";\n\nvar initializer = (function() {\n\treturn function (gantt) {\n\t\treturn {\n\n\t\t\tgetVerticalScrollbar: function(){\n\t\t\t\treturn gantt.$ui.getView(\"scrollVer\");\n\t\t\t},\n\t\t\tgetHorizontalScrollbar: function(){\n\t\t\t\treturn gantt.$ui.getView(\"scrollHor\");\n\t\t\t},\n\n\t\t\t_legacyGridResizerClass: function(layout){\n\t\t\t\tvar resizers = layout.getCellsByType(\"resizer\");\n\t\t\t\tfor(var i = 0; i < resizers.length; i++){\n\t\t\t\t\tvar r = resizers[i];\n\t\t\t\t\tvar gridResizer = false;\n\n\t\t\t\t\tvar prev = r.$parent.getPrevSibling(r.$id);\n\t\t\t\t\tif(prev && prev.$config && prev.$config.id === \"grid\"){\n\t\t\t\t\t\tgridResizer= true;\n\t\t\t\t\t}else{\n\t\t\t\t\t\tvar next = r.$parent.getNextSibling(r.$id);\n\t\t\t\t\t\tif(next && next.$config && next.$config.id === \"grid\"){\n\t\t\t\t\t\t\tgridResizer= true;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tif(gridResizer){\n\t\t\t\t\t\tr.$config.css = (r.$config.css ? r.$config.css + \" \" : \"\") + \"gantt_grid_resize_wrap\";\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t},\n\n\t\t\tonCreated: function(layout) {\n\t\t\t\tvar first = true;\n\n\t\t\t\tthis._legacyGridResizerClass(layout);\n\n\t\t\t\tlayout.attachEvent(\"onBeforeResize\", function() {\n\t\t\t\t\tvar mainTimeline = gantt.$ui.getView(\"timeline\");\n\t\t\t\t\tif (mainTimeline)\n\t\t\t\t\t\tmainTimeline.$config.hidden = mainTimeline.$parent.$config.hidden = !gantt.config.show_chart;\n\n\t\t\t\t\tvar mainGrid = gantt.$ui.getView(\"grid\");\n\n\t\t\t\t\tif(!mainGrid)\n\t\t\t\t\t\treturn;\n\n\t\t\t\t\tvar colsWidth = mainGrid._getColsTotalWidth();\n\t\t\t\t\tvar hideGrid = !gantt.config.show_grid || !gantt.config.grid_width || colsWidth === 0;\n\t\t\t\t\tif (first && !hideGrid && colsWidth !== false){\n\t\t\t\t\t\t\tgantt.config.grid_width = colsWidth;\n\t\t\t\t\t}\n\t\t\t\t\tmainGrid.$config.hidden = mainGrid.$parent.$config.hidden = hideGrid;\n\n\t\t\t\t\tif (!mainGrid.$config.hidden) {\n\t\t\t\t\t\t/* restrict grid width due to min_width, max_width, min_grid_column_width */\n\t\t\t\t\t\tvar grid_limits = mainGrid._getGridWidthLimits();\n\t\t\t\t\t\tif (grid_limits[0] && gantt.config.grid_width < grid_limits[0])\n\t\t\t\t\t\t\tgantt.config.grid_width = grid_limits[0];\n\t\t\t\t\t\tif (grid_limits[1] && gantt.config.grid_width > grid_limits[1])\n\t\t\t\t\t\t\tgantt.config.grid_width = grid_limits[1];\n\t\t\t\t\t\tif (mainTimeline && gantt.config.show_chart){\n\n\t\t\t\t\t\t\tmainGrid.$config.width = gantt.config.grid_width - 1;\n\n\t\t\t\t\t\t\t// GS-1314: Don't let the non-scrollable grid to be larger than the container with the correct width\n\t\t\t\t\t\t\tif (!mainGrid.$config.scrollable && mainGrid.$config.scrollY && gantt.$root.offsetWidth){\n\t\t\t\t\t\t\t\tvar ganttContainerWidth = mainGrid.$gantt.$layout.$container.offsetWidth;\n\t\t\t\t\t\t\t\tvar verticalScrollbar = gantt.$ui.getView(mainGrid.$config.scrollY);\n\t\t\t\t\t\t\t\tvar verticalScrollbarWidth = verticalScrollbar.$config.width;\n\n\t\t\t\t\t\t\t\t// GS-2488: to prevent grid from occupying the whole gantt container(timeline will be disabled) \n\t\t\t\t\t\t\t\t// need to leave min width for timeline\n\t\t\t\t\t\t\t\tvar gridOverflow = ganttContainerWidth - (mainGrid.$config.width + verticalScrollbarWidth) - 4;\n\t\t\t\t\t\t\t\tif (gridOverflow < 0){\n\t\t\t\t\t\t\t\t\tmainGrid.$config.width += gridOverflow;\n\t\t\t\t\t\t\t\t\tgantt.config.grid_width += gridOverflow;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tif (!first) {\n\t\t\t\t\t\t\t\tif (mainTimeline && !domHelpers.isChildOf(mainTimeline.$task, layout.$view)) {\n\t\t\t\t\t\t\t\t\t// timeline is being displayed after being not visible, reset grid with from full screen\n\t\t\t\t\t\t\t\t\tif (!mainGrid.$config.original_grid_width) {\n\t\t\t\t\t\t\t\t\t\tvar skinSettings = gantt.skins[gantt.skin];\n\t\t\t\t\t\t\t\t\t\tif(skinSettings && skinSettings.config && skinSettings.config.grid_width){\n\t\t\t\t\t\t\t\t\t\t\tmainGrid.$config.original_grid_width =  skinSettings.config.grid_width;\n\t\t\t\t\t\t\t\t\t\t}else{\n\t\t\t\t\t\t\t\t\t\t\tmainGrid.$config.original_grid_width = 0;\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\tgantt.config.grid_width = mainGrid.$config.original_grid_width;\n\t\t\t\t\t\t\t\t\tmainGrid.$parent.$config.width = gantt.config.grid_width;\n\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\tmainGrid.$parent._setContentSize(mainGrid.$config.width, null);\n\t\t\t\t\t\t\t\t\tgantt.$layout._syncCellSizes(mainGrid.$parent.$config.group, {value: gantt.config.grid_width, isGravity: false});\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tmainGrid.$parent.$config.width = gantt.config.grid_width;\n\t\t\t\t\t\t\t\tif (mainGrid.$parent.$config.group) {\n\t\t\t\t\t\t\t\t\tgantt.$layout._syncCellSizes(mainGrid.$parent.$config.group, {value: mainGrid.$parent.$config.width, isGravity: false});\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tif (mainTimeline && domHelpers.isChildOf(mainTimeline.$task, layout.$view)) {\n\t\t\t\t\t\t\t\t// hiding timeline, remember grid with to restore it when timeline is displayed again\n\t\t\t\t\t\t\t\tmainGrid.$config.original_grid_width = gantt.config.grid_width;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tif (!first) {\n\t\t\t\t\t\t\t\tmainGrid.$parent.$config.width = 0;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tfirst = false;\n\t\t\t\t});\n\t\t\t\tthis._initScrollStateEvents(layout);\n\t\t\t},\n\n\t\t\t_initScrollStateEvents: function(layout) {\n\t\t\t\tgantt._getVerticalScrollbar = this.getVerticalScrollbar;\n\t\t\t\tgantt._getHorizontalScrollbar = this.getHorizontalScrollbar;\n\n\t\t\t\tvar vertical = this.getVerticalScrollbar();\n\t\t\t\tvar horizontal = this.getHorizontalScrollbar();\n\t\t\t\tif (vertical) {\n\t\t\t\t\tvertical.attachEvent(\"onScroll\", function(oldPos, newPos, dir){\n\t\t\t\t\t\tvar scrollState = gantt.getScrollState();\n\t\t\t\t\t\tgantt.callEvent(\"onGanttScroll\", [scrollState.x, oldPos, scrollState.x, newPos]);\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t\tif (horizontal) {\n\t\t\t\t\thorizontal.attachEvent(\"onScroll\", function(oldPos, newPos, dir){\n\t\t\t\t\t\tvar scrollState = gantt.getScrollState();\n\t\t\t\t\t\tgantt.callEvent(\"onGanttScroll\", [oldPos, scrollState.y, newPos, scrollState.y]);\n\n\t\t\t\t\t\t// if the grid doesn't fit the width, scroll the row container\n\t\t\t\t\t\tvar grid = gantt.$ui.getView(\"grid\");\n\t\t\t\t\t\tif (grid && grid.$grid_data && !grid.$config.scrollable){\n\t\t\t\t\t\t\tgrid.$grid_data.style.left = grid.$grid.scrollLeft + \"px\";\n\t\t\t\t\t\t\tgrid.$grid_data.scrollLeft = grid.$grid.scrollLeft;\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t}\n\n\t\t\t\tlayout.attachEvent(\"onResize\", function(){\n\t\t\t\t\tif (vertical && !gantt.$scroll_ver){\n\t\t\t\t\t\tgantt.$scroll_ver = vertical.$scroll_ver;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (horizontal && !gantt.$scroll_hor){\n\t\t\t\t\t\tgantt.$scroll_hor = horizontal.$scroll_hor;\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t},\n\n\t\t\t_findGridResizer: function(layout, grid){\n\t\t\t\tvar resizers = layout.getCellsByType(\"resizer\");\n\n\t\t\t\tvar gridFirst = true;\n\t\t\t\tvar gridResizer;\n\t\t\t\tfor(var i = 0; i < resizers.length; i++){\n\t\t\t\t\tvar res = resizers[i];\n\t\t\t\t\tres._getSiblings();\n\t\t\t\t\tvar prev = res._behind;\n\t\t\t\t\tvar next = res._front;\n\t\t\t\t\tif(prev && prev.$content === grid || (prev.isChild && prev.isChild(grid))){\n\t\t\t\t\t\tgridResizer = res;\n\t\t\t\t\t\tgridFirst = true;\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}else if(next && next.$content === grid || (next.isChild && next.isChild(grid))){\n\t\t\t\t\t\tgridResizer = res;\n\t\t\t\t\t\tgridFirst = false;\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\treturn {\n\t\t\t\t\tresizer: gridResizer,\n\t\t\t\t\tgridFirst: gridFirst\n\t\t\t\t};\n\t\t\t},\n\n\t\t\tonInitialized: function (layout) {\n\t\t\t\tvar grid = gantt.$ui.getView(\"grid\");\n\n\t\t\t\tvar resizeInfo = this._findGridResizer(layout, grid);\n\n\t\t\t\t// expose grid resize events\n\t\t\t\tif(resizeInfo.resizer){\n\t\t\t\t\tvar gridFirst = resizeInfo.gridFirst,\n\t\t\t\t\t\tnext = resizeInfo.resizer;\n\t\t\t\t\t\t\n\t\t\t\t\tif(next.$config.mode !== \"x\"){\n\t\t\t\t\t\treturn;// track only horizontal resize\n\t\t\t\t\t}\n\n\t\t\t\t\tvar initialWidth;\n\t\t\t\t\tnext.attachEvent(\"onResizeStart\", function(prevCellWidth, nextCellWidth){\n\n\t\t\t\t\t\tvar grid = gantt.$ui.getView(\"grid\");\n\t\t\t\t\t\tvar viewCell = grid ? grid.$parent : null;\n\t\t\t\t\t\tif(viewCell){\n\t\t\t\t\t\t\tvar limits = grid._getGridWidthLimits();\n\n\t\t\t\t\t\t\t// min grid width is defined by min widths of its columns, unless grid has horizontal scroll\n\t\t\t\t\t\t\tif(!grid.$config.scrollable)\n\t\t\t\t\t\t\t\tviewCell.$config.minWidth = limits[0];\n\n\t\t\t\t\t\t\tviewCell.$config.maxWidth = limits[1];\n\t\t\t\t\t\t}\n\t\t\t\t\t\tinitialWidth = gridFirst ? prevCellWidth : nextCellWidth;\n\t\t\t\t\t\treturn gantt.callEvent(\"onGridResizeStart\", [initialWidth]);\n\t\t\t\t\t});\n\t\t\t\t\tnext.attachEvent(\"onResize\", function(newBehindSize, newFrontSize){\n\t\t\t\t\t\tvar newSize = gridFirst ? newBehindSize : newFrontSize;\n\t\t\t\t\t\treturn gantt.callEvent(\"onGridResize\", [initialWidth, newSize]);\n\t\t\t\t\t});\n\t\t\t\t\tnext.attachEvent(\"onResizeEnd\", function(oldBackSize, oldFrontSize, newBackSize, newFrontSize){\n\n\t\t\t\t\t\tvar oldSize = gridFirst ? oldBackSize : oldFrontSize;\n\t\t\t\t\t\tvar newSize = gridFirst ? newBackSize : newFrontSize;\n\t\t\t\t\t\tvar grid = gantt.$ui.getView(\"grid\");\n\t\t\t\t\t\tvar viewCell = grid ? grid.$parent : null;\n\t\t\t\t\t\tif(viewCell){\n\t\t\t\t\t\t\tviewCell.$config.minWidth = undefined;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tvar res = gantt.callEvent(\"onGridResizeEnd\", [oldSize, newSize]);\n\t\t\t\t\t\tif(res && newSize !== 0){// new size may be numeric zero when cell size is defined by 'gravity', actual size will be calculated by layout later\n\t\t\t\t\t\t\tgantt.config.grid_width = newSize;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\treturn res;\n\t\t\t\t\t});\n\t\t\t\t}\n\n\t\t\t},\n\t\t\tonDestroyed: function (timeline) {\n\n\t\t\t}\n\t\t};\n\n\t};\n})();\n\nexport default initializer;","import uiFactory from \"./ui_factory\";\nimport mouseEvents from \"./mouse\";\nimport createLayers from \"./gantt_layers\";\nimport Cell from \"./layout/cell\";\nimport Layout from \"./layout/layout\";\nimport ViewLayout from \"./layout/view_layout\";\nimport ViewCell from \"./layout/view_cell\";\nimport Resizer from \"./layout/resizer_cell\";\nimport Scrollbar from \"./layout/scrollbar_cell\";\nimport Timeline from \"./timeline/timeline\";\nimport Grid from \"./grid/grid\";\nimport ResourceGrid from \"./grid/resource_grid\";\nimport ResourceTimeline from \"./timeline/resource_timeline\";\nimport ResourceHistogram from \"./timeline/resource_histogram\";\n\n\nimport gridEditorsFactory from \"./grid/editors/controller\";\n\nimport renderTaskBar from \"./render/task_bar_smart_render\";\nimport renderTimedProjectBar from \"./render/task_project_smart_render\";\nimport renderSplitTaskBar from \"./render/task_split_render\";\nimport renderRollupTaskBar from \"./render/task_rollup_render\";\nimport renderTaskBg from \"./render/task_bg_render\";\nimport renderLink from \"./render/link_render\";\nimport gridRenderer from \"./render/task_grid_line_render\";\nimport resourceMatrixRenderer from \"./render/resource_matrix_render\";\nimport resourceHistogramRenderer from \"./render/resource_histogram_render\";\nimport gridTaskRowResizerRenderer from \"./render/task_grid_row_resize_render\";\nimport renderConstraints from \"./render/task_constraints_render\";\nimport renderDeadline from \"./render/task_deadline_render\";\nimport renderBaselines from \"./render/task_baselines_render\";\nimport mainGridInitializer from \"./grid/main_grid_initializer\";\nimport mainTimelineInitializer from \"./timeline/main_timeline_initializer\";\nimport mainLayoutInitializer from \"./main_layout_initializer\";\n\nfunction initUI(gantt){\n\tfunction attachInitializer(view, initializer){\n\t\tvar ext = initializer(gantt);\n\t\tif(ext.onCreated)\n\t\t\text.onCreated(view);\n\t\tview.attachEvent(\"onReady\", function(){\n\t\t\tif(ext.onInitialized)\n\t\t\t\text.onInitialized(view);\n\t\t});\n\t\tview.attachEvent(\"onDestroy\", function(){\n\t\t\tif(ext.onDestroyed)\n\t\t\t\text.onDestroyed(view);\n\t\t});\n\t}\n\n\tvar factory = uiFactory.createFactory(gantt);\n\tfactory.registerView(\"cell\", Cell);\n\tfactory.registerView(\"resizer\", Resizer);\n\tfactory.registerView(\"scrollbar\", Scrollbar);\n\tfactory.registerView(\"layout\", Layout, function(view){\n\t\tvar id = view.$config ? view.$config.id : null;\n\t\tif(id === \"main\"){\n\t\t\tattachInitializer(view, mainLayoutInitializer);\n\t\t}\n\t});\n\tfactory.registerView(\"viewcell\", ViewCell);\n\tfactory.registerView(\"multiview\", ViewLayout);\n\tfactory.registerView(\"timeline\", Timeline, function(view){\n\t\tvar id = view.$config ? view.$config.id : null;\n\t\tif(id === \"timeline\" || view.$config.bind == \"task\"){\n\t\t\tattachInitializer(view, mainTimelineInitializer);\n\t\t}\n\t});\n\tfactory.registerView(\"grid\", Grid, function(view){\n\t\tvar id = view.$config ? view.$config.id : null;\n\t\tif(id === \"grid\" || view.$config.bind == \"task\"){\n\t\t\tattachInitializer(view, mainGridInitializer);\n\t\t}\n\t});\n\n\tfactory.registerView(\"resourceGrid\", ResourceGrid);\n\tfactory.registerView(\"resourceTimeline\", ResourceTimeline);\n\tfactory.registerView(\"resourceHistogram\", ResourceHistogram);\n\n\tvar layersEngine = createLayers(gantt);\n\n\tvar inlineEditors = gridEditorsFactory(gantt);\n\n\tgantt.ext.inlineEditors = inlineEditors;\n\tgantt.ext._inlineEditors = inlineEditors;\n\tinlineEditors.init(gantt);\n\n\treturn {\n\t\tfactory:factory,\n\t\tmouseEvents: mouseEvents.init(gantt),\n\t\tlayersApi: layersEngine.init(),\n\t\trender:{\n\t\t\tgridLine: function(){\n\t\t\t\treturn gridRenderer(gantt);\n\t\t\t},\n\t\t\ttaskBg: function(){\n\t\t\t\treturn renderTaskBg(gantt);\n\t\t\t},\n\t\t\ttaskBar: function(){\n\t\t\t\treturn renderTaskBar(gantt);\n\t\t\t},\n\t\t\ttimedProjectBar: function(){\n\t\t\t\treturn renderTimedProjectBar(gantt);\n\t\t\t},\n\t\t\ttaskRollupBar: function() {\n\t\t\t\treturn renderRollupTaskBar(gantt);\n\t\t\t},\n\t\t\ttaskSplitBar: function(){\n\t\t\t\treturn renderSplitTaskBar(gantt);\n\t\t\t},\n\t\t\ttaskConstraints: function(){\n\t\t\t\treturn renderConstraints(gantt);\n\t\t\t},\n\t\t\ttaskDeadline: function(){\n\t\t\t\treturn renderDeadline(gantt);\n\t\t\t},\n\t\t\ttaskBaselines: function(){\n\t\t\t\treturn renderBaselines(gantt);\n\t\t\t},\n\t\t\tlink: function(){\n\t\t\t\treturn renderLink(gantt);\n\t\t\t},\n\t\t\tresourceRow: function(){\n\t\t\t\treturn resourceMatrixRenderer(gantt);\n\t\t\t},\n\t\t\tresourceHistogram: function(){\n\t\t\t\treturn resourceHistogramRenderer(gantt);\n\t\t\t},\n\t\t\tgridTaskRowResizer: function(){\n\t\t\t\treturn gridTaskRowResizerRenderer(gantt);\n\t\t\t}\n\t\t},\n\t\tlayersService: {\n\t\t\tgetDataRender: function(name){\n\t\t\t\treturn layersEngine.getDataRender(name, gantt);\n\t\t\t},\n\t\t\tcreateDataRender: function(config){\n\t\t\t\treturn layersEngine.createDataRender(config, gantt);\n\t\t\t}\n\t\t}\n\t};\n}\n\nexport default {\n\tinit: initUI\n};","export default null;","import * as helpers from \"../../../utils/helpers\";\nimport getRowRectangle from \"./viewport/get_grid_row_rectangle\";\nimport getVisibleRange from \"./viewport/get_visible_bars_range\";\nimport isInViewPort from \"./viewport/is_grid_row_in_viewport\";\n\nfunction createGridLineRender(gantt){\n\n\tfunction _render_grid_item(item, view, config, viewport) {\n\t\tvar columns = view.getGridColumns();\n\t\tvar templates = view.$getTemplates();\n\n\t\tvar store = view.$config.rowStore;\n\n\t\tvar cells = [];\n\t\tvar has_child;\n\t\tfor (var i = 0; i < columns.length; i++) {\n\t\t\tvar last = i == columns.length - 1;\n\t\t\tvar col = columns[i];\n\t\t\tvar cell;\n\n\t\t\tvar value;\n\t\t\tvar textValue;\n\t\t\tif (col.name == \"add\") {\n\t\t\t\tvar aria = gantt._waiAria.gridAddButtonAttrString(col);\n\n\t\t\t\tvalue = \"<div \" + aria + \" class='gantt_add'></div>\";\n\t\t\t\ttextValue = \"\";\n\t\t\t} else {\n\t\t\t\tif (col.template)\n\t\t\t\t\tvalue = col.template(item);\n\t\t\t\telse\n\t\t\t\t\tvalue = item[col.name];\n\n\t\t\t\tif (helpers.isDate(value)){\n\t\t\t\t\tvalue = templates.date_grid(value, item, col.name);\n\t\t\t\t}\n\n\t\t\t\tif (value === null || value === undefined) {\n\t\t\t\t\tvalue = \"\";\n\t\t\t\t}\n\n\t\t\t\ttextValue = value;\n\t\t\t\tvalue = \"<div class='gantt_tree_content'>\" + value + \"</div>\";\n\t\t\t}\n\t\t\tvar css = \"gantt_cell\" + (last ? \" gantt_last_cell\" : \"\");\n\n\t\t\tvar tree = [];\n\t\t\tif (col.tree) {\n\t\t\t\tcss += \" gantt_cell_tree\";\n\t\t\t\tfor (var j = 0; j < item.$level; j++)\n\t\t\t\t\ttree.push(templates.grid_indent(item));\n\n\t\t\t\thas_child = store.hasChild(item.id) && !(gantt.isSplitTask(item) && !gantt.config.open_split_tasks);\n\t\t\t\tif (has_child) {\n\t\t\t\t\ttree.push(templates.grid_open(item));\n\t\t\t\t\ttree.push(templates.grid_folder(item));\n\t\t\t\t} else {\n\t\t\t\t\ttree.push(templates.grid_blank(item));\n\t\t\t\t\ttree.push(templates.grid_file(item));\n\t\t\t\t}\n\t\t\t}\n\t\t\tvar style = \"width:\" + (col.width - (last ? 1 : 0)) + \"px;\";\n\t\t\tif (this.defined(col.align)){\n\t\t\t\tvar flexAlign = {\n\t\t\t\t\tright: \"flex-end\",\n\t\t\t\t\tleft: \"flex-start\",\n\t\t\t\t\tcenter: \"center\"\n\t\t\t\t};\n\t\t\t\tvar justifyContent = flexAlign[col.align];\n\n\t\t\t\tstyle += \"text-align:\" + col.align + \";justify-content:\"  + justifyContent + \";\";\n\t\t\t}\n\n\t\t\tvar aria = gantt._waiAria.gridCellAttrString(col, textValue, item);\n\n\t\t\ttree.push(value);\n\t\t\tcell = \"<div class='\" + css + \"' data-column-index='\"+i+\"' data-column-name='\"+col.name+\"' style='\" + style + \"' \" + aria + \">\" + tree.join(\"\") + \"</div>\";\n\t\t\tcells.push(cell);\n\t\t}\n\t\t// GS-291. The odd class should be assigned correctly\n\t\tcss = \"\";\n\t\tconst storeName = store.$config.name;\n\t\tswitch (storeName) {\n\t\t\tcase \"task\":\n\t\t\t\tcss = gantt.getGlobalTaskIndex(item.id) % 2 === 0 ? \"\" : \" odd\";\n\t\t\t\tbreak;\n\t\t\tcase \"resource\":\n\t\t\t\tcss = store.visibleOrder.indexOf(item.id) % 2 === 0 ? \"\" : \" odd\";\n\t\t\t\tbreak;\n\t\t}\n\n\t\tcss += (item.$transparent) ? \" gantt_transparent\" : \"\";\n\n\t\tcss += (item.$dataprocessor_class ? \" \" + item.$dataprocessor_class : \"\");\n\n\t\tif (templates.grid_row_class) {\n\t\t\tvar css_template = templates.grid_row_class.call(gantt, item.start_date, item.end_date, item);\n\t\t\tif (css_template)\n\t\t\t\tcss += \" \" + css_template;\n\t\t}\n\n\t\tif(store.isSelected(item.id)) {\n\t\t\tcss += \" gantt_selected\";\n\t\t}\n\n\t\tvar el = document.createElement(\"div\");\n\t\tel.className = \"gantt_row\" + css + \" gantt_row_\" + gantt.getTaskType(item.type);\n\t\tvar height = view.getItemHeight(item.id);\n\t\tel.style.height = height + \"px\";\n\t\tel.style.lineHeight = height + \"px\";\n\n\t\tif(config.smart_rendering){\n\t\t\tel.style.position = \"absolute\";\n\t\t\tel.style.left = \"0px\";\n\t\t\tel.style.top = view.getItemTop(item.id) + \"px\";\n\t\t}\n\n\t\tif(view.$config.item_attribute){\n\t\t\tel.setAttribute(view.$config.item_attribute, item.id);\n\t\t\tel.setAttribute(view.$config.bind + \"_id\", item.id); // 'task_id'/'resource_id' for backward compatibility\n\t\t}\n\n\t\tgantt._waiAria.taskRowAttr(item, el);\n\n\t\tel.innerHTML = cells.join(\"\");\n\t\treturn el;\n\t}\n\n\tfunction onrender(item, rowNode, view){\n\t\tvar columns = view.getGridColumns();\n\t\tfor (var i = 0; i < columns.length; i++) {\n\t\t\tvar column = columns[i];\n\t\t\tif (column.onrender){\n\n\t\t\t\t// find cell node for current column\n\t\t\t\tvar cellNode = rowNode.querySelector(\"[data-column-name=\" + column.name + \"]\");\n\t\t\t\tif (cellNode) {\n\t\t\t\t\tvar content = column.onrender(item, cellNode);\n\t\t\t\t\tif (content && typeof content === \"string\") {\n\t\t\t\t\t\tcellNode.innerHTML = content;\n\t\t\t\t\t} else if (content && typeof content === \"object\") {\n\t\t\t\t\t\t// render object to node using additional functionality\n\t\t\t\t\t\tif (gantt.config.external_render){\n\t\t\t\t\t\t\tvar adapter = gantt.config.external_render;\n\t\t\t\t\t\t\tif (adapter.isElement(content)){\n\t\t\t\t\t\t\t\tadapter.renderElement(content, cellNode);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\treturn {\n\t\trender: _render_grid_item,\n\t\tupdate: null,\n\t\tgetRectangle: getRowRectangle,\n\t\tisInViewPort: isInViewPort,\n\t\tgetVisibleRange: getVisibleRange,\n\t\tonrender: onrender\n\t};\n}\n\nexport default createGridLineRender;","import getRowRectangle from \"./viewport/get_bg_row_rectangle\";\nimport isLegacyRender from \"./is_legacy_smart_render\";\nimport getVisibleRange from \"./viewport/get_visible_bars_range\";\nimport getVisibleCellsRange from \"./viewport/get_visible_cells_range\";\nimport isColumnVisible from \"./viewport/is_column_visible\";\nimport bgPlaceholder from \"./prerender/task_bg_placeholder\";\n\nfunction createTaskBgRender(gantt){\n\tvar renderedCells = {};\n\tvar visibleCells = {};\n\n\tfunction isRendered(item, columnIndex){\n\t\tif(renderedCells[item.id][columnIndex] && renderedCells[item.id][columnIndex].parentNode){\n\t\t\treturn true;\n\t\t}else{\n\t\t\treturn false;\n\t\t}\n\t}\n\n\tfunction detachRenderedCell(itemId, columnIndex){\n\t\tif(renderedCells[itemId] && renderedCells[itemId][columnIndex] &&\n\t\t\trenderedCells[itemId][columnIndex].parentNode\n\t\t\t){\n\t\t\t\trenderedCells[itemId][columnIndex].parentNode.removeChild(renderedCells[itemId][columnIndex]);\n\t\t\t}\n\t}\n\n\tfunction getCellClassTemplate(view){\n\t\tvar templates = view.$getTemplates();\n\t\tvar cssTemplate;\n\t\tif (typeof templates.task_cell_class !== \"undefined\") {\n\t\t\tcssTemplate = templates.task_cell_class;\n\t\t\t// eslint-disable-next-line no-console\n\t\t\tvar log = console.warn || console.log;\n\t\t\tlog('gantt.templates.task_cell_class template is deprecated and will be removed soon. Please use gantt.templates.timeline_cell_class instead.');\n\t\t} else {\n\t\t\tcssTemplate = templates.timeline_cell_class;\n\t\t}\n\t\treturn cssTemplate;\n\t}\n\tfunction getCellContentTemplate(view){\n\t\tvar templates = view.$getTemplates();\n\t\tvar contentTemplate = templates.timeline_cell_content;\n\t\treturn contentTemplate;\n\t}\n\n\tfunction renderCells(item, node, view, config, viewPort){\n\t\tvar cfg = view.getScale();\n\t\tvar count = cfg.count;\n\t\tvar cssTemplate = getCellClassTemplate(view);\n\t\tvar contentTemplate = getCellContentTemplate(view);\n\n\t\tif (config.show_task_cells) {\n\t\t\tif(!renderedCells[item.id]){\n\t\t\t\trenderedCells[item.id] = {};\n\t\t\t}\n\t\t\tif(!visibleCells[item.id]){\n\t\t\t\tvisibleCells[item.id] = {};\n\t\t\t}\n\n\t\t\tvar range = getVisibleCellsRange(cfg, viewPort);\n\n\t\t\tfor(var i in visibleCells[item.id]){\n\t\t\t\tvar index = visibleCells[item.id][i];\n\n\t\t\t\tif(Number(index) < range.start || Number(index) > range.end){\n\t\t\t\t\tdetachRenderedCell(item.id, index);\n\t\t\t\t}\n\t\t\t}\n\t\t\tvisibleCells[item.id] = {};\n\t\t\t// TODO: do not iterate all cell, only ones in the viewport and once that are already rendered\n\t\t\tfor (var columnIndex = range.start; columnIndex <= range.end; columnIndex++) {\n\t\t\t\tvar cell = renderOneCell(cfg, columnIndex, item, viewPort, count, cssTemplate, contentTemplate, config);\n\t\t\t\tif(!cell && isRendered(item, columnIndex)){\n\t\t\t\t\tdetachRenderedCell(item.id, columnIndex);\n\t\t\t\t}else if (cell && !cell.parentNode){\n\t\t\t\t\tnode.appendChild(cell);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\tfunction renderOneCell(scale, columnIndex, item, viewPort, count, cssTemplate, contentTemplate, config){\n\t\tvar width = scale.width[columnIndex],\n\t\t\tcssclass = \"\";\n\n\t\tif (isColumnVisible(columnIndex, scale, viewPort, gantt)) {//do not render skipped columns\n\n\t\t\tvar cssTemplateContent = cssTemplate(item, scale.trace_x[columnIndex]);\n\t\t\tvar htmlTemplateContent = \"\";\n\t\t\tif (contentTemplate) {// for backward compatibility, contentTemplate was added in 7.2.0+, will be undefined if someone used copy of old config/template object\n\t\t\t\thtmlTemplateContent = contentTemplate(item, scale.trace_x[columnIndex]);\n\t\t\t}\n\n\t\t\tif(config.static_background){\n\t\t\t\t// if cell render in static background is not allowed, or if it's a blank cell\n\t\t\t\tvar customCell = !!(cssTemplateContent || htmlTemplateContent);\n\t\t\t\tif(!(config.static_background_cells && customCell)){\n\t\t\t\t\treturn null;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif(renderedCells[item.id][columnIndex]){\n\t\t\t\tvisibleCells[item.id][columnIndex] = columnIndex;\n\t\t\t\treturn renderedCells[item.id][columnIndex];\n\t\t\t}\n\t\t\tvar cell = document.createElement(\"div\");\n\t\t\tcell.style.width = (width) + \"px\";\n\n\t\t\tcssclass = \"gantt_task_cell\" + (columnIndex == count - 1 ? \" gantt_last_cell\" : \"\");\n\t\t\tif (cssTemplateContent) {\n\t\t\t\tcssclass += \" \" + cssTemplateContent;\n\t\t\t}\n\t\t\tcell.className = cssclass;\n\n\t\t\tif (htmlTemplateContent) {\n\t\t\t\tcell.innerHTML = htmlTemplateContent;\n\t\t\t}\n\n\t\t\tcell.style.position = \"absolute\";\n\t\t\tcell.style.left = scale.left[columnIndex] + \"px\";\n\t\t\trenderedCells[item.id][columnIndex] = cell;\n\t\t\tvisibleCells[item.id][columnIndex] = columnIndex;\n\n\t\t\treturn cell;\n\t\t}\n\t\treturn null;\n\t}\n\n\tfunction _render_bg_line(item, view, config, viewPort) {\n\t\tvar templates = view.$getTemplates();\n\t\tvar cfg = view.getScale();\n\t\tvar count = cfg.count;\n\n\t\tif(config.static_background && !config.static_background_cells){\n\t\t\treturn null;\n\t\t}\n\n\t\tvar row = document.createElement(\"div\");\n\n\t\tvar cellCssTemplate = getCellClassTemplate(view);\n\t\tvar cellHtmlTemplate = getCellContentTemplate(view);\n\n\t\tvar range;\n\n\t\tif(!viewPort || !config.smart_rendering || isLegacyRender(gantt)){\n\t\t\trange = {\n\t\t\t\tstart: 0,\n\t\t\t\tend: count - 1\n\t\t\t};\n\t\t} else {\n\t\t\trange = getVisibleCellsRange(cfg, viewPort.x);\n\t\t}\n\t\tif (config.show_task_cells) {\n\t\t\trenderedCells[item.id] = {};\n\t\t\tvisibleCells[item.id] = {};\n\t\t\tfor (var columnIndex = range.start; columnIndex <= range.end; columnIndex++) {\n\t\t\t\tvar cell = renderOneCell(cfg, columnIndex, item, viewPort, count, cellCssTemplate, cellHtmlTemplate, config);\n\t\t\t\tif(cell){\n\t\t\t\t\trow.appendChild(cell);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\t// GS-291. The odd class should be assigned correctly\n\t\tconst store = view.$config.rowStore;\n\t\tconst odd = store.getIndexById(item.id) % 2 !== 0;\n\n\t\tvar cssTemplate = templates.task_row_class(item.start_date, item.end_date, item);\n\t\tvar css = \"gantt_task_row\" + (odd ? \" odd\" : \"\") + (cssTemplate ? ' ' + cssTemplate : '');\n\n\t\tif(store.isSelected(item.id)) {\n\t\t\tcss += \" gantt_selected\";\n\t\t}\n\n\t\trow.className = css;\n\n\t\tif (config.smart_rendering) {\n\t\t\trow.style.position = \"absolute\";\n\t\t\trow.style.top = view.getItemTop(item.id) + \"px\";\n\t\t\trow.style.width = \"100%\";\n\t\t}else{\n\t\t\trow.style.position = \"relative\";\n\t\t}\n\t\trow.style.height = (view.getItemHeight(item.id)) + \"px\";\n\n\t\tif (item.id == \"timeline_placeholder_task\"){\n\t\t\tvar placeholderTop = 0;\n\t\t\tif (item.lastTaskId){\n\t\t\t\tvar lastTaskTop = view.getItemTop(item.lastTaskId);\n\t\t\t\tvar lastTaskHeight = view.getItemHeight(item.lastTaskId);\n\t\t\t\tplaceholderTop = lastTaskTop + lastTaskHeight;\t\n\t\t\t}\n\n\t\t\tvar maxHeight = item.row_height || view.$task_data.offsetHeight;\n\n\t\t\tvar placeholderHeight = maxHeight - placeholderTop;\n\t\t\t// So that it won't exceed the placeholder timeline height\n\t\t\tif (placeholderHeight < 0){\n\t\t\t\tplaceholderHeight = 0;\n\t\t\t}\n\n\t\t\tif (config.smart_rendering) {\n\t\t\t\trow.style.top = placeholderTop + \"px\";\t\n\t\t\t}\n\t\t\trow.style.height = placeholderHeight + \"px\";\n\t\t}\n\n\n\t\tif(view.$config.item_attribute){\n\t\t\trow.setAttribute(view.$config.item_attribute, item.id);\n\t\t\trow.setAttribute(view.$config.bind + \"_id\", item.id); // 'task_id'/'resource_id' for backward compatibility\n\t\t}\n\n\t\treturn row;\n\t}\n\n\treturn {\n\t\trender: _render_bg_line,\n\t\tupdate: renderCells,\n\t\tgetRectangle: getRowRectangle,\n\t\tgetVisibleRange: getVisibleRange,\n\t\tprepareData: bgPlaceholder\n\t};\n}\n\nexport default createTaskBgRender;\n","import createBaseBarRender from \"./task_bar_render\";\nimport isInViewPort from \"./viewport/is_bar_in_viewport\";\nimport getVisibleRange from \"./viewport/get_visible_bars_range\";\n\nfunction createTaskRenderer(gantt){\n\tconst defaultRender = createBaseBarRender(gantt);\n\n\tconst renderedNodes = {};\n\n\tfunction checkVisibility(child, viewPort, timeline, config, gantt){\n\t\tlet isVisible = true;\n\t\t// GS-2123. Don't render rollup tasks that are outside the viewport\n\t\tif (config.smart_rendering){\n\t\t\tisVisible = isInViewPort(child, viewPort, timeline, config, gantt);\n\t\t}\n\t\treturn isVisible;\n\t}\n\n\tfunction generateChildElement(task, child, timeline, sizes){\n\t\tconst childCopy = gantt.copy(gantt.getTask(child.id));\n\t\tchildCopy.$rendered_at = task.id;\n\t\t// a way to filter rollup tasks:\n\t\tconst displayRollup = gantt.callEvent(\"onBeforeRollupTaskDisplay\", [childCopy.id, childCopy, task.id]);\n\t\tif (displayRollup === false){\n\t\t\treturn;\n\t\t}\n\n\t\tconst element = defaultRender(childCopy, timeline);\n\t\tif(!element){\n\t\t\treturn;\n\t\t}\n\n\t\tconst height = timeline.getBarHeight(task.id, child.type == gantt.config.types.milestone);\n\t\tconst padding = Math.floor((timeline.getItemHeight(task.id) - height) / 2);\n\n\t\telement.style.top = (sizes.top + padding) + \"px\";\n\t\telement.classList.add(\"gantt_rollup_child\");\n\t\telement.setAttribute(\"data-rollup-parent-id\", task.id);\n\n\t\treturn element;\n\t}\n\n\tfunction getKey(childId, renderParentId){\n\t\treturn childId + \"_\" + renderParentId;\n\t}\n\n\n\tfunction renderRollupTask(task, timeline, config, viewPort) {\n\t\tif (task.rollup !== false && task.$rollup && task.$rollup.length) {\n\t\t\tconst el = document.createElement('div'),\n\t\t\t\tsizes = gantt.getTaskPosition(task);\n\n\t\t\t// vertical position is not important for the rollup tasks as long as the parent is rendered\n\t\t\tif (viewPort){\n\t\t\t\tviewPort.y = 0;\n\t\t\t\tviewPort.y_end = gantt.$task_bg.scrollHeight;\n\t\t\t}\n\n\t\t\ttask.$rollup.forEach(function(itemId){\n\t\t\t\tif (!gantt.isTaskExists(itemId)){\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tconst child = gantt.getTask(itemId);\n\t\t\t\tlet isVisible = checkVisibility(child, viewPort, timeline, config, gantt);\n\t\t\t\tif (!isVisible){\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tconst element = generateChildElement(task, child, timeline, sizes);\n\t\t\t\tif (element) {\n\t\t\t\t\trenderedNodes[getKey(child.id, task.id)] = element;\n\t\t\t\t\tel.appendChild(element);\n\t\t\t\t} else{\n\t\t\t\t\trenderedNodes[getKey(child.id, task.id)] = false;\n\t\t\t\t}\n\n\t\t\t});\n\n\t\t\treturn el;\n\t\t}\n\t\treturn false;\n\t}\n\n\tfunction repaintRollupTask(task, itemNode, timeline, config, viewPort) {\n\t\tconst el = document.createElement(\"div\"),\n\t\tsizes = gantt.getTaskPosition(task);\n\n\t\t// vertical position is not important for the rollup tasks as long as the parent is rendered\n\t\tviewPort.y = 0;\n\t\tviewPort.y_end = gantt.$task_bg.scrollHeight;\n\n\t\ttask.$rollup.forEach(function(itemId){\n\t\t\tconst child = gantt.getTask(itemId);\n\t\t\tconst rollupKey = getKey(child.id, task.id);\n\t\t\tlet isVisible = checkVisibility(child, viewPort, timeline, config, gantt);\n\t\t\tif (isVisible !== !!renderedNodes[rollupKey]) {\n\n\t\t\t\tif (isVisible) {\n\t\t\t\t\tconst element = generateChildElement(task, child, timeline, sizes);\n\t\t\t\t\trenderedNodes[rollupKey] = element || false;\n\t\t\t\t} else {\n\t\t\t\t\trenderedNodes[rollupKey] = false;\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (!!renderedNodes[rollupKey]) {\n\t\t\t\tel.appendChild(renderedNodes[rollupKey]);\n\t\t\t}\n\t\t\titemNode.innerHTML = \"\";\n\t\t\titemNode.appendChild(el);\n\t\t});\n\t}\n\n\n\n\treturn {\n\t\trender: renderRollupTask,\n\t\tupdate: repaintRollupTask,\n\t\t//getRectangle: getBarRectangle\n\t\tisInViewPort: isInViewPort,\n\t\tgetVisibleRange: getVisibleRange\n\t};\n}\n\nexport default createTaskRenderer;","import getRectangle from \"./viewport/get_bg_row_rectangle\";\nimport getVisibleRange from \"./viewport/get_visible_bars_range\";\nimport getVisibleCellsRange from \"./viewport/get_visible_cells_range\";\nimport isColumnVisible from \"./viewport/is_column_visible\";\nimport resourceTimetable from \"../../resource_timetable_builder\";\n\nfunction generateRenderResourceLine(gantt){\n\tvar getResourceLoad = resourceTimetable(gantt);\n\tvar renderedResourceLines = {};\n\n\tfunction renderResourceLineCell(resource, day, templates, config, timeline){\n\t\tvar css = templates.resource_cell_class(day.start_date, day.end_date, resource, day.tasks, day.assignments);\n\t\tvar content = templates.resource_cell_value(day.start_date, day.end_date, resource, day.tasks, day.assignments);\n\t\tvar height = timeline.getItemHeight(resource.id) - 1;\n\n\t\tif (css || content){\n\t\t\tvar sizes = timeline.getItemPosition(resource, day.start_date, day.end_date);\n\t\t\tvar el = document.createElement('div');\n\t\t\tel.setAttribute(timeline.$config.item_attribute, resource.id);\n\t\t\tel.className = [\"gantt_resource_marker\", css].join(\" \");\n\n\t\t\tel.style.cssText = [\n\t\t\t\t'left:' + sizes.left + 'px',\n\t\t\t\t'width:' + sizes.width + 'px',\n\t\t\t\t'height:' + (height) + 'px',\n\t\t\t\t'line-height:' + (height) + 'px',\n\t\t\t\t'top:' + sizes.top + 'px'\n\t\t\t].join(\";\");\n\n\t\t\tif(content)\n\t\t\t\tel.innerHTML = content;\n\n\t\t\treturn el;\n\t\t}\n\t\treturn null;\n\t}\n\n\tfunction detachRenderedResourceLine(id, index){\n\t\tif(renderedResourceLines[id] && renderedResourceLines[id][index] &&\n\t\t\trenderedResourceLines[id][index].parentNode\n\t\t\t){\n\t\t\t\trenderedResourceLines[id][index].parentNode.removeChild(renderedResourceLines[id][index]);\n\t\t\t}\n\t}\n\n\tfunction renderResourceLine(resource, timeline, config, viewport) {\n\t\tvar templates = timeline.$getTemplates();\n\t\tvar scale = timeline.getScale();\n\t\tvar timetable = getResourceLoad(resource, config.resource_property, timeline.getScale(), timeline);\n\t\tvar smartRendering = !!viewport;//no viewport means smart rendering is disabled\n\t\tvar cells = [];\n\t\trenderedResourceLines[resource.id] = {};\n\n\t\tvar range = getVisibleCellsRange(scale, viewport);\n\t\tfor (var columnIndex = range.start; columnIndex <= range.end; columnIndex++) {\n\n\t\t\tvar day = timetable[columnIndex];\n\t\t\tif(!day){\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tif(smartRendering && !isColumnVisible(columnIndex, scale, viewport, gantt)){\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tvar cell = renderResourceLineCell(resource, day, templates, config, timeline);\n\t\t\tif(cell){\n\t\t\t\tcells.push(cell);\n\t\t\t\trenderedResourceLines[resource.id][columnIndex] = cell;\n\t\t\t}\n\t\t}\n\n\t\tvar row = null;\n\t\tif(cells.length){\n\t\t\trow = document.createElement(\"div\");\n\t\t\tfor(var i = 0; i < cells.length; i++){\n\t\t\t\trow.appendChild(cells[i]);\n\t\t\t}\n\t\t}\n\t\treturn row;\n\t}\n\n\tfunction updateResourceLine(resource, node, timeline, config, viewport) {\n\t\tvar templates = timeline.$getTemplates();\n\t\tvar scale = timeline.getScale();\n\t\tvar timetable = getResourceLoad(resource, config.resource_property, timeline.getScale(), timeline);\n\n\t\tvar range = getVisibleCellsRange(scale, viewport);\n\n\t\tvar checkedColumns = {};\n\t\tif(renderedResourceLines && renderedResourceLines[resource.id]){\n\t\t\tfor(var i in renderedResourceLines[resource.id]){\n\t\t\t\tcheckedColumns[i] = i;\n\t\t\t}\n\t\t}\n\n\t\tfor (var columnIndex = range.start; columnIndex <= range.end; columnIndex++) {\n\t\t\tvar day = timetable[columnIndex];\n\t\t\tcheckedColumns[columnIndex] = false;\n\t\t\tif(!day){\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tif(!isColumnVisible(columnIndex, scale, viewport, gantt)){\n\t\t\t\tdetachRenderedResourceLine(resource.id, columnIndex);\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tif(!renderedResourceLines[resource.id] || !renderedResourceLines[resource.id][columnIndex]){\n\t\t\t\tvar cell = renderResourceLineCell(resource, day, templates, config, timeline);\n\t\t\t\tif(cell){\n\t\t\t\t\tnode.appendChild(cell);\n\t\t\t\t\trenderedResourceLines[resource.id][columnIndex] = cell;\n\t\t\t\t}\n\t\t\t}\n\t\t\telse if(renderedResourceLines[resource.id] && renderedResourceLines[resource.id][columnIndex] && !renderedResourceLines[resource.id][columnIndex].parentNode){\n\t\t\t\tnode.appendChild(renderedResourceLines[resource.id][columnIndex]);\n\t\t\t}\n\t\t}\n\n\t\tfor(var i in checkedColumns){\n\t\t\tif(checkedColumns[i] !== false){\n\t\t\t\tdetachRenderedResourceLine(resource.id, i);\n\t\t\t}\n\t\t}\n\t}\n\n\treturn {\n\t\trender: renderResourceLine,\n\t\tupdate: updateResourceLine,\n\t\tgetRectangle: getRectangle,\n\t\tgetVisibleRange: getVisibleRange\n\t};\n}\n\nexport default generateRenderResourceLine;","import getRowRectangle from \"./viewport/get_grid_row_rectangle\";\nimport getVisibleRange from \"./viewport/get_visible_bars_range\";\n\nfunction createGridTaskRowResizerRender(gantt){\n\n\tfunction _render_grid_item(item, view, viewport) {\n\n\t\tvar config = view.$getConfig();\n\t\tvar resize_el = document.createElement(\"div\");\n\t\tresize_el.className = \"gantt_task_grid_row_resize_wrap\";\n\n\t\tresize_el.style.top = (view.getItemTop(item.id) + view.getItemHeight(item.id)) + \"px\";\n\n\t\tresize_el.innerHTML = \"<div class='gantt_task_grid_row_resize' role='cell'></div>\";\n\t\tresize_el.setAttribute(config.task_grid_row_resizer_attribute, item.id);\n\n\t\tgantt._waiAria.rowResizerAttr(resize_el);\n\t\treturn resize_el;\n\t}\n\n\treturn {\n\t\trender: _render_grid_item,\n\t\tupdate: null,\n\t\tgetRectangle: getRowRectangle,\n\t\tgetVisibleRange: getVisibleRange\n\t};\n}\n\nexport default createGridTaskRowResizerRender;","function _configure(col, data, force) {\n\tfor (var key in data)\n\t\tif (typeof col[key] == \"undefined\" || force)\n\t\t\tcol[key] = data[key];\n}\n\nfunction _get_skin(force, gantt) {\n\n\tconst styles = getComputedStyle(gantt.$root);\n\tconst themeVar = styles.getPropertyValue(\"--dhx-gantt-theme\");\n\tlet isCssVarTheme = !!themeVar;\n\tlet themeName;\n\n\t\n\tif(isCssVarTheme){\n\t\tthemeName = themeVar;\n\t}else{\n\t\tvar skin = gantt.skin;\n\t\tthemeName = skin;\n\t\tif (!skin || force) {\n\t\t\tvar links = document.getElementsByTagName(\"link\");\n\t\t\tfor (var i = 0; i < links.length; i++) {\n\t\t\t\tvar res = links[i].href.match(\"dhtmlxgantt_([a-z_]+).css\");\n\t\t\t\tif (res) {\n\t\t\t\t\tif (gantt.skins[res[1]] || !skin) {\n\t\t\t\t\t\tthemeName = res[1];\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\tgantt._theme_info = {\n\t\ttheme: themeName,\n\t\tcssVarTheme: isCssVarTheme\n\t};\n\n\n\n\tgantt.skin = themeName || \"terrace\";\n\tvar skinset = gantt.skins[gantt.skin] || gantt.skins[\"terrace\"];\n\n\t//apply skin related settings\n\t_configure(gantt.config, skinset.config, force);\n\n\tif(!isCssVarTheme){\n\t\tgantt.config.link_radius = 1;\n\t}\n\n\tvar config = gantt.getGridColumns();\n\tif (config[1] && !gantt.defined(config[1].width))\n\t\tconfig[1].width = skinset._second_column_width;\n\tif (config[2] && !gantt.defined(config[2].width))\n\t\tconfig[2].width = skinset._third_column_width;\n\t\n\tfor (var i=0; i<config.length; i++) {\n\t\tvar column = config[i];\n\t\tif (column.name == \"add\") {\n\t\t\tif(!column.width){\n\t\t\t\tcolumn.width = 44;\n\t\t\t}\n\t\t\tif (!(gantt.defined(column.min_width) && gantt.defined(column.max_width))) {\n\t\t\t\tcolumn.min_width = column.min_width || column.width;\n\t\t\t\tcolumn.max_width = column.max_width || column.width;\n\t\t\t}\n\t\t\tif (column.min_width)\n\t\t\t\tcolumn.min_width = +column.min_width;\n\t\t\tif (column.max_width)\n\t\t\t\tcolumn.max_width = +column.max_width;\n\t\t\tif (column.width) {\n\t\t\t\tcolumn.width = +column.width;\n\t\t\t\tcolumn.width = (column.min_width && column.min_width > column.width) ? column.min_width : column.width;\n\t\t\t\tcolumn.width = (column.max_width && column.max_width < column.width) ? column.max_width : column.width;\n\t\t\t}\n\t\t}\n\t}\n\n\tif (skinset.config.task_height){\n\t\tgantt.config.task_height = skinset.config.task_height || \"full\";\n\t}\n\tif (skinset.config.bar_height){\n\t\tgantt.config.bar_height = skinset.config.bar_height || \"full\";\n\t}\n\n\tif (skinset._lightbox_template)\n\t\tgantt._lightbox_template = skinset._lightbox_template;\n\n\tif (skinset._redefine_lightbox_buttons) {\n\t\tgantt.config.buttons_right = skinset._redefine_lightbox_buttons[\"buttons_right\"];\n\t\tgantt.config.buttons_left = skinset._redefine_lightbox_buttons[\"buttons_left\"];\n\t}\n\n\n\tgantt.resetLightbox();\n}\n\n\n\nexport default function(gantt) {\n\t\n\tif(!gantt.resetSkin){\n\t\tgantt.resetSkin = function () {\n\t\t\tthis.skin = \"\";\n\t\t\t_get_skin(true, this);\n\t\t};\n\t\tgantt.skins = {};\n\n\t\tgantt.attachEvent(\"onGanttLayoutReady\", function(){\n\t\t\t_get_skin(false, this);\n\t\t\tmonitorThemeChange();\n\t\t});\n\t}\n\n\tgantt._addThemeClass = function(){\n\t\tdocument.documentElement.setAttribute(\"data-gantt-theme\", gantt.skin);\n\t};\n\n\tgantt.setSkin = function(value){\n\t\tthis.skin = value;\n\t\tgantt._addThemeClass();\n\t\tmonitorThemeChange();\n\t\tif(gantt.$root){\n\t\t\t_get_skin(true, gantt);\n\t\t\tthis.render();\n\t\t}\n\t\t\n\t\t//\n\t};\n\n\n\tlet monitorIntervalId = null;\n\tfunction monitorThemeChange(){\n\t\tconst container = gantt.$root;\n\t\t\n\t\tif(monitorIntervalId){\n\t\t\tclearInterval(monitorIntervalId);\n\t\t}\n\t\t\n\t\tif(container){\n\t\t\tmonitorIntervalId = setInterval(() => {\n\t\t\t\tconst csstheme = getComputedStyle(container).getPropertyValue('--dhx-gantt-theme');\n\t\t\t\tif(csstheme && csstheme !== gantt.skin){\n\t\t\t\t\tgantt.setSkin(csstheme);\n\t\t\t\t}\n\n\t\t\t}, 100);\n\t\t}\n\t}\n\tgantt.attachEvent(\"onDestroy\", function(){\n\t\tclearInterval(monitorIntervalId);\n\t});\n};","import * as domHelpers from \"../utils/dom_helpers\";\nimport isHeadless from \"../../../utils/is_headless\";\n\nexport default function(gantt){\n\n\tvar scrollRange = 50,\n\t\tscrollStep = 30,\n\t\tscrollDelay = 10,\n\t\tscrollSpeed = 50;\n\n\tvar interval = null,\n\t\tisMove = false,\n\t\tdelayTimeout = null,\n\t\tstartPos = {\n\t\t\tstarted: false\n\t\t},\n\t\teventPos = {};\n\n\n\tfunction isDisplayed(element){\n\t\treturn element &&\n\t\t\tdomHelpers.isChildOf(element, gantt.$root) &&\n\t\t\telement.offsetHeight;\n\t}\n\n\tfunction getAutoscrollContainer(){\n\t\tvar element;\n\t\tif(isDisplayed(gantt.$task)){\n\t\t\telement = gantt.$task;\n\t\t}else if(isDisplayed(gantt.$grid)){\n\t\t\telement = gantt.$grid;\n\t\t}else{\n\t\t\telement = gantt.$root;\n\t\t}\n\n\t\treturn element;\n\t}\n\n\tfunction isScrollState() {\n\t\tvar dragMarker = !!document.querySelector(\".gantt_drag_marker\");\n\t\tvar isResize = !!document.querySelector(\".gantt_drag_marker.gantt_grid_resize_area\")\n\t\t\t|| !!document.querySelector(\".gantt_drag_marker.gantt_row_grid_resize_area\") ;\n\t\tvar isLink = !!document.querySelector(\".gantt_link_direction\");\n\t\tvar state = gantt.getState();\n\t\tvar isClickDrag = state.autoscroll;\n\t\tisMove = dragMarker && !isResize && !isLink;\n\n\t\treturn !((!state.drag_mode && !dragMarker) || isResize) || isClickDrag;\n\t}\n\n\tfunction defineDelayTimeout(state) {\n\t\tif (delayTimeout) {\n\t\t\tclearTimeout(delayTimeout);\n\t\t\tdelayTimeout = null;\n\t\t}\n\t\tif (state) {\n\t\t\tvar speed = gantt.config.autoscroll_speed;\n\t\t\tif (speed && speed < 10) // limit speed value to 10\n\t\t\t\tspeed = 10;\n\n\t\t\tdelayTimeout = setTimeout(function() {\n\t\t\t\tinterval = setInterval(tick, speed || scrollSpeed);\n\t\t\t}, gantt.config.autoscroll_delay || scrollDelay);\n\t\t}\n\t}\n\n\tfunction defineScrollInterval(state) {\n\t\tif (state) {\n\t\t\tdefineDelayTimeout(true);\n\t\t\tif (!startPos.started) {\n\t\t\t\tstartPos.x = eventPos.x;\n\t\t\t\tstartPos.y = eventPos.y;\n\t\t\t\tstartPos.started = true;\n\t\t\t}\n\t\t} else {\n\t\t\tif (interval) {\n\t\t\t\tclearInterval(interval);\n\t\t\t\tinterval = null;\n\t\t\t}\n\t\t\tdefineDelayTimeout(false);\n\t\t\tstartPos.started = false;\n\t\t}\n\t}\n\n\tfunction autoscrollInterval(event) {\n\t\tvar isScroll = isScrollState();\n\n\t\tif ((interval || delayTimeout) && !isScroll) {\n\t\t\tdefineScrollInterval(false);\n\t\t}\n\n\t\tif (!gantt.config.autoscroll || !isScroll) {\n\t\t\treturn false;\n\t\t}\n\n\t\teventPos = {\n\t\t\tx: event.clientX,\n\t\t\ty: event.clientY\n\t\t};\n\n\t\t// if it is a mobile device, we need to detect the touch event coords\n\t\tif (event.type == \"touchmove\"){\n\t\t\teventPos.x = event.targetTouches[0].clientX;\n\t\t\teventPos.y = event.targetTouches[0].clientY;\n\t\t}\n\n\t\tif (!interval && isScroll) {\n\t\t\tdefineScrollInterval(true);\n\t\t}\n\t}\n\n\tfunction tick() {\n\n\t\tif (!isScrollState()) {\n\t\t\tdefineScrollInterval(false);\n\t\t\treturn false;\n\t\t}\n\n\t\tvar container = getAutoscrollContainer();\n\t\tif(!container){\n\t\t\treturn;\n\t\t}\n\t\t// GS-1150: if we reorder or resize something in the grid, we should obtain the grid container\n\t\tvar gridDrag = false;\n\t\tvar gridMarkers = [\n\t\t\t\".gantt_drag_marker.gantt_grid_resize_area\",\n\t\t\t\".gantt_drag_marker .gantt_row.gantt_row_task\",\n\t\t\t\".gantt_drag_marker.gantt_grid_dnd_marker\"\n\t\t];\n\t\tgridMarkers.forEach(function (selector) {\n\t\t\tgridDrag = gridDrag || !!document.querySelector(selector);\n\t\t});\n\t\tif (gridDrag){\n\t\t\tcontainer = gantt.$grid;\n\t\t}\n\n\t\tvar box = domHelpers.getNodePosition(container);\n\n\t\tvar posX = eventPos.x - box.x;\n\t\tvar posY = eventPos.y - box.y + window.scrollY; // GS-1315: window.scrollY here and below for the elements above Gantt\n\n\t\tvar scrollLeft = isMove ? 0 : need_scroll(posX, box.width, startPos.x - box.x);\n\t\tvar scrollTop = need_scroll(posY, box.height, startPos.y - box.y + window.scrollY);\n\n\t\tvar scrollState = gantt.getScrollState();\n\n\t\tvar currentScrollTop = scrollState.y,\n\t\t\tscrollOuterHeight = scrollState.inner_height,\n\t\t\tscrollInnerHeight = scrollState.height,\n\t\t\tcurrentScrollLeft = scrollState.x,\n\t\t\tscrollOuterWidth = scrollState.inner_width,\n\t\t\tscrollInnerWidth = scrollState.width;\n\n\t\t// do scrolling only if we have scrollable area to do so\n\t\tif (scrollTop && !scrollOuterHeight) {\n\t\t\tscrollTop = 0;\n\t\t} else if (scrollTop < 0 && !currentScrollTop) {\n\t\t\tscrollTop = 0;\n\t\t} else if (scrollTop > 0 && currentScrollTop + scrollOuterHeight >= scrollInnerHeight + 2) {\n\t\t\tscrollTop = 0;\n\t\t}\n\n\t\tif (scrollLeft && !scrollOuterWidth) {\n\t\t\tscrollLeft = 0;\n\t\t} else if (scrollLeft < 0 && !currentScrollLeft) {\n\t\t\tscrollLeft = 0;\n\t\t} else if (scrollLeft > 0 && currentScrollLeft + scrollOuterWidth >= scrollInnerWidth) {\n\t\t\tscrollLeft = 0;\n\t\t}\n\n\t\tvar step = gantt.config.autoscroll_step;\n\n\t\tif (step && step < 2) // limit step value to 2\n\t\t\tstep = 2;\n\n\t\tscrollLeft = scrollLeft * (step || scrollStep);\n\t\tscrollTop = scrollTop * (step || scrollStep);\n\n\t\tif (scrollLeft || scrollTop) {\n\t\t\tscroll(scrollLeft, scrollTop);\n\t\t}\n\t}\n\n\tfunction need_scroll(pos, boxSize, startCoord) {\n\t\tif ((pos - scrollRange < 0) && (pos < startCoord))\n\t\t\treturn -1;\n\t\telse if ((pos > boxSize - scrollRange) && (pos > startCoord))\n\t\t\treturn 1;\n\t\treturn 0;\n\t}\n\n\tfunction scroll(left, top) {\n\t\tvar scrollState = gantt.getScrollState();\n\n\t\tvar scrollLeft = null,\n\t\t\tscrollTop = null;\n\n\t\tif (left) {\n\t\t\tscrollLeft = scrollState.x + left;\n\t\t\tscrollLeft = Math.min(scrollState.width, scrollLeft);\n\t\t\tscrollLeft = Math.max(0, scrollLeft);\n\t\t}\n\n\t\tif (top) {\n\t\t\tscrollTop = scrollState.y + top;\n\t\t\tscrollTop = Math.min(scrollState.height, scrollTop);\n\t\t\tscrollTop = Math.max(0, scrollTop);\n\t\t}\n\n\t\tgantt.scrollTo(scrollLeft, scrollTop);\n\t}\n\n\tgantt.attachEvent(\"onGanttReady\", function() {\n\t\tif(!isHeadless(gantt)){\n\t\t\tvar eventElement = domHelpers.getRootNode(gantt.$root) || document.body;\n\t\t\tgantt.eventRemove(eventElement, \"mousemove\", autoscrollInterval);\n\t\t\tgantt.event(eventElement, \"mousemove\", autoscrollInterval);\n\n\t\t\tgantt.eventRemove(eventElement, \"touchmove\", autoscrollInterval);\n\t\t\tgantt.event(eventElement, \"touchmove\", autoscrollInterval);\n\n\t\t\tgantt.eventRemove(eventElement, \"pointermove\", autoscrollInterval);\n\t\t\tgantt.event(eventElement, \"pointermove\", autoscrollInterval);\n\t\t}\n\t});\n\n\tgantt.attachEvent(\"onDestroy\", function(){\n\t\tdefineScrollInterval(false);\n\t});\n\n};","if (window.jQuery){\n\n\t(function( $ ){\n\n\t\tvar methods = [];\n\t\t$.fn.dhx_gantt = function(config){\n\t\t\tconfig = config || {};\n\t\t\tif (typeof(config) === 'string') {\n\t\t\t\tif (methods[config] ) {\n\t\t\t\t\treturn methods[config].apply(this, []);\n\t\t\t\t}else {\n\t\t\t\t\t$.error('Method ' +  config + ' does not exist on jQuery.dhx_gantt');\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tvar views = [];\n\t\t\t\tthis.each(function() {\n\t\t\t\t\tif (this && this.getAttribute){\n\t\t\t\t\t\tif (!this.gantt && !(window.gantt.$root == this)){\n\n\t\t\t\t\t\t\tvar newgantt = (window.gantt.$container && window.Gantt) ? window.Gantt.getGanttInstance():window.gantt;\n\t\t\t\t\t\t\tfor (var key in config)\n\t\t\t\t\t\t\t\tif (key!=\"data\")\n\t\t\t\t\t\t\t\t\tnewgantt.config[key] = config[key];\n\n\t\t\t\t\t\t\tnewgantt.init(this);\n\t\t\t\t\t\t\tif (config.data)\n\t\t\t\t\t\t\t\tnewgantt.parse(config.data);\n\n\t\t\t\t\t\t\tviews.push(newgantt);\n\t\t\t\t\t\t} else\n\t\t\t\t\t\t\tviews.push(typeof this.gantt == \"object\" ? this.gantt : window.gantt);\n\t\t\t\t\t}\n\t\t\t\t});\n\n\n\t\t\t\tif (views.length === 1) return views[0];\n\t\t\t\treturn views;\n\t\t\t}\n\t\t};\n\n\t})(window.jQuery);\n\n}\n\n\nexport default null;","if (window.dhtmlx){\n\n\tif (!window.dhtmlx.attaches)\n\twindow.dhtmlx.attaches = {};\n\n\twindow.dhtmlx.attaches.attachGantt=function(start, end, gantt){\n\t\tvar obj = document.createElement(\"DIV\");\n\n\t\tgantt = gantt || window.gantt;\n\n\t\tobj.id = \"gantt_\"+ gantt.uid();\n\t\tobj.style.width = \"100%\";\n\t\tobj.style.height = \"100%\";\n\t\tobj.cmp = \"grid\";\n\n\t\tdocument.body.appendChild(obj);\n\t\tthis.attachObject(obj.id);\n\t\tthis.dataType = \"gantt\";\n\t\tthis.dataObj = gantt;\n\n\t\tvar that = this.vs[this.av];\n\t\tthat.grid = gantt;\n\n\t\tgantt.init(obj.id, start, end);\n\t\tobj.firstChild.style.border = \"none\";\n\n\t\tthat.gridId = obj.id;\n\t\tthat.gridObj = obj;\n\n\t\tvar method_name=\"_viewRestore\";\n\t\treturn this.vs[this[method_name]()].grid;\n\t};\n\n}\nif (typeof(window.dhtmlXCellObject) != \"undefined\") {\n\n\twindow.dhtmlXCellObject.prototype.attachGantt=function(start, end, gantt){\n\t\tgantt = gantt || window.gantt;\n\n\t\tvar obj = document.createElement(\"DIV\");\n\t\tobj.id = \"gantt_\"+gantt.uid();\n\t\tobj.style.width = \"100%\";\n\t\tobj.style.height = \"100%\";\n\t\tobj.cmp = \"grid\";\n\n\t\tdocument.body.appendChild(obj);\n\t\tthis.attachObject(obj.id);\n\n\t\tthis.dataType = \"gantt\";\n\t\tthis.dataObj = gantt;\n\n\t\tgantt.init(obj.id, start, end);\n\t\tobj.firstChild.style.border = \"none\";\n\n\t\tobj = null;\n\t\tthis.callEvent(\"_onContentAttach\",[]);\n\n\t\treturn this.dataObj;\n\t};\n}\n\nexport default null;","import env from \"../../../utils/env\";\nimport eventable from \"../../../utils/eventable\";\nimport { IScale, TModifierKeys } from \"../../common/config\";\n\ninterface ITimelineZoomConfig {\n\thandler?: (e: Event) => {};\n\tstartDate?: Date;\n\tendDate?: Date;\n\tlevels: IZoomLevel[];\n\tactiveLevelIndex?: number;\n\twidthStep?: number;\n\tminColumnWidth?: number;\n\tmaxColumnWidth?: number;\n\tuseKey?: \"ctrlKey\" | \"altKey\" | \"shiftKey\";\n\ttrigger?: \"wheel\" | null | undefined;\n\telement?: Element | (() => Element);\n}\n\nconst USE_KEY = [\"ctrlKey\", \"altKey\", \"shiftKey\", \"metaKey\"];\n\ninterface IZoomLevel {\n\tname?: string;\n\tscale_height?: number;\n\tmin_column_width: number;\n\tscales: IScale[];\n}\n\nconst _defaultScales = [\n\t[\n\t\t{\n\t\t\tunit: \"month\",\n\t\t\tdate: \"%M\",\n\t\t\tstep: 1\n\t\t},\n\t\t{\n\t\t\tunit: \"day\",\n\t\t\tdate: \"%d\",\n\t\t\tstep: 1\n\t\t}\n\t],\n\t[\n\t\t{\n\t\t\tunit: \"day\",\n\t\t\tdate: \"%d %M\",\n\t\t\tstep: 1\n\t\t}\n\t],\n\t[\n\t\t{\n\t\t\tunit: \"day\",\n\t\t\tdate: \"%d %M\",\n\t\t\tstep: 1\n\t\t},\n\t\t{\n\t\t\tunit: \"hour\",\n\t\t\tdate: \"%H:00\",\n\t\t\tstep: 8\n\t\t}\n\t],\n\t[\n\t\t{\n\t\t\tunit: \"day\",\n\t\t\tdate: \"%d %M\",\n\t\t\tstep: 1\n\t\t},\n\t\t{\n\t\t\tunit: \"hour\",\n\t\t\tdate: \"%H:00\",\n\t\t\tstep: 1\n\t\t}\n\t]\n];\n\nexport default class TimelineZoom {\n\tpublic attachEvent: (eventName: string, handler: () => void) => string;\n\tpublic callEvent: (eventName: string, args: any[]) => any;\n\tpublic detachEvent: (eventName: string) => any;\n\tprotected _initialStartDate: Date;\n\tprotected _initialEndDate: Date;\n\tprotected _activeLevelIndex: number;\n\tprotected _levels: IZoomLevel[];\n\tprotected _handler: (e: any) => void;\n\tprotected $gantt;\n\tprotected _widthStep: number;\n\tprotected _minColumnWidth: number;\n\tprotected _maxColumnWidth: number;\n\tprotected _useKey: TModifierKeys;\n\tprotected _visibleDate: Date;\n\tprotected _initialized: boolean;\n\tprotected _domEvents: any;\n\n\tconstructor(gantt) {\n\t\tthis.$gantt = gantt;\n\t\tthis._domEvents = this.$gantt._createDomEventScope();\n\t}\n\n\tpublic init(config: ITimelineZoomConfig) {\n\t\t// GS-1354 and GS-1318. If we check the headless mode using the function,\n\t\t// it will return false when Gantt is not initialized, but we may want to do it later\n\t\tif(this.$gantt.env.isNode){\n\t\t\treturn;\n\t\t}\n\t\tthis._initialStartDate = config.startDate;\n\t\tthis._initialEndDate = config.endDate;\n\t\tthis._activeLevelIndex = config.activeLevelIndex ? config.activeLevelIndex : 0;\n\t\tthis._levels = this._mapScales(config.levels || _defaultScales);\n\t\tthis._handler = config.handler || this._defaultHandler;\n\t\tthis._minColumnWidth = config.minColumnWidth || 60;\n\t\tthis._maxColumnWidth = config.maxColumnWidth || 240;\n\t\tthis._widthStep = config.widthStep || 3/8 * config.minColumnWidth;\n\t\tthis._useKey = config.useKey;\n\n\t\tif(!this._initialized){\n\t\t\teventable(this);\n\t\t\tthis.$gantt.attachEvent(\"onGanttScroll\", () => {\n\t\t\t\tthis._getVisibleDate();\n\t\t\t});\n\t\t}\n\n\t\tthis._domEvents.detachAll();\n\n\t\tif(config.trigger === \"wheel\"){\n\t\t\tif(this.$gantt.$root){\n\t\t\t\tthis._attachWheelEvent(config);\n\t\t\t}else{\n\t\t\t\tthis.$gantt.attachEvent(\"onGanttReady\", () => {\n\t\t\t\t\tthis._attachWheelEvent(config);\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\n\t\tthis._initialized = true;\n\t\tthis.setLevel(this._activeLevelIndex);\n\t}\n\n\tpublic zoomIn = () => {\n\t\tconst index = this.getCurrentLevel() - 1;\n\t\tif(index < 0){\n\t\t\treturn;\n\t\t}\n\t\tthis.setLevel(index);\n\t};\n\n\tpublic zoomOut = () => {\n\t\tconst index = this.getCurrentLevel() + 1;\n\t\tif(index > this._levels.length - 1){\n\t\t\treturn;\n\t\t}\n\t\tthis.setLevel(index);\n\t};\n\n\tpublic getCurrentLevel = () => {\n\t\treturn this._activeLevelIndex;\n\t};\n\n\tpublic getLevels = () => {\n\t\treturn this._levels;\n\t};\n\n\tpublic setLevel = (level: number|string) => {\n\t\tconst zoomLevel = this._getZoomIndexByName(level);\n\n\t\tif(zoomLevel === -1){\n\t\t\tthis.$gantt.assert(zoomLevel !== -1, \"Invalid zoom level for gantt.ext.zoom.setLevel. \" + level + \" is not an expected value.\");\n\t\t}\n\t\tthis._setLevel(zoomLevel, 0);\n\t};\n\n\tprotected _getZoomIndexByName = (levelName: number|string) => {\n\t\tlet zoomLevel:number = -1;\n\t\tif(typeof levelName === \"string\"){\n\t\t\tif(!isNaN(Number(levelName)) &&  this._levels[Number(levelName)]){\n\t\t\t\tzoomLevel = Number(levelName);\n\t\t\t}else{\n\t\t\t\tfor(let i = 0; i < this._levels.length; i++){\n\t\t\t\t\tif(this._levels[i].name === levelName){\n\t\t\t\t\t\tzoomLevel = i;\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}else{\n\t\t\tzoomLevel = levelName;\n\t\t}\n\t\treturn zoomLevel;\n\t};\n\n\tprotected _mapScales(levels: IScale[][] | any): IZoomLevel[]{\n\t\treturn levels.map((l) => {\n\t\t\tif(Array.isArray(l)){\n\t\t\t\treturn {\n\t\t\t\t\tscales: l\n\t\t\t\t};\n\t\t\t}else{\n\t\t\t\treturn l;\n\t\t\t}\n\t\t});\n\t}\n\n\tprotected _getVisibleDate = () => {\n\t\t// GS-1450. Don't try to get the visible date if there is no timeline\n\t\tif (!this.$gantt.$task){\n\t\t\treturn null;\n\t\t}\n\t\tconst scrollPos = this.$gantt.getScrollState().x;\n\t\tconst viewPort = this.$gantt.$task.offsetWidth;\n\t\tthis._visibleDate = this.$gantt.dateFromPos(scrollPos + viewPort/2);\n\t};\n\n\tprotected _setLevel = (level: number, cursorOffset: number) => {\n\t\tthis._activeLevelIndex = level;\n\n\t\tconst gantt = this.$gantt;\n\t\tconst nextConfig = gantt.copy(this._levels[this._activeLevelIndex]);\n\t\tconst chartConfig = gantt.copy(nextConfig);\n\t\tdelete chartConfig.name;\n\n\t\tgantt.mixin(gantt.config, chartConfig, true);\n\n\t\t// GS-1148: Change scales for the resource views\n\t\tconst resourceViews = [\n\t\t\t\"resourceTimeline\",\n\t\t\t\"resourceHistogram\"\n\t\t];\n\n\t\tresourceViews.forEach(function(name){\n\t\t\tconst resourceView = gantt.$ui.getView(name);\n\t\t\tif (resourceView){\n\t\t\t\tconst resourceConfig = resourceView.$getConfig();\n\t\t\t\tif (!resourceConfig.fixed_scales){\n\t\t\t\t\tgantt.mixin(resourceConfig, chartConfig, true);\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n\t\tconst isRendered = !!gantt.$root && !!gantt.$task;\n\n\t\tif(isRendered){\n\t\t\tif(cursorOffset){\n\t\t\t\tconst cursorDate = this.$gantt.dateFromPos(cursorOffset + this.$gantt.getScrollState().x);\n\t\t\t\tthis.$gantt.render();\n\t\t\t\tconst newPosition = this.$gantt.posFromDate(cursorDate);\n\t\t\t\tthis.$gantt.scrollTo(newPosition - cursorOffset);\n\t\t\t}else{\n\t\t\t\tconst viewPort = this.$gantt.$task.offsetWidth;\n\t\t\t\tif(!this._visibleDate){\n\t\t\t\t\tthis._getVisibleDate();\n\t\t\t\t}\n\t\t\t\tconst middleDate = this._visibleDate;\n\t\t\t\tthis.$gantt.render();\n\t\t\t\tconst newPosition = this.$gantt.posFromDate(middleDate);\n\t\t\t\tthis.$gantt.scrollTo(newPosition - viewPort/2);\n\t\t\t}\n\n\t\t\tthis.callEvent(\"onAfterZoom\", [this._activeLevelIndex, nextConfig]);\n\t\t}\n\t};\n\n\tprivate _attachWheelEvent = (config) => {\n\t\tconst event = env.isFF ? \"wheel\" : \"mousewheel\";\n\t\tlet el: Element;\n\t\tif(typeof config.element === \"function\"){\n\t\t\tel = config.element();\n\t\t}else{\n\t\t\tel = config.element as Element;\n\t\t}\n\t\tif (!el){\n\t\t\treturn;\n\t\t}\n\n\t\tthis._domEvents.attach(el, event, this.$gantt.bind(function(e) {\n\t\t\tif (this._useKey) {\n\t\t\t\tif (USE_KEY.indexOf(this._useKey) < 0) {\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\t\t\t\tif (!e[this._useKey]) {\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (typeof this._handler === \"function\") {\n\t\t\t\tthis._handler.apply(this, [e]);\n\t\t\t\treturn true;\n\t\t\t}\n\t\t}, this), {passive: false});\n\t};\n\n\tprivate _defaultHandler = (e: any):void => {\n\t\tconst timelineOffset = this.$gantt.$task.getBoundingClientRect().x;\n\t\tconst cursorOffset = e.clientX - timelineOffset;\n\t\tconst wheelY = this.$gantt.env.isFF ? (e.deltaY*-40) : e.wheelDelta;\n\t\tlet wheelUp = false;\n\t\tif (wheelY > 0) {\n\t\t\twheelUp = true;\n\t\t}\n\t\te.preventDefault();\n\t\te.stopPropagation();\n\t\tthis._setScaleSettings(wheelUp, cursorOffset);\n\t};\n\n\tprivate _setScaleSettings(wheelUp: boolean, cursorOffset: number) {\n\t\tif (wheelUp) {\n\t\t\tthis._stepUp(cursorOffset);\n\t\t} else {\n\t\t\tthis._stepDown(cursorOffset);\n\t\t}\n\t}\n\n\tprivate _setScaleDates = () => {\n\t\tif(this._initialStartDate && this._initialEndDate){\n\t\t\tthis.$gantt.config.start_date = this._initialStartDate;\n\t\t\tthis.$gantt.config.end_date = this._initialEndDate;\n\t\t}\n\t};\n\n\tprivate _stepUp(cursorOffset) {\n\t\tif (this._activeLevelIndex >= this._levels.length - 1) {\n\t\t\treturn;\n\t\t}\n\n\t\tlet nextLevel = this._activeLevelIndex;\n\t\tthis._setScaleDates();\n\n\t\tif(this._widthStep){\n\t\t\tlet newColumnWidth = this.$gantt.config.min_column_width + this._widthStep;\n\t\t\tif (newColumnWidth > this._maxColumnWidth) {\n\t\t\t\tnewColumnWidth = this._minColumnWidth;\n\t\t\t\tnextLevel++;\n\t\t\t}\n\n\t\t\tthis.$gantt.config.min_column_width = newColumnWidth;\n\t\t}else{\n\t\t\tnextLevel++;\n\t\t}\n\t\tthis._setLevel(nextLevel, cursorOffset);\n\t}\n\tprivate _stepDown(cursorOffset) {\n\t\tif (this._activeLevelIndex < 1) {\n\t\t\treturn;\n\t\t}\n\n\t\tlet nextLevel = this._activeLevelIndex;\n\t\tthis._setScaleDates();\n\n\t\tif(this._widthStep){\n\t\t\tlet newColumnWidth = this.$gantt.config.min_column_width - this._widthStep;\n\t\t\tif (newColumnWidth < this._minColumnWidth) {\n\t\t\t\tnewColumnWidth = this._maxColumnWidth;\n\t\t\t\tnextLevel--;\n\t\t\t}\n\t\t\tthis.$gantt.config.min_column_width = newColumnWidth;\n\t\t}else{\n\t\t\tnextLevel--;\n\t\t}\n\t\tthis._setLevel(nextLevel, cursorOffset);\n\t}\n}","export default function(gantt) {\n\n\tgantt.config.touch_drag = 75; //nearly immediate dnd\n\tgantt.config.touch = true;\n\tgantt.config.touch_feedback = true;\n\tgantt.config.touch_feedback_duration = 1;\n\tgantt._prevent_touch_scroll = false;\n\n\n\tgantt._touch_feedback = function () {\n\t\tif (gantt.config.touch_feedback) {\n\t\t\tif (navigator.vibrate)\n\t\t\t\tnavigator.vibrate(gantt.config.touch_feedback_duration);\n\t\t}\n\t};\n\n\tgantt.attachEvent(\"onGanttReady\", function(){\n\t\tif (gantt.$container)\t{\n\t\t\taddTouchEvents();\n\t\t}\n\t});\n\tgantt.attachEvent(\"onGanttLayoutReady\", function(){\n\t\tif (gantt.$container)\t{\n\t\t\t\tgantt.attachEvent(\"onGanttRender\", addTouchEvents, {once: true});\n\t\t}\n\t});\n\n\tfunction addTouchEvents(){\n\t\tif (gantt.config.touch != \"force\")\n\t\t\tgantt.config.touch = gantt.config.touch &&\n\t\t\t\t((navigator.userAgent.indexOf(\"Mobile\") != -1) ||\n\t\t\t\t\t(navigator.userAgent.indexOf(\"iPad\") != -1) ||\n\t\t\t\t\t(navigator.userAgent.indexOf(\"Android\") != -1) ||\n\t\t\t\t\t(navigator.userAgent.indexOf(\"Touch\") != -1)) ||\n\t\t\t\t\t((navigator.platform === 'MacIntel' && navigator.maxTouchPoints > 1));\n\n\t\tif (gantt.config.touch) {\n\n\t\t\tvar touchEventsSupported = true;\n\t\t\ttry {\n\t\t\t\tdocument.createEvent(\"TouchEvent\");\n\t\t\t} catch (e) {\n\t\t\t\ttouchEventsSupported = false;\n\t\t\t}\n\n\t\t\tif (touchEventsSupported) {\n\t\t\t\tgantt._touch_events([\"touchmove\", \"touchstart\", \"touchend\"], function (ev) {\n\t\t\t\t\tif (ev.touches && ev.touches.length > 1) return null;\n\t\t\t\t\tif (ev.touches[0])\n\t\t\t\t\t\treturn {\n\t\t\t\t\t\t\ttarget: ev.target,\n\t\t\t\t\t\t\tpageX: ev.touches[0].pageX,\n\t\t\t\t\t\t\tpageY: ev.touches[0].pageY,\n\t\t\t\t\t\t\tclientX: ev.touches[0].clientX,\n\t\t\t\t\t\t\tclientY: ev.touches[0].clientY\n\t\t\t\t\t\t};\n\t\t\t\t\telse\n\t\t\t\t\t\treturn ev;\n\t\t\t\t}, function () {\n\t\t\t\t\treturn false;\n\t\t\t\t});\n\t\t\t} else if (window.navigator.pointerEnabled) {\n\t\t\t\tgantt._touch_events([\"pointermove\", \"pointerdown\", \"pointerup\"], function (ev) {\n\t\t\t\t\tif (ev.pointerType == \"mouse\") return null;\n\t\t\t\t\treturn ev;\n\t\t\t\t}, function (ev) {\n\t\t\t\t\treturn (!ev || (ev.pointerType == \"mouse\" ));\n\t\t\t\t});\n\t\t\t} else if (window.navigator.msPointerEnabled) {\n\t\t\t\tgantt._touch_events([\"MSPointerMove\", \"MSPointerDown\", \"MSPointerUp\"], function (ev) {\n\t\t\t\t\tif (ev.pointerType == ev.MSPOINTER_TYPE_MOUSE) return null;\n\t\t\t\t\treturn ev;\n\t\t\t\t}, function (ev) {\n\t\t\t\t\treturn (!ev || ev.pointerType == ev.MSPOINTER_TYPE_MOUSE);\n\t\t\t\t});\n\t\t\t}\n\n\t\t}\n\t}\n\n\n\tfunction findTargetView(event){\n\t\tvar allViews = gantt.$layout.getCellsByType(\"viewCell\");\n\n\t\tfor(var i = 0; i < allViews.length; i++){\n\t\t\tvar box = allViews[i].$view.getBoundingClientRect();\n\t\t\tif(event.clientX >= box.left && event.clientX <= box.right &&\n\t\t\t\tevent.clientY <= box.bottom && event.clientY >= box.top){\n\t\t\t\t\treturn allViews[i];\n\t\t\t\t}\n\t\t}\n\t}\n\n\tfunction getScrollState(view){\n\t\tvar scrollX = view.$config.scrollX ? gantt.$ui.getView(view.$config.scrollX) : null;\n\t\tvar scrollY = view.$config.scrollY ? gantt.$ui.getView(view.$config.scrollY) : null;\n\n\t\tvar scrollState = {x: null, y: null};\n\t\tif(scrollX){\n\t\t\tvar state = scrollX.getScrollState();\n\t\t\tif(state.visible){\n\t\t\t\tscrollState.x = scrollX.$view.scrollLeft;\n\t\t\t}\n\t\t}\n\t\tif(scrollY){\n\t\t\tvar state = scrollY.getScrollState();\n\t\t\tif(state.visible){\n\t\t\t\tscrollState.y = scrollY.$view.scrollTop;\n\t\t\t}\n\t\t}\n\t\treturn scrollState;\n\t}\n\n\tfunction scrollView(view, left, top){\n\t\tvar scrollX = view.$config.scrollX ? gantt.$ui.getView(view.$config.scrollX) : null;\n\t\tvar scrollY = view.$config.scrollY ? gantt.$ui.getView(view.$config.scrollY) : null;\n\n\t\tif(scrollX){\n\t\t\tscrollX.scrollTo(left, null);\n\t\t}\n\t\tif(scrollY){\n\t\t\tscrollY.scrollTo(null, top);\n\t\t}\n\t}\n\n\tfunction getTaskDND(){\n\t\tvar tasksDnD;\n\t\tif(gantt.$ui.getView(\"timeline\")){\n\t\t\ttasksDnD = gantt.$ui.getView(\"timeline\")._tasks_dnd;\n\t\t}\n\t\treturn tasksDnD;\n\t}\n\n\tvar touchHandlers = [];\n\n//we can't use native scrolling, as we need to sync momentum between different parts\n//so we will block native scroll and use the custom one\n//in future we can add custom momentum\n\tgantt._touch_events = function (names, accessor, ignore) {\n\t\t//webkit on android need to be handled separately\n\t\tvar dblclicktime = 0;\n\t\tvar actionMode = false;\n\t\tvar scrollMode = false;\n\t\tvar actionStart = null;\n\t\tvar scrollState;\n\t\tvar longTapTimer = null;\n\t\tvar currentDndId = null;\n\t\tvar dndNodes = [];\n\t\tvar targetView = null;\n\t\tlet multiTouchEvents = {};\n\n\t\tfor(var i = 0; i < touchHandlers.length; i++){\n\t\t\tgantt.eventRemove(touchHandlers[i][0], touchHandlers[i][1], touchHandlers[i][2]);\n\t\t}\n\t\ttouchHandlers = [];\n\n\t\t//touch move\n\t\ttouchHandlers.push([gantt.$container, names[0], function (e) {\n\t\t\tvar tasksDnD = getTaskDND();\n\n\t\t\t\tif (ignore(e)) return;\n\n\t\t\t\t//ignore common and scrolling moves\n\t\t\t\tif (!actionMode) return;\n\n\t\t\t\tif (longTapTimer) clearTimeout(longTapTimer);\n\n\t\t\t\tvar source = accessor(e);\n\t\t\t\tif (tasksDnD && (tasksDnD.drag.id || tasksDnD.drag.start_drag)) {\n\t\t\t\t\ttasksDnD.on_mouse_move(source);\n\t\t\t\t\tif (e.preventDefault)\n\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\te.cancelBubble = true;\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\t\t\t\tif (!gantt._prevent_touch_scroll) {\n\t\t\t\t\tif (source && actionStart) {\n\t\t\t\t\t\tvar dx = actionStart.pageX - source.pageX;\n\t\t\t\t\t\tvar dy = actionStart.pageY - source.pageY;\n\t\t\t\t\t\tif (!scrollMode && (Math.abs(dx) > 5 || Math.abs(dy) > 5)) {\n\t\t\t\t\t\t\tscrollMode = true;\n\t\t\t\t\t\t\t//gantt._touch_scroll_active = scroll_mode = true;\n\t\t\t\t\t\t\tdblclicktime = 0;\n\n\t\t\t\t\t\t\tif(targetView){\n\t\t\t\t\t\t\t\tscrollState = getScrollState(targetView);\n\t\t\t\t\t\t\t}else{\n\t\t\t\t\t\t\t\tscrollState = gantt.getScrollState();\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (scrollMode) {\n\n\t\t\t\t\t\t\tvar newScrollState;\n\t\t\t\t\t\t\tvar scrollX = scrollState.x + dx;\n\t\t\t\t\t\t\tvar scrollY = scrollState.y + dy;\n\t\t\t\t\t\t\tif(targetView){\n\t\t\t\t\t\t\t\tscrollView(targetView, scrollX, scrollY);\n\t\t\t\t\t\t\t\tnewScrollState = getScrollState(targetView);\n\t\t\t\t\t\t\t}else{\n\t\t\t\t\t\t\t\tgantt.scrollTo(scrollX, scrollY);\n\t\t\t\t\t\t\t\tnewScrollState = gantt.getScrollState();\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tif ((scrollState.x != newScrollState.x && dy > 2 * dx) ||\n\t\t\t\t\t\t\t\t(scrollState.y != newScrollState.y && dx > 2 * dy )) {\n\t\t\t\t\t\t\t\treturn block_action(e);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\treturn block_action(e);\n\t\t\t\t}\n\t\t\t\treturn true;\n\t\t\t}]);\n\n\t\t// prevent page drag on touch move\n\t\ttry{\n\t\t\tdocument.addEventListener('touchmove', function(e) {\n\t\t\t\tif (gantt._touch_drag) {\n\t\t\t\t\tblock_action(e);\n\t\t\t\t}\n\t\t\t}, { passive: false });\n\t\t}\n\t\tcatch(e){\n\t\t\t// eslint-disable-next-line no-console\n\t\t\tconsole.warn(\"Cannot prevent touch event for the page drag\");\n\t\t}\n\n\t\t//block touch context menu in IE10\n\t\ttouchHandlers.push([this.$container, \"contextmenu\", function (e) {\n\t\t\tif (actionMode)\n\t\t\t\treturn block_action(e);\n\t\t}]);\n\n\t\t//touch start\n\t\ttouchHandlers.push([this.$container, names[1], function (e) {\n\t\t\tmultiTouchEvents = e.touches.length;\n\t\t\t// block pull-to-refresh\n\t\t\tif(document && document.body){\n\t\t\t\tdocument.body.classList.add(\"gantt_touch_active\");\n\t\t\t}\n\n\t\t\tif (ignore(e)) return;\n\t\t\tif (e.touches && e.touches.length > 1) {\n\t\t\t\tactionMode = false;\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tactionStart = accessor(e);\n\t\t\ttargetView = findTargetView(actionStart);\n\t\t\tif (!gantt._locate_css(actionStart, \"gantt_hor_scroll\") && !gantt._locate_css(actionStart, \"gantt_ver_scroll\")) {\n\t\t\t\tactionMode = true;\n\t\t\t}\n\t\t\tvar tasksDnD = getTaskDND();\n\n\t\t\t//long tap\n\t\t\tlongTapTimer = setTimeout(function () {\n\t\t\t\tvar taskId = gantt.locate(actionStart);\n\t\t\t\tif (tasksDnD && (taskId && !gantt._locate_css(actionStart, \"gantt_link_control\") && !gantt._locate_css(actionStart, \"gantt_grid_data\"))) {\n\t\t\t\t\ttasksDnD.on_mouse_down(actionStart);\n\n\t\t\t\t\tif (tasksDnD.drag && tasksDnD.drag.start_drag) {\n\t\t\t\t\t\t// we need that as touch events break if the target node is removed from the DOM\n\t\t\t\t\t\tcloneTaskRendered(taskId);\n\t\t\t\t\t\ttasksDnD._start_dnd(actionStart);\n\t\t\t\t\t\tgantt._touch_drag = true;\n\n\t\t\t\t\t\tgantt.refreshTask(taskId);\n\n\t\t\t\t\t\tgantt._touch_feedback();\n\t\t\t\t\t}\n\n\t\t\t\t}\n\n\t\t\t\tlongTapTimer = null;\n\t\t\t}, gantt.config.touch_drag);\n\t\t}]);\n\n\t\t//touch end\n\t\ttouchHandlers.push([this.$container, names[2], function (e) {\n\t\t\tif(document && document.body){\n\t\t\t\tdocument.body.classList.remove(\"gantt_touch_active\");\n\t\t\t}\n\t\t\tif (ignore(e)) return;\n\t\t\tif (longTapTimer) clearTimeout(longTapTimer);\n\t\t\tgantt._touch_drag = false;\n\t\t\tactionMode = false;\n\t\t\tvar source = accessor(e);\n\n\t\t\tvar tasksDnD = getTaskDND();\n\n\t\t\tif(tasksDnD)\n\t\t\t\ttasksDnD.on_mouse_up(source);\n\n\t\t\tif (currentDndId && gantt.isTaskExists(currentDndId)) {\n\t\t\t\tgantt.refreshTask(currentDndId);\n\t\t\t\tif(dndNodes.length){\n\t\t\t\t\tdndNodes.forEach(function(node){\n\t\t\t\t\t\tif(node.parentNode){\n\t\t\t\t\t\t\tnode.parentNode.removeChild(node);\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t\tgantt._touch_feedback();\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t//gantt._touch_scroll_active = action_mode = scroll_mode = false;\n\t\t\tactionMode = scrollMode = false;\n\t\t\tdndNodes = [];\n\t\t\tcurrentDndId = null;\n\n\t\t\t//dbl-tap handling\n\t\t\tif (actionStart && dblclicktime) {\n\t\t\t\tvar now = new Date();\n\t\t\t\t// doubletap shouldn't happen with multitouch\n\t\t\t\tif ((now - dblclicktime) < 500 && multiTouchEvents <= 1) {\n\n\t\t\t\t\tvar mouseEvents = gantt.$services.getService(\"mouseEvents\");\n\t\t\t\t\tmouseEvents.onDoubleClick(actionStart);\n\t\t\t\t\tblock_action(e);\n\t\t\t\t} else\n\t\t\t\t\tdblclicktime = now;\n\t\t\t} else {\n\t\t\t\tdblclicktime = new Date();\n\t\t\t}\n\t\t}]);\n\n\t\tfor(var i = 0; i < touchHandlers.length; i++){\n\t\t\tgantt.event(touchHandlers[i][0], touchHandlers[i][1], touchHandlers[i][2]);\n\t\t}\n\n\t\t//common helper, prevents event\n\t\tfunction block_action(e) {\n\t\t\tif (e && e.preventDefault && e.cancelable){\n\t\t\t\te.preventDefault();\n\t\t\t}\n\t\t\te.cancelBubble = true;\n\t\t\treturn false;\n\t\t}\n\n\t\tfunction cloneTaskRendered(taskId) {\n\t\t\tconst renders = gantt._getTaskLayers();\n\t\t\tlet task = gantt.getTask(taskId);\n\t\t\tif (task) {\n\t\t\t\tlet visible = gantt.isTaskVisible(taskId);\n\t\t\t\tif (visible){\n\t\t\t\t\tcurrentDndId = taskId;\n\t\t\t\t\tfor (let i = 0; i < renders.length; i++) {\n\t\t\t\t\t\ttask = renders[i].rendered[taskId];\n\t\t\t\t\t\tif (task && task.getAttribute(gantt.config.task_attribute) && task.getAttribute(gantt.config.task_attribute) == taskId) {\n\t\t\t\t\t\t\tconst copy = task.cloneNode(true);\n\t\t\t\t\t\t\tdndNodes.push(task);\n\t\t\t\t\t\t\trenders[i].rendered[taskId] = copy;\n\t\t\t\t\t\t\ttask.style.display = \"none\";\n\t\t\t\t\t\t\tcopy.className += \" gantt_drag_move \";\n\t\t\t\t\t\t\ttask.parentNode.appendChild(copy);\n\t\t\t\t\t\t\t//return copy;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t} else if (task.$split_subtask){\n\t\t\t\t\tlet renderedParent = task.$rendered_parent;\n\t\t\t\t\tvisible = gantt.isTaskVisible(renderedParent);\n\t\t\t\t\tif (!visible){\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t\tcurrentDndId = taskId;\n\t\t\t\t\tfor (let i = 0; i < renders.length; i++) {\n\t\t\t\t\t\tconst parent = renders[i].rendered[renderedParent];\n\t\t\t\t\t\tlet taskNode;\n\t\t\t\t\t\tif (parent && parent.childNodes){\n\t\t\t\t\t\t\ttaskNode = parent.querySelector(`[${gantt.config.task_attribute}=\"${task.id}\"]`);\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (taskNode) {\n\t\t\t\t\t\t\t// move the child node to a different parent as the task bar will be repainted\n\t\t\t\t\t\t\t// and the initial node will be lost\n\t\t\t\t\t\t\tconst copy = taskNode.cloneNode(true);\n\t\t\t\t\t\t\ttaskNode.parentNode.appendChild(copy);\n\n\t\t\t\t\t\t\tgantt.$task_bars.appendChild(taskNode);\n\t\t\t\t\t\t\ttaskNode.style.display = \"none\";\n\n\t\t\t\t\t\t\t// don't add the node as rendered otherwise it will be lost:\n\t\t\t\t\t\t\t// renders[i].rendered[taskId] = taskNode;\n\t\t\t\t\t\t\t// instead, add it to dndNodes as its elements will be removed after drag\n\t\t\t\t\t\t\tdndNodes.push(taskNode);\n\n\t\t\t\t\t\t\ttaskNode = null;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t};\n\n};","function dummy() {\n\t// eslint-disable-next-line\n\tconsole.log(\"Method is not implemented.\"); \n}\nfunction BaseControl() {\n}\n\n// base methods will be runned in gantt context\nBaseControl.prototype.render = dummy; // arguments: sns\nBaseControl.prototype.set_value = dummy; // arguments: node, value, ev, sns(config)\nBaseControl.prototype.get_value = dummy; // arguments node, ev, sns(config)\nBaseControl.prototype.focus = dummy; // arguments: node\n\nexport default function(gantt) { // we could send current instance of gantt to module\n\treturn BaseControl;\n};","import * as helpers from \"../../../utils/helpers\";\n\nvar htmlHelpers = {\n\tgetHtmlSelect: function(options, attributes, value) {\n\t\tvar innerHTML = \"\";\n\t\tvar _this = this;\n\n\t\toptions = options || [];\n\t\t\n\t\thelpers.forEach(options, function(entry) {\n\t\t\tvar _attributes = [{ key: \"value\", value: entry.key }];\n\n\t\t\tif (value == entry.key) {\n\t\t\t\t_attributes[_attributes.length] = { key: \"selected\", value: \"selected\" };\n\t\t\t}\n\t\t\tif (entry.attributes) {\n\t\t\t\t_attributes = _attributes.concat(entry.attributes);\n\t\t\t}\n\t\t\tinnerHTML += _this.getHtmlOption({ innerHTML: entry.label }, _attributes);\n\t\t});\n\n\t\treturn _getHtmlContainer(\"select\", { innerHTML: innerHTML }, attributes);\n\t},\n\tgetHtmlOption: function(options, attributes) { return _getHtmlContainer(\"option\", options, attributes); },\n\tgetHtmlButton: function(options, attributes) { return _getHtmlContainer(\"button\", options, attributes); },\n\tgetHtmlDiv: function(options, attributes) { return _getHtmlContainer(\"div\", options, attributes); },\n\tgetHtmlLabel: function(options, attributes) { return _getHtmlContainer(\"label\", options, attributes); },\n\tgetHtmlInput: function(attributes) {\n\t\treturn \"<input\" + _getHtmlAttributes(attributes || []) + \">\";\n\t}\n};\n\nfunction _getHtmlContainer(tag, options, attributes) {\n\tvar html;\n\n\toptions = options || [];\n\t\n\thtml = \"<\" + tag + _getHtmlAttributes(attributes || []) + \">\" + (options.innerHTML || \"\") + \"</\" + tag +\">\";\n\treturn html;\n\n}\n\nfunction _getHtmlAttributes(attributes) {\n\tvar html = \"\";\n\n\thelpers.forEach(attributes, function(entry) {\n\t\thtml += \" \" + entry.key + \"='\" + entry.value + \"'\";\n\t});\n\treturn html;\n}\n\nexport default htmlHelpers;","import __extends from \"../../../../utils/extends\";\nimport htmlHelpers from \"../../utils/html_helpers\";\n\nimport Super from \"./base_control\";\n\nexport default function(gantt) {\n\tconst _super = Super(gantt);\n\n\tfunction SelectControl() {\n\t\tvar self = _super.apply(this, arguments) || this;\n\t\n\t\treturn self; \n\t}\n\t\n\t__extends(SelectControl, _super);\n\t\n\tSelectControl.prototype.render = function(sns) {\n\t\tconst height = sns.height ? `height:${sns.height}px;` : '';\n\t\tlet html = `<div class='gantt_cal_ltext gantt_section_${sns.name}' ${height ? `style='${height}'` : ''}>`;\n\n\t\thtml += htmlHelpers.getHtmlSelect(sns.options, [{ key: \"style\", value: \"width:100%;\" }, { key: \"title\", value: sns.name }]);\n\t\thtml += \"</div>\";\n\t\treturn html;\n\t};\n\n\tSelectControl.prototype.set_value = function(node, value, ev, sns) {\n\t\tvar select = node.firstChild;\n\t\tif (!select._dhx_onchange && sns.onchange) {\n\t\t\tselect.onchange = sns.onchange;\n\t\t\tselect._dhx_onchange = true;\n\t\t}\n\t\tif (typeof value === \"undefined\")\n\t\t\tvalue = (select.options[0] || {}).value;\n\t\tselect.value = value || \"\";\n\t};\n\t\n\tSelectControl.prototype.get_value = function(node) {\n\t\treturn node.firstChild.value;\n\t};\n\t\n\tSelectControl.prototype.focus = function(node) {\n\t\tvar a = node.firstChild;\n\t\tgantt._focus(a, true);\n\t};\n\t\n\treturn SelectControl;\n};","import __extends from \"../../../../utils/extends\";\nimport SelectControl from \"./select_control\";\nexport default function(gantt) {\n\tvar _super = SelectControl(gantt);\n\n\tfunction ParentControl() {\n\t\tvar self = _super.apply(this, arguments) || this; \n\n\t\treturn self; \n\t}\n\n\t__extends(ParentControl, _super);\n\n\n\tParentControl.prototype.render = function(sns) {\n\t\treturn _display(sns, false);\n\t};\n\n\tParentControl.prototype.set_value = function(node, value, ev, config) {\n\t\t// GS-1051. If the value is `0`, the set_value function in the select control won't select \n\t\t// the first child because (0 || '') = '';\n\t\tif (value === 0) value = \"0\";\n\n\t\tvar tmpDom = document.createElement(\"div\");\n\t\ttmpDom.innerHTML = _display(config, ev.id);\n\t\tvar newOptions = tmpDom.removeChild(tmpDom.firstChild);\n\t\tnode.onselect = null;\n\t\tnode.parentNode.replaceChild(newOptions, node);\n\n\t\treturn gantt.form_blocks.select.set_value.apply(gantt, [newOptions, value, ev, config]);\n\t};\n\n\tfunction _display(config, item_id) {\n\t\tvar tasks = [],\n\t\t\toptions = [];\n\t\tif (item_id) {\n\t\t\ttasks = gantt.getTaskByTime();\n\t\t\tif (config.allow_root) {\n\t\t\t\ttasks.unshift({id: gantt.config.root_id, text: config.root_label || \"\"});\n\t\t\t}\n\t\t\ttasks = _filter(tasks, config, item_id);\n\t\t\tif (config.sort) {\n\t\t\t\ttasks.sort(config.sort);\n\t\t\t}\n\t\t}\n\t\tvar text = config.template || gantt.templates.task_text;\n\t\tfor (var i = 0; i < tasks.length; i++) {\n\t\t\tvar label = text.apply(gantt, [tasks[i].start_date, tasks[i].end_date, tasks[i]]);\n\t\t\tif (label === undefined) {\n\t\t\t\tlabel = \"\";\n\t\t\t}\n\t\t\toptions.push({\n\t\t\t\tkey: tasks[i].id,\n\t\t\t\tlabel: label\n\t\t\t});\n\t\t}\n\t\tconfig.options = options;\n\t\tconfig.map_to = config.map_to || \"parent\";\n\t\treturn gantt.form_blocks.select.render.apply(this, arguments);\n\t}\n\n\tfunction _filter(options, config, item_id) {\n\t\tvar filter = config.filter || function() {\n\t\t\treturn true;\n\t\t};\n\n\t\toptions = options.slice(0);\n\n\t\tfor (var i = 0; i < options.length; i++) {\n\t\t\tvar task = options[i];\n\t\t\tif (task.id == item_id || gantt.isChildOf(task.id, item_id) || filter(task.id, task) === false) {\n\t\t\t\toptions.splice(i, 1);\n\t\t\t\ti--;\n\t\t\t}\n\t\t}\n\t\treturn options;\n\t}\n\treturn ParentControl;\n};","import TemplateControlConstructor from \"./controls/template_control\";\nimport TextareaControlConstructor from \"./controls/textarea_control\";\nimport TimeControlConstructor from \"./controls/time_control\";\nimport SelectControlConstructor from \"./controls/select_control\";\nimport CheckboxControlConstructor from \"./controls/checkbox_control\";\nimport RadioControlConstructor from \"./controls/radio_control\";\nimport DurationControlConstructor from \"./controls/duration_control\";\nimport ParentControlConstructor from \"./controls/parent_control\";\nimport ResourcesControlConstructor from \"./controls/resources_control\";\nimport ConstraintControlConstructor from \"./controls/constraint_control\";\nimport TypeselectControlConstructor from \"./controls/typeselect_control\";\nimport BaselineControlConstructor from \"./controls/baseline_control\";\n\nimport * as domHelpers from \"../utils/dom_helpers\";\nimport * as helpers from \"../../../utils/helpers\";\n\t\n\nexport default function (gantt) {\n\n\n\tvar TemplateControl = TemplateControlConstructor(gantt);\n\tvar TextareaControl = TextareaControlConstructor(gantt);\n\tvar TimeControl = TimeControlConstructor(gantt);\n\tvar SelectControl = SelectControlConstructor(gantt);\n\tvar CheckboxControl = CheckboxControlConstructor(gantt);\n\tvar RadioControl = RadioControlConstructor(gantt);\n\tvar DurationControl = DurationControlConstructor(gantt);\n\tvar ParentControl = ParentControlConstructor(gantt);\n\tvar ResourcesControl = ResourcesControlConstructor(gantt);\n\tvar ConstraintControl = ConstraintControlConstructor(gantt);\n\tvar TypeselectControl = TypeselectControlConstructor(gantt);\n\tvar BaselineControl = BaselineControlConstructor(gantt);\n\n\tgantt._lightbox_methods = {};\n\tgantt._lightbox_template = \"<div class='gantt_cal_ltitle'><span class='gantt_mark'>&nbsp;</span><span class='gantt_time'></span><span class='gantt_title'></span></div><div class='gantt_cal_larea'></div>\";\n\tgantt._lightbox_template = `<div class='gantt_cal_ltitle'><div class=\"dhx_cal_ltitle_descr\"><span class='gantt_mark'>&nbsp;</span><span class='gantt_time'></span><span class='dhx_title'></span>\n</div>\n<div class=\"gantt_cal_ltitle_controls\">\n\t<a class=\"gantt_cal_ltitle_close_btn dhx_gantt_icon dhx_gantt_icon_close\"></a>\n\n</div></div><div class='gantt_cal_larea'></div>`;\n\n\t// GS-1952. Attaching the lightbox to the BODY element is not considered secure.\n\t// Attach it to Gantt container for Salesforce and other secure environments\n\tgantt._lightbox_root = gantt.$root;\n\tfunction setParentNode() {\n\t\tconst cspEnvironment = gantt.config.csp === true;\n\t\tconst salesforceEnvironment = !!window[\"Sfdc\"] || !!window[\"$A\"] || window[\"Aura\"] || ('$shadowResolver$' in document.body);\n\t\tif (cspEnvironment || salesforceEnvironment) {\n\t\t\tgantt._lightbox_root = gantt.$root;\n\t\t} else {\n\t\t\tgantt._lightbox_root = document.body;\n\t\t}\n\t}\n\n\t//TODO: gantt._lightbox_id is changed from data.js and accessed from autoscheduling, check if it can be removed from gantt object\n\tvar state = gantt.$services.getService(\"state\");\n\tstate.registerProvider(\"lightbox\", function () {\n\t\treturn {\n\t\t\tlightbox: gantt._lightbox_id\n\t\t};\n\t});\n\n\tgantt.showLightbox = function (id) {\n\t\tvar task = this.getTask(id);\n\t\tif (!this.callEvent(\"onBeforeLightbox\", [id])) {\n\t\t\tif(gantt.isTaskExists(id) && gantt.getTask(id).$new){\n\t\t\t\t//GS-2340 if 'onBeforeLightbox' returns 'false' need update the order in datastore\n\t\t\t\tthis.$data.tasksStore._updateOrder();\n\t\t\t}\n\t\t\treturn;\n\t\t}\n\n\t\tvar box = this.getLightbox(this.getTaskType(task.type));\n\n\t\tthis.showCover(box);\n\t\tthis._fill_lightbox(id, box);\n\t\tthis._setLbPosition(box);\n\t\tthis._waiAria.lightboxVisibleAttr(box);\n\n\t\tthis.callEvent(\"onLightbox\", [id]);\n\t};\n\n\tfunction _is_chart_visible(gantt) {\n\t\tvar timeline = gantt.$ui.getView(\"timeline\");\n\t\tif (timeline && timeline.isVisible()) {\n\t\t\treturn true;\n\t\t} else {\n\t\t\treturn false;\n\t\t}\n\t}\n\n\tgantt._get_timepicker_step = function () {\n\t\tif (this.config.round_dnd_dates) {\n\t\t\tvar step;\n\t\t\tif (_is_chart_visible(this)) {\n\t\t\t\tvar scale = gantt.getScale();\n\t\t\t\tstep = (helpers.getSecondsInUnit(scale.unit) * scale.step) / 60;//timepicker step is measured in minutes\n\t\t\t}\n\n\t\t\tif (!step || step >= 60 * 24) {\n\t\t\t\tstep = this.config.time_step;\n\t\t\t}\n\t\t\treturn step;\n\t\t}\n\t\treturn this.config.time_step;\n\t};\n\tgantt.getLabel = function (property, key) {\n\t\tvar sections = this._get_typed_lightbox_config();\n\t\tfor (var i = 0; i < sections.length; i++) {\n\t\t\tif (sections[i].map_to == property) {\n\t\t\t\tvar options = sections[i].options;\n\t\t\t\tfor (var j = 0; j < options.length; j++) {\n\t\t\t\t\tif (options[j].key == key) {\n\t\t\t\t\t\treturn options[j].label;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\treturn \"\";\n\t};\n\n\tgantt.updateCollection = function (list_name, collection) {\n\t\tcollection = collection.slice(0);\n\t\tvar list = gantt.serverList(list_name);\n\t\tif (!list) return false;\n\t\tlist.splice(0, list.length);\n\t\tlist.push.apply(list, collection || []);\n\t\tgantt.resetLightbox();\n\t};\n\tgantt.getLightboxType = function () {\n\t\treturn this.getTaskType(this._lightbox_type);\n\t};\n\tgantt.getLightbox = function (type) {\n\t\tvar lightboxDiv;\n\t\tvar fullWidth;\n\t\tvar html;\n\t\tvar sns;\n\t\tvar ds;\n\t\tvar classNames = \"\";\n\t\tsetParentNode();\n\n\t\tif (type === undefined)\n\t\t\ttype = this.getLightboxType();\n\n\t\tif (!this._lightbox || this.getLightboxType() != this.getTaskType(type)) {\n\t\t\tthis._lightbox_type = this.getTaskType(type);\n\t\t\tlightboxDiv = document.createElement(\"div\");\n\t\t\tclassNames = \"gantt_cal_light\";\n\t\t\tfullWidth = this._is_lightbox_timepicker();\n\n\t\t\tif (gantt.config.wide_form)\n\t\t\t\tclassNames += \" gantt_cal_light_wide\";\n\n\t\t\tif (fullWidth) {\n\t\t\t\tclassNames += \" gantt_cal_light_full\";\n\t\t\t}\n\n\t\t\tlightboxDiv.className = classNames;\n\n\t\t\tlightboxDiv.style.visibility = \"hidden\";\n\t\t\thtml = this._lightbox_template;\n\t\t\thtml += \"<div class='gantt_cal_lcontrols'>\";\n\t\t\thtml += getHtmlButtons(this.config.buttons_left);\n\t\t\thtml += \"<div class='gantt_cal_lcontrols_push_right'></div>\";\n\t\t\thtml += getHtmlButtons(this.config.buttons_right, true);\n\t\t\thtml += \"</div>\";\n\n\t\t\tlightboxDiv.innerHTML = html;\n\n\t\t\tgantt._waiAria.lightboxAttr(lightboxDiv);\n\n\t\t\tif (gantt.config.drag_lightbox) {\n\t\t\t\tlightboxDiv.firstChild.onmousedown = gantt._ready_to_dnd;\n\t\t\t\tlightboxDiv.firstChild.ontouchstart = function (e){\n\t\t\t\t\tgantt._ready_to_dnd(e.touches[0]);\n\t\t\t\t};\n\t\t\t\tlightboxDiv.firstChild.onselectstart = function () {\n\t\t\t\t\treturn false;\n\t\t\t\t};\n\t\t\t\tlightboxDiv.firstChild.style.cursor = \"pointer\";\n\t\t\t\tgantt._init_dnd_events();\n\t\t\t}\n\n\t\t\t// GS-1428: If there is lightbox node, we need to remove it from the DOM\n\t\t\tif (this._lightbox){\n\t\t\t\tthis.resetLightbox();\n\t\t\t}\n\t\t\tshow_cover();\n\t\t\tthis._cover.insertBefore(lightboxDiv, this._cover.firstChild);\n\t\t\tthis._lightbox = lightboxDiv;\n\n\t\t\tsns = this._get_typed_lightbox_config(type);\n\t\t\thtml = this._render_sections(sns);\n\n\t\t\tds = lightboxDiv.querySelector(\"div.gantt_cal_larea\");\n\t\t\t\n\t\t\t//GS-1131. If gantt_cal_larea is displayed, Firefox renders buttons incorrectly;\n\t\t\tvar backup_overflow = ds.style.overflow;\n\t\t\tds.style.overflow = 'hidden';\n\n\t\t\tds.innerHTML = html;\n\n\t\t\t\n\n\t\t\tbindLabelsToInputs(sns);\n\n\t\t\tds.style.overflow = backup_overflow;\n\n\t\t\tthis._init_lightbox_events(this);\n\t\t\tlightboxDiv.style.display = \"none\";\n\t\t\tlightboxDiv.style.visibility = \"visible\";\n\t\t}\n\t\treturn this._lightbox;\n\t};\n\n\tgantt._render_sections = function (sns) {\n\t\tvar html = \"\";\n\t\tfor (var i = 0; i < sns.length; i++) {\n\t\t\tvar block = this.form_blocks[sns[i].type];\n\t\t\tif (!block) continue; //ignore incorrect blocks\n\t\t\tsns[i].id = \"area_\" + this.uid();\n\n\t\t\tvar display = sns[i].hidden ? \" style='display:none'\" : \"\";\n\t\t\tvar button = \"\";\n\t\t\tif (sns[i].button) {\n\t\t\t\tbutton = \"<div class='gantt_custom_button' data-index='\" + i + \"'><div class='gantt_custom_button_\" + sns[i].button + \"'></div><div class='gantt_custom_button_label'>\" + this.locale.labels[\"button_\" + sns[i].button] + \"</div></div>\";\n\t\t\t}\n\t\t\tif (sns[i].type == \"baselines\") {\n\t\t\t\tbutton = \"<div class='gantt_custom_button gantt_remove_baselines' data-index='\" + i + \"'><div class='gantt_custom_button_delete_baselines'></div><div class='gantt_custom_button_label'>\" + this.locale.labels.baselines_remove_all_button + \"</div></div>\" +\n\t\t\t\t\"<div class='gantt_custom_button gantt_add_baselines' data-index='\" + i + \"'><div class='gantt_custom_button_add_baseline'></div><div class='gantt_custom_button_label'>\" + this.locale.labels.baselines_add_button + \"</div></div>\";\n\t\t\t}\n\t\t\tif (this.config.wide_form) {\n\t\t\t\thtml += \"<div class='gantt_wrap_section' \" + display + \">\";\n\t\t\t}\n\t\t\thtml += \"<div id='\" + sns[i].id + \"' class='gantt_cal_lsection'><label>\" + button + this.locale.labels[\"section_\" + sns[i].name] + \"</label></div>\" + block.render.call(this, sns[i]);\n\t\t\thtml += \"</div>\";\n\t\t}\n\t\treturn html;\n\t};\n\n\tgantt._center_lightbox = function(box){\n\t\tgantt._setLbPosition(box);\n\t};\n\tgantt._setLbPosition = function(box) {\n\t\tif(!box){\n\t\t\treturn;\n\t\t}\n\t\tconst rootElement = gantt._lightbox_root || gantt.$root;\n\t\tbox.style.top = Math.max(rootElement.offsetHeight / 2 - box.offsetHeight/2, 0) + \"px\";\n\t\tbox.style.left = Math.max(rootElement.offsetWidth / 2 - box.offsetWidth/2, 0) + \"px\";\n\t};\n\n\tgantt.showCover = function (box) {\n\t\tif (box){\n\t\t\tbox.style.display=\"block\";\n\t\n\t\t\tthis._setLbPosition(box);\n\t\t}\n\t\tshow_cover();\n\t\tthis._cover.style.display = \"\";\n\t};\n\tconst show_cover=function(){\n\t\tif(gantt._cover) {\n\t\t\treturn;\n\t\t}\n\t\n\t\tgantt._cover=document.createElement(\"div\");\n\t\tgantt._cover.className=\"gantt_cal_cover\";\n\t\tgantt._cover.style.display = \"none\";\n\t\n\t\tgantt.event(gantt._cover, \"mousemove\", gantt._move_while_dnd);\n\t\tgantt.event(gantt._cover, \"mouseup\", gantt._finish_dnd);\n\t\n\t\tconst rootElement = gantt._lightbox_root || gantt.$root;\n\t\trootElement.appendChild(gantt._cover);\n\t};\n\n\tgantt._init_lightbox_events = function () {\n\t\tgantt.lightbox_events = {};\n\n\n\t\tgantt.lightbox_events.gantt_save_btn = function () {\n\t\t\tgantt._save_lightbox();\n\t\t};\n\n\n\t\tgantt.lightbox_events.gantt_delete_btn = function () {\n\t\t\tgantt._lightbox_current_type = null;\n\t\t\tif (!gantt.callEvent(\"onLightboxDelete\", [gantt._lightbox_id]))\n\t\t\t\treturn;\n\n\t\t\tif (gantt.isTaskExists(gantt._lightbox_id)) {\n\t\t\t\tgantt.$click.buttons[\"delete\"](gantt._lightbox_id);\n\t\t\t} else {\n\t\t\t\tgantt.hideLightbox();\n\t\t\t}\n\n\t\t};\n\n\n\t\tgantt.lightbox_events.gantt_cancel_btn = function () {\n\t\t\tgantt._cancel_lightbox();\n\t\t};\n\n\n\t\tgantt.lightbox_events[\"default\"] = function (e, src) {\n\t\t\tif (src.getAttribute(\"data-dhx-button\")) {\n\t\t\t\tgantt.callEvent(\"onLightboxButton\", [src.className, src, e]);\n\t\t\t} else {\n\t\t\t\tvar index, block, sec;\n\n\t\t\t\tvar className = domHelpers.getClassName(src);\n\t\t\t\tif (className.indexOf(\"gantt_custom_button\") != -1) {\n\t\t\t\t\tif (className.indexOf(\"gantt_custom_button_\") != -1) {\n\t\t\t\t\t\tindex = src.parentNode.getAttribute(\"data-index\");\n\t\t\t\t\t\tsec = src;\n\t\t\t\t\t\twhile (sec && domHelpers.getClassName(sec).indexOf(\"gantt_cal_lsection\") == -1) {\n\t\t\t\t\t\t\tsec = sec.parentNode;\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\t\t\tindex = src.getAttribute(\"data-index\");\n\t\t\t\t\t\tsec = src.closest(\".gantt_cal_lsection\");\n\t\t\t\t\t\tsrc = src.firstChild;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tvar sections = gantt._get_typed_lightbox_config();\n\n\t\t\t\tif (index) {\n\t\t\t\t\tindex = index * 1;\n\t\t\t\t\tblock = gantt.form_blocks[sections[index * 1].type];\n\t\t\t\t\tblock.button_click(index, src, sec, sec.nextSibling);\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\t\tthis.event(gantt.getLightbox(), \"click\", function (e) {\n\t\t\tif(e.target.closest(\".gantt_cal_ltitle_close_btn\")){\n\t\t\t\tgantt._cancel_lightbox();\n\t\t\t}\n\t\t\tvar src = domHelpers.getTargetNode(e);\n\n\t\t\tvar className = domHelpers.getClassName(src);\n\t\t\tif (!className) {\n\t\t\t\tsrc = src.previousSibling;\n\t\t\t\tclassName = domHelpers.getClassName(src);\n\t\t\t}\n\t\t\tif (src && className && className.indexOf(\"gantt_btn_set\") === 0) {\n\t\t\t\tsrc = src.firstChild;\n\t\t\t\tclassName = domHelpers.getClassName(src);\n\t\t\t}\n\t\t\tif (src && className) {\n\t\t\t\tvar func = gantt.defined(gantt.lightbox_events[src.className]) ? gantt.lightbox_events[src.className] : gantt.lightbox_events[\"default\"];\n\t\t\t\treturn func(e, src);\n\t\t\t}\n\t\t\treturn false;\n\t\t});\n\n\t\tgantt.getLightbox().onkeydown = function (e) {\n\t\t\tvar event = e || window.event;\n\t\t\tvar target = e.target || e.srcElement;\n\t\t\tvar buttonTarget = domHelpers.getClassName(target).indexOf(\"gantt_btn_set\") > -1;\n\n\t\t\tswitch ((e || event).keyCode) {\n\t\t\t\tcase gantt.constants.KEY_CODES.SPACE: {\n\t\t\t\t\tif ((e || event).shiftKey) return;\n\t\t\t\t\tif (buttonTarget && target.click) {\n\t\t\t\t\t\ttarget.click();\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t\tcase gantt.keys.edit_save:\n\t\t\t\t\tif ((e || event).shiftKey) return;\n\t\t\t\t\tif (buttonTarget && target.click) {\n\t\t\t\t\t\ttarget.click();\n\t\t\t\t\t} else {\n\t\t\t\t\t\tgantt._save_lightbox();\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\t\t\t\tcase gantt.keys.edit_cancel:\n\t\t\t\t\tgantt._cancel_lightbox();\n\t\t\t\t\tbreak;\n\t\t\t\tdefault:\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t};\n\t};\n\n\tgantt._cancel_lightbox = function () {\n\t\tvar task = this.getLightboxValues();\n\t\tgantt._lightbox_current_type = null;\n\t\tthis.callEvent(\"onLightboxCancel\", [this._lightbox_id, task.$new]);\n\t\tif (gantt.isTaskExists(task.id) && task.$new) {\n\t\t\tthis.silent(function () {\n\t\t\t\tgantt.$data.tasksStore.removeItem(task.id);\n\t\t\t\tgantt._update_flags(task.id, null);\n\t\t\t});\n\t\t\tthis.refreshData();\n\t\t}\n\n\t\tthis.hideLightbox();\n\t};\n\n\tgantt._save_lightbox = function () {\n\t\tvar task = this.getLightboxValues();\n\t\tgantt._lightbox_current_type = null;\n\t\tif (!this.callEvent(\"onLightboxSave\", [this._lightbox_id, task, !!task.$new]))\n\t\t\treturn;\n\n\t\t// GS-2170. Do not recalculate the indexes and dates of other tasks\n\t\t// as they will be recalculated in the `refreshData`\n\t\tgantt.$data.tasksStore._skipTaskRecalculation = \"lightbox\";\n\t\tif (task.$new) {\n\t\t\tdelete task.$new;\n\t\t\tthis.addTask(task, task.parent, this.getTaskIndex(task.id));\n\t\t} else if (this.isTaskExists(task.id)) {\n\t\t\tthis.mixin(this.getTask(task.id), task, true);\n\t\t\tthis.refreshTask(task.id);\n\t\t\tthis.updateTask(task.id);\n\t\t}\n\t\tgantt.$data.tasksStore._skipTaskRecalculation = false;\n\t\tthis.refreshData();\n\n\t\t// TODO: do we need any blockable events here to prevent closing lightbox?\n\t\tthis.hideLightbox();\n\t};\n\n\tgantt._resolve_default_mapping = function (section) {\n\t\tvar mapping = section.map_to;\n\t\tvar time_controls = { \"time\": true, \"time_optional\": true, \"duration\": true, \"duration_optional\": true };\n\t\tif (time_controls[section.type]) {\n\t\t\tif (section.map_to == \"auto\") {\n\t\t\t\tmapping = { start_date: \"start_date\", end_date: \"end_date\", duration: \"duration\" };\n\t\t\t} else if (typeof (section.map_to) === \"string\") {\n\t\t\t\tmapping = { start_date: section.map_to };\n\t\t\t}\n\t\t} else if (section.type === \"constraint\") {\n\t\t\tif (!section.map_to || typeof (section.map_to) === \"string\") {\n\t\t\t\tmapping = { constraint_type: \"constraint_type\", constraint_date: \"constraint_date\" };\n\t\t\t}\n\t\t}\n\n\t\treturn mapping;\n\t};\n\n\tgantt.getLightboxValues = function () {\n\t\tvar task = {};\n\n\t\tif (gantt.isTaskExists(this._lightbox_id)) {\n\t\t\ttask = this.mixin({}, this.getTask(this._lightbox_id));\n\t\t}\n\n\t\tvar sns = this._get_typed_lightbox_config();\n\t\tfor (var i = 0; i < sns.length; i++) {\n\t\t\tvar node = gantt._lightbox_root.querySelector(\"#\" + sns[i].id);\n\t\t\tnode = (node ? node.nextSibling : node);\n\t\t\tvar block = this.form_blocks[sns[i].type];\n\t\t\tif (!block) continue;\n\t\t\tvar res = block.get_value.call(this, node, task, sns[i]);\n\t\t\tvar map_to = gantt._resolve_default_mapping(sns[i]);\n\t\t\tif (typeof map_to == \"string\" && map_to != \"auto\") {\n\t\t\t\ttask[map_to] = res;\n\t\t\t} else if (typeof map_to == \"object\") {\n\t\t\t\tfor (var property in map_to) {\n\t\t\t\t\tif (map_to[property])\n\t\t\t\t\t\ttask[map_to[property]] = res[property];\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\t// GS-1282 We need to preserve the task type even if the lightbox doesn't have the typeselect section\n\t\t// GS-2460 set the current type from selector\n\t\tif (gantt._lightbox_current_type) {\n\t\t\ttask.type = gantt._lightbox_current_type;\n\t\t}\n\n\t\treturn task;\n\t};\n\n\n\tgantt.hideLightbox = function () {\n\t\tvar box = this.getLightbox();\n\t\tif (box) box.style.display = \"none\";\n\n\t\tthis._waiAria.lightboxHiddenAttr(box);\n\t\tthis._lightbox_id = null;\n\n\t\tthis.hideCover(box);\n\t\tthis.resetLightbox();\n\t\tthis.callEvent(\"onAfterLightbox\", []);\n\t};\n\tgantt.hideCover = function (box) {\n\t\tif(box){\n\t\t\tbox.style.display = \"none\";\n\t\t}\n\t\tif (this._cover)\n\t\t\tthis._cover.parentNode.removeChild(this._cover);\n\t\tthis._cover = null;\n\t};\n\n\tgantt.resetLightbox = function () {\n\t\tif (gantt._lightbox && !gantt._custom_lightbox)\n\t\t\tgantt._lightbox.remove();\n\t\tgantt._lightbox = null;\n\t};\n\tgantt._set_lightbox_values = function (data, box) {\n\t\tvar task = data;\n\t\tvar s = box.getElementsByTagName(\"span\");\n\t\tvar lightboxHeader = [];\n\t\tif (gantt.templates.lightbox_header) {\n\t\t\tlightboxHeader.push(\"\");\n\t\t\tlightboxHeader.push(gantt.templates.lightbox_header(task.start_date, task.end_date, task));\n\t\t\ts[1].innerHTML = \"\";\n\t\t\ts[2].innerHTML = gantt.templates.lightbox_header(task.start_date, task.end_date, task);\n\t\t} else {\n\t\t\tlightboxHeader.push(this.templates.task_time(task.start_date, task.end_date, task));\n\t\t\tlightboxHeader.push(String(this.templates.task_text(task.start_date, task.end_date, task) || \"\").substr(0, 70)); //IE6 fix\n\t\t\ts[1].innerHTML = this.templates.task_time(task.start_date, task.end_date, task);\n\t\t\ts[2].innerHTML = String(this.templates.task_text(task.start_date, task.end_date, task) || \"\").substr(0, 70); //IE6 fix\n\t\t}\n\t\ts[1].innerHTML = lightboxHeader[0];\n\t\ts[2].innerHTML = lightboxHeader[1];\n\n\t\tgantt._waiAria.lightboxHeader(box, lightboxHeader.join(\" \"));\n\n\t\tvar sns = this._get_typed_lightbox_config(this.getLightboxType());\n\t\tfor (var i = 0; i < sns.length; i++) {\n\t\t\tvar section = sns[i];\n\n\t\t\tif (!this.form_blocks[section.type]) {\n\t\t\t\tcontinue;//skip incorrect sections, same check is done during rendering\n\t\t\t}\n\n\n\t\t\tvar node = gantt._lightbox_root.querySelector(\"#\" + section.id).nextSibling;\n\t\t\tvar block = this.form_blocks[section.type];\n\t\t\tvar map_to = gantt._resolve_default_mapping(sns[i]);\n\t\t\tvar value = this.defined(task[map_to]) ? task[map_to] : section.default_value;\n\t\t\tblock.set_value.call(gantt, node, value, task, section);\n\n\t\t\tif (section.focus)\n\t\t\t\tblock.focus.call(gantt, node);\n\t\t}\n\t\tif (gantt.isTaskExists(data.id)){\n\t\t\tgantt._lightbox_id = data.id;\n\t\t}\n\t};\n\tgantt._fill_lightbox = function (id, box) {\n\t\tvar task = this.getTask(id);\n\t\tthis._set_lightbox_values(task, box);\n\t};\n\n\n\tgantt.getLightboxSection = function (name) {\n\t\tvar config = this._get_typed_lightbox_config();\n\t\tvar i = 0;\n\t\tfor (i; i < config.length; i++)\n\t\t\tif (config[i].name == name)\n\t\t\t\tbreak;\n\t\tvar section = config[i];\n\t\tif (!section)\n\t\t\treturn null;\n\n\t\tif (!this._lightbox)\n\t\t\tthis.getLightbox();\n\t\tvar header = gantt._lightbox_root.querySelector(\"#\" + section.id);\n\t\tvar node = header.nextSibling;\n\n\t\tvar result = {\n\t\t\tsection: section,\n\t\t\theader: header,\n\t\t\tnode: node,\n\t\t\tgetValue: function (ev) {\n\t\t\t\treturn gantt.form_blocks[section.type].get_value.call(gantt, node, (ev || {}), section);\n\t\t\t},\n\t\t\tsetValue: function (value, ev) {\n\t\t\t\treturn gantt.form_blocks[section.type].set_value.call(gantt, node, value, (ev || {}), section);\n\t\t\t}\n\t\t};\n\n\t\tvar handler = this._lightbox_methods[\"get_\" + section.type + \"_control\"];\n\t\treturn handler ? handler(result) : result;\n\t};\n\n\tgantt._lightbox_methods.get_template_control = function (result) {\n\t\tresult.control = result.node;\n\t\treturn result;\n\t};\n\tgantt._lightbox_methods.get_select_control = function (result) {\n\t\tresult.control = result.node.getElementsByTagName(\"select\")[0];\n\t\treturn result;\n\t};\n\tgantt._lightbox_methods.get_textarea_control = function (result) {\n\t\tresult.control = result.node.getElementsByTagName(\"textarea\")[0];\n\t\treturn result;\n\t};\n\tgantt._lightbox_methods.get_time_control = function (result) {\n\t\tresult.control = result.node.getElementsByTagName(\"select\"); // array\n\t\treturn result;\n\t};\n\n\n\tgantt._init_dnd_events = function () {\n\t\tvar eventElement = gantt._lightbox_root;\n\t\tthis.event(eventElement, \"mousemove\", gantt._move_while_dnd);\n\t\tthis.event(eventElement, \"mouseup\", gantt._finish_dnd);\n\t\tthis.event(eventElement, \"touchmove\", function (e){\n\t\t\tgantt._move_while_dnd(e.touches[0]);\n\t\t});\n\t\tthis.event(eventElement, \"touchend\", function (e){\n\t\t\tgantt._finish_dnd(e.touches[0]);\n\t\t});\n\t\t// GS-1952: In Salesforce environment, the lightbox is attached to the Gantt container. \n\t\t// So when Gantt is reinitialized, the events are no longer attached to the Gantt container.\n\t\t// gantt._init_dnd_events = function () {\n\t\t// };\n\t};\n\tgantt._move_while_dnd = function (event) {\n\t\tif (gantt._dnd_start_lb) {\n\t\t\tif (!document.gantt_unselectable) {\n\t\t\t\tgantt._lightbox_root.className += \" gantt_unselectable\";\n\t\t\t\tdocument.gantt_unselectable = true;\n\t\t\t}\n\t\t\tvar lb = gantt.getLightbox();\n\t\t\tvar now = [event.pageX, event.pageY];\n\t\t\tlb.style.top = gantt._lb_start[1] + now[1] - gantt._dnd_start_lb[1] + \"px\";\n\t\t\tlb.style.left = gantt._lb_start[0] + now[0] - gantt._dnd_start_lb[0] + \"px\";\n\t\t}\n\t};\n\tgantt._ready_to_dnd = function (event) {\n\t\tvar lb = gantt.getLightbox();\n\t\tgantt._lb_start = [lb.offsetLeft, lb.offsetTop];\n\t\tgantt._dnd_start_lb = [event.pageX, event.pageY];\n\t};\n\tgantt._finish_dnd = function () {\n\t\tif (gantt._lb_start) {\n\t\t\tgantt._lb_start = gantt._dnd_start_lb = false;\n\t\t\tgantt._lightbox_root.className = gantt._lightbox_root.className.replace(\" gantt_unselectable\", \"\");\n\t\t\tdocument.gantt_unselectable = false;\n\t\t}\n\t};\n\n\n\tgantt._focus = function (node, select) {\n\t\tif (node && node.focus) {\n\t\t\tif (gantt.config.touch) {\n\t\t\t\t//do not focus editor, to prevent auto-zoom\n\t\t\t} else {\n\t\t\t\ttry {\n\t\t\t\t\tif (select && node.select) node.select();\n\t\t\t\t\tnode.focus();\n\t\t\t\t} catch (e) {\n\t\t\t\t\t// silent errors\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t};\n\n\n\tgantt.form_blocks = {\n\t\tgetTimePicker: function (sns, hidden) {\n\t\t\tvar html = \"\";\n\t\t\tvar cfg = this.config;\n\t\t\tvar i;\n\t\t\tvar options;\n\t\t\tvar ariaAttrs;\n\t\t\tvar readonly;\n\t\t\tvar display;\n\t\t\tvar settings = {\n\t\t\t\tfirst: 0,\n\t\t\t\tlast: 24 * 60,\n\t\t\t\tdate: this.date.date_part(new Date(gantt._min_date.valueOf())),\n\t\t\t\ttimeFormat: getTimeFormat(sns)\n\t\t\t};\n\n\t\t\t// map: default order => real one\n\t\t\tsns._time_format_order = { size: 0 };\n\n\t\t\tif (gantt.config.limit_time_select) {\n\t\t\t\tsettings.first = 60 * cfg.first_hour;\n\t\t\t\tsettings.last = 60 * cfg.last_hour + 1;\n\t\t\t\tsettings.date.setHours(cfg.first_hour);\n\t\t\t}\n\n\t\t\tfor (i = 0; i < settings.timeFormat.length; i++) {\n\t\t\t\t// adding spaces between selects\n\t\t\t\tif (i > 0) {\n\t\t\t\t\thtml += \" \";\n\t\t\t\t}\n\n\t\t\t\toptions = getHtmlTimePickerOptions(sns, i, settings);\n\n\t\t\t\tif (options) {\n\t\t\t\t\tariaAttrs = gantt._waiAria.lightboxSelectAttrString(settings.timeFormat[i]);\n\t\t\t\t\treadonly = sns.readonly ? \"disabled='disabled'\" : \"\";\n\t\t\t\t\tdisplay = hidden ? \" style='display:none' \" : \"\";\n\t\t\t\t\thtml += \"<select \" + readonly + display + ariaAttrs + \">\" + options + \"</select>\";\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn html;\n\t\t},\n\t\tgetTimePickerValue: function (selects, config, offset) {\n\t\t\tvar map = config._time_format_order;\n\t\t\tvar needSetTime = gantt.defined(map[3]);\n\n\t\t\tvar time;\n\t\t\tvar hours = 0;\n\t\t\tvar minutes = 0;\n\n\t\t\tvar mapOffset = offset || 0;\n\n\t\t\tif (needSetTime) {\n\t\t\t\ttime = parseInt(selects[map[3] + mapOffset].value, 10);\n\t\t\t\thours = Math.floor(time / 60);\n\t\t\t\tminutes = time % 60;\n\t\t\t}\n\t\t\treturn new Date(selects[map[2] + mapOffset].value, selects[map[1] + mapOffset].value, selects[map[0] + mapOffset].value, hours, minutes);\n\t\t},\n\n\t\t_fill_lightbox_select: function (s, i, d, map) {\n\t\t\ts[i + map[0]].value = d.getDate();\n\t\t\ts[i + map[1]].value = d.getMonth();\n\t\t\ts[i + map[2]].value = d.getFullYear();\n\t\t\tif (gantt.defined(map[3])) {\n\t\t\t\tvar v = d.getHours() * 60 + d.getMinutes();\n\t\t\t\tv = Math.round(v / gantt._get_timepicker_step()) * gantt._get_timepicker_step();\n\t\t\t\tvar input = s[i + map[3]];\n\t\t\t\tinput.value = v;\n\t\t\t\t//in case option not shown\n\t\t\t\tinput.setAttribute(\"data-value\", v);\n\t\t\t}\n\t\t},\n\t\ttemplate: new TemplateControl(),\n\t\ttextarea: new TextareaControl(),\n\t\tselect: new SelectControl(),\n\t\ttime: new TimeControl(),\n\t\tduration: new DurationControl(),\n\t\tparent: new ParentControl(),\n\t\tradio: new RadioControl(),\n\t\tcheckbox: new CheckboxControl(),\n\t\tresources: new ResourcesControl(),\n\t\tconstraint: new ConstraintControl(),\n\t\tbaselines: new BaselineControl(),\n\t\ttypeselect: new TypeselectControl()\n\t};\n\n\tgantt._is_lightbox_timepicker = function () {\n\t\tvar s = this._get_typed_lightbox_config();\n\t\tfor (var i = 0; i < s.length; i++)\n\t\t\tif (s[i].name == \"time\" && s[i].type == \"time\")\n\t\t\t\treturn true;\n\t\treturn false;\n\t};\n\n\tgantt._simple_confirm = function (message, title, callback, ok) {\n\t\tif (!message)\n\t\t\treturn callback();\n\t\tvar opts = { text: message };\n\t\tif (title)\n\t\t\topts.title = title;\n\t\tif (ok) {\n\t\t\topts.ok = ok;\n\t\t}\n\t\tif (callback) {\n\t\t\topts.callback = function (result) {\n\t\t\t\tif (result)\n\t\t\t\t\tcallback();\n\t\t\t};\n\t\t}\n\t\tgantt.confirm(opts);\n\t};\n\n\tfunction _get_type_name(type_value) {\n\t\tfor (var i in this.config.types) {\n\t\t\tif (this.config.types[i] == type_value) {\n\t\t\t\treturn i;\n\t\t\t}\n\t\t}\n\t\treturn \"task\";\n\t}\n\n\tgantt._get_typed_lightbox_config = function (type) {\n\t\tif (type === undefined) {\n\t\t\ttype = this.getLightboxType();\n\t\t}\n\n\t\tvar field = _get_type_name.call(this, type);\n\n\t\tif (gantt.config.lightbox[field + \"_sections\"]) {\n\t\t\treturn gantt.config.lightbox[field + \"_sections\"];\n\t\t} else {\n\t\t\treturn gantt.config.lightbox.sections;\n\t\t}\n\t};\n\n\tgantt._silent_redraw_lightbox = function (type) {\n\t\tvar oldType = this.getLightboxType();\n\n\t\tif (this.getState().lightbox) {\n\t\t\tvar taskId = this.getState().lightbox;\n\t\t\tvar formData = this.getLightboxValues(),\n\t\t\t\ttask = this.copy(this.getTask(taskId));\n\n\t\t\tthis.resetLightbox();\n\n\t\t\tvar updTask = this.mixin(task, formData, true);\n\t\t\tvar box = this.getLightbox(type ? type : undefined);\n\t\t\tthis._set_lightbox_values(updTask, box);\n\t\t\tthis.showCover(box);\n\t\t} else {\n\t\t\tthis.resetLightbox();\n\t\t\tthis.getLightbox(type ? type : undefined);\n\t\t}\n\t\tthis.callEvent(\"onLightboxChange\", [oldType, this.getLightboxType()]);\n\t};\n\n\tfunction bindLabelsToInputs(sns) {\n\t\tvar section;\n\t\tvar label;\n\t\tvar labelBlock;\n\t\tvar inputBlock;\n\t\tvar input;\n\t\tvar i;\n\n\t\tfor (i = 0; i < sns.length; i++) {\n\t\t\tsection = sns[i];\n\t\t\tlabelBlock = gantt._lightbox_root.querySelector(\"#\" + section.id);\n\n\t\t\tif (!section.id || !labelBlock) continue;\n\n\t\t\tlabel = labelBlock.querySelector(\"label\");\n\t\t\tinputBlock = labelBlock.nextSibling;\n\n\t\t\tif (!inputBlock) continue;\n\n\t\t\tinput = inputBlock.querySelector(\"input, select, textarea\");\n\t\t\tif (input) {\n\t\t\t\tinput.id = input.id || \"input_\" + gantt.uid();\n\t\t\t\tsection.inputId = input.id;\n\t\t\t\tlabel.setAttribute(\"for\", section.inputId);\n\t\t\t}\n\t\t}\n\t}\n\n\tfunction getHtmlButtons(buttons, floatRight) {\n\t\tvar button;\n\t\tvar ariaAttr;\n\t\tvar html = \"\";\n\t\tvar i;\n\n\t\tfor (i = 0; i < buttons.length; i++) {\n\t\t\t// needed to migrate from 'dhx_something' to 'gantt_something' naming in a lightbox\n\t\t\tbutton = gantt.config._migrate_buttons[buttons[i]] ? gantt.config._migrate_buttons[buttons[i]] : buttons[i];\n\n\t\t\tariaAttr = gantt._waiAria.lightboxButtonAttrString(button);\n\t\t\thtml += \"<div \" + ariaAttr + \" class='gantt_btn_set gantt_left_btn_set \" + button + \"_set'\" + \"><div dhx_button='1' data-dhx-button='1' class='\" + button + \"'></div><div>\" + gantt.locale.labels[button] + \"</div></div>\";\n\t\t}\n\t\treturn html;\n\t}\n\n\tfunction getTimeFormat(sns) {\n\t\tvar scale;\n\t\tvar unit;\n\t\tvar result;\n\n\t\tif (sns.time_format) return sns.time_format;\n\n\t\t// default order\n\t\tresult = [\"%d\", \"%m\", \"%Y\"];\n\t\tscale = gantt.getScale();\n\t\tunit = scale ? scale.unit : gantt.config.duration_unit;\n\t\tif (helpers.getSecondsInUnit(unit) < helpers.getSecondsInUnit(\"day\")) {\n\t\t\tresult.push(\"%H:%i\");\n\t\t}\n\t\treturn result;\n\t}\n\n\tfunction getHtmlTimePickerOptions(sns, index, settings) {\n\t\tvar range;\n\t\tvar offset;\n\t\tvar start_year;\n\t\tvar end_year;\n\t\tvar i;\n\t\tvar time;\n\t\tvar diff;\n\t\tvar tdate;\n\t\tvar html = \"\";\n\n\t\tswitch (settings.timeFormat[index]) {\n\t\t\tcase \"%Y\":\n\t\t\t\tsns._time_format_order[2] = index;\n\t\t\t\tsns._time_format_order.size++;\n\t\t\t\t//year\n\n\t\t\t\tif (sns.year_range) {\n\t\t\t\t\tif (!isNaN(sns.year_range)) {\n\t\t\t\t\t\trange = sns.year_range;\n\t\t\t\t\t} else if (sns.year_range.push) {\n\t\t\t\t\t\t// if\n\t\t\t\t\t\tstart_year = sns.year_range[0];\n\t\t\t\t\t\tend_year = sns.year_range[1];\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\trange = range || 10;\n\t\t\t\toffset = offset || Math.floor(range / 2);\n\t\t\t\tstart_year = start_year || settings.date.getFullYear() - offset;\n\t\t\t\tend_year = end_year || gantt.getState().max_date.getFullYear() + offset;\n\n\t\t\t\tfor (i = start_year; i < end_year; i++)\n\t\t\t\t\thtml += \"<option value='\" + (i) + \"'>\" + (i) + \"</option>\";\n\t\t\t\tbreak;\n\t\t\tcase \"%m\":\n\t\t\t\tsns._time_format_order[1] = index;\n\t\t\t\tsns._time_format_order.size++;\n\t\t\t\t//month\n\t\t\t\tfor (i = 0; i < 12; i++)\n\t\t\t\t\thtml += \"<option value='\" + i + \"'>\" + gantt.locale.date.month_full[i] + \"</option>\";\n\t\t\t\tbreak;\n\t\t\tcase \"%d\":\n\t\t\t\tsns._time_format_order[0] = index;\n\t\t\t\tsns._time_format_order.size++;\n\t\t\t\t//days\n\t\t\t\tfor (i = 1; i < 32; i++)\n\t\t\t\t\thtml += \"<option value='\" + i + \"'>\" + i + \"</option>\";\n\t\t\t\tbreak;\n\t\t\tcase \"%H:%i\":\n\t\t\t\t//  var last = 24*60, first = 0;\n\t\t\t\tsns._time_format_order[3] = index;\n\t\t\t\tsns._time_format_order.size++;\n\t\t\t\t//hours\n\t\t\t\ti = settings.first;\n\t\t\t\ttdate = settings.date.getDate();\n\t\t\t\tsns._time_values = [];\n\n\t\t\t\twhile (i < settings.last) {\n\t\t\t\t\ttime = gantt.templates.time_picker(settings.date);\n\t\t\t\t\thtml += \"<option value='\" + i + \"'>\" + time + \"</option>\";\n\t\t\t\t\tsns._time_values.push(i);\n\t\t\t\t\tsettings.date.setTime(settings.date.valueOf() + gantt._get_timepicker_step() * 60 * 1000);\n\t\t\t\t\tdiff = (settings.date.getDate() != tdate) ? 1 : 0; // moved or not to the next day\n\t\t\t\t\ti = diff * 24 * 60 + settings.date.getHours() * 60 + settings.date.getMinutes();\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\tdefault:\n\t\t\t\tbreak;\n\t\t}\n\t\treturn html;\n\t}\n};","import __extends from \"../../../../utils/extends\";\n\nimport Super from \"./base_control\";\n\nexport default function(gantt) {\n\tconst _super = Super(gantt);\n\n\tfunction TemplateControl() {\n\t\tvar self = _super.apply(this, arguments) || this; \n\t\treturn self; \n\t}\n\n\t__extends(TemplateControl, _super);\n\n\n\tTemplateControl.prototype.render = function(sns) {\n\t\tlet height = sns.height ? `${sns.height}px` : '';\n\t\treturn `<div class='gantt_cal_ltext gantt_cal_template gantt_section_${sns.name}' ${height ? `style='height:${height};'` : ''}></div>`;\n\t};\n\n\tTemplateControl.prototype.set_value = function(node, value) {\n\t\tnode.innerHTML = value || \"\";\n\t};\n\n\tTemplateControl.prototype.get_value = function(node) {\n\t\treturn node.innerHTML || \"\";\n\t};\n\n\tTemplateControl.prototype.focus = function() {};\n\n\treturn TemplateControl;\n};","import __extends from \"../../../../utils/extends\";\n\nimport Super from \"./base_control\";\n\nexport default function(gantt) {\n\tconst _super = Super(gantt);\n\n\tfunction TextareaControl() {\n\t\tvar self = _super.apply(this, arguments) || this;\n\n\t\treturn self; \n\t}\n\n\t__extends(TextareaControl, _super);\n\n\tTextareaControl.prototype.render = function(sns) {\n\t\tconst height = (sns.height || \"130\") + \"px\";\n\t\tconst placeholder = sns.placeholder ? `placeholder='${sns.placeholder}'` : \"\";\n\t\treturn `<div class='gantt_cal_ltext gantt_section_${sns.name}' style='height:${height};' ${placeholder}><textarea></textarea></div>`;\n\t};\n\n\tTextareaControl.prototype.set_value = function(node, value) {\n\t\tgantt.form_blocks.textarea._get_input(node).value = value || \"\";\n\t};\n\n\tTextareaControl.prototype.get_value = function(node) {\n\t\treturn gantt.form_blocks.textarea._get_input(node).value;\n\t};\n\n\tTextareaControl.prototype.focus = function(node) {\n\t\tvar a = gantt.form_blocks.textarea._get_input(node);\n\t\tgantt._focus(a, true);\n\t};\n\n\tTextareaControl.prototype._get_input = function(node) {\n\t\treturn node.querySelector(\"textarea\");\n\t};\n\n\treturn TextareaControl;\n};","import __extends from \"../../../../utils/extends\";\n\nimport Super from \"./base_control\";\n\nexport default function(gantt) {\n\tconst _super = Super(gantt);\n\n\tfunction TimeControl() {\n\t\tvar self = _super.apply(this, arguments) || this;\n\n\t\treturn self;\n\t}\n\n\t__extends(TimeControl, _super);\n\n\tTimeControl.prototype.render = function (sns) {\n\t\tvar time = gantt.form_blocks.getTimePicker.call(this, sns);\n\t\tlet sectionClassName = \"gantt_section_time\";\n\t\tif (sns.name !== \"time\"){\n\t\t\tsectionClassName += \" gantt_section_\" + sns.name;\n\t\t}\n\t\tvar html = \"<div style='padding-top:0px;font-size:inherit;text-align:center;' class='\" + sectionClassName + \"'>\";\n\t\thtml += time;\n\n\t\tif (sns.single_date) {\n\t\t\ttime = gantt.form_blocks.getTimePicker.call(this, sns, true);\n\t\t\thtml += \"<span></span>\";\n\t\t} else {\n\t\t\thtml += \"<span class='gantt_section_time_spacer'> &nbsp;&ndash;&nbsp; </span>\";\n\t\t}\n\n\t\thtml += time;\n\t\thtml += \"</div>\";\n\t\treturn html;\n\t};\n\n\tTimeControl.prototype.set_value = function (node, value, ev, config) {\n\t\tvar cfg = config;\n\t\tvar s = node.getElementsByTagName(\"select\");\n\t\tvar map = config._time_format_order;\n\n\t\tif (cfg.auto_end_date) {\n\t\t\tvar _update_lightbox_select = function () {\n\t\t\t\tstart_date = new Date(s[map[2]].value, s[map[1]].value, s[map[0]].value, 0, 0);\n\t\t\t\tend_date = gantt.calculateEndDate({ start_date: start_date, duration: 1, task: ev });\n\t\t\t\tgantt.form_blocks._fill_lightbox_select(s, map.size, end_date, map, cfg);\n\t\t\t};\n\t\t\tfor (var i = 0; i < 4; i++) {\n\t\t\t\ts[i].onchange = _update_lightbox_select;\n\t\t\t}\n\t\t}\n\n\t\tvar mapping = gantt._resolve_default_mapping(config);\n\n\t\tif (typeof (mapping) === \"string\") mapping = { start_date: mapping };\n\n\t\tvar start_date = ev[mapping.start_date] || new Date();\n\t\tvar end_date = ev[mapping.end_date] || gantt.calculateEndDate({\n\t\t\tstart_date: start_date,\n\t\t\tduration: 1,\n\t\t\ttask: ev\n\t\t});\n\n\t\tgantt.form_blocks._fill_lightbox_select(s, 0, start_date, map, cfg);\n\t\tgantt.form_blocks._fill_lightbox_select(s, map.size, end_date, map, cfg);\n\t};\n\n\tTimeControl.prototype.get_value = function (node, ev, config) {\n\t\tvar selects = node.getElementsByTagName(\"select\");\n\t\tvar startDate;\n\t\tvar map = config._time_format_order;\n\t\tfunction _getEndDate(selects, map, startDate) {\n\t\t\tvar endDate = gantt.form_blocks.getTimePickerValue(selects, config, map.size);\n\t\t\t// GS-1010: We need to add a way to obtain exact end_date for validation\n\t\t\tif (endDate <= startDate) {  // when end date seems wrong\n\t\t\t\tif (config.autofix_end !== false || config.single_date) { // auto correct it in two cases - when the auto correction is not disabled, or when we have 'single date' control and the user don't have the UI to specify the end date\n\t\t\t\t\treturn gantt.date.add(startDate, gantt._get_timepicker_step(), \"minute\");\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn endDate;\n\t\t}\n\n\t\tstartDate = gantt.form_blocks.getTimePickerValue(selects, config);\n\n\t\tif (typeof gantt._resolve_default_mapping(config) === \"string\") {\n\t\t\treturn startDate;\n\t\t}\n\n\t\treturn {\n\t\t\tstart_date: startDate,\n\t\t\tend_date: _getEndDate(selects, map, startDate)\n\t\t};\n\t};\n\n\tTimeControl.prototype.focus = function (node) {\n\t\tgantt._focus(node.getElementsByTagName(\"select\")[0]);\n\t};\n\n\treturn TimeControl;\n};","import * as helpers from \"../../../../utils/helpers\";\nimport __extends from \"../../../../utils/extends\";\nimport BaseConstrutor from \"./base_control\";\n\nexport default function(gantt) {\n\tvar _super = BaseConstrutor(gantt);\n\n\tfunction CheckboxControl() {\n\t\tvar self = _super.apply(this, arguments) || this;\n\n\t\treturn self; \n\t}\n\n\t__extends(CheckboxControl, _super);\n\n\tCheckboxControl.prototype.render = function(sns) {\n\t\tconst height = sns.height ? `height:${sns.height}px;` : '';\n\t\tlet html = `<div class='gantt_cal_ltext gantt_cal_lcheckbox gantt_section_${sns.name}' ${height ? `style='${height}'` : ''}>`;\n\n\t\tif (sns.options && sns.options.length) {\n\t\t\tfor (var i = 0; i < sns.options.length; i++) {\n\t\t\t\thtml += \"<label><input type='checkbox' value='\" + sns.options[i].key + \"' name='\" + sns.name + \"'>\" + sns.options[i].label + \"</label>\";\n\t\t\t}\n\t\t}else{\n\t\t\tsns.single_value = true;\n\t\t\thtml += \"<label><input type='checkbox' name='\" + sns.name + \"'></label>\";\n\t\t}\n\t\thtml += \"</div>\";\n\t\treturn html;\n\t};\n\n\tCheckboxControl.prototype.set_value = function(node, value, ev, sns) {\n\t\tvar checkboxes = Array.prototype.slice.call(node.querySelectorAll(\"input[type=checkbox]\"));\n\n\t\tif (!node._dhx_onchange && sns.onchange) {\n\t\t\tnode.onchange = sns.onchange;\n\t\t\tnode._dhx_onchange = true;\n\t\t}\n\n\t\tif(sns.single_value){\n\t\t\tvar box = checkboxes[0];\n\t\t\tbox.checked = !!value;\n\t\t}else{\n\t\t\thelpers.forEach(checkboxes, function(entry) {\n\t\t\t\tentry.checked = value ? value.indexOf(entry.value) >= 0 : false;\n\t\t\t});\n\t\t}\n\t};\n\n\tCheckboxControl.prototype.get_value = function(node, task, sns) {\n\t\tif(sns.single_value){\n\t\t\tvar box = node.querySelector(\"input[type=checkbox]\");\n\t\t\treturn box.checked;\n\t\t}else{\n\t\t\treturn helpers.arrayMap(Array.prototype.slice.call(node.querySelectorAll(\"input[type=checkbox]:checked\")), function(entry) {\n\t\t\t\treturn entry.value;\n\t\t\t});\n\t\t}\n\t};\n\n\tCheckboxControl.prototype.focus = function(node) {\n\t\tgantt._focus(node.querySelector(\"input[type=checkbox]\"));\n\t};\n\n\treturn CheckboxControl;\n};","import __extends from \"../../../../utils/extends\";\nimport Super from \"./base_control\";\n\nexport default function(gantt) {\n\tconst _super = Super(gantt);\n\n\tfunction RadioControl() {\n\t\tvar self = _super.apply(this, arguments) || this;\n\n\t\treturn self; \n\t}\n\n\t__extends(RadioControl, _super);\n\n\tRadioControl.prototype.render = function(sns) {\n\t\tconst height = sns.height ? `${sns.height}px` : '';\n\t\tlet html = `<div class='gantt_cal_ltext gantt_cal_lradio gantt_section_${sns.name}' ${height ? `style='height:${height};'` : ''}>`;\n\n\t\tif (sns.options && sns.options.length) {\n\t\t\tfor (var i = 0; i < sns.options.length; i++) {\n\t\t\t\thtml += \"<label><input type='radio' value='\" + sns.options[i].key + \"' name='\" + sns.name + \"'>\" + sns.options[i].label + \"</label>\";\n\t\t\t}\n\t\t}\n\n\t\thtml += \"</div>\";\n\t\treturn html;\n\t};\n\n\tRadioControl.prototype.set_value = function(node, value, ev, sns) {\n\t\tvar radio;\n\n\t\tif (!sns.options || !sns.options.length) return;\n\n\t\tradio = node.querySelector(\"input[type=radio][value='\" + value + \"']\") ||\n\t\t\t\tnode.querySelector(\"input[type=radio][value='\" + sns.default_value + \"']\");\n\n\t\tif (!radio) return;\n\n\t\tif (!node._dhx_onchange && sns.onchange) {\n\t\t\tnode.onchange = sns.onchange;\n\t\t\tnode._dhx_onchange = true;\n\t\t}\n\n\t\tradio.checked = true;\n\t};\n\n\tRadioControl.prototype.get_value = function(node, ev) {\n\t\tvar result = node.querySelector(\"input[type=radio]:checked\");\n\n\t\treturn result ? result.value : \"\";\n\t};\n\n\tRadioControl.prototype.focus = function(node) {\n\t\tgantt._focus(node.querySelector(\"input[type=radio]\"));\n\t};\n\n\treturn RadioControl;\n};","import __extends from \"../../../../utils/extends\";\n\nimport DurationFormatterNumeric from  \"../../../common/duration_formatter_numeric\";\nimport BaseConstrutor from \"./base_control\";\n\nexport default function(gantt) {\n\tvar _super = BaseConstrutor(gantt);\n\n\tfunction DurationControl() {\n\t\tvar self = _super.apply(this, arguments) || this; \n\n\t\treturn self; \n\t}\n\n\tfunction getFormatter(config) {\n\t\treturn config.formatter || new DurationFormatterNumeric();\n\t}\n\n\t__extends(DurationControl, _super);\n\n\tDurationControl.prototype.render = function(sns) {\n\t\tvar time = \"<div class='gantt_time_selects'>\" + gantt.form_blocks.getTimePicker.call(this, sns) + \"</div>\";\n\t\tvar label = \" \"+ gantt.locale.labels[gantt.config.duration_unit + \"s\"] +\" \";\n\t\tvar singleDate = sns.single_date ? \" style='display:none'\" : \"\";\n\t\tvar readonly = sns.readonly ? \" disabled='disabled'\" : \"\";\n\t\tvar ariaAttr = gantt._waiAria.lightboxDurationInputAttrString(sns);\n\n\t\tvar durationInputClass = \"gantt_duration_value\";\n\t\tif(sns.formatter) {\n\t\t\tlabel = \"\";\n\t\t\tdurationInputClass += \" gantt_duration_value_formatted\" ;\n\t\t}\n\n\t\tvar duration = \"<div class='gantt_duration' \" + singleDate + \">\" +\n\t\t\"<div class='gantt_duration_inputs'>\" +\n\t\t\t\"<input type='button' class='gantt_duration_dec' value='−'\" + readonly + \">\" +\n\t\t\t\"<input type='text' value='5days' class='\"+durationInputClass+\"'\" + readonly + \" \" + ariaAttr + \">\" +\n\t\t\t\"<input type='button' class='gantt_duration_inc' value='+'\" + readonly + \">\"+\n\t\t\t\"</div>\" +\n\t\t\t\"<div class='gantt_duration_end_date'>\"+label+\"<span></span></div>\" +\n\t\t\t\"</div>\" +\n\t\t\t\"</div>\";\n\t\tlet sectionClassName = \"gantt_section_time gantt_section_duration\";\n\t\tif (sns.name !== \"time\"){\n\t\t\tsectionClassName += \" gantt_section_\" + sns.name;\n\t\t}\t\n\t\tvar html = \"<div style='padding-top:0px;font-size:inherit;' class='\" + sectionClassName + \"'>\" + time + \" \" + duration + \"</div>\";\n\t\treturn html;\n\t};\n\n\tDurationControl.prototype.set_value = function(node, value, ev, config) {\n\t\tvar s = node.getElementsByTagName(\"select\");\n\t\tvar inps = node.getElementsByTagName(\"input\");\n\t\tvar duration = inps[1];\n\t\tvar btns = [inps[0], inps[2]];\n\t\tvar endspan = node.getElementsByTagName(\"span\")[0];\n\t\tvar map = config._time_format_order;\n\t\tvar mapping;\n\t\tvar start_date;\n\t\tvar end_date;\n\t\tvar duration_val;\n\n\t\tfunction _calc_date() {\n\t\t\tvar start_date = _getStartDate.call(gantt, node, config);\n\t\t\tvar duration = _getDuration.call(gantt, node, config);\n\t\t\tvar end_date = gantt.calculateEndDate({start_date: start_date, duration: duration, task: ev});\n\n\t\t\tvar template = gantt.templates.task_end_date || gantt.templates.task_date;\n\t\t\tendspan.innerHTML = template(end_date);\n\t\t}\n\n\t\tfunction _change_duration(step) {\n\t\t\tvar value = duration.value;\n\n\t\t\tvalue = getFormatter(config).parse(value);\n\t\t\tif (window.isNaN(value))\n\t\t\t\tvalue = 0;\n\t\t\tvalue += step;\n\t\t\tif (value < 1) value = 1;\n\t\t\tduration.value = getFormatter(config).format(value);\n\t\t\t_calc_date();\n\t\t}\n\n\t\tbtns[0].onclick = gantt.bind(function() {\n\t\t\t_change_duration(-1 * gantt.config.duration_step);\n\t\t}, this);\n\t\tbtns[1].onclick = gantt.bind(function() {\n\t\t\t_change_duration(1 * gantt.config.duration_step);\n\t\t}, this);\n\t\ts[0].onchange = _calc_date;\n\t\ts[1].onchange = _calc_date;\n\t\ts[2].onchange = _calc_date;\n\t\tif (s[3]) s[3].onchange = _calc_date;\n\n\t\tduration.onkeydown = gantt.bind(function(e) {\n\t\t\tvar code; \n\n\t\t\te = e || window.event;\n\t\t\tcode = (e.charCode || e.keyCode || e.which);\n\t\t\t\n\t\t\tif (code == gantt.constants.KEY_CODES.DOWN) {\n\t\t\t\t_change_duration(-1 * gantt.config.duration_step);\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tif (code == gantt.constants.KEY_CODES.UP) {\n\t\t\t\t_change_duration(1 * gantt.config.duration_step);\n\t\t\t\treturn false;\n\t\t\t}\n\t\t\twindow.setTimeout(_calc_date, 1);\n\t\t}, this);\n\n\t\tduration.onchange = gantt.bind(_calc_date, this);\n\n\t\tmapping = gantt._resolve_default_mapping(config);\n\t\tif (typeof(mapping) === \"string\") mapping = {start_date: mapping};\n\n\t\tstart_date = ev[mapping.start_date] || new Date();\n\t\tend_date = ev[mapping.end_date] || gantt.calculateEndDate({\n\t\t\tstart_date: start_date,\n\t\t\tduration: 1,\n\t\t\ttask: ev\n\t\t});\n\t\tduration_val = Math.round(ev[mapping.duration]) || gantt.calculateDuration({\n\t\t\tstart_date: start_date,\n\t\t\tend_date: end_date,\n\t\t\ttask: ev\n\t\t});\n\t\tduration_val = getFormatter(config).format(duration_val);\n\n\t\tgantt.form_blocks._fill_lightbox_select(s, 0, start_date, map, config);\n\t\tduration.value = duration_val;\n\t\t_calc_date();\n\t};\n\n\tDurationControl.prototype.get_value = function(node, ev, config) {\n\t\tvar startDate = _getStartDate(node, config);\n\t\tvar duration = _getDuration(node, config);\n\t\tvar endDate = gantt.calculateEndDate({start_date: startDate, duration: duration, task: ev});\n\n\t\tif (typeof gantt._resolve_default_mapping(config) == \"string\") {\n\t\t\treturn startDate;\n\t\t}\n\n\t\treturn {\n\t\t\tstart_date: startDate,\n\t\t\tend_date: endDate,\n\t\t\tduration: duration\n\t\t};\n\t};\n\n\tDurationControl.prototype.focus = function(node) {\n\t\tgantt._focus(node.getElementsByTagName(\"select\")[0]);\n\t};\n\n\n\tfunction _getStartDate(node, config) {\n\t\tvar s = node.getElementsByTagName(\"select\");\n\t\tvar map = config._time_format_order;\n\t\tvar hours = 0;\n\t\tvar minutes = 0;\n\n\t\tif (gantt.defined(map[3])) {\n\t\t\tvar input = s[map[3]];\n\t\t\tvar time = parseInt(input.value, 10);\n\t\t\tif (isNaN(time) && input.hasAttribute(\"data-value\")) {\n\t\t\t\ttime = parseInt(input.getAttribute(\"data-value\"), 10);\n\t\t\t}\n\n\t\t\thours = Math.floor(time / 60);\n\t\t\tminutes = time % 60;\n\t\t}\n\t\treturn new Date(s[map[2]].value, s[map[1]].value, s[map[0]].value, hours, minutes);\n\t}\n\n\tfunction _getDuration(node, config) {\n\t\tvar duration = node.getElementsByTagName(\"input\")[1];\n\n\t\tduration = getFormatter(config).parse(duration.value);\n\t\tif (!duration || window.isNaN(duration)) duration = 1;\n\t\tif (duration < 0) duration *= -1;\n\t\treturn duration;\n\t}\n\n\treturn DurationControl; \n};","import __extends from \"../../../../utils/extends\";\nimport htmlHelpers from \"../../utils/html_helpers\";\nimport BaseConstrutor from \"./base_control\";\n\nexport default function(gantt) {\n\tvar _super = BaseConstrutor(gantt);\n\n\tfunction ConstraintControl() {\n\t\tvar self = _super.apply(this, arguments) || this;\n\t\treturn self;\n\t}\n\n\t__extends(ConstraintControl, _super);\n\n\tfunction isNonTimedConstraint(value) {\n\t\tif (!value || value === gantt.config.constraint_types.ASAP || value === gantt.config.constraint_types.ALAP) {\n\t\t\treturn true;\n\t\t} else {\n\t\t\treturn false;\n\t\t}\n\t}\n\n\tfunction toggleTimeSelect(timeSelects, typeValue) {\n\t\tvar isNonTimed = isNonTimedConstraint(typeValue);\n\t\tfor (var i = 0; i < timeSelects.length; i++) {\n\t\t\ttimeSelects[i].disabled = isNonTimed;\n\t\t}\n\t}\n\n\tConstraintControl.prototype.render = function (sns) {\n\t\tconst height = sns.height ? `height:${sns.height}px;` : '';\n\t\tlet html = `<div class='gantt_cal_ltext gantt_section_${sns.name}' ${height ? `style='${height}'` : ''}>`;\n\n\t\tvar options = [];\n\t\tfor (var i in gantt.config.constraint_types) {\n\t\t\toptions.push({ key: gantt.config.constraint_types[i], label: gantt.locale.labels[gantt.config.constraint_types[i]] });\n\t\t}\n\n\t\tsns.options = sns.options || options;\n\n\t\thtml += \"<span data-constraint-type-select>\" + htmlHelpers.getHtmlSelect(sns.options, [{ key: \"data-type\", value: \"constraint-type\" }]) + \"</span>\";\n\n\t\tvar timeLabel = gantt.locale.labels[\"constraint_date\"] || \"Constraint date\";\n\t\thtml += \"<label data-constraint-time-select>\" + timeLabel + \": \" + gantt.form_blocks.getTimePicker.call(this, sns) + \"</label>\";\n\n\t\thtml += \"</div>\";\n\t\treturn html;\n\t};\n\n\tConstraintControl.prototype.set_value = function (node, value, task, config) {\n\t\tvar typeSelect = node.querySelector(\"[data-constraint-type-select] select\");\n\t\tvar timeSelects = node.querySelectorAll(\"[data-constraint-time-select] select\");\n\t\tvar map = config._time_format_order;\n\n\t\tvar mapping = gantt._resolve_default_mapping(config);\n\n\t\tif (!typeSelect._eventsInitialized) {\n\t\t\ttypeSelect.addEventListener(\"change\", function (e) {\n\t\t\t\ttoggleTimeSelect(timeSelects, e.target.value);\n\t\t\t});\n\t\t\ttypeSelect._eventsInitialized = true;\n\t\t}\n\n\t\tvar constraintDate = task[mapping.constraint_date] || new Date();\n\t\tgantt.form_blocks._fill_lightbox_select(timeSelects, 0, constraintDate, map, config);\n\n\t\tvar constraintType = task[mapping.constraint_type] || gantt.getConstraintType(task);\n\t\ttypeSelect.value = constraintType;\n\t\ttoggleTimeSelect(timeSelects, constraintType);\n\t};\n\n\tConstraintControl.prototype.get_value = function (node, task, config) {\n\t\tvar typeSelect = node.querySelector(\"[data-constraint-type-select] select\");\n\t\tvar timeSelects = node.querySelectorAll(\"[data-constraint-time-select] select\");\n\n\t\tvar constraintType = typeSelect.value;\n\t\tvar constraintDate = null;\n\t\tif (!isNonTimedConstraint(constraintType)) {\n\t\t\tconstraintDate = gantt.form_blocks.getTimePickerValue(timeSelects, config);\n\t\t}\n\n\t\treturn {\n\t\t\tconstraint_type: constraintType,\n\t\t\tconstraint_date: constraintDate\n\t\t};\n\t};\n\n\tConstraintControl.prototype.focus = function (node) {\n\t\tgantt._focus(node.querySelector(\"select\"));\n\t};\n\n\treturn ConstraintControl;\n};","import __extends from \"../../../../utils/extends\";\n\nimport Super from \"./select_control\";\n\nexport default function(gantt) {\n\tconst _super = Super(gantt);\n\n\tfunction TypeselectControl() {\n\t\tvar self = _super.apply(this, arguments) || this;\n\n\t\treturn self;\n\t}\n\n\t__extends(TypeselectControl, _super);\n\n\tTypeselectControl.prototype.render = function(sns) {\n\t\tvar types = gantt.config.types,\n\t\t\tlocale = gantt.locale.labels,\n\t\t\toptions = [];\n\n\t\tvar filter = sns.filter || function (typeKey, typeValue) {\n\t\t\tif (!types.placeholder || typeValue !== types.placeholder) {\n\t\t\t\treturn true;\n\t\t\t}\n\t\t\treturn false;\n\t\t};\n\t\tfor (var i in types) {\n\t\t\tif (!filter(i, types[i]) === false) {\n\t\t\t\toptions.push({ key: types[i], label: locale[\"type_\" + i] });\n\t\t\t}\n\t\t}\n\t\tsns.options = options;\n\n\t\tvar oldOnChange = sns.onchange;\n\t\tsns.onchange = function () {\n\t\t\tgantt._lightbox_current_type = this.value;\n\t\t\tgantt.changeLightboxType(this.value);\n\t\t\tif (typeof oldOnChange == 'function') {\n\t\t\t\toldOnChange.apply(this, arguments);\n\t\t\t}\n\t\t};\n\n\t\treturn _super.prototype.render.apply(this, arguments);\n\t};\n\n\treturn TypeselectControl;\n};\n","\nimport __extends from \"../../../../utils/extends\";\nimport DurationFormatterNumeric from \"../../../common/duration_formatter_numeric\";\nimport BaseConstrutor from \"./base_control\";\n\nexport default function(gantt) {\n\tvar _super = BaseConstrutor(gantt);\n\n\tfunction DurationControl() {\n\t\tvar self = _super.apply(this, arguments) || this; \n\n\t\treturn self; \n\t}\n\n\tfunction getFormatter(config) {\n\t\treturn config.formatter || new DurationFormatterNumeric();\n\t}\n\n\tfunction _generateBaselineRow (node, baseline, task, config){\n\t\tconst time = \"<div class='gantt_time_selects'>\" + gantt.form_blocks.getTimePicker.call(gantt, config) + \"</div>\";\n\t\tlet durationLabel = \" \"+ gantt.locale.labels[gantt.config.duration_unit + \"s\"] +\" \";\n\t\tconst singleDate = config.single_date ? \" style='display:none'\" : \"\";\n\t\tconst readonly = config.readonly ? \" disabled='disabled'\" : \"\";\n\t\tconst ariaAttr = gantt._waiAria.lightboxDurationInputAttrString(config);\n\t\tconst deleteLabel = gantt.locale.labels.baselines_remove_button;\n\n\t\tlet durationInputClass = \"gantt_duration_value\";\n\t\tif(config.formatter) {\n\t\t\tdurationLabel = \"\";\n\t\t\tdurationInputClass += \" gantt_duration_value_formatted\";\n\t\t}\n\n\t\tconst durationEl = \"<div class='gantt_duration' \" + singleDate + \">\" +\n\t\t\"<div class='gantt_duration_inputs'>\" +\n\t\t\t\"<input type='button' class='gantt_duration_dec' value='−'\" + readonly + \">\" +\n\t\t\t\"<input type='text' value='5days' class='\"+durationInputClass+\"'\" + readonly + \" \" + ariaAttr + \">\" +\n\t\t\t\"<input type='button' class='gantt_duration_inc' value='+'\" + readonly + \">\"+\n\t\t\t\"</div>\" +\n\t\t\t\"<div class='gantt_duration_end_date'>\"+durationLabel+\"<span></span></div>\" +\n\t\t\t\"</div>\" +\n\t\t\t\"</div>\";\n\n\t\tconst deleteButton = `<div><div class='baseline_delete_button gantt_custom_button'>${deleteLabel}</div></div>`;\n\n\t\tconst baselineRow = document.createElement(\"div\");\n\t\tbaselineRow.className = \"gantt_section_time gantt_section_duration\";\n\t\tbaselineRow.setAttribute(\"data-baseline-id\", baseline.id);\n\t\tbaselineRow.innerHTML = time + durationEl + deleteButton + \"<br>\";\n\t\tnode.appendChild(baselineRow);\n\n\t\tvar s = baselineRow.getElementsByTagName(\"select\");\n\t\tvar inps = baselineRow.getElementsByTagName(\"input\");\n\t\tvar duration = inps[1];\n\t\tvar btns = [inps[0], inps[2]];\n\t\tvar endspan = baselineRow.getElementsByTagName(\"span\")[0];\n\t\tvar map = config._time_format_order;\n\t\tvar mapping;\n\t\tvar start_date;\n\t\tvar end_date;\n\t\tvar duration_val;\n\n\t\tconst deleteEl = baselineRow.querySelector(\".baseline_delete_button\");\n\t\tdeleteEl.onclick = function(e){\n\t\t\tconst section = baselineRow.parentNode;\n\t\t\tbaselineRow.innerHTML = \"\";\n\t\t\tbaselineRow.remove();\n\t\t\tif (section.innerHTML === \"\"){\n\t\t\t\tsection.innerHTML = gantt.locale.labels.baselines_section_placeholder;\n\t\t\t}\n\t\t};\n\t\t\n\n\t\tfunction _calc_date() {\n\t\t\tvar start_date = _getStartDate.call(gantt, baselineRow, config);\n\t\t\tvar duration = _getDuration.call(gantt, baselineRow, config);\n\t\t\tvar end_date = gantt.calculateEndDate({start_date: start_date, duration: duration, task: task});\n\n\t\t\tvar template = gantt.templates.task_end_date || gantt.templates.task_date;\n\t\t\tendspan.innerHTML = template(end_date);\n\t\t}\n\n\t\tfunction _change_duration(step) {\n\t\t\tvar value = duration.value;\n\n\t\t\tvalue = getFormatter(config).parse(value);\n\t\t\tif (window.isNaN(value))\n\t\t\t\tvalue = 0;\n\t\t\tvalue += step;\n\t\t\tif (value < 1) value = 1;\n\t\t\tduration.value = getFormatter(config).format(value);\n\t\t\t_calc_date();\n\t\t}\n\n\t\tbtns[0].onclick = gantt.bind(function() {\n\t\t\t_change_duration(-1 * gantt.config.duration_step);\n\t\t}, gantt);\n\t\tbtns[1].onclick = gantt.bind(function() {\n\t\t\t_change_duration(1 * gantt.config.duration_step);\n\t\t}, gantt);\n\t\ts[0].onchange = _calc_date;\n\t\ts[1].onchange = _calc_date;\n\t\ts[2].onchange = _calc_date;\n\t\tif (s[3]) s[3].onchange = _calc_date;\n\n\t\tduration.onkeydown = gantt.bind(function(e) {\n\t\t\tvar code; \n\n\t\t\te = e || window.event;\n\t\t\tcode = (e.charCode || e.keyCode || e.which);\n\t\t\t\n\t\t\tif (code == gantt.constants.KEY_CODES.DOWN) {\n\t\t\t\t_change_duration(-1 * gantt.config.duration_step);\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tif (code == gantt.constants.KEY_CODES.UP) {\n\t\t\t\t_change_duration(1 * gantt.config.duration_step);\n\t\t\t\treturn false;\n\t\t\t}\n\t\t\twindow.setTimeout(_calc_date, 1);\n\t\t}, gantt);\n\n\t\tduration.onchange = gantt.bind(_calc_date, gantt);\n\n\t\tmapping = gantt._resolve_default_mapping(config);\n\t\tif (typeof(mapping) === \"string\") mapping = {start_date: mapping};\n\n\t\tstart_date = baseline.start_date || new Date();\n\t\tend_date = baseline.end_date || gantt.calculateEndDate({\n\t\t\tstart_date: start_date,\n\t\t\tduration: 1,\n\t\t\ttask\n\t\t});\n\t\tduration_val = gantt.calculateDuration({\n\t\t\tstart_date: start_date,\n\t\t\tend_date: end_date,\n\t\t\ttask\n\t\t});\n\t\tduration_val = getFormatter(config).format(duration_val);\n\n\t\tgantt.form_blocks._fill_lightbox_select(s, 0, start_date, map, config);\n\t\tduration.value = duration_val;\n\t\t_calc_date();\n\t}\n\n\t__extends(DurationControl, _super);\n\n\tDurationControl.prototype.render = function(sns) {\n\t\tconst baselineSection = `<div style='height: ${sns.height || 100}px; padding-top:0px; font-size:inherit;' class='gantt_section_baselines'></div>`;\n\t\treturn baselineSection;\n\t};\n\n\tDurationControl.prototype.set_value = function(node, value, task, config) {\n\t\tif (task.baselines){\n\t\t\tnode.innerHTML = \"\";\n\n\t\t\ttask.baselines.forEach((baseline)=>{\n\t\t\t\t_generateBaselineRow(node, baseline, task, config);\n\t\t\t});\n\t\t} else {\n\t\t\tnode.innerHTML = gantt.locale.labels.baselines_section_placeholder;\n\t\t}\t\t\n\n\t};\n\n\tDurationControl.prototype.get_value = function(node, task, config) {\n\t\tconst baselines = [];\n\t\tconst baselineRows = node.querySelectorAll(`[data-baseline-id]`);\n\t\tbaselineRows.forEach((baselineNode)=>{\n\t\t\tconst baselineId = baselineNode.dataset.baselineId;\n\t\t\tconst baselineStore = gantt.getDatastore(\"baselines\");\n\t\t\tlet baseline = baselineStore.getItem(baselineId);\n\t\t\tlet updatedBaseline;\n\t\t\tif (baseline){\n\t\t\t\tupdatedBaseline = gantt.copy(baseline);\n\t\t\t} else {\n\t\t\t\tupdatedBaseline = {\n\t\t\t\t\tid: gantt.uid(),\n\t\t\t\t\ttask_id: task.id,\n\t\t\t\t\ttext: \"Baseline 1\"\n\t\t\t\t};\n\t\t\t}\n\t\t\tupdatedBaseline.start_date = _getStartDate(baselineNode, config);\n\t\t\tupdatedBaseline.duration = _getDuration(baselineNode, config);\n\t\t\tupdatedBaseline.end_date = gantt.calculateEndDate({start_date: updatedBaseline.start_date, duration: updatedBaseline.duration, task});\n\n\t\t\tbaselines.push(updatedBaseline);\n\t\t});\n\n\t\treturn baselines;\n\t};\n\n\tDurationControl.prototype.button_click = function (index, el, section, container) {\n\t\tif (gantt.callEvent(\"onSectionButton\", [gantt._lightbox_id, section]) === false) {\n\t\t\treturn;\n\t\t}\n\t\tif (el.closest(\".gantt_custom_button.gantt_remove_baselines\")){\n\t\t\tcontainer.innerHTML = gantt.locale.labels.baselines_section_placeholder;\n\t\t}\n\t\tif (el.closest(\".gantt_custom_button.gantt_add_baselines\")){\n\t\t\tif (container.innerHTML == gantt.locale.labels.baselines_section_placeholder){\n\t\t\t\tcontainer.innerHTML = \"\";\n\t\t\t}\n\t\t\tconst task = gantt.getTask(gantt._lightbox_id);\n\t\t\tconst baseline = {\n\t\t\t\tid: gantt.uid(),\n\t\t\t\ttask_id: task.id,\n\t\t\t\ttext: \"Baseline 1\",\n\t\t\t\tstart_date: task.start_date,\n\t\t\t\tend_date: task.end_date\n\t\t\t};\n\t\t\tconst config = gantt._get_typed_lightbox_config()[index];\n\t\t\t_generateBaselineRow(container, baseline, task, config);\n\t\t}\n\t};\n\n\tDurationControl.prototype.focus = function(node) {\n\t\tgantt._focus(node.getElementsByTagName(\"select\")[0]);\n\t};\n\n\n\tfunction _getStartDate(node, config) {\n\t\tvar s = node.getElementsByTagName(\"select\");\n\t\tvar map = config._time_format_order;\n\t\tvar hours = 0;\n\t\tvar minutes = 0;\n\n\t\tif (gantt.defined(map[3])) {\n\t\t\tvar input = s[map[3]];\n\t\t\tvar time = parseInt(input.value, 10);\n\t\t\tif (isNaN(time) && input.hasAttribute(\"data-value\")) {\n\t\t\t\ttime = parseInt(input.getAttribute(\"data-value\"), 10);\n\t\t\t}\n\n\t\t\thours = Math.floor(time / 60);\n\t\t\tminutes = time % 60;\n\t\t}\n\t\treturn new Date(s[map[2]].value, s[map[1]].value, s[map[0]].value, hours, minutes);\n\t}\n\n\tfunction _getDuration(node, config) {\n\t\tvar duration = node.getElementsByTagName(\"input\")[1];\n\n\t\tduration = getFormatter(config).parse(duration.value);\n\t\tif (!duration || window.isNaN(duration)) duration = 1;\n\t\tif (duration < 0) duration *= -1;\n\t\treturn duration;\n\t}\n\n\treturn DurationControl; \n};","import * as utils from \"../utils/utils\";\nimport env from \"../utils/env\";\nimport isHeadless from \"../utils/is_headless\";\nimport * as domHelpers from \"./ui/utils/dom_helpers\";\nimport * as codeHelpers from \"../utils/helpers\";\nimport domEventScope from \"./ui/utils/dom_event_scope\";\nimport messages from \"./ui/message\";\nimport ui from \"./ui/index\";\nimport createLayoutFacade from \"./facades/layout\";\nimport taskLayers from \"./data_task_layers\";\n\nimport skin from \"./ui/skin\";\nimport skyblue from \"../css/skins/skyblue\";\nimport meadow from \"../css/skins/meadow\";\nimport terrace from \"../css/skins/terrace\";\nimport broadway from \"../css/skins/broadway\";\nimport material from \"../css/skins/material\";\nimport dark from \"../css/skins/dark\";\nimport contrast_black from \"../css/skins/contrast_black\";\nimport contrast_white from \"../css/skins/contrast_white\";\nimport plugins from \"./ui/plugins\";\nimport touch from \"./ui/touch\";\nimport lightbox from \"./ui/lightbox\";\nimport lightbox_optional_time from \"./ui/lightbox/lightbox_optional_time\";\nimport wai_aria from \"./ui/wai_aria\";\n\n\nexport default function(gantt) {\n\n\tif(!env.isNode){\n\n\t\tgantt.utils = {\n\t\t\tarrayFind: codeHelpers.arrayFind,\n\t\t\tdom: domHelpers\n\t\t};\n\n\t\tvar domEvents = domEventScope();\n\t\tgantt.event = domEvents.attach;\n\t\tgantt.eventRemove = domEvents.detach;\n\t\tgantt._eventRemoveAll = domEvents.detachAll;\n\t\tgantt._createDomEventScope = domEvents.extend;\n\n\t\tutils.mixin(gantt, messages(gantt));\n\t\tvar uiApi = ui.init(gantt);\n\t\tgantt.$ui = uiApi.factory;\n\t\tgantt.$ui.layers = uiApi.render;\n\t\tgantt.$mouseEvents = uiApi.mouseEvents;\n\t\tgantt.$services.setService(\"mouseEvents\", function () {\n\t\t\treturn gantt.$mouseEvents;\n\t\t});\n\t\tgantt.mixin(gantt, uiApi.layersApi);\n\n\t\ttaskLayers(gantt);\n\n\t\tgantt.$services.setService(\"layers\", function () {\n\t\t\treturn uiApi.layersService;\n\t\t});\n\n\t\tgantt.mixin(gantt, createLayoutFacade());\n\t\tskin(gantt);\n\t\tskyblue(gantt);\n\t\tdark(gantt);\n\t\tmeadow(gantt);\n\t\tterrace(gantt);\n\t\tbroadway(gantt);\n\t\tmaterial(gantt);\n\t\tcontrast_black(gantt);\n\t\tcontrast_white(gantt);\n\t\tplugins(gantt);\n\t\ttouch(gantt);\n\t\tlightbox(gantt);\n\t\tlightbox_optional_time(gantt);\n\t\twai_aria(gantt);\n\n\t\tgantt.locate = function(e) {\n\t\t\tvar trg = domHelpers.getTargetNode(e);\n\n\t\t\t// ignore empty rows/cells of the timeline\n\t\t\tif(domHelpers.closest(trg, \".gantt_task_row\")){\n\t\t\t\treturn null;\n\t\t\t}\n\n\t\t\tvar targetAttribute = arguments[1] || this.config.task_attribute;\n\n\t\t\tvar node = domHelpers.locateAttribute(trg, targetAttribute);\n\t\t\tif(node){\n\t\t\t\treturn node.getAttribute(targetAttribute);\n\t\t\t}else{\n\t\t\t\treturn null;\n\t\t\t}\n\t\t};\n\n\t\tgantt._locate_css = function(e, classname, strict){\n\t\t\treturn domHelpers.locateClassName(e, classname, strict);\n\t\t};\n\n\t\tgantt._locateHTML = function(e, attribute) {\n\t\t\treturn domHelpers.locateAttribute(e, attribute || this.config.task_attribute);\n\t\t};\n\t}\n\n\tgantt.attachEvent(\"onParse\", function(){\n\t\tif(!isHeadless(gantt)){\n\t\t\tgantt.attachEvent(\"onGanttRender\", function(){\n\t\t\t\tif(gantt.config.initial_scroll){\n\t\t\t\t\tvar firstTask = gantt.getTaskByIndex(0);\n\t\t\t\t\tvar id = firstTask ? firstTask.id : gantt.config.root_id;\n\t\t\t\t\t// GS-1450. Don't scroll to the task if there is no timeline\n\t\t\t\t\tif(gantt.isTaskExists(id) && gantt.$task && gantt.utils.dom.isChildOf(gantt.$task, gantt.$container)){\n\t\t\t\t\t\tgantt.showTask(id);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}, {once: true});\n\t\t}\n\n\t});\n\n\tgantt.attachEvent(\"onBeforeGanttReady\", function(){\n\t\tif (!this.config.scroll_size)\n\t\t\tthis.config.scroll_size = domHelpers.getScrollSize() || 15;\n\n\t\tif(!isHeadless(gantt)){\n\t\t\t// detach listeners before clearing old DOM, possible IE errors when accessing detached nodes\n\t\t\tthis._eventRemoveAll();\n\t\t\tthis.$mouseEvents.reset();\n\n\t\t\tthis.resetLightbox();\n\t\t}\n\n\t});\n\n\t// GS-1261: scroll the views to the right side when RTL is enabled\n\tgantt.attachEvent(\"onGanttReady\", function(){\n\t\tif(!isHeadless(gantt) && gantt.config.rtl){\n\t\t\tgantt.$layout.getCellsByType(\"viewCell\").forEach(function(cell){ \n\t\t\t\tvar attachedScrollbar = cell.$config.scrollX;\n\t\t\t\tif (!attachedScrollbar) return;\n\n\t\t\t\tvar scrollbar = gantt.$ui.getView(attachedScrollbar);\n\t\t\t\tif (scrollbar) scrollbar.scrollTo(scrollbar.$config.scrollSize,0);\n\n\t\t\t});\n\t\t}\n\t});\n\n\t// GS-1649: check if extensions are connected via files\n\tgantt.attachEvent(\"onGanttReady\", function(){\n\t\tif(!isHeadless(gantt)){\n\n\t\t\tvar activePlugins = gantt.plugins();\n\n\t\t\tvar availablePlugins = {\n\t\t\t\tauto_scheduling: gantt.autoSchedule,\n\t\t\t\tclick_drag: gantt.ext.clickDrag,\n\t\t\t\tcritical_path: gantt.isCriticalTask,\n\t\t\t\tdrag_timeline: gantt.ext.dragTimeline,\n\t\t\t\texport_api: gantt.exportToPDF,\n\t\t\t\tfullscreen: gantt.ext.fullscreen,\n\t\t\t\tgrouping: gantt.groupBy,\n\t\t\t\tkeyboard_navigation: gantt.ext.keyboardNavigation,\n\t\t\t\tmarker: gantt.addMarker,\n\t\t\t\tmultiselect: gantt.eachSelectedTask,\n\t\t\t\toverlay: gantt.ext.overlay,\n\t\t\t\tquick_info: gantt.templates.quick_info_content,\n\t\t\t\ttooltip: gantt.ext.tooltips,\n\t\t\t\tundo: gantt.undo\n\t\t\t};\n\n\t\t\tfor (let plugin in availablePlugins){\n\t\t\t\tif (availablePlugins[plugin] && !activePlugins[plugin]){\n\t\t\t\t\t// eslint-disable-next-line no-console\n\t\t\t\t\tconsole.warn(`You connected the '${plugin}' extension via an obsolete file. \nTo fix it, you need to remove the obsolete file and connect the extension via the plugins method: https://docs.dhtmlx.com/gantt/api__gantt_plugins.html`);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t});\n};","export default function(gantt) {\n\tdelete gantt.addTaskLayer;\n\tdelete gantt.addLinkLayer;\n};","function createLayoutFacade(){\n\n\tfunction getTimeline(gantt){\n\t\treturn gantt.$ui.getView(\"timeline\");\n\t}\n\n\tfunction getGrid(gantt){\n\t\treturn gantt.$ui.getView(\"grid\");\n\t}\n\n\tfunction getBaseCell(gantt){\n\t\tvar timeline = getTimeline(gantt);\n\t\tif (timeline && !timeline.$config.hidden){\n\t\t\treturn timeline;\n\t\t} else{\n\t\t\tvar grid = getGrid(gantt);\n\t\t\tif (grid && !grid.$config.hidden){\n\t\t\t\treturn grid;\n\t\t\t} else {\n\t\t\t\treturn null;\n\t\t\t}\n\t\t}\n\t}\n\n\tfunction getVerticalScrollbar(gantt){\n\t\tvar baseCell = null;\n\t\t// GS-1150: if we reorder or resize something in the grid, we should obtain the grid container\n\t\tvar gridDrag = false;\n\t\tvar gridMarkers = [\n\t\t\t\".gantt_drag_marker.gantt_grid_resize_area\",\n\t\t\t\".gantt_drag_marker .gantt_row.gantt_row_task\",\n\t\t\t\".gantt_drag_marker.gantt_grid_dnd_marker\"\n\t\t];\n\t\tgridMarkers.forEach(function (selector) {\n\t\t\tgridDrag = gridDrag || !!document.querySelector(selector);\n\t\t});\n\t\tif (gridDrag){\n\t\t\tbaseCell = getGrid(gantt);\n\t\t} else{\n\t\t\tbaseCell = getBaseCell(gantt);\n\t\t}\n\n\t\t// GS-1827. If there is no grid and timeline, there is no scrollbar for them\n\t\tif (!baseCell){\n\t\t\treturn null;\n\t\t}\n\n\t\tvar verticalScrollbar = getAttachedScrollbar(gantt, baseCell, \"scrollY\");\n\t\treturn verticalScrollbar;\n\t}\n\n\tfunction getHorizontalScrollbar(gantt){\n\t\tvar baseCell = getBaseCell(gantt);\n\t\tif (!baseCell || baseCell.id == \"grid\"){\n\t\t\treturn null; // if the timeline is not displayed, do not return the scrollbar\n\t\t}\n\t\tvar horizontalScrollbar = getAttachedScrollbar(gantt, baseCell, \"scrollX\");\n\t\treturn horizontalScrollbar;\n\t}\n\n\tfunction getAttachedScrollbar(gantt, cell, type){\n\t\tvar attachedScrollbar = cell.$config[type];\n\t\tvar scrollbarView = gantt.$ui.getView(attachedScrollbar);\n\t\treturn scrollbarView;\n\t}\n\n\tvar DEFAULT_VALUE = \"DEFAULT_VALUE\";\n\n\tfunction tryCall(getView, method, args, fallback){\n\t\tvar view = getView(this);\n\t\tif (!(view && view.isVisible())) {\n\t\t\tif(fallback){\n\t\t\t\treturn fallback();\n\t\t\t}else{\n\t\t\t\treturn DEFAULT_VALUE;\n\t\t\t}\n\t\t} else {\n\t\t\treturn view[method].apply(view, args);\n\t\t}\n\t}\n\n\treturn {\n\n\t\tgetColumnIndex: function(name) {\n\t\t\tvar res = tryCall.call(this, getGrid, \"getColumnIndex\", [name]);\n\t\t\tif(res === DEFAULT_VALUE){\n\t\t\t\treturn 0;\n\t\t\t}else{\n\t\t\t\treturn res;\n\t\t\t}\n\t\t},\n\n\t\tdateFromPos: function(x) {\n\t\t\tvar res = tryCall.call(this, getTimeline, \"dateFromPos\", Array.prototype.slice.call(arguments));\n\t\t\tif(res === DEFAULT_VALUE){\n\t\t\t\treturn this.getState().min_date;\n\t\t\t}else{\n\t\t\t\treturn res;\n\t\t\t}\n\t\t},\n\n\t\tposFromDate: function(date) {\n\t\t\tvar res = tryCall.call(this, getTimeline, \"posFromDate\", [date]);\n\t\t\tif(res === DEFAULT_VALUE){\n\t\t\t\treturn 0;\n\t\t\t}else{\n\t\t\t\treturn res;\n\t\t\t}\n\t\t},\n\n\t\tgetRowTop: function(index) {\n\t\t\tvar self = this;\n\t\t\tvar res = tryCall.call(self, getTimeline, \"getRowTop\", [index],\n\t\t\t\tfunction(){ return tryCall.call(self, getGrid, \"getRowTop\", [index]);}\n\t\t\t\t);\n\n\t\t\tif(res === DEFAULT_VALUE){\n\t\t\t\treturn 0;\n\t\t\t}else{\n\t\t\t\treturn res;\n\t\t\t}\n\t\t},\n\n\t\tgetTaskTop: function(id) {\n\t\t\tvar self = this;\n\t\t\tvar res = tryCall.call(self, getTimeline, \"getItemTop\", [id],\n\t\t\t\tfunction(){ return tryCall.call(self, getGrid, \"getItemTop\", [id]);}\n\t\t\t);\n\n\t\t\tif(res === DEFAULT_VALUE){\n\t\t\t\treturn 0;\n\t\t\t}else{\n\t\t\t\treturn res;\n\t\t\t}\n\t\t},\n\n\n\t\tgetTaskPosition: function(task, start_date, end_date) {\n\t\t\tvar res = tryCall.call(this, getTimeline, \"getItemPosition\", [task, start_date, end_date]);\n\n\t\t\tif(res === DEFAULT_VALUE){\n\t\t\t\tvar top = this.getTaskTop(task.id);\n\t\t\t\tvar height = this.getTaskBarHeight(task.id);\n\n\t\t\t\treturn {\n\t\t\t\t\tleft: 0,\n\t\t\t\t\ttop: top,\n\t\t\t\t\theight: height,\n\t\t\t\t\twidth: 0\n\t\t\t\t};\n\t\t\t}else{\n\t\t\t\treturn res;\n\t\t\t}\n\t\t},\n\n\t\tgetTaskBarHeight: function(taskId, isMilestoneRender) {\n\t\t\tvar self = this;\n\t\t\tvar res = tryCall.call(self, getTimeline, \"getBarHeight\", [taskId, isMilestoneRender],\n\t\t\t\tfunction(){ return tryCall.call(self, getGrid, \"getItemHeight\", [taskId]);}\n\t\t\t);\n\n\t\t\tif(res === DEFAULT_VALUE){\n\t\t\t\treturn 0;\n\t\t\t}else{\n\t\t\t\treturn res;\n\t\t\t}\n\t\t},\n\n\t\tgetTaskHeight: function(taskId) {\n\t\t\tvar self = this;\n\t\t\tvar res = tryCall.call(self, getTimeline, \"getItemHeight\", [taskId],\n\t\t\t\tfunction(){ return tryCall.call(self, getGrid, \"getItemHeight\", [taskId]);}\n\t\t\t);\n\n\t\t\tif(res === DEFAULT_VALUE){\n\t\t\t\treturn 0;\n\t\t\t}else{\n\t\t\t\treturn res;\n\t\t\t}\n\t\t},\n\n\n\t\tcolumnIndexByDate: function(date) {\n\t\t\tvar res = tryCall.call(this, getTimeline, \"columnIndexByDate\", [date]);\n\t\t\tif(res === DEFAULT_VALUE){\n\t\t\t\treturn 0;\n\t\t\t}else{\n\t\t\t\treturn res;\n\t\t\t}\n\t\t},\n\n\t\troundTaskDates: function() {\n\t\t\ttryCall.call(this, getTimeline, \"roundTaskDates\", []);\n\t\t},\n\n\t\tgetScale: function() {\n\t\t\tvar res = tryCall.call(this, getTimeline, \"getScale\", []);\n\t\t\tif(res === DEFAULT_VALUE){\n\t\t\t\treturn null;\n\t\t\t}else{\n\t\t\t\treturn res;\n\t\t\t}\n\t\t},\n\n\t\tgetTaskNode: function(id) {\n\t\t\tvar timeline = getTimeline(this);\n\t\t\tif (!timeline || !timeline.isVisible()) {\n\t\t\t\treturn null;\n\t\t\t} else {\n\t\t\t\tvar node = timeline._taskRenderer.rendered[id];\n\t\t\t\tif(!node){\n\t\t\t\t\tvar domAttr = timeline.$config.item_attribute;\n\t\t\t\t\tnode = timeline.$task_bars.querySelector(\"[\" +domAttr+ \"='\"+id+\"']\");\n\t\t\t\t}\n\n\t\t\t\treturn node || null;\n\t\t\t}\n\t\t},\n\n\n\t\tgetLinkNode: function(id) {\n\t\t\tvar timeline = getTimeline(this);\n\t\t\tif (!timeline.isVisible()) {\n\t\t\t\treturn null;\n\t\t\t} else {\n\t\t\t\treturn timeline._linkRenderer.rendered[id];\n\t\t\t}\n\t\t},\n\n\t\tscrollTo: function(left, top){\n\t\t\tvar vertical = getVerticalScrollbar(this);\n\t\t\tvar horizontal = getHorizontalScrollbar(this);\n\n\t\t\tvar oldH = {position: 0},\n\t\t\t\toldV = {position: 0};\n\n\t\t\tif(vertical){\n\t\t\t\toldV = vertical.getScrollState();\n\t\t\t}\n\t\t\tif(horizontal){\n\t\t\t\toldH = horizontal.getScrollState();\n\t\t\t}\n\n\t\t\tvar scrollHorizontal = (horizontal && left*1 == left);\n\t\t\tvar scrollVertical = (vertical && top*1 == top);\n\t\t\tvar scrollBoth = scrollHorizontal && scrollVertical;\n\n\t\t\tif(scrollBoth){\n\t\t\t\t// some views will be scrolled both horizontally and vertically and smart rendering can be called twice\n\t\t\t\t// set flag in order not to invoke smart rendering at the horizontal scroll stage\n\t\t\t\t// so it will repaint only once when the scroll is completed\n\t\t\t\tvar verticalViews = vertical._getLinkedViews();\n\t\t\t\tvar horizontalViews = horizontal._getLinkedViews();\n\n\t\t\t\tvar commonViews = [];\n\t\t\t\tfor(var i = 0; i < verticalViews.length; i++){\n\t\t\t\t\tfor(var j = 0; j < horizontalViews.length; j++){\n\n\t\t\t\t\t\tif(verticalViews[i].$config.id && horizontalViews[j].$config.id && verticalViews[i].$config.id === horizontalViews[j].$config.id){\n\t\t\t\t\t\t\tcommonViews.push(verticalViews[i].$config.id);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (scrollHorizontal){\n\t\t\t\tif(commonViews){\n\t\t\t\t\tcommonViews.forEach((function(viewId){\n\t\t\t\t\t\tthis.$ui.getView(viewId).$config.$skipSmartRenderOnScroll = true;\n\t\t\t\t\t}).bind(this));\n\t\t\t\t}\n\n\t\t\t\thorizontal.scroll(left);\n\t\t\t\tif(commonViews){\n\t\t\t\t\tcommonViews.forEach((function(viewId){\n\t\t\t\t\t\tthis.$ui.getView(viewId).$config.$skipSmartRenderOnScroll = false;\n\t\t\t\t\t}).bind(this));\n\t\t\t\t}\n\t\t\t}\n\t\t\tif(scrollVertical){\n\t\t\t\tvertical.scroll(top);\n\t\t\t}\n\n\t\t\tvar newV = {position: 0},\n\t\t\t\tnewH = {position: 0};\n\t\t\tif(vertical){\n\t\t\t\tnewV = vertical.getScrollState();\n\t\t\t}\n\t\t\tif(horizontal){\n\t\t\t\tnewH = horizontal.getScrollState();\n\t\t\t}\n\n\t\t\tthis.callEvent(\"onGanttScroll\", [oldH.position, oldV.position, newH.position, newV.position]);\n\t\t},\n\n\t\tshowDate: function(date){\n\t\t\tvar date_x = this.posFromDate(date);\n\t\t\tvar scroll_to = Math.max(date_x - this.config.task_scroll_offset, 0);\n\t\t\tthis.scrollTo(scroll_to);\n\t\t},\n\t\tshowTask: function(id) {\n\t\t\tvar pos = this.getTaskPosition(this.getTask(id));\n\n\t\t\t// GS-1261: we need to show the start_date even in the RTL mode\n\t\t\tvar leftPos = pos.left;\n\t\t\tif (this.config.rtl) leftPos = pos.left + pos.width;\n\n\t\t\tvar left = Math.max(leftPos - this.config.task_scroll_offset, 0);\n\n\t\t\tvar dataHeight = this._scroll_state().y;\n\t\t\tvar top;\n\t\t\tif(!dataHeight){\n\t\t\t\ttop = pos.top;\n\t\t\t}else{\n\t\t\t\ttop = pos.top - (dataHeight - this.getTaskBarHeight(id))/2;\n\t\t\t}\n\n\t\t\tthis.scrollTo(left, top);\n\t\t\t// GS-1150: if the grid and timeline have different scrollbars, we need to scroll thegrid to show the task\n\t\t\tvar gridCell = getGrid(this);\n\t\t\tvar timelineCell = getTimeline(this);\n\t\t\tif (gridCell && timelineCell && gridCell.$config.scrollY != timelineCell.$config.scrollY){\n\t\t\t\tvar gridScrollbar = getAttachedScrollbar(this, gridCell, \"scrollY\");\n\t\t\t\tgridScrollbar.scrollTo(null, top);\n\t\t\t}\n\t\t},\n\t\t_scroll_state: function(){\n\t\t\tvar result = {\n\t\t\t\tx: false,\n\t\t\t\ty: false,\n\t\t\t\tx_pos: 0,\n\t\t\t\ty_pos: 0,\n\t\t\t\tscroll_size: this.config.scroll_size + 1,//1px for inner content\n\t\t\t\tx_inner: 0,\n\t\t\t\ty_inner: 0\n\t\t\t};\n\n\t\t\tvar scrollVer = getVerticalScrollbar(this),\n\t\t\t\tscrollHor = getHorizontalScrollbar(this);\n\t\t\tif(scrollHor){\n\t\t\t\tvar horState = scrollHor.getScrollState();\n\t\t\t\tif(horState.visible){\n\t\t\t\t\tresult.x = horState.size;\n\t\t\t\t\tresult.x_inner = horState.scrollSize;\n\t\t\t\t}\n\t\t\t\tresult.x_pos = horState.position || 0;\n\t\t\t}\n\n\t\t\tif(scrollVer){\n\t\t\t\tvar verState = scrollVer.getScrollState();\n\t\t\t\tif(verState.visible){\n\t\t\t\t\tresult.y = verState.size;\n\n\t\t\t\t\tresult.y_inner = verState.scrollSize;\n\t\t\t\t}\n\t\t\t\tresult.y_pos = verState.position || 0;\n\t\t\t}\n\n\t\t\treturn result;\n\t\t},\n\t\tgetScrollState: function(){\n\t\t\tvar state = this._scroll_state();\n\t\t\treturn { x:state.x_pos, y:state.y_pos, inner_width:state.x, inner_height:state.y, width: state.x_inner, height: state.y_inner };\n\t\t},\n\n\t\tgetLayoutView: function(cellName){\n\t\t\treturn this.$ui.getView(cellName);\n\t\t},\n\n\t\tscrollLayoutCell: function(cellName, left, top){\n\t\t\tconst cell = this.$ui.getView(cellName);\n\t\t\tif (!cell){\n\t\t\t\treturn false;\n\t\t\t}\n\t\t\tif (left !== null){\n\t\t\t\tconst horizontalScroll = this.$ui.getView(cell.$config.scrollX);\n\t\t\t\tif (horizontalScroll){\n\t\t\t\t\thorizontalScroll.scrollTo(left, null);\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (top !== null){\n\t\t\t\tconst verticalScroll = this.$ui.getView(cell.$config.scrollY);\n\t\t\t\tif (verticalScroll){\n\t\t\t\t\tverticalScroll.scrollTo(null, top);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t};\n\n}\n\nexport default createLayoutFacade;","export default function(gantt) {\ngantt.skins.skyblue = {\n\tconfig:{\n\t\tgrid_width:370,\n\t\trow_height: 27,\n\t\tbar_height_padding:4,\n\t\tscale_height: 27,\n\t\tlink_line_width:1,\n\t\tlink_arrow_size:8,\n\t\tlink_radius:2,\n\t\tlightbox_additional_height:75\n\t},\n\t_second_column_width:95,\n\t_third_column_width:80\n};\n\n};","export default function(gantt) {\ngantt.skins.dark = {\n\tconfig:{\n\t\tgrid_width:390,\n\t\trow_height: 36,\n\t\tscale_height: 36,\n\t\tlink_line_width:2,\n\t\tlink_arrow_size:12,\n\t\tbar_height_padding:9,\n\t\tlightbox_additional_height:75\n\t},\n\t_second_column_width:100,\n\t_third_column_width:70\t\t\n};\n\n};","export default function(gantt) {\ngantt.skins.meadow = {\n\tconfig:{\n\t\tgrid_width:380,\n\t\trow_height: 27,\n\t\tscale_height: 30,\n\t\tlink_line_width:2,\n\t\tlink_arrow_size:10,\n\t\tbar_height_padding:4,\n\t\tlightbox_additional_height:72\n\t},\n\t_second_column_width:95,\n\t_third_column_width:80\n};\n\n};","export default function(gantt) {\ngantt.skins.terrace = {\n\tconfig:{\n\t\tgrid_width:390,\n\t\trow_height: 36,\n\t\tscale_height: 36,\n\t\tlink_line_width:2,\n\t\tlink_arrow_size:12,\n\t\tbar_height_padding:9,\n\t\tlightbox_additional_height:75\n\t},\n\t_second_column_width:100,\n\t_third_column_width:70\t\t\n};\n\n};","export default function(gantt) {\n\tgantt.skins.broadway = {\n\t\tconfig: {\n\t\t\tgrid_width: 390,\n\t\t\trow_height: 35,\n\t\t\tscale_height: 35,\n\t\t\tlink_line_width: 1,\n\t\t\tlink_arrow_size: 9,\n\t\t\tbar_height_padding:4,\n\t\t\tlightbox_additional_height: 86\n\t\t},\n\t\t_second_column_width: 100,\n\t\t_third_column_width: 80,\n\n\t\t_lightbox_template: \"<div class='gantt_cal_ltitle'><span class='gantt_mark'>&nbsp;</span><span class='gantt_time'></span><span class='gantt_title'></span><div class='gantt_cancel_btn'></div></div><div class='gantt_cal_larea'></div>\",\n\t\t_config_buttons_left: {},\n\t\t_config_buttons_right: {\n\t\t\t\"gantt_delete_btn\": \"icon_delete\",\n\t\t\t\"gantt_save_btn\": \"icon_save\"\n\t\t}\n\t};\n};","export default function(gantt) {\n\tgantt.skins.material = {\n\t\tconfig: {\n\t\t\tgrid_width: 411,\n\t\t\trow_height: 34,\n\t\t\tscale_height: 36,\n\t\t\tlink_line_width: 2,\n\t\t\tlink_arrow_size: 12,\n\t\t\tbar_height_padding:9,\n\t\t\tlightbox_additional_height: 80\n\t\t},\n\t\t_second_column_width: 110,\n\t\t_third_column_width: 75,\n\t\t_redefine_lightbox_buttons: {\n\t\t\t\"buttons_left\": [\"dhx_delete_btn\"],\n\t\t\t\"buttons_right\": [\"dhx_cancel_btn\", \"dhx_save_btn\"]\n\t\t}\n\t};\n\n\tgantt.attachEvent(\"onAfterTaskDrag\", function (id) {\n\t\tvar t = gantt.getTaskNode(id);\n\t\tif (t) {\n\t\t\tt.className += \" gantt_drag_animation\";\n\t\t\tsetTimeout(function () {\n\t\t\t\tvar indx = t.className.indexOf(\" gantt_drag_animation\");\n\t\t\t\tif (indx > -1) {\n\t\t\t\t\tt.className = t.className.slice(0, indx);\n\t\t\t\t}\n\t\t\t}, 200);\n\t\t}\n\t});\n\n};","export default function(gantt) {\ngantt.skins[\"contrast_black\"] = {\n\tconfig:{\n\t\tgrid_width:390,\n\t\trow_height: 35,\n\t\tscale_height: 35,\n\t\tlink_line_width:2,\n\t\tlink_arrow_size:12,\n\t\tlightbox_additional_height:75\n\t},\n\t_second_column_width:100,\n\t_third_column_width:80\n};\n\n};","export default function(gantt) {\ngantt.skins[\"contrast_white\"] = {\n\tconfig:{\n\t\tgrid_width:390,\n\t\trow_height: 35,\n\t\tscale_height: 35,\n\t\tlink_line_width:2,\n\t\tlink_arrow_size:12,\n\t\tlightbox_additional_height:75\n\t},\n\t_second_column_width:100,\n\t_third_column_width:80\n};\n\n};","import autoscroll from \"./autoscroll\";\nimport jquery_hooks from \"./jquery_hooks\";\nimport dhtmlx_hooks from \"./dhtmlx_hooks\";\nimport TimelineZoom from \"./timeline_zoom\";\n\n\nexport default function(gantt){\n\tif(!gantt.ext){\n\t\tgantt.ext = {};\n\t}\n\n\tvar modules = [\n\t\tautoscroll,\n\t\tjquery_hooks,\n\t\tdhtmlx_hooks\n\t];\n\n\tfor(var i = 0; i < modules.length; i++){\n\t\tif(modules[i])\n\t\t\tmodules[i](gantt);\n\t}\n\n\tgantt.ext.zoom = new TimelineZoom(gantt);\n};","export default function(gantt) {\n\n\tgantt._extend_to_optional = function (lightbox_block) {\n\n\t\tvar duration = lightbox_block;\n\t\tvar optional_time = {\n\t\t\trender: duration.render,\n\t\t\tfocus: duration.focus,\n\t\t\tset_value: function (node, value, task, section) {\n\t\t\t\tvar mapping = gantt._resolve_default_mapping(section);\n\t\t\t\tif (!task[mapping.start_date] || (mapping.start_date == \"start_date\" && this._isAllowedUnscheduledTask(task))) {\n\t\t\t\t\toptional_time.disable(node, section);\n\t\t\t\t\tvar val = {};\n\n\t\t\t\t\tfor (var i in mapping) {\n\t\t\t\t\t\t//take default values from the time control from task start/end dates\n\t\t\t\t\t\tval[mapping[i]] = task[i];\n\t\t\t\t\t}\n\n\t\t\t\t\treturn duration.set_value.call(gantt, node, value, val, section);//set default value\n\t\t\t\t} else {\n\t\t\t\t\toptional_time.enable(node, section);\n\t\t\t\t\treturn duration.set_value.call(gantt, node, value, task, section);\n\t\t\t\t}\n\t\t\t},\n\t\t\tget_value: function (node, task, section) {\n\t\t\t\tif (section.disabled) {\n\t\t\t\t\treturn {start_date: null};\n\t\t\t\t} else {\n\t\t\t\t\treturn duration.get_value.call(gantt, node, task, section);\n\t\t\t\t}\n\t\t\t},\n\t\t\tupdate_block: function (node, section) {\n\t\t\t\tgantt.callEvent(\"onSectionToggle\", [gantt._lightbox_id, section]);\n\t\t\t\tnode.style.display = section.disabled ? \"none\" : \"\";\n\n\t\t\t\tif (section.button) {\n\t\t\t\t\tvar button = node.previousSibling.querySelector(\".gantt_custom_button_label\"),\n\t\t\t\t\t\tlabels = gantt.locale.labels;\n\n\t\t\t\t\tvar button_text = section.disabled ? labels[section.name + \"_enable_button\"] : labels[section.name + \"_disable_button\"];\n\n\t\t\t\t\tbutton.innerHTML = button_text;\n\t\t\t\t}\n\t\t\t},\n\t\t\tdisable: function (node, section) {\n\t\t\t\tsection.disabled = true;\n\t\t\t\toptional_time.update_block(node, section);\n\n\t\t\t},\n\t\t\tenable: function (node, section) {\n\t\t\t\tsection.disabled = false;\n\t\t\t\toptional_time.update_block(node, section);\n\t\t\t},\n\t\t\tbutton_click: function (index, el, section, container) {\n\t\t\t\tif (gantt.callEvent(\"onSectionButton\", [gantt._lightbox_id, section]) === false) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tvar config = gantt._get_typed_lightbox_config()[index];\n\t\t\t\tif (config.disabled) {\n\t\t\t\t\toptional_time.enable(container, config);\n\t\t\t\t} else {\n\t\t\t\t\toptional_time.disable(container, config);\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\t\treturn optional_time;\n\t};\n\n\tgantt.form_blocks.duration_optional = gantt._extend_to_optional(gantt.form_blocks.duration);\n\tgantt.form_blocks.time_optional = gantt._extend_to_optional(gantt.form_blocks.time);\n\n};","export default function(gantt){\n\tvar htmlTags = new RegExp(\"<(?:.|\\n)*?>\", \"gm\");\n\tvar extraSpaces = new RegExp(\" +\", \"gm\");\n\n\tfunction stripHTMLLite(htmlText){\n\t\treturn (htmlText + \"\")\n\t\t\t.replace(htmlTags, \" \").\n\t\t\treplace(extraSpaces, \" \");\n\t}\n\n\tvar singleQuotes = new RegExp(\"'\", \"gm\");\n\tfunction escapeQuotes(text){\n\t\treturn (text + \"\").replace(singleQuotes, \"&#39;\");\n\t}\n\n\tgantt._waiAria = {\n\t\tgetAttributeString: function(attr){\n\t\t\tvar attributes = [\" \"];\n\t\t\tfor(var i in attr){\n\t\t\t\tvar text = escapeQuotes(stripHTMLLite(attr[i]));\n\t\t\t\tattributes.push(i + \"='\" + text + \"'\");\n\t\t\t}\n\t\t\tattributes.push(\" \");\n\t\t\treturn attributes.join(\" \");\n\n\t\t},\n\n\t\tgetTimelineCellAttr:function(dateString){\n\n\t\t\treturn gantt._waiAria.getAttributeString({\"aria-label\": dateString});\n\t\t},\n\n\t\t_taskCommonAttr: function(task, div){\n\n\t\t\tif(!(task.start_date && task.end_date))\n\t\t\t\treturn;\n\n\t\t\tdiv.setAttribute(\"aria-label\", stripHTMLLite(gantt.templates.tooltip_text(task.start_date, task.end_date, task)));\n\n\t\t\tif(task.$dataprocessor_class){\n\t\t\t\tdiv.setAttribute(\"aria-busy\", true);\n\t\t\t}\n\n\t\t},\n\n\t\tsetTaskBarAttr: function(task, div){\n\t\t\tthis._taskCommonAttr(task, div);\n\n\t\t\t// task bars are complex elements that should be treated as a single element\n\t\t\tdiv.setAttribute(\"role\", \"img\");\n\n\t\t\tif(!gantt.isReadonly(task) && gantt.config.drag_move){\n\t\t\t\tif(task.id != gantt.getState(\"tasksDnd\").drag_id){\n\t\t\t\t\tdiv.setAttribute(\"aria-grabbed\", false);\n\t\t\t\t}else{\n\t\t\t\t\tdiv.setAttribute(\"aria-grabbed\", true);\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\n\t\ttaskRowAttr: function(task, div){\n\n\t\t\tthis._taskCommonAttr(task, div);\n\n\t\t\tif(!gantt.isReadonly(task) && gantt.config.order_branch){\n\t\t\t\tdiv.setAttribute(\"aria-grabbed\", false);\n\t\t\t}\n\n\t\t\tdiv.setAttribute(\"role\", \"row\");\n\t\t\t// selected attribute should be added only to the grid  because\n\t\t\t// other parts don't have the keyboard navigation\n\t\t\tdiv.setAttribute(\"aria-selected\", gantt.isSelectedTask(task.id) ? \"true\" : \"false\");\n\n\t\t\t// allowed values start from 1, set 1 for non-tree datastores\n\t\t\tdiv.setAttribute(\"aria-level\", task.$level + 1 || 1);\n\n\t\t\tif(gantt.hasChild(task.id)){\n\t\t\t\tdiv.setAttribute(\"aria-expanded\", task.$open ? \"true\" : \"false\");\n\t\t\t}\n\t\t},\n\n\t\tlinkAttr: function(link, div){\n\n\t\t\tvar linkTypes = gantt.config.links;\n\n\t\t\tvar toStart = link.type == linkTypes.finish_to_start || link.type == linkTypes.start_to_start;\n\t\t\tvar fromStart = link.type == linkTypes.start_to_start || link.type == linkTypes.start_to_finish;\n\n\t\t\tvar content = gantt.locale.labels.link + \" \" +  gantt.templates.drag_link(link.source, fromStart, link.target, toStart);\n\n\t\t\t// links are complex elements that should be treated as a single element\n\t\t\tdiv.setAttribute(\"role\", \"img\");\n\n\t\t\tdiv.setAttribute(\"aria-label\", stripHTMLLite(content));\n\t\t\tif(gantt.isReadonly(link)){\n\t\t\t\tdiv.setAttribute(\"aria-readonly\", true);\n\t\t\t}\n\t\t},\n\n\t\tgridSeparatorAttr: function(div){\n\t\t\t// the only valid role for the grid header\n\t\t\tdiv.setAttribute(\"role\", \"columnheader\");\n\t\t},\n\t\trowResizerAttr: function(div){\n\t\t\t// the only valid role for the grid header\n\t\t\tdiv.setAttribute(\"role\", \"row\");\n\t\t},\n\n\t\tlightboxHiddenAttr: function(div){\n\t\t\tdiv.setAttribute(\"aria-hidden\", \"true\");\n\t\t},\n\n\t\tlightboxVisibleAttr: function(div){\n\t\t\tdiv.setAttribute(\"aria-hidden\", \"false\");\n\t\t},\n\n\t\tlightboxAttr: function(div){\n\t\t\tdiv.setAttribute(\"role\", \"dialog\");\n\t\t\tdiv.setAttribute(\"aria-hidden\", \"true\");\n\t\t\tdiv.firstChild.setAttribute(\"role\", \"heading\");\n\t\t\tdiv.firstChild.setAttribute(\"aria-level\", \"1\");\n\t\t},\n\n\t\tlightboxButtonAttrString:function(buttonName){\n\t\t\treturn this.getAttributeString({\"role\":\"button\", \"aria-label\":gantt.locale.labels[buttonName], \"tabindex\":\"0\"});\n\t\t},\n\n\t\tlightboxHeader: function(div, headerText){\n\t\t\tdiv.setAttribute(\"aria-label\", headerText);\n\t\t},\n\n\t\tlightboxSelectAttrString: function(time_option){\n\t\t\tvar label = \"\";\n\n\t\t\tswitch (time_option) {\n\t\t\t\tcase \"%Y\":\n\t\t\t\t\tlabel = gantt.locale.labels.years;\n\t\t\t\t\tbreak;\n\t\t\t\tcase \"%m\":\n\t\t\t\t\tlabel = gantt.locale.labels.months;\n\t\t\t\t\tbreak;\n\t\t\t\tcase \"%d\":\n\t\t\t\t\tlabel = gantt.locale.labels.days;\n\t\t\t\t\tbreak;\n\t\t\t\tcase \"%H:%i\":\n\t\t\t\t\tlabel = gantt.locale.labels.hours + gantt.locale.labels.minutes;\n\t\t\t\t\tbreak;\n\t\t\t\tdefault:\n\t\t\t\t\tbreak;\n\t\t\t}\n\n\t\t\treturn gantt._waiAria.getAttributeString({\"aria-label\": label});\n\t\t},\n\n\t\tlightboxDurationInputAttrString: function(section){\n\t\t\treturn this.getAttributeString({\n\t\t\t\t\"aria-label\": gantt.locale.labels.column_duration,\n\t\t\t\t\"aria-valuemin\": \"0\",\n\t\t\t\t\"role\": \"spinbutton\"\n\t\t\t});\n\t\t},\n\n\t\tinlineEditorAttr: function(div){\n\t\t\tdiv.setAttribute(\"role\", \"row\");\n\t\t},\n\n\t\tgridAttrString: function(){\n\t\t\treturn [\" role='treegrid'\", gantt.config.multiselect ? \"aria-multiselectable='true'\" : \"aria-multiselectable='false'\", \" \"].join(\" \");\n\t\t},\n\n\n\t\tgridScaleRowAttrString: function(){\n\t\t\treturn \"role='row'\";\n\t\t},\n\n\t\tgridScaleCellAttrString: function(column, label){\n\t\t\tvar attrs = \"\";\n\t\t\tif(column.name == \"add\"){\n\t\t\t\t// a more precise role is button, but it is not valid for the grid header\n\t\t\t\tattrs = this.getAttributeString({\"role\":\"columnheader\", \"aria-label\": gantt.locale.labels.new_task});\n\t\t\t}else{\n\n\t\t\t\tvar attributes = {\n\t\t\t\t\t\"role\":\"columnheader\",\n\t\t\t\t\t\"aria-label\": label\n\t\t\t\t};\n\n\t\t\t\tif(gantt._sort && gantt._sort.name == column.name){\n\t\t\t\t\tif(gantt._sort.direction == \"asc\"){\n\t\t\t\t\t\tattributes[\"aria-sort\"] = \"ascending\";\n\t\t\t\t\t}else{\n\t\t\t\t\t\tattributes[\"aria-sort\"] = \"descending\";\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tattrs = this.getAttributeString(attributes);\n\t\t\t}\n\t\t\treturn attrs;\n\t\t},\n\n\t\tgridDataAttrString: function(){\n\t\t\treturn \"role='rowgroup'\";\n\t\t},\n\n\t\treorderMarkerAttr: function(div){\n\t\t\tdiv.setAttribute(\"role\", \"grid\");\n\t\t\tdiv.firstChild.removeAttribute(\"aria-level\");\n\t\t\tdiv.firstChild.setAttribute(\"aria-grabbed\", \"true\");\n\t\t},\n\n\t\tgridCellAttrString: function(column, textValue, task){\n\t\t\tvar attributes = {\"role\":\"gridcell\", \"aria-label\": textValue};\n\t\t\tif(!column.editor || gantt.isReadonly(task)){\n\t\t\t\tattributes[\"aria-readonly\"] = true;\n\t\t\t}\n\n\t\t\treturn this.getAttributeString(attributes);\n\t\t},\n\n\t\tgridAddButtonAttrString: function(column){\n\t\t\treturn this.getAttributeString({\"role\":\"button\", \"aria-label\": gantt.locale.labels.new_task});\n\t\t},\n\n\t\tmessageButtonAttrString: function(buttonLabel){\n\t\t\treturn \"tabindex='0' role='button' aria-label='\"+buttonLabel+\"'\";\n\t\t},\n\n\t\tmessageInfoAttr: function(div){\n\t\t\tdiv.setAttribute(\"role\", \"alert\");\n\t\t\t//div.setAttribute(\"tabindex\", \"-1\");\n\t\t},\n\n\t\tmessageModalAttr: function(div, uid){\n\t\t\tdiv.setAttribute(\"role\", \"dialog\");\n\t\t\tif(uid){\n\t\t\t\tdiv.setAttribute(\"aria-labelledby\", uid);\n\t\t\t}\n\n\t\t//\tdiv.setAttribute(\"tabindex\", \"-1\");\n\t\t},\n\n\t\tquickInfoAttr: function(div){\n\t\t\tdiv.setAttribute(\"role\", \"dialog\");\n\t\t},\n\n\t\tquickInfoHeaderAttrString: function(){\n\t\t\treturn \" role='heading' aria-level='1' \";\n\t\t},\n\n\t\tquickInfoHeader: function(div, header){\n\t\t\tdiv.setAttribute(\"aria-label\", header);\n\t\t},\n\n\t\tquickInfoButtonAttrString: function(label){\n\t\t\treturn gantt._waiAria.getAttributeString({\"role\":\"button\", \"aria-label\":label, \"tabindex\":\"0\"});\n\t\t},\n\n\t\ttooltipAttr: function(div){\n\t\t\tdiv.setAttribute(\"role\", \"tooltip\");\n\t\t},\n\n\t\ttooltipVisibleAttr: function(div){\n\t\t\tdiv.setAttribute(\"aria-hidden\", \"false\");\n\t\t},\n\n\t\ttooltipHiddenAttr: function(div){\n\t\t\tdiv.setAttribute(\"aria-hidden\", \"true\");\n\t\t}\n\t};\n\n\tfunction isDisabled(){\n\t\treturn !gantt.config.wai_aria_attributes;\n\t}\n\n\tfor(var i in gantt._waiAria){\n\t\tgantt._waiAria[i] = (function(payload){\n\t\t\treturn function(){\n\t\t\t\tif(isDisabled()){\n\t\t\t\t\treturn \"\";\n\t\t\t\t}\n\t\t\t\treturn payload.apply(this, arguments);\n\t\t\t};\n\t\t})(gantt._waiAria[i]);\n\t}\n\n\n};","import extensions from \"./ext/extensions_gpl\";\nimport base from \"./factory/make_instance_web\";\nimport scope from \"./utils/global\";\nconst gantt = (scope as any).gantt = base(extensions);\n\nexport default gantt;\nexport { gantt };","import \"../css/dhtmlxgantt.less\";\n\nimport factory from \"./make_instance_common\";\nimport ui from \"../core/ui_core\";\nimport ajaxLoading from \"../core/loading/ajax_loading\";\nimport dynamicLoading from \"../core/loading/dynamic_loading\";\n\nexport default function(supportedExtensions) {\n\tvar gantt = factory(supportedExtensions);\n\n\tif(!gantt.env.isNode){\n\t\tui(gantt);\n\t\tajaxLoading(gantt);\n\t\tdynamicLoading(gantt);\n\t}\n\n\treturn gantt;\n};","export default function(gantt) {\n\tgantt.load = function (url, type, callback) {\n\t\tthis._load_url = url;\n\t\tthis.assert(arguments.length, \"Invalid load arguments\");\n\n\t\tvar tp = 'json', cl = null;\n\t\tif (arguments.length >= 3) {\n\t\t\ttp = type;\n\t\t\tcl = callback;\n\t\t} else {\n\t\t\tif (typeof arguments[1] == \"string\")\n\t\t\t\ttp = arguments[1];\n\t\t\telse if (typeof arguments[1] == \"function\")\n\t\t\t\tcl = arguments[1];\n\t\t}\n\n\t\tthis._load_type = tp;\n\n\t\tthis.callEvent(\"onLoadStart\", [url, tp]);\n\n\t\treturn this.ajax.get(url, gantt.bind(function (l) {\n\t\t\tthis.on_load(l, tp);\n\t\t\tthis.callEvent(\"onLoadEnd\", [url, tp]);\n\t\t\tif (typeof cl == \"function\")\n\t\t\t\tcl.call(this);\n\t\t}, this));\n\t};\n};"],"names":["getNodePosition","elem","top","left","right","bottom","getBoundingClientRect","box","body","document","docElem","documentElement","parentNode","scrollTop","window","pageYOffset","scrollLeft","pageXOffset","clientTop","clientLeft","offsetWidth","offsetHeight","parseInt","offsetTop","offsetLeft","offsetParent","y","Math","round","x","width","height","isVisible","node","display","visibility","getComputedStyle","style","currentStyle","hasNonNegativeTabIndex","isNaN","getAttribute","hasHref","a","area","nodeName","loLowerCase","isEnabled","input","select","textarea","button","object","toLowerCase","hasAttribute","getFocusableNodes","root","nodes","querySelectorAll","join","nodesArray","Array","prototype","slice","call","i","length","$position","sort","b","tabIndex","splice","getScrollSize","div","createElement","cssText","appendChild","clientWidth","removeChild","max","getClassName","className","baseVal","indexOf","_trimString","addClassName","removeClassName","name","split","regEx","RegExp","replace","toNode","getElementById","querySelector","_slave","insertNode","newone","innerHTML","child","firstChild","removeNode","getChildNodes","css","ch","childNodes","len","out","obj","push","getTargetNode","e","trg","tagName","event","target","srcElement","shadowRoot","composedPath","locateAttribute","attribute","str","String","trim","this","apply","locateClassName","classname","strict","undefined","ind","charAt","getRelativeEventPosition","ev","d","clientX","clientY","getRelativeNodePosition","parent","childPos","parentPos","isChildOf","closest","element","selector","matches","msMatchesSelector","webkitMatchesSelector","el","contains","parentElement","nodeType","console","error","getClosestSizedElement","isShadowDomSupported","head","createShadowRoot","attachShadow","getActiveElement","activeElement","getSelection","focusNode","getRootNode","ShadowRoot","host","classList","test","scope","global","EventsManager$1","gantt","_mouseDown","_gantt","_domEvents","_createDomEventScope","selectedRegion","useKey","ignore","_target","getViewPort","_originPosition","_restoreOriginPosition","position","state","$services","getService","registerProvider","autoscroll","scheduledDndCoordinates","startDragAndDrop","setStart","copy","setPosition","setEnd","attach","filterTargets","utils","dom","_getCoordinates","eventElement","domHelpers.getRootNode","$root","coordinates","dragEnd","dragTimeline","ext","clickDrag","dragTimelineUseKey","config","drag_timeline","abs","relative","render","detachAll","unregisterProvider","detach","viewPort","viewPortBounds","absolute","EventHost","_silent_mode","listeners","_silentStart","_silentEnd","createEventStorage","handlers","index","eventStorage","combinedResult","handlerResult","arguments","addEvent","handler","settings","t","handlerId","id","once","originalHandler","removeEvent","clear","makeEventable","eventHost","attachEvent","eventName","thisObject","bind","attachAll","callback","callEvent","eventArguments","handlerName","concat","checkEvent","detachEvent","list","eventId","detachAllEvents","units","second","minute","hour","day","week","month","quarter","year","getSecondsInUnit","unit","forEach","arr","workArray","arrayFind","find","arrayIncludes","item","includes","isArray","pop","isDate","getFullYear","getMonth","getDate","isValidDate","getTime","delay","timeout","timer","result","$cancelTimeout","$pending","args","setTimeout","clearTimeout","$execute","replaceValidZeroId","rootId","checkZeroId","findBinary","array","prev","low","high","floor","SelectedRegion","view","_el","defaultRender","start","end","min","_singleRow","pos","_getTaskPositionByTop","_startPoint","_view","_viewPort","add","_callback","_endPoint","draw","eventable","singleRow","_useRequestAnimationFrame","useRequestAnimationFrame","requestAnimationFrame","getElement","startPoint","_startDate","dateFromPos","endPoint","_endDate","_positionPoint","positionPoint","getState","max_date","valueOf","tasksByTime","getTaskByTime","tasksByIndex","_getTasksByTop","startValue","endValue","startIndex","endIndex","getTaskByIndex","getItemIndexByTopPosition","task","getItemHeight","getItemTop","dataHeight","getTotalHeight","row_height","getTaskCount","EventsManager","_calculateDirectionVector","_trace","dots","vectors","resultVector","vector","magnitude","sqrt","angleDegrees","atan2","PI","_applyDndReadyStyles","_timeline","$task","_clearDndReadyStyles","remove","_getScrollPosition","timeline","$ui","getView","$config","scrollX","getScrollState","scrollY","_countNewScrollPosition","coords","shiftX","shiftY","_scrollState","_setScrollPosition","scrollLayoutCell","$id","_stopDrag","_originalReadonly","readonly","_originAutoscroll","_startDrag","enabled","clickDragUseKey","click_drag","scrollPosition","modals","modalsStack","isModal","afterPopup","$destroyed","focus","startModal","eventRemove","trapFocus","endModal","currentTarget","$keyboardNavigation","traceLightbox","getLightbox","focusElement","QuickInfo","show","_showForTask","_showAtCoordinates","hide","forced","qi","_quickInfoBox","_quickInfoBoxId","taskId","_quickInfoTask","quick_info_detached","getNode","setContainer","container","_container","setContent","content","defaultContent","header","title","date","buttons","quickinfo_buttons","_createQuickInfoElement","titleBox","titleContent","titleDate","main","controls","_waiAria","quickInfoHeader","html","ariaAttr","quickInfoButtonAttrString","locale","labels","_qiButtonClickHandler","_qiKeyPressHandler","_qi_button_click","code","which","_appendAtCoordinates","show_quick_info","_getContainer","_get_event_counter_part","xViewport","yViewport","_init_quick_info","_prepare_quick_info_classname","_fill_quick_data","_show_quick_info","offset","domEv","getTaskNode","getTaskRowNode","scroll","dx","dy","quickInfoAttr","quickInfoHeaderAttrString","getTask","_quickInfoReadonly","isReadonly","getTaskType","template","templates","quick_info_class","start_date","end_date","allowedButtons","isEditor","icon_delete","icon_edit","quick_info_title","quick_info_date","quick_info_content","popupHeight","scrolls","screenWidth","relativePopupBottom","mask","$click","$task_data","$grid_data","$grid","$layout","seed","plainObjectConstructor","constructor","toString","helpers.isDate","Date","helpers.isArray","Object","create","hasOwnProperty","mixin","source","force","f","defined","uid","functor","capture","addEventListener","removeEventListener","createScope","utils.event","utils.eventRemove","eventScope","staticArray","extend","Tooltip","_tooltipNode","tooltipAttr","_root","domHelpers.isChildOf","_isLikeMouseEvent","_calculateTooltipPosition","tooltipVisibleAttr","tooltipHiddenAttr","_getViewPort","viewport","_getViewPortSize","tooltipNode","tooltip","offsetX","tooltip_offset_x","offsetY","tooltip_offset_y","mouse","domHelpers.getRelativeEventPosition","containerPos","domHelpers.getNodePosition","TooltipManager","_listeners","domEventsScope","_initDelayedFunctions","delayHide","watchableTarget","eventTarget","domHelpers.getTargetNode","targetNode","domHelpers.closest","doOnMouseEnter","onmouseenter","onmousemove","onmouseleave","listener","cloneDomEvent","clone","createEvent","delayShow","helpers.delay","tooltip_timeout","tooltip_hide_timeout","noTrack","onBeforeUndo","onBeforeRedo","batchActions","Monitor","undo","_batchAction","_batchMode","_ignore","_ignoreMoveEvents","_initialTasks","_initialLinks","_nestedTasks","_nestedLinks","_undo","_attachEvents","type","overwrite","undo_types","_storeTask","link","_storeLink","isMoveEventsIgnored","newValue","_timeout","stopBatchAction","action","logAction","_storeTaskCommand","command","update","$local_index","getTaskIndex","oldValue","getInitialTask","getParent","_storeEntityCommand","move","entity","children","childrenLinks","_storeLinkCommand","taskIds","tasks","linkIds","_getLinks","setInitialTask","uniqueLinks","links","setInitialLink","$index","getGlobalTaskIndex","setInitialTaskObject","clearInitialTasks","getLink","deleteCacheCooldown","saveInitialAll","eachTask","clearInitialLinks","getLinks","getMoveObjectByTaskId","startIgnore","stopIgnore","startBatchAction","clearUndoStack","clearRedoStack","onTaskAdded","onTaskUpdated","onTaskDeleted","onLinkAdded","onLinkUpdated","onLinkDeleted","onTaskMoved","toggleIgnoreMoveEvents","store","nested","setNestedTasks","datastore","getDatastore","tindex","dragId","projectDrag","drag_id","isSummaryTask","drag_project","plugins","multiselect","selectedIds","getSelectedTasks","inlineEditors","onBeforeEditStartId","onEditStart","updateConfigs","undoEnabled","commands","old","actionType","entityType","_storeCommand","isTaskExists","getInitialLink","$source","$target","linkId","Undo","maxSteps","redoEnabled","invert","revert","value","inverseCommands","types","assert","_undoStack","_redoStack","stack","getRedoStack","undo_steps","undo_actions","redo","_pop","_reorderCommands","_applyAction","_push","shift","weights","any","actionWeights","weightA","entities","actions","methods","get","isExists","batchUpdate","method","getMethod","check","prop","copyProperty","startsWith","extensions","defaultConfig","eventsManager","destructor","fullscreen","isExpanded","fullscreenElement","mozFullScreenElement","webkitFullscreenElement","msFullscreenElement","isFullscreenAvailable","fullscreenEnabled","webkitFullscreenEnabled","mozFullScreenEnabled","msFullscreenEnabled","backupBodyPadding","overflow","padding","paddingTop","paddingRight","paddingBottom","paddingLeft","backupElementSizes","zIndex","modified","backupPositioning","updateSizes","expandGantt","onFullScreenChange","$container","getFullscreenElement","positions","originalPositioning","record","cantFullscreen","warning","log","requestArguments","webkitRequestFullscreen","Element","ALLOW_KEYBOARD_INPUT","requestFullscreen","msRequestFullscreen","mozRequestFullScreen","collapse","requestExitFullscreen","msExitFullscreen","mozCancelFullScreen","webkitExitFullscreen","exitFullscreen","toggle","expand","keyboard_navigation","keyboard_navigation_cells","_compose","parts","res","p","shortcuts","createCommand","modifiers","alt","ctrl","meta","keyCode","parse","shortcut","expr","getExpressions","words","getWords","j","commandKeys","specialKeys","charCodeAt","getCommandFromEvent","domEvent","shiftKey","altKey","ctrlKey","metaKey","printableKey","fromCharCode","getHashFromEvent","getHash","junctionChar","term","combinationChar","backspace","tab","enter","esc","space","up","down","home","pageup","pagedown","delete","insert","plus","f1","f2","f3","f4","f5","f6","f7","f8","f9","f10","f11","f12","EventHandler","_handlers","findHandler","hash","doAction","facade","preventDefault","returnValue","unbind","bindAll","map","initKeys","keys","domHelpers.getFocusableNodes","focusable","currentFocus","domHelpers.getActiveElement","currentIndex","lastItem","firstItem","GanttNode","blur","scrollHorizontal","dir","scale","getScale","step","scrollTo","posFromDate","scrollVertical","KeyNavNode","isValid","fallback","moveTo","dispatcher","setActiveNode","compareTo","canStringifyThis","canStringifyThat","eventFacade","setAttribute","$eventAttached","HeaderCell","show_grid","getVisibleTaskCount","getGridColumns","TaskRow","visibleColumns","fromDomElement","cellElement","domHelpers.locateClassName","previousSibling","$grid_scale","columns","taskRow","rootLevel","getChildren","root_id","TaskCell","click","createTask","globalIndex","splitItem","$split_subtask","parentId","nextIndex","locate","isTaskVisible","task_attribute","keptFocus","getTaskPosition","getTaskHeight","viewWidth","viewHeight","inner_width","inner_height","scroll_on_click","show_chart","task_scroll_offset","grid","scrollPositionX","scrollPositionY","attachedScrollbarHorizontal","scrollable","scrollbarHorizontal","attachedScrollbarVertical","scrollbarVertical","nextElement","prevTask","getPrev","nextTask","getNext","hasChild","$open","open","close","prevId","getPrevSibling","moveTask","updateTask","isSelectedTask","unselectTask","selectTask","showLightbox","columnIndex","domHelpers.locateAttribute","row","isActive","activeNode","globalNode","enable","getActiveNode","disable","getDefaultNode","setDefaultNode","inputs","focusGlobalNode","blurNode","focusChanged","keyDownHandler","defaultPrevented","ganttNode","awaitsFocus","clearDelay","isTaskFocused","isInlineEditorCell","isNoKeyboardNavigationElement","focusHandler","$preventDefault","reFocusActiveNode","outsideGantt","localName","domElement","mousedownHandler","locateTask","removeAttribute","onReady","$data","tasksStore","currentNode","gridDataTopScroll","gridDataBottomScroll","_smart_render","updateRender","_redrawTasks","renderers","items","focusedItemVisible","createdTaskId","keepFocusOnNewTask","placeholder","nodeConstructor","placeholder_task","focusOnCreate","oldId","newId","interval","setInterval","getScope","mode","scopes","headerCell","taskCell","findVisibleColumnIndex","columnName","clearInterval","keyNavFacade","addShortcut","scopeObject","getShortcutHandler","getCommandHandler","removeShortcut","column","keyboardNavigation","quick_info","quickInfo","text","substr","details","task_time","events","hidingFunction","clearQuickInfo","hideQuickInfo","showQuickInfo","tooltipManager","tooltips","tooltipFor","touch","touch_tooltip","targetTaskId","tooltip_text","hideTooltip","link_source_id","monitor","updTask","changeTaskCommandId","updLink","oldTaskId","newTaskId","changeLinkCommandId","updateTasksIds","entry","updateLinksIds","getUndoStack","setUndoStack","setRedoStack","saveState","getInitialState","marker","render_marker","show_markers","min_date","marker_class","markerHeight","getRowTop","timeline_placeholder","scrollHeight","initMarkerArea","markerArea","$marker_area","_markers","createDatastore","initItem","renderMarkers","createDataRender","defaultContainer","addLayer","getMarker","getItem","addMarker","addItem","deleteMarker","exists","removeItem","updateMarker","refresh","_getMarkers","getItems","multiselect_one_level","_multiselect","_selected","_one_level","_active","_first_selected_when_shift","getDefaultSelected","selected","getSelected","setFirstSelected","getFirstSelected","updateState","active","select_task","reset","setLastSelected","silent","unselect","getLastSelected","last","getSelectedId","afterSelect","isSelected","forSelected","isSameLevel","calculateTaskLevel","_quickRefresh","refreshTask","doSelection","_is_icon_open_click","target_ev","defaultLast","isLast","multiSelect","singleSelection","controller","cell","locateCell","inline_editors_multiselect_open","getEditorConfig","startEdit","blockSelection","first_indx","target_indx","last_indx","tmp","old_selectTask","old_unselectTask","toggleTaskSelection","eachSelectedTask","getLastSelectedTask","old_isSelected","new_id","task_id","oldSelectedId","oldSelectedTask","newSelectedTask","differentTreeLevel","$level","export_api","_apiUrl","previousDateRage","str_to_date","date_format","data","_serializeHtml","_prepareConfigPDF","_serializeAll","_fixColumns","raw","_preparePDFConfigRaw","version","_sendToExport","_pdfExportRouter","_serializePlain","dates","smartRendering","smart_rendering","visual","convert","_eachTaskTimed","_no_progress_colors","_serializeTimeline","_serializeGrid","rawDates","scales","_serializeScales","worktime","_getWorktimeSettings","formData","File","FormData","append","_sendImportAjaxExcel","_sendImportAjaxMSP","importFromPrimaveraP6","importFromMSProject","skip_circular_links","oldXmlFormat","xml_format","oldFormatDate","format_date","oldXmlDate","xml_date","oldDateFormat","exportServiceDateFormat","date_to_str","_customProjectProperties","_customTaskProperties","_clearRecLinks","_exportConfig","$custom_data","custom","exportToPrimaveraP6","exportToMSProject","label","url","pack","cb","ajax","post","base","$template","server","JSON","stringify","sheet","xhr","XMLHttpRequest","onreadystatechange","readyState","status","onload","info","responseText","setRequestHeader","send","encodeURIComponent","_xdr","loader","xdoc","xmlDoc","col","editor","editor_types","skin","_serializableGanttConfig","_markColumns","_ajaxToExport","form","_createHiddenForm","submit","_hidden_export_form","constraint_date","deadline","key","formatDate","_color_box","_color_hash","color","_getColor","backgroundColor","parsedRanges","minutes","range","startMinute","endMinute","defaultWorkTimes","hours","time","work_time","wTime","_working_time_helper","get_calendar","worktimes","parsed","_getMinutesWorktimeSettings","master","branch","_pull","_originalCopyObject","json","_copyObject","task_text","_copyObjectBase","rgb","match","toISOstring","_copyObjectColumns","_copyObjectPlain","getDayIndex","_day_index_by_date","columnIndexByDate","$start","$end","hiddenCells","scaleCellsWidth","$type","$rendered_type","tmps","$text","$left","leftside_text","$right","rightside_text","_copyObjectTable","$color","ct","val","date_grid","smartScales","smart_scales","_copyObjectAll","_exportSerialize","_getRaw","_scale_helpers","_get_scales","minWidth","min_column_width","autosizeMinWidth","_get_resize_options","autosize_min_width","scale_height","prepareConfigs","availWidth","autosize","_getScales","rtl","$scaleHelper","_copyObjectColors","cellColors","timeline_cell_class","task_cell_class","steps","trace_x","styles","cellCss","_getStyles","Infinity","col_width","format","date_scale","scaleCell","scaleCell_class","scaleCss","exportMode","cols","ccount","tree","xmlFormat","serialize","_lvl","_setLevel","_makeLinksSameLevel","skippedLinks","_clearCircDependencies","_clearLinksSameLevel","_clearLevel","usedTasks","prevLink","sources","$_source","_onCircDependencyFind","targets","curLink","targetTask","_source","targetLvl","linkT","sourceParent","targetParent","$_target","project","projectName","projectDates","getSubtaskDates","start_end","manual","auto_scheduling","durationUnit","projectProperties","taskProperties","exportToPDF","exportToPNG","exportToICal","exportToExcel","exportToJSON","importFromExcel","constants","KEY_CODES","UP","DOWN","LEFT","RIGHT","SPACE","ENTER","DELETE","ESC","TAB","ExtensionsManager","addExtension","_extensions","getExtension","layout","rows","resizer","finish_to_start","start_to_start","finish_to_finish","start_to_finish","milestone","auto_types","duration_unit","correct_work_time","skip_off_time","cascade_delete","autoscroll_speed","deepcopy_on_parse","show_links","show_task_cells","static_background","static_background_cells","branch_loading","branch_loading_property","show_loading","min_duration","start_on_monday","server_utc","show_progress","fit_tasks","preserve_scroll","container_resize_timeout","deadlines","drag_links","drag_progress","drag_resize","drag_move","drag_mode","resize","progress","round_dnd_dates","link_wrapper_width","link_arrow_size","autofit","align","scale_offset_minimal","inherit_scale_class","time_step","duration_step","task_date","time_picker","link_attribute","layer_attribute","buttons_left","_migrate_buttons","dhx_save_btn","dhx_cancel_btn","dhx_delete_btn","buttons_right","lightbox","sections","map_to","project_sections","milestone_sections","single_date","drag_lightbox","details_on_create","details_on_dblclick","initial_scroll","order_branch","order_branch_free","task_height","bar_height","bar_height_padding","min_grid_column_width","grid_resizer_column_attribute","keep_grid_width","grid_resize","grid_elastic_columns","show_tasks_outside_timescale","show_unscheduled","resize_rows","task_grid_row_resizer_attribute","min_task_grid_row_height","readonly_property","editable_property","calendar_property","resource_calendars","dynamic_resource_calendars","inherit_calendar","type_renderers","open_tree_initially","optimize_render","prevent_default_scroll","show_errors","wai_aria_attributes","horizontal_scroll_key","drag_multiple","csp","isWindowAwailable","env","isIE","navigator","userAgent","isIE6","isIE7","isIE8","isOpera","isChrome","isKHTML","isFF","isIPad","search","isEdge","isNode","serialized","createConfig","Error","async","headers","fastVersion","utc","dateToStrFn","Function","to_fixed","getISOWeek","getWeek","splt","strToDateFn","dateString","cspVersion","getUTCDate","getUTCMonth","getUTCFullYear","day_short","getUTCDay","getDay","day_full","month_short","month_full","getUTCHours","getHours","getUTCMinutes","getMinutes","getUTCSeconds","getSeconds","getUTCISOWeek","set","temp","month_short_hash","month_full_hash","UTC","canUseCsp","useCsp","dateHelper","init","s","date_part","setHours","hour_start","setTime","time_part","getTimezoneOffset","week_start","month_start","setDate","quarter_start","res_month","m","setMonth","year_start","day_start","setMinutes","minute_start","setSeconds","getMilliseconds","setMilliseconds","_add_days","modifiedDate","inc","originalDate","incCondition","getHoursCondition","getDateCondition","ndate","setYear","add_quarter","num","cspCompliantVersion","_getWeekNumber","isoWeek","nday","first_thursday","year_number","ordinal_date","convert_to_utc","parseDate","parse_date","token","_url","_token","_mode","_seed","_queue","api","_events","Accept","credentials","fetch","then","websocket","_wrapper","connect","_socket","onclose","n","location","protocol","o","r","WebSocket","onmessage","fire","onError","_send","_resubscribe","Promise","_uid","resolve","reject","onCall","filter","catch","onResponse","remoteEvents","remote","remote_client.Client","req","_ready","load","back","_remote","ready","on","checkTimeout","updPerSecond","_on_timeout","ceil","StateService","stateProviders","internal","utils.mixin","provider","Promise$1","$powerArray","$create","$removeAt","$remove","$find","$insertAt","$each","$map","$filter","isPlaceholderTask","DataStore","pull","$initItem","visibleOrder","powerArray","fullOrder","_skip_refresh","_filterRule","_searchVisibleOrder","_indexRangeCache","_getItemsCache","_attachDataChange","_parseInner","loaded","copyOnParse","utils.copy","isSilent","_updateOrder","updateItem","utils.defined","_removeItemInner","_addItemInner","order","data_size","getVisibleItems","getIndexRange","utils.uid","_changeIdInner","changeId","_moveInner","sindex","getIdByIndex","clearAll","alreadySilent","arraysEqual","arr1","arr2","quick","skipFilter","_quick_refresh","_mark_recompute","oldOrder","count","countVisible","eachItem","rule","filteredOrder","placeholderIds","_ganttConfig","from","to","cacheKey","ret","getIndexById","_getNullIfUndefined","getFirst","getLast","TreeDataStore","_branches","loadedItem","existingItem","$parentProperty","parentProperty","$getRootId","$openInitially","openInitially","_eachItemMainRangeCache","getConfig","splitParents","splitItems","taskOpenState","taskVisibility","haveSplitItems","_isSplitItem","canOpenSplitTasks","open_split_tasks","$expanded_branch","isHeadless","_buildTree","setParent","_add_branch","calculateItemLevel","getBranchIndex","targetIndex","_move_branch","$rendered_parent","_replace_branch_child","_traverseBranches","itemId","sid","source_pid","tbranch","tid","diff","childId","pid","getSiblings","getNextSibling","siblings","nextSibling","level","eachParent","_setParentInner","new_pid","_eachItemCached","cache","_eachItemIterate","startId","itemsStack","reverse","useCache","buildCache","startItem","parentsHash","old_parent","new_parent","old_id","newbranch","field","desc","criteria","original_criteria","els","renderedParent","actualParent","_skipTaskRecalculation","datastoreRender","itemRepainter","renderer","renders","getLayers","render_item","allData","loadedRanges","layer","layerData","get_visible_range","ids","prepare_data","render_items","update_items","extraDataArr","skipRepaint","batch_update","getDataRender","onUpdateRequest","change_id","getDatastores","storeNames","facadeFactory","$StoreType","self","selectedId","deleteItem","subItem","storeAccessName","dropService","storeList","setService","_getDatastores","refreshData","scrollState","stores","refresh_links","refreshLinks","refreshLink","_bulk_dnd","hasSplitParent","isSplitTask","linksStore","_update_flags","userdata","_clear_data","oldSelectId","_skipResourceRepaint","addTask","parentObj","deleteTask","utils.bind","startTask","changeTaskId","oldid","newid","getLinkCount","isLinkExists","addLink","newLink","updateLink","deleteLink","changeLinkId","ScaleHelper","services","getSum","sizes","summ","setSumWidth","sum_width","adjustSize","full_width","splitSize","full","share","sortScales","cellSize","_isLegacyMode","scaleConfig","scale_unit","subscales","_prepareScaleObject","primaryScale","legacyMode","initTemplate","scale_cell_class","getSubScales","docLink","warn","min_coll_width","container_width","minDate","maxDate","heights","configs","main_scale","cfg","initScaleConfig","processIgnores","initColSizes","limitVisibleRange","unshift","alineScaleColumns","reverseScale","setPosSettings","indexes","trace_indexes","trace_index_transition","_ignore_time_config","skip","probe","isWorkTime","ignore_x","display_count","min_col_width","line_height","cont_width","column_count","ignores","eachColumn","trace_x_ascending","iterateScales","lower_scale","upper_scale","upper_dates","lower_dates","prevUpper","target_index","upper_start","upper_end","lower_start","lower_end","targetWidth","curr","tzOffset","_correct_dst_change","lastDate","outDate","shared","_init_tasks_range","PrimaryScaleHelper","helper","start_interval","onlyProjectTasks","extendRangeForDates","constraint_type","constraint_types","ASAP","ALAP","baselines","baseline","calculateEndDate","duration","_min_date","_max_date","updateTasksRange","old_min","old_max","copyLinkIdsArray","targetHash","copyLinkIds","treeHelper","getSubtreeLinks","getSubtreeTasks","DataProcessorEvents","dp","$gantt","$dp","_dataProcessorHandlers","cascadeDelete","clientSideDelete","setGanttMode","setUpdated","_sendTaskOrder","deleteAfterConfirmation","needDbDelete","needCascadeDelete","dpMode","updateMode","setUpdateMode","cascade","storeItem","sendAllData","_tSend","_waitMode","itemLinks","_links","_dp","_tMode","_serverProcessor","_ganttMode","substring","serverProcessor","pluralizedMode","urlSeparator","upd","xml","_xmlNodeToJSON","isExist","objData","property","assignmentsStore","handleResourceCRUD","handleResourceAssignmentCRUD","handleBaselineCRUD","updated","updatedRows","clientOnly","getUserData","_in_progress","resources","dataprocessor_assignments","resource_assignment_store","insertedTasks","pendingAssignments","insertResourceAssignment","assignment","dataprocessor_resources","resourcesStore","resource_store","resource","dataprocessor_baselines","baselineStore","helpers.forEach","SimpleStorage","_storage","getStoredItem","_Vt","DataProcessor$1","serverProcessorURL","action_param","autoUpdate","_headers","_payload","_postDelim","_routerParametersFormat","_invalid","messages","inserted","deleted","invalid","invalid_cell","enableUTFencoding","total","payload","_serializeAsJson","_router","router","_utf","escape","getSyncState","dnd","rowId","findRow","existing","set_invalid","setUserData","is_invalid","markRow","sendData","_methods","editStop","pendingUpdateModes","modes","checkBeforeUpdate","_beforeSendData","_getRowData","_serializeAsJSON","serialize_one","security_key","pref","valid","_forEachUpdatedRow","_sendData","_getAllData","pattern","_uActions","btag","ganttMode","correct","originalSid","that","_xml","getGanttMode","reqUrl","filePath","tag","processCallback","afterUpdateCallback","finalizeUpdate","xmltop","cleanUpdate","atag","xpath","_initialized","_dp_init","_setDefaultTransactionMode","delete_confirmation","_change_id","_row_style","$dataprocessor_class","_delete_task","$drop_target","setDp","dataProcessorEvents","user","_user","_needUpdate","_updateBusy","afterAutoUpdate","fullSync","loadUpdate","xml_node","getUpdates","vers","_getXmlNodeValue","updates","newState","dataToSend","processedData","_cleanupArgumentsBeforeSend","_cleanupItemBeforeSend","updatedItem","output","taskState","taskAction","getActionByState","_onResolvedCreateUpdate","actionPromise","errorMsgStart","errorMsgEnd","queryParams","afterUpdate","dhxVersion","urlParams","_applyPayload","preprocessedData","query","setTransactionMode","nodeValue","hasOne","traversedObjects","_prepareDate","helpers.arrayIncludes","_prepareArray","_prepareObject","rawItem","processedItem","dataItem","_prepareDataItem","DataProcessor","DEPRECATED_api","DataProcessor.DataProcessor","createDataProcessor","tMode","createMethod","disableMethod","methodName","dummyMethod","restoreMethod","disableMethods","methodsHash","restoreMethods","batchUpdatePayload","noRedraw","dp_mode","call_dp","resetProjects","resetProjectDates","createWbs","_needRecalc","_isRecalcNeeded","_isGroupSort","_getWBSCode","_calcWBS","$virtual","$wbs","_setWBSCode","getWBSCode","getByWBSCode","_isFirst","_prevSibling","_wbs","_parent","wbs","resetCache","getTaskByWBSCode","createResourceMethods","resourceTaskCache","singleResourceCacheBuilt","falsyValuePrefix","random","resourceHashFunction","getCacheKey","resourceIds","typeFilter","getResourceTasks","matchingResources","resourceId","resourceValue","resource_id","selectAssignments","resource_property","owners","getTaskBy","propertyName","propertyValue","getResourceAssignments","assignments","resourcePlugin","renderEditableLabel","editable","$task_id","$resource_id","renderSummaryLabel","sum","reduce","Number","editableResourceCellTemplate","$role","editableResourceCellClass","capacity","getSummaryResourceAssignments","childResource","initEditableDiagram","resource_render_empty_cells","timeoutId","makeEditable","cancelAnimationFrame","contentEditable","getCellsByType","$content","assignmentEditInProcess","strValue","innerText","assignmentId","startDate","endDate","assignmentStore","nextChunk","calculateDuration","updateTaskAssignments","editable_resource_diagram","fetchTasks","lightbox_resources","lightboxOptions","resourceStoreConfig","initItems","storeType","$resourcesStore","lightboxOptionsFnc","options","updateCollection","histogram_cell_class","histogram_cell_label","histogram_cell_allocated","histogram_cell_capacity","defaultResourceCellClass","defaultResourceCellTemplate","resource_cell_value","resource_cell_class","resource_assignments","resourceAssignmentsProperty","process_resource_assignments","resourceAssignmentFormats","auto","singleValue","valueArray","resourceValueArray","assignmentsArray","resourceAssignmentFormat","assignmentModes","fixedDates","fixedDuration","default","initAssignmentFields","initDelay","timing","_assignmentTimeFromTask","resourceAssignmentsStore","_makeAssignmentsFromTask","resourceAssignments","detectFormat","usedIds","defaultMode","_updateTaskBack","_assignAssignments","getTaskAssignments","_loadAssignmentsFromTask","_syncAssignments","storeAssignments","taskValues","assignmentsStoreValues","inBoth","inTaskNotInStore","inStoreNotInTask","taskOwner","ownerId","foundOwnerAssignment","taskSearch","storeSearch","processedIds","inTask","inStore","ignoreFields","_syncOnTaskUpdate","totalAssignments","needUpdate","needUpdateFor","undoBatchCancel","assignmentsHash","unscheduled","idsSearch","deleteIds","resourceAssignmentsCache","resourceTaskAssignmentsCache","taskAssignmentsCache","searchTaskId","resourceTaskCacheKey","getTaskResources","uniqueResources","addPlaceholder","callIfEnabled","insertPlaceholder","placeholders","new_task","afterEdit","newTask","dataProcessor","_silencedPlaceholder","isPlaceholderLink","auto_task_types","checkTaskType","changedTypes","targetType","getTaskTypeToUpdate","$needsUpdate","updateParentTypes","group_mode","delTaskParent","allTypes","hasChildren","taskType","originalRowDndParent","originalMoveTaskParent","isParsingDone","updateAfterRemoveChild","DurationFormatterNumeric","canParse","_ie","LinkFormatterSimple","_linkReg","linkPart","exec","_findSource","lag","pred","reqTemplate","_ne","formatters","durationFormatter","DurationFormatter","linkFormatter","LinkFormatter","empty_state_screen","show_empty_state","emptyStateElement","isGanttEmpty","placeholderContainer","empty_state_text_link","empty_state_text_description","clickEvents","detachAddTaskEvents","domHelpers","getContainer","wrapper","marginTop","oldNodes","attachAddTaskEvent","renderContent","emptyStateElementNode","hasBaselinesBelow","baselinesOnDifferentRow","render_mode","childrenHaveBaselines","hasBaselines","isSplitParent","getMaxParentHeight","heightLimit","maxHeight","shrinkHeight","splitChild","parentHeight","getItemPosition","rowHeight","_adjustSplitParentHeight","maxParentHeight","adjustTaskHeightForBaselines","childHeight","_increaseSplitParentHeight","getLayoutView","getBarHeight","subtaskId","subtask","subtaskHeight","baselineSize","baselineAmount","subrowHeight","newBaseline","existingBaseline","shouldRepaint","iteratedBaselines","taskBaselines","exisingBaselines","getTaskBaselines","exisingBaseline","repaint","parsing","jsonParseError","on_load","resp","responseURL","_process_loading","collections","_load_collections","assignmentsByTasks","collections_loaded","collection","serverList","option","option_key","$ignore","dhx_security","serializeTask","serializeLink","_copyLink","rawLinks","baselineCopy","attrs_only","attributes","_getCollections","opts","itms","attrs","k","attr","_getXML","toptag","getXMLTopNode","skey","evs","oldxml","startdate","est","enddate","predecessortasks","message","IsWorkTimeArgument","calendar","ClosestWorkTimeArgument","CalculateEndDateArgument","GetDurationArgument","calendarArgumentsHelper","getWorkHoursArguments","helpers.isValidDate","setWorkTimeArguments","unsetWorkTimeArguments","isWorkTimeArguments","processedConfig","getClosestWorkTimeArguments","arg","_getStartEndConfig","param","argumentType","getDurationArguments","hasDurationArguments","calculateEndDateArguments","WorkTimeCalendarMerger","_getIntervals","hoursArray","_toHoursArray","intervalsArray","formatHHMM","secondsValue","minutePart","_intersectHourRanges","first","baseArray","overridesArray","current","_mergeAdjacentIntervals","_mergeHoursConfig","firstHours","secondHours","merge","firstConfig","secondConfig","mergedSettings","customWeeks","processCalendar","config1","config2","date1","date2","hours2","WorkUnitsMapCache","timestamp","_cache","has","subCache","rawValue","unitCache","yearCache","Map","WorkUnitsObjectCache","LargerUnitsCache","getMinutesPerWeek","weekStart","_weekCache","_calendar","minutesPerWeek","getHoursPerDay","getMinutesPerMonth","monthStart","_monthCache","minutesPerMonth","nextMonth","DateDurationCache","stepCache","durations","endDates","compute","_getCacheObject","startDateTimestamp","_endDateCacheKey","resultTimestamp","_durationCacheKey","endDateTimestamp","CalendarWorkTimeStrategy","argumentsHelper","_workingUnitsCache","_largeUnitsCache","_dateDurationCache","_worktime","_cached_timestamps","_cached_timestamps_count","_clearCaches","_getUnitOrder","_resetTimestampCache","_timestamp","_checkIfWorkingUnit","hasDuration","_is_work_day","_getWorkHours","_is_work_hour","startHour","endHour","_getTimeOfDayStamp","dayEnd","_is_work_minute","checkTime","_nextDate","_getWorkUnitsBetweenGeneric","stepStart","stepEnd","next","checkFirst","checkLast","isLastStep","_isWorkTime","unitOrder","biggerTimeUnit","_getClosestWorkTimeFuture","_getMinutesPerHour","hourStart","hourEnd","_getMinutesPerDay","durationMinutes","durationHours","_getWorkUnitsForRange","getUnitsPerDay","_getMinutesBetweenSingleDay","_getIntervalTimestamp","minuteFrom","minuteTo","_getMinutesBetween","firstDayStart","firstDayEnd","lastDayStart","lastDayEnd","startPart","endPart","_getHoursBetween","_setConfig","_parseSettings","haveCustomWeeks","customWeeksRangeStart","customWeeksRangeEnd","customWeeksBoundaries","_parseHours","minCustomRangeStart","maxCustomRangeEnd","customTime","rangeStart","rangeEnd","fromReadable","toReadable","currentWeek","_tryChangeCalendarSettings","backup","hasWorkTime","_arraysEqual","_compareSettings","mySettings","thatSettings","myDays","otherDates","myHours","otherHours","equals","myWeek","thatWeek","getWorkHours","dateValue","endHours","timestampRanges","part","timerangeConfig","durationSeconds","setWorkTime","calendarConfig","unsetWorkTime","reset_calendar","dateKey","isWorkUnit","setItem","getDuration","_calculateDuration","sign","mult","getEndDate","_calculateEndDate","_calculateMinuteEndDate","_subtractMinuteDate","_calculateHourEndDate","_addInterval","stopAction","added","dstShift","_addHoursUntilDayEnd","rangeHours","addHours","intervalEnd","durationLeft","hoursPerDay","_addMinutesUntilHourEnd","rangeMinutes","addMinutes","_subtractMinutesUntilHourStart","hourStartTimestamp","initialDateTimestamp","minutePrecision","_isMinutePrecision","addedInterval","calculatedDay","daySchedule","minutesInDay","dayStart","iterateFromDayEnd","isWorkHour","workInterval","prevInterval","minutesInHour","_getClosestWorkTimePast","times","lastInterval","getClosestWorkTime","_getClosestWorkTime","inputDate","direction","closestFuture","closestPast","_getClosestWorkTimeGeneric","_findClosestTimeInDay","resultDate","fromDayEnd","_getClosestWorkMinute","increment","hasRegularHours","_checkWorkHours","dayConfig","legacyResourceCalendarConfig","isLegacyResourceCalendarFormat","resourceCalendarsProperty","getResourceProperty","resourceCalendarsConfig","getCalendarIdFromLegacyConfig","calendarId","dynamicResourceCalendars","dynamicCalendars","getCalendarIdFromMultipleResources","manager","getResourceCalendar","tempCalendar","mergeCalendars","addCalendar","CalendarManager","_calendars","_legacyConfig","_isLegacyConfig","createDefaultCalendars","CalendarDisabledTimeStrategy","TimeCalculator","calendarManager","createArgumentsHelper","$disabledCalendar","NoWorkTimeCalendar","_convertWorkTimeSettings","days","calendars","mergeHelper","CalendarMergeHelper","_createCalendarFromConfig","createCalendar","apiCore","preparedConfig","parentCalendar","defaults","fulltime","getCalendar","getCalendars","_getOwnCalendar","resourceProperty","calendarsConfig","getTaskCalendar","taskObject","groupMode","currentTask","$effective_calendar","isCalendar","deleteCalendar","restoreConfigCalendars","possibleCalendar","every","fixedUnits","_getCalendar","worktimeFacadeFactory","timeCalculator","_hasDuration","isUnscheduledTask","_isAllowedUnscheduledTask","_isTaskInTimelineLimits","taskStart","taskEnd","_getProjectEnd","project_end","_getProjectStart","project_start","getDefaultTaskDate","parent_id","schedule_from_end","_set_default_task_timing","$new","showTask","_lightbox_id","_tasks_dnd","drag","getTaskTimingMode","task_type","$no_start","$no_end","scheduled_summary","updateTaskTiming","assignProjectDates","taskTiming","summaryDateFields","manuallyScheduledSummaryDateFields","dateFields","_init_task_timing","getSubtaskInfo","rollup","isScheduledSummary","task_mode","dirty","$calculate_duration","effectiveCalendar","taskMode","$rollup","getSubtaskDuration","_update_parents","updateAll","has_changed","startDateField","$auto_start_date","endDateField","$auto_end_date","oldStart","oldEnd","roundDate","upper","lower","colIndex","correctTaskWorkTime","listenWindowResize","resizeDelay","resizeTimeout","previousSize","getContainerSize","container_resize_method","lowlevelResizeWatcher","$scrollbarRepaint","currentSize","repaintGantt","previousHeight","previousWidth","gantt_core","expire","invalidContainerMessage","validateNode","cloneNode","_reinit","dropLayout","_clearTaskLayers","_clearLinkLayers","rebuildLayout","calculateScaleRange","createView","getPropertyValue","resizeWatcher","contentWindow","resetLayout","initTemplates","domHelpers.toNode","$mouseEvents","edit","question","confirm_deleting","confirm_deleting_title","_simple_confirm","hideLightbox","visibleDate","_sort","posX","_getHorizontalScrollbar","codeScrollLeft","preserveScroll","new_pos","posY","gridCell","attachedScrollbar","verticalScrollbar","$view","setSizes","changeLightboxType","getLightboxType","_silent_redraw_lightbox","_get_link_type","from_start","to_start","isLinkAllowed","prevOffset","time_unit","helpers.getSecondsInUnit","offsetChanged","domHelpers.getClassName","icon_save","icon_cancel","icon_details","confirm_closing","section_description","section_time","section_type","section_deadline","section_baselines","column_wbs","column_text","column_start_date","column_duration","column_add","confirm_link_deleting","link_start","link_end","type_task","type_project","type_milestone","weeks","months","years","message_ok","message_cancel","section_constraint","asap","alap","snet","snlt","fnet","fnlt","mso","mfo","resources_filter_placeholder","resources_filter_label","baselines_section_placeholder","baselines_add_button","baselines_remove_button","baselines_remove_all_button","deadline_enable_button","deadline_disable_button","LocaleManager","addLocale","_locales","getLocale","DHXGantt","license","edit_save","edit_cancel","factory","supportedExtensions","extensionManager","ExtensionManager","activePlugins","plugin","getter","service","DOMParser","ActiveXObject","loadXML","parseFromString","tagname","responseXML","getElementsByTagName","xpathExp","docObj","selectNodes","ownerDocument","evaluate","XPathResult","ANY_TYPE","iterateNext","_call","onLoad","getSync","put","postData","del","postSync","isQt","noCache","toUpperCase","RemoteEvents","copyDomEvent","pageX","pageY","DnD","_obj","_settings","inputMethods","getInputMethods","_drag_start_timer","clearDragTimer","eventParams","passive","accessor","timeStamp","original_target","original_element_sizes","domHelpers.getClosestSizedElement","dragStart","touch_drag","traceDragEvents","inputMethod","mousemove","dragMove","dragScroll","limited_mousemove","started","updates_per_second","dndActive","cancelable","mousemoveContainer","mouseup","checkPositionChange","diff_x","diff_y","pow","sensitivity","initDnDMarker","backupEventTarget","getEvent","backup_element","touchEventsSupported","touches","elementFromPoint","pointerEnabled","pointerType","msPointerEnabled","MSPOINTER_TYPE_MOUSE","getPosition","_prevent_touch_scroll","_touch_drag","_touch_feedback","targetTouches","templatesLoader","regTemplates","initial","template_name","gantt_save_btn","gantt_cancel_btn","gantt_delete_btn","c","progress_text","grid_header_class","task_class","task_end_date","grid_row_class","task_row_class","timeline_cell_content","scale_row_class","grid_indent","grid_folder","grid_file","grid_open","grid_blank","task_unscheduled_time","grid_date_format","link_class","link_description","drag_link","drag_link_class","tooltip_date_format","baseline_text","stateService","selected_task","deletedLinks","originalTask","checkLinkedTaskVisibility","sync_link","sourceTask","sync_link_delete","sync_links","mapEvents","conf","mapFrom","mapTo","sourceEvent","targetEvent","taskLinks","existingLink","sourceMatch","targetMatch","typeMatch","changedTask","oldState","sourceVisible","targetVisible","onItemLoading","onBeforeAdd","onAfterAdd","onBeforeUpdate","onAfterUpdate","onBeforeDelete","onAfterDelete","onIdChange","onBeforeItemMove","onAfterItemMove","onFilterItem","onItemOpen","onItemClose","onBeforeSelect","onAfterSelect","onAfterUnselect","modules","new_task_placeholder","getGridColumn","activate","_cached_functions","update_if_changed","critical_path_mode","wrap_methods","_prefetch_originals","prefetch","methodname","original","optimizer","argumentsArray","l","get_arguments_hash","cached_values","has_cached_value","get_cached_value","cache_value","arguments_hash","is_date","values","stringify_argument","deactivate","setup","override_gantt","gantt_methods","highlight_critical_path","deactivTimeout","_eventRemoveAll","resetLightbox","i18n","en","ar","be","ca","cn","cs","da","de","es","fa","fi","fr","he","hr","hu","it","jp","kr","nb","nl","no","pl","pt","ro","ru","si","sk","sv","tr","ua","setLocale","localeObject","boxAttribute","_dhx_msg_cfg","usercall","modalBox","modal_key","messageBox","keyboard","cancelBubble","modality","cover","onkeydown","messageButtonAttrString","getFirstDefined","_createBox","ok","cancel","contentId","messageModalAttr","inner","btn","onclick","hidden","innerWidth","innerHeight","alertPopup","confirmPopup","boxPopup","box_params","params","messageInfoAttr","insertBefore","timers","hideAll","popups","alert","confirm","modalbox","extendSettings","parentSettings","own","$extendedConfig","setPrototypeOf","configurable$1","parentView","parentConfig","parentTemplates","$getConfig","$getTemplates","uiFactory$1","views","createdViews","creator","configure","configurable","$parent","initUI","registerView","viewConstructor","createMouseHandler","eventHandlers","doubleclick","contextMenu","addEventTarget","onClick","findEventHandlers","callEventHandlers","onContextMenu","src","delegateHandlers","h","onDoubleClick","onMouseMove","_last_move_event","domEvents","delegate","elementHandlers","callHandler","mouseEvents","genericViewPortChecker","x_end","y_end","isLegacyRender","getRowRectangle","getVisibleTasksRange","indexStart","indexEnd","extraTasksIds","inlineEditorId","layerFactory","renderFactory","task_area_pulls","task_area_renderers","getRenderer","renderMethod","updateMethod","getRectangle","renderCallbackMethod","specializedViewPortChecker","basicGetRectangle","onrender","isInViewPort","layerView","viewConfig","rendererViewPort","useBuffer","remove_item","rendered","clear_container","basicGetRange","getVisibleRange","prepareData","buffer","createDocumentFragment","vis","itemsSearch","renderedItems","newElements","nodesToRemove","renderCalledFor","itemNode","restore","replace_item","item_id","newNode","replaceChild","clearRenderers","createGroup","relativeRoot","defaultFilters","initLayer","renderGroup","tempCollection","filters","_add","getLayer","pending","topmost","rel","mergeFilters","requestUpdate","eachLayer","removeLayer","filter_methods","filter_method","barRectangle","startCoord","endCoord","calculated","clearCache","rec","sourceBox","targetBox","initialized","visibleBoxes","isLinkInViewPort","sourceTop","sourceHeight","targetTop","targetHeight","sourceLeft","sourceRight","targetLeft","targetRight","$skipSmartRenderOnScroll","Cell","headerHeight","$domEvents","$name","$factory","_headerClickHandler","final","$preResize","topCont","topSize","getSize","maxWidth","minHeight","setSize","_hide","cellIndex","moveView","$toHTML","canCollapse","$fill","collapsed","size","gravity","getContentSize","$lastSize","contentX","contentY","_getBorderSizes","borders","horizontal","vertical","_currentBorders","_borders","_sizeHeader","_sizeContent","_setBorders","domHelpers.removeClassName","cssHash","domHelpers.addClassName","xLayout","transform","__extends","__","Layout","_super","_this","_parseConfig","domHelpers.removeNode","$cells","_resizeScrollbars","scrollbars","scrollChanged","visibleScrollbars","hiddenScrollbars","scrollbarsToHide","showScrollbar","scrollbar","hideScrollbar","shouldHide","shouldShow","visibleGroups","group","_syncCellSizes","groupName","newSize","groups","_eachChild","_syncGroupSize","cells","_xLayout","newSizeValue","isGravity","ownSize","resizeSibling","siblingSize","totalGravity","totalSize","mainGrid","grid_width","startStage","mainCall","_resizeInProgress","contentViews","setContentSize","_getAutosizeMode","$originalWidthStored","$originalWidth","$originalHeightStored","$originalHeight","isChild","cellId","sub","getCells","domHelpers.insertNode","domHelpers.getChildNodes","contentWidth","contentHeight","_cleanElSize","_getBoxStyles","computed","properties","boxSizing","clientHeight","MozBoxSizing","horPaddings","borderLeftWidth","borderRightWidth","vertPaddings","borderTopWidth","borderBottomWidth","borderBox","outerWidth","outerHeight","boxSizes","contentSizes","_sizes","margin","_calcFreeSpace","side","_free","_gravity","_calcSize","_configureBorders","borderClass","lastVisibleIndex","lastCell","borderColorClass","_updateCellVisibility","oldVisibleCells","_visibleCells","firstCall","visibleCells","parentVisibility","hide_empty","hideCell","cellView","marginSide","ViewLayout","$cell","byMaxSize","otherCell","ViewCell","childConfig","$initialized","unload","_setContentSize","outerX","outerY","childSize","ScrollbarCell","SCROLL_MODIFIER_KEYS","_scrollHorizontalHandler","_scrollVerticalHandler","_outerScrollVerticalHandler","_outerScrollHorizontalHandler","_mouseWheelHandler","scroll_size","_isHorizontal","eachCell","_isVertical","_initVertical","_initHorizontal","_initMouseWheel","_initLinkedViews","_getRootParent","_eachView","_getLinkedViews","$scroll_hor","$scroll_ver","_updateLinkedViews","scrollHorizontally","_scrolling","oldSize","scrollVertically","_wheel_time","_oldLeft","_getScrollSize","scrollSize","outerSize","isHorizontal","linked","scrollProperty","innerSizeProperty","outerProperty","_getScrollOffset","cellScrollSize","nonScrollableSize","outerScroll","innerScroll","visible","scrollSizes","_setScrollSize","toggleVisibility","_getScaleOffset","parentLayout","_oldTop","_checkWheelTarget","connectedViews","wheelSpeed","wheelSpeedConfig","wheel_scroll_sensitivity","ff","deltaX","wheelDeltaX","deltaY","wheelDelta","multiplier","deltaMode","wx","wy","horizontalScrollModifier","oldLeft","detail","oldTop","createMixin","getItemTopCache","getRowTopCache","getItemHeightCache","totalHeightCache","getItemHeightCacheState","quickPosition","cachedRowHeight","canUseSimpleCalc","_getRowHeight","_refreshState","rowStore","globalRowHeight","canUseSimpleCalculation","_resetTopPositionHeight","_resetHeight","getCacheStateTotalHeight","shouldClearHeightCache","all","itemIndex","_fillHeightCache","defaultHeight","globalHeight","itemHeightCache","sumHeight","getHeight","visibleItems","totalHeight","canvasRender","destroy","Timeline","_posFromDateCache","_timelineDragScroll","topPositionMixin","$task_scale","taskBg","$task_bg","$task_baselines","$task_links","$task_bars","$task_constraints","$task_deadlines","_tasks","linksAttr","bindLinks","item_attribute","layers","_createLayerConfig","linkLayers","_attachLayers","backgroundImage","data_els","scrollWidth","scrolled","_refreshScales","_scales","_getScaleChunkHtml","taskFilter","taskLayers","expose","taskBar","hide_bar","_taskLayers","_linkLayers","_bindStore","taskRenderer","bar_layer","_taskRenderer","_initStaticBackgroundRender","linkStore","linkRenderer","linkLayer","_linkRenderer","staticRender","_staticBgHandler","staticBgContainer","$task_bg_static","staticBackgroundHeight","_clearLayers","_render_tasks_scales","scales_html","outer_width","helpers","cfgs","fromPos","toPos","cssClass","tplClass","_prepareScaleHtml","globalConfig","globalTemplates","helpers.findBinary","cssclass","g","floatConfig","sticky","labelPosition","approxLabelWidth","labelPos","translateValue","getTimelineCellAttr","_getColumnDuration","wholeCells","partCell","roundPos","_getNextVisibleColumn","visibleDateIndex","_getPrevVisibleColumn","_getClosestVisibleColumn","dateIndex","visibleIndex","transition","xLeft","xRight","displayStart","displayEnd","isMilestoneRender","_timelineCacheAttached","_unbindStore","ScrollableGrid","_scrollOrder","getCurrentX","_dnd","_scrollView","attachEvents","isScrollable","gridBoundingRect","maxLeft","minLeft","currentX","autoscrollRight","autoscrollStart","autoscrollLeft","autoscrollStop","scrollStep","getCorrection","COLUMN_ID_ATTR_NAME","ColumnsGridDnd","_targetMarker","calculateCurrentPosition","eventX","DND","_scrollableGrid","_draggedCell","draggedColumn","draggedIndex","_gridConfig","outerHTML","lineHeight","_dragX","columnIndexes","findColumnsIndexes","targetColumn","cleanTargetMarker","setMarkerPosition","drawTargetMarker","reorderColumns","draggedId","xBefore","xAfter","currentColumn","startX","endX","columnRelativePos","compare","relativeX","gridOffset","nextPosition","Grid","$state","gridAriaAttr","gridAttrString","gridDataAriaAttr","gridDataAttrString","reorder_grid_columns","gridScaleRowAttrString","doOnRender","_renderHeaderResizers","_mouseDelegates","mouseEventContainer","resizerrow","_task_grid_row_resize","row_before_start","row_id","row_after_start","row_drag_move","dd","itemHeight","itemTop","pointerPosition","markerStartPosition","marker_height","minPointerPosition","row_drag_end","oldItemHeight","finalHeight","dnd_sensitivity","_addLayers","_initEvents","_columnDND","ColumnDnd","_validateColumnWidth","numericWidth","elasticColumns","_setColumnsWidth","columnProperty","newColumnWidth","columnsWidth","_getGridWidth","_gridCacheAttached","_initSmartRenderingPlaceholder","_calculateGridWidth","_renderGridHeader","getColumnIndex","excludeHidden","hiddenIndexShift","getColumn","gridLine","gridTaskRowResizer","_refreshPlaceholderOnStoreUpdate","$rowsPlaceholder","_getColumnWidth","min_width","new_width","max_width","_checkGridColumnMinWidthLimits","_getGridWidthLimits","min_limit","max_limit","newWidth","start_index","columns_width","final_width","extra_width","start_width","iterator","curExtra","_getColsTotalWidth","cols_width","v","parseFloat","unknown","gridWidth","delta","changed","lineHeigth","colWidth","gridScaleCellAttrString","defaultMapping","isChanged","save","onShow","preventKeyNav","shouldPrevent","editPrevCell","editNextCell","onHide","keyNavMappings","onBlurDelay","keyNav","activeCell","editorState","hasEditor","editorType","anyModifier","BaseFactory","BaseEditor","set_value","get_input","get_value","is_changed","currentValue","is_valid","textEditorFactory","TextEditor","numberEditorFactory","NumberEditor","oninput","selectEditorFactory","SelectEditor","optionsHtml","dateEditorFactory","html5DateFormat","dateToStr","strToDate","DateEditor","minValue","maxValue","predecessorEditorFactory","PredecessorEditor","getFormatter","formatter","parseInputString","predecessors","delimiter","formatPredecessors","formatLinkKey","getLinksDiff","predecessorCodes","selectedLinks","Set","existingLinksSearch","linksToAdd","linkKey","linksToDelete","linksDiff","autoSchedule","inputPredecessors","taskPredecessors","durationEditorFactory","linkedPropertiesProcessor","decreaseStartDate","initConfigs","number","predecessor","keyboardMapping","mapping","setMapping","getMapping","eventBus","inlineEditController","createEditors","_createPlaceholder","inlineEditorAttr","updateTaskDateProperties","ganttHandlers","_itemId","_columnName","_editor","_editorType","_placeholder","setValue","editorConfig","getValue","_getItemValue","inline_editors_date_processing","_findEditableCell","nextColumn","getNextCell","getFirstCell","getLastCell","canChangeRow","moveRow","nextItem","editNextRow","skipReadonly","editPrevRow","detachStore","isBarInViewport","createTaskRenderer","_task_default_render","controlsMargin","padd","milestoneHeight","milestoneWidth","done","pr","markerPos","basic","link_from_start","link_target_id","isCriticalTask","link_landing_area","from_id","link_to_start","dragClass","progressColor","textColor","u","setProperty","_get_link_crossing_css","marginStyle","_render_side_content","setTaskBarAttr","_render_pair","outer","showLinkPoints","cond","ln","tp","marginLeft","marginRight","defaultRenderer","createBaseBarRender","resourceHistogramRenderer","getVisibleCellsRange","firstCellIndex","lastCellIndex","isColumnVisible","cellLeftCoord","cellRightCoord","bgPlaceholder","placeholderConfig","lastTaskId","placeholderTask","calendar_id","createLinkRender","drawer","current_pos","dirs","path","point","get_lines","line_to","get_path","line","_get_line","get_wrapper_sizes","wrapper_size","get_line_sizes","line_size","link_line_width","render_line","innerPos","render_corner","corner","radius","lineWidth","cornerDiv","borderVertical","borderHorizontal","arrow","get_direction","vect","path_builder","point_to","get_points","get_endpoint","xy","e_y","e_x","lineType","get_line_type","forward","getMilestonePosition","splitParams","milestoneTask","siblingBaselines","shapes","lines","link_radius","arrowSize","nextLine","cornerX","cornerY","lastLine","arrowX","arrowY","shape","render_arrow","cssTemplate","isCriticalLink","linkAttr","createResourceTimelineBuilder","assignmentsPassed","timegrid","scaleUnit","scaleStep","precalculatedTimes","firstColumn","minScaleDate","currDate","cachedTimes","timetable","rowDnd","checkPlaceholderTask","getStore","initial_open_state","$transparent","lastTaskOfLevel","last_item","_getGridPos","gridHeight","maxBottom","_getTargetY","scrollPos","_getTaskByY","dropIndex","gridDataSizes","reorderMarkerAttr","containerSize","targetY","allowedLevel","over","nextId","dropTarget","createDropTargetObject","targetId","prevSibling","nextSiblingTarget","dndTaskId","prevSiblingTarget","firstChildTarget","lastChildTarget","findClosesTarget","targetLevel","findTargetAbove","findTargetBelow","getSameLevelDropPosition","relTargetPos","eventTop","targetAbove","targetBelow","gridToPageCoordinates","gridPos","setWidthWithinContainer","higlighter","removeLineHighlight","markerLine","highlightPosition","ePos","pointerEvents","markerFolder","folderHighlightWidth","linePos","indentNode","indent","iconWidth","childCount","markerLineTop","rowDndMarker","opacity","drop_target","getDropPosition","doctype","minTop","firstVisibleTaskIndex","firstVisibleTaskId","firstVisibleTaskPos","hiddenTaskPart","gridPosition","gridBottom","placeholderRowHeight","lockLevel","getLockedLevelTarget","initializer","onCreated","extendGantt","_inlineEditors","onInitialized","initEvents","extendDom","onDestroyed","clearEvents","showDate","sorting_method","totalWidth","taskDnD","createTaskDND","roundTaskDates","round_task_dates","dragMultiple","before_start","before_finish","after_finish","clear_drag_state","set_actions","drag_from_start","stage","_move","_resize","_resize_progress","on_mouse_move","on_mouse_down","on_mouse_up","start_x","start_y","coords_x","_drag_task_coords","minDurationInUnits","_calculateMinDuration","diffValue","_find_max_shift","dragItems","correctShift","minX","maxX","maxShift","minShift","multipleDragShift","new_start","new_end","obj_s_x","obj_e_x","_mouse_position_change","oldPos","newPos","_is_number","isFinite","start_drag","sX","sY","now","_start_dnd","_update_on_move","_update_item_on_move","curr_date","dragHash","_isMultiselect","dragProject","initialDrag","childDrag","_get_drag_mode","_fix_dnd_scale_time","fixStart","_fix_working_times","_finalize_mouse_up","_fireEvent","_dhx_changed","finalizingBulkMove","moveCount","doFinalize","dragProperty","selectedTasksIds","selectedTask","_addSubtasksToDragMultiple","trigger","drag_state","summaryId","initLinksDND","_link_landing","_link_target_task","_link_target_task_start","_link_source_task","_link_source_task_start","getDndState","link_edge_marker","link_landing_hover_area","markerSize","viewportSize","ganttOffsetY","updateMarkedHtml","resetDndState","showDirectingLine","s_x","s_y","_direction","link_direction_class","dist","tan","angle","atan","coordinateCircleQuarter","sin","cos","shiftLeft","shiftTop","eX","eY","_dir_start","landing","prevTarget","prevLanding","prevToStart","targ","absCoords","domHelpers.getRelativeNodePosition","_dir_end","targetChanged","linkDnD","_linksDnD","_tasksDnD","MouseDelegates","_attachDomEvents","_attachStateProvider","_clearDomEvents","_clearStateProvider","_delete_link_handler","coll","coll_date","scale_step","getVerticalScrollbar","getHorizontalScrollbar","_legacyGridResizerClass","resizers","gridResizer","mainTimeline","colsWidth","hideGrid","grid_limits","ganttContainerWidth","verticalScrollbarWidth","gridOverflow","original_grid_width","skinSettings","skins","_initScrollStateEvents","_getVerticalScrollbar","_findGridResizer","gridFirst","_getSiblings","_behind","_front","resizeInfo","initialWidth","prevCellWidth","nextCellWidth","viewCell","limits","newBehindSize","newFrontSize","oldBackSize","oldFrontSize","newBackSize","ui$1","attachInitializer","uiFactory","Scrollbar","mainLayoutInitializer","mainTimelineInitializer","mainGridInitializer","ResourceGrid","ResourceTimeline","ResourceHistogram","layersEngine","createLayerFactory","previusSiblingContainer","defaultContainerSibling","addTaskLayer","rangeFunction","getVisibleTaskRange","_getTaskLayers","removeTaskLayer","addLinkLayer","getVisibleLinksRangeFactory","isLinkInViewport","_getLinkLayers","removeLinkLayer","gridEditorsFactory","layersApi","textValue","aria","gridAddButtonAttrString","justifyContent","center","gridCellAttrString","css_template","taskRowAttr","rowNode","cellNode","external_render","adapter","isElement","renderElement","renderedCells","isRendered","detachRenderedCell","getCellClassTemplate","getCellContentTemplate","renderOneCell","contentTemplate","cssTemplateContent","htmlTemplateContent","customCell","cellCssTemplate","cellHtmlTemplate","odd","placeholderTop","placeholderHeight","renderTaskBar","timedProjectBar","renderTimedProjectBar","taskRollupBar","renderedNodes","checkVisibility","generateChildElement","childCopy","$rendered_at","getKey","renderParentId","rollupKey","taskSplitBar","renderSplitTaskBar","taskConstraints","renderConstraints","taskDeadline","renderDeadline","renderBaselines","renderLink","resourceRow","getResourceLoad","resourceTimetable","renderedResourceLines","renderResourceLineCell","detachRenderedResourceLine","checkedColumns","resourceHistogram","resize_el","rowResizerAttr","layersService","_get_skin","themeVar","themeName","isCssVarTheme","href","_theme_info","theme","cssVarTheme","skinset","_second_column_width","_third_column_width","_lightbox_template","_redefine_lightbox_buttons","scrollRange","scrollDelay","scrollSpeed","isMove","delayTimeout","startPos","eventPos","isDisplayed","isScrollState","dragMarker","isResize","isLink","isClickDrag","defineDelayTimeout","speed","tick","autoscroll_delay","defineScrollInterval","autoscrollInterval","isScroll","gridDrag","need_scroll","currentScrollTop","scrollOuterHeight","scrollInnerHeight","currentScrollLeft","scrollOuterWidth","scrollInnerWidth","autoscroll_step","boxSize","$","jQuery","fn","dhx_gantt","each","newgantt","Gantt","getGanttInstance","jquery_hooks","dhtmlx","attaches","attachGantt","cmp","attachObject","dataType","dataObj","vs","av","border","gridId","gridObj","dhtmlXCellObject","dhtmlx_hooks","USE_KEY","_defaultScales","TimelineZoom","zoomIn","getCurrentLevel","setLevel","zoomOut","_levels","_activeLevelIndex","getLevels","zoomLevel","_getZoomIndexByName","levelName","_getVisibleDate","_visibleDate","cursorOffset","nextConfig","chartConfig","resourceView","resourceConfig","fixed_scales","cursorDate","newPosition","middleDate","_attachWheelEvent","_useKey","_handler","_defaultHandler","timelineOffset","wheelUp","stopPropagation","_setScaleSettings","_setScaleDates","_initialStartDate","_initialEndDate","activeLevelIndex","_mapScales","levels","_minColumnWidth","minColumnWidth","_maxColumnWidth","maxColumnWidth","_widthStep","widthStep","_stepUp","_stepDown","nextLevel","addTouchEvents","platform","maxTouchPoints","_touch_events","getTaskDND","tasksDnD","touch_feedback","touch_feedback_duration","vibrate","touchHandlers","names","dblclicktime","actionMode","scrollMode","actionStart","longTapTimer","currentDndId","dndNodes","targetView","multiTouchEvents","newScrollState","block_action","allViews","_locate_css","taskNode","dummy","BaseControl","BaseConstrutor","htmlHelpers","getHtmlSelect","_attributes","getHtmlOption","_getHtmlContainer","getHtmlButton","getHtmlDiv","getHtmlLabel","getHtmlInput","_getHtmlAttributes","ResourcesControlConstructor","Super","SelectControl","sns","_dhx_onchange","onchange","_focus","ParentControlConstructor","ParentControl","_display","allow_root","root_label","form_blocks","tmpDom","newOptions","onselect","TemplateControl","TextareaControl","_get_input","TimeControl","getTimePicker","sectionClassName","_time_format_order","auto_end_date","_update_lightbox_select","_fill_lightbox_select","_resolve_default_mapping","selects","getTimePickerValue","autofix_end","_get_timepicker_step","SelectControlConstructor","CheckboxControl","single_value","checkboxes","checked","resArray","RadioControl","radio","default_value","DurationControl","_getStartDate","_getDuration","singleDate","lightboxDurationInputAttrString","durationInputClass","duration_val","inps","btns","endspan","_calc_date","_change_duration","charCode","ResourcesControl","ConstraintControl","isNonTimedConstraint","toggleTimeSelect","timeSelects","typeValue","isNonTimed","disabled","typeSelect","_eventsInitialized","constraintDate","constraintType","getConstraintType","TypeselectControl","typeKey","oldOnChange","_lightbox_current_type","BaselineControl","_generateBaselineRow","durationLabel","deleteLabel","durationEl","deleteButton","baselineRow","section","baselineNode","baselineId","dataset","updatedBaseline","button_click","_get_typed_lightbox_config","_lightbox_methods","_lightbox_root","showCover","_fill_lightbox","_setLbPosition","lightboxVisibleAttr","getLabel","list_name","_lightbox_type","lightboxDiv","fullWidth","ds","classNames","cspEnvironment","salesforceEnvironment","setParentNode","_lightbox","_is_lightbox_timepicker","wide_form","getHtmlButtons","lightboxAttr","onmousedown","_ready_to_dnd","ontouchstart","onselectstart","cursor","_init_dnd_events","show_cover","_cover","_render_sections","backup_overflow","labelBlock","inputBlock","inputId","_init_lightbox_events","block","_center_lightbox","rootElement","_move_while_dnd","_finish_dnd","_get_type_name","type_value","floatRight","lightboxButtonAttrString","getTimeFormat","time_format","getHtmlTimePickerOptions","start_year","end_year","tdate","timeFormat","year_range","_time_values","lightbox_events","_save_lightbox","_cancel_lightbox","sec","buttonTarget","getLightboxValues","time_optional","duration_optional","lightboxHiddenAttr","hideCover","_custom_lightbox","_set_lightbox_values","lightboxHeader","lightbox_header","getLightboxSection","get_template_control","control","get_select_control","get_textarea_control","get_time_control","_dnd_start_lb","gantt_unselectable","lb","_lb_start","ariaAttrs","limit_time_select","first_hour","last_hour","lightboxSelectAttrString","mapOffset","checkbox","constraint","typeselect","oldType","ui","codeHelpers.arrayFind","domEventScope","uiApi","getTimeline","getGrid","getBaseCell","baseCell","getAttachedScrollbar","DEFAULT_VALUE","tryCall","getTaskTop","getTaskBarHeight","domAttr","getLinkNode","oldH","oldV","verticalViews","horizontalViews","commonViews","viewId","newV","newH","date_x","scroll_to","leftPos","_scroll_state","timelineCell","x_pos","y_pos","x_inner","y_inner","scrollVer","scrollHor","horState","verState","cellName","horizontalScroll","verticalScroll","resetSkin","monitorThemeChange","_addThemeClass","setSkin","monitorIntervalId","csstheme","skyblue","lightbox_additional_height","dark","meadow","terrace","broadway","_config_buttons_left","_config_buttons_right","material","indx","zoom","_extend_to_optional","lightbox_block","optional_time","update_block","button_text","htmlTags","extraSpaces","stripHTMLLite","htmlText","singleQuotes","escapeQuotes","getAttributeString","_taskCommonAttr","linkTypes","toStart","fromStart","gridSeparatorAttr","buttonName","role","tabindex","headerText","time_option","buttonLabel","targetAttribute","_locateHTML","firstTask","domHelpers.getScrollSize","availablePlugins","critical_path","grouping","groupBy","overlay","_load_url","cl","_load_type"],"mappings":"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","x_google_ignoreList":[44]}